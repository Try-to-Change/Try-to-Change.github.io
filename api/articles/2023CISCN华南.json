{"title":"2023CISCN华南","uid":"7f59ed435de527de8496945b09a06586","slug":"2023CISCN华南","date":"2023-07-01T13:35:20.047Z","updated":"2023-08-06T08:02:37.533Z","comments":true,"path":"api/articles/2023CISCN华南.json","keywords":null,"cover":"/img/46.jpg","content":"<p><code>2023国赛华南赛区题目学习</code></p>\n<span id=\"more\"></span>\n\n<h1 id=\"OwnSquirrelly\"><a href=\"#OwnSquirrelly\" class=\"headerlink\" title=\"OwnSquirrelly\"></a>OwnSquirrelly</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><a href=\"https://github.com/squirrellyjs/squirrelly\">Squirrelly</a> 是一个用 JavaScript 实现的现代、可配置且速度极快的模板引擎。它与 ExpressJS 一起开箱即用，完整版的 gzip 压缩后仅重约 4KB。</p></blockquote>\n<p><code>app.js</code>，发现题目是nodejs编写的网站服务，端口3000</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> createError = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http-errors&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> session = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express-session&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> squirrelly = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;squirrelly&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> randomize = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;randomatic&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> cookieParser = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;cookie-parser&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> logger = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;morgan&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> utils = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./utils&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> indexRouter = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./routes/index&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> usersRouter = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./routes/users&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"title function_\">express</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// view engine setup</span></span><br><span class=\"line\">app.<span class=\"title function_\">set</span>(<span class=\"string\">&#x27;views&#x27;</span>, path.<span class=\"title function_\">join</span>(__dirname, <span class=\"string\">&#x27;views&#x27;</span>));</span><br><span class=\"line\">app.<span class=\"title function_\">set</span>(<span class=\"string\">&#x27;view engine&#x27;</span>, <span class=\"string\">&#x27;squirrelly&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">logger</span>(<span class=\"string\">&#x27;dev&#x27;</span>));</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">json</span>());</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">urlencoded</span>(&#123; <span class=\"attr\">extended</span>: <span class=\"literal\">true</span> &#125;));</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">cookieParser</span>());</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(path.<span class=\"title function_\">join</span>(__dirname, <span class=\"string\">&#x27;public&#x27;</span>)));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// start session</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">session</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"string\">&#x27;thejs.session&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">secret</span>: <span class=\"title function_\">randomize</span>(<span class=\"string\">&#x27;Ye0h&#x27;</span>, <span class=\"number\">16</span>),</span><br><span class=\"line\"><span class=\"comment\">//randomize的第一个参数是生成的字符串的长度，第二个参数是生成的字符串的字符范围</span></span><br><span class=\"line\"><span class=\"comment\">//randomize的作用是生成一个随机的字符串，用于加密session</span></span><br><span class=\"line\">  <span class=\"attr\">resave</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">saveUninitialized</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;))</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"string\">&#x27;/&#x27;</span>, indexRouter);</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"string\">&#x27;/users&#x27;</span>, usersRouter);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// catch 404 and forward to error handler</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">function</span>(<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"title function_\">next</span>(<span class=\"title function_\">createError</span>(<span class=\"number\">404</span>));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> server = app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> host = server.<span class=\"title function_\">address</span>().<span class=\"property\">address</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> port = server.<span class=\"title function_\">address</span>().<span class=\"property\">port</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;Listening on http://%s:%s&quot;</span>, host, port)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>访问，发现是一个login页面</p>\n<p><img src=\"/post/2023CISCN%E5%8D%8E%E5%8D%9/image-20230701223652900.png\" alt=\"image-20230701223652900\"></p>\n<p>点击登录，跳转到Register页面</p>\n<p><img src=\"/post/2023CISCN%E5%8D%8E%E5%8D%9/image-20230703231445526.png\" alt=\"image-20230703231445526\"></p>\n<p>但是注册报错，看看<code>users.js</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// init database</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> connection  = mysql.<span class=\"title function_\">createConnection</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">host</span>:<span class=\"string\">&#x27;localhost&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">user</span>:<span class=\"string\">&#x27;root&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">password</span>:<span class=\"string\">&#x27;123456&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">database</span>:<span class=\"string\">&#x27;ctf&#x27;</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>发现有个初始化数据库，再看看列名和数据表名</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>(req.<span class=\"property\">method</span> == <span class=\"string\">&quot;POST&quot;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> username = req.<span class=\"property\">body</span>.<span class=\"property\">username</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> password = req.<span class=\"property\">body</span>.<span class=\"property\">password</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (username !== <span class=\"literal\">undefined</span> &amp;&amp; password !== <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> querySql = <span class=\"string\">&quot;select * from users where username = ?&quot;</span>;</span><br><span class=\"line\">      connection.<span class=\"title function_\">query</span>(querySql, [username], <span class=\"keyword\">function</span>(<span class=\"params\">err, result</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(err) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> res.<span class=\"title function_\">render</span>(<span class=\"string\">&#x27;register&#x27;</span>, &#123; </span><br><span class=\"line\">            <span class=\"attr\">message</span>: <span class=\"string\">&#x27;Error!&#x27;</span></span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        result = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(result))[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(result &amp;&amp; result.<span class=\"property\">username</span> !== <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> res.<span class=\"title function_\">render</span>(<span class=\"string\">&#x27;register&#x27;</span>, &#123; </span><br><span class=\"line\">            <span class=\"attr\">message</span>: <span class=\"string\">&#x27;User already exists.&#x27;</span> </span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> insertSql = <span class=\"string\">&quot;insert into users (`username`, `password`) value (?, ?)&quot;</span>;</span><br><span class=\"line\">          connection.<span class=\"title function_\">query</span>(insertSql, [username, utils.<span class=\"title function_\">md5</span>(password)], <span class=\"keyword\">function</span>(<span class=\"params\">err, result</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(err) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> res.<span class=\"title function_\">render</span>(<span class=\"string\">&#x27;register&#x27;</span>, &#123; </span><br><span class=\"line\">                <span class=\"attr\">message</span>: <span class=\"string\">&#x27;Error!&#x27;</span> </span><br><span class=\"line\">              &#125;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> res.<span class=\"title function_\">render</span>(<span class=\"string\">&#x27;register&#x27;</span>, &#123; </span><br><span class=\"line\">            <span class=\"attr\">message</span>: <span class=\"string\">&#x27;Register successed.&#x27;</span> </span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>于是构建该数据库和对应表和列</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> database ctf;</span><br><span class=\"line\">use ctf;</span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> users (</span><br><span class=\"line\">  id <span class=\"type\">INT</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> AUTO_INCREMENT,</span><br><span class=\"line\">  username <span class=\"type\">VARCHAR</span>(<span class=\"number\">50</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  password <span class=\"type\">VARCHAR</span>(<span class=\"number\">255</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY (id)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/post/2023CISCN%E5%8D%8E%E5%8D%9/image-20230703232247545.png\" alt=\"image-20230703232247545\"></p>\n<p>注册成功，进行登录</p>\n<p><img src=\"/post/2023CISCN%E5%8D%8E%E5%8D%9/image-20230703232345400.png\" alt=\"image-20230703232345400\"></p>\n<hr>\n<p>查看代码，分析题目，发现是<code>Squirrel</code>是一个模板引擎，所以猜测改代码中存在<code>ssti</code>，或者<code>XSS</code>，或者<code>RCE</code></p>\n<p>但是考虑到比赛不出网，所以先自己寻找注入点</p>\n<p>下面是两篇参考文章，</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2021-32819\">NVD - CVE-2021-32819 (nist.gov)</a></p>\n<p><a href=\"https://www.freebuf.com/vuls/276112.html\">漏洞分析：CVE-2021-32819 - FreeBuf网络安全行业门户</a></p></blockquote>\n<p>因为是<code>js</code>，所以查看<code>res.render</code>存在的地方，寻找可以控制的参数</p>\n<p>发现</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* GET users listing. */</span></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (req.<span class=\"property\">session</span>.<span class=\"property\">userID</span> === <span class=\"literal\">undefined</span> || req.<span class=\"property\">session</span>.<span class=\"property\">userID</span> === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.<span class=\"title function_\">redirect</span>(<span class=\"string\">&#x27;/users/login&#x27;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!utils.<span class=\"title function_\">isSafeObj</span>(req.<span class=\"property\">query</span>.<span class=\"property\">information</span>))</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.<span class=\"title function_\">render</span>(<span class=\"string\">&#x27;home&#x27;</span>, &#123; <span class=\"attr\">username</span>: req.<span class=\"property\">session</span>.<span class=\"property\">userID</span> &#125;);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.<span class=\"title function_\">render</span>(<span class=\"string\">&#x27;home&#x27;</span>, req.<span class=\"property\">query</span>.<span class=\"property\">information</span>)</span><br><span class=\"line\">      <span class=\"comment\">//这里的req.query.information是一个对象，所以可以直接传入</span></span><br><span class=\"line\">      <span class=\"comment\">//模板是home.squirrelly</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>最后一行中，<code>req.query.information</code>是可控的，而且是将其直接进行渲染，所以这里尝试修改<code>GET</code>发送<code>information</code>参数进行<code>ssti</code>注入</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">return</span> res.<span class=\"title function_\">render</span>(<span class=\"string\">&#x27;home&#x27;</span>, req.<span class=\"property\">query</span>.<span class=\"property\">information</span>)</span><br></pre></td></tr></table></figure>\n\n<p>而渲染模板<code>home</code>，就是<code>home.squirrelly</code>，是<code>squirrel</code>特有的模板文件格式</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;home-content&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;/images/avatar.jpg&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;Avatar&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;avatar&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;username&quot;</span>&gt;</span>&#123;&#123; it.username &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;timestamp&quot;</span>&gt;</span>Current Time: <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;current-time&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// Update current time</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">function</span> <span class=\"title function_\">updateCurrentTime</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">var</span> currentTime = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">toLocaleString</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;current-time&#x27;</span>).<span class=\"property\">textContent</span> = currentTime;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// Update current time every second</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"built_in\">setInterval</span>(updateCurrentTime, <span class=\"number\">1000</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>&#123;&#123; it.username &#125;&#125;</code>，这里就是下面代码传入的动态渲染参数，是登录后显示</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (!utils.<span class=\"title function_\">isSafeObj</span>(req.<span class=\"property\">query</span>.<span class=\"property\">information</span>))</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.<span class=\"title function_\">render</span>(<span class=\"string\">&#x27;home&#x27;</span>, &#123; <span class=\"attr\">username</span>: req.<span class=\"property\">session</span>.<span class=\"property\">userID</span> &#125;);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.<span class=\"title function_\">render</span>(<span class=\"string\">&#x27;home&#x27;</span>, req.<span class=\"property\">query</span>.<span class=\"property\">information</span>)</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n","text":"2023国赛华南赛区题目学习 OwnSquirrelly Squirrelly 是一个用 JavaScript 实现的现代、可配置且速度极快的模板引擎。它与 E...","permalink":"/post/2023CISCN华南","photos":[],"count_time":{"symbolsCount":"5.7k","symbolsTime":"5 mins."},"categories":[{"name":"网络安全学习","slug":"网络安全学习","count":26,"path":"api/categories/网络安全学习.json"}],"tags":[{"name":"Game","slug":"Game","count":12,"path":"api/tags/Game.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#OwnSquirrelly\"><span class=\"toc-text\">OwnSquirrelly</span></a></li></ol>","author":{"name":"Ttoc","slug":"blog-author","avatar":"/static/img/logo.png","link":"/","description":"必须从过去的错误学习教训，而非依赖过去的成功","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Apache shiro-550反序列化漏洞分析","uid":"5abffa5265ef71790df12abfc2dd6b2a","slug":"Apache_shiro-550反序列化漏洞分析","date":"2023-07-21T13:40:36.963Z","updated":"2023-09-25T14:57:45.369Z","comments":true,"path":"api/articles/Apache_shiro-550反序列化漏洞分析.json","keywords":null,"cover":"/img/1.jpg","text":"很重要，经典 Apache shiro-550反序列化漏洞分析前言 中间件介绍： Apache Shiro是一个强大且易用的Java安全框架,执行身份验证、授权...","permalink":"/post/Apache_shiro-550反序列化漏洞分析","photos":[],"count_time":{"symbolsCount":"1.3k","symbolsTime":"1 mins."},"categories":[{"name":"Java","slug":"Java","count":1,"path":"api/categories/Java.json"}],"tags":[{"name":"Java","slug":"Java","count":7,"path":"api/tags/Java.json"}],"author":{"name":"Ttoc","slug":"blog-author","avatar":"/static/img/logo.png","link":"/","description":"必须从过去的错误学习教训，而非依赖过去的成功","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"2023CISCN初赛","uid":"3a008563d9e95b96508de8510cfa8652","slug":"2023CISCN初赛","date":"2023-06-13T16:36:32.535Z","updated":"2023-08-24T08:38:47.394Z","comments":true,"path":"api/articles/2023CISCN初赛.json","keywords":null,"cover":"/img/45.jpg","text":"2023国赛web记录，学到很多，感觉原题也挺多，但是改的挺好 gosession 题目内容：ctfer按照官方文档的模板编写了代码，但是好像哪里出了问题。 附...","permalink":"/post/2023CISCN初赛","photos":[],"count_time":{"symbolsCount":"17k","symbolsTime":"15 mins."},"categories":[{"name":"网络安全学习","slug":"网络安全学习","count":26,"path":"api/categories/网络安全学习.json"}],"tags":[{"name":"Game","slug":"Game","count":12,"path":"api/tags/Game.json"}],"author":{"name":"Ttoc","slug":"blog-author","avatar":"/static/img/logo.png","link":"/","description":"必须从过去的错误学习教训，而非依赖过去的成功","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}